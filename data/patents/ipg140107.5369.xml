<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08626469-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08626469</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12907586</doc-number>
<date>20101019</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>321</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>03</class>
<subclass>B</subclass>
<main-group>1</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>03</class>
<subclass>K</subclass>
<main-group>5</main-group>
<subgroup>00</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>702107</main-classification>
<further-classification>327551</further-classification>
</classification-national>
<invention-title id="d2e53">In-situ RC-calibration scheme for active RC filter</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>7136431</doc-number>
<kind>B2</kind>
<name>Shi et al.</name>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>7596363</doc-number>
<kind>B2</kind>
<name>Mo et al.</name>
<date>20090900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>2011/0279175</doc-number>
<kind>A1</kind>
<name>Kuo et al.</name>
<date>20111100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>327553</main-classification></classification-national>
</us-citation>
<us-citation>
<nplcit num="00004">
<othercit>Zou, L. et al., &#x201c;A 12<sup>th </sup>Order Active-RC Filter with Automatic Frequency Tuning for DVB Tuner Applications,&#x201d; IEEE Asian Solid-State Circuits Conference, Nov. 3-5, 2008, pp. 281-284, Fukuoka, Japan.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>9</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>702107</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>327551</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>12</number-of-drawing-sheets>
<number-of-figures>12</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20120095715</doc-number>
<kind>A1</kind>
<date>20120419</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Nag</last-name>
<first-name>Dipankar</first-name>
<address>
<city>Hsin-Chu</city>
<country>TW</country>
</address>
</addressbook>
<residence>
<country>TW</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Chen</last-name>
<first-name>Mei-Show</first-name>
<address>
<city>Hsin-Chu</city>
<country>TW</country>
</address>
</addressbook>
<residence>
<country>TW</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Jou</last-name>
<first-name>Chewn-Pu</first-name>
<address>
<city>Hsin-Chu</city>
<country>TW</country>
</address>
</addressbook>
<residence>
<country>TW</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Nag</last-name>
<first-name>Dipankar</first-name>
<address>
<city>Hsin-Chu</city>
<country>TW</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Chen</last-name>
<first-name>Mei-Show</first-name>
<address>
<city>Hsin-Chu</city>
<country>TW</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Jou</last-name>
<first-name>Chewn-Pu</first-name>
<address>
<city>Hsin-Chu</city>
<country>TW</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Slater &#x26; Matsil, L.L.P.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Taiwan Semiconductor Manufacturing Company, Ltd.</orgname>
<role>03</role>
<address>
<city>Hsin-Chu</city>
<country>TW</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Taningco</last-name>
<first-name>Alexander H</first-name>
<department>2857</department>
</primary-examiner>
<assistant-examiner>
<last-name>Vargas</last-name>
<first-name>Manuel Rivera</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A method of calibrating a filter includes applying an input signal into the filter to generate an output signal, measuring a phase difference between the input signal and the output signal; determining a leading/lagging status of the phase difference; calculating a capacitor code (CAP_CODE) using the leading/lagging status; and calibrating the capacitor using the CAP_CODE.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="142.07mm" wi="217.68mm" file="US08626469-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="149.18mm" wi="93.64mm" orientation="landscape" file="US08626469-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="136.48mm" wi="171.70mm" orientation="landscape" file="US08626469-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="202.52mm" wi="129.46mm" orientation="landscape" file="US08626469-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="134.96mm" wi="82.21mm" orientation="landscape" file="US08626469-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="219.46mm" wi="154.52mm" orientation="landscape" file="US08626469-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="180.34mm" wi="84.33mm" orientation="landscape" file="US08626469-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="206.84mm" wi="91.61mm" orientation="landscape" file="US08626469-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="172.64mm" wi="120.23mm" orientation="landscape" file="US08626469-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="137.75mm" wi="113.28mm" orientation="landscape" file="US08626469-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="203.79mm" wi="134.45mm" orientation="landscape" file="US08626469-20140107-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="143.00mm" wi="136.57mm" orientation="landscape" file="US08626469-20140107-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="232.58mm" wi="167.89mm" orientation="landscape" file="US08626469-20140107-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND</heading>
<p id="p-0002" num="0001">Receivers are well-known components for communication systems. A receiver may include a low noise amplifier (LNA) for filtering inbound radio frequency (RF) signals, and mixers for generating intermediate frequency (IF) signals by mixing the filtered RF signals with a signal from a local oscillator.</p>
<p id="p-0003" num="0002">The IF signals may be filtered by a bandpass filter (BPF). The frequency band of the BPF needs to be accurately tuned to the desirable frequency band to ensure good performance of the respective receiver. However, due to the process variation and temperature variation of the BPF, the frequency band may have big variations, and hence the BPF needs to be calibrated.</p>
<p id="p-0004" num="0003">Conventionally, the BPF may be calibrated through the calibration of the resistors and/or capacitors in the BPF. The BPF were calibrated using an external calibration system external to a capacitor bank (array) of the BPF, and a capacitor bank of the external tuning system is calibrated, and the capacitor code for calibrating the capacitor array of the external tuning system is latched to the capacitor bank in the BPF, and hence the capacitor bank in the BPF is also calibrated.</p>
<p id="p-0005" num="0004">When the scale of the integrated circuits becomes smaller, there is an increasingly greater intra-die mismatch between the capacitor bank of the BPF and the capacitor bank of the external tuning system even if they are on a same die. The accuracy in the calibration is thus impaired. Further, the external tuning system requires extra chip area.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0002" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0006" num="0005">For a more complete understanding of the embodiments, and the advantages thereof, reference is now made to the following descriptions taken in conjunction with the accompanying drawings, in which:</p>
<p id="p-0007" num="0006"><figref idref="DRAWINGS">FIG. 1</figref> illustrates a block diagram of a receiver comprising bandpass filters (BPF);</p>
<p id="p-0008" num="0007"><figref idref="DRAWINGS">FIG. 2</figref> illustrates a portion of an exemplary capacitor bank (CPB) that is calibrated through a capacitor code (CAP_CODE);</p>
<p id="p-0009" num="0008"><figref idref="DRAWINGS">FIG. 3</figref> illustrates an architecture of a filter calibration circuit;</p>
<p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. 4</figref> illustrates an operation flow for calibrating a capacitor in a filter;</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 5</figref> illustrates a block diagram of a circuit in accordance with an embodiment, wherein the circuit implements the architecture shown in <figref idref="DRAWINGS">FIG. 3</figref>;</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIGS. 6 and 7</figref> are pre-calibration simulation results and post-calibration simulation results, respectively;</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIGS. 8 and 9</figref> are waveforms of input and output signals of an filter, wherein the waveforms in <figref idref="DRAWINGS">FIGS. 8 and 9</figref> are pre-calibration results and post-calibration results, respectively;</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIGS. 10 and 11</figref> are frequency response of filters, wherein <figref idref="DRAWINGS">FIG. 11</figref> is obtained after performing calibrations to the circuits related to <figref idref="DRAWINGS">FIG. 10</figref>; and</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 12</figref> illustrates a block diagram of a circuit implementing the architecture shown in <figref idref="DRAWINGS">FIG. 3</figref> in accordance with an alternative embodiment.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0003" level="1">DETAILED DESCRIPTION OF ILLUSTRATIVE EMBODIMENTS</heading>
<p id="p-0016" num="0015">The making and using of the embodiments of the disclosure are discussed in detail below. It should be appreciated, however, that the embodiments provide many applicable inventive concepts that can be embodied in a wide variety of specific contexts. The specific embodiments discussed are merely illustrative, and do not limit the scope of the disclosure.</p>
<p id="p-0017" num="0016">A novel RC filter calibration method and circuits for performing the same are presented in accordance with an embodiment. The variations and the operation of the embodiments are then discussed. Throughout the various views and illustrative embodiments, like reference numbers are used to designate like elements.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 1</figref> illustrates an exemplary receiver, which includes an intermediate frequency (IF) chain that comprises a capacitor (not shown in <figref idref="DRAWINGS">FIG. 1</figref>, please refer to <figref idref="DRAWINGS">FIG. 2</figref>) to be calibrated. It is noted that the filter in the receiver shown in <figref idref="DRAWINGS">FIG. 1</figref> is merely an exemplary embodiment, while the calibration scheme provided by the embodiments may be applied to the calibration of any other RC filter. The receiver includes a low noise amplifier (LNA) for filtering inbound radio frequency (RF) signals, transconductance amplifiers (TA), and mixers. The mixers generate intermediate frequency (IF) signals by mixing the RF signals received from the TAs with signals generated from a local oscillator (LO).</p>
<p id="p-0019" num="0018">The IF signals are provided to an IF chain, which includes programmable gain amplifiers PGA<b>1</b> that amplify the IF signals and transfer the amplified IF signals to bandpass filters BPF, which filter the IF signals. Programmable gain amplifiers PGA<b>2</b> further amplify the filtered IF signals and output the signals to analog-to-digital converters ADC.</p>
<p id="p-0020" num="0019">A portion of an exemplary bandpass filter BPF is illustrated in <figref idref="DRAWINGS">FIG. 2</figref>, which shows a portion of a poly-phase BPF comprising amplifier AMP, which is coupled to capacitor bank(s) CPB. The poly-phase BPF may include more than one of the components shown in <figref idref="DRAWINGS">FIG. 2</figref>, although only one is shown. Each of capacitor banks CPB, which includes a plurality of sub-capacitors therein, is operated by a capacitor code (CAP_CODE) to turn on a desirable number of sub-capacitors built therein, so that the capacitance of the resulting capacitor bank CPB is changed. By calibrating capacitor bank(s) CPB, the phase of the signal outputted by bandpass filters BPF is shifted. When the IF signals received by the IF chain (referred to as FILTER_IN signals hereinafter) is in phase with the IF signals outputted by the IF chain, the bandpass filter BPF is considered as being successfully calibrated.</p>
<p id="p-0021" num="0020">An architecture of a calibration system for calibrating the capacitance of bandpass filter BPF (for example, in the IF chain as shown in <figref idref="DRAWINGS">FIG. 1</figref>) is illustrated in <figref idref="DRAWINGS">FIG. 3</figref>. During the calibration, the IF chain receives a FILTER_IN signal, which is shown as waveform FILTER_IN in <figref idref="DRAWINGS">FIG. 8</figref>. The FILTER_IN signal passes through the IF chain and the bandpass filter(s) BPF therein (<figref idref="DRAWINGS">FIG. 1</figref>), and a FILTER_OUT signal is generated by the IF chain and the respective bandpass filter BPF. The FILTER_OUT signal has a same frequency as, and may have a phase different from, that of the FILTER_IN signal. An exemplary FILTER_OUT signal is also illustrated as waveform FILTER_OUT in <figref idref="DRAWINGS">FIG. 8</figref>. The FILTER_IN signal and the FILTER_OUT signal, which may be differential signals, may then be converted to single-ended reference and test signals, which are denoted as REF and TEST, respectively. The phases of the REF and TEST signals are then compared with each other to determine a phase difference between the REF and TEST signals, and to determine which of the REF and TEST signals leads in phase. Throughout the description, which of the REF and TEST Signals leads in phase is also referred to as a leading status of the phases. It is appreciated that the leading status of the REF and TEST signals is also the leading status of FILTER_IN and FILTER_OUT signals. The comparison of the phases is performed using a phase detector. If the phase of the REF signal leads the phase of the TEST signal, UP pulses are generated. Conversely, if the phase of the REF lags the phase of the TEST signal, DN (which means &#x201c;down&#x201d;) pulses are generated. A calibration control bit generator then generates calibration control bits according to the UP pulses and DN pulses.</p>
<p id="p-0022" num="0021">A finite state machine (FSM) then, according to the calibration control bits, generates a capacitor code (CAP_CODE) for controlling the capacitor bank CPB in the BPF (which may further be located in the IF chain, please refer to <figref idref="DRAWINGS">FIGS. 1 and 2</figref>). The loop/iteration as shown in <figref idref="DRAWINGS">FIG. 3</figref> is repeated so that the CAP_CODE may be changed (or not changed) in each loop, until capacitor band CPB has a desirable capacitance, so that the FILTER_IN and the FILTER_OUT signals are in phase, as shown as waveforms FILTER_IN and FILTER_OUT, respectively, in <figref idref="DRAWINGS">FIG. 9</figref>. In each of the loop/iteration, the CAP_CODE is changed at most by 1, and may possibly be unchanged. When the FILTER_IN and the FILTER_OUT signals are in phase, the phase difference &#x3c6; is small enough and can be ignored. The CAP_CODE is thus not changed for a certain number of loops, and the calibration is stopped.</p>
<p id="p-0023" num="0022">The operation flow of the architecture may be shown in <figref idref="DRAWINGS">FIG. 4</figref>. In the beginning of the calibration, the CAP_CODE is set to a default value, which is between a minimum CAP_CODE (CODE_MIN) and a maximum CAP_CODE (CODE_MAX). CODE_MIN and CODE_MAX are determined by the physical structures of the capacitor bank CPB (refer to <figref idref="DRAWINGS">FIG. 2</figref>). The number of iterations of the process flow is also recorded as ITERATION. In each of the iterations, the phase difference &#x3c6; between REF and TEST signals is determined by the phase detector (refer to <figref idref="DRAWINGS">FIG. 3</figref>), and if &#x3c6; is a non-zero value, the CAP_CODE is changed (either increased or decreased) according to the sign (&#x201c;&#x3e;0&#x201d; or &#x201c;&#x3c;0&#x201d;) of phase difference &#x3c6; in order to shift the phase of the FILTER_OUT signal, so that phase difference &#x3c6; may be reduced. The sign of phase difference &#x3c6; also reflects the leading status of REF and TEST signals. In each iteration, the CAP_CODE is increased or decreased by one, or not changed. The operation flow stops either when the FILTER_IN and the FILTER_OUT signals are in phase, or a pre-set (maximum) number of iterations have been performed. In a possible scenario, the maximum number of iterations is reached if phase difference &#x3c6; swings back-and-forth between positive and negative values in consecutive iterations, which are also an indication that the calibration is finished.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 5</figref> illustrates an exemplary circuit block diagram implementing the architecture in <figref idref="DRAWINGS">FIG. 3</figref> and the operation flow in <figref idref="DRAWINGS">FIG. 4</figref>. The calibration circuit includes differential-to-single-ended signal converters D<b>2</b>S for converting the differential FILTER_IN and FILTER_OUT signals to single-ended digital signals REF and TEST, respectively. Phase detector PFD (also referred to as a phase frequency detector) comprises inputs for receiving REF and TEST signals, and is configured to compare the phases of signals REF and TEST. If the phase of the REF signal leads the phase of the TEST signal, pulses (referred to UP pulses hereinafter) are generated and outputted to register UP_REG through a first output, while no pulse is outputted to register DN_REG through a second output, or the pulses outputted to the second output have very short pulse widths. Conversely, if the phase of the REF lags the phase of the TEST signal, pulses (referred to DN pulses hereinafter) are generated and outputted to register DN_REG through the second output, while no pulse is outputted to register UP_REG through the first output, or the pulses outputted to the first output have very short pulse widths. The widths of the UP pulses and the DN pulses are compared with the delay time of delay cells D. If the widths of the UP pulses and the DN pulses are greater than the delay time of delay cells D, it is determined that phase difference &#x3c6; is great enough, and should not be ignored. Accordingly, the respective registers UP_REG and/or DN_REG will increase their register values. Otherwise, if the widths of the UP pulses and the DN pulses are smaller than the delay length of delay cells D, the respective UP and DN pulses are ignored, and the respective registers UP_REG or DN_REG will not change their values.</p>
<p id="p-0025" num="0024">Sync pulse generator SPG determines the time the values in registers UP_REG and DN_REG should be processed and cleared. Sync pulse generator SPG is operated by global clock CLK_GLOBAL, which has a lower frequency than the frequency of FILTER_IN signal. Accordingly, during one CLK_GLOBAL cycle, multiple cycles of comparisons may be performed by phase frequency detector PFD, and the values in each of registers UP_REG or DN_REG may be greater than one. The values in registers UP_REG and DN_REG are used to determine the values of calibration control bits INC_CAP and DEC_CAP. For example, if the value of register UP_REG is greater than a pre-determined value, calibration control bit INC_CAP (meaning &#x201c;increase the capacitor code&#x201d;) is set to 1, otherwise it is set to 0. If the value of register DN_REG is greater than the pre-determined value, calibration control bit DEC_CAP (meaning &#x201c;decrease the capacitor code&#x201d;) is set to 1, otherwise, it is set to 0. After calibration control bits INC_CAP and DEC_CAP are set, sync pulse generator SPG clears registers UP_REG and DN_REG.</p>
<p id="p-0026" num="0025">The calibration engine, as a part of the finite state machine FSM (refer to <figref idref="DRAWINGS">FIG. 3</figref>), determines the CAP_CODE based on the value of calibration control bits INC_CAP and DEC_CAP. The calibration engine is driven by frequency divider FD, which may generate a clock with a frequency a half of the frequency of CLK_GLOBAL. In an embodiment, if calibration control bit INC_CAP is 1, the calibration engine increases the previous CAP_CODE by 1, and sends the new CAP_CODE to the IF chain. If calibration control bit DEC_CAP is 1, the calibration engine decreases the previous CAP_CODE by 1, and sends the new CAP_CODE to the IF chain. Accordingly, the capacitor bank CPB (<figref idref="DRAWINGS">FIG. 2</figref>) in filter BPF (<figref idref="DRAWINGS">FIG. 1</figref>) of the IF chain is calibrated according to the received CAP_CODE, and the phase of the FILTER_OUT signal is advanced or pulled back. If calibration control bits INC_CAP and DEC_CAP have equal values, the CAP_CODE is kept unchanged. After the CAP_CODE is sent to the IF chain, a new loop of calibration may be performed, and the loops may be repeated.</p>
<p id="p-0027" num="0026">The calibration check unit, which is also a part of the FSM as in <figref idref="DRAWINGS">FIG. 3</figref>, is used to check whether the calibration has finished or not. The calibration check unit checks the values of calibration control bits INC_CAP and DEC_CAP, and if these values are not changed in a pre-determined (for example, 4) loops of CAP_CODE determination process, the calibration check unit sends a signal to unit CALLOG, which sets signal &#x201c;Do-Cal&#x201d; to &#x201c;false&#x201d; to stop local clock signal CLK_LOCAL, and the calibration is stopped. In other words, if the calibration engine sends out the same CAP_CODE for more than four times, it is determined that the calibration is successful, and the calibration will be stopped.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIGS. 6 and 7</figref> are exemplary simulated signals obtained from the circuit shown in <figref idref="DRAWINGS">FIG. 5</figref>, wherein the REF, TEST, UP pulses, and the DN pulses are illustrated. <figref idref="DRAWINGS">FIG. 6</figref> illustrates the pre-calibration results. It is observed that the REF signal lags the TEST signal (the corresponding FILTER_IN and FILTER_OUT signals are shown in <figref idref="DRAWINGS">FIG. 8</figref>). The DN pulses are thus generated, whose pulse widths are greater than the delay time of delay cells D in <figref idref="DRAWINGS">FIG. 4</figref>. The UP pulses, if any, have very narrow pulses, and hence are ignored. After the calibration, as shown in <figref idref="DRAWINGS">FIG. 7</figref>, the REF signal and the TEST signal are in phase (the corresponding FILTER_IN and FILTER_OUT signal are shown in <figref idref="DRAWINGS">FIG. 9</figref>). After the calibration, as shown in <figref idref="DRAWINGS">FIG. 7</figref>, both UP and DN pulses that are generated in subsequent loops have very narrow widths, and will be ignored.</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIGS. 10 and 11</figref> illustrate the AC responses of sample BPFs as shown in <figref idref="DRAWINGS">FIG. 2</figref>. In <figref idref="DRAWINGS">FIG. 10</figref>, a plurality of AC responses corresponding to BPFs at different process corners (fast-fast (FF) corners, slow-slow (SS) corners, and typical-typical (TT) corners) and different temperatures (&#x2212;40&#xb0;, 85&#xb0; C., and 120&#xb0; C.) are illustrated. The process corners and the temperatures are marked for the respective AC responses. It is observed that the process variations and temperature variations may cause the AC responses to be significantly shifted relative to each other. However, after the calibration using the embodiments, as shown in <figref idref="DRAWINGS">FIG. 11</figref>, the AC responses of the BPFs may all be calibrated to substantially overlap each other, although the individual AC responses are not marked. It is observed that for different BPFs at different process corners and different temperatures, when the calibrations are finished, the respective CAP_CODEs may be different.</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 12</figref> illustrates alternative embodiments that are similar to the embodiments shown in <figref idref="DRAWINGS">FIG. 4</figref>, except the UP and DN pulses are processed differently to generate calibration control bits INC_CAP and DEC_CAP. In these embodiments, counters are used to count the numbers of UP pulses and DN pulses. However, the width of the UP pulses and DN pulses are not measured, and the counters count the UP pulses and DN pulses even if they are narrow pulses. A decoder is then used to compare the numbers of the UP pulses and the DN pulses. If the number of the UP pulses is greater than the number of DN pulses, calibration control bit INC_CAP is set to 1. Otherwise, if the number of the DN pulses is greater than the number of UP pulses, calibration control bit DEC_CAP is set to 1. If the number of the DN pulses is substantially equal to the number of UP pulses, both calibration control bits INC_CAP and DEC_CAP are set to zero. The operation of remaining components of the circuit is essentially the same as shown in <figref idref="DRAWINGS">FIG. 4</figref>, and hence is not discussed herein.</p>
<p id="p-0031" num="0030">Since the calibration is performed in-situ and is performed directly to the capacitor bank in the core filter that is to be calibrated, and no external capacitor bank is used, there is no intra-die mismatch that will cause mis-calibration. Further, since the calibration is performed using phase comparison rather than the conventional voltage-level comparison, the calibration is more robust and accurate. The power consumption is low since the calibration circuit is stopped after the calibration is finished. Furthermore, the calibration scheme may be adopted for many kinds of filter applications.</p>
<p id="p-0032" num="0031">In accordance with an embodiment, a method of calibrating a filter includes providing the filter having a capacitor; applying an input signal into the filter to generate an output signal, measuring a phase difference between the input signal and the output signal; determining a leading/lagging status of the phase difference; calculating a CAP_CODE using the leading/lagging status; and calibrating the capacitor using the CAP_CODE.</p>
<p id="p-0033" num="0032">In accordance with other embodiments, a method of calibrating a filter includes providing the filter including a capacitor bank configured to be operated by a CAP_CODE; inputting a differential input signal into the filter to generate a differential output signal; converting the differential input signal to a reference signal, with the reference signal being single ended; converting the differential output signal to a test signal, with the test signal being single ended; measuring a phase difference between the reference signal and the test signal; and calibrating the capacitor bank in response to the phase difference.</p>
<p id="p-0034" num="0033">In accordance with yet other embodiments, a method of calibrating a filter includes providing the filter including a capacitor bank configured to be operated by a CAP_CODE; inputting a differential input signal into the filter to generate a differential output signal; converting the differential input signal to a reference signal, with the reference signal being single ended; converting the differential output signal to a test signal, with the test signal being single ended; comparing the reference signal with the test signal using a phase detector; and outputting pulses to a first and a second output of a phase detector in response to a phase difference of the reference signal and the test signal. The method further includes determining calibration control bits from the pulses; calculating the CAP_CODE using the calibration control bits; and calibrating the capacitor bank in response to the CAP_CODE.</p>
<p id="p-0035" num="0034">In accordance with yet other embodiments, a circuit for calibrating a capacitor in a filter includes a phase detector including a first and a second output, wherein the phase detector is configured to receive an input signal of the filter and an output signal out of the filter; and a calibration control bit generator including inputs coupled to the first and the second outputs of the phase detector. The calibration control bit generator is configured to generate calibration control bits in response to a leading status of the input signal and the output signal. The circuit further includes a CAP_CODE generator including inputs coupled to outputs of the calibration control bit generator, and an output coupled to the capacitor of the filter.</p>
<p id="p-0036" num="0035">In accordance with yet other embodiments, a circuit for calibrating a capacitor in a filter includes a phase detector having a first and a second output, wherein the phase detector is configured to receive an input signal of the filter and an output signal of the filter, and output pulses to different ones of the first and the second outputs in response to a leading status of phases of the input and the output signals. The circuit further includes a first delay cell having an input coupled to the first output of the phase detector; a first register having a first input coupled to the first output of the phase detector, a second input coupled to an output of the first delay cell, and an output; a second delay cell having an input coupled to the second output of the phase detector; a second register having a first input coupled to the second output of the phase detector, a second input coupled to an output of the second delay cell, and an output; and an FSM including a first input coupled to the output of the first register, a second input coupled to the output of the second register, and an output coupled to the capacitor of the filter</p>
<p id="p-0037" num="0036">Although the embodiments and their advantages have been described in detail, it should be understood that various changes, substitutions and alterations can be made herein without departing from the spirit and scope of the embodiments as defined by the appended claims. Moreover, the scope of the present application is not intended to be limited to the particular embodiments of the process, machine, manufacture, and composition of matter, means, methods and steps described in the specification. As one of ordinary skill in the art will readily appreciate from the disclosure, processes, machines, manufacture, compositions of matter, means, methods, or steps, presently existing or later to be developed, that perform substantially the same function or achieve substantially the same result as the corresponding embodiments described herein may be utilized according to the disclosure. Accordingly, the appended claims are intended to include within their scope such processes, machines, manufacture, compositions of matter, means, methods, or steps. In addition, each claim constitutes a separate embodiment, and the combination of various claims and embodiments are within the scope of the disclosure.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method of calibrating a filter, the method comprising:
<claim-text>applying an input signal into the filter to generate an output signal, wherein the input signal and the output signal have a same frequency, and wherein the input signal is a first differential signal comprising a first pair of complementary signals, and the output signal is a second differential signal comprising a second pair of complementary signals;</claim-text>
<claim-text>measuring a phase difference between the input signal and the output signal, wherein the measuring comprises:
<claim-text>converting the input signal from the first differential signal to a first single-ended digital signal;</claim-text>
<claim-text>converting the output signal from the second differential signal to a second single-ended digital signal;</claim-text>
<claim-text>comparing the first and the second single-ended digital signals to determine the phase difference using a phase detector; and</claim-text>
<claim-text>outputting pulses to a first and a second output of the phase detector in response to the phase difference;</claim-text>
</claim-text>
<claim-text>determining a leading/lagging status of the phase difference;</claim-text>
<claim-text>calculating a capacitor code (CAP_CODE) using the leading/lagging status, wherein the leading/lagging status indicates which of the input signal and the output signal leads another one of the input signal and the output signal in phase; and</claim-text>
<claim-text>calibrating the capacitor using the CAP_CODE.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the filter is a bandpass filter of a receiver.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the bandpass filter is a part of an intermediate frequency chain of the receiver.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising repeating the steps starting from the step of inputting the input signal and ending at the step of calibrating the capacitor.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00004">claim 4</claim-ref> further comprising, for each of the steps of repeating, recording a respective CAP_CODE, and stopping calibrating the filter when the CAP_CODE does not change in a consecutive sequence of the steps of repeating.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising:
<claim-text>accumulating a first register for the pulses outputted from the first output of the phase detector and having pulse widths greater than a pre-determined delay time; and</claim-text>
<claim-text>accumulating a second register for the pulses outputted from the second output of the phase detector and having pulse widths greater than the pre-determined delay time, wherein the CAP_CODE is calculated using values in the first and the second registers.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising:
<claim-text>setting a first calibration control bit to 1 when a number of the pulses outputted from the first output of the phase detector is greater than a number of the pulses outputted from the second output of the phase detector;</claim-text>
<claim-text>setting a second calibration control bit to 1 when a number of the pulses outputted from the second output of the phase detector is greater than a number of the pulses outputted from the first output of the phase detector; and</claim-text>
<claim-text>setting both the first and the second calibration control bits to 0 when a number of the pulses from the first output of the phase detector is equal to a number of the pulses from the second output of the phase detector, wherein values of the first and the second calibration control bits are used in the step of calculating the CAP_CODE.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. A method of calibrating a filter, the method comprising:
<claim-text>providing the filter comprising a capacitor bank configured to be operated by a capacitor code (CAP_CODE);</claim-text>
<claim-text>inputting a differential input signal into the filter to generate a differential output signal;</claim-text>
<claim-text>converting the differential input signal to a reference signal, with the reference signal being single ended;</claim-text>
<claim-text>converting the differential output signal to a test signal, with the test signal being single ended;</claim-text>
<claim-text>measuring a phase difference between the reference signal and the test signal; and</claim-text>
<claim-text>calibrating the capacitor bank in response to the phase difference.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref> further comprising:
<claim-text>increasing the CAP_CODE when the reference signal leads the test signal in phase;</claim-text>
<claim-text>decreasing the CAP_CODE when the reference signal lags the test signal in phase; and</claim-text>
<claim-text>keeping the CAP_CODE unchanged when there is substantially no phase difference between the reference signal and the test signal. </claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
