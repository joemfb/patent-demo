<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08625407-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08625407</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12881329</doc-number>
<date>20100914</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>600</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>01</class>
<subclass>R</subclass>
<main-group>31</main-group>
<subgroup>08</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>370218</main-classification>
<further-classification>370318</further-classification>
</classification-national>
<invention-title id="d2e53">Highly available virtual packet network device</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5675807</doc-number>
<kind>A</kind>
<name>Iswandhi et al.</name>
<date>19971000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710260</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5754865</doc-number>
<kind>A</kind>
<name>Itskin et al.</name>
<date>19980500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710241</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6252878</doc-number>
<kind>B1</kind>
<name>Locklear et al.</name>
<date>20010600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370401</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6574477</doc-number>
<kind>B1</kind>
<name>Rathunde</name>
<date>20030600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455453</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6751191</doc-number>
<kind>B1</kind>
<name>Kanekar et al.</name>
<date>20040600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370217</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>7236453</doc-number>
<kind>B2</kind>
<name>Visser et al.</name>
<date>20070600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370219</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>7518986</doc-number>
<kind>B1</kind>
<name>Chadalavada et al.</name>
<date>20090400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370218</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>7545757</doc-number>
<kind>B2</kind>
<name>Di Benedetto et al.</name>
<date>20090600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370256</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>7940650</doc-number>
<kind>B1</kind>
<name>Sandhir et al.</name>
<date>20110500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370219</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>8345536</doc-number>
<kind>B1</kind>
<name>Rao et al.</name>
<date>20130100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370216</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2002/0029301</doc-number>
<kind>A1</kind>
<name>Toda</name>
<date>20020300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709319</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2002/0032850</doc-number>
<kind>A1</kind>
<name>Kauffman</name>
<date>20020300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>712 31</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>2002/0097672</doc-number>
<kind>A1</kind>
<name>Barbas et al.</name>
<date>20020700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370216</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>2003/0037165</doc-number>
<kind>A1</kind>
<name>Shinomiya</name>
<date>20030200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709238</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>2003/0120915</doc-number>
<kind>A1</kind>
<name>Kleinsteiber et al.</name>
<date>20030600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713153</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>2003/0163692</doc-number>
<kind>A1</kind>
<name>Kleinsteiber et al.</name>
<date>20030800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713169</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>2003/0179532</doc-number>
<kind>A1</kind>
<name>Goergen</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>361118</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>2003/0189936</doc-number>
<kind>A1</kind>
<name>Terrell et al.</name>
<date>20031000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>37039531</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>2004/0223504</doc-number>
<kind>A1</kind>
<name>Wybenga et al.</name>
<date>20041100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370412</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00020">
<document-id>
<country>US</country>
<doc-number>2005/0013308</doc-number>
<kind>A1</kind>
<name>Wybenga et al.</name>
<date>20050100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370396</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00021">
<document-id>
<country>US</country>
<doc-number>2005/0074003</doc-number>
<kind>A1</kind>
<name>Ball et al.</name>
<date>20050400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370389</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00022">
<document-id>
<country>US</country>
<doc-number>2005/0111445</doc-number>
<kind>A1</kind>
<name>Wybenga et al.</name>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370389</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00023">
<document-id>
<country>US</country>
<doc-number>2005/0135357</doc-number>
<kind>A1</kind>
<name>Riegel et al.</name>
<date>20050600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370389</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00024">
<document-id>
<country>US</country>
<doc-number>2005/0169193</doc-number>
<kind>A1</kind>
<name>Black et al.</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370254</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00025">
<document-id>
<country>US</country>
<doc-number>2005/0249113</doc-number>
<kind>A1</kind>
<name>Kobayashi et al.</name>
<date>20051100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370219</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00026">
<document-id>
<country>US</country>
<doc-number>2007/0070919</doc-number>
<kind>A1</kind>
<name>Tanaka et al.</name>
<date>20070300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370254</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00027">
<document-id>
<country>US</country>
<doc-number>2008/0068986</doc-number>
<kind>A1</kind>
<name>Maranhao et al.</name>
<date>20080300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370220</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00028">
<document-id>
<country>US</country>
<doc-number>2008/0147866</doc-number>
<kind>A1</kind>
<name>Stolorz et al.</name>
<date>20080600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709226</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00029">
<document-id>
<country>US</country>
<doc-number>2008/0285248</doc-number>
<kind>A1</kind>
<name>Goergen</name>
<date>20081100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>361788</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00030">
<document-id>
<country>US</country>
<doc-number>2009/0034728</doc-number>
<kind>A1</kind>
<name>Goergen et al.</name>
<date>20090200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>380268</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00031">
<document-id>
<country>US</country>
<doc-number>2009/0037998</doc-number>
<kind>A1</kind>
<name>Adhya et al.</name>
<date>20090200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 11</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00032">
<document-id>
<country>US</country>
<doc-number>2009/0257440</doc-number>
<kind>A1</kind>
<name>Yan et al.</name>
<date>20091000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370401</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00033">
<document-id>
<country>US</country>
<doc-number>2009/0259741</doc-number>
<kind>A1</kind>
<name>Shen et al.</name>
<date>20091000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709223</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00034">
<document-id>
<country>US</country>
<doc-number>2009/0268748</doc-number>
<kind>A1</kind>
<name>Ghaibeh et al.</name>
<date>20091000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370419</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00035">
<document-id>
<country>US</country>
<doc-number>2009/0303902</doc-number>
<kind>A1</kind>
<name>Liu et al.</name>
<date>20091200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370254</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00036">
<document-id>
<country>US</country>
<doc-number>2010/0182926</doc-number>
<kind>A1</kind>
<name>Kubota</name>
<date>20100700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370252</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00037">
<document-id>
<country>US</country>
<doc-number>2010/0318831</doc-number>
<kind>A1</kind>
<name>Scott et al.</name>
<date>20101200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713600</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00038">
<document-id>
<country>US</country>
<doc-number>2011/0066753</doc-number>
<kind>A1</kind>
<name>Wang et al.</name>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709238</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00039">
<document-id>
<country>US</country>
<doc-number>2011/0154471</doc-number>
<kind>A1</kind>
<name>Anderson et al.</name>
<date>20110600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 11</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00040">
<document-id>
<country>US</country>
<doc-number>2011/0228779</doc-number>
<kind>A1</kind>
<name>Goergen</name>
<date>20110900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370392</main-classification></classification-national>
</us-citation>
</us-references-cited>
<number-of-claims>17</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>None</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>10</number-of-drawing-sheets>
<number-of-figures>12</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20120063299</doc-number>
<kind>A1</kind>
<date>20120315</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Narasimhan</last-name>
<first-name>Janardhanan P.</first-name>
<address>
<city>Chennai</city>
<country>IN</country>
</address>
</addressbook>
<residence>
<country>IN</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Agrawal</last-name>
<first-name>Sanjeev</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Nandakumaran</last-name>
<first-name>Purushothaman</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="004" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Joseph</last-name>
<first-name>Joyas</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Narasimhan</last-name>
<first-name>Janardhanan P.</first-name>
<address>
<city>Chennai</city>
<country>IN</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Agrawal</last-name>
<first-name>Sanjeev</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Nandakumaran</last-name>
<first-name>Purushothaman</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="004" designation="us-only">
<addressbook>
<last-name>Joseph</last-name>
<first-name>Joyas</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Haynes and Boone, LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Force10 Networks, Inc.</orgname>
<role>02</role>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Moore</last-name>
<first-name>Ian N</first-name>
<department>2469</department>
</primary-examiner>
<assistant-examiner>
<last-name>Huynh</last-name>
<first-name>Dung B</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A virtual chassis includes two or more physical chassis and operates as a single, logical device. Each of the two or more physical chassis include two route processor modules (RPM) and each RPM is assigned a first and a second role within the virtual chassis. The first role is a physical chassis level role and the second role is a virtual chassis level role. The RPMs operate in coordination such that the failure of any one of the RPMs results in one or more other RPMs taking over the first and second roles of the failed RPM.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="102.62mm" wi="202.78mm" file="US08625407-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="193.55mm" wi="170.43mm" file="US08625407-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="190.33mm" wi="160.87mm" file="US08625407-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="195.41mm" wi="180.68mm" file="US08625407-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="248.67mm" wi="182.63mm" file="US08625407-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="233.93mm" wi="191.01mm" file="US08625407-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="256.37mm" wi="194.82mm" file="US08625407-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="246.72mm" wi="200.58mm" file="US08625407-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="230.72mm" wi="192.87mm" file="US08625407-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="255.69mm" wi="204.39mm" file="US08625407-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="255.69mm" wi="211.50mm" file="US08625407-20140107-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND</heading>
<p id="p-0002" num="0001">1. Field of the Invention</p>
<p id="p-0003" num="0002">The present disclosure relates generally to packet network devices such as switches and routers, and more particularly to a virtual packet network device architecture that recovers from the failure of any single route processor module without the loss of the network device functionality.</p>
<p id="p-0004" num="0003">2. Description of Related Art</p>
<p id="p-0005" num="0004">Packet network devices direct data packets traveling across a network between data sources and destinations. Packet network devices can perform &#x201c;routing&#x201d; or &#x201c;switching&#x201d; depending on the header information and networking techniques used to direct the data packets and a single packet network device may be configured to perform both switching and routing. Such devices are referred to herein as a &#x201c;packet switch&#x201d; with the understanding that this term encompasses a wide variety of packet forwarding capabilities.</p>
<p id="p-0006" num="0005"><figref idref="DRAWINGS">FIG. 1A</figref> is a high-level block diagram of an exemplary packet switch <b>100</b>. The switch comprises some number of line cards (LC), LC<b>1</b>-LCn, one or more switch fabric cards (SF), and one route processor module (RPM) <b>110</b>. Each line card LC receives ingress data traffic from and transmits egress data traffic over network links to peer devices through bi-directional ports. The ports can be configured for different electrical or optical media via the use of different line card types, different port interface modules, and/or different pluggable optics modules.</p>
<p id="p-0007" num="0006">Continuing to refer to <figref idref="DRAWINGS">FIG. 1A</figref>, for most ingress packet traffic on each line card LC, a line card packet processor examines a packet, determines one or more switch egress ports for the packet, and queues the packet for transmission through the switch fabric when possible. For most egress packet traffic on each line card LC, the line card queues the packets arriving from the switch fabric, and selects packets from the queues and serves them fairly to the egress ports. Each LC includes memory that is used to store lookup tables that a packet processor accesses to determine what operations to perform on each packet, as well as the next hop destination for each packet. Each LC also includes a line card processor (LCP) which can be a general purpose processor that handles control plane operations for the line card. Control plane operations include programming lookup memory according to instructions from the RPM, programming registers on the packet processor that tailor the line card behavior, receiving control plane packets (packets addressed to switch <b>100</b>, e.g., for various routing/switching protocols) from the packet processor, and transmitting control plane packets (packets generated by switch <b>100</b> for communication to a peer device) to the packet processor for forwarding out an external port. The LCP may implement some control plane functionality for some protocols handled by switch <b>100</b>.</p>
<p id="p-0008" num="0007">The LCP in <figref idref="DRAWINGS">FIG. 1A</figref> also connects to the RMP over an inter-process communication (IPC) bus. The RPM uses the IPC bus to communicate with the LCP in order to boot the line cards, monitor the health of the line card and its environmental parameters, manage power for the line card and its components, and perform basic hardware configuration for the line card. The switch fabric (SF) can be comprised of one or more modules each of which are generally identical in a system. The switch fabric (SF) provides serdes interfaces for each line card and a parallel crossbar switch that can switch any of the inputs to any number of the outputs.</p>
<p id="p-0009" num="0008">The route processing module (RPM) <b>110</b> shown in <figref idref="DRAWINGS">FIG. 1A</figref> controls all aspects of the overall operation of the chassis. <figref idref="DRAWINGS">FIG. 1B</figref> illustrates the functionality of the RPM <b>110</b> of <figref idref="DRAWINGS">FIG. 1A</figref> in more detail. The RPM in <figref idref="DRAWINGS">FIG. 1B</figref> can be comprised of three processors: a control processor CP, which controls the overall operation of the switch; and two route processors RP.0, RP.1, which run different routing/switching protocols, communicate with external peers, and program the line cards to perform correct routing and switching. In this case, the CP can be dedicated to running certain management functions such as user interface management, system chassis management, system configuration management and management of system security to name only a few functions. RP.0 can be dedicated to running layer 3 routing protocols such as the border gateway protocol (BGP), the open shortest path first (OSPF) protocol, routing information protocol (RIP) to name just a few, and RP.1 can be dedicated to running layer 2 switching protocols such as the Internet group management protocol (IGMP), address resolution protocol (ARP), spanning tree protocol (STP) and the virtual router redundancy protocol (VRRP) to name just a few. The routing protocols running on RP.0 generally send messages to and receive messages from the surrounding network devices in order to learn certain information about these devices and their relationship to the network. This information can include their IP address, distance information, link attributes, group membership information to name only a few. The switching protocols running on RP.1 generally gather information from the packets being processed by the host device, which in this case is the router <b>100</b>. This information can include the MAC address and the port I.D. of another network device. The information received by the protocols running on RP.0 and RP.1 can be used to derive the shortest path from the host network device to another, neighboring network device or to calculated the distance between two network devices, to calculate a next hop address for instance or spanning trees and other information used to construct and maintain layer 2 switching tables and layer 3 routing tables. The switching table and routing table information is then made available to the line card control processors which use this information to update forwarding tables which are used by the packet processors to process packets or frames of information arriving at the router <b>100</b>. The processes that are employed to build and maintain routing and switching tables on the RPMs and to build and maintain lookup tables on each of the LCs will not be described here, as these processes are well known to those skilled in packet network device design. Although the RPM <b>110</b> is described above as being comprised of three processors, CP, RP.0 and RP.1, all of the functionality included in the three processors can be included in one processor or two or more processors. The number of processors employed to implement this functionality is not important.</p>
<p id="p-0010" num="0009">In order to provide a higher degree of availability than the switch <b>100</b> described with reference to <figref idref="DRAWINGS">FIG. 1A</figref>, some packet network devices are designed to include two route processor modules. <figref idref="DRAWINGS">FIG. 2</figref> illustrates such a packet network device that includes two route processor modules, RPM.1 and RPM.2. Each of the RPMs in <figref idref="DRAWINGS">FIG. 2</figref> can include all of the functionality of the RPM described with reference to <figref idref="DRAWINGS">FIG. 1A</figref> and generally operate to control all aspects of the overall operation of the chassis. When two RPMs are present, one is designated as the master, and the other remains on standby (warm or cold standby) and only the master operates to control the functionality of the switch. The standby RPM monitors the health of the master, and takes over as master should the first fail. As described earlier with reference to <figref idref="DRAWINGS">FIG. 1A</figref>, each RPM comprises three processors: a control processor CP, which controls the overall operation of the switch; and two route processors RP.0, RP.1, which run different routing/switching protocols.</p>
<p id="p-0011" num="0010">As described above with reference to <figref idref="DRAWINGS">FIGS. 1A and 2</figref>, a single packet switch/router can only support a finite number of line cards and ports. In order to provide a switching platform with a larger number of ports, some vendors have designed special link cards or a &#x201c;back-end&#x201d; port that can be used to connect two separate switches together to form a system that in at least some ways acts with peer devices like a single larger chassis. Such an arrangement of stacked switches is described in the background section of U.S. patent publication no. 2009/0268748. <figref idref="DRAWINGS">FIG. 3</figref> shows such a stacked switch arrangement that includes two switches, S.1 and S.2 connected together to operate as a single, logical device. Typically, stacked switches operate such that one switch is designated to be the master switch and operates to run all of the layer-2 switching and layer-3 routing protocols and the other switch operates as a slave. The master device also operates to update the forwarding tables included in the other slave devices connected in the stacked arrangement. However, in the event that the master switch/device fails, the entire stacked chassis can become inoperable. In order to mitigate this problem, some vendors have designated one switch or device to be a primary master device and the other slave devices in the stack to be designated as secondary or backup master devices. Using this arrangement, in the event that the primary master device in the stack fails, the secondary master device is able to take over all of the functionality performed by the primary master prior to its failure, however, all of the functionality of the failed master device is lost.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0002" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 1A</figref> is a block diagram showing functionality comprising a packet network device <b>100</b>.</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 1B</figref> is a block diagram showing functionality comprising a route processor module <b>110</b>.</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram showing functionality comprising a highly available router <b>200</b>.</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram showing functionality comprising a stacked chassis <b>300</b>.</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram showing functionality comprising a virtual chassis <b>400</b>.</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram showing functionality comprising a virtual chassis <b>500</b>.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 6A</figref> is a logical flow diagram of a first phase of an RPM role election process.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 6B</figref> is a logical flow diagram of a second phase of an RPM role election process.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIGS. 7A and 7B</figref> illustrates one scenario in which RPM roles change as the result of an RPM failure.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIGS. 8A and 8B</figref> illustrate another scenario in which RPM roles change as the result of an RPM failure.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0003" level="1">SUMMARY</heading>
<p id="p-0022" num="0021">While the switch including two RPMs described with reference to <figref idref="DRAWINGS">FIG. 2</figref> does provide a single switch with an improved level of availability, such as switch has a limited port count, and while the stacked chassis arrangement described with reference to <figref idref="DRAWINGS">FIG. 3</figref> does provide a higher number of input/output ports in a single logical chassis, in the event that one of the chassis in the stack fails, all of the ports associated with the chassis are no longer available to the logical chassis. Therefore, it would be beneficial if a single, logical chassis both included a high number of ports and the failure of any one chassis in the single, logical chassis did not result in the reduction of the number of ports available to forward network traffic.</p>
<p id="p-0023" num="0022">In one embodiment, a virtual packet network device includes two or more separate physical chassis connected in a stacking relationship, and each of the physical chassis include two route processor modules, and each of the route processing included in the virtual packet network device as assigned first and second logical roles, wherein the first logical role is a physical chassis level role and the second logical role is a virtual chassis level role, and the route processor modules operate in cooperation to respond to the failure of any single route processor module to take over the logical roles assigned to the failed route processor module without the loss of functionality of the virtual packet network device.</p>
<heading id="h-0004" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0024" num="0023">The embodiments described below take a novel approach by creating a single, logical, highly available chassis arrangement. <figref idref="DRAWINGS">FIG. 4</figref> is a block diagram of a representative embodiment of a single, logical packet network device (virtual chassis/packet network device) comprised of two separate physical packet network devices/chassis S.1 and S.2, with each of the physical chassis including two RPMs for a total of four RPMs, RPM.1-RPM.4. Several well known methods exist for stacking multiple individual switches so that they operate as a single, logical chassis. One method employs special stacking ports in each physical chassis that are connected via a special stacking cable, another chassis stacking method employs regular ingress/egress ports and special purpose hardware to implement a stacked chassis and yet another method employs regular ingress/egress ports and no special hardware to implement a stacked chassis. Several of these methods for stacking multiple individual chassis are described in U.S. patent publication number 2009/0268748, the entire contents of which are incorporated herein by reference. Regardless of the method employed to stack chassis, the ultimate goal of doing so remains increasing the number of ports available on a single, logical or virtual chassis to route network traffic.</p>
<p id="p-0025" num="0024">As described above, the embodiment of a virtual chassis <b>400</b> in <figref idref="DRAWINGS">FIG. 4</figref>, is comprised of two separate physical chassis and each physical chassis can be either a switch or a router. For the purpose of this description, a physical chassis is referred to herein as a switch. Both of the switches S.1 and S.2 are members of a single, logical or virtual chassis <b>400</b> and the switches are connected to each other by a stacking connection <b>401</b>. Each switch also includes, among other things, two RPMs which can communicate with each other over an inter-process communication (IPC) bus. S.1 includes RPM.1 and RPM.2 and S.2 includes RPM.3 and RPM.4. Each switch on the virtual chassis <b>400</b> includes one or more line cards (LC) each of which includes a plurality of &#x201c;front-end&#x201d; ingress/egress ports, and each such port provides a connection available for linking the switch to a peer device or endpoint in a network. Those skilled in the art will recognize that the number of line cards, ports on each line card, RPMs, switch fabrics, and bus structure shown in <figref idref="DRAWINGS">FIG. 4</figref> are but one among many possibilities for switch architectures that can be connected as a larger logical chassis according to an embodiment. It should be understood, that while the virtual chassis <b>400</b> is described in terms of including two switches, the virtual chassis can be configured with more than two switches.</p>
<p id="p-0026" num="0025">With continued reference to <figref idref="DRAWINGS">FIG. 4</figref>, some of the functionality associated with the operation of virtual chassis <b>400</b> is managed locally to the switches S.1 and S.2, such as programming the switching fabric, election of chassis roles with respect to each RPM in a physical chassis, controlling a switch fan speed, monitoring the presence of line cards in the chassis, and downloading of the firmware to the line card CPU, and some of the functionality associated with the operation of virtual chassis <b>400</b> is global; that is, this global functionality affects the overall operation of the virtual chassis, such as multicast group programming, forwarding table maintenance, election of stack roles with respect to the RPMs in the virtual chassis and line card insertion/removal notification.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 4</figref> illustrates one embodiment in which each RPM in both switches comprising the virtual chassis <b>400</b> can be assigned dual roles. This assignment of dual roles to each RPM permits both switches, S.1 and S.2 comprising the virtual chassis <b>400</b> to continue to operate in the presence of a failure of any single RPM without the loss of overall virtual chassis functionality. From one perspective, continuing to operate without the loss of chassis functionality can mean that the packet processing bandwidth of the virtual chassis does not drop in the event that any single RPM fails, or from another perspective it can mean that the number of ingress/egress ports available on the virtual chassis over which to receive and transmit data packets does not drop in the event that any single RPM fails. At any point in time during operation of the virtual chassis <b>400</b>, only one of the two RPMs included in each of the switches S.1 and S.2 of the virtual chassis <b>400</b> is assigned a managing role with respect to the local operation of the physical switch on which it is located. The other RPM included in the switch is maintained in a hot standby role and its state is maintained such that it is ready to transition to the chassis management role in the event that the current RPM assigned to the chassis management role fails. Further, only one of the RPMs in the virtual chassis <b>400</b> is designated, at any point in time, to be in the role of managing the overall operations of the virtual chassis in which it is located. The remaining RPMs in the virtual chassis can be designated to assume one or several standby roles and can be ready to assume management of the chassis in the event that the current chassis master RPM fails.</p>
<p id="p-0028" num="0027">Table 1 includes a listing of the roles that can be assigned to each of the RPMs, RPM.1-RPM.4, comprising the virtual chassis <b>400</b>.</p>
<p id="p-0029" num="0028">
<tables id="TABLE-US-00001" num="00001">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="2">
<colspec colname="1" colwidth="63pt" align="left"/>
<colspec colname="2" colwidth="154pt" align="left"/>
<thead>
<row>
<entry namest="1" nameend="2" rowsep="1">TABLE 1</entry>
</row>
<row>
<entry namest="1" nameend="2" align="center" rowsep="1"/>
</row>
<row>
<entry>Role</entry>
<entry>Function of Role in Virtual Chassis</entry>
</row>
<row>
<entry namest="1" nameend="2" align="center" rowsep="1"/>
</row>
</thead>
<tbody valign="top">
<row>
<entry>Chassis</entry>
<entry>Manages Local Resources, participates in stack</entry>
</row>
<row>
<entry>Master (CM)</entry>
<entry>election to determine stack master and roles</entry>
</row>
<row>
<entry/>
<entry>for all RPMs in chassis, synchronizes its</entry>
</row>
<row>
<entry/>
<entry>state with the chassis standby.</entry>
</row>
<row>
<entry>Chassis</entry>
<entry>Maintains synchronous state with CM, monitors</entry>
</row>
<row>
<entry>Standby (CS)</entry>
<entry>health of CM and transitions to CM role in</entry>
</row>
<row>
<entry/>
<entry>event of CM failure.</entry>
</row>
<row>
<entry>Stack</entry>
<entry>Runs virtual chassis control and management</entry>
</row>
<row>
<entry>Master (SM)</entry>
<entry>plane functions, programs tables on all LCs in</entry>
</row>
<row>
<entry/>
<entry>virtual chassis, synchronizes state with</entry>
</row>
<row>
<entry/>
<entry>standby, sends periodic health messages, comm.</entry>
</row>
<row>
<entry/>
<entry>with CM to manage chassis functions.</entry>
</row>
<row>
<entry>Stack</entry>
<entry>Synchronizes state with SM, monitors health</entry>
</row>
<row>
<entry>Standby (SS)</entry>
<entry>of SM</entry>
</row>
<row>
<entry>Stack</entry>
<entry>Transitions to SS if SS fails or if SS role</entry>
</row>
<row>
<entry>Associate (SA)</entry>
<entry>changes</entry>
</row>
<row>
<entry namest="1" nameend="2" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0030" num="0029">The RPM roles listed in Table 1 and other functionality that can be used in the role assignment process will now be described with reference to <figref idref="DRAWINGS">FIG. 5</figref>, which is a block diagram of an embodiment of a highly available virtual chassis <b>500</b>. Virtual chassis <b>500</b> is comprised of two physical switches, S.1 and S.2, connected together in a stacked configuration by a stacking connection through ingress/egress ports associated with line cards included in each switch. Each of the switches are comprised of two RPMs. Switch S.1 includes RPM.1 and RPM.2 which can communicate with each other over an IPC link, and switch S.2 includes RPM.3 and RPM.4 which can also communicate with each other over an IPC link. It should be understood that, for the purpose of this description, the virtual chassis <b>500</b> is shown to include two physical switches, but this is not a limitation of a virtual chassis configuration, and that the virtual chassis <b>500</b> can be configured to include more than two physical switches.</p>
<p id="p-0031" num="0030">All four of the RPMs, RPM.1-RPM.4, in both switches of the virtual chassis <b>500</b> of <figref idref="DRAWINGS">FIG. 5</figref> can include substantially the same functionality, and so only the functional elements of RPM.1 are described here. RPM.1 is shown to include a boot file, a configuration file and a roles module. The boot file includes routines that each RPM, RPM.1 in this case, initially accesses upon powering up the switch S.1 or upon inserting the route processing module, RPM.1, into the switch S.1 backplane (not shown). Each RPM runs routines included in the boot file to generally place the functional modules included in the switch (line cards, RPMs, power modules, switch fabric modules, etc.) into a state in which they can operate to perform functionality for which they are designed. The boot file also includes a routine that both RPMs in each switch run to discover the other RPM included in the switch and to determine which of the two RPMs included in the switch should assume the roles of chassis master and chassis standby. The configuration file can include information specific to each switch and to each RPM on each switch. Among other things, information comprising the configuration file is the user defined priority of each RPM and of each switch and the slot number of each RPM on each switch, the MAC address of each switch, the switch type or model number, the software version running on each switch and the unit number of each switch. The roles module includes routines that each RPM can run in order to perform the functionality included in each of the roles listed earlier in Table 1. The process employed to assign both switch level and stack level roles to each RPM comprising the virtual chassis <b>500</b> is described below with reference to <figref idref="DRAWINGS">FIG. 6</figref>.</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 6</figref> is a logical flow diagram of the process used to assign physical switch/chassis level roles and stack/virtual chassis level roles to each of the RPMs, RPM.1-RPM.4, comprising the two physical switches, S.1 and S.2, included in the virtual chassis <b>500</b> of <figref idref="DRAWINGS">FIG. 5</figref>. For the purpose of this description, an individual, physical switch and an individual, physical chassis are considered to be the same device. The chassis level roles can include the chassis master (CM) role and the chassis standby (CS) role, the stack level roles can include the stack master (SM) role, the stack standby (SS) role and the stack associate (SA) role, and the chassis and the stack level roles are assigned to RPMs in two sequential phases, where the first phase assigns the chassis level roles and the second phase assigns the stack level roles.</p>
<p id="p-0033" num="0032">Continuing to refer to <figref idref="DRAWINGS">FIG. 6A</figref>, in step <b>1</b> of the first phase of the role assignment process, each of the RPMs (referred to here as a first and second RPM) on switch S.1 and S.2 access and run a boot routine, which can be stored in memory on the RPM, to independently boot at the same time. In step <b>2</b>, the boot routine causes both the first and second RPMs on each switch to send a discovery message over the IPC bus, to the other RPM on the same switch. The discovery message includes, among other things, information stored in the configuration file described with reference to <figref idref="DRAWINGS">FIG. 5</figref> regarding their user defined priority within the switch. This user define priority can be their switch slot ID for instance. So, for example, the RPM with the lowest slot ID can be defined to be the higher priority RPM. In this case, S.1 and S.<b>3</b> can be placed into their respective switches into a slot with the lowest slot ID, and so are define to have the higher priority in their respective switches. In step <b>3</b>, both the first and second RPMs on each switch receive the discovery message sent by the other RPM in the switch, each RPM examines the user defined priority included in the message sent by the other RPM and compares this priority to the user defined priority included its configuration file. In step <b>4</b>, if the user defined priority of the first RPM is higher than the second RPM on each switch, then in step <b>5</b>, the first RPM on each switch assumes the role of chassis master (CM) and the second RPM on each switch assumes the role of chassis standby (CS), otherwise the second RPM assumes the CM role and the first RPM assumes the CS role.</p>
<p id="p-0034" num="0033">With continued reference to <figref idref="DRAWINGS">FIG. 6</figref>, after determining what their initial role is, in step <b>7</b>, the first and second RPMs on each switch, S.1 and S.2, accesses the appropriate routine in an RPM role module stored in RPM memory and proceeds to operate according to this role. According to the user defined RPM priorities in the virtual chassis <b>500</b> as described earlier, RPM.1 and RPM.3 will assume the role of chassis master, and RPM.2 and RPM.4 will assume the role of chassis standby. The chassis master is, among other things, generally responsible for the management of resources local to the switch in which it is located and for running certain processes. Local resources in this case are considered to be the switch fabric, line card image download and boot control, power/temperature measurement and management. The chassis master is also responsible for participating in election of the stack roles and is responsible for sending chassis state information to the chassis standby (CS) so that the CS can be maintained in a synchronous state with the CM. The chassis standby RPM is in a hot standby state and is, among other things, generally responsible for receiving state update information from the CM and, as will be described later with reference to a state diagram in <figref idref="DRAWINGS">FIG. 7</figref>, is responsible for monitoring the health of the CM. In this regard, the CS continually monitors the health of the CM by detecting periodic heart beat signals sent by the CM. In the event that a predetermined sequential number of such signals are not received, the CS determines that the CM has failed and transitions from the chassis standby role to the chassis master role.</p>
<p id="p-0035" num="0034">Referring now to <figref idref="DRAWINGS">FIG. 6B</figref>, the RPM role assignment process enters its second phase where the stack roles are assigned. Subsequent to the completion of the first phase of the process, in step <b>1</b> of the second phase of process, the chassis master (CM) accesses and runs a sub-routine stored in the roles module that initiates the stack master (SM) election portion of the process. In this case as RPM.1 and RPM.3 have been elected to the chassis master roles in their respective switches, each these RPMs accesses and runs the SM election sub-routine. In step <b>2</b>, RPM.1 and RPM.3 send a SM election message to each other which is comprised of user defined SM priority information included in the configuration file stored in memory in the respective RPM. Among other things, the information included in the SM election message can include the RPM Slot ID assigned to the RPM in the switch, the type of switch (model number) that the RPM is running on, the version of the software (Opsys) running on the switch, the unit number of the switch, a user defined switch priority and the MAC address of the switch, the presence/absence of CS and if present the RPM Slot ID of the CS. In step <b>3</b>, both RPM.1 and RPM.3, in this case, receive the SM election message from the other RPM (RPM.3 and RPM.1 respectively) and compare the SM priority information included in the message to SM priority information stored in a configuration file associated with each RPM. In step <b>4</b>, (assuming for the purpose of this description that RPM.1 is compared to be the RPM of the highest stack priority) if as the result of the comparison in step <b>3</b> it is determined that RPM.1 is of higher priority than RPM.3, then RPM.1 assumes the SM role and RPM.3 assumes the SS role. On the other hand if in step <b>3</b> it is determined that RPM.3 is the higher priority RPM, then in step <b>4</b> RPM.3 assumes the SM role and RPM.1 assumes the SS role.</p>
<p id="p-0036" num="0035">After the SM RPM is elected, it runs the stack role election routine in order to assign stack level roles to the remaining RPMs in the virtual chassis <b>500</b>. The remaining RPMs are assigned roles according to the following rules. If there is only one other CM in the virtual chassis, then it is assigned to be the SS. However, if there are more than two switches comprising the virtual chassis (in this case there are two or more CMs), then the CM with the highest user defined priority is assigned to be the SS. After the SS is assigned, then the remaining CM and all the CS are assigned the SA roles. It is the responsibility of the CM located on each chassis to inform the CS on the same chassis what role it should take. The CM also informs the CS (on the same chassis) of what role it is assigned.</p>
<p id="p-0037" num="0036">Continuing to refer to <figref idref="DRAWINGS">FIG. 6B</figref>, in step <b>7</b> each of the RPMs, RPM.1-RPM.4 accesses the appropriate routine in a RPM role module stored in the corresponding RPM memory and proceeds to operate according to this role.</p>
<p id="p-0038" num="0037">The RPM elected as SM in the second phase of the role assignment process of <figref idref="DRAWINGS">FIG. 6B</figref>, assumes responsibility for the overall management of the virtual chassis <b>500</b>. This can include such things as running all of the management protocols like telnet, SSH that allow the user to log in and configure switches comprising the virtual chassis <b>500</b>. RPM.1 can also be responsible for running all layer-2 and layer-3 control protocols such as the spanning tree protocol (STP), the open shortest path first (OSPF) protocol, the border gateway protocol (BGP) and also use the information accumulated as the result of running these protocols to build and maintain forwarding tables stored in line cards, for instance. More specifically, the SM periodically sends routing/switching table update messages to all of the LC CPUs on all of the other physical devices comprising the virtual chassis. The SM is also responsible for communicating its state (forward table information and other operational state information) information to the stack standby (SS) RPM so that the SS state is synchronized with the SM state in the event that the SM fails and the SS has to assume the SM role. The SM also operates to continually sense for a heart beat message from the SS, and in the event that the SS fails, select a SA to assume the SS role. The SA with the highest user defined priority, among the SAs in the virtual chassis is assigned to take over as new SS if the current SS fails. If the priorities of each SA are equal, then the one with the highest unit number is chosen. The SM also is responsible for sending information to the CM which the CM then uses to manage certain chassis specific resources (MGID for instance).</p>
<p id="p-0039" num="0038">The RPM that is assigned and assumes a stack standby (SS) role is responsible for receiving state update messages over the IPC from the SM and using the information in the messages to synchronize its state with that of the SM (hot standby). The SS also is responsible for detecting periodic heart beat messages sent by the SM, over the IPC bus or the stacking connections, and in the event that a pre-determined sequential number of the heart beat messages are not received, determining that the SM has failed and transition to the SM role.</p>
<p id="p-0040" num="0039">The SM also monitors the health of the SS by detecting a periodic heart beat message sent by the SS. If there is a failure of the SS, the SM initiates a new election which decides which of one or more SAs should transition to the SS role. Once the SA has transitioned to the SS role, the SM then synchronizes its full data base with the new SS, to bring it up to a state where it is fully a functional SS.</p>
<p id="p-0041" num="0040"><figref idref="DRAWINGS">FIGS. 7A and 7B</figref> and <b>8</b>A and <b>8</b>B are block diagrams of the virtual chassis <b>500</b> of <figref idref="DRAWINGS">FIG. 5</figref> illustrating the roles that each of the RPM can assume and the effect that a failure of one RPMs has on the state of the other RPMs in the virtual chassis. Referring first to <figref idref="DRAWINGS">FIG. 7A</figref>, as the result of the two phase role assignment process described with reference to <figref idref="DRAWINGS">FIGS. 6A and 6B</figref>, RPM.1 on switch S.1 of the virtual chassis <b>500</b> has assumed the CM and SM roles, and RPM.2 on switch S.1 has assumed the CS and SA roles. RPM.3 on switch S.2 of the virtual chassis <b>500</b> has assumed the CS and SA roles and RPM.4 on switch S.2 has assumed the CM and SS roles. <figref idref="DRAWINGS">FIG. 7A</figref> also shows that RPM.1 fails. This is indicated by the &#x201c;X&#x201d; superimposed over the block labeled RPM.1. In the event that RPM.2 (which is the CS in this case) on switch S.1 detects the cessation of a heart beat signal from RPM.1, and referring now to <figref idref="DRAWINGS">FIG. 7B</figref>, RPM.2 immediately transitions from its current roles (CS and SA) to the CM and SS roles (note that both of the roles that RPM.2 is assigned prior to the failure of RPM.1 change). Also, one of the two roles assigned to RPM.4 prior to the failure of RPM.1 also immediately transitions to a new role. That is, the SS role assigned to RPM.4 prior to the failure of RPM.1 transitions to the SM role subsequent to the failure of RPM.1, while the other role, that of CM, does not change. Subsequent to the failure of RPM.1, all of the roles assigned to all of the other RPMs comprising the virtual chassis <b>500</b> remain the same.</p>
<p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. 8A</figref> is an illustration of the virtual chassis <b>500</b> of <figref idref="DRAWINGS">FIG. 5</figref> showing that RPM.4 has failed. All of the roles assigned to each of the RPMs in <figref idref="DRAWINGS">FIG. 8A</figref> are the same as the roles were assigned to the RPMs in <figref idref="DRAWINGS">FIG. 7A</figref>, and so the roles assigned to these RPMs will not listed again here. Assuming that RPM.4 fails, as signified by the &#x201c;X&#x201d; superimposed over the block labeled RPM.4, and since RPM.4 was running as the CM for switch S.2 and also operating in the role of SS for the SM RPM.1 in switch S.1, RPM.3 in switch S.2 detects that RPM.4 has failed and both of the roles assigned to RPM <b>3</b> immediately transition to different roles, wherein the CS role transitions to the CM role and the SA role transitions to the SS role. In this scenario, no other roles on any of the other RPMs in the virtual chassis <b>500</b> change.</p>
<p id="p-0043" num="0042">Operating in this manner, the virtual chassis <b>500</b> can easily tolerate the failure of one RPM on any of the switches comprising the virtual chassis <b>500</b> with only the temporary loss of overall virtual chassis functionality. Indeed, virtual chassis functionality is only lost during the time it takes for the roles running on an operating RPM to transition to take over the roles that were running on the failed RPM.</p>
<p id="p-0044" num="0043">The forgoing description, for purposes of explanation, used specific nomenclature to provide a thorough understanding of the invention. However, it will be apparent to one skilled in the art that specific details are not required in order to practice the invention. Thus, the forgoing descriptions of specific embodiments of the invention are presented for purposes of illustration and description. They are not intended to be exhaustive or to limit the invention to the precise forms disclosed; obviously, many modifications and variations are possible in view of the above teachings. The embodiments were chosen and described in order to best explain the principles of the invention and its practical applications, they thereby enable others skilled in the art to best utilize the invention and various embodiments with various modifications as are suited to the particular use contemplated. It is intended that the following claims and their equivalents define the scope of the invention.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>We claim:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A virtual chassis, comprising:
<claim-text>a plurality of stacked physical chassis that operate in a manner so as to appear to a connecting network as a single, logical chassis;</claim-text>
<claim-text>a first physical chassis of the plurality of physical chassis including:
<claim-text>a first route processing module that is configured to operate in a virtual chassis management role to manage the virtual chassis, and that is configured to operate in a first physical chassis management role to manage the first physical chassis; and</claim-text>
<claim-text>a second route processing module that is configured to operate in a first physical chassis standby role to transition to the first physical chassis management role in the event of a failure of the first route processing module; and</claim-text>
</claim-text>
<claim-text>a second physical chassis of the plurality of physical chassis that is stacked with the first physical chassis and that includes:
<claim-text>a third route processing module that is configured to operate in a virtual chassis standby role to transition to the virtual chassis management role in the event of a failure of the first route processing module, and that is configured to operate in a second physical chassis management role to manage the second physical chassis; and</claim-text>
<claim-text>a fourth route processing module that is configured to operate in a second physical chassis standby role to transition to the second physical chassis management role in the event of the failure of the third route processing module;</claim-text>
</claim-text>
<claim-text>wherein the second route processing module is configured to operate in a virtual chassis associate role to transition to the virtual chassis standby role in the event of at least one of: a status change by the third route processing module to the virtual chassis management role, and a failure of the third route processing module.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The virtual chassis of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the plurality of physical chassis run one or more layer-2 network protocols.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The virtual chassis of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the plurality of physical chassis run one or more layer-3 network protocols.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The virtual chassis of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the plurality of physical chassis are one or both of a network switch and a router.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The virtual chassis of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein each of the first route processing module, the second route processing module, the third route processing module, and the fourth route processing module are comprised of one or more separate processors.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The virtual chassis of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the fourth route processing module is configured to operate in a virtual chassis associate role to transition to the virtual chassis standby role in the event of a status change by the third route processing module to the virtual chassis management role.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The virtual chassis of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the fourth route processing module is configured to operate in a virtual chassis associate role to transition to the virtual chassis standby role in the event of a failure of the third route processing module.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. A method of operating a virtual chassis, comprising:
<claim-text>assigning a virtual chassis management role and a first physical chassis management role to a first route processing module in a first physical chassis and, in response, using the first route processing module to manage each of the first physical chassis and a virtual chassis that include the first physical chassis stacked with a second physical chassis;</claim-text>
<claim-text>assigning a virtual chassis associate role to a second route processing module in the first physical chassis;</claim-text>
<claim-text>assigning a virtual chassis standby role and a second physical chassis management role to a third route processing module in the second physical chassis and, in response, using the third route processing module to manage the second physical chassis;</claim-text>
<claim-text>detecting a failure of the first route processor module and, in response:
<claim-text>transitioning the third route processing module from the virtual chassis standby role to the virtual chassis management role and, in response, using the third route processing module to manage each of the second physical chassis and the virtual chassis; and</claim-text>
<claim-text>transitioning the second route processing module from the virtual chassis associate role to the virtual chassis standby role.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, further comprising:
<claim-text>assigning a first physical chassis standby role to the second route processing module; and</claim-text>
<claim-text>transitioning the second route processing module to the first physical chassis management role in response to detecting the failure of the first route processing module.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the first physical chassis and the second physical chassis include a network layer-2 switch, a network layer-3 router or both.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein each of the first route processing module, the second route processing module, and the third route processing module, are comprised of one or more separate processors.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, further comprising:
<claim-text>assigning a second physical chassis standby role to a fourth route processing module in the second physical chassis; and</claim-text>
<claim-text>detecting a failure of the third route processing module and, in response, transitioning the fourth route processing module to the second physical chassis management role and transitioning the second route processing module, that was previously transitioned from the virtual chassis associate role to the virtual chassis standby role, to the virtual chassis management role.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, further comprising:
<claim-text>synchronizing state information between the first route processing module and the third route processing module prior to detecting the failure of the first route processing module.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. A method of operating a virtual chassis, comprising:
<claim-text>assigning a virtual chassis management role and a first physical chassis management role to a first route processing module in a first physical chassis and, in response, using the first route processing module to manage the first physical chassis and a virtual chassis that includes the first physical chassis stacked with a second physical chassis;</claim-text>
<claim-text>assigning a virtual chassis associate role and a first physical chassis standby role to a second route processing module in the first physical chassis;</claim-text>
<claim-text>assigning a virtual chassis standby role and a second physical chassis management role to a third route processing module in the second physical chassis;</claim-text>
<claim-text>assigning a second physical chassis standby role to a fourth route processing module in the second physical chassis; detecting a failure of the first route processing module and, in response:
<claim-text>transitioning the third route processing module from the virtual chassis standby role to the virtual chassis management role and, in response, using the third route processing module to manage the virtual chassis; and</claim-text>
<claim-text>transitioning the second route processing module from the virtual chassis associate role to the virtual chassis standby role.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, further comprising:
<claim-text>assigning a virtual chassis associate role to the fourth route processing module in the second physical chassis; and</claim-text>
<claim-text>transitioning the fourth route processor module from the virtual chassis associate role to the virtual chassis standby role in response to the transitioning of the second route processor module from the virtual chassis standby role to the virtual chassis management role.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, further comprising:
<claim-text>transitioning the second route processing module from the first physical chassis standby role to the first physical chassis management role in response to detecting the failure of the first route processing module.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, further comprising: transitioning the fourth route processing module from the second physical chassis standby role to the second chassis management role in response to detecting a failure of the second route processing module. </claim-text>
</claim>
</claims>
</us-patent-grant>
