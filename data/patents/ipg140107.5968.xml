<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08627080-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08627080</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>13557445</doc-number>
<date>20120725</date>
</document-id>
</application-reference>
<us-application-series-code>13</us-application-series-code>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>9</main-group>
<subgroup>32</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>713169</main-classification>
</classification-national>
<invention-title id="d2e43">Systems and methods for mutual authentication using one time codes</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5657390</doc-number>
<kind>A</kind>
<name>Elgamal et al.</name>
<date>19970800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713151</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6058477</doc-number>
<kind>A</kind>
<name>Kusakabe et al.</name>
<date>20000500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713169</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6609114</doc-number>
<kind>B1</kind>
<name>Gressel et al.</name>
<date>20030800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705 50</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7103575</doc-number>
<kind>B1</kind>
<name>Linehan</name>
<date>20060900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705 64</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7296147</doc-number>
<kind>B2</kind>
<name>Matsuzaki et al.</name>
<date>20071100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713155</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>7374082</doc-number>
<kind>B2</kind>
<name>Van de Velde et al.</name>
<date>20080500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>235380</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>7502933</doc-number>
<kind>B2</kind>
<name>Jakobsson et al.</name>
<date>20090300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713172</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>7818585</doc-number>
<kind>B2</kind>
<name>Kilian-Kehr et al.</name>
<date>20101000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713193</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>8255688</doc-number>
<kind>B2</kind>
<name>Wankmueller et al.</name>
<date>20120800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2003/0236748</doc-number>
<kind>A1</kind>
<name>Gressel et al.</name>
<date>20031200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705 41</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2004/0172535</doc-number>
<kind>A1</kind>
<name>Jakobsson et al.</name>
<date>20040900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713168</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2005/0033688</doc-number>
<kind>A1</kind>
<name>Peart et al.</name>
<date>20050200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>2005/0119978</doc-number>
<kind>A1</kind>
<name>Ates</name>
<date>20050600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705 67</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>2005/0195975</doc-number>
<kind>A1</kind>
<name>Kawakita</name>
<date>20050900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>380 30</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>2007/0012763</doc-number>
<kind>A1</kind>
<name>Van de Velde et al.</name>
<date>20070100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>2007/0118483</doc-number>
<kind>A1</kind>
<name>Hill et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>2008/0040276</doc-number>
<kind>A1</kind>
<name>Hammad et al.</name>
<date>20080200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>705 44</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>WO</country>
<doc-number>WO 2005/001618</doc-number>
<date>20050100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00019">
<othercit>U.S. Appl. No. 12/018,293, Jul. 25, 2012 Issue Fee payment.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00020">
<othercit>U.S. Appl. No. 12/018,293, Jun. 15, 2012 Notice of Allowance.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00021">
<othercit>Bruce Schneier, &#x201c;Protocols, Algorithms, And Source Code in C&#x201d; Applied Cryptography, Second Edition, 1996.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00022">
<othercit>Ch. Mitchell, &#x201c;Text for ISO/IEC FDIS 9798-4, Informations technology-Security techniques-Entity authentication-Part 4: Mechanisms using a crptographic check funtion.&#x201d; (revision of ISO/IEC 9798-4:1995), ISO/IEC JTC 1/SC 27 N 2289, May 10, 1999.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>13</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>None</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>5</number-of-figures>
</figures>
<us-related-documents>
<division>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>12018293</doc-number>
<date>20080123</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>8255688</doc-number>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>13557445</doc-number>
</document-id>
</child-doc>
</relation>
</division>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20120303960</doc-number>
<kind>A1</kind>
<date>20121129</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Wankmueller</last-name>
<first-name>John</first-name>
<address>
<city>Great Neck</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Roberts</last-name>
<first-name>Dave Anthony</first-name>
<address>
<city>Appleton Warrington</city>
<country>GB</country>
</address>
</addressbook>
<residence>
<country>GB</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Evans</last-name>
<first-name>Paul Michael</first-name>
<address>
<city>Farnborough</city>
<country>GB</country>
</address>
</addressbook>
<residence>
<country>GB</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Wankmueller</last-name>
<first-name>John</first-name>
<address>
<city>Great Neck</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Roberts</last-name>
<first-name>Dave Anthony</first-name>
<address>
<city>Appleton Warrington</city>
<country>GB</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Evans</last-name>
<first-name>Paul Michael</first-name>
<address>
<city>Farnborough</city>
<country>GB</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Baker Botts L.L.P.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>MasterCard International Incorporated</orgname>
<role>02</role>
<address>
<city>Purchase</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Powers</last-name>
<first-name>William</first-name>
<department>2434</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Methods and systems for mutual authentication and personalizing a transaction device, such as a payment, transaction, or identity card. Successively generated one time codes are calculated by a first and second entity. One of the codes is transmitted to the second entity, which verifies the code is proper, then encrypts a second one time code using a third one time code and transmits the encrypted data to the first entity. The first entity decrypts the data using the third one time code, verifies the encrypted second one time code is proper, thereby mutually authenticating, and establishing a shared encryption key for subsequent communications, including transmission of personalization data.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="174.33mm" wi="215.90mm" file="US08627080-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="191.69mm" wi="59.44mm" file="US08627080-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="151.30mm" wi="160.44mm" file="US08627080-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="159.94mm" wi="167.47mm" file="US08627080-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="207.09mm" wi="161.54mm" file="US08627080-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="165.78mm" wi="142.24mm" file="US08627080-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">This application is a divisional application of U.S. patent application Ser. No. 12/018,293 filed Jan. 23, 2008, which is incorporated herein by reference in its entirety for all purposes</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">BACKGROUND</heading>
<p id="p-0003" num="0002">Mutual authentication between two entities is known in the art. For example ISO/IEC technical standard 9798-4 (hereby incorporated by reference in its entirety) describes entity authentication using cryptographic check functions. A simplified mutual authentication technique that permits subsequent secure communications using a shared encryption key is desirable for numerous applications, One application of a simplified mutual authentication technique is in personalizing payment devices and other identification devices before they are used. Once personalization information, or identifying information, has been incorporated into the device, the device may be used to, for example, purchase goods, identify the object or an individual, or for other purposes.</p>
<p id="p-0004" num="0003">The process of personalization traditionally occurs at a trusted centralized location with both physical and logical controls to ensure security. For example, credit cards may begin as generic card stock with embedded security features (such as holograms) and may later be associated with identifying information to support customer identification, purchases, marketing, advertising, and other applications by embossing or writing data to the card with customer identifying information at a personalization facility. This process ensures that unscrupulous individuals do not obtain credit card stock and incorporate spurious information onto the cards. Similar techniques may be used to associate cell-phone SIM cards with a particular customer or cell-phone.</p>
<p id="p-0005" num="0004">There is a need for a personalization solution that allows transaction devices such as credit or debit cards, contactless payment devices (including non-card form factors), loyalty cards or devices, integrated circuit cards, and other identification devices to be personalized in a less secure environment, such as at a point-of-sale terminal, a self-service kiosk or vending machine, in a home user's PC, or over-the-air (&#x201c;OTA&#x201d;) in portable devices such as cell-phones, smart phones, or personal digital assistants.</p>
<heading id="h-0003" level="1">SUMMARY</heading>
<p id="p-0006" num="0005">Systems and methods for simplified mutual authentication and securely personalizing transaction devices are described herein. Some embodiments of the disclosed subject matter include procedures for securely personalizing a transaction device including obtaining first dynamic data; retrieving at least a portion of key data from a data storage; calculating a first authentication code based on said first dynamic data and said at least a portion of key data; transmitting at least a portion of said first dynamic data and said first authentication code to a verification computer; obtaining second dynamic data based on said first dynamic data; calculating a second authentication code based on said second dynamic data and said at least a portion of key data; receiving personalization data encrypted using at least said second authentication code; and decrypting said personalization data, personalizing said device based at least in part on said personalization data. Some embodiments of the disclosed subject matter include the procedures wherein said first dynamic data is a counter. Some embodiments of the disclosed subject matter include the procedures wherein said obtaining second dynamic data comprises incrementing said first dynamic data. Some embodiments of the disclosed subject matter include the procedures wherein said transaction device is a contactless payment device. Some embodiments of the disclosed subject matter include the procedures wherein said calculating a first authentication code includes generating a digital encryption key based on said at least a portion of key data; performing a digital cryptographic operation on input data consisting at least in part of said first dynamic data, using said encryption key; and extracting predetermined bits of the result of said cryptographic operation and designating those extracted bits as said first authentication code. Some embodiments of the disclosed subject matter include the procedures wherein said personalizing includes programming said transaction device with a secret key. Some embodiments of the disclosed subject matter include the procedures wherein said personalizing includes programming said transaction device with a payment account number.</p>
<p id="p-0007" num="0006">Some embodiments of the disclosed subject matter include procedures for securely personalizing a transaction device including receiving, from a transaction terminal, an authentication message comprising at least a portion of a first dynamic data and a first authentication code associated with said transaction device; calculating a second dynamic data based on said first dynamic data; retrieving at least a portion of key data from a data storage; calculating a second authentication code based on said second dynamic data and said at least a portion of key data; encrypting personalization data associated with said transaction device using an encryption key based at least in part on said second authentication code; and transmitting said personalization data in encrypted form to said transaction terminal far personalization of said transaction device. Some embodiments of the disclosed subject matter include the procedures wherein said calculating a second authentication code includes generating a digital encryption key based on said at least a portion of key data; performing a digital cryptographic operation on input data consisting at least in part of said second dynamic data, using said encryption key; and extracting predetermined bits of the result of said cryptographic operation and designating those extracted bits as said second authentication code. Some embodiments of the disclosed subject matter include the procedures wherein said personalization data includes a secret key. Some embodiments of the disclosed subject matter include the procedures wherein said personalization data includes a payment account number.</p>
<p id="p-0008" num="0007">Some embodiments of the disclosed subject matter include components for personalizing a transaction device including a dynamic data generator arranged to generate a first dynamic data and a second dynamic data, said second dynamic data mathematically related to said first dynamic data; a key data digital storage device; an authentication code generation engine electrically coupled to said dynamic data generator and said key data digital storage device, said authentication code generation engine arranged to calculate a first authentication code based on a first dynamic data obtained from said dynamic data generator and at least a portion of key data obtained from said key data digital storage device, said authentication code generation engine further arranged to calculate a second authentication code based at least in part on said second dynamic data; a transmitter coupled to said authentication code processor arranged to transmit at least a portion of said first dynamic data and said first authentication code; a receiver arranged to receive encrypted personalization data; a decryption engine coupled to said receiver arranged to decrypt said personalization data using a second authentication data; a personalization controller for personalizing said transaction device based at least in part on said decrypted personalization data. Some embodiments of the disclosed subject matter include the components wherein said transaction device is a contactless integrated circuit payment device. Some embodiments of the disclosed subject matter include the components wherein at least one of said authentication code generation engine, said decryption engine, and said personalization controller is implemented as a firmware module embedded within said transaction device. Some embodiments of the disclosed subject matter include the components wherein at least one of said authentication code generation engine, said decryption engine, and said personalization controller is implemented as a software module executed by a processor in said transaction device. Some embodiments of the disclosed subject matter include the components wherein said personalization data includes a secret key. Some embodiments of the disclosed subject matter include the components wherein said personalization data includes a payment account number.</p>
<p id="p-0009" num="0008">Some embodiments of the disclosed subject matter include components for generating transaction device personalization data including a key data digital storage device; a receiver arranged to receive from a personalization terminal, an authentication message comprising at least a portion of a first dynamic data and a first authentication code associated with said transaction device; a dynamic data transformation engine electrically coupled to said receiver, arranged to transform said first dynamic data into second dynamic data; an authentication code generation engine electrically coupled to said key data digital storage device, said authentication code processor arranged to calculate a second authentication code based on a first dynamic data obtained from said dynamic data generator and at least a portion of key data obtained from said key data digital storage device; a comparator electrically coupled to said authentication code generation engine arranged to compare said first authentication code and said second authentication code, wherein said authentication code generation engine is further arranged to calculate a third authentication code based at least in part on said second dynamic data when said comparator determines that said first authentication code equals said second authentication code; a personalization data storage device; an encryption engine electrically coupled to said authentication code generation engine and said personalization data storage device, arranged to encrypt said personalization data using an encryption key based at least in part on said third authentication code; and a transmitter electrically coupled to said encryption engine arranged to transmit said personalization data in encrypted form to said transaction terminal for personalization of said transaction device. Some embodiments of the disclosed subject matter include the components wherein said transaction device is a contactless integrated circuit payment device. Some embodiments of the disclosed subject matter include the components wherein said components for generating transaction device personalization data includes a processor, and wherein said at least one of said a dynamic data transformation engine, said authentication code generation engine, said comparator, and said encryption engine is implemented as a software module executed by said processor. Some embodiments of the disclosed subject matter include the components wherein said personalization data includes a secret key. Some embodiments of the disclosed subject matter include the components wherein said personalization data includes a payment account number.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0010" num="0009">For a more complete understanding of example embodiments of the present invention and its advantages, reference is now made to the following description, taken in conjunction with the accompanying drawings, in which:</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIGS. 1</figref><i>a</i>-<b>1</b><i>c </i>depict example components according to an embodiment of the disclosed subject matter.</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 2</figref> depicts an example procedure according to an embodiment of the disclosed subject matter.</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 3</figref> depicts an example of techniques employed in performing mutual authentication between two entities in accordance with the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0014" num="0013">The use of one-time codes or one-time passwords to perform unilateral authentication are known in the art. These techniques typically employ a hardware and/or software device capable of generating an unpredictable code that can be sent in the clear, or via a channel protected by independent security techniques, to a second entity for authentication, such as a web-server or an authentication computer. Examples of such techniques for payment authentication are described in U.S. Patent Application Publication Number 2005-0119978, entitled &#x201c;Authentication arrangement and method for use with financial transactions,&#x201d; and International Publication Number WO05001618, entitled &#x201c;Customer authentication in e-commerce transactions&#x201d; which are incorporated by reference in there entireties herein.</p>
<p id="p-0015" num="0014">In one embodiment of the present invention, shown in <figref idref="DRAWINGS">FIG. 3</figref>, a first entity (the originator) <b>301</b> seeking to authenticate with a second entity (the receiver) <b>303</b> generates a first one-time code (i.e. OTP1) <b>305</b> and sends the code <b>307</b> to the receiver <b>303</b>. The one time code <b>305</b> (referred to herein as an authentication code) may be generated using the techniques in the above-mentioned patent publications, techniques described in more detail herein, or may be simply a code extracted from a shared secret list of codes used for authentication or other purposes. To accomplish authentication, it is advantageous that receiver be able to confirm <b>309</b> that the one time code received was generated by the first entity. This is achieved using cryptographic techniques using a shared key or a public/private key pair, or by using a shared list of secret codes, as previously described. The authentication code should advantageously change after each use, such as by including a time stamp or incrementing or decrementing counter in the inputs to the cryptographic function, or by selecting a different code from the list of shared secret codes with each iteration of the techniques of the invention.</p>
<p id="p-0016" num="0015">Once the receiver has confirmed that it has received an authentication code from the first entity, and has performed the comparison or calculations necessary to ensure the code is authentic <b>309</b>, the receiver can then determine or calculate two subsequent one time authentication codes (i.e. OTP2 and OTP3) <b>311</b> using the techniques previously described. The receiver then uses OTP3 either as an encryption key, or as an input to an encryption key generation algorithm known to both entities, <b>313</b> and uses the resultant communication key to encrypt OTP2 <b>315</b>. The encrypted version of OTP2 is sent <b>317</b> to the originator, which calculates on its own OTP2, OTP3 <b>319</b> (and the encryption key, if the system design uses OTP3 as an input to a key generation algorithm rather than using OTP3 as the encryption key) <b>321</b>, decrypts the received message and verifies that it contains the OTP2 <b>323</b>. If the originator verifies that OTP2 was properly calculated by the recipient, mutual authentication is achieved. Further communications between the first entity and the second entity may then be secured using the encryption key based on OTP3 (or using OTP3 as the encryption key).</p>
<p id="p-0017" num="0016">Notably the encryption key is thereby never exchanged between the first entity (originator) and the second entity (recipient), avoiding a potential insecurity associated with transmitting an encryption key and exposing the key to interception. If heightened security is desired, the techniques of this embodiment may involve occasionally (i.e. after every message, or every n messages, where n is a predetermined integer) calculating a new OTP by both entities, and using that new OTP as the encryption key (or the input to an encryption key generation algorithm).</p>
<p id="p-0018" num="0017">In another exemplary embodiment, based on the foregoing description regarding <figref idref="DRAWINGS">FIG. 3</figref>, the encryption key (OTP3) is a cryptogram generated by an EMV-compliant application residing on a payment device, and may be, for example, a cryptogram generated in response to a &#x201c;Generate AC&#x201d; command supplied to the EMV application resulting in an application authentication cryptogram (AAC), an authorization request cryptogram (ARQC), or a transaction certificate (TC), such as is described in the EMV Integrated Circuit Card Specifications for Payment Systems, Common Payment Application Specification version 1.0, dated December 2005, which is incorporated by reference herein in its entirety.</p>
<p id="p-0019" num="0018">An embodiment of the invention as applied to personalization of a transaction device is now described in further detail. In accordance with <figref idref="DRAWINGS">FIG. 1</figref><i>a</i>, a personalization device <b>100</b>, such as a transaction terminal, may be in communication with a transaction device <b>102</b> that is to be personalized via a personalization interface <b>104</b>. The personalization device <b>100</b> may be in communication with a personalization server <b>108</b> over a data communications infrastructure <b>106</b>. The personalization device <b>100</b> may be any transaction terminal capable of communicating with the transaction device, for example, the terminal may be a point-of-sale terminal, a portable digital device, a cell phone, a smart phone, or similar devices. The interface <b>104</b> may include any interface capable of exchanging data between the terminal and the transaction device, and may include a contactless interface, as described in ISO Standard 14443 or similar standards as well known in the art, or may be a traditional smart card or integrated circuit card interface in physical and electrical contact with the transaction device. The device <b>102</b> and personalization device <b>100</b> may be in constant communication throughout the personalization process or may be in intermittent communication. For example, the user may be asked to wave the device <b>102</b> in front of the personalization device <b>100</b> at various points in the personalization process so that data may be communicated therebetween. Communications infrastructure may be any electromagnetic communications channel, including radio or cellular network over-the-air communications, IR, the Internet, a private network, including a VPN operating over a public network, point-to-point communications systems, dedicated lines, or similar technologies. In one embodiment, the data communications infrastructure <b>106</b> may include the MasterCard Banknet&#xae; network.</p>
<p id="p-0020" num="0019">To personalize the device transaction <b>102</b>, the personalization device <b>100</b> may establish secure communications with personalization server <b>108</b> over data communications infrastructure <b>106</b>. The messages exchanged through the secure communications may include personalization data. The personalization data may include one or more payment or transaction account numbers, encryption keys, cardholder identification information, and other account data <b>110</b> well known to persons of ordinary skill in the art. The personalization data is loaded into transaction device <b>102</b> via the personalization interface <b>104</b>, enabling the transaction device to be used for identification and other purposes (e.g., payment activities). Personalization data may also include data beyond identifying or functional data. For example, a payment card may include a customer's preferences for types of products and services. A merchant processing a transaction with the payment card may scan this data and print advertisements or coupons that are tailored to the customer's preferences, or use the information for other marketing or research purposes consistent with the merchant's loyalty program terms and conditions. In another example, the data association may be performed apart from the device itself. For example, the personalization data may simply entail a reference pointer to a data storage entity. The account or device-holder identification data may be stored in a data storage device separate from the transaction device <b>102</b>, and accessed via the reference pointer stored on the transaction device <b>102</b> during a subsequent transaction.</p>
<p id="p-0021" num="0020">The personalization server <b>108</b> may associate identifying information with account info <b>110</b> so that the entity to which the device is personalized may gain access to the account info when using the personalized device <b>102</b>.</p>
<p id="p-0022" num="0021">The device <b>102</b> may include any appropriate device capable of having personalization data associated with it. For example, the device may include a device (such as a card, wrist watch, key, etc.) with magnetic stripe or integrated circuit or other suitable data memory for storing the personalization data.</p>
<p id="p-0023" num="0022">Implementation of the personalization device <b>100</b> and personalization server <b>108</b> may be one or more computing platforms well known to those ordinarily skilled in the art. The designation of personalization server <b>108</b> as a server is purely for convenience of describing the subject matter as the personalization server <b>108</b> may be capable of acting as a client itself.</p>
<p id="p-0024" num="0023">One exemplary personalization terminal <b>100</b> for use with the techniques of the present invention is shown in <figref idref="DRAWINGS">FIG. 1</figref><i>b</i>. The personalization terminal may consist of a key data digital storage device <b>130</b> for storing digital data. The storage device may be any structure capable of storing digital data including RAM, ROM, EEPROM, flash memory, magnetic media, or other similar technologies. In one embodiment, storage <b>130</b> is secured storage, keeping the contents secure from external tampering, such as by erasing the contents if the memory is tampered with. The key data may consist of any digital data maintained in secret by one or more entities to accomplish secured communications or message authentication in accordance with well known cryptographic techniques.</p>
<p id="p-0025" num="0024">Personalization terminal <b>100</b> also includes dynamic data generator <b>134</b>. This device is capable of generating changing (i.e. not static) data. For instance, the dynamic data generator may produce pseudo-random data via a known algorithm based on a predetermined initial data, incrementing or decrementing counter data, or clock data based on a predictable timing signal. Other types of dynamic data are possible and considered to be within the scope of the present invention as long as the data is not static and changes relatively frequently in a manner that is predictable by a verification computer in communication with the personalization terminal <b>100</b>.</p>
<p id="p-0026" num="0025">Authentication code generator <b>132</b> (also referred to as a generation engine) receives data from the dynamic data generator <b>134</b> and key data storage <b>130</b> in order to generate an authentication code. The authentication code generator may use additional data in order to generate the authentication code without departing from the scope or spirit of the invention. In one exemplary embodiment, authentication code generator takes as an input a first dynamic data from the dynamic data generator <b>134</b> and performs a cryptographic operation on that data using key data from the key data storage <b>130</b>. The cryptographic operation may include calculating a message authentication code as described in ISO standard 9797 and/or 9798-4. The cryptographic operation performed may be any typical operation well-known in the art, including symmetric cryptographic standards such as DES, 3DES, AES, or public-key or other asymmetric standards such as PKCS.</p>
<p id="p-0027" num="0026">The resulting authentication code may be shortened by selecting predetermined bits from the digital result, or may be transmitted in its entirety together with all or a portion of the dynamic data used to generate the authentication code via transmitter <b>136</b>, as described in further detail herein. Transmitter <b>136</b> and receiver <b>138</b> may be any of various transmitters or receivers well known in the art for transmitting or receiving data in digital or analog form, such as via a wired computer network, a wireless computer network, a radio, or cell data network. Transmitter <b>136</b> and receiver <b>138</b> may be combined into a single transceiver using well-known techniques. Transmitter <b>136</b> and receiver <b>138</b> may include any components necessary to modulate or demodulate any signals to be transmitted or received as necessary in view of the communications medium over which they operate.</p>
<p id="p-0028" num="0027">Terminal <b>100</b> may also include a decryption engine <b>140</b>, for decrypting encrypted data received via receiver <b>138</b>. The decryption engine <b>140</b> may use key data obtained from key data storage area <b>130</b> to perform decryption, or may use key data stored in an alternative permanent or temporary storage area, not shown. Decryption engine <b>140</b> makes use of well known decryption techniques as appropriate in view of the type of encryption employed by the entity with which the personalization terminal <b>100</b> is in communication, so as to recover the unencrypted data.</p>
<p id="p-0029" num="0028">Personalization terminal <b>100</b> may further include a personalization controller <b>142</b> coupled to the interface <b>104</b> for controlling the personalization of the transaction device coupled to the terminal via interface <b>104</b>, as previously described with respect to FIG. la. Exemplary techniques for personalizing a payment card, which could be used in connection with the present invention, are described in the PayPass&#x2014;Mag Stripe Technical Specifications, published by MasterCard Worldwide of Purchase, N.Y., which is incorporated by reference herein in its entirety. Other personalization techniques will be apparent to persons of ordinary skill in the art and are intended to be within the scope of the present invention.</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 1</figref><i>c </i>illustrates one exemplary verification computer <b>107</b> for use in the present invention. Verification computer <b>107</b> may be coupled to a separate personalization data storage computer (not shown), or may itself generate or store personalization data, to transmit to the personalization terminal <b>100</b> as shown in <figref idref="DRAWINGS">FIGS. 1</figref><i>a </i>and <b>1</b><i>b</i>. The combination of the personalization data storage device and the verification computer <b>107</b> is referred to as a personalization server <b>108</b> herein.</p>
<p id="p-0031" num="0030">Verification computer <b>107</b> includes a key data storage device, similar to device <b>130</b> shown in <figref idref="DRAWINGS">FIG. 1</figref><i>b</i>. The key data storage area may include multiple keys, each associated with a particular transaction device <b>102</b> (as shown in <figref idref="DRAWINGS">FIG. 1</figref><i>a</i>), or may use a single key associated with multiple devices.</p>
<p id="p-0032" num="0031">Verification computer <b>107</b> includes a receiver <b>162</b> and transmitter <b>164</b>, similar in structure and function to transmitter <b>136</b> and receiver <b>138</b> shown in <figref idref="DRAWINGS">FIG. 1</figref><i>b. </i></p>
<p id="p-0033" num="0032">According to some example embodiments, the keys stored in the data storage devices of the personalization terminal <b>100</b> and the personalization server <b>108</b> may be exchanged prior to personalization. This prepersonalization procedure may be accomplished by using any appropriate technique in which the terminal and server wind up with the same keys. For example, the personal terminal and server may be loaded with the same keys at the manufacturer or may be loaded in a post-manufacturing procedure. Alternatively, the key may be loaded on the personalization device <b>102</b> itself. When the personalization device is interfaced with the personalization interface <b>104</b>, the key may be retrieved from the personalization device <b>102</b> and stored in the key data store at the personalization terminal <b>100</b>.</p>
<p id="p-0034" num="0033">Dynamic data transformation engine <b>166</b> is designed to receive dynamic data from receiver <b>162</b> and transform that data using a predetermined mathematical algorithm. For example, where the transaction device employs an incrementing counter to generate dynamic data, the dynamic data transformation engine <b>166</b> acts on the received dynamic data by incrementing the received data by one, or the appropriate incrementing interval as predetermined by the system designer. Alternatively, the transformation engine <b>166</b> may pre-calculate the next dynamic data after each message or transaction. This transformed data is then further used as explained herein. For example, an authentication code generated at the personalization server <b>108</b> may be generated in part from the dynamic data. In some embodiments, the dynamic data is derived by the personalization server itself, instead of being received through receiver <b>162</b>. In this case, the dynamic data may be generated in a similar fashion as compared with the personalization device <b>100</b> or in a predictable manner thereof. For example, the dynamic data may be generated by a similarly seeded, monotonically increasing counter at both personalization device <b>100</b> and personalization server <b>108</b> or by synchronized time clocks.</p>
<p id="p-0035" num="0034">Authentication code generator <b>168</b> functions in a similar manner to device <b>132</b> in <figref idref="DRAWINGS">FIG. 1</figref><i>b</i>. Authentication code generator <b>168</b> receives the dynamic data and uses a preselected algorithm to generate the authentication code, such as an appropriate cryptographic function.</p>
<p id="p-0036" num="0035">Comparator <b>170</b> is coupled to receive an authentication code received from the receiver <b>162</b> and the authentication code generator <b>168</b> to verify that the received authentication code is authentic, by comparing the two authentication codes. The comparator may be any well-known structure for comparing two data values for equality or inequality. It should be noted that in order for authentication codes to be &#x201c;equal,&#x201d; the authentication codes need not strictly be equal. It is sufficient to verify that the calculated authentication code has the expected relationship with the received authentication code. For example, the calculated authentication code may be one number greater than the received authentication code, or may be equal to the next expected authentication code, and are, for purposes of the described subject matter, &#x201c;equal.&#x201d;</p>
<p id="p-0037" num="0036">Encryption engine <b>172</b> is similar to decryption engine <b>140</b> of <figref idref="DRAWINGS">FIG. 1</figref><i>b</i>, but is used to encrypt data before transmitting it transmitter <b>164</b>. The encryption engine <b>172</b> may use key data obtained from key data storage area <b>160</b> to perform decryption, or may use key data stored in an alternative permanent or temporary storage area, not shown, including key data derived in whole or in part from the authentication code generator <b>168</b>. Encryption engine <b>172</b> makes use of well known encryption techniques as appropriate in view of the decryption capabilities of personalization terminal <b>100</b>. Encryption engine <b>172</b> may operate on any unencrypted data, however in a preferred embodiment, encryption engine <b>172</b> operates on personalization data (not shown) associated with the transaction device <b>102</b> of <figref idref="DRAWINGS">FIG. 1</figref><i>a</i>, as previously described.</p>
<p id="p-0038" num="0037">It should be noted that the above-mentioned dynamic data generator, authentication code generator, authentication code generation engine, encryption engine, decryption engine, personalization controller may be implemented as firmware in an integrated circuit device, or as software executed by a general purpose processor, a reduced instruction set processor, or a special purpose processor or circuitry.</p>
<p id="p-0039" num="0038">The personalization terminal <b>100</b> and personalization server <b>108</b> may secure communications respectively using a shared data authentication code. For example, the terminal <b>100</b> may generate a first authentication code based on a secret key and a transaction counter and transmit the authentication code and all or a portion of the transaction counter. The personalization server may then recompute the authentication code using the received transaction counter data and the shared key data stored on the personalization server. If the recomputed authentication code matches the received authentication code, the personalization server and the transaction device may then each separately increment the transaction counter and calculate a new authentication code using the new transaction counter, yielding a new shared secret code. This shared secret code (which cannot be calculated by a third party who does not know the shared secret key) can now be used as an encryption key, or may be modified using a shared algorithm to generate a new encryption key to communicate subsequent data, including the personalization data. It should be noted that the subsequent authentication code is not transmitted between the terminal <b>100</b> and personalization server <b>108</b>, thereby avoiding man-in-the-middle attacks.</p>
<p id="p-0040" num="0039">It should be noted that more sophisticated transformation and prediction algorithms may be used to generate the next authentication code value given the previous value such that an unscrupulous individual who gains access to one or more codes cannot predict future codes. The personalization device and personalization server may each be programmed with the ability to predict the next value of the opposite entity's authentication code once the entity knows a value of the entity's authentication code.</p>
<p id="p-0041" num="0040"><figref idref="DRAWINGS">FIG. 2</figref> depicts an example procedure according to an embodiment of the disclosed subject matter. A personalization terminal may obtain a first dynamic data <b>200</b>. As described, the first dynamic data may be obtained from memory, derived from a value in memory, or obtained from another dynamic data source that is shared with or predicable by a verification computer.</p>
<p id="p-0042" num="0041">The personalization terminal may generate a message that may include the first authentication code (block <b>202</b>). The message may be calculated using a cryptographic function using a secret key over data that includes all or a portion of the dynamic data. In one embodiment, the key may be shared between the personalization terminal and a verification computer. In another embodiment, the personalization terminal may retrieve the key from an outside entity, such as a device to be personalized.</p>
<p id="p-0043" num="0042">The personalization terminal may send the message to the verification computer (block <b>206</b>) over a data communications infrastructure.</p>
<p id="p-0044" num="0043">The verification computer may retrieve the first authentication code from the message (block <b>210</b>) and derive a second authentication code (block <b>212</b>). For example, the verification computer may determine the dynamic data used to generate the first authentication code, then determine the next dynamic data, such as by incrementing or decrementing the received dynamic data. This modified dynamic data would then be used to calculate a second authentication code. Alternatively, the personalization server may not modify the dynamic data but may use the dynamic data as received to calculate the second authentication code. In another embodiment, the dynamic data may not be sent in the message, and the personalization server may derive the dynamic data on its own. For example, the dynamic data may be a monotonically increasing counter synchronized between the personalization terminal and personalization server. The verification computer may compare the first and second authentication codes (block <b>214</b>). If the authentication codes meet comparison criteria (e.g., if they match) (block <b>216</b>), processing continues to personalization. If the comparison criteria are not met, then an error message may be returned (block <b>218</b>). It should be noted that the comparison criteria need not consider both the first and second authentication codes, and may instead determine the authenticity of the first authentication code using another technique. Alternatively, no comparison need be made, and the system may simply assume that the first authentication code is authentic and proceed to personalization, although this is not recommended in most embodiments of the present invention.</p>
<p id="p-0045" num="0044">The second authentication code may be transformed. The transformed second authentication code may be used to secure communications of the personalization information during the personalization procedure (as described below). Transformation of the second authentication code by the personalization server may derive a second authentication code that is in accordance with the authentication code expected to be used by the personalization terminal. Likewise, if during the techniques of the described subject matter, the personalization terminal transforms an authentication code, such as to secure communications destined for the personalization server, the transformation may generate an authentication code in accordance with what is expected by the personalization server. If the transformed authentication codes are generated to be what is expected by the receiving parties, then the receiving parties may decrypt the received messages successfully using the authentication codes as decryption keys.</p>
<p id="p-0046" num="0045">The personalization terminal and verification computer may exchange communications secured using the transformed second authentication code, with both the personalization terminal and verification computer each calculating the transformed second authentication code separately. Accordingly, the personalization server may encrypt and transmit personalization information <b>224</b> to the personalization terminal, which can then personalize the device <b>226</b> using that information.</p>
<p id="p-0047" num="0046">The techniques of the present invention are well-suited to point of sale environments, many of which have sockets for ID-0 chip cards (i.e. EPM modules or GSM SIM cards). The personalization terminal of the present invention could be implemented by a ID-0 card in a modified POS terminal running a CAP chip application in accordance with the 3-D Secure Chip Authentication Program specification from Mastercard Worldwide of Purchase, N.Y., the contents of which is incorporated by reference herein in its entirety. Alternatively, a standard hardware security module could be used.</p>
<p id="p-0048" num="0047">In one exemplary embodiment of the present invention, the techniques are employed to personalize a MasterCard PayPass payment device where no pre-personalization was previously performed. In this case, then the data required to be sent could be quite significant since the data needs to include the PayPass application itself, PayPass pre-personalization data and PayPass personalization data.</p>
<p id="p-0049" num="0048">In another exemplary embodiment of the present invention, the techniques are employed to personalize a MasterCard PayPass payment device where the device has been already pre-personalized as per the PayPass specifications, then the data required will be small (at most a few hundred bytes). The PayPass infrastructure also defines a mechanism for protecting the data end to end by using the personalization key of the device. However, the plaintext personalization data could be subject to eavesdropping so it is recommended that further protection should be applied in accordance with the present invention.</p>
<p id="p-0050" num="0049">The foregoing merely illustrates the principles of the present invention. Various modifications and alterations to the described embodiments will be apparent to those skilled in the art in view of the teachings herein. It will thus be appreciated that those skilled in the art will be able to devise numerous techniques which, although not explicitly described herein, embody the principles of the invention and are thus within the spirit and scope of the invention.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method for mutual authentication between a first entity and a second entity, comprising:
<claim-text>obtaining first dynamic data;</claim-text>
<claim-text>retrieving at least a portion of key data from a data storage;</claim-text>
<claim-text>calculating a first authentication code based on said first dynamic data and said at least a portion of key data;</claim-text>
<claim-text>transmitting at least a portion of said first dynamic data and said first authentication code to said second entity;</claim-text>
<claim-text>modifying said first dynamic data to form second dynamic data;</claim-text>
<claim-text>calculating a second authentication code based on said second dynamic data and said at least a portion of key data;</claim-text>
<claim-text>modifying at least one of said first dynamic data and said second dynamic data to form third dynamic data;</claim-text>
<claim-text>calculating a third authentication code based on said third dynamic data and said at least a portion of key data;</claim-text>
<claim-text>generating a decryption key based at least in part on said third authentication code;</claim-text>
<claim-text>receiving authentication data from said second entity;</claim-text>
<claim-text>decrypting at least a portion of said authentication data based on said decryption key to form decrypted authentication data;</claim-text>
<claim-text>comparing at least a portion of said decrypted authentication data to said second authentication code; and</claim-text>
<claim-text>verifying the identity of said second entity based at least in part on said comparing step.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein said generating a decryption key comprises using at least a portion of said third authentication code as said decryption key.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said key data comprises a list of one time use codes, and further wherein said calculating a first authentication code based on said first dynamic data and said at least a portion of key data includes extracting a one time use code from said list at a position corresponding to said first dynamic data.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said key data comprises a symmetric cryptographic key and further wherein said calculating a first authentication code based on said first dynamic data comprises performing a symmetric cryptographic calculating using said symmetric cryptographic key over data comprising at least said first dynamic data.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said calculating a third authentication code comprises causing an EMV-compliant smart card to generate at least one of an application authentication cryptogram, an application authorization referral, and authorization request cryptogram, and a transaction certificate and using at least a portion of said generated data as said third authentication code.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said generating a decryption key comprises using at least a portion of said third authentication code as said decryption key.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. An apparatus for mutual authentication comprising between a first entity and a second entity, comprising:
<claim-text>a dynamic data generator arranged to generate a first dynamic data, a second dynamic data, and a third dynamic data, said second and third dynamic data related to said first dynamic data via an algorithm known to said first entity and said second entity;</claim-text>
<claim-text>a key data digital storage device;</claim-text>
<claim-text>an authentication code generation engine electrically coupled to said dynamic data generator and said key data digital storage device, said authentication code generation engine arranged to calculate a first authentication code based on a first dynamic data obtained from said dynamic data generator and at least a portion of key data obtained from said key data digital storage device, said authentication code generation engine further arranged to calculate a second authentication code based at least in part on said second dynamic data and a third authentication code based at least in part on said third dynamic data;</claim-text>
<claim-text>a transmitter coupled to said authentication code processor arranged to transmit at least a portion of said first authentication code to said second entity;</claim-text>
<claim-text>a receiver arranged to receive encrypted authentication data from said second entity;</claim-text>
<claim-text>a decryption key generator arranged to generate a decryption key based at least in part on said third authentication code;</claim-text>
<claim-text>a decryption engine coupled to said receiver and said decryption key generator, arranged to decrypt said encrypted authentication data using said decryption key to obtain second party authentication data;</claim-text>
<claim-text>a comparator coupled to said decryption engine and said authentication code generation engine for comparing at least a portion of said second party authentication data to said second authentication code; and</claim-text>
<claim-text>an authentication signal generator coupled to said comparator for generating a second-entity authentication signal when said at least a portion of said second party authentication data matches said second authentication code.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The apparatus of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein said transaction device is an integrated circuit payment device.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The apparatus of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein said transaction device is an EMV-compliant smart card.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The apparatus of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein said authentication code generation engine is executing on said EMV-compliant smart card and said third authentication code is an application cryptogram.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The apparatus of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein said application cryptogram is at least one of an application authentication cryptogram, an application authorization referral, and authorization request cryptogram, and a transaction certificate.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The apparatus of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein at least one of said authentication code generation engine, said decryption engine, and said personalization controller is implemented as a firmware module embedded within said integrated circuit payment device.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The apparatus of <claim-ref idref="CLM-00007">claim 7</claim-ref> wherein said key data comprises a list of one time use codes, and further wherein said authentication code generation engine calculates said first authentication code by extracting a one time use code from said list at a position corresponding to said first dynamic data. </claim-text>
</claim>
</claims>
</us-patent-grant>
