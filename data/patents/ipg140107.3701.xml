<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08624766-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08624766</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>13307022</doc-number>
<date>20111130</date>
</document-id>
</application-reference>
<us-application-series-code>13</us-application-series-code>
<us-term-of-grant>
<us-term-extension>27</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>03</class>
<subclass>M</subclass>
<main-group>1</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>341139</main-classification>
<further-classification>341135</further-classification>
<further-classification>341136</further-classification>
<further-classification>341142</further-classification>
<further-classification>341144</further-classification>
<further-classification>341155</further-classification>
</classification-national>
<invention-title id="d2e53">Method and system for auto-ranging analog-to-digital converter for current sensing</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5815107</doc-number>
<kind>A</kind>
<name>Frankeny et al.</name>
<date>19980900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341159</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6121913</doc-number>
<kind>A</kind>
<name>Glass et al.</name>
<date>20000900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341159</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>7221191</doc-number>
<kind>B2</kind>
<name>Ali et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>327 94</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7425909</doc-number>
<kind>B2</kind>
<name>Rose et al.</name>
<date>20080900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341135</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7446683</doc-number>
<kind>B2</kind>
<name>Perner</name>
<date>20081100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341135</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>8078122</doc-number>
<kind>B2</kind>
<name>Sahota et al.</name>
<date>20111200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455 91</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>8274421</doc-number>
<kind>B2</kind>
<name>Rey-Losada</name>
<date>20120900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341163</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>8325072</doc-number>
<kind>B2</kind>
<name>Kuttner</name>
<date>20121200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341136</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2002/0113723</doc-number>
<kind>A1</kind>
<name>Greig</name>
<date>20020800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341136</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2010/0085225</doc-number>
<kind>A1</kind>
<name>Chang et al.</name>
<date>20100400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341110</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2011/0063154</doc-number>
<kind>A1</kind>
<name>Hotelling et al.</name>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341143</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2011/0140689</doc-number>
<kind>A1</kind>
<name>Fernando et al.</name>
<date>20110600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>32420725</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>2011/0304489</doc-number>
<kind>A1</kind>
<name>Christer et al.</name>
<date>20111200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341118</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>2012/0013495</doc-number>
<kind>A1</kind>
<name>Rey-Losada</name>
<date>20120100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341139</main-classification></classification-national>
</us-citation>
</us-references-cited>
<number-of-claims>17</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>341134-136</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>341139</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>341142</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>341 55</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>341144</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>3</number-of-drawing-sheets>
<number-of-figures>3</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20130135130</doc-number>
<kind>A1</kind>
<date>20130530</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Pulijala</last-name>
<first-name>Srinivas K.</first-name>
<address>
<city>Tucson</city>
<state>AZ</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Pulijala</last-name>
<first-name>Srinivas K.</first-name>
<address>
<city>Tucson</city>
<state>AZ</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>King &#x26; Spalding L.L.P.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Standard Microsystems Corporation</orgname>
<role>02</role>
<address>
<city>Hauppauge</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Nguyen</last-name>
<first-name>Linh</first-name>
<department>2819</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Embodiments of the present disclosure provide a method and system for an auto-ranging analog-to-digital converter (ADC) for dynamically scaling inputs to an ADC. The auto-ranging ADC includes a dynamically configurable transistor arrangement for delivering a load current and a replica device for replicating the load current. A current sense resistor generates a replicated load voltage based on the replicated current. The ADC generates a digital value based on the replicated load voltage. The auto-ranging ADC also includes an auto-ranging controller for dynamically configuring the transistor arrangement based on the digital value to scale the inputs to the ADC.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="158.07mm" wi="236.64mm" file="US08624766-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="236.73mm" wi="172.80mm" orientation="landscape" file="US08624766-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="235.71mm" wi="177.29mm" orientation="landscape" file="US08624766-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="226.23mm" wi="172.38mm" file="US08624766-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">TECHNICAL FIELD</heading>
<p id="p-0002" num="0001">The present disclosure relates generally to the field of analog integrated circuit design and, more particularly, to methods and systems for power management in electronic circuits.</p>
<heading id="h-0002" level="1">BACKGROUND</heading>
<p id="p-0003" num="0002">The need to accurately and precisely measure the flow of current in electronic systems is becoming increasingly critical and widespread. The growth of battery-powered portable devices has increased the need to minimize energy usage and manage power requirements of devices, and the spread of electrically actuated systems in various practical applications account for the widespread need.</p>
<p id="p-0004" num="0003">The latest trends in power management products require performing not only power rationing for downstream devices, but also removal detection events, detecting when a device is physically removed from a circuit. Power rationing requires measuring large amounts of current data of the order of amperes, but removal detection events require measuring low current, usually of the order of few hundred micro amperes. At the end of the charging cycle, for example, a battery under charge may draw extremely low current, but the system needs to know when the device is actually removed from the charger.</p>
<p id="p-0005" num="0004">A conventional solution for removal detection is to employ a very high resolution analog-to-digital converter (ADC) to measure current over a wide range, from Amperes on the high-end to micro amperes at the lower end of the scale. The high resolution ADCs require output of 16-bits and more. As is well understood in the art, that degree of resolution calls for high die area requirements. Moreover, adding high resolution ADCs to an integrated chip increases the overall power consumption of the chip.</p>
<p id="p-0006" num="0005">Alternatively, designers use multiple ADCs to perform the desired current sensing and measurement. That solution, however, increases the die area requirements. In addition, multiple ADCs increase the digital signal processing requirements as well as the power consumption.</p>
<p id="p-0007" num="0006">Thus, there remains a need for an ADC capable of accurately measuring high resolution current values for efficient power management.</p>
<heading id="h-0003" level="1">SUMMARY</heading>
<p id="p-0008" num="0007">Briefly described, and according to one embodiment, the present disclosure describes a method and system for an auto-ranging analog-to-digital converter (ADC) for dynamically scaling inputs to an ADC. The auto-ranging ADC includes a dynamically configurable transistor arrangement for providing a load current and a replica device for replicating the load current. The replica device outputs a replicated load voltage based on the replicated current. The ADC generates a digital value based on the replicated load voltage. The auto-ranging ADC also includes an auto-ranging controller for dynamically configuring the transistor arrangement based on the digital value to scale the inputs to the ADC.</p>
<p id="p-0009" num="0008">According to another embodiment, the present disclosure describes an auto-ranging method for dynamically scaling inputs to an analog-to-digital converter (ADC). The auto-ranging method includes providing a load current by a dynamically configurable transistor arrangement and replicating the load current. The method further includes generating a replicated load voltage based on the replicated current. Moreover, the method includes generating a digital value based on the replicated load voltage by the ADC. In addition, the method includes dynamically configuring the transistor arrangement based on the digital value to scale the inputs to the ADC.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE FIGURES</heading>
<p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of one embodiment of an auto-ranging system configured according to principles of the present invention.</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 2</figref> is a circuit diagram of one embodiment of an auto-ranging system configured according to principles of the present invention</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 3</figref> is a flowchart depicting an exemplary method for auto-ranging an ADC.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<p id="p-0013" num="0012">While embodiments of the present disclosure are amendable to various modifications and alternative forms, specific embodiments are shown by way of example in the drawings and are described in detail. It should be understood, however, that the drawings and detailed description thereto are not intended to limit the present disclosure to the particular form disclosed, but on the contrary, the intention is to cover all modifications, equivalents, and alternatives falling within the spirit and scope of the present disclosure as defined by the appended claims.</p>
<heading id="h-0005" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0014" num="0013">The following detailed description is made with reference to the figures. Embodiments are described to illustrate the disclosed system and method, not to limit their scope. With the insight provided by the instant disclosure, those of ordinary skill in the art should recognize a variety of equivalent variations on the description that follows.</p>
<heading id="h-0006" level="1">Overview</heading>
<p id="p-0015" num="0014">Embodiments of the present disclosure provide a method and system for an auto-ranging analog-to-digital converter (ADC) for dynamically scaling inputs to the ADC. The auto-ranging ADC is used for high-precision measurement of current values. The auto-ranging ADC includes a dynamically configurable transistor arrangement for generating a replica current based on a load current. The load current is generated to meet the varying demands of downstream devices. The dynamically configurable transistor arrangement modifies the prior transistor arrangement to generate a replica current depending on the load current requirement. A replica device is connected to the transistor arrangement in a configuration which generates a replica current based on the load current drawn by a downstream device. The replica current is mirrored to flow through a current sense resistor. Based on the current flowing through the current sense resistor, a voltage is developed across the current sense resistor. The developed voltage is fed to an ADC to generate a digital value corresponding to the developed voltage. The developed voltage may be input to a sample-and-hold, and anti-aliasing filter circuit to avoid the aliasing of higher frequency signals back into the ADC. This voltage may then be fed to the ADC.</p>
<p id="p-0016" num="0015">The digital value output by the ADC is fed to an auto-ranging controller. Based on the digital value, the auto-ranging controller generates switching signals. When the digital value falls below a threshold value, the auto-ranging controller changes the state of the switching signals. The state of the switching signals determines the configuration of the transistor arrangement. The switching signals dynamically configure the transistor arrangement to scale the inputs to the ADC. The transistor arrangement includes at least two transistors connected in parallel. The dynamic re-configuration involves switching on one or more transistors to provide the required load current to the downstream device. The switching signals connect the switches coupling the input voltage supply to the gate terminals of the transistors. Depending on the state of one or more transistors, load current flows through the transistor arrangement. Therefore, the input to the ADC is scaled accordingly.</p>
<p id="p-0017" num="0016">The auto-ranging ADC can be used in a wide variety of electronic applications. For example, a USB Port Power Controller can use an embodiment of the disclosure to control a 5V bus voltage, capable of delivering up to 2.5 A load current. The port power switch, including three transistor switches connected in parallel, can be tailored to the anticipated ADC reading. In a normal mode of operation, an eight-bit SAR ADC may perform power-rationing by employing a replica device in parallel with the port power switch to generate a copy current based port power switch current. In order to detect the presence of a down-stream device, which could potentially draw only a few hundred micro-Amps through the port power switch, the port power switch is downsized to generate a replica current within the dynamic range of the ADC. The port power switch is downsized based on the prior reading of the ADC when all the transistors in the port power switch are connected.</p>
<p id="h-0007" num="0000">Exemplary Systems</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram illustrating an exemplary auto-ranging system <b>100</b> including an analog-to-digital converter (ADC) <b>108</b> for high precision current sensing. The auto-ranging system <b>100</b> includes a transistor arrangement <b>102</b> electronically coupled to a replica device <b>104</b> for replicating a load current (ILoad) <b>124</b> flowing through the transistor arrangement <b>102</b>. A current sense resistor <b>106</b> is electronically coupled to the replica device <b>104</b> for generating a replicated load voltage <b>128</b> based on the replicated current, and that voltage is fed to the ADC <b>108</b>. That device generates a digital value based on the replicated load voltage <b>128</b>. An auto-ranging controller <b>110</b> receives the ADC output and generates switching signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d;. Those signals are fed to the transistor arrangement <b>102</b>, which accordingly configures transistor arrangement <b>102</b>.</p>
<p id="p-0019" num="0018">As shown in <figref idref="DRAWINGS">FIG. 1</figref>, a downstream device <b>122</b> demands a load current <b>124</b> ILoad to meet the power requirement of the downstream device <b>122</b> and its components. Inputs to the transistor arrangement <b>102</b> are reference supply voltage VS and control voltage Vg. The transistor arrangement <b>102</b> can be dynamically configured among two or more current ranges, controlled by inputs &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d;.</p>
<p id="p-0020" num="0019">The replica device <b>104</b> also receives control voltage Vg as an input, together with a signal based on the load current <b>124</b>, and it accordingly outputs a replica current <b>126</b>. The replica current <b>126</b> is fed to current sense resistor <b>106</b>, which in turn produces a replicated load voltage <b>128</b>. In an embodiment, the replica device <b>104</b> may mirror the replica current <b>126</b> before generating the replicated load voltage <b>128</b>, which is then fed as an input to the ADC <b>108</b>.</p>
<p id="p-0021" num="0020">The ADC <b>108</b> receives the replicated load voltage <b>128</b> and generates a corresponding digital value adc_data &#x3c;N:0&#x3e;. Other inputs include &#x201c;adc_start&#x201d;, an active high signal, which initiates the conversion of the ADC <b>108</b>. A clock signal &#x201c;adc_clk&#x201d; is also provided, as is a voltage reference signal Vref. An auto-zero signal &#x201c;adc_az_sar&#x201d;, removes any offsets present in the ADC <b>108</b>. The ADC <b>108</b> may also include an anti-aliasing filter for restricting the frequency bandwidth of the replicated load voltage <b>128</b>.</p>
<p id="p-0022" num="0021">In an embodiment, the ADC <b>108</b> is an 8-bit successive-approximation-register (SAR) analog-to-digital converter (ADC). The ADC <b>108</b> outputs a digital value adc_data &#x3c;N:0&#x3e;, where N represents the number of bits in the output digital value. For example, an eight bit ADC will generate a digital value adc_data &#x3c;8:0&#x3e;.</p>
<p id="p-0023" num="0022">The auto-ranging controller <b>110</b> uses the output digital value adc_data &#x3c;N:0&#x3e; to generate switching signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d;. Those signals are used by the transistor arrangement <b>102</b> to dynamically configure the prior transistor arrangement <b>102</b>. The switching signal output is based on the value of adc_data &#x3c;N:0&#x3e;, and thus the auto-ranging controller <b>110</b> may include sensing and response circuitry, such as a logic circuit, a microprocessor, a microcontroller, or similar circuits and devices known in the art for generating the switching signals. In an embodiment, the auto-ranging controller <b>110</b> may include a memory device, such as a one-time programmable memory (OTP), for storing the threshold values of the digital value for determining the configuration of the transistor arrangement <b>102</b>. In operation, the transistor arrangement <b>102</b> is configured for maximum load current <b>124</b>. Then, if the ADC <b>108</b> reading crosses a threshold value, the auto-ranging controller <b>110</b> sends an appropriate signal to the transistor arrangement <b>102</b> via switching signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d;.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 2</figref> is a circuit diagram illustrating an exemplary auto-ranging system <b>200</b> including an analog-to-digital converter (ADC) <b>208</b> for high precision current sensing. The auto-ranging system <b>200</b> includes a pass transistor PM1 <b>202</b>, which in turn includes three transistors PM1-A <b>202</b>-A, PM1-B <b>202</b>-B, and PM1-C <b>202</b>-C connected in parallel. A control voltage Vg is connected to the gates of the three transistors PM1-A <b>202</b>-A, PM1-B <b>202</b>-B, and PM1-C <b>202</b>-C, coupled through switches S1 <b>203</b>-A and S2 <b>203</b>-B. The switches S1 <b>203</b>-A and S2 <b>203</b>-B are controlled by switching signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d; respectively. All three switches are closed at start-up. The polarities of the switching signals &#x201c;Ibus_low&#x201d; and &#x201c;Ibus_super_low&#x201d; are determined by the previous ADC <b>208</b> reading, which in turn is determined by the load current ILoad drawn by the downstream device <b>122</b>.</p>
<p id="p-0025" num="0024">In the pass transistor PM1 <b>202</b>, an extremely low current is accommodated by turning PM1-B <b>202</b>-B, and PM1-C <b>202</b>-C off, so that current flows only through PM1-A <b>202</b>-A. In the illustrated circuit, that branch is designed to receive only a negligible amount of the total available capacity of the pass transistor PM1 <b>202</b>. A medium current level can be provided for by also turning on transistor PM1-B <b>202</b>-B, which in the illustrated device accommodates 1/16 of the possible FET current. Full capacity is achieved by also turning on PM1-C <b>202</b>-C. Details of how those results are accomplished are set out below, together with a truth table for the device and the associated input signals.</p>
<p id="p-0026" num="0025">A replica transistor PM0 <b>204</b> generates a replica current based on the load current ILoad using an error amplifier <b>207</b>. The error amplifier <b>207</b> forces the drain voltage of replica transistor PM0 <b>204</b> to be the same voltage as voltage Vbus through a negative feedback. The error amplifier <b>207</b> drives the gate of a transistor PM2 <b>205</b> to maintain the transistor PM2 <b>205</b> in saturation while transistors PM1 <b>202</b> and PM0 <b>204</b> are controlled by gate voltage Vg. The gate voltage Vg can be used for current limiting purposes. This arrangement results in accurate replication of the load current ILoad. The replicated current is mirrored by the current mirrors NM1-A <b>244</b>-A and NM1-B <b>244</b>-B, and PM3-A <b>264</b>-A and PM3-B <b>264</b>-B to flow through the current sense resistor <b>206</b>, developing the replicated load voltage <b>128</b>.</p>
<p id="p-0027" num="0026">ADC <b>208</b> receives analog replicated load voltage <b>128</b> and performs analog to digital conversion. In an embodiment, ADC <b>208</b> includes both sample-and-hold and anti-aliasing filter circuits. The anti-aliasing feature prevents aliasing higher frequency signals back into the baseband of the ADC <b>208</b>. Reference amplifier <b>209</b> provides a 2.5V reference voltage, generated based on a band gap voltage. As the maximum current drawn across the pass transistor PM1 <b>202</b> cannot exceed 2.5 A, the full-scale voltage of the ADC <b>208</b> is set to 2.5V. The mathematical calculation for calculating the resolution of an 8-bit ADC is shown below. A LSB, thus, equals
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>1 LSB=(2.5 Amperes/2<sup>8</sup>)=9.76 mA&#x2003;&#x2003;(1)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
For an eight-bit ADC, 1 LSB equaling 9.76 mA corresponds to 9.76 mV. This mode is used for power rationing.
</p>
<p id="p-0028" num="0027">The ADC <b>208</b> receives the replicated load voltage <b>128</b> signal and generates a corresponding digital value adc_data &#x3c;N:0&#x3e;. Other inputs include &#x201c;adc_start&#x201d;, an active high signal, which initiates the functioning of the ADC <b>108</b>. A clock signal &#x201c;adc_clk&#x201d; is also provided, as is a voltage reference signal Vref. An auto-zero signal &#x201c;adc_az_sar&#x201d;, removes any offsets present in the ADC <b>108</b>. The ADC <b>108</b> may also include an anti-aliasing filter for restricting the frequency bandwidth of the replicated load voltage <b>128</b>.</p>
<p id="p-0029" num="0028">In an embodiment, the ADC <b>208</b> is an 8-bit successive-approximation-register (SAR) analog-to-digital converter (ADC). The ADC <b>208</b> outputs a digital value adc_data &#x3c;N:0&#x3e;, where N represents the number of bits in the output digital value. For example, an eight bit ADC will generate a digital value adc_data &#x3c;8:0&#x3e;.</p>
<p id="p-0030" num="0029">The auto-ranging controller <b>110</b> uses the output digital value adc_data &#x3c;N:0&#x3e; to generate switching signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d;. Those signals are used by the transistor arrangement <b>102</b> to dynamically configure the transistor arrangement <b>102</b>. The switching signal output is based on the value of adc_data &#x3c;N:0&#x3e;, and thus the auto-ranging controller <b>110</b> may include sensing and response circuitry, such as a logic circuit, a microprocessor, a microcontroller, or similar circuits and devices known in the art for generating the switching signals In an embodiment, the auto-ranging controller <b>110</b> may include a memory device, such as a one-time programmable memory (OTP), for storing the threshold values of the digital value for determining the configuration of the transistor arrangement <b>102</b>. In normal operation, the transistor arrangement <b>102</b> is configured for maximum load current. Then, if the ADC <b>108</b> reading crosses a threshold value, the auto-ranging controller <b>110</b> sends an appropriate signal to the transistor arrangement <b>102</b> via switching signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d;.</p>
<p id="p-0031" num="0030">In an embodiment, the auto-ranging system <b>200</b> may also operate in a charger emulation mode. The charger emulation mode demands greater accuracy in terms of the ADC resolution for load currents ILoad below 150 mA. For example a USB Port Power Controller using the auto-ranging system <b>200</b> may operate in the charger emulation mode for accurately determining the load current flow in microamperes. In the charger emulation mode when the ADC reading falls below 16 LSB's for four consecutive conversions, which is equivalent to 156.25 mA, the transistor PM1-C (15/16 FET) is turned off. Therefore, the auto-ranging controller <b>110</b> drives the switching signal &#x201c;Ibus_super_low&#x201d; low, and &#x201c;Ibus_low&#x201d; high. As a result, the switch S2 <b>203</b>-B is in an open state, i.e., an off state. Thus, the control voltage Vg is cut off from the transistor PM1-C <b>202</b>-C. As a result, the transistor PM1-C gets turned off. A hysteresis of 10 LSB's was added to prevent switching between the FET's around the threshold of 156.25 mA. Thus, the LSB in the charger emulation mode for an 8-bit ADC is
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>1 LSB=(156.25 milli Amperes/2<sup>8</sup>)=610 micro Amperes&#x2003;&#x2003;(2)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0032" num="0031">In another embodiment, the auto-ranging system <b>200</b> may also operate in a third mode, removal detection. The removal detection mode demands even greater accuracy in terms of the ADC resolution for load current ILoad below 200 microamperes. For example, a USB Port Power Controller using the auto-ranging system <b>200</b> may operate in the removal detection mode for accurately determining events when the downstream device <b>122</b> is removed and the load current falls below 200 micro amperes. The USB Port Power controller has a removal detection mechanism to detect the removal event. When the auto-ranging system <b>200</b> is in charger emulation mode (i.e., the transistors PM1-A <b>202</b>-A and PM1-B <b>202</b>-B are turned ON), and the ADC <b>208</b> reading drops below 16 LSB's (each LSB being 610 micro amperes), only the transistor PM1-A <b>202</b>-A in the pass transistor PM1 <b>202</b> is turned ON. If the ADC reading falls below a threshold reading, a removal event is detected. The threshold for removal detection can be set by one-time programmable memory (OTP) included in the auto-ranging controller <b>110</b>. A hysteresis of 6 LSB's was used to switch between the state when only the transistor PM1-A <b>202</b>-A is turned ON and the state when all the three transistors are turned ON. As the current sense ADC conversion rate is only 2 KHz, a 200 mV drop comparator across Vbus was used to turn ON the Full transistor PM1 <b>202</b>, if the drop across Vbus exceeds 200 mV. The current sense resistor <b>206</b> can be trimmed for process variations using OTP. The truth table below shows the combination for which the different transistors PM1-A <b>202</b>-A, PM1-B <b>202</b>-B, and PM1-C <b>202</b>-C in the pass transistor PM1 <b>202</b> are turned ON for different values of switching signals &#x201c;Ibus_low&#x201d; and &#x201c;Ibus_super_low&#x201d;.</p>
<p id="p-0033" num="0032">
<tables id="TABLE-US-00001" num="00001">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="1">
<colspec colname="1" colwidth="217pt" align="center"/>
<thead>
<row>
<entry namest="1" nameend="1" rowsep="1">TABLE I</entry>
</row>
</thead>
<tbody valign="top">
<row>
<entry namest="1" nameend="1" align="center" rowsep="1"/>
</row>
<row>
<entry>Pass Transistor transition</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="3">
<colspec colname="1" colwidth="70pt" align="center"/>
<colspec colname="2" colwidth="49pt" align="center"/>
<colspec colname="3" colwidth="98pt" align="center"/>
<tbody valign="top">
<row>
<entry>Ibus_low</entry>
<entry>Ibus_super_low</entry>
<entry>Pass transistor PM1</entry>
</row>
<row>
<entry namest="1" nameend="3" align="center" rowsep="1"/>
</row>
<row>
<entry>0</entry>
<entry>0</entry>
<entry>Full FET</entry>
</row>
<row>
<entry>1</entry>
<entry>0</entry>
<entry> 1/16 FET</entry>
</row>
<row>
<entry>1</entry>
<entry>1</entry>
<entry>Small FET</entry>
</row>
<row>
<entry namest="1" nameend="3" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0034" num="0033">Thus, pass transistor PM1 operates in one of three ranges depending on how many of its component transistors is turned on. The range labeled Full FET is enabled when all the three transistors PM1-A <b>202</b>-A, PM1-B <b>202</b>-B, and PM1-C <b>202</b>-C are turned ON, allowing current flow in all three branches of the pass transistor PM1 <b>202</b>. Range 1/16 FET, which passes 1/16<sup>th </sup>of the maximum current, is operative when the transistors PM1-A <b>202</b>-A, and PM1-B <b>202</b>-B are turned ON. The lowest range, allowing only small amounts of current, range Small FET is operative when only the transistor PM1-A <b>202</b>-A is turned ON. This system yields a high precision measurement of load current by not only accurately detecting amperes of current in the high end but also detecting few microamperes of current at the low end.</p>
<p id="p-0035" num="0034">It will be understood that though embodiments of the present disclosure may be described using PMOS or NMOS transistors, the embodiments of this disclosure are not restricted to MOS transistors. The embodiments may, just as easily, be incorporated in an auto-ranging scheme, without departing from the scope of the present disclosure.</p>
<p id="h-0008" num="0000">Exemplary Methods</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 3</figref> is a flowchart depicting an exemplary method for auto-ranging an analog-to-digital converter for high precision current sensing. The method <b>300</b> illustrated in <figref idref="DRAWINGS">FIG. 3</figref> may be used in conjunction with any of the systems or devices shown in the previously described figures, among other devices. In various embodiments, some of the method elements shown may be performed concurrently, in a different order than shown, or may be omitted. Additional method elements may be performed as desired. As shown, the method <b>300</b> may operate as follows.</p>
<p id="p-0037" num="0036">At step <b>302</b>, the transistor arrangement <b>102</b> provides load current <b>124</b> ILoad to meet the power requirements of the downstream device <b>122</b>. The transistor arrangement <b>102</b>, connected to the downstream device <b>122</b>, is coupled between the supply voltage VS and the voltage Vbus. A control voltage signal Vg is provided to the transistor arrangement <b>102</b> to provide the required amount of the load current <b>124</b> ILoad. Switching signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d; are fed to the transistor arrangement <b>102</b> to determine the configuration of the transistor arrangement <b>102</b>.</p>
<p id="p-0038" num="0037">At step <b>304</b>, the replica device <b>104</b> replicates the load current <b>124</b> ILoad. The replica device <b>104</b> is connected to the transistor arrangement <b>102</b> to generate a replica current <b>126</b> based on the load current <b>124</b>. An auto-zeroed error amplifier <b>207</b> forces the VDS on replica transistor PM0 <b>204</b> to be the same as the pass transistor PM1 <b>202</b>. This causes accurate replication of the load current <b>214</b> ILoad to the replica current <b>126</b>. The replica current <b>126</b> is transferred to the current sense resistor <b>106</b>. In an embodiment, the replica current <b>126</b> is mirrored to flow through the current sense resistor <b>106</b>. A current mirror may be used to mirror the replicated current to the current sense resistor <b>106</b>.</p>
<p id="p-0039" num="0038">At step <b>306</b>, the current sense resistor <b>106</b> generates the replicated load voltage <b>128</b> based on the replicated current flowing through the current sense resistor <b>106</b>. The replicated load voltage <b>128</b> is fed to the ADC <b>108</b> as an input. The current sense resistor <b>106</b> monitors the replica current <b>126</b> and translates the amount of current into the replicated load voltage <b>128</b> that can be easily measured and monitored.</p>
<p id="p-0040" num="0039">At step <b>308</b>, the ADC <b>108</b> generates a digital value based on the replicated load voltage <b>128</b>. The replicated load voltage <b>128</b> is fed to the ADC <b>108</b> for analog to digital conversion of the voltage signal. The ADC <b>108</b> receives the replicated load voltage <b>128</b> signal and generates a digital value adc_data &#x3c;N:0&#x3e; corresponding to the replicated load voltage <b>128</b>. A signal &#x201c;adc_start&#x201d; initiates the functioning of the ADC <b>108</b>. The signal &#x201c;adc_start&#x201d; is an active high signal. Therefore, a high state of the signal &#x201c;adc_start&#x201d; signals the ADC <b>108</b> to start functioning. A clock signal &#x201c;adc_clk&#x201d; is supplied to the ADC <b>108</b> to clock the functioning of the ADC <b>108</b>. The ADC <b>108</b> also receives an auto-zero signal &#x201c;adc_az_sar&#x201d; to remove the offsets present in the ADC <b>108</b>. A voltage reference signal Vref is also provided to the ADC <b>108</b> to meet the voltage requirements. In an embodiment, the replicated load voltage <b>128</b> is input to a sample-and-hold, and anti-aliasing filter circuit for filtering the replicated load voltage <b>128</b> signal to restrict frequency bandwidth of the replicated load voltage <b>128</b> signal. The sample-and-hold, and anti-aliasing filter circuit prevents the aliasing of higher frequency signals back into the baseband of the ADC <b>208</b>. This voltage is then fed to the ADC <b>108</b>.</p>
<p id="p-0041" num="0040">At step <b>310</b>, the transistor arrangement <b>102</b> is dynamically configured based on the digital value. The auto-ranging controller <b>110</b> uses the output digital value adc_data &#x3c;N:<b>0</b>&#x3e; to generate switching signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d;. The switching signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d; are used to dynamically change the configuration of the transistor arrangement <b>102</b>. If the ADC <b>108</b> reading crosses a threshold value, the auto-ranging controller <b>110</b> sends an appropriate signal to the transistor arrangement <b>102</b> via signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d;. In an embodiment, the auto-ranging controller <b>110</b> may include a memory device for storing the threshold values of the digital value for determining the configuration of the transistor arrangement <b>102</b>. The memory device may include a one-time programmable memory (OTP). In another embodiment, the auto-ranging method <b>300</b> may also include switching the state of at least one of the transistors PM1-A <b>202</b>-A, PM1-B <b>202</b>-B, and PM1-C <b>202</b>-C to dynamically change the configuration of the transistor arrangement <b>102</b>. One or more of the three transistors PM1-A <b>202</b>-A, PM1-B <b>202</b>-B, and PM1-C <b>202</b>-C may be switched ON to provide the desired amount of current.</p>
<p id="p-0042" num="0041">In another embodiment, the auto-ranging method <b>300</b> may also include determining a state of switching signals &#x201c;Ibus_super_low&#x201d; and &#x201c;Ibus_low&#x201d; from a switching table for a configuration of the transistor arrangement <b>102</b>. The auto-ranging controller <b>110</b>, including a memory device may store a switching table. The switching table tabulates the state of switching signals for various configurations of the transistor arrangement <b>102</b>.</p>
<p id="p-0043" num="0042">The methods and systems discussed in the present disclosure provide techniques for auto-ranging an ADC for high precision current measurement. The disclosed techniques present a high precision auto-ranging scheme with low quiescent current demands. The circuit implementations of the auto-ranging systems will consume lesser die area. The auto-ranging technique allows the use of low resolution ADCs to achieve high resolution for very small load currents.</p>
<p id="p-0044" num="0043">Those in the art will understand that the steps set out in the discussion above may be combined or altered in specific adaptations of the disclosure. The illustrated steps are set out to explain the embodiment shown, and it should be anticipated that ongoing technological development will change the manner in which particular functions are performed. These depictions do not limit the scope of the present disclosure, which is determined solely by reference to the appended claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. An auto-ranging system for dynamically scaling inputs to an analog-to-digital converter, the auto-ranging system comprising:
<claim-text>a dynamically configurable transistor arrangement for providing a load current;</claim-text>
<claim-text>a replica device for replicating the load current and generating a replicated load voltage based on the replicated current;</claim-text>
<claim-text>an analog-to-digital converter for generating a digital value based on the replicated load voltage; and</claim-text>
<claim-text>an auto-ranging controller for dynamically configuring the transistor arrangement based on the digital value to scale the inputs to the analog-to-digital converter.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The auto-ranging system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising an anti-aliasing filter for restricting frequency bandwidth of the replicated load voltage.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The auto-ranging system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising a current mirror for mirroring the replicated load current.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The auto-ranging system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising a current sense resistor for generating the replicated load voltage based on the replicated current.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The auto-ranging system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the transistor arrangement includes at least three transistors connected in parallel to each other.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The auto-ranging system of <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein a state of a transistor is switched to dynamically configure of the transistor arrangement.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The auto-ranging system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the auto-ranging controller includes a memory device for storing a threshold value of the digital value for determining the configuration of the transistor arrangement.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The auto-ranging system of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the memory device is a one-time programmable memory.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The auto-ranging system of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the memory device stores a switching table for determining a state of switches which change the configuration of transistor arrangement.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The auto-ranging system of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the analog-to-digital converter is an 8-bit successive-approximation-register (SAR) analog-to-digital converter (ADC).</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. An auto-ranging method for dynamically scaling inputs to an analog-to-digital converter, the auto-ranging method comprising:
<claim-text>providing a load current by a dynamically configurable transistor arrangement;</claim-text>
<claim-text>replicating the load current;</claim-text>
<claim-text>generating a replicated load voltage based on the replicated current;</claim-text>
<claim-text>generating a digital value based on the replicated load voltage by the analog-to-digital converter; and</claim-text>
<claim-text>dynamically configuring the transistor arrangement based on the digital value to scale the inputs to the analog-to-digital converter.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The auto-ranging method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, further comprising filtering the replicated load voltage to restrict frequency bandwidth of the replicated load voltage.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The auto-ranging method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, further comprising mirroring the replicated load current by a current mirror.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The auto-ranging method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein the transistor arrangement includes at least three transistors connected in parallel to each other.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The auto-ranging method of <claim-ref idref="CLM-00014">claim 14</claim-ref>, further comprising switching a state of a transistor to dynamically configure of the transistor arrangement.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The auto-ranging method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, further comprising determining the configuration of the transistor arrangement based on a threshold value of the digital value.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The auto-ranging method of <claim-ref idref="CLM-00011">claim 11</claim-ref>, further comprising determining a state of switching signals from a switching table for a configuration of the transistor arrangement. </claim-text>
</claim>
</claims>
</us-patent-grant>
