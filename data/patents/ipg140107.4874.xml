<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08625968-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08625968</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>13013425</doc-number>
<date>20110125</date>
</document-id>
</application-reference>
<us-application-series-code>13</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2010-022524</doc-number>
<date>20100203</date>
</priority-claim>
</priority-claims>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>N</subclass>
<main-group>5</main-group>
<subgroup>94</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>N</subclass>
<main-group>9</main-group>
<subgroup>88</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>N</subclass>
<main-group>9</main-group>
<subgroup>80</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>386263</main-classification>
<further-classification>386239</further-classification>
<further-classification>386248</further-classification>
</classification-national>
<invention-title id="d2e61">Recording apparatus and control method thereof</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6031758</doc-number>
<kind>A</kind>
<name>Katayama et al.</name>
<date>20000200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>7283729</doc-number>
<kind>B2</kind>
<name>Chung et al.</name>
<date>20071000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>386318</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>7979636</doc-number>
<kind>B2</kind>
<name>Ito</name>
<date>20110700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>2003/0041253</doc-number>
<kind>A1</kind>
<name>Matsui et al.</name>
<date>20030200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713189</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2003/0191980</doc-number>
<kind>A1</kind>
<name>Gotoh et al.</name>
<date>20031000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>714  7</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2005/0259163</doc-number>
<kind>A1</kind>
<name>Tsujii et al.</name>
<date>20051100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>3482312</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2007/0222896</doc-number>
<kind>A1</kind>
<name>Oikawa</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2008/0046649</doc-number>
<kind>A1</kind>
<name>Ito</name>
<date>20080200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2009/0180209</doc-number>
<kind>A1</kind>
<name>Maeda et al.</name>
<date>20090700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2009/0313444</doc-number>
<kind>A1</kind>
<name>Nakamura</name>
<date>20091200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2010/0115185</doc-number>
<kind>A1</kind>
<name>Ono et al.</name>
<date>20100500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2011/0264842</doc-number>
<kind>A1</kind>
<name>Nakanishi et al.</name>
<date>20111000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>JP</country>
<doc-number>09-223363</doc-number>
<kind>A</kind>
<date>19970800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>JP</country>
<doc-number>2002-109895</doc-number>
<date>20020400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>JP</country>
<doc-number>2008-046923</doc-number>
<date>20080200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>JP</country>
<doc-number>2008-097148</doc-number>
<kind>A</kind>
<date>20080400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>JP</country>
<doc-number>2008-097169</doc-number>
<kind>A</kind>
<date>20080400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>WO</country>
<doc-number>2008/018446</doc-number>
<kind>A1</kind>
<date>20080200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00019">
<document-id>
<country>WO</country>
<doc-number>2009/001519</doc-number>
<kind>A1</kind>
<date>20081200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00020">
<othercit>Naru Hamada, U.S. Appl. No. 12/977,663, filed Dec. 23, 2010.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00021">
<othercit>Naru Hamada, U.S. Appl. No. 13/014,349, filed Jan. 26, 2011.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00022">
<othercit>Naru Hamada, U.S. Appl. No. 13/013,474, filed Jan. 25, 2011.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00023">
<othercit>May 3, 2012 U.S Office Action, that issued in related U.S. Appl. No. 12/977,663.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00024">
<othercit>Jun. 12, 2013 U.S Office Action, that issued in related U.S. Appl. No. 12/977,663.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00025">
<othercit>Aug. 28, 2013 U.S. Office Action, that issued in related U.S. Appl. No. 13/014,349.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00026">
<othercit>Sep. 24, 2013 Japanese Office Action, that issued in Japanese Patent Application No. 2010-022522, which is a counterpart application of the related U.S. Appl. No. 13/013,474.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>10</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>386239-248</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>386263-277</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>10</number-of-drawing-sheets>
<number-of-figures>10</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20110188834</doc-number>
<kind>A1</kind>
<date>20110804</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Matsushima</last-name>
<first-name>Shuichiro</first-name>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
<residence>
<country>JP</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Matsushima</last-name>
<first-name>Shuichiro</first-name>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Cowan, Liebowitz &#x26; Latman, P.C.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Canon Kabushiki Kaisha</orgname>
<role>03</role>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Dang</last-name>
<first-name>Hung</first-name>
<department>2484</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A recording apparatus is disclosed that records information data and file system information for managing a file containing the information data in accordance with a predetermined file system to a recording medium having a plurality of blocks including an alternative block for a detect block. The data recorded in the recording medium is managed in accordance with the predetermined file system. The recording apparatus sets a threshold based on the size of the file system information, and if the alternative block remaining amount in the recording medium is less than or equal to the threshold, recording of the information data to the recording medium is inhibited.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="222.42mm" wi="156.13mm" file="US08625968-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="159.68mm" wi="157.65mm" file="US08625968-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="150.96mm" wi="166.71mm" file="US08625968-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="160.44mm" wi="130.64mm" file="US08625968-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="168.15mm" wi="135.89mm" file="US08625968-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="238.51mm" wi="154.77mm" file="US08625968-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="239.18mm" wi="163.91mm" file="US08625968-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="240.28mm" wi="164.93mm" file="US08625968-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="237.15mm" wi="153.75mm" file="US08625968-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="244.01mm" wi="174.84mm" file="US08625968-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="230.12mm" wi="143.93mm" file="US08625968-20140107-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0002" num="0001">1. Field of the Invention</p>
<p id="p-0003" num="0002">The present invention relates to a recording apparatus utilizing a flash memory and a control method of the recording apparatus.</p>
<p id="p-0004" num="0003">2. Description of the Related Art</p>
<p id="p-0005" num="0004">Conventionally, video cameras that record moving images and audio to recording media are known. More recently, video cameras that record moving images and audio to a large capacity flash memory or a memory card incorporating a flash memory have appeared.</p>
<p id="p-0006" num="0005">A flash memory writes and reads out data in units called blocks. There are cases, however, in which a defect block in which data cannot be written normally may occur during the manufacturing process or due to a later cause. To address this, a part of the memory is prepared for use as alternative blocks for such a defect block, and data that is supposed to be recorded to the defect block is written to an alternative block (see, for example, Japanese Patent Laid-Open No. 2002-109895).</p>
<p id="p-0007" num="0006">However, even when a part of the flash memory is prepared for use as alternative blocks, if a defect block occurs after the alternative blocks have been used up, normal data writing is not possible, causing a writing error. In particular, when such a situation occurs during the writing of file system information to close a file, the file cannot be closed, and there is a possibility that not only this file but also all files recorded in the memory up to that point not be able to be read out.</p>
<p id="p-0008" num="0007">When data is recorded to a flash memory, the recorded data is generally managed in accordance with a predetermined file system such as FAT (File Allocation Table). Accordingly, if the alternative blocks are used up during recording of moving images with a video camera, when a defect block is found during recording of file system information for managing the recorded file, rewriting of the file system information is not possible. Furthermore, if the alternative blocks are used up during update of the file system, the file system information might be corrupted, and data that has already been recorded might not be able to be read out.</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0009" num="0008">The present invention has been made in view of the above-described problems, and an embodiment of the present invention provides a recording apparatus that can more reliably perform normal update of file system information in a recording medium having alternative blocks, and a control method of the recording apparatus.</p>
<p id="p-0010" num="0009">According to one aspect of the present invention, there is provided a recording apparatus comprising: a recording unit configured to record information data and file system information for managing a file containing the information data in accordance with a predetermined file system to a recording medium having a plurality of blocks including an alternative block for a defect block; a managing unit configured to manage the information data recorded in the recording medium in accordance with the predetermined file system; a setting unit configured to set a threshold based on a data size of the file system information; and a control unit configured to control the recording unit so as to inhibit recording of the information data to the recording medium if an alternative block remaining amount in the recording medium is less than or equal to the threshold.</p>
<p id="p-0011" num="0010">Also, according to another aspect of the present invention, there is provided a control method of a recording apparatus including a recording unit configured to record information data and file system information for managing a file containing the information data in accordance with a predetermined file system to a recording medium having a plurality of blocks including an alternative block for a defect block, the method comprising the steps of: managing the information data recorded in the recording medium in accordance with the predetermined file system; setting a threshold based on a size of the file system information; and controlling the recording unit so as to inhibit recording of the information data to the recording medium if an alternative block remaining amount in the recording medium is less than or equal to the threshold.</p>
<p id="p-0012" num="0011">Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 1A</figref> is a diagram showing a configuration of a video camera according to a first embodiment of the present invention.</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 1B</figref> is a diagram showing a configuration of a video camera according to a third embodiment of the present invention.</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 2</figref> is a diagram showing a configuration of a recording medium according to an embodiment of the present invention.</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 3</figref> is a flowchart illustrating recording medium mounting processing.</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 4</figref> is a flowchart illustrating determination processing for determining whether or not recording is possible.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 5</figref> is a flowchart illustrating recording processing.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 6</figref> is a flowchart illustrating determination processing for determining whether or not recording is possible.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 7</figref> is a flowchart illustrating recording processing.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 8</figref> is a flowchart illustrating determination processing for determining whether or not recording is possible.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 9</figref> is a flowchart illustrating still image recording processing.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DESCRIPTION OF THE EMBODIMENTS</heading>
<p id="p-0023" num="0022">Hereinafter, preferred embodiments of the present invention will be described with reference to the accompanying drawings.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 1A</figref> is a block diagram showing a configuration of a video camera <b>100</b> according to a first embodiment of the present invention. In <figref idref="DRAWINGS">FIG. 1A</figref>, an image capturing unit <b>101</b> captures images of an object and outputs moving image data to a signal processing unit <b>103</b>. An audio input unit <b>102</b> has a microphone, and outputs audio data to the signal processing unit <b>103</b>. When recording, the signal processing unit <b>103</b> performs necessary processing, such as compression, encoding and the like according to a predetermined encoding method such as MPEG, on the moving image data from the image capturing unit <b>101</b> and the audio data from the audio input unit <b>102</b>. When reproducing, the signal processing unit <b>103</b> decodes reproduced moving image data and audio data. A display unit <b>104</b> displays captured moving images from the signal processing unit <b>103</b> when recording. When reproducing, the display unit <b>104</b> displays reproduced moving images. The display unit <b>104</b> also displays information necessary for user operations such as a menu. An audio output unit <b>105</b> has a speaker, and outputs an audio signal from the signal processing unit <b>103</b>.</p>
<p id="p-0025" num="0024">A control unit <b>106</b> has a microcomputer, a memory and the like, and controls various constituent units of the video camera <b>100</b>. An operation unit <b>107</b> has a power switch, a switch for issuing instructions to start and stop recording, a switch for switching to a reproduction mode, a menu switch, and the like. The user can designate a function of the video camera <b>100</b> through operation of any of the switches of the operation unit <b>107</b>. A memory <b>108</b> has an SDRAM or the like, and stores compressed moving image data, audio data, and other necessary data. The memory <b>108</b> also functions as a buffer memory when recording or reproducing data to or from a recording medium <b>200</b>. A record/reproduction unit <b>109</b> writes or reads out data to or from the recording medium <b>200</b> in accordance with an instruction from the control unit <b>106</b>. The recording medium <b>200</b> is a random access recording medium, and is a memory card incorporating a NAND flash memory in the present embodiment. The recording medium <b>200</b> can be easily attached to and detached from the video camera <b>100</b> by the user with an attachment/detachment mechanism (not shown). A system bus <b>110</b> transmits data and various commands between the blocks.</p>
<p id="p-0026" num="0025">In the present embodiment, the control unit <b>106</b> manages information data, such as moving images and audio, recorded in the recording medium <b>200</b> as a file in accordance with a predetermined file system such as FAT file system. Accordingly, in addition to the information file in which information data is stored, file system information for managing the recorded file is recorded to the recording medium <b>200</b>. The file system information recorded in the recording medium <b>200</b> is updated along with information file recording processing. The record/reproduction unit <b>109</b> may have a configuration corresponding to a general-purpose interface such as ATA (Advanced Technology Attachment). In this case, the control unit <b>106</b> controls writing and readout of data to and from the recording medium <b>200</b> by outputting a command defined by the general-purpose interface to the record/reproduction unit <b>109</b>.</p>
<p id="p-0027" num="0026">Next, the recording medium <b>200</b> will be described. <figref idref="DRAWINGS">FIG. 2</figref> is a block diagram showing a configuration of the recording medium <b>200</b>. As shown in <figref idref="DRAWINGS">FIG. 2</figref>, the recording medium <b>200</b> has an interface (I/F) <b>201</b> that transmits and receives data and commands to and from a recording apparatus such as the video camera <b>100</b>, a controller <b>202</b>, and a NAND flash memory <b>203</b>. The recording medium <b>200</b> is capable of writing data into the flash memory <b>203</b> in blocks, each consisting of a plurality of bytes, and is configured such that a part of all blocks is utilized as alternative blocks for defect blocks in which data cannot be written normally. In other words, the flash memory <b>203</b> has, as a storage unit, a data block area <b>203</b><i>a </i>and an alternative block area <b>203</b><i>b </i>for defect blocks in the data block area. In the present embodiment, a predetermined physical address area in the flash memory <b>203</b> has been allocated in advance as the alternative block area <b>203</b><i>b. </i></p>
<p id="p-0028" num="0027">In <figref idref="DRAWINGS">FIG. 2</figref>, the interface (I/F) <b>201</b> transmits and receives commands and data to and from the record/reproduction unit <b>109</b> of the video camera <b>100</b>. The controller <b>202</b> controls writing or readout of data to or from the flash memory <b>203</b> in response to a command received by the I/F <b>201</b>. For example, upon receiving a write request command from the record/reproduction unit <b>109</b>, the controller <b>202</b> receives data to be written from the record/reproduction unit <b>109</b> and writes the data to the data block area <b>203</b><i>a</i>. If the writing processing has completed normally, the controller <b>202</b> generates a writing result as a response, and transmits the response to the record/reproduction unit <b>109</b> via the recording I/F <b>201</b>.</p>
<p id="p-0029" num="0028">If the writing of data to the data block area <b>203</b><i>a </i>does not complete within a predetermined period of time, the controller <b>202</b> determines that a defect block has occurred, and writes the data to an unused block in the alternative block area <b>203</b><i>b </i>instead of the defect block. The controller <b>202</b> then changes an address map of the flash memory <b>203</b> so as to replace the address of the defect block with the address of the alternative block. Furthermore, the controller <b>202</b> generates a response indicating a writing error, and transmits the response to the record/reproduction unit <b>109</b> via the I/F <b>201</b>. Upon occurrence of a defect block(s), the controller <b>202</b> writes information regarding the position and the number of defect blocks that have occurred, and so on, to a system management area in the data block area <b>203</b><i>a</i>. In other words, the controller <b>202</b> allocates an address (physical address) in the flash memory <b>203</b> to an address (logical address) designated by an external device, and generates an address map indicating correspondences between logical addresses and physical addresses. Then, when a defect block occurs, the controller <b>202</b> changes the address map so as to allocate the physical address of an alternative block to the designated logical address. The controller <b>202</b> saves the address map in the data block area <b>203</b><i>a. </i></p>
<p id="p-0030" num="0029">If the alternative block area <b>203</b><i>b </i>for defect blocks has been used up, the controller <b>202</b> writes information indicating that the recording medium is a reproduction-only (read-only) recording medium to the system management area in the data block area <b>203</b><i>a</i>. By doing so, the controller <b>202</b> can transmit a response indicating that the recording medium is for reproduction only when a query for the operational state of the recording medium <b>200</b> is received from a host device such as the video camera <b>100</b>.</p>
<p id="p-0031" num="0030">As will be described later, the controller <b>202</b> receives a threshold for comparison with available remaining amount of the alternative block area from the video camera <b>100</b>, and holds the threshold in an internal register. Then, the controller <b>202</b> compares the alternative block remaining amount recorded in the system management area with the threshold, and if the alternative block remaining amount is less than or equal to the threshold, the controller <b>202</b> notifies the record/reproduction unit <b>109</b> of information indicating that the alternative block remaining amount is insufficient via the I/F <b>201</b>. Also, the controller <b>202</b> compares the alternative block remaining amount and the threshold each time writing to an alternative block is performed during writing of data, and determines whether the alternative block remaining amount is larger than the threshold. The controller <b>202</b> then outputs a notification indicating whether the alternative block remaining amount is insufficient in response to a query from the video camera <b>100</b> as to whether the remaining amount is insufficient.</p>
<p id="p-0032" num="0031">Next, a description of recording preparation (mounting) processing for the recording medium <b>200</b> performed when the recording medium <b>200</b> is attached and when the power of the video camera <b>100</b> is turned on will be given. <figref idref="DRAWINGS">FIG. 3</figref> is a flowchart illustrating the mounting processing. The processing shown in <figref idref="DRAWINGS">FIG. 3</figref> is executed by the control unit <b>106</b> controlling various units.</p>
<p id="p-0033" num="0032">When the power of the video camera <b>100</b> is turned on, the record/reproduction unit <b>109</b> determines whether the recording medium <b>200</b> is attached, and if the recording medium <b>200</b> is attached, the record/reproduction unit <b>109</b> so notifies the control unit <b>106</b>. Alternatively, the record/reproduction unit <b>109</b> detects that the recording medium <b>200</b> has been newly attached while the power of the video camera <b>100</b> is on, and so notifies the control unit <b>106</b>. The processing shown in <figref idref="DRAWINGS">FIG. 3</figref> starts when the record/reproduction unit <b>109</b> notifies that the recording medium <b>200</b> is attached upon power-on of the video camera <b>100</b> or when the record/reproduction unit <b>109</b> detects that the recording medium <b>200</b> has been newly attached as described above.</p>
<p id="p-0034" num="0033">Firstly, the control unit <b>106</b> executes initial communication (S<b>301</b>). In the initial communication, the control unit <b>106</b> resets the controller <b>202</b> of the recording medium <b>200</b>, and receives register information of the recording medium <b>200</b> necessary to record data from the recording medium <b>200</b>. Next, the control unit <b>106</b> executes determination processing for determining whether recording of data to the recording medium <b>200</b> is possible in accordance with the obtained information (S<b>302</b>). The determination processing will be described later in detail. If it is determined that recording is possible (S<b>303</b>), the control unit <b>106</b> executes recording preparation processing (S<b>304</b>). More specifically, the control unit <b>106</b> reads out file system information from the recording medium <b>200</b>, stores the file system information in the memory <b>108</b>, analyzes the content of the file system information, and obtains information necessary for recording such as the remaining recording capacity of the recording medium <b>200</b>. Also, the control unit <b>106</b> checks the files recorded in the recording medium <b>200</b>, and searches for a file that can be managed by the video camera <b>100</b>. If, on the other hand, it is determined that the recording in S<b>303</b> is to be inhibited, the control unit <b>106</b> displays warning information indicating that data recording is not possible to the recording medium <b>200</b> on the display unit <b>104</b>, and terminates the mounting processing without performing recording preparation processing.</p>
<p id="p-0035" num="0034">Next, the determination processing (S<b>302</b>) for determining whether or not recording is possible that is performed in the processing for mounting the recording medium <b>200</b> (<figref idref="DRAWINGS">FIG. 3</figref>) will be described. <figref idref="DRAWINGS">FIG. 4</figref> is a flowchart illustrating the determination processing for determining whether or not recording is possible. In <figref idref="DRAWINGS">FIG. 4</figref>, firstly, the control unit <b>106</b> queries the recording medium <b>200</b> for the state of the recording medium <b>200</b>, and determines whether the recording medium <b>200</b> is a reproduction-only recording medium based on a response from the controller <b>202</b> of the recording medium <b>200</b> (S<b>401</b>). If it is determined that the recording medium <b>200</b> is a reproduction-only recording medium, the control unit <b>106</b> displays warning information indicating the fact on the display unit <b>104</b> (S<b>406</b>), and inhibits data recording (S<b>407</b>).</p>
<p id="p-0036" num="0035">If, on the other hand, it is determined in S<b>401</b> that the recording medium <b>200</b> is not a reproduction-only recording medium, the control unit <b>106</b> sets a threshold for comparison with the remaining amount of alternative blocks (the amount of unused alternative blocks) in the alternative block area <b>203</b><i>b </i>of the recording medium <b>200</b> (S<b>402</b>). The processing for setting the threshold will be described later. Then, the control unit <b>106</b> transmits a query as to whether the alternative block remaining amount is insufficient to the controller <b>202</b> of the recording medium <b>200</b> together with information regarding the set threshold (S<b>403</b>). When the threshold is transmitted from the video camera <b>100</b>, the controller <b>202</b> holds the threshold information in the internal register as described above. Then, the controller <b>202</b> detects the alternative block remaining amount in the alternative block area <b>203</b><i>b</i>, and compares the alternative block remaining amount with the transmitted threshold. If the result of comparison indicates that the alternative block remaining amount is smaller than the threshold, the controller <b>202</b> transmits information indicating that the alternative block remaining amount is insufficient to the record/reproduction unit <b>109</b>. The record/reproduction unit <b>109</b> receives the information indicating that the alternative block remaining amount is insufficient, and transmits the information to the control unit <b>106</b>.</p>
<p id="p-0037" num="0036">If the control unit <b>106</b> receives a notification indicating that the alternative block remaining amount is not insufficient (S<b>404</b>), it permits data recording to the recording medium <b>200</b> (S<b>405</b>). If the control unit <b>106</b> receives a notification indicating that the alternative block remaining amount is insufficient (S<b>404</b>), it displays warning information indicating that recording is not possible to the recording medium <b>200</b> on the display unit <b>104</b> (S<b>408</b>), and inhibits recording to the recording medium <b>200</b> (S<b>407</b>).</p>
<p id="p-0038" num="0037">Next, recording processing will be described. <figref idref="DRAWINGS">FIG. 5</figref> is a flowchart illustrating recording processing of the video camera <b>100</b>. The processing shown in <figref idref="DRAWINGS">FIG. 5</figref> is executed by the control unit <b>106</b> controlling various units. The processing shown in <figref idref="DRAWINGS">FIG. 5</figref> starts when the user issues an instruction to start recording through operation of the operation unit <b>107</b>. Firstly, the control unit <b>106</b> performs file open processing for opening a moving image file for storing captured moving image data and input audio data (S<b>501</b>). In this processing, the control unit <b>106</b> determines the file name, and registers the file information thereof in the file system information stored in the memory <b>108</b>.</p>
<p id="p-0039" num="0038">Also, the control unit <b>106</b> controls the signal processing unit <b>103</b> so as to compress the moving image data from the image capturing unit <b>101</b> and the audio data from the audio input unit <b>102</b>, and stores the compressed moving image data and audio data in the memory <b>108</b>. Then, when a predetermined amount of moving image data and audio data corresponding to a writing unit is stored in the memory <b>108</b>, the control unit <b>106</b> reads out the data from the memory <b>108</b>, and writes the data into the recording medium <b>200</b> (S<b>502</b>). In the present embodiment, the rate at which data can be written into the recording medium <b>200</b> is higher than the rate of the moving image data and audio data output from the signal processing unit <b>103</b>. Accordingly, writing of data to the recording medium <b>200</b> is performed intermittently. The memory <b>108</b> functions as a buffer memory for such intermittent recording. More specifically, when the amount of moving image data and audio data corresponding to a preset writing unit have been stored in the memory <b>108</b>, the control unit <b>106</b> starts data writing to the recording medium <b>200</b>. After that, when writing of data per writing unit is complete, the control unit <b>106</b> stops data writing to the recording medium <b>200</b>. In this manner, by repeating the writing of data per writing unit, data is intermittently written.</p>
<p id="p-0040" num="0039">When a single recording unit of data has been written in the manner described above, the control unit <b>106</b> queries the recording medium <b>200</b> for the state of alternative block remaining amount (S<b>503</b>). The controller <b>202</b> of the recording medium <b>200</b> compares the alternative block remaining amount and the threshold, and notifies the result of comparison in the manner described above. The control unit <b>106</b> determines whether or not it has received a notification indicating that the alternative block remaining amount is insufficient in response to the query (S<b>504</b>). If the control unit <b>106</b> receives a notification indicating that the alternative block remaining amount is insufficient, it stops writing data without waiting for a user's instruction to stop recording (S<b>506</b>), and closes the currently recorded file (S<b>507</b>). Then, the control unit <b>106</b> changes the content of the file system information stored in the memory <b>108</b> along with the stopping of recording, writes the file system information into the recording medium <b>200</b>, and thereby updates the file system information (S<b>508</b>).</p>
<p id="p-0041" num="0040">If, on the other hand, the control unit <b>106</b> receives a notification indicating that the alternative block remaining amount is larger than the threshold in S<b>504</b>, it continues writing, and waits for an instruction to stop recording from the user. If the user issues an instruction to stop recording through operation of the operation unit <b>107</b> (S<b>505</b>), the control unit <b>106</b> soon stops storing new moving image data and audio data in the memory <b>108</b>, writes the stored data into the recording medium <b>200</b>, and thereafter stops writing (S<b>506</b>). Then, the control unit <b>106</b> closes the currently recorded file (S<b>507</b>), changes the content of the file system information stored in the memory <b>108</b>, and writes the file system information into the recording medium <b>200</b>, thereby updating the file system information (S<b>508</b>).</p>
<p id="p-0042" num="0041">Next, the threshold set in S<b>402</b> of <figref idref="DRAWINGS">FIG. 4</figref> will be described. In the present embodiment, the threshold is set such that when updating the file system information recorded in the recording medium <b>200</b>, even if the blocks designated to record the file system information are all defect blocks, the file system information can be updated by recording the file system information in alternative blocks.</p>
<p id="p-0043" num="0042">The amount of data needed to update the file system information when closing a file is, in the case of FAT32, the sum of a block capacity needed to write a file entry and a block capacity needed to update the FAT. For example, where the size needed to update the FAT and file entry is assumed to be 4 mega bytes (MB), if the alternative block remaining amount is 4 MB or more when closing the file, the file system information can be updated normally. Here, if the size of one block in the recording medium <b>200</b> is assumed to be 2 MB, the number of alternative blocks needed to update the file system information will be two. It should be noted that the size of one block of 2 MB is merely exemplary, and the present invention is not limited thereto.</p>
<p id="p-0044" num="0043">Furthermore, in the present embodiment, the threshold may be set based on the amount of data per writing unit. For example, in S<b>503</b> of <figref idref="DRAWINGS">FIG. 5</figref>, a query for the state of alternative blocks is made after completion of writing of data per writing unit, and if the alternative block remaining amount is low, recording is stopped. Accordingly, the total of the amount of the single writing unit of data and the size needed to update the file system information is set as the threshold. By doing so, even if the blocks designated as a place into which one writing unit of data to be written next is to be written are all defect blocks, the single writing unit of data to be written next is all recorded in alternative blocks.</p>
<p id="p-0045" num="0044">For example, if one writing unit is assumed to be N bytes, writing data into the recording medium <b>200</b> starts each time N-byte data is stored in the memory <b>108</b>. And, the sum of N bytes and the size needed to update the file system information is set as the threshold. For example, if the amount of data needed to update the file system information is assumed to be M bytes, the threshold is set to N+M bytes. In this manner, in the present embodiment, in S<b>402</b>, N+M bytes is set as the threshold, and the threshold is transmitted to the controller <b>202</b> of the recording medium <b>200</b>.</p>
<p id="p-0046" num="0045">If the size of one writing unit is reduced, the threshold can be set to a smaller value. The smaller the threshold, the more alternative block capacity will be used by the time recording is stopped, enabling more efficient use of the recording medium. This, however, increases the frequency of issuance of write instructions from the control unit <b>106</b> to the record/reproduction unit <b>109</b>. On the other hand, if the size of one writing unit is increased, the frequency of issuance of write instructions from the control unit <b>106</b> to the record/reproduction unit <b>109</b> can be decreased, enabling efficient use of the bandwidth of the system bus <b>110</b>.</p>
<p id="p-0047" num="0046">It is also possible to set the threshold independently of the writing unit. For example, a configuration can be employed in which the controller <b>202</b> of the recording medium <b>200</b> regularly compares the alternative block remaining amount and the threshold, and if the alternative block remaining amount is smaller than the threshold, the record/reproduction unit <b>109</b> is so notified even while data is being written. With this configuration, it is possible to detect insufficiency of the alternative block remaining amount and immediately stop writing of data to the recording medium <b>200</b> even while one writing unit of data is being written. In this case, the data size needed to update the file system information can be set as the threshold.</p>
<p id="p-0048" num="0047">In the present embodiment, in <figref idref="DRAWINGS">FIG. 5</figref>, a query for the state of alternative blocks is made to the recording medium <b>200</b> each time writing of one writing unit of data is complete, but the present invention is not limited thereto. It is possible to, for example, make a query before writing of one writing unit of data starts. Also, if there is information, other than the file system information, that needs to be updated along with recording of moving image data such as management information for managing the order of reproduction of recorded data, the threshold may be set based on the size of the management information. The threshold is set so as to secure an alternative block remaining amount that is more than or equal to the data size needed to update at least file system information, and the data size of the file system information may be used as the threshold.</p>
<p id="p-0049" num="0048">Next, reproduction processing will be described. Upon receiving an instruction for a reproduction mode from the operation unit <b>107</b>, the control unit <b>106</b> controls the record/reproduction unit <b>109</b> so as to read out each moving image file recorded in the recording medium <b>200</b> and output the moving image file to the signal processing unit <b>103</b>. The signal processing unit <b>103</b> decodes the first image of each moving image file, generates a representative image for each moving image file by using the first image, and displays a list of representative images on the display unit <b>104</b>.</p>
<p id="p-0050" num="0049">When the user selects a desired representative image from the list of representative images, and issues an instruction to start reproduction, the control unit <b>106</b> instructs the record/reproduction unit <b>109</b> so as to reproduce the moving image file corresponding to the selected representative image. The record/reproduction unit <b>109</b> reproduces the selected moving image file from the recording medium <b>200</b>, and outputs the moving image file to the signal processing unit <b>103</b>. The signal processing unit <b>103</b> decodes the moving image data and audio data of the reproduced moving image file, and outputs the moving image data and audio data to the display unit <b>104</b> and the audio output unit <b>105</b>, respectively. The control unit <b>106</b> stops reproduction of the moving image file when it receives an instruction to stop reproduction.</p>
<p id="p-0051" num="0050">In the manner described above, according to the first embodiment, the threshold is set based on the amount of data needed to update the file system information and the amount of data per writing unit, and if the alternative block remaining amount in the recording medium <b>200</b> reaches the threshold value, recording is stopped. Accordingly, the file system information can be updated more reliably, and the recorded data can be normally recorded and reproduced.</p>
<p id="p-0052" num="0051">A second embodiment will be described next. The first embodiment has described the configuration in which information regarding the set threshold is transmitted to the controller <b>202</b> of the recording medium <b>200</b>, and the controller <b>202</b> transmits the result of comparison between the alternative block remaining amount and the threshold to the video camera <b>100</b>. The second embodiment will describe a configuration in which a video camera <b>100</b> receives information regarding the alternative block remaining amount from a recording medium <b>200</b>, compares the received alternative block remaining amount with a threshold, and determines whether the recording is stopped based on the comparison result. The video camera <b>100</b> according to the second embodiment has the same configuration as that of the first embodiment (<figref idref="DRAWINGS">FIG. 1A</figref>). Also, the recording medium <b>200</b> according to the second embodiment basically have the same configuration as that of the first embodiment (<figref idref="DRAWINGS">FIG. 2</figref>). However, a controller <b>202</b> according to the second embodiment is configured so as to detect an alternative block remaining amount when it has received a request to transmit the alternative block remaining amount from the video camera <b>100</b> and transmit information indicating the remaining amount to the video camera <b>100</b>.</p>
<p id="p-0053" num="0052"><figref idref="DRAWINGS">FIG. 6</figref> is a flowchart illustrating determination processing for determining whether or not recording is possible (S<b>302</b> of <figref idref="DRAWINGS">FIG. 3</figref>) according to the second embodiment. In <figref idref="DRAWINGS">FIG. 6</figref>, firstly, the control unit <b>106</b> queries the recording medium <b>200</b> for the state of the recording medium <b>200</b>. Then, the control unit <b>106</b> determines whether the recording medium <b>200</b> is a reproduction-only recording medium based on a response from the controller <b>202</b> of the recording medium <b>200</b> (S<b>601</b>). If it is determined that the recording medium <b>200</b> is a reproduction-only recording medium, the control unit <b>106</b> displays warning information indicating the fact on the display unit <b>104</b> (S<b>607</b>), and inhibits data recording (S<b>608</b>).</p>
<p id="p-0054" num="0053">If, on the other hand, it is determined in S<b>601</b> that the recording medium <b>200</b> is not a reproduction-only recording medium, the control unit <b>106</b> requests the recording medium <b>200</b> to transmit information regarding the alternative block remaining amount (S<b>602</b>). Upon receiving the request for the information regarding the alternative block remaining amount from the video camera <b>100</b>, the controller <b>202</b> detects the alternative block remaining amount in the alternative block area <b>203</b><i>b</i>, and transmits information indicating the remaining amount to the record/reproduction unit <b>109</b>. The record/reproduction unit <b>109</b> receives the information indicating the alternative block remaining amount, and transmits the information to the control unit <b>106</b> (S<b>603</b>).</p>
<p id="p-0055" num="0054">Upon receiving the information regarding the alternative block remaining amount, the control unit <b>106</b> sets a threshold for comparison with the alternative block remaining amount of the recording medium <b>200</b> (S<b>604</b>). Then, the control unit <b>106</b> compares the received alternative block remaining amount with the threshold, and determines whether the alternative block remaining amount is larger than the threshold (S<b>605</b>). If it is determined as a result that the alternative block remaining amount is larger than the threshold, the control unit <b>106</b> permits data recording to the recording medium <b>200</b> (S<b>606</b>). If it is determined that the alternative block remaining amount is not larger than the threshold, (less than or equal to the threshold), the control unit <b>106</b> displays warning information indicating that data recording is not possible to the recording medium <b>200</b> (S<b>609</b>), and inhibits data recording to the recording medium <b>200</b> (S<b>608</b>). The method of setting the threshold is the same as that of the first embodiment.</p>
<p id="p-0056" num="0055">Next, recording processing according to the second embodiment will be described. <figref idref="DRAWINGS">FIG. 7</figref> is a flowchart illustrating recording processing according to the second embodiment. In <figref idref="DRAWINGS">FIG. 7</figref>, the processing blocks that are the same as those of <figref idref="DRAWINGS">FIG. 5</figref> are given the same reference numerals, and a detailed description thereof is omitted here.</p>
<p id="p-0057" num="0056">When an instruction to start recording has been received, and one writing unit of moving image and audio data has been stored in the memory <b>108</b>, the control unit <b>106</b> controls the record/reproduction unit <b>109</b> so as to request the recording medium <b>200</b> to transmit information indicating the alternative block remaining amount (S<b>703</b>). Then, the control unit <b>106</b> compares the alternative block remaining amount received from the recording medium <b>200</b> in response to this request with the threshold set in S<b>604</b>, and determines whether the alternative block remaining amount is larger than the threshold (S<b>704</b>). If it is determined as a result that the alternative block remaining amount is larger than the threshold, the control unit <b>106</b> decides to continue recording, and executes the processing in S<b>505</b> and the subsequent steps. If, on the other hand, it is determined that the alternative block remaining amount is not larger than the threshold (less than or equal to the threshold), the control unit <b>106</b> stops writing data to the recording medium <b>200</b> (S<b>506</b>).</p>
<p id="p-0058" num="0057">With the second embodiment described above, the same effects as those of the first embodiment can be obtained.</p>
<p id="p-0059" num="0058">Next, a third embodiment will be described. <figref idref="DRAWINGS">FIG. 1B</figref> is a diagram showing a configuration of a video camera according to the third embodiment. A video camera <b>100</b> according to the third embodiment has, in addition to the function of recording and reproducing moving images, a function of recording and reproducing still images, and thus, includes a still image processing unit <b>111</b> in addition to the configuration described in the first embodiment (<figref idref="DRAWINGS">FIG. 1A</figref>). Hereinafter, portions of the configuration different from those of the first and second embodiments will be mainly described.</p>
<p id="p-0060" num="0059">In <figref idref="DRAWINGS">FIG. 1B</figref>, the operation unit <b>107</b> is equipped with a mode switch for switching between a moving image recording mode and a still image recording mode. The still image processing unit <b>111</b> performs known compression/encoding processing according to JPEG or the like on still image data stored in the memory <b>108</b> in response to an instruction to record a still image.</p>
<p id="p-0061" num="0060">In the present embodiment, as a threshold for comparison with the alternative block remaining amount in the recording medium <b>200</b>, different values are set for the moving image mode and the still image mode. In the present embodiment as well, the mounting processing shown in <figref idref="DRAWINGS">FIG. 3</figref> is executed when the power of the video camera has been turned on and when the recording medium <b>200</b> has been newly attached. The threshold set by the control unit <b>106</b> in S<b>402</b> of <figref idref="DRAWINGS">FIG. 4</figref> is a threshold for the moving image mode. In the moving image recording mode, insufficiency of the alternative block remaining amount is detected as described in <figref idref="DRAWINGS">FIG. 5</figref> by using the threshold for the moving image mode.</p>
<p id="p-0062" num="0061">If, on the other hand, the video camera <b>100</b> is switched from the moving image recording mode to the still image recording mode, the control unit <b>106</b> sets a threshold for the still image mode and determines whether the alternative block remaining amount is insufficient. Next, determination processing for determining whether or not recording is possible that is performed along with the mode switching will be described with reference to the flowchart shown in <figref idref="DRAWINGS">FIG. 8</figref>. The processing shown in <figref idref="DRAWINGS">FIG. 8</figref> starts when an instruction to switch between the moving image recording mode and the still image recording mode is issued through the operation unit <b>107</b> while the video camera <b>100</b> is not recording.</p>
<p id="p-0063" num="0062">In <figref idref="DRAWINGS">FIG. 8</figref>, the control unit <b>106</b> first queries the recording medium <b>200</b> for the state of the recording medium <b>200</b>. Then, the control unit <b>106</b> determines whether the recording medium <b>200</b> is a reproduction-only recording medium based on a response from the controller <b>202</b> of the recording medium <b>200</b> (S<b>801</b>). If it is determined that the recording medium <b>200</b> is a reproduction-only recording medium, the control unit <b>106</b> displays warning information indicating the fact on the display unit <b>104</b> (S<b>809</b>), and inhibits data recording (S<b>810</b>).</p>
<p id="p-0064" num="0063">If, on the other hand, it is determined in S<b>801</b> that the recording medium <b>200</b> is not a reproduction-only recording medium, the control unit <b>106</b> determines which of the moving image mode and the still image mode the video camera <b>100</b> is in after the mode has been switched (S<b>802</b>). If it is determined that the video camera <b>100</b> is in the moving image mode, the control unit <b>106</b> sets a threshold for the moving image mode that is used to compare with the alternative block remaining amount in the alternative block area <b>203</b><i>b </i>of the recording medium <b>200</b> (S<b>803</b>). The threshold for the moving image mode is the same as the thresholds of the first and second embodiments. If, on the other hand, it is determined that the video camera <b>100</b> is in the still image mode, the control unit <b>106</b> sets a threshold for the still image mode (S<b>807</b>). In the present embodiment, the sum of the size needed to update the file system information and the amount of one screen's worth of still image data, or a value that is larger than the sum is set as the threshold for the still image mode. The present embodiment has a configuration in which the user can set the number of pixels and the compression rate of still images that are recorded. Accordingly, the amount of one screen's worth of still image data is set based on the number of pixels and the compression rate of still images that are set by the user.</p>
<p id="p-0065" num="0064">After the threshold corresponding to each mode has been set in the manner described above, the control unit <b>106</b> transmits a query as to whether the alternative block remaining amount is insufficient to the controller <b>202</b> of the recording medium <b>200</b> together with information regarding the set threshold (S<b>804</b>). When the threshold is transmitted from the video camera <b>100</b>, the controller <b>202</b> detects the alternative block remaining amount in the alternative block area <b>203</b><i>b </i>and compares the alternative block remaining amount with the received threshold. If the result of comparison indicates that the remaining amount of the alternative block area <b>203</b><i>b </i>is smaller than the threshold, the controller <b>202</b> transmits information indicating that the alternative block remaining amount is insufficient to the record/reproduction unit <b>109</b>. The record/reproduction unit <b>109</b> receives the information indicating that the alternative block remaining amount is insufficient, and transmits the information to the control unit <b>106</b>.</p>
<p id="p-0066" num="0065">If the control unit <b>106</b> receives a notification indicating that the alternative block remaining amount is not insufficient (S<b>805</b>), it permits data recording to the recording medium <b>200</b> (S<b>806</b>). If the control unit <b>106</b> receives a notification indicating that the alternative block remaining amount is insufficient (S<b>805</b>), it inhibits data recording to the recording medium <b>200</b> (S<b>805</b>).</p>
<p id="p-0067" num="0066">Next, still image recording processing according to the present embodiment will be described. <figref idref="DRAWINGS">FIG. 9</figref> is a flowchart illustrating still image recording processing. The processing shown in <figref idref="DRAWINGS">FIG. 9</figref> is executed by the control unit <b>106</b> controlling various units. When the power is turned on through the operation unit <b>107</b>, moving images captured by the image capturing unit <b>101</b> are displayed on the display unit <b>104</b>. In this state, when the user issues an instruction to switch the mode to a still image mode, and then issues an instruction to record a still image, the control unit <b>106</b> instructs the image capturing unit <b>101</b> to output one picture of image data corresponding to the time when the instruction to record a still image was issued as still image data. The image capturing unit <b>101</b> outputs the one picture of still image data, and stores the data in the memory <b>108</b> in response to the instruction from the control unit <b>106</b>. Then, the control unit <b>106</b> controls the still image processing unit <b>111</b> so as to compress the one picture of still image data, and again stores the data in the memory <b>108</b>.</p>
<p id="p-0068" num="0067">When the still image data compressed in the manner described above is stored in the memory <b>108</b>, the control unit <b>106</b> performs file open processing for opening a still image file (S<b>901</b>). In this processing, the control unit <b>106</b> determines the file name, and registers the file information thereof in the file system information stored in the memory <b>108</b>. Then, the control unit <b>106</b> reads out the still image data and additional data such as file header from the memory <b>108</b>, and writes the data into the recording medium <b>200</b> (S<b>902</b>). Upon completion of writing of the one picture of still image data, the control unit <b>106</b> closes the currently recorded still image file (S<b>903</b>). Then, the control unit <b>106</b> changes the content of the file system information stored in the memory <b>108</b>, and writes the file system information into the recording medium <b>200</b>, thereby updating the file system information (S<b>904</b>).</p>
<p id="p-0069" num="0068">Upon completion of the writing of one picture of still image data in the manner described above, the control unit <b>106</b> queries the recording medium <b>200</b> for the state of alternative block remaining amount (S<b>904</b>). The controller <b>202</b> of the recording medium <b>200</b> compares the alternative block remaining amount in the alternative block area <b>203</b><i>b </i>with the threshold, and notifies the result of comparison. The control unit <b>106</b> determines whether or not it has received a notification indicating that the alternative block remaining amount is insufficient in response to the query (S<b>906</b>). If the control unit <b>106</b> receives a notification indicating that the alternative block remaining amount is insufficient, it displays warning information indicating that writing of data is not possible due to insufficient alternative blocks on the display unit <b>104</b> (S<b>907</b>). If, on the other hand, the control unit <b>106</b> receives a notification indicating that the alternative block remaining amount is larger than the threshold, it terminates the processing.</p>
<p id="p-0070" num="0069">As described above, according to the third embodiment, a value that is different from that for the moving image recording mode is set as the threshold for the still image recording mode, enabling more efficient use of the recording medium <b>200</b>.</p>
<p id="p-0071" num="0070">In the third embodiment, the threshold is changed between the moving image recording mode and the still image recording mode, but besides this configuration, it is also possible to employ a configuration in which, for example, the threshold is changed according to the type (content) of data to be recorded.</p>
<p id="p-0072" num="0071">Also, the third embodiment may have the same configuration as in the second embodiment in which the video camera <b>100</b> receives information regarding the alternative block remaining amount from the recording medium <b>200</b>, and the control unit <b>106</b> compares the alternative block remaining amount with the threshold and determines whether recording is possible.</p>
<p id="p-0073" num="0072">The third embodiment has described the configuration in which the threshold is changed between the moving image recording mode and the still image recording mode, but if there are recording modes other than these modes, the threshold may be set according to each mode. For example, the video camera <b>100</b> of <figref idref="DRAWINGS">FIG. 1B</figref> may have a function (mode) of creating and recording a file containing print control data for use when printing captured still image data with a printer, such as a Digital Print Order Format (DPOF) file.</p>
<p id="p-0074" num="0073">In this case, when the user issues an instruction to create a DPOF file through operation of the operation unit <b>107</b>, the control unit <b>106</b> creates a DPOF file for printing a designated still image file, and records the file in the recording medium <b>200</b> by using the record/reproduction unit <b>109</b>. At this time, the control unit <b>106</b> sets the size of the DPOF file+the size needed to update the file system information as the threshold, and determines whether the alternative block remaining amount is larger than the threshold. Then, the control unit <b>106</b> permits recording of the DPOF file if the alternative block remaining amount is larger than the threshold, and inhibits recording of the DPOF file if the alternative block remaining amount is less than or equal to the threshold.</p>
<p id="p-0075" num="0074">The video cameras <b>100</b> according to the first to third embodiments (<figref idref="DRAWINGS">FIGS. 1A and 1B</figref>) may have a function of creating a play list file (PLF) that designates the order of reproduction of recorded moving images and recording the file in the recording medium <b>200</b>. In this case, when the user designates the order of reproduction of moving image files recorded in the recording medium <b>200</b> and issues an instruction to create a PLF through operation of the operation unit <b>107</b>, the control unit <b>106</b> creates a PLF for reproducing the moving image files in the designated order. Then, the control unit <b>106</b> records the PLF in the recording medium <b>200</b> by using the record/reproduction unit <b>109</b>.</p>
<p id="p-0076" num="0075">At this time, the control unit <b>106</b> sets, as the threshold, the size of the PLF+the size needed to update the file system information, and determines whether the alternative block remaining amount is larger than the threshold. Then, the control unit <b>106</b> permits creation and recording of the PLF if the alternative block remaining amount is larger than the threshold, and inhibits recording of the PLF if the alternative block remaining amount is less than or equal to the threshold.</p>
<p id="p-0077" num="0076">In each of the embodiments described above, the recording medium <b>200</b> has a configuration capable of being attached to and detached from the video camera <b>100</b>. Besides this configuration, it is also possible to employ a configuration in which a recording medium containing a flash memory is incorporated in the video camera body, and the present invention is also applicable to such a configuration.</p>
<p id="p-0078" num="0077">As described above, according to the present invention, it is possible to provide a recording apparatus that can more reliably perform normal update of file system information in a recording medium having alternative blocks, and a control method of the recording apparatus.</p>
<p id="p-0079" num="0078">The present invention may be embodied in the form of, for example, a system, an apparatus, a method, a program, a storage medium, and the like, and, specifically, the present invention may be applied to a system comprising a plurality of devices or an apparatus comprising a single device.</p>
<p id="p-0080" num="0079">Aspects of the present invention can also be realized by a computer of a system or apparatus (or devices such as a CPU or MPU) that reads out and executes a program recorded on a memory device to perform the functions of the above-described embodiments, and by a method, the steps of which are performed by a computer of a system or apparatus by, for example, reading out and executing a program recorded on a memory device to perform the functions of the above-described embodiments. For this purpose, the program is provided to the computer for example via a network or from a recording medium of various types serving as the memory device (e.g., computer-readable storage medium).</p>
<p id="p-0081" num="0080">While the present invention has been described with reference to exemplary embodiments, it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.</p>
<p id="p-0082" num="0081">This application claims the benefit of Japanese Patent Application No. 2010-022524, filed on Feb. 3, 2010, which is hereby incorporated by reference herein in its entirety.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A recording apparatus comprising:
<claim-text>a recording unit configured to record image data in a recording medium having a plurality of blocks including an alternative block for a defect block;</claim-text>
<claim-text>a managing unit configured to manage an image file containing the image data recorded in the recording medium in accordance with FAT file system,</claim-text>
<claim-text>wherein the recording unit records in the recording medium a file system information, which includes a file entry of the image file and a file allocation table, for managing the image file recorded in the recording medium and the managing unit updates the file entry of the image file and the file allocation table recorded in the recording medium in accordance with recording of the image data;</claim-text>
<claim-text>a setting unit configured to set a value corresponding to a data amount needed to update the file entry of the image file and the file allocation table recorded in the recording medium as a threshold; and</claim-text>
<claim-text>a control unit configured to control the recording unit, in accordance with a remaining amount of the alternative block in the recording medium and the threshold set by the setting unit, so as to inhibit recording of the image data in the recording medium if a remaining amount of the alternative block in the recording medium is less than or equal to the threshold.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the setting unit sets a value larger than the data size of the file system information as the threshold.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, comprising:
<claim-text>a unit configured to input image data to be recorded in the recording medium; and</claim-text>
<claim-text>a memory configured to store the input image data,</claim-text>
<claim-text>wherein the recording unit reads out a predetermined amount of image data from the memory and records the read image data in the recording medium in response to the predetermined amount of image data being stored in the memory, and</claim-text>
<claim-text>the setting unit sets a sum of a data amount needed to update the file entry of the image file and the file allocation table and the predetermined amount as the threshold.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the image data includes moving image data or still image data, and
<claim-text>the setting unit sets the threshold to a different value between a moving image recording mode for recording the moving image data and a still image recording mode for recording the still image.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the control unit controls the recording unit so as to stop recording of the image data in accordance with the remaining amount of the alternative block reaching the threshold during recording of the image data, and thereafter controls the managing unit so as to update the file entry of the image data which the recording unit stops recording and the file allocation table recorded in the recording medium.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the recording medium includes a storage unit configured to have the plurality of blocks and a controller configured to control writing and readout of data to and from the storage unit, and the control unit controls the recording unit so as to output information regarding the threshold to the controller so that a notification is made if the remaining amount of the alternative block reaches the threshold, and stop recording of image data in accordance with the notification from the recording medium.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the control unit controls the recording unit so as to request the recording medium for a notification regarding the remaining amount of the alternative block, thereby obtaining the remaining amount of the alternative block from the recording medium, and stop recording of the image data in accordance with the obtained remaining amount of the alternative block reaching the threshold.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. A control method of a recording apparatus including a recording unit configured to record image data in a recording medium having a plurality of blocks including an alternative block for a defect block, the method comprising the steps of:
<claim-text>managing an image file containing the image data recorded in the recording medium in accordance with FAT predetermined file system;</claim-text>
<claim-text>recording by the recording unit in the recording medium a file system information, which includes a file entry of the image file and a file allocation table, for managing the image file recorded in the recording medium,</claim-text>
<claim-text>wherein the step of managing updates the file entry of the image file and the file allocation table recorded in the recording medium in accordance with recording of the image data;</claim-text>
<claim-text>setting a value corresponding to a data amount needed to update the file entry of the image file and the file allocation table recorded in the recording medium as a threshold; and</claim-text>
<claim-text>controlling the recording unit, in accordance with a remaining amount of the alternative block in the recording medium and the threshold set by the setting unit, so as to inhibit recording of the image data in the recording medium if a remaining amount of the alternative block in the recording medium is less than or equal to the threshold.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. A recording apparatus comprising:
<claim-text>a recording unit configured to record still image data and file system information for managing a file containing the still image data in accordance with a predetermined file system in a recording medium having a plurality of blocks including an alternative block for a defect block;</claim-text>
<claim-text>a generation unit configured to generate print control data for the still image data recorded in the recording medium,</claim-text>
<claim-text>wherein the recording unit records the print control data in the recording medium as a file;</claim-text>
<claim-text>a managing unit configured to manage the still image data recorded in the recording medium using the file system information recorded in the recording medium in accordance with the predetermined file system;</claim-text>
<claim-text>a setting unit configured to set a sum of a data size needed to update the file system information and a data size of the print control data as a threshold; and</claim-text>
<claim-text>a control unit configured to control the recording unit so as to inhibit recording of the still image data in the recording medium if a remaining amount of the alternative block in the recording medium is less than or equal to the threshold.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. A recording apparatus comprising:
<claim-text>a recording unit configured to record moving image data and file system information for managing a file containing the moving image data in accordance with a predetermined file system in a recording medium having a plurality of blocks including an alternative block for a defect block;</claim-text>
<claim-text>a generation unit configured to generate a play list indicating a reproducing order of the moving image data recorded in the recording medium,</claim-text>
<claim-text>wherein the recording unit records the play list in the recording medium;</claim-text>
<claim-text>a managing unit configured to manage the moving image data recorded in the recording medium using the file system information recorded in the recording medium in accordance with the predetermined file system;</claim-text>
<claim-text>a setting unit configured to set a sum of a data size needed to update the file system information and a data size of the play list as a threshold; and</claim-text>
<claim-text>a control unit configured to control the recording unit so as to inhibit recording of the moving image data in the recording medium if a remaining amount of the alternative block in the recording medium is less than or equal to the threshold. </claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
