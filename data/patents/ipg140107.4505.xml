<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08625588-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08625588</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12914670</doc-number>
<date>20101028</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2004-207593</doc-number>
<date>20040714</date>
</priority-claim>
<priority-claim sequence="02" kind="national">
<country>JP</country>
<doc-number>2004-334587</doc-number>
<date>20041118</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>321</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>12</main-group>
<subgroup>28</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>370389</main-classification>
</classification-national>
<invention-title id="d2e90">Packet transmission method and packet transmission device</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6931198</doc-number>
<kind>B1</kind>
<name>Hamada et al.</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>386234</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>7085274</doc-number>
<kind>B1</kind>
<name>Rahim et al.</name>
<date>20060800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>7304996</doc-number>
<kind>B1</kind>
<name>Swenson et al.</name>
<date>20071200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370394</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7577149</doc-number>
<kind>B1</kind>
<name>Rahim et al.</name>
<date>20090800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>8102858</doc-number>
<kind>B1</kind>
<name>Rahim et al.</name>
<date>20120100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2002/0009053</doc-number>
<kind>A1</kind>
<name>Sjoblom</name>
<date>20020100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370235</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2002/0075873</doc-number>
<kind>A1</kind>
<name>Lindhorst-Ko et al.</name>
<date>20020600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2003/0018689</doc-number>
<kind>A1</kind>
<name>Ramakrishnan</name>
<date>20030100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2004/0042418</doc-number>
<kind>A1</kind>
<name>Hamada et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2004/0062248</doc-number>
<kind>A1</kind>
<name>Nagarajan et al.</name>
<date>20040400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2007/0297393</doc-number>
<kind>A1</kind>
<name>Furukawa et al.</name>
<date>20071200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2012/0087374</doc-number>
<kind>A1</kind>
<name>Rahim et al.</name>
<date>20120400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>EP</country>
<doc-number>0 963 082</doc-number>
<kind>A2</kind>
<date>19991200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>EP</country>
<doc-number>0 963 082</doc-number>
<kind>A3</kind>
<date>19991200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>EP</country>
<doc-number>1 198 157</doc-number>
<kind>A1</kind>
<date>20020400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>EP</country>
<doc-number>1 231 541</doc-number>
<kind>A2</kind>
<date>20020800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>EP</country>
<doc-number>1 231 541</doc-number>
<kind>A3</kind>
<date>20020800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>JP</country>
<doc-number>60-167546</doc-number>
<date>19850800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00019">
<document-id>
<country>JP</country>
<doc-number>4-278751</doc-number>
<date>19921000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00020">
<document-id>
<country>JP</country>
<doc-number>7 46250</doc-number>
<date>19950200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00021">
<document-id>
<country>JP</country>
<doc-number>7-307753</doc-number>
<date>19951100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00022">
<document-id>
<country>JP</country>
<doc-number>8-256158</doc-number>
<date>19961000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00023">
<document-id>
<country>JP</country>
<doc-number>2663687</doc-number>
<date>19970600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00024">
<document-id>
<country>JP</country>
<doc-number>10-200552</doc-number>
<date>19980700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00025">
<document-id>
<country>JP</country>
<doc-number>2001-7846</doc-number>
<date>20010100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00026">
<document-id>
<country>JP</country>
<doc-number>2002-524920</doc-number>
<date>20020800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00027">
<document-id>
<country>JP</country>
<doc-number>2002-335251</doc-number>
<date>20021100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00028">
<document-id>
<country>JP</country>
<doc-number>2003-69617</doc-number>
<date>20030300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00029">
<document-id>
<country>JP</country>
<doc-number>2003-174479</doc-number>
<date>20030600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00030">
<document-id>
<country>JP</country>
<doc-number>2004-104186</doc-number>
<date>20040400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00031">
<document-id>
<country>JP</country>
<doc-number>2005-039416</doc-number>
<date>20050200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00032">
<document-id>
<country>WO</country>
<doc-number>WO 00/13376</doc-number>
<date>20000300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00033">
<othercit>Extended European Search Report issued Jan. 18, 2012, in Patent Application No. 11190234.2.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00034">
<othercit>Extended European Search Report issued Jan. 19, 2012, in Patent Application No. 11190238.3.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00035">
<othercit>Wakai, Masugawa et al., &#x201c;IP Node ni okeru Protection Hoshiki no Ichi Kanto&#x201d;, Nen IEICE Communications Society Taikai Koen Ronbunshu 2, p. 107, B-6-51, 2001.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00036">
<othercit>&#x201c;IEEE Standard for Local Metropolitan Area Networks Media Access Control (MAC) Bridges&#x201d;, IEEE Std 802.1D, pp. I-IX and 1-269, 2004.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00037">
<othercit>&#x201c;IEEE Standard for Local and Metropolitan Area Networks&#x2014;Common Specifications Part 3: Media Access Control (MAC) Bridges&#x2014;Amendment 2: Rapid Configuration&#x201d;, IEEE Std 802.1 w, pp. I-VIII and 1-108, 2001.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00038">
<othercit>Seifert, Rich, &#x201c;The Switch Book: The Complete Guide to LAN Switching Technology&#x201d;, Nikkei Business Publications, Inc., pp. 190-215, 2001.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00039">
<othercit>&#x201c;IEEE Standard for Information Technology&#x2014;Telecommunications and Information Exchange Between Systems&#x2014;Local and Metropolitan Area networks&#x2014;Specific Requirements Part 17: Resilient Packet Ring (RPR) Access Method and Physical Layer Specifications&#x201d; IEEE Std 802.17, pp. I-XXIV and 1-664, 2004.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00040">
<othercit>Terauchi, Hironori et al., &#x201c;The High Reliable Network System Based on Layer 2 Technology&#x201d;, IEICE Technical Report, pp. 7-12, 2005. (With English Abstract).</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00041">
<othercit>Kawate, Ryusuke et al., &#x201c;Implementation and Test of the High Reliable Network System Based on Layer 2 Technology&#x201d;, IEICE Technical Report, pp. 13-18, 2005. (With English Abstract).</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00042">
<othercit>Extended European Search Report issued May 2, 2011, in Patent Application No. 05760148.6.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00043">
<othercit>Parameswaran Ramanathan, et al., &#x201c;A Multiple Copy Approach for Delivering Messages Under Deadline Constraints&#x201d;, Proceedings of the International Symposium on Fault Tolerant Computing Montreal, International Symposium on Fault Tolerant Computing Systems (FTCS), vol. SYMP. 21, XP 10023357, Jun. 25, 1991, pp. 300-307.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00044">
<othercit>Extended European Search Report Issued Jun. 21, 2012 in Patent Application No. 12166678.8.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>34</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>370389</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370394</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370428</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370390</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>56</number-of-drawing-sheets>
<number-of-figures>56</number-of-figures>
</figures>
<us-related-documents>
<division>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>10577874</doc-number>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>7869428</doc-number>
</document-id>
</parent-grant-document>
<parent-pct-document>
<document-id>
<country>WO</country>
<doc-number>PCT/JP2005/012959</doc-number>
<date>20050713</date>
</document-id>
</parent-pct-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>12914670</doc-number>
</document-id>
</child-doc>
</relation>
</division>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20110038373</doc-number>
<kind>A1</kind>
<date>20110217</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Shake</last-name>
<first-name>Ippei</first-name>
<address>
<city>Yokohama</city>
<country>JP</country>
</address>
</addressbook>
<residence>
<country>JP</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Fukutoku</last-name>
<first-name>Mitsunori</first-name>
<address>
<city>Yokohama</city>
<country>JP</country>
</address>
</addressbook>
<residence>
<country>JP</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Imajyuku</last-name>
<first-name>Wataru</first-name>
<address>
<city>Yokohama</city>
<country>JP</country>
</address>
</addressbook>
<residence>
<country>JP</country>
</residence>
</us-applicant>
<us-applicant sequence="004" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Shimano</last-name>
<first-name>Katsuhiro</first-name>
<address>
<city>Yokohama</city>
<country>JP</country>
</address>
</addressbook>
<residence>
<country>JP</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Shake</last-name>
<first-name>Ippei</first-name>
<address>
<city>Yokohama</city>
<country>JP</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Fukutoku</last-name>
<first-name>Mitsunori</first-name>
<address>
<city>Yokohama</city>
<country>JP</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Imajyuku</last-name>
<first-name>Wataru</first-name>
<address>
<city>Yokohama</city>
<country>JP</country>
</address>
</addressbook>
</inventor>
<inventor sequence="004" designation="us-only">
<addressbook>
<last-name>Shimano</last-name>
<first-name>Katsuhiro</first-name>
<address>
<city>Yokohama</city>
<country>JP</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Oblon, Spivak, McClelland, Maier &#x26; Neustadt, L.L.P.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Nippon Telegraph and Telephone Corporation</orgname>
<role>03</role>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Phan</last-name>
<first-name>Man</first-name>
<department>2475</department>
</primary-examiner>
<assistant-examiner>
<last-name>Mansoury</last-name>
<first-name>Nourali</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A packet transfer method in a network apparatus that transfers packets is disclosed. In the packet transfer method, a sending side apparatus generates two copies of a send packet, provides a sequence number identifying the same sending sequence to each of the copied packets, provides an identifier corresponding to a send/receive pair to each of the copied packets to send the packets, and a receiving side apparatus receives each of the packets with two receiving units; recognizes the identifiers each corresponding to a send/receive pair; identifies packets having the same information and the sequence based on the sequence number when the identifiers are the same; selects one of the packets of the same sequence so as to send the packet downstream, and discards another packet, wherein, when only one of the packets of the same sequence arrives, the arriving packet is sent downstream.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="131.91mm" wi="259.00mm" file="US08625588-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="249.26mm" wi="111.08mm" orientation="landscape" file="US08625588-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="257.30mm" wi="132.93mm" orientation="landscape" file="US08625588-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="43.60mm" wi="187.71mm" file="US08625588-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="280.16mm" wi="193.38mm" orientation="landscape" file="US08625588-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="275.84mm" wi="180.76mm" orientation="landscape" file="US08625588-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="275.93mm" wi="180.51mm" orientation="landscape" file="US08625588-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="272.03mm" wi="159.43mm" orientation="landscape" file="US08625588-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="267.46mm" wi="195.66mm" orientation="landscape" file="US08625588-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="267.80mm" wi="196.77mm" orientation="landscape" file="US08625588-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="207.43mm" wi="145.12mm" orientation="landscape" file="US08625588-20140107-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="236.90mm" wi="190.75mm" orientation="landscape" file="US08625588-20140107-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="224.03mm" wi="192.70mm" orientation="landscape" file="US08625588-20140107-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="273.13mm" wi="193.21mm" orientation="landscape" file="US08625588-20140107-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="96.60mm" wi="158.58mm" file="US08625588-20140107-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="255.44mm" wi="190.08mm" orientation="landscape" file="US08625588-20140107-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="265.68mm" wi="178.48mm" orientation="landscape" file="US08625588-20140107-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00017" num="00017">
<img id="EMI-D00017" he="279.82mm" wi="194.99mm" orientation="landscape" file="US08625588-20140107-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00018" num="00018">
<img id="EMI-D00018" he="206.93mm" wi="199.56mm" file="US08625588-20140107-D00018.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00019" num="00019">
<img id="EMI-D00019" he="258.83mm" wi="180.34mm" orientation="landscape" file="US08625588-20140107-D00019.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00020" num="00020">
<img id="EMI-D00020" he="260.60mm" wi="139.11mm" orientation="landscape" file="US08625588-20140107-D00020.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00021" num="00021">
<img id="EMI-D00021" he="263.99mm" wi="187.20mm" orientation="landscape" file="US08625588-20140107-D00021.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00022" num="00022">
<img id="EMI-D00022" he="269.41mm" wi="147.57mm" orientation="landscape" file="US08625588-20140107-D00022.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00023" num="00023">
<img id="EMI-D00023" he="271.10mm" wi="193.38mm" orientation="landscape" file="US08625588-20140107-D00023.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00024" num="00024">
<img id="EMI-D00024" he="278.89mm" wi="201.17mm" orientation="landscape" file="US08625588-20140107-D00024.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00025" num="00025">
<img id="EMI-D00025" he="267.55mm" wi="133.27mm" orientation="landscape" file="US08625588-20140107-D00025.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00026" num="00026">
<img id="EMI-D00026" he="265.26mm" wi="157.06mm" orientation="landscape" file="US08625588-20140107-D00026.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00027" num="00027">
<img id="EMI-D00027" he="252.39mm" wi="154.43mm" orientation="landscape" file="US08625588-20140107-D00027.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00028" num="00028">
<img id="EMI-D00028" he="279.15mm" wi="143.43mm" orientation="landscape" file="US08625588-20140107-D00028.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00029" num="00029">
<img id="EMI-D00029" he="275.84mm" wi="177.04mm" orientation="landscape" file="US08625588-20140107-D00029.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00030" num="00030">
<img id="EMI-D00030" he="262.30mm" wi="136.40mm" orientation="landscape" file="US08625588-20140107-D00030.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00031" num="00031">
<img id="EMI-D00031" he="260.94mm" wi="131.74mm" orientation="landscape" file="US08625588-20140107-D00031.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00032" num="00032">
<img id="EMI-D00032" he="278.21mm" wi="182.80mm" orientation="landscape" file="US08625588-20140107-D00032.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00033" num="00033">
<img id="EMI-D00033" he="277.71mm" wi="179.83mm" orientation="landscape" file="US08625588-20140107-D00033.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00034" num="00034">
<img id="EMI-D00034" he="273.47mm" wi="129.37mm" orientation="landscape" file="US08625588-20140107-D00034.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00035" num="00035">
<img id="EMI-D00035" he="267.97mm" wi="167.72mm" orientation="landscape" file="US08625588-20140107-D00035.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00036" num="00036">
<img id="EMI-D00036" he="262.55mm" wi="134.79mm" orientation="landscape" file="US08625588-20140107-D00036.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00037" num="00037">
<img id="EMI-D00037" he="246.38mm" wi="168.57mm" orientation="landscape" file="US08625588-20140107-D00037.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00038" num="00038">
<img id="EMI-D00038" he="262.72mm" wi="181.36mm" orientation="landscape" file="US08625588-20140107-D00038.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00039" num="00039">
<img id="EMI-D00039" he="264.50mm" wi="187.71mm" orientation="landscape" file="US08625588-20140107-D00039.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00040" num="00040">
<img id="EMI-D00040" he="250.36mm" wi="195.83mm" orientation="landscape" file="US08625588-20140107-D00040.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00041" num="00041">
<img id="EMI-D00041" he="259.93mm" wi="166.96mm" orientation="landscape" file="US08625588-20140107-D00041.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00042" num="00042">
<img id="EMI-D00042" he="256.96mm" wi="193.89mm" orientation="landscape" file="US08625588-20140107-D00042.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00043" num="00043">
<img id="EMI-D00043" he="238.08mm" wi="182.03mm" orientation="landscape" file="US08625588-20140107-D00043.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00044" num="00044">
<img id="EMI-D00044" he="261.37mm" wi="177.55mm" orientation="landscape" file="US08625588-20140107-D00044.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00045" num="00045">
<img id="EMI-D00045" he="257.64mm" wi="195.66mm" orientation="landscape" file="US08625588-20140107-D00045.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00046" num="00046">
<img id="EMI-D00046" he="261.20mm" wi="186.35mm" orientation="landscape" file="US08625588-20140107-D00046.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00047" num="00047">
<img id="EMI-D00047" he="256.20mm" wi="171.79mm" orientation="landscape" file="US08625588-20140107-D00047.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00048" num="00048">
<img id="EMI-D00048" he="253.92mm" wi="181.44mm" orientation="landscape" file="US08625588-20140107-D00048.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00049" num="00049">
<img id="EMI-D00049" he="261.28mm" wi="186.69mm" orientation="landscape" file="US08625588-20140107-D00049.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00050" num="00050">
<img id="EMI-D00050" he="264.41mm" wi="163.83mm" orientation="landscape" file="US08625588-20140107-D00050.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00051" num="00051">
<img id="EMI-D00051" he="240.11mm" wi="183.13mm" orientation="landscape" file="US08625588-20140107-D00051.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00052" num="00052">
<img id="EMI-D00052" he="258.83mm" wi="181.78mm" orientation="landscape" file="US08625588-20140107-D00052.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00053" num="00053">
<img id="EMI-D00053" he="260.86mm" wi="195.83mm" orientation="landscape" file="US08625588-20140107-D00053.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00054" num="00054">
<img id="EMI-D00054" he="263.23mm" wi="177.72mm" orientation="landscape" file="US08625588-20140107-D00054.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00055" num="00055">
<img id="EMI-D00055" he="164.59mm" wi="176.53mm" file="US08625588-20140107-D00055.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00056" num="00056">
<img id="EMI-D00056" he="215.48mm" wi="134.87mm" orientation="landscape" file="US08625588-20140107-D00056.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">This application is a divisional application of, and claims the benefit of priority under 35 U.S.C. &#xa7;120 from, U.S. application Ser. No. 10/577,874, filed Apr. 28, 2006, herein incorporated by reference, which is a National Stage Application of International Application No. PCT/JP2005/12959, filed Jul. 13, 2005, which claims the benefit of priority under 35 U.S.C. &#xa7;119 from Japanese Patent Application Nos. 2004-207593, filed Jul. 14, 2004 and 2004-334587, filed Nov. 18, 2004.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">TECHNICAL FIELD</heading>
<p id="p-0003" num="0002">The present invention relates to a packet transfer method and a packet transfer apparatus. More particularly, the present invention relates to a packet transfer method and a packet transfer apparatus for realizing failure recovery without packet loss in a network adopting an Ethernet transfer scheme, a MPLS transfer scheme, GRE encapsulating, IPinIP encapsulating, GFP encapsulating, an encapsulation transfer scheme for variable length packet such as layer 2 frame encapsulating, and the like.</p>
<heading id="h-0003" level="1">BACKGROUND ART</heading>
<p id="p-0004" num="0003">As conventional failure detection/switching technologies in packet communications, there are STP (Spanning Tree Protocol) in the Ethernet, derivatives of it (refer to non-patent documents 1-3, for example), and EAPS (Ethernet Automatic Protection Switching). In the EAPS, there is a technology for performing switching at high speed in a ring topology for a MAN service.</p>
<p id="p-0005" num="0004">In this technology, master switches are selected in the ring so that one of the master switches is selected as a primary switch and another is selected as a secondary switch so as to block the secondary switch. The primary switch sends &#x201c;Hello packet&#x201d; over the ring, and a failure is detected if the packet does not return to the secondary switch within a predetermined time. When a switch on the ring detects a failure, the switch can send &#x201c;TRAP&#x201d; to the master switch, so that the failure can be detected more quickly (within one second). When the failure is detected, the secondary switch is changed to &#x201c;FORWARDING&#x201d; immediately.</p>
<p id="p-0006" num="0005">In addition, as a standard for realizing high reliability in the ring network, there is RPR (Resilient Packet Ring) (refer to document 4, for example).</p>
<p id="p-0007" num="0006">Further, as an uninterruptible technology for ATM cells in an ATM line, there is a method for writing a cell number on the ATM cell, copying the cell into equal to or more than two, sending each cell to different lines, and in the receiving side, selecting one of the same information cells sent from equal to or more than two lines to transfer the cell downstream (refer to patent document 1, for example).</p>
<p id="p-0008" num="0007">[Non-patent document 1] IEEE 802.1D Spanning Tree Protocol (STP)</p>
<p id="p-0009" num="0008">[Non-patent document 2] IEEE 802.1w Rapid Spanning Tree (RSTP)</p>
<p id="p-0010" num="0009">[Non-patent document 3] The Switch Book: The Complete Guide to LAN Switching Technology by Rich Seifert, translated by Nikkei Business Publications, Inc., ISBN4-8222-8099-3</p>
<p id="p-0011" num="0010">[Non-patent document 4] IEEE802.17 Resilient Packet Ring (RPR)</p>
<p id="p-0012" num="0011">[Patent document 1] Japanese Laid-Open Patent Application No. 7-46250</p>
<heading id="h-0004" level="1">DISCLOSURE OF THE INVENTION</heading>
<heading id="h-0005" level="1">Problem to be Solved by the Invention</heading>
<p id="p-0013" num="0012">However, since switching time in the conventional STP or EAPS is equal to or greater than one second, there is a problem in that high reliability that does not allow packet (frame) loss cannot be realized. In addition, these technologies are failure recovery technologies for each port of a switch, thus, they are not for realizing switching for each packet. In addition, there is a problem in that the EAPS or RPR can be adopted only for a ring network.</p>
<p id="p-0014" num="0013">In addition, since the uninterruptible technology for ATM cells disclosed in the patent document 1 is tailored to the ATM line, and is an uninterruptible technology for each line, there is a problem in that the technology cannot be applied for node failure.</p>
<p id="p-0015" num="0014">The present invention is contrived in view of the above-mentioned points, and an object of the present invention is to provide a packet transfer method and a packet transfer apparatus for realizing highly reliable failure recovery without packet loss in a network in which communications are performed by transferring packets</p>
<heading id="h-0006" level="1">Means for Solving the Problem</heading>
<p id="p-0016" num="0015">The above object is achieved by a packet transfer method in a network apparatus that transfers packets, wherein:</p>
<p id="p-0017" num="0016">a sending side apparatus generates two copies of a send packet, provides a sequence number identifying the same sending sequence to each of the copied packets, provides an identifier corresponding to a send/receive pair to each of the copied packets to send the packets, and</p>
<p id="p-0018" num="0017">a receiving side apparatus receives each of the packets with two receiving units;</p>
<p id="p-0019" num="0018">recognizes the identifiers each corresponding to a send/receive pair;</p>
<p id="p-0020" num="0019">identifies packets having the same information and the sequence based on the sequence number when the identifiers are the same;</p>
<p id="p-0021" num="0020">selects one of the packets of the same sequence so as to send the packet downstream, and discards another packet, wherein, when only one of the packets of the same sequence arrives, the arriving packet is sent downstream.</p>
<p id="p-0022" num="0021">The present invention can be also configured as a packet transfer method in a network apparatus that transfers packets, wherein:</p>
<p id="p-0023" num="0022">a sending side apparatus generates two copies of a send packet, provides a sequence number identifying the same sending sequence to each of the copied packets, and provides an identifier corresponding to a send/receive pair and an identifier corresponding to a route to each of the copied packets to send the packets, and</p>
<p id="p-0024" num="0023">a receiving side apparatus receives each of the packets with two receiving units;</p>
<p id="p-0025" num="0024">recognizes the identifiers each corresponding to a send/receive pair and the identifiers each corresponding to a route;</p>
<p id="p-0026" num="0025">identifies packets having the same information and the sequence based on the sequence number when the identifiers are the same;</p>
<p id="p-0027" num="0026">selects one of the packets of the same sequence so as to send the packet downstream, and discards another packet, wherein, when only one of the packets of the same sequence arrives, the arriving packet is sent downstream.</p>
<p id="p-0028" num="0027">the receiving side apparatus can temporarily store the two packets transferred from two routes into two FIFO memories respectively, and select a packet transferred normally to transfer it downstream. In addition, the receiving side apparatus may be configured to temporarily store the two packets transferred from two routes into two circulating hash memories respectively, and select a packet that is transferred normally so as to transfer it downstream, or mat be configured to temporarily store the two packets transferred from two routes into two FIFO memories respectively, and select a packet that is transferred normally using a third memory shared by the two receiving units so as to transfer the selected packet downstream.</p>
<p id="p-0029" num="0028">In addition, the present invention can be also configured as a packet transfer apparatus for transferring packets, including:</p>
<p id="p-0030" num="0029">sending function means including:</p>
<p id="p-0031" num="0030">copy means for generating two copies from a send packet;</p>
<p id="p-0032" num="0031">number/identifier providing means for providing a sequence number identifying the same sending sequence to each of the packets copied by the copy means, and providing an identifier corresponding to a send/receive pair to each of the copied packets;</p>
<p id="p-0033" num="0032">packet sending means for sending the two packets to which the sequence number and the identifier are provided; and</p>
<p id="p-0034" num="0033">receiving function means including:</p>
<p id="p-0035" num="0034">packet receiving means for receiving each of the two packets sent from the sending function means;</p>
<p id="p-0036" num="0035">memories each for storing one of the two received packets;</p>
<p id="p-0037" num="0036">selection means for reading out the two packets stored in the memories, recognizing the identifiers each corresponding to a send/receive pair, identifying packets having the same information and the sequence based on the sequence number when the identifiers are the same, and selecting one of the packets of the same sequence; and</p>
<p id="p-0038" num="0037">sending means for sending the packet selected in the selection means downstream, and discarding another packet, wherein, when only one of the packets of the same sequence arrives, the arriving packet is sent downstream.</p>
<p id="p-0039" num="0038">In addition, the present invention can be also configured as a packet transfer apparatus for transferring packets, including:</p>
<p id="p-0040" num="0039">sending function means including:</p>
<p id="p-0041" num="0040">copy means for generating two copies from a send packet;</p>
<p id="p-0042" num="0041">number/identifier providing means for providing a sequence number identifying the same sending sequence to each of the packets copied by the copy means, and providing an identifier corresponding to a send/receive pair and an identifier corresponding to a route to each of the copied packets;</p>
<p id="p-0043" num="0042">packet sending means for sending the two packets to which the sequence number and the identifier are provided; and</p>
<p id="p-0044" num="0043">receiving function means including:</p>
<p id="p-0045" num="0044">packet receiving means for receiving each of the packets sent from the sending function means;</p>
<p id="p-0046" num="0045">memories each for storing one of the two received packets;</p>
<p id="p-0047" num="0046">selection means for reading out the two packets stored in the memories, recognizing the identifiers each corresponding to a send/receive pair and identifiers each corresponding to a route, identifying packets having the same information and the sequence based on the sequence number when the identifiers are the same, and selecting one of the packets of the same sequence; and</p>
<p id="p-0048" num="0047">sending means for sending the packet selected in the selection means downstream, and discarding another packet, wherein, when only one of the packets of the same sequence arrives, the arriving packet is sent downstream.</p>
<p id="p-0049" num="0048">In addition, the present invention can be also configured as a packet transfer method performed by packet transfer apparatuses provided in a packet sending side and a receiving side in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, wherein:</p>
<p id="p-0050" num="0049">equal to or more than two independent routes are set between the sending side packet transfer apparatus and the receiving side packet transfer apparatus;</p>
<p id="p-0051" num="0050">the sending side packet transfer apparatus inserts information identifying a sequence of a packet into a part of the packet that is not referred to for determining the transfer destination of the packet, copies the packet to generate equal to or more than two packets, and sends the packets over the independent routes respectively; and</p>
<p id="p-0052" num="0051">the receiving side packet transfer apparatus receives each packet from the independent routes, refers to the information identifying the sequence for each packet to identify packets having the same information and the sequence, and transfer one of the packets having the same information downward in the order of the sequence of the packet.</p>
<p id="p-0053" num="0052">In addition, the present invention can be also configured as a packet transfer apparatus used in a packet transfer system including a plurality of packet transfer apparatuses provided in a packet sending side and a receiving side via equal to or more than two independent routes in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, the packet transfer apparatus including sending function means and receiving function means, the sending function means including:</p>
<p id="p-0054" num="0053">inserting means for inserting information identifying a sequence of a packet into a part of the packet that is not referred to for determining the transfer destination of the packet;</p>
<p id="p-0055" num="0054">copying means for copying the packet to generate equal to or more than two packets; and</p>
<p id="p-0056" num="0055">sending means for sending the packets over the independent routes respectively;</p>
<p id="p-0057" num="0056">the receiving function means including:</p>
<p id="p-0058" num="0057">receiving means for receiving each packet from the independent routes;</p>
<p id="p-0059" num="0058">identifying means for referring to the information identifying the sequence for each packet to identify packets having the same information and the sequence; and</p>
<p id="p-0060" num="0059">selection means for transferring one of the packets having the same information identified by the identifying means downstream in the order of the sequence of the packet.</p>
<p id="p-0061" num="0060">In addition, the present invention can be also configured as a packet transfer method performed by packet transfer apparatuses provided in a packet sending side and a receiving side in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, wherein:</p>
<p id="p-0062" num="0061">equal to or more than two independent routes are set between the sending side packet transfer apparatus and the receiving side packet transfer apparatus;</p>
<p id="p-0063" num="0062">the sending side packet transfer apparatus distinguishes a high reliability packet from non-high reliability packets by referring to a part of a packet header of the packet, and copies the high reliability packet into packets to send them to all of the independent routes respectively;</p>
<p id="p-0064" num="0063">the receiving side packet transfer apparatus determines whether an arriving packet from the independent routes is the high reliability packet by referring to a part of the packet header, and as to high reliability packets, the receiving side packet transfer apparatus determines sameness of packet data arriving from the plurality of routes,</p>
<p id="p-0065" num="0064">when the same packets arrives from equal to or more than two routes, the receiving side packet transfer apparatus transfers only one of the same packets downstream and discards other packets; and</p>
<p id="p-0066" num="0065">when the same packet arrives from only one route, the receiving side packet transfer apparatus transfers the packet downstream. By referring to the part of the packet, the priority of the packet can be determined so that it can be determined whether the packet is the high reliability packet.</p>
<p id="p-0067" num="0066">When the packet to be transferred is an Ethernet packet, the part of the packet header is any one of a port number at which the packet arrives in a previous switch of the packet transfer apparatus, a Type value of layer 3 protocol in a frame header, a destination MAC address in a frame header, a source MAC address, a priority (CoS value) included in 802.1Q VLAN tag, VLAN-ID, a DiffServ code/point value (ToS value) included in an IP header, a destination port number, a source port number of UDP, a destination port number, and a source port number of TCP,</p>
<p id="p-0068" num="0067">when the packet to be transferred is a packet for MPLS, the part of the packet header is any one of a destination MAC address, a source MAC address, and a CoS value (Exp value) of a shim header, and</p>
<p id="p-0069" num="0068">when the packet to be transferred includes an IP packet, the part of the packet header is any one of a ToS value of the IP packet, a source IP address, and a destination IP address.</p>
<p id="p-0070" num="0069">The receiving side packet transfer apparatus can determine the sameness of packets arriving from the plurality of routes based on a value obtained by applying a predetermined function to each packet arriving from the plurality of routes.</p>
<p id="p-0071" num="0070">In addition, the sending side packet transfer apparatus may insert a sequence identifier or a timestamp into a send packet, wherein the receiving side packet transfer apparatus determines the sameness of packets arriving from the plurality of routes by referring to the sequence identifier or the timestamp inserted in the sending side.</p>
<p id="p-0072" num="0071">A format of the sequence identifier or the timestamp inserted into the packet by the sending side packet transfer apparatus may be the same as a format of a VLAN tag conforming to 802.1Q standard, and the sending side packet transfer apparatus writes sequence information or time information into a VLAN-ID field of the VLAN tag.</p>
<p id="p-0073" num="0072">In addition, the present invention can be also configured as a packet transfer method performed by packet transfer apparatuses provided in a packet sending side and a receiving side in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, wherein:</p>
<p id="p-0074" num="0073">equal to or more than two independent routes are set between the sending side packet transfer apparatus and the receiving side packet transfer apparatus;</p>
<p id="p-0075" num="0074">the sending side packet transfer apparatus copies the packet so as to send copied packets to all of the independent routes;</p>
<p id="p-0076" num="0075">the receiving side packet transfer apparatus receives packets from each of the independent routes and refers to sameness identifying information of each packet so as to identify packets having the same information, and to send downstream a packet, among the packets having the same information, that has not yet be transferred, and</p>
<p id="p-0077" num="0076">the receiving side packet transfer apparatus stores the sameness identifying information of packets already sent downstream for m (m is an integer equal to or greater than one) preceding packets from the newest packet, and compares the stored sameness identifying information with sameness identifying information of a next arriving packet so as to determine whether the arriving packet is one already sent or not.</p>
<p id="p-0078" num="0077">The sameness identifying information is a sequence identifier or a timestamp inserted into the packet, or a value obtained by applying a predetermined function to the packet.</p>
<p id="p-0079" num="0078">In addition, the present invention can be also configured as a packet transfer method performed by packet transfer apparatuses provided in a packet sending side and a receiving side in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, wherein:</p>
<p id="p-0080" num="0079">equal to or more than two independent routes are set between the sending side packet transfer apparatus and the receiving side packet transfer apparatus;</p>
<p id="p-0081" num="0080">the sending side packet transfer apparatus inserts a sequence identifier for identifying sequence of packets into a send packet and copies the packet so as to send copied packets to all of the independent routes;</p>
<p id="p-0082" num="0081">the receiving side packet transfer apparatus compares values of sequence identifiers of plural packets received form the independent routes with a value (CF) of a sequence identifier of an already sent packet so as to send a packet downstream in at least one packet having a value as the sequence identifier that is greater than the value (CF) of the sequence identifier of the already transferred packet and that is the least value among the values of the sequence identifiers of the plural packets received from the independent routes.</p>
<p id="p-0083" num="0082">In addition, the present invention can be also configured as a packet transfer method performed by packet transfer apparatuses provided in a packet sending side and a receiving side in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, wherein:</p>
<p id="p-0084" num="0083">a plurality of independent routes are set between the sending side packet transfer apparatus and the receiving side packet transfer apparatus;</p>
<p id="p-0085" num="0084">the sending side packet transfer apparatus inserts a sequence identifier identifying a sequence of packets into a send packet, and copies the packet so as to send copied packets to all of the independent routes;</p>
<p id="p-0086" num="0085">the receiving side packet transfer apparatus receives packets from each of the independent routes and refers to the sequence identifier of each packet so as to identify packets having the same information and the sequence, and to send downstream a packet among the packets having the same information in the order of the sequence of the packet,</p>
<p id="p-0087" num="0086">wherein, in the receiving side packet transfer apparatus, a route from which a packet arrives first from the start of communication among the independent routes is regarded as an active system, the receiving side packet transfer apparatus compares a value (CF) of the sequence identifier of an already transferred packet with a value of the sequence identifier of a packet received in the active system so as to determine a packet having a sequence identifier greater than the value (CF) of the sequence identifier of the already transferred packet as a packet to be transferred next, and</p>
<p id="p-0088" num="0087">when arrival of packets is interrupted for a predetermined time in the active system, another system is adopted as a new active system, and a packet received in the new active system is transferred downstream.</p>
<p id="p-0089" num="0088">In addition, the present invention can be also configured as a packet transfer apparatus used in a packet transfer system including a plurality of packet transfer apparatuses provided in a packet sending side and a receiving side via equal to or more than two independent routes in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, the packet transfer apparatus including sending function means and receiving function means,</p>
<p id="p-0090" num="0089">the sending function means including means for distinguishing a high reliability packet from non-high reliability packets by referring to a part of a packet header of the packet, and copying the high reliability packet into packets to send them to all of the independent routes;</p>
<p id="p-0091" num="0090">the receiving function means including means for determining whether an arriving packet from the independent routes is the high reliability packet by referring to a part of the packet header, and as to high reliability packets, determining sameness of packet data arriving from the plurality of routes, and, when the same packets arrives from equal to or more than two routes, transferring only one of the same packets downward and discarding other packets, and when the same packet arrives from only one route, transferring the packet downstream.</p>
<p id="p-0092" num="0091">In addition, the present invention can be also configured as a packet transfer apparatus used in a packet transfer system including a plurality of packet transfer apparatuses provided in a packet sending side and a receiving side via equal to or more than two independent routes in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, the packet transfer apparatus including sending function means and receiving function means,</p>
<p id="p-0093" num="0092">the sending function means includes means for copying the packet so as to send copied packets to all of the independent routes;</p>
<p id="p-0094" num="0093">the receiving function means including:</p>
<p id="p-0095" num="0094">means for receiving packets from each of the independent routes;</p>
<p id="p-0096" num="0095">means for referring to sameness identifying information of each packet so as to identify packets having the same information,</p>
<p id="p-0097" num="0096">means for storing the sameness identifying information of packets already sent downstream for m (m is an integer equal to or greater than one) preceding packets from the newest packet, and comparing the stored sameness identifying information with sameness identifying information of a next arriving packet so as to determine whether the arriving packet is one already sent or not; and</p>
<p id="p-0098" num="0097">means for sending downstream a packet, among the packets having the same information, that has not yet be transferred.</p>
<p id="p-0099" num="0098">In addition, the present invention can be also configured as a packet transfer apparatus used in a packet transfer system including a plurality of packet transfer apparatuses provided in a packet sending side and a receiving side via equal to or more than two independent routes in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, the packet transfer apparatus including sending function means and receiving function means,</p>
<p id="p-0100" num="0099">the sending function means includes means for inserting a sequence identifier for identifying sequence of packets into a send packet and copies the packet so as to send copied packets to all of the independent routes;</p>
<p id="p-0101" num="0100">the receiving function means includes means for comparing values of sequence identifiers of plural packets received form the independent routes with a value (CF) of a sequence identifier of an already sent packet so as to send a packet downstream in at least one packet having a value as the sequence identifier that is greater than the value (CF) of the sequence identifier of the already transferred packet and that is the least value among the values of the sequence identifiers of the plural packets received from the independent routes.</p>
<p id="p-0102" num="0101">In addition, the present invention can be also configured as a packet transfer apparatus used in a packet transfer system including a plurality of packet transfer apparatuses provided in a packet sending side and a receiving side via equal to or more than two independent routes in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, the packet transfer apparatus including sending function means and receiving function means,</p>
<p id="p-0103" num="0102">the sending function means including means for inserting a sequence identifier for identifying a sequence of packets to a send packet and copying the packet so as to send copied packets to the independent routes;</p>
<p id="p-0104" num="0103">the receiving function means including means for receiving packets from each of the independent routes and referring to the sequence identifier of each packet so as to identify packets having the same information and the sequence, and to send downstream a packet among the packets having the same information in the order of the sequence of the packet,</p>
<p id="p-0105" num="0104">wherein, in the receiving function means, a route from which a packet arrives first from the start of communication among the independent routes is regarded as an active system, the receiving function means compares a value (CF) of the sequence identifier of an already transferred packet with a value of the sequence identifier of a packet received in the active system so as to determine a packet having a sequence identifier greater than the value (CF) of the sequence identifier of the already transferred packet as a packet to be transferred next, and</p>
<p id="p-0106" num="0105">when arrival of packets is interrupted for a predetermined time in the active system, another system is adopted as a new active system, and a packet received in the new active system is transferred downstream.</p>
<heading id="h-0007" level="1">Effect of the Invention</heading>
<p id="p-0107" num="0106">According to the present invention, in a packet network that could not be recovered uninterruptedly in an event of a failure in the past, copies of a packet is generated and the copies are transferred over different route respectively, and, in the receiving side, one of the two copies is transferred to realize uninterruptible switching function so that a highly reliable packet network can be provided. In addition, by using the independent route for each send/receive, a highly reliable packet network similar to point-point can be provided for communications among a plurality of sites.</p>
<p id="p-0108" num="0107">In addition, according to the present invention, since a packet that requires high reliability and a packet that does not require it can be identified by referring to information in a packet header, the present invention can be used to networks of users having various requirements for reliability.</p>
<p id="p-0109" num="0108">In addition, when the sameness of packets is determined in the receiving side, by using a value obtained by applying a predetermined function to a packet, high reliability of the network can be realized without inserting an excessive field to a packet.</p>
<p id="p-0110" num="0109">In addition, in the receiving side, by performing transfer of a packet after waiting for arrival of the same packets from equal to or more than two routes, in a case when a packet is sent from one source to a plurality of destinations, skip of sequence due to arrival delay can be prevented even when the sequence identifier becomes discontinuous.</p>
<p id="p-0111" num="0110">In addition, by providing a route identifier corresponding to a user priority, priority control can be performed in the relay network.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0008" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0112" num="0111"><figref idref="DRAWINGS">FIG. 1</figref> is a system schematic diagram in an embodiment of the present invention;</p>
<p id="p-0113" num="0112"><figref idref="DRAWINGS">FIG. 2</figref> is a system schematic diagram in an embodiment of the present invention;</p>
<p id="p-0114" num="0113"><figref idref="DRAWINGS">FIG. 3</figref> is a figure showing a configuration of a packet in an embodiment of the present invention;</p>
<p id="p-0115" num="0114"><figref idref="DRAWINGS">FIG. 4</figref> is a figure showing a configuration of a packet in an embodiment of the present invention (example 1 in a case of Ethernet);</p>
<p id="p-0116" num="0115"><figref idref="DRAWINGS">FIG. 5</figref> is a figure showing a configuration of a packet in an embodiment of the present invention (example 2 in a case of Ethernet);</p>
<p id="p-0117" num="0116"><figref idref="DRAWINGS">FIG. 6</figref> is a figure showing a configuration of a packet in an embodiment of the present invention (example in a case of MPLS);</p>
<p id="p-0118" num="0117"><figref idref="DRAWINGS">FIG. 7</figref> is a figure showing a configuration of a packet in an embodiment of the present invention (example in a case of other encapsulation);</p>
<p id="p-0119" num="0118"><figref idref="DRAWINGS">FIG. 8</figref> is a block diagram of a packet transfer apparatus in a first embodiment of the present invention;</p>
<p id="p-0120" num="0119"><figref idref="DRAWINGS">FIG. 9</figref> is a block diagram of a packet transfer apparatus in the first embodiment of the present invention;</p>
<p id="p-0121" num="0120"><figref idref="DRAWINGS">FIG. 10</figref> shows another example of a sending function unit of the packet transfer apparatus in the first embodiment of the present invention;</p>
<p id="p-0122" num="0121"><figref idref="DRAWINGS">FIG. 11</figref> is a flowchart (pat 1) showing a process procedure of the counter unit and the selection unit in the first embodiment of the present invention;</p>
<p id="p-0123" num="0122"><figref idref="DRAWINGS">FIG. 12</figref> is a flowchart (pat 2) showing a process procedure of the counter unit and the selection unit in the first embodiment of the present invention;</p>
<p id="p-0124" num="0123"><figref idref="DRAWINGS">FIG. 13</figref> shows another example of the packet transfer apparatus in the first embodiment of the present invention;</p>
<p id="p-0125" num="0124"><figref idref="DRAWINGS">FIG. 14</figref> is a figure for explaining a case when using a circulating hash as the memory in the second embodiment of the present invention;</p>
<p id="p-0126" num="0125"><figref idref="DRAWINGS">FIG. 15</figref> is a flowchart showing a process procedure of the counter unit and the selection unit in the second embodiment of the present invention;</p>
<p id="p-0127" num="0126"><figref idref="DRAWINGS">FIG. 16</figref> is a block diagram of a packet transfer apparatus in a third embodiment of the present invention;</p>
<p id="p-0128" num="0127"><figref idref="DRAWINGS">FIG. 17</figref> is a block diagram of a packet transfer apparatus in the third embodiment of the present invention;</p>
<p id="p-0129" num="0128"><figref idref="DRAWINGS">FIG. 18</figref> is a flowchart showing the procedure for writing from the memory A, B to the shared memory C in the third embodiment of the present invention;</p>
<p id="p-0130" num="0129"><figref idref="DRAWINGS">FIG. 19</figref> is a flowchart showing a procedure for transferring data of the shard memory C in the third embodiment of the present invention;</p>
<p id="p-0131" num="0130"><figref idref="DRAWINGS">FIG. 20</figref> is a figure showing a configuration for realizing redundancy for the Ethernet packet in a fourth embodiment of the present invention;</p>
<p id="p-0132" num="0131"><figref idref="DRAWINGS">FIG. 21</figref> is a figure showing a configuration for realizing redundancy for the Ethernet packet in a fifth embodiment of the present invention;</p>
<p id="p-0133" num="0132"><figref idref="DRAWINGS">FIG. 22</figref> is a figure for explaining realizing a multipoint configuration by setting timeout in the sixth embodiment of the present invention;</p>
<p id="p-0134" num="0133"><figref idref="DRAWINGS">FIG. 23</figref> is a figure showing a configuration for providing a VLAN tag in the seventh embodiment of the present invention;</p>
<p id="p-0135" num="0134"><figref idref="DRAWINGS">FIG. 24</figref> is a figure for explaining providing a VLAN tag depending on a sending route and a VLAN tag depending on a source in a seventh embodiment of the present invention;</p>
<p id="p-0136" num="0135"><figref idref="DRAWINGS">FIG. 25</figref> is a figure for explaining providing a VLAN tag depending on a sending route and an ID depending on a send/receive pair in a eighth embodiment of the present invention;</p>
<p id="p-0137" num="0136"><figref idref="DRAWINGS">FIG. 26</figref> is a figure showing an example of application to a network in a ninth embodiment of the present invention;</p>
<p id="p-0138" num="0137"><figref idref="DRAWINGS">FIG. 27</figref> is a figure showing an example of application to a network in a tenth embodiment of the present invention;</p>
<p id="p-0139" num="0138"><figref idref="DRAWINGS">FIG. 28</figref> is an example of planned uninterruptible switching using LSS in an eleventh embodiment of the present invention;</p>
<p id="p-0140" num="0139"><figref idref="DRAWINGS">FIG. 29</figref> is an example of planned uninterruptible switching using LSS in a twelfth embodiment of the present invention;</p>
<p id="p-0141" num="0140"><figref idref="DRAWINGS">FIG. 30</figref> is a block diagram of a sending function unit of the packet transfer apparatus in a fourteenth embodiment of the present invention;</p>
<p id="p-0142" num="0141"><figref idref="DRAWINGS">FIG. 31</figref> is a block diagram of a sending function unit of the packet transfer apparatus in the fourteenth embodiment of the present invention;</p>
<p id="p-0143" num="0142"><figref idref="DRAWINGS">FIG. 32</figref> shows an example in a case for reflecting the priority of the user packet to the route identifier to be inserted;</p>
<p id="p-0144" num="0143"><figref idref="DRAWINGS">FIG. 33</figref> is a figure showing an example of a case for reflecting priority to a counter field;</p>
<p id="p-0145" num="0144"><figref idref="DRAWINGS">FIG. 34</figref> is a figure showing an example in which a counter is inserted in the inside of a VLAN tag;</p>
<p id="p-0146" num="0145"><figref idref="DRAWINGS">FIG. 35</figref> is a system block diagram in a fifteenth embodiment of the present invention;</p>
<p id="p-0147" num="0146"><figref idref="DRAWINGS">FIG. 36</figref> is a figure showing a configuration example of a sending function unit of a packet transfer apparatus in the fifteenth embodiment of the present invention;</p>
<p id="p-0148" num="0147"><figref idref="DRAWINGS">FIG. 37</figref> shows configuration examples of a packet when the target network is Ethernet;</p>
<p id="p-0149" num="0148"><figref idref="DRAWINGS">FIG. 38</figref> is a block diagram of a receiving function unit of the packet transfer apparatus in the fifteenth embodiment of the present invention;</p>
<p id="p-0150" num="0149"><figref idref="DRAWINGS">FIG. 39</figref> is a flowchart showing a process procedure of the receiving function unit of the packet transfer apparatus in the fifteenth embodiment of the present invention;</p>
<p id="p-0151" num="0150"><figref idref="DRAWINGS">FIG. 40</figref> is a flowchart showing a process procedure of the receiving function unit of the packet transfer apparatus in the fifteenth embodiment of the present invention;</p>
<p id="p-0152" num="0151"><figref idref="DRAWINGS">FIG. 41</figref> is a block diagram of a receiving function unit of the packet transfer apparatus in a sixteenth embodiment of the present invention;</p>
<p id="p-0153" num="0152"><figref idref="DRAWINGS">FIG. 42</figref> is a flowchart showing a process procedure of the receiving function unit of the packet transfer apparatus in the sixteenth embodiment of the present invention;</p>
<p id="p-0154" num="0153"><figref idref="DRAWINGS">FIG. 43</figref> is a figure for explaining a memory storing timestamps;</p>
<p id="p-0155" num="0154"><figref idref="DRAWINGS">FIG. 44</figref> is a figure for explaining a memory storing function values;</p>
<p id="p-0156" num="0155"><figref idref="DRAWINGS">FIG. 45</figref> is a flowchart showing a process procedure of the receiving function unit of the packet transfer apparatus in a seventeenth embodiment of the present invention;</p>
<p id="p-0157" num="0156"><figref idref="DRAWINGS">FIG. 46</figref> is a flowchart showing a process procedure of the receiving function unit of the packet transfer apparatus in the seventeenth embodiment of the present invention;</p>
<p id="p-0158" num="0157"><figref idref="DRAWINGS">FIG. 47</figref> is a block diagram of a receiving function unit of the packet transfer apparatus in a eighteenth embodiment of the present invention;</p>
<p id="p-0159" num="0158"><figref idref="DRAWINGS">FIG. 48</figref> is a flowchart showing a process procedure of the receiving function unit of the packet transfer apparatus in the eighteenth embodiment of the present invention;</p>
<p id="p-0160" num="0159"><figref idref="DRAWINGS">FIG. 49</figref> is a flowchart showing a process procedure of the receiving function unit of the packet transfer apparatus in the eighteenth embodiment of the present invention;</p>
<p id="p-0161" num="0160"><figref idref="DRAWINGS">FIG. 50</figref> is a network configuration diagram in a nineteenth embodiment of the present invention;</p>
<p id="p-0162" num="0161"><figref idref="DRAWINGS">FIG. 51</figref> shows a packet configuration example for Ethernet in the nineteenth embodiment of the present invention;</p>
<p id="p-0163" num="0162"><figref idref="DRAWINGS">FIG. 52</figref> is a block diagram of a receiving function unit of the packet transfer apparatus in the eighteenth embodiment of the present invention;</p>
<p id="p-0164" num="0163"><figref idref="DRAWINGS">FIG. 53</figref> is a block diagram of a receiving function unit of the packet transfer apparatus in a twentieth embodiment of the present invention;</p>
<p id="p-0165" num="0164"><figref idref="DRAWINGS">FIG. 54</figref> is a block diagram of a receiving function unit of the packet transfer apparatus in a twenty-first embodiment of the present invention;</p>
<p id="p-0166" num="0165"><figref idref="DRAWINGS">FIG. 55</figref> is a figure for explaining operation outline of the receiving function unit of the packet transfer apparatus in the twenty-first embodiment of the present invention;</p>
<p id="p-0167" num="0166"><figref idref="DRAWINGS">FIG. 56</figref> shows a packet configuration example for Ethernet in the twenty-first embodiment of the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0009" level="1">DESCRIPTION OF REFERENCE SIGNS</heading>
<p id="p-0168" num="0000">
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0167"><b>100</b>, <b>200</b>, <b>300</b>, <b>400</b>, <b>500</b>, <b>600</b>, <b>700</b>, <b>800</b> packet transfer apparatus</li>
    <li id="ul0001-0002" num="0168"><b>110</b>, <b>210</b> sending function unit</li>
    <li id="ul0001-0003" num="0169"><b>111</b>, <b>211</b> receiving unit</li>
    <li id="ul0001-0004" num="0170"><b>115</b>, <b>215</b> route-send/receive pair determination unit</li>
    <li id="ul0001-0005" num="0171"><b>112</b>, <b>212</b> copy unit</li>
    <li id="ul0001-0006" num="0172"><b>113</b>, <b>213</b> identifier providing unit</li>
    <li id="ul0001-0007" num="0173"><b>114</b>, <b>214</b> sending unit</li>
    <li id="ul0001-0008" num="0174"><b>116</b> high reliability determination unit</li>
    <li id="ul0001-0009" num="0175"><b>120</b>, <b>220</b>, <b>320</b>, <b>420</b>, <b>520</b>, <b>620</b>, <b>720</b>, <b>820</b> receiving function unit</li>
    <li id="ul0001-0010" num="0176"><b>121</b>, <b>221</b>, <b>321</b>, <b>421</b>, <b>521</b>, <b>621</b>, <b>721</b>, <b>821</b> receiving unit</li>
    <li id="ul0001-0011" num="0177"><b>122</b>, <b>222</b>, <b>322</b>, <b>422</b>, <b>522</b>, <b>622</b>, <b>722</b>, <b>822</b> memory A, memory B, memory C</li>
    <li id="ul0001-0012" num="0178"><b>123</b>, <b>223</b> selection unit</li>
    <li id="ul0001-0013" num="0179"><b>124</b>, <b>224</b>, <b>427</b>, <b>627</b>, <b>727</b>, <b>827</b> counter unit</li>
    <li id="ul0001-0014" num="0180"><b>125</b>, <b>225</b>, <b>325</b>, <b>425</b>, <b>525</b>, <b>625</b>, <b>725</b>, <b>825</b> sending unit</li>
    <li id="ul0001-0015" num="0181"><b>126</b>, <b>226</b> identifier referring unit</li>
    <li id="ul0001-0016" num="0182"><b>127</b>, <b>227</b>, <b>326</b>, <b>426</b>, <b>526</b>, <b>626</b>, <b>628</b>, <b>826</b> control unit</li>
    <li id="ul0001-0017" num="0183"><b>829</b> arriving counter/circulation counter unit</li>
</ul>
</p>
<heading id="h-0010" level="1">PREFERRED EMBODIMENTS FOR CARRYING OUT THE INVENTION</heading>
<p id="p-0169" num="0184">In the following, embodiments of the present invention are described with reference to figures. <figref idref="DRAWINGS">FIG. 1</figref> shows a schematic diagram of a packet transfer system in an embodiment of the present invention.</p>
<p id="p-0170" num="0185">In the figure, user networks <b>1</b> and <b>2</b> are connected via a wide area network <b>3</b>. Each of packet transfer apparatuses <b>4</b> and <b>5</b> of the present invention is provided on a border between the user network <b>1</b>, <b>2</b> and the wide area network <b>3</b>.</p>
<p id="p-0171" num="0186">When sending a packet to the wide area network <b>3</b>, the packet transfer apparatus (<b>4</b>, <b>5</b>) generates two copies of the packet sent from the user network <b>1</b> or <b>2</b>, provides a sequence number (to be also referred to as &#x201c;counter value&#x201d; or &#x201c;sequence identifier&#x201d;) indicating an order of the packets to the packets, so as to transfer the packets separately over independent routes. A receiving side selects one of the plural packets having the same information by referring to the counter value so as to transfer the selected packet downstream.</p>
<p id="p-0172" num="0187">By the way, in the present specification and claims, &#x201c;equal to or more than two independent routes&#x201d; mean different routes in which communications are not interrupted at the same time due to single failure or construction. In addition, in the present specification and claims, the wording &#x201c;packet&#x201d; is used to include meaning of &#x201c;frame&#x201d; that is transferred over a layer 2 network.</p>
<p id="p-0173" num="0188">In the configuration shown in <figref idref="DRAWINGS">FIG. 1</figref>, a plurality of packet transfer apparatuses may be provided in each of the sending side and the receiving side. In such a case, the packet transfer apparatus <b>4</b> adds, to the packet, an identifier for identifying a send/receive pair of the packet (a pair of a sending side packet transfer apparatus and a receiving side packet transfer apparatus), so that the packet transfer apparatus <b>5</b> can select a packet for each send/receive pair. In addition, the packet transfer apparatus <b>4</b> may provide a route identifier indicating a transfer route in the wide area network <b>3</b> so as to be able to transfer a packet over a route corresponding to the identifier. In addition, identifying information that serves both as identifying information of the send/receive pair (or only destination, or only source) and identifying information of the route can be provided.</p>
<p id="p-0174" num="0189">Each of the user network and the wide area network is the Ethernet, the MPLS, and other networks in which packets are transferred by encapsulation, and the like. In addition, the wide area network is a network including layer 2 switches for transferring a packet by determining a transfer destination by referring to destination information of the packet. By the way, it is preferable to insert the counter value used for identifying packets having the same information into a part that is not referred to by the layer 2 switch and the like for determining the destination while the packet is transferred.</p>
<p id="p-0175" num="0190"><figref idref="DRAWINGS">FIG. 2</figref> shows a network configuration example in a case when each of the user network and the wide area network is an Ethernet network.</p>
<p id="p-0176" num="0191">As shown in the figure, the Ethernet networks <b>1</b> and <b>2</b> in both edges are connected using an intermediate Ethernet network <b>3</b>. Ethernet switches <b>6</b> and <b>7</b> are provided at borders of the Ethernet network <b>3</b>. The packet transfer apparatuses <b>4</b> and <b>5</b> used in the present invention are provided in the outside of the Ethernet switches <b>6</b> and <b>7</b>, and are used for configuring a highly reliable Ethernet network. The packet transfer apparatus (<b>4</b>, <b>5</b>) generates two copies of an Ethernet packet from the Ethernet network <b>1</b> or <b>2</b> and sends the copies. Each of them is transferred separately so that the receiving side selects a normal one to transfer it downstream. As shown in <figref idref="DRAWINGS">FIG. 3</figref>, the copied packet is transmitted between the packet transfer apparatuses <b>4</b> and <b>5</b> as a packet to which two fields of a tag region and a counter region are added in addition to a normal Ethernet header and payload.</p>
<p id="p-0177" num="0192">Addition of the fields can be performed in the following way for example.</p>
<p id="p-0178" num="0193">When a target packet is an Ethernet packet, a tag field and a counter field are inserted following a source MAC address of the Ethernet packet, and a VLAN tag corresponding to the route and a sequence number are written. In addition, the tag field and the counter field is inserted following the source MAC address, so that a VLAN tag corresponding to the send/receive pair and a sequence number can be written. In addition, the tag field and the counter field is inserted following the source MAC address, so that a VLAN tag corresponding to the send/receive pair and a sending route, and a sequence number can be written. The tag field and the counter field may be inserted following the destination MAC address so that an identifying ID corresponding to the send/receive pair and a sequence number can be written.</p>
<p id="p-0179" num="0194">When using MPLS as the packet transfer technology, the tag field and the counter field can be inserted before a shim header of MPLS so that a shim header corresponding to the sending route and a sequence number can be written. In addition, the tag field and the counter field may be inserted before the shim header of MPLS for writing a shim header corresponding to the send/receive pair and a sequence number. In addition, the tag field and the counter field may be inserted before the shim header of MPLS for writing a shim header corresponding to the sending route, an identifying ID corresponding to the send/receive pair, and a sequence number. In addition, the tag field and the counter field may be inserted before the shim header of MPLS for writing a shim header corresponding to the sending route, the send/receive pair and a sequence number.</p>
<p id="p-0180" num="0195">In addition, when using encapsulation of a variable length packet as a packet transfer technology, a counter field is inserted after a header for encapsulation so that a sequence number is written. The receiving side apparatus can extracts an identifier corresponding to a send/receive pair or an identifier corresponding to a route from the header for encapsulation.</p>
<p id="p-0181" num="0196">Examples of packets corresponding to each scheme such as the Ethernet, MPLS and the like are described in the following in detail.</p>
<p id="p-0182" num="0197"><figref idref="DRAWINGS">FIG. 4</figref> is a figure showing examples of packet configurations in a case where the packet transfer apparatus of the present invention is applied to the Ethernet.</p>
<p id="p-0183" num="0198">(a) and (b) show normal packets sent from a user side. As shown in (a), the packet includes a layer 2 (L2) header region (including MAC address and the like) and a data (payload) region. (b) shows a case in which a VLAN tag (user VLAN) used in the user side is included. Also in each case described below, an example including the user VLAN and an example without it are shown. But, since presence or absence of the user VLAN is an only different point between the example including the user VLAN and the example without it, only the examples that do not include the user VLAN are described. By the way, there may be a case in which a plurality of VLAN tags are provided.</p>
<p id="p-0184" num="0199">A packet indicated by (c) includes a region of a LAN segment identifier (VLAN identifier, for example) indicating a LAN segment in the wide area network where the packet is transferred, a region of an identifier of a send/receive pair, and a region of a counter. The send/receive pair identifier can be determined based on MAC addresses of a source packet transfer apparatus and a destination packet transfer apparatus.</p>
<p id="p-0185" num="0200">When the number of the send/receive pair is one, or when the send/receive pair is not identified, a configuration (e) in which the send/receive pair identifier is not included can be adopted.</p>
<p id="p-0186" num="0201">In addition, when the plural copied packets are sent over different networks respectively, it is not necessary to identify a route in the network. Therefore, as indicated by (g), the LAN segment identifier can be omitted. Further when the number of the send/receive pair is one, or when the send/receive pair is not identified, a configuration including only the counter region shown in (i) can be adopted.</p>
<p id="p-0187" num="0202"><figref idref="DRAWINGS">FIG. 5</figref> is a figure showing other examples of packet configurations when the packet transfer apparatus is applied for the Ethernet. The example indicated by (a) includes a region of an identifier identifying a LAN segment in which the packet is transferred and the destination packet transfer apparatus, a region of an identifier identifying a source packet transfer apparatus, and a region of a counter. In addition, (c) shows an example including a region of an identifier identifying a LAN segment and a send/receive pair, and a region of a counter.</p>
<p id="p-0188" num="0203"><figref idref="DRAWINGS">FIG. 6</figref> is a figure showing other examples of packet configurations when the packet transfer apparatus is applied for MPLS. (a) shows a normal packet sent from the user side. (b) shows a normal packet of Ethernet over MPLS and the like. (b) is different from (a) in that (b) includes a L2 header after a L3 header. In each case in <figref idref="DRAWINGS">FIGS. 6 and 7</figref>, an example including the L2 header after the L3 header and an example without it are shown. However, since presence or absence of the L2 header is an only different point between the example including the L2 header after the L3 header and an example without it, only the examples that do not include the L2 header after the L3 header are described.</p>
<p id="p-0189" num="0204">(c) in <figref idref="DRAWINGS">FIG. 6</figref> is one in which a send/receive pair region and a counter region are provided before the shim header. In addition, (e) corresponds to one in which the send/receive pair region is omitted from (c).</p>
<p id="p-0190" num="0205"><figref idref="DRAWINGS">FIG. 7</figref> is a figure showing examples of packet configurations when the packet transfer apparatus is applied for the technology for encapsulating a packet and transferring it. Each of (a) and (b) shows a normal packet from the user side.</p>
<p id="p-0191" num="0206">(c) indicates one providing, before an encapsulation header, a region of an identifier identifying a route by which the packet is transferred in the wide area network, a region of a send/receive pair identifier, and a counter region. When it is not necessary to identify the send/receive pair, the configuration (e) can be adopted.</p>
<p id="p-0192" num="0207">By the way, an identifier indicating a route such as the LAN segment and an identifier indicating a destination, a source, a send/receive part and the like may be collectively referred to as a route identifier.</p>
<p id="p-0193" num="0208">As shown in <figref idref="DRAWINGS">FIGS. 4-7</figref>, it is preferable to provide the counter region in a part that is not referred to for determining a destination while the packet is transferred. Accordingly, there is a merit that the operation of the packet transfer apparatus of this invention can be realized irrespective of kinds of carriers of the wide area network in which the packet is transferred. In this method, for the Ethernet, as the identifier that is inserted into the packet and that is referred to while the packet is transferred for determining a destination, a VLAN tag format is desirable in consideration of compatibility to the network. On the other hand, it is also desirable to use the VLAN tag format as the counter region. However, considering that the counter region is not referred to while the packet is transferred, the counter region may have any field length. In addition, in cases other than the Ethernet, the length of the counter region can be any length. In the following, each embodiment is described.</p>
<heading id="h-0011" level="1">First Embodiment</heading>
<p id="p-0194" num="0209"><figref idref="DRAWINGS">FIG. 8</figref> is a figure showing a configuration of a packet transfer apparatus <b>100</b> realizing the first embodiment of the present invention.</p>
<p id="p-0195" num="0210">The packet transfer apparatus <b>100</b> shown in the figure includes a sending function unit <b>110</b> and a receiving function unit <b>120</b>. When the packet transfer apparatus <b>100</b> exists on a sending side, the sending function unit <b>110</b> is used. When the packet transfer apparatus <b>100</b> exists in a receiving side, the receiving function unit <b>120</b> is used.</p>
<p id="p-0196" num="0211">The sending function unit <b>110</b> includes a receiving unit <b>111</b>, a copy unit <b>112</b>, identifier providing units <b>113</b><sub>1 </sub>and <b>113</b><sub>2</sub>, and sending units <b>114</b><sub>1 </sub>and <b>114</b><sub>2</sub>.</p>
<p id="p-0197" num="0212">The sending function unit <b>110</b> receives a packet from the user network side by the receiving unit <b>111</b>, and generates two copies of the packet in the copy unit <b>112</b>. The copied packets are sent to the identifier providing units <b>113</b><sub>1 </sub>and <b>113</b><sub>2 </sub>respectively in which a counter region (sequence identifier region) is provided for each packet, and a counter value (sequence identifier) is written into the region. The counter value indicates a sequence of the packet, and is incremented by 1 each time when a packet is transferred and written. The packets generated by the identifier providing units <b>113</b><sub>1 </sub>and <b>113</b><sub>2 </sub>are sent to the wide area network side by the sending units <b>114</b><sub>1 </sub>and <b>114</b><sub>2 </sub>respectively.</p>
<p id="p-0198" num="0213">The receiving function unit <b>120</b> includes a receiving unit <b>121</b>, a memory A <b>122</b><sub>A</sub>, a memory B <b>122</b><sub>B</sub>, selection units <b>123</b><sub>1 </sub>and <b>123</b><sub>2</sub>, a counter unit <b>124</b>, and a sending unit <b>125</b>.</p>
<p id="p-0199" num="0214">In the receiving function unit <b>120</b>, packets of an A system and a B system are received from the wide area network by the two receiving units <b>121</b><sub>1 </sub>and <b>121</b><sub>2</sub>. The received packet of A system is stored in the memory A <b>122</b><sub>A</sub>, and the received packet of B system is stored in the memory B <b>122</b><sub>B</sub>. In this embodiment, each of the memories A <b>122</b><sub>A </sub>and B <b>122</b><sub>B </sub>are used as a FIFO (First In First Out). The packets read from the memory A <b>122</b><sub>A </sub>and the memory B <b>122</b><sub>B </sub>are identified in the selection units <b>123</b><sub>1 </sub>and <b>123</b><sub>2</sub>, so that a packet is selected. Then, the counter region added to the packet is deleted so as to be sent to the user network side from the sending unit <b>125</b>.</p>
<p id="p-0200" num="0215"><figref idref="DRAWINGS">FIG. 9</figref> shows another configuration of the packet transfer apparatus for realizing the first embodiment of the present invention. The example shown in <figref idref="DRAWINGS">FIG. 9</figref> is an example in which there exists a plurality of sending side packet transfer apparatuses and destination side packet transfer apparatuses, and a send/receive pair is identified.</p>
<p id="p-0201" num="0216">The packet transfer apparatus <b>100</b> shown in the figure includes a sending function unit <b>110</b> and a receiving function unit <b>120</b>. In <figref idref="DRAWINGS">FIG. 9</figref>, when the packet transfer apparatus <b>100</b> exists on a sending side, the sending function unit <b>110</b> is used. When the packet transfer apparatus <b>100</b> exists in a receiving side, the receiving function unit <b>120</b> is used.</p>
<p id="p-0202" num="0217">The sending function unit <b>110</b> includes a receiving unit <b>111</b>, a route-send/receive pair determination unit <b>115</b>, a copy unit <b>112</b>, identifier providing units <b>113</b><sub>1 </sub>and <b>113</b><sub>2</sub>, and sending units <b>114</b><sub>1 </sub>and <b>114</b><sub>2</sub>.</p>
<p id="p-0203" num="0218">The sending function unit <b>110</b> receives a packet from the user network side by the receiving unit <b>111</b>. Then, the route-send/receive pair determination unit <b>115</b> determines a packet transfer route and a send/receive pair (of packet transfer apparatuses) based on a destination of the packet and the like. By the way, when routes on which plural copies packets are transferred are predetermined, determination of the packet transfer route is not necessary.</p>
<p id="p-0204" num="0219">Then, the copy unit <b>112</b> generates two copies of the packet. The copied packets are sent to the identifier providing units <b>113</b><sub>1 </sub>and <b>113</b><sub>2 </sub>respectively in which a region of the route identifier (including identifying information of a route and identifying information of a send/receive pair) and a counter region are provided for each packet, so that a value is written into each region.</p>
<p id="p-0205" num="0220">Examples of the region of the route identifier and the counter region are as shown in <figref idref="DRAWINGS">FIGS. 4-7</figref>. A sequence number (sequence identifier) is written into the counter region. The packets generated by the identifier providing units <b>113</b><sub>1 </sub>and <b>113</b><sub>2 </sub>are sent to the wide area network by the sending units <b>114</b><sub>1 </sub>and <b>114</b><sub>2 </sub>respectively. The sending function unit <b>110</b> can be configured as one shown in <figref idref="DRAWINGS">FIG. 10</figref>. In this case, a packet to which an identifier and a counter value are provided by the identifier providing unit <b>113</b> is copied in the copy unit <b>112</b>.</p>
<p id="p-0206" num="0221">The receiving function unit <b>120</b> includes receiving units <b>121</b><sub>1 </sub>and <b>121</b><sub>2</sub>, a memory A <b>122</b><sub>A</sub>, a memory B <b>122</b><sub>B</sub>, identifier referring units <b>126</b><sub>1 </sub>and <b>126</b><sub>2</sub>, a control unit <b>127</b>, selection units <b>123</b><sub>1 </sub>and <b>123</b><sub>2</sub>, a counter unit <b>124</b>, and a sending unit <b>125</b>. The selection units and the counter unit are provided for each sending source, and the selection units <b>123</b><sub>1 </sub>and <b>123</b><sub>2 </sub>and the counter unit <b>124</b> correspond to one source. In addition, when different plural route pairs are adopted for the same send/receive pair, the selection units <b>123</b><sub>1 </sub>and <b>123</b><sub>2 </sub>and the counter unit <b>124</b> can be provided for each route pair in the same source. This feature similarly applies to other embodiments.</p>
<p id="p-0207" num="0222">The receiving function unit <b>120</b> receives packets of the A system and the B system from the wide area network <b>3</b> by the two receiving units <b>121</b><sub>1 </sub>and <b>121</b><sub>2</sub>. The received packet of the A system is stored in the memory A <b>122</b><sub>A</sub>, and the received packet of the B system is stored in the memory B <b>122</b><sub>B</sub>. In this embodiment, each of the memories A <b>122</b><sub>A </sub>and B <b>122</b><sub>B </sub>are used as a FIFO (First In First Out). Route identifies in data read from the memory A <b>122</b><sub>A </sub>and the memory B <b>122</b><sub>B </sub>are referred to in the identifier referring units <b>126</b><sub>1 </sub>and <b>126</b><sub>2 </sub>respectively, so that a source packet transfer apparatus is identified.</p>
<p id="p-0208" num="0223">Then, based on control by the control unit <b>127</b>, the packets are passed to the selection units <b>123</b><sub>1 </sub>and <b>123</b><sub>2 </sub>that correspond to the source of the packets, so that the selection units <b>123</b><sub>1 </sub>and <b>123</b><sub>2</sub>, and the counter unit <b>124</b> select a packet based on the sequence number. Then, the route identifier region and the counter region are deleted from the packet, and the packet is sent to the user network side by the packet sending unit <b>125</b>.</p>
<p id="p-0209" num="0224">Next, a process procedure by the counter unit <b>124</b> and the selection unit <b>123</b> is described. This process procedure similarly applies for <figref idref="DRAWINGS">FIGS. 8 and 9</figref>.</p>
<p id="p-0210" num="0225"><figref idref="DRAWINGS">FIG. 11</figref> is a flowchart showing the process procedure of the counter unit and the selection unit in the first embodiment of the present invention. The following procedure corresponds to one for one send/receive pair. In the configuration shown in <figref idref="DRAWINGS">FIG. 9</figref>, the following process is performed for each send/receive pair (for each source in the receiving function unit) by functions of the identifier referring unit and the control unit.</p>
<p id="p-0211" num="0226">Each of the sending function unit <b>110</b> and the receiving function unit <b>120</b> includes two systems of the A system and the B system. Each receiving unit waits for arrival of a packet, and stores an arriving packet into a memory used as FIFO. When the packet exists in the memory A, the selection unit <b>123</b><sub>1 </sub>obtains the oldest packet in the FIFO (steps <b>10</b>, <b>10</b>), refers to a counter value of the packet, and substitutes the counter value into CA. Comparing CA with a reference counter CF that is managed by the counter unit (step <b>103</b>), the procedure conditionally branches off to any one of three cases: CF=CA, CF&#x3e;CA, and CF&#x3c;CA. When CF=CA, the packet is transferred to the packet sending unit <b>125</b>, and the state is changed to a packet waiting state (step <b>104</b>). When CF&#x3e;CA, the packet is discarded, and the state is changed to the packet waiting state (step <b>105</b>). When CF&#x3c;CA, the state is changed to a B system packet waiting state (step <b>106</b>).</p>
<p id="p-0212" num="0227">When the packet exists in the B system, the selection unit <b>123</b><sub>2 </sub>obtains the oldest packet in the memory B <b>122</b><sub>B </sub>used as the B system FIFO (step <b>107</b>), refers to a counter value of the packet, and substitutes the counter value into CB. Comparing CF with CB (step <b>108</b>), the procedure conditionally branches off according to a case among three cases: CF&#x3e;CB, CF=CB and CF&#x3c;CB. When CF&#x3e;CB, the packet is discarded, and the state is changed to the B system packet waiting state (step <b>109</b>). When CF=CB, the packet is transferred, and the state is changed to the A system packet waiting state after incrementing the value of CF by 1 (step <b>110</b>). When CF&#x3c;CB, the state is changed to the A system packet waiting state after incrementing the value of CF by 1 (step <b>111</b>).</p>
<p id="p-0213" num="0228">The route identifier region and the counter region are removed from the packet sent to the packet sending unit <b>125</b>, so that the packet is transferred to the user network side.</p>
<p id="p-0214" num="0229">According to the above-mentioned operation, it can be realized that packets having the same information are identified based on the sequence, and that one of the packets having the same information is transferred downstream following the sequence of the packet.</p>
<p id="p-0215" num="0230">For carrying out the algorithm of this embodiment, if the condition of CF=CA continues, there is a possibility that the memory B <b>122</b><sub>B </sub>of the B system may overflow. In such a case, several measures can be considered as follows.</p>
<p id="p-0216" num="0231">(1) Configuring each FIFO of the memory A <b>122</b><sub>A </sub>and the memory B <b>122</b><sub>B </sub>as a circulating FIFO. In this configuration, the memory does not overflow, and an old packet is overwritten by a new packet.</p>
<p id="p-0217" num="0232">(2) Deleting old data forcibly when the data amount exceeds a predetermined amount when writing into the FIFO of the memory A <b>122</b><sub>A </sub>and the memory B <b>122</b><sub>B</sub>.</p>
<p id="p-0218" num="0233">(3) Exchanging the role of A system and B system periodically to avoid overflow.</p>
<p id="p-0219" num="0234">(4) Adding an algorithm. <figref idref="DRAWINGS">FIG. 12</figref> shows the algorithm in which the measure against overflow of the B system memory <b>122</b><sub>B </sub>is taken. Difference compared to <figref idref="DRAWINGS">FIG. 11</figref> is as follows. After performing processing such as packet transfer when the condition CF=CA is satisfied, an used amount of the memory B <b>122</b><sub>B </sub>is checked. If the amount exceeds a predetermined threshold, the state is changed to the B system packet waiting state (step <b>201</b>). Other parts of the procedure are the same as those of <figref idref="DRAWINGS">FIG. 11</figref>.</p>
<p id="p-0220" num="0235">The packet transfer apparatus can be configured as one shown in <figref idref="DRAWINGS">FIG. 13</figref>. Between the configuration shown in <figref idref="DRAWINGS">FIG. 13</figref> and the configuration shown in <figref idref="DRAWINGS">FIG. 9</figref>, the configuration of the receiving function unit <b>120</b> is different. In the configuration of <figref idref="DRAWINGS">FIG. 9</figref>, the route identifier of the packet read from the memory is referred to so that the packet is distributed to the selection unit and the counter unit for each send/receive pair. On the other hand, in the configuration of <figref idref="DRAWINGS">FIG. 13</figref>, the route identifier in the received packet is referred to first, then, the packet is stored in the memory for each send/receive pair. The operation of the configuration of <figref idref="DRAWINGS">FIG. 13</figref> is the same as the operation shown in <figref idref="DRAWINGS">FIGS. 11 and 12</figref> in view of each send/receive pair.</p>
<heading id="h-0012" level="1">Second Embodiment</heading>
<p id="p-0221" num="0236">In this embodiment, an apparatus configuration shown in <figref idref="DRAWINGS">FIG. 8</figref> or <figref idref="DRAWINGS">FIG. 13</figref> in the first embodiment is used. However, although a FIFO or a circulating FIFO is used for the memory A <b>122</b><sub>A </sub>and the memory B <b>122</b><sub>B </sub>in the first embodiment, a circulating hash is used in this embodiment.</p>
<p id="p-0222" num="0237"><figref idref="DRAWINGS">FIG. 14</figref> is a figure for explaining a case when using the circulating hash as the memory in the second embodiment of the present invention.</p>
<p id="p-0223" num="0238">In the circulating hash, a given memory region is divided into n (an integer), and 1&#x2dc;n are provided as addresses. As to a packet sent from the wide area network, the counter value is referred to, and the packet is stored in a memory region whose address is a remainder of the counter value when divided by n. For storing the packet, as long as the packet includes the data (payload) region in the L2 header, the route identifier region, the counter region, and the data (payload) region, the whole parts of the packet may be stored or some parts of them may be selected to be stored. For information in the memory A <b>122</b><sub>A </sub>and the memory B <b>122</b><sub>B </sub>configured in the above-mentioned way, the counter unit and the selection unit operate according to a process procedure shown in <figref idref="DRAWINGS">FIG. 15</figref>.</p>
<p id="p-0224" num="0239"><figref idref="DRAWINGS">FIG. 15</figref> shows a flowchart of the process procedure of the counter unit and the selection unit in the second embodiment of the present invention. The following process corresponds to one for one send/receive pair. That is, by functions of the identifier referring unit and the control unit, following processes are performed for each send/receive pair (for each source in the receiving function unit).</p>
<p id="p-0225" num="0240">The receiving function unit <b>120</b> includes two systems of the A system and the B system. A system that mainly receives packets is called a selected system, and a standby system is called a non-selected system. For example, when packets from the A system are mainly transferred, the A system is called the selected system, and the B system is called the non-selected system. Assignment of the selected system/the non-selected system is not fixed, but they may be exchanged according to conditions. When packet processing starts, both of the A system and the B system enter a packet waiting state. In this state, a system that receives a packet first is regarded as the selected system. At this time, a counter value that is read is set into CF (step <b>301</b>). In the following, it is assumed that the A system is the selected system.</p>
<p id="p-0226" num="0241">Next, the main process procedure starts.</p>
<p id="p-0227" num="0242">The procedure conditionally branches off to one of two branches according to presence or absence of data in a location corresponding to an address of CF in the memory A <b>122</b><sub>A </sub>of the selected system (step <b>302</b>).</p>
<p id="p-0228" num="0243">(1) When the data exists, data of the address of CF is obtained from the memory A <b>122</b><sub>A</sub>, and the data is transferred to perform send processing (step <b>303</b>). After that, CF is incremented by 1 (step <b>304</b>), and presence or absence of data in the location corresponding to the address of CF in the memory A <b>122</b><sub>A </sub>of the selected system is checked again.</p>
<p id="p-0229" num="0244">(2) When the data does not exist, it is checked whether data exists in an address of CF in the memory B <b>122</b><sub>B </sub>of the non-selected system (step <b>305</b>), and the branch is further divided into two according to presence or absence of the data in the memory B <b>122</b><sub>B </sub>of the non-selected system.</p>
<p id="p-0230" num="0245">(2-1) When the data exists, the data existing at the address of CF in the memory B <b>122</b><sub>B </sub>of the non-selected system is obtained and the data is sent (step <b>306</b>). After that, CF is incremented by 1 (step <b>304</b>), and presence or absence of data in the memory A <b>122</b><sub>A </sub>of the selected system is checked again.</p>
<p id="p-0231" num="0246">(2-2) When the data does not exist in step <b>305</b>, timeout waiting is performed (steps <b>307</b>, <b>308</b>). When CF-th data arrives before timeout (step <b>309</b>), the send processing of (2-1) is performed, and the names of the selected system and the non-selected system are exchanged (step <b>310</b>). When the timeout occurs, sending is given up, and CF is incremented by 1 (step <b>304</b>), and the state is changed to packet processing state in the selected system.</p>
<p id="p-0232" num="0247">By using the circulating hash, the packet is stored in a memory region at an address that is a reminder of the counter value when divided by n. Even when a frame having N as the counter value arrives faster than a frame having N-n as the counter value, the reversal of the arriving sequence within n-th can be corrected to a correct sequence when reading the packet from the circulating hash by considering the counter value and by reading the packet in the order of the counter value.</p>
<heading id="h-0013" level="1">Third Embodiment</heading>
<p id="p-0233" num="0248"><figref idref="DRAWINGS">FIG. 16</figref> is a figure showing a configuration of a packet transfer apparatus in the third embodiment of the present invention.</p>
<p id="p-0234" num="0249">The packet transfer apparatus <b>200</b> shown in the figure includes a sending function unit <b>210</b> and a receiving function unit <b>220</b>.</p>
<p id="p-0235" num="0250">The sending function unit <b>210</b> includes a receiving unit <b>211</b>, a copy unit <b>212</b>, encoding units <b>213</b><sub>1 </sub>and <b>213</b><sub>2</sub>, and sending units <b>214</b><sub>1 </sub>and <b>214</b><sub>2</sub>. The configuration is the same as one of the first embodiment shown in <figref idref="DRAWINGS">FIG. 8</figref>.</p>
<p id="p-0236" num="0251">The receiving function unit <b>220</b> includes receiving units <b>221</b><sub>1 </sub>and <b>221</b><sub>2</sub>, a memory A <b>222</b><sub>A</sub>, a memory B <b>222</b><sub>B</sub>, selection units <b>223</b><sub>1 </sub>and <b>223</b><sub>2</sub>, a counter unit <b>224</b>, and a sending unit <b>225</b>. The receiving function unit <b>220</b> receives packets by the receiving units <b>221</b><sub>1 </sub>and <b>221</b><sub>2</sub>, and writes each packet into the memory A <b>222</b><sub>A </sub>or the memory B <b>222</b><sub>B</sub>. Each of the memory A <b>222</b><sub>A </sub>and the memory B <b>222</b><sub>B </sub>is used as FIFO.</p>
<p id="p-0237" num="0252">The selection units <b>223</b><sub>1 </sub>and <b>223</b><sub>2 </sub>read data from the memory A <b>222</b><sub>A </sub>and the memory B <b>222</b><sub>B</sub>, and transfer the data to a shared memory C <b>222</b><sub>C </sub>according to an after-mentioned procedure.</p>
<p id="p-0238" num="0253">The shared memory C <b>222</b><sub>C </sub>forms a circulating hash shown in <figref idref="DRAWINGS">FIG. 14</figref>. Data is read under control of the counter unit <b>224</b> and is transferred to the user network by the sending unit <b>225</b>.</p>
<p id="p-0239" num="0254"><figref idref="DRAWINGS">FIG. 17</figref> shows another example of the packet transfer apparatus <b>200</b> in this embodiment. The example shown in <figref idref="DRAWINGS">FIG. 17</figref> corresponds to a case in which there are a plurality of sending side packet transfer apparatuses and a destination side packet transfer apparatuses, and a send/receive pair is identified.</p>
<p id="p-0240" num="0255">The packet transfer apparatus <b>200</b> shown in the figure includes a sending function unit <b>210</b> and a receiving function unit <b>220</b>.</p>
<p id="p-0241" num="0256">The sending function unit <b>210</b> includes a packet receiving unit <b>211</b>, a route-send/receive pair determination unit <b>215</b>, a copy unit <b>212</b>, identifier providing units <b>213</b><sub>1 </sub>and <b>213</b><sub>2</sub>, and sending units <b>214</b><sub>1 </sub>and <b>214</b><sub>2</sub>. The configuration is the same as one of the first embodiment shown in <figref idref="DRAWINGS">FIG. 9</figref>.</p>
<p id="p-0242" num="0257">The receiving function unit <b>220</b> includes packet receiving units <b>221</b><sub>1 </sub>and <b>221</b><sub>2</sub>, a memory A <b>222</b><sub>A</sub>, a memory B <b>222</b><sub>B</sub>, a shared memory C <b>222</b><sub>C </sub>identifier referring units <b>226</b><sub>1 </sub>and <b>226</b><sub>2</sub>, a control unit <b>227</b>, selection units <b>223</b><sub>1 </sub>and <b>223</b><sub>2</sub>, a counter unit <b>224</b>, and a sending unit <b>225</b>. The counter unit and the shared memory C are provided for each source, and the counter unit <b>224</b> and the shared memory C <b>222</b><sub>C </sub>corresponds to one of the sources.</p>
<p id="p-0243" num="0258">The receiving function unit <b>220</b> receives packets by the receiving units <b>221</b><sub>1 </sub>and <b>221</b><sub>2</sub>, and writes each packet into the memory A <b>222</b><sub>A </sub>or the memory B <b>222</b><sub>B</sub>. Each of the memory A <b>222</b><sub>A </sub>and the memory B <b>222</b><sub>B </sub>is used as FIFO.</p>
<p id="p-0244" num="0259">Each of the identifier referring units <b>226</b><sub>1</sub>, <b>226</b><sub>2 </sub>refers to the route identifier of a packet so as to identify a source of the packet. Then, based on control by the control unit <b>227</b>, the selection unit <b>223</b><sub>1 </sub>or <b>223</b><sub>2 </sub>transfers data from the memory A <b>222</b><sub>A </sub>or the memory B <b>222</b><sub>B </sub>to the shared memory C corresponding to the source for each source identified by the identifier referring units <b>226</b><sub>1 </sub>and <b>226</b><sub>2 </sub>according to an after-mentioned procedure.</p>
<p id="p-0245" num="0260">The shared memory C <b>222</b><sub>C </sub>forms a circulating hash shown in <figref idref="DRAWINGS">FIG. 14</figref>. Data is read under control of the counter unit <b>224</b> and is transferred to the user network by the sending unit <b>225</b>.</p>
<p id="p-0246" num="0261"><figref idref="DRAWINGS">FIG. 18</figref> is a flowchart showing the procedure for writing from the memory A, B to the shared memory C in the third embodiment of the present invention. In the following, although the procedure is described based on the configuration of <figref idref="DRAWINGS">FIG. 17</figref>, the same operation is performed also in the case of <figref idref="DRAWINGS">FIG. 16</figref>. The procedure shown in <figref idref="DRAWINGS">FIGS. 18 and 19</figref> corresponds to one send/receive pair. That is, following processes are performed by the functions of the identifier referring unit and the control unit for each send/receive pair (for each source in the receiving function unit).</p>
<p id="p-0247" num="0262">The identifier referring unit <b>226</b> and the selection unit <b>223</b> wait for receiving a packet (step <b>401</b>). When data exists in the memory A <b>222</b><sub>A </sub>or the memory B <b>222</b><sub>B </sub>(step <b>402</b>), the data is obtained, and a sequence number is read from the counter region of the packet (step <b>403</b>). When a region in the memory C corresponding to the sequence number is not available (step <b>404</b>, No), the packet is discarded (step <b>406</b>). When the region is available, the packet from which the route identifier region and the counter region are removed is written in the corresponding region of the memory C <b>222</b><sub>C </sub>(step <b>405</b>), and the state is changed to packet waiting.</p>
<p id="p-0248" num="0263"><figref idref="DRAWINGS">FIG. 19</figref> is a flowchart showing a procedure for transferring data of the shard memory C by the counter unit in the third embodiment of the present invention.</p>
<p id="p-0249" num="0264">From the packet waiting state (step <b>501</b>), it is checked whether there is data in a F (integer)-th entry in the memory C <b>222</b><sub>C </sub>(step <b>502</b>), and the procedure conditionally branches off to one of two branches according to presence or absence of data.</p>
<p id="p-0250" num="0265">(1) When there is data, the data is transferred to the sending unit <b>225</b> (step <b>503</b>), and F is incremented by 1 so as to return to the packet receiving state.</p>
<p id="p-0251" num="0266">(2) When data does not exist, waiting for timeout is performed. Further, the procedure conditionally branches off to two (step <b>505</b>).</p>
<p id="p-0252" num="0267">(2-1) When F-th data arrives before timeout, the data is sent (step <b>503</b>), and the value of F is incremented by 1 (step <b>504</b>).</p>
<p id="p-0253" num="0268">(2-2) When timeout occurs, it is checked whether any entry after F+1 exists (step <b>506</b>). Conditional branching into one of two occurs according to presence or absence of data.</p>
<p id="p-0254" num="0269">(2-2-1) When the entry exists, the value of F is incremented by 1 (step <b>504</b>), and the state is changed to the packet waiting state.</p>
<p id="p-0255" num="0270">(2-2-2) When the entry does not exist, the state is changed to the packet waiting state.</p>
<heading id="h-0014" level="1">Fourth Embodiment</heading>
<p id="p-0256" num="0271">Next, a redundancy configuration in the fourth embodiment is described. In fourth-tenth embodiments, a case in which the packet transfer apparatus is applied on the Ethernet is described as an example. By the way, although the configuration of the sending side apparatus and the receiving side apparatus in the following description may be any one of the before-mentioned first-third embodiments, it is not necessary to identify the send/receive pair in this embodiment.</p>
<p id="p-0257" num="0272"><figref idref="DRAWINGS">FIG. 20(A)</figref> shows a configuration for realizing redundancy for all Ethernet packets. The copy unit in the sending side apparatus generates two copies of a send packet. Then, the identifier providing unit newly provides a VLAN tag (&#x201c;VLAN-A&#x201d; in the figure) and a sequence number for identifying the same sending sequence to each copy, and the two copies are sent to different networks respectively from the sending units. The selection units in the receiving side apparatus select one that arrives first in the packets having the same sequence so as to send the selected packet downstream. When another packet arrives, the packet is discarded.</p>
<p id="p-0258" num="0273"><figref idref="DRAWINGS">FIG. 20(B)</figref> shows a configuration for realizing redundancy by selecting an Ethernet packet having &#x201c;VLAN-A&#x201d; as VLAN setting. The sending side apparatus identifies the packet having VLAN-A as the VLAN setting, and the copy unit generates two copies of the packet. Then, the identifier providing units newly provide a VLAN tag (&#x201c;VLAN-B&#x201d; in the figure) and a sequence number for identifying the same sending sequence to each packet, so that the packet sending units send two copies to different networks respectively.</p>
<heading id="h-0015" level="1">Fifth Embodiment</heading>
<p id="p-0259" num="0274"><figref idref="DRAWINGS">FIG. 21</figref> shows a configuration for realizing redundancy for Ethernet packets in the fifth embodiment of the present invention. By the way, although the configurations of the sending side apparatus and the receiving side apparatus in the following description may be any one of the before-mentioned first-third embodiments, it is not necessary to identify the send/receive pair also in this embodiment.</p>
<p id="p-0260" num="0275"><figref idref="DRAWINGS">FIG. 21(A)</figref> shows a configuration for realizing redundancy by selecting Ethernet packets having &#x201c;VLAN-A&#x201d; as the VLAN tag. In the sending side apparatus, the copy unit generates two copies of a send packet. Then, the identifier providing units provide different VLAN tags (&#x201c;VLAN-B&#x201d; and &#x201c;VLAN-C&#x201d; in the figure) and a sequence number for identifying the same sending sequence to the copies respectively, and the two copies are sent to different networks respectively from the sending units. In the receiving side apparatus, two ports (receiving units) are set so as to receive only packets of &#x201c;VLAN-B&#x201d; and packets of &#x201c;VLAN-C&#x201d; respectively. Routes on which the packet of &#x201c;VLAN-B&#x201d; and the packet of &#x201c;VLAN-C&#x201d; are transmitted in the wide area network can be different independent routes in which communications are not interrupted at the same time due to a single failure or construction.</p>
<p id="p-0261" num="0276"><figref idref="DRAWINGS">FIG. 21(B)</figref> shows a configuration for realizing redundancy for all packets to which the VLAN tag is not provided. In the same way as the process mentioned above, in the sending side apparatus, the copy unit generates two copies of the packet, the identifier providing units newly provide different VLAN tags (&#x201c;VLAN-A&#x201d; and &#x201c;VLAN-B&#x201d; in the figure) and a sequence number for identifying the same sending sequence to the copies, so that the packet sending units send two copies to different networks respectively.</p>
<p id="p-0262" num="0277"><figref idref="DRAWINGS">FIG. 21(C)</figref> shows a configuration for realizing redundancy by selecting packets having &#x201c;VLAN-A&#x201d; as the VLAN tag like the case shown in <figref idref="DRAWINGS">FIG. 21(A)</figref>. In the sending side apparatus, different VLAN tags (&#x201c;VLAN-B&#x201d; and &#x201c;VLAN-C&#x201d; in the figure) are provided to the two copies respectively. In the receiving side apparatus, one port is set so as to receive both of &#x201c;VLAN-B&#x201d; and &#x201c;VLAN-C&#x201d;. Thus, settings in the sending side apparatus and in the receiving side apparatus are not necessarily the same.</p>
<heading id="h-0016" level="1">Sixth Embodiment</heading>
<p id="p-0263" num="0278"><figref idref="DRAWINGS">FIG. 22</figref> is a figure for explaining realizing a multipoint configuration by setting timeout in the sixth embodiment of the present invention. By the way, the configurations of the sending apparatus and the receiving apparatus in the following description are configurations that can set timeout in the first-third embodiments.</p>
<p id="p-0264" num="0279">In the configuration of the example of <figref idref="DRAWINGS">FIG. 22</figref> in which a timeout function is used, a finite time is set for waiting for a packet of a sequence number in the receiving unit of the receiving side apparatus, and in the sending unit in the receiving side apparatus, when a predetermined time comes, a packet of a next sequence number is automatically sent downstream. In the case of this embodiment, a timer (not shown in the figure) for measuring the predetermined time is provided to the receiving unit and the sending unit in the receiving side apparatus.</p>
<heading id="h-0017" level="1">Seventh Embodiment</heading>
<p id="p-0265" num="0280"><figref idref="DRAWINGS">FIG. 23</figref> is a figure showing a configuration for providing a VLAN tag in the seventh embodiment of the present invention.</p>
<p id="p-0266" num="0281"><figref idref="DRAWINGS">FIG. 23(A)</figref> shows a configuration for providing VLAN tags depending on send/receive pairs. The copy unit of the sending side apparatus copies the sending packet into two copies. When the identifier providing units provide the same sequence number, a VLAN tag depending on a send/receive pair to each of the two copies, and the sequence number is provided to each packet of the send/receive pair from 1, so that the two copies are sent from the packet sending units to separate networks respectively. The packet here corresponds to one in which a part depending on &#x201c;LAN segment&#x201d; is removed from the route identifier in (c) or (d) in <figref idref="DRAWINGS">FIG. 5</figref>. As shown in <figref idref="DRAWINGS">FIG. 23(A)</figref>, for example, a packet sent from an apparatus X to an apparatus P is provided with &#x201c;VLAN-PX&#x201d; as the VLAN tag.</p>
<p id="p-0267" num="0282">The selection units of the receiving side apparatus identify the VLAN tag of the packets received from the two networks, and identify packets having the same information and the sequence based on the sequence number for packets having a VLAN tag indicating the same source. Then, one is selected from among packets of the same sequence so that the selected packet is sent from the sending unit and another packet is discarded.</p>
<p id="p-0268" num="0283">As to the VLAN tag, the identifier providing units newly provide the VLAN tag irrespective of whether an input packet includes a VLAN tag or not. Accordingly, the multipoint configuration can be realized.</p>
<p id="p-0269" num="0284">By the way, the send/receive pair can be determined from the source and destination MAC addresses, VLAN setting and the like of the Ethernet packet to be transferred.</p>
<p id="p-0270" num="0285"><figref idref="DRAWINGS">FIG. 23(B)</figref> shows a configuration for providing a VLAN tag depending on a send/receive pair and a sending route. The copy unit of the sending side apparatus copies the sending packet into two copies. When the identifier providing units provide the same sequence numbers, VLAN tags are provided such that the VLAN tags are different for the two redundant packets and the VLAN tags are unique for identifying each send/receive pair, then, the sequence number is provided to each packet from 1 for each send/receive apparatus pair. Accordingly, the routes of the two packets can be identified. The packet here corresponds to one in (c) or (d) of <figref idref="DRAWINGS">FIG. 5</figref>. As shown in <figref idref="DRAWINGS">FIG. 23(B)</figref>, for example, packets sent from an apparatus X to an apparatus P are provided with &#x201c;VLAN-P1X&#x201d; and &#x201c;VLAN-P2X&#x201d; respectively as a VLAN tag.</p>
<p id="p-0271" num="0286">In the receiving side apparatus, the identifier referring units identify each VLAN tag to identify packets having the VLAN tag indicating the same source, and identify packets having the same information and the sequence of them based on the sequence number. Accordingly, the multipoint configuration can be realized. For example, when there are a plurality of pairs of routes, packets that are sent from the same source and transmitted via the same route pair can be identified.</p>
<p id="p-0272" num="0287">When providing the VLAN tag corresponding to a send/receive pair and a route, two VLAN tags corresponding to the send/receive pair and the route respectively can be provided. <figref idref="DRAWINGS">FIGS. 24(A)</figref> and (B) shows examples of the case. For example, in <figref idref="DRAWINGS">FIG. 24(A)</figref>, VLAN-P and VLAN-X are provided in place of VLAN-PX shown in <figref idref="DRAWINGS">FIG. 23(A)</figref>. In addition, in <figref idref="DRAWINGS">FIG. 24(B)</figref>, VLAN-P1 and VLAN-X are provided in place of VLAN-P1X of <figref idref="DRAWINGS">FIG. 23(B)</figref>.</p>
<heading id="h-0018" level="1">Eighth Embodiment</heading>
<p id="p-0273" num="0288"><figref idref="DRAWINGS">FIG. 25</figref> shows a figure for explaining the method for providing a VLAN tag depending on a sending route and an ID depending on a send/receive pair. The configuration of the sending side apparatus and the receiving side apparatus in the following description may be any of the before-mentioned first-third embodiments.</p>
<p id="p-0274" num="0289">In the configuration of the example shown in the figure, a VLAN tag depending on the sending route is provided, and in addition to that, an identifying ID depending on the send/receive apparatuses pair is provided. The copy unit of the sending side apparatus copies the send packet into two copies. When the identifier providing units provide the same sequence numbers, the identifier providing units newly provide VLAN tags such that the VLAN tags depending on the sending routes are different for the two redundant packets, then, provide the sequence number and the ID that are different for each send/receive apparatus pair. The packet here almost corresponds to one in (c) or (d) of <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0275" num="0290">In the receiving side apparatus, the identifier referring units refer to the VLAN tag and the ID to identify packets sent from the same source via the same route pair, and identify packets having the same information and the sequence of them based on the sequence number. Then, one of the packets having the same sequence is sent from the sending unit and another packet is discarded.</p>
<heading id="h-0019" level="1">Ninth Embodiment</heading>
<p id="p-0276" num="0291"><figref idref="DRAWINGS">FIG. 26</figref> is a figure showing an example of application to a network in the ninth embodiment of the present invention. In the figure, an example applied to a metro-loop is shown. In the figure, &#x201c;uninterruptible Ethernet&#x201d; corresponds to the above-mentioned packet transfer apparatus.</p>
<p id="p-0277" num="0292">In the configuration shown in the figure, two packets that are generated by copying in the sending side apparatus are sent via routes in reverse directions respectively on the ring. For example, this example can be applied to a case where packets having the same VLAN tag are sent via different networks. The different networks in this embodiment are examples of networks that forms physically independent routes.</p>
<heading id="h-0020" level="1">Tenth Embodiment</heading>
<p id="p-0278" num="0293"><figref idref="DRAWINGS">FIG. 27</figref> is a figure showing an example of application to a network in the tenth embodiment of the present invention. In the figure, an example applied to an Ethernet private line is shown. In the figure, &#x201c;uninterruptible Ethernet&#x201d; corresponds to the above-mentioned packet transfer apparatus.</p>
<p id="p-0279" num="0294">In the configuration shown in the figure, two packets that are generated by copying in the sending side apparatus are sent to different Ethernet private lines respectively. For example, this example can be applied to a case where packets having the same VLAN tag are sent via different networks. The different networks in this embodiment are examples of independent routes using private lines.</p>
<heading id="h-0021" level="1">Eleventh Embodiment</heading>
<p id="p-0280" num="0295"><figref idref="DRAWINGS">FIG. 28</figref> shows an example of planned uninterruptible switching using LSS in the eleventh embodiment of the present invention. The figure shows an example in which the packet transfer apparatus performs planned uninterruptible switching using Link Signaling Sublayer (LSS) protocol. A counter is sent by preparing LSS byte in Inter Frame Gap (IFG) (FIG. <b>28</b>(A)), and by measuring a counter delay difference between an active system and a standby system, one having greater delay is discarded. When arrival of the counter of the active system is delayed due to failure and the like, a packet of the standby system is selected (<figref idref="DRAWINGS">FIG. 28(B)</figref>).</p>
<heading id="h-0022" level="1">Twelfth Embodiment</heading>
<p id="p-0281" num="0296">FIGS. <b>29</b>(A)-(C) show examples of planned uninterruptible switching using LSS in the twelfth embodiment of the present invention. In the figure, the packet transfer apparatus performs switching between the active system and the standby system by sending an APS (Automatic Protection Switching)-like protocol inbound.</p>
<heading id="h-0023" level="1">Thirteenth Embodiment</heading>
<p id="p-0282" num="0297">In this embodiment, a variable-length encapsulation technology is described.</p>
<p id="p-0283" num="0298">As the variable-length encapsulation technology, an internet encapsulation protocol can be used, for example. For example, a method can be adopted in which a counter field is inserted between an encapsulation header and a datagram.</p>
<p id="p-0284" num="0299">In addition, a GRE encapsulation technology can be used. In the GRE encapsulation technology, a method is adopted in which a sending header+GRE header is provided to an original datagram as the encapsulation header. For example, a method to insert the counter field between the GRE header and the datagram can be adopted.</p>
<p id="p-0285" num="0300">In addition, an IPinIP tunneling technology can be used. The IPinIP tunneling technology uses a method for providing external IP header+tunneling header to an original datagram as the encapsulation header, and a method for inserting the counter field between the tunneling header and the datagram can be adopted.</p>
<p id="p-0286" num="0301">In addition, encapsulation using PPP or HDLC can be used. For example, a method for inserting the counter field between a PPP header and a datagram can be adopted.</p>
<p id="p-0287" num="0302">In addition, encapsulation by GFP can be used. For example, a method for inserting the counter field between an overhead and the datagram can be adopted.</p>
<p id="p-0288" num="0303">In addition to them, any technology that enables stacking between a header (overhead) and a datagram in the encapsulation technology can be applied to the present invention.</p>
<p id="p-0289" num="0304">The packet transfer apparatus of the present invention can be realized by loading a program, onto a computer used as the packet transfer apparatus, for causing the computer to execute operations of the sending function unit and the receiving function unit. The program can be distributed via a network.</p>
<p id="p-0290" num="0305">In addition, the program can be installed into the computer, when it is executed, by storing the program into a disk apparatus connected to the packet transfer apparatus, or a portable storing medium such as a flexible disk, CD-ROM and the like.</p>
<heading id="h-0024" level="1">Fourteenth Embodiment</heading>
<p id="p-0291" num="0306">Next, an embodiment is described in which a packet that requires high reliability and a packet that does not require it are identified by referring to information of a packet header, and transfer to plural routes is performed only for the packet that requires high reliability. The technology of this embodiment can be applied to a network of a user having various requirements for reliability.</p>
<p id="p-0292" num="0307">In this embodiment, the sending side packet transfer apparatus refers to a part of the packet header of a packet so as to discriminate between the packet that requires high reliability and the packet that does not require it, and copies the packet that requires high reliability to send the copies to all independent routes. The packet that does not require high reliability is not copied and is sent to one of the independent routes. In the receiving side packet transfer apparatus, the receiving unit refers to the part of the packet header of a packet arriving from the independent route so as to determine whether the packet is a high reliability packet. For the high reliability packet, sameness of packets arriving from the plurality routes can be determined. When the same packets arrive from equal to or more than two routes, only one of the packets is transferred downstream and other ones are discarded. When the same packet arrives only from one route, the packet is transferred downstream.</p>
<p id="p-0293" num="0308">A configuration example of the sending function unit of the packet transfer apparatus in this embodiment is shown in <figref idref="DRAWINGS">FIG. 30</figref>. This configuration is a configuration in which a high reliability determination unit <b>116</b> is provided between the receiving unit <b>111</b> and the copy unit <b>112</b> in the configuration shown in <figref idref="DRAWINGS">FIG. 8</figref>. In the configuration of <figref idref="DRAWINGS">FIG. 30</figref>, copying and identifier providing are performed for a packet that is determined to require high reliability in the high reliability determination unit <b>116</b>. As to a packet that is determined not to require high reliability in the high reliability determination unit <b>116</b>, copying and identifier providing are not performed, and the packet is sent from one of the sending unit <b>114</b><sub>1 </sub>and sending unit <b>114</b><sub>2</sub>. As shown in <figref idref="DRAWINGS">FIG. 31</figref>, a configuration may be adopted in which the high reliability packet is copied after adding the identifier. In addition, another configuration can be adopted, in which, after copying, it is determined whether the packets require high reliability or not, and when the packets are not high reliability packets, one of the copied packets is transferred.</p>
<p id="p-0294" num="0309">The configuration that includes the high reliability determination unit in the sending function unit and that includes a function for determining whether packets are high reliability packets in the receiving unit in the receiving function unit can be applied to packet transfer apparatuses of other embodiments.</p>
<p id="p-0295" num="0310">There are following methods for discriminating a packet that requires high reliability and a packet that does not require it in the high reliability determination unit <b>116</b>, for example.</p>
<p id="p-0296" num="0311">When the target packet is the Ethernet packet, the packet can be determined to be one that requires high reliability or not by using any one of a port number at which the packet arrives at a previous switch of the packet transfer apparatus, a Type value of layer 3 protocol in the packet header, a destination MAC address in a frame header, a source MAC address, a priority (CoS value) included in 802.1Q VLAN tag, VLAN-ID, a DiffServ code/point value (ToS value) included in an IP header, a destination port number of UDP or TCP, and a source port number of UDP or TCP.</p>
<p id="p-0297" num="0312">When the target packet is one for MPLS, the packet can be determined to be one that requires high reliability or not by using any one of a destination MAC address, a source MAC address, or a CoS value (Exp value) of shim header.</p>
<p id="p-0298" num="0313">Also in cases other than those above, as long as the target packet includes an IP address, the packet can be determined to be one that requires high reliability or not by using any one of a ToS value of the IP packet, a source IP address, and a destination IP address.</p>
<p id="p-0299" num="0314">By the way, when providing the route identifier in the packet transfer apparatus in the sending side, a route identifier to which a priority of the user packet is reflected can be included. When a plurality of route identifiers are included, one or more of them may include the route identifier to which the priority of the user packet is reflected. More particularly, for example, when the VLAN tag or the shim header is used as the route identifier, the priority is reflected to the route identifier to be inserted, wherein the priority is a CoS value in the user provided VLAN tag, a CoS value (Exp value) in the user provided shim header, or a ToS value of the user IP header.</p>
<p id="p-0300" num="0315"><figref idref="DRAWINGS">FIG. 32</figref> shows an example in a case for reflecting the priority of the user packet to the route identifier to be inserted.</p>
<p id="p-0301" num="0316">(a) indicates an example in which the packet transfer apparatus in the sending side refers to the CoS value in a user VLAN tag (type value 8100) so as to reflect the value as a CoS value of a route identifier (VLAN tag of type value 9100) to be newly provided. (b) indicates an example in which the packet transfer apparatus in the sending side refers to the ToS value in an IP header of a user packet so as to reflect the value as a CoS value of a route identifier (VLAN tag of type value 9100) to be newly provided. (c) indicates an example in which the packet transfer apparatus in the sending side refers to the CoS value in a user VLAN tag (type value 8100) so as to reflect the value as a CoS value of a tag (VLAN tag of type value 8100) of the inside one (nearer side to data) of two route identifiers to be newly provided. (d) indicates an example in which the packet transfer apparatus in the sending side refers to the ToS value in an IP header of a user packet so as to reflect the value as a CoS value of a tag (VLAN tag of type value 8100) of the inside one (nearer side to data) of two route identifiers to be newly provided.</p>
<p id="p-0302" num="0317">By reflecting the priority to the route identifier to be inserted, priority control according to priority can be performed in switches between the packet transfer apparatuses. In addition, by performing conversion from ToS to CoS in the packet transfer apparatus, there is a possibility that ToS control in the switches becomes unnecessary.</p>
<p id="p-0303" num="0318">In addition that the priority is reflected to the filed of the route identifier, the priority may be reflected to a filed of the sequence identifier (counter), or a filed of an after-mentioned timestamp. That is, the format of the sequence identifier or the timestamp to be newly inserted is set to be the same as the format of the VLAN tag of 802.1Q specification, and the sequence information or the time information is written into the VLAN-ID field of the VLAN tag. Then, the CoS value of the user packet is reflected as a CoS value of the VLAN tag.</p>
<p id="p-0304" num="0319"><figref idref="DRAWINGS">FIG. 33</figref> shows an example. The example shown in <figref idref="DRAWINGS">FIG. 33</figref> shows a case in which, the form of the sequence identifier or the timestamp to be newly inserted conforms to the VLAN format of 802.1Q, and 8100 indicating the VLAN tag is provided as a type value, and a value that is obtained by referring to the user packet is provided as the CoS value.</p>
<p id="p-0305" num="0320">In addition, as shown in <figref idref="DRAWINGS">FIG. 6</figref> and the like, when one or more VLAN tag or shim header is provided to the packet, the sequence identifier or the after-mentioned timestamp may be inserted in the inside of a VLAN tag or a shim header that is provided in the innermost side (nearest to data) in the VLAN tags and the shim headers. Accordingly, priority control can be performed in relay switches without copying the sequence identifier CoS value and the like in the packet transfer apparatus. That is, the number of tags to be provided can be reduced. In this case, in the receiving side, a reading position of the sequence identifier or the timestamp is determined according to the inserting position. <figref idref="DRAWINGS">FIG. 34</figref> shows an example in which, when the user provides one VLAN tag, the sequence identifier (counter) is inserted in the inside of it.</p>
<p id="p-0306" num="0321">The method of high reliability determination, the method for reflecting the priority and the like in this embodiment can be applied to each of other embodiments.</p>
<heading id="h-0025" level="1">Fifteenth Embodiment</heading>
<p id="p-0307" num="0322"><figref idref="DRAWINGS">FIG. 35</figref> shows a system configuration in this embodiment. As shown in <figref idref="DRAWINGS">FIG. 35</figref>, the system in this embodiment forms a point-multipoint network in which a sending side packet transfer apparatus <b>15</b> is connected to a plurality of receiving side packet transfer apparatuses <b>16</b>, <b>17</b> and <b>18</b> via a wide area network a<b>21</b> and a wide area network b<b>22</b>.</p>
<p id="p-0308" num="0323">In this embodiment, when the number of the independent routes is two, the configuration of the sending function unit of the sending side apparatus can be the same as the configuration shown in <figref idref="DRAWINGS">FIG. 8</figref>. That is, the receiving unit <b>111</b> receives a packet from the user network, and the copy unit <b>112</b> generates copies of the packet. After that, the route identifier and the sequence identifier are provided for each of the copied two packets. Then, the packets are sent over two routes respectively in the wide area network side. In addition, as shown in <figref idref="DRAWINGS">FIG. 36</figref>, a configuration may be adopted in which the packet is copied after providing the route identifier and the sequence identifier so as to send packets to two routes.</p>
<p id="p-0309" num="0324"><figref idref="DRAWINGS">FIG. 37</figref> shows configuration examples of a packet when the target network is the Ethernet. An identifier is provided using VLAN technology such that the packet can be transferred on the existing Ethernet in the wide area network. Especially, since the route identifier inserted right after the MAC address is referred to while the packet is transferred in the wide area network, it is desirable to provide the identifier conforming to the existing VLAN technology (IEEE802.1Q). In addition, the sequence identifier indicating the sequence information may be a tag (4 bytes) conforming to the VLAN technology (IEEE802.1Q), or may be one having 4 bytes length but not conforming to the VLAN technology (IEEE802.1Q), or may be one having any length.</p>
<p id="p-0310" num="0325"><figref idref="DRAWINGS">FIG. 38</figref> is a block diagram of a receiving function unit <b>320</b> of the packet transfer apparatus <b>300</b> in this embodiment. <figref idref="DRAWINGS">FIG. 38</figref> does not show the sending function unit. As shown in <figref idref="DRAWINGS">FIG. 38</figref>, the receiving function unit <b>320</b> includes receiving units <b>321</b><sub>1 </sub>and <b>321</b><sub>2 </sub>for receiving packets from each route, a memory A <b>322</b><sub>A </sub>and a memory B <b>322</b><sub>B </sub>for storing packets temporarily, a control unit <b>326</b> for controlling transfer or discard of a packet by referring to the sequence information, and a sending unit <b>325</b> for transferring the packet to the user network side. Operation of the receiving function unit <b>320</b> in this embodiment is as follows.</p>
<p id="p-0311" num="0326">The receiving units <b>321</b><sub>1 </sub>and <b>321</b><sub>2 </sub>receive packets via two routes from the wide area network side, and store the received packets into the memory A <b>322</b><sub>A </sub>and the memory B <b>322</b><sub>B </sub>respectively. The control unit <b>326</b> refers to the oldest packet (packet arriving at the earliest time) in each of the memory A <b>322</b><sub>A </sub>and the memory B <b>322</b><sub>B </sub>so as to transfer an older packet downstream by comparing the sequence identifiers. A control procedure by the control unit <b>326</b> is described with reference to a flowchart of <figref idref="DRAWINGS">FIG. 39</figref>.</p>
<p id="p-0312" num="0327">The control unit <b>326</b> refers to presence or absence of a packet in each of the memory A <b>322</b> and the memory B <b>322</b><sub>B</sub>. The procedure conditionally branches off to one of two according to whether both include packets or one of the memories includes the packet (step <b>601</b>).</p>
<p id="p-0313" num="0328">(1-1) When there are packets in both memories, the sequence identifiers CA and CB of the packets of both of the A system and the B system are read (step <b>602</b>), and the numbers are compared (step <b>603</b>). The procedure conditionally branches off according to the case of CA&#x3c;CB, the case of CA=CB, or the case of CA&#x3e;CB.</p>
<p id="p-0314" num="0329">(1-1-1) When CA&#x3c;CB, the A system packet is transferred downstream, and the packet is deleted from the memory A. Then, the state returns to the both system packet referring state while the B system packet remains in a waiting state (step <b>604</b>).</p>
<p id="p-0315" num="0330">(1-1-2) When CA=CB, the A system (or B system) packet is transferred downstream, and the transferred packet is deleted from the corresponding memory, the B system packet (A system) is discarded to delete from the memory, and the state returns to the both system packet referring state (step <b>605</b>).</p>
<p id="p-0316" num="0331">(1-1-3) When CA&#x3e;CB, the B system packet is transferred downstream, the packet is deleted from the memory, then, the state returns to the both system packet referring state while the A system packet remains in a waiting state (step <b>606</b>).</p>
<p id="p-0317" num="0332">That is, a packet that have a smaller number is determined to be one to be transferred next, so that the packet is transferred downstream and is deleted from the memory. Another system in which a larger number is detected waits, and the state returns to the packet referring state of both systems.</p>
<p id="p-0318" num="0333">(1-2) When a packet exists in only one memory A or B in step <b>601</b>, the procedure branches off to a case where the packet exists only in the A system or a case where the packet exists only in the B system (step <b>607</b>).</p>
<p id="p-0319" num="0334">(1-2-1) When the packet exists only in the A system, the packet waiting time in the B system is checked (step <b>608</b>).</p>
<p id="p-0320" num="0335">(1-2-1-1) When the packet waiting time in the B system has not yet expired, the state returns to the both system packet referring state.</p>
<p id="p-0321" num="0336">(1-2-1-2) When the packet waiting time in the B system has expired, the A system packet is transferred downstream and is deleted from the memory A. Then, the state returns to the both system packet referring state (step <b>609</b>).</p>
<p id="p-0322" num="0337">(1-2-2) When the packet exists only in the B system, the packet waiting time in the A system is checked (step <b>610</b>).</p>
<p id="p-0323" num="0338">(1-2-2-1) When the packet waiting time in the A system has not yet expired, the state returns to the both system packet referring state.</p>
<p id="p-0324" num="0339">(1-2-2-2) When the packet waiting time in the A system has expired, the B system packet is transferred downstream and is deleted from the memory B. Then, the state returns to the both system packet referring state (step <b>611</b>).</p>
<p id="p-0325" num="0340"><figref idref="DRAWINGS">FIG. 40</figref> shows another flowchart in this embodiment. <figref idref="DRAWINGS">FIG. 40</figref> shows a procedure in which packet waiting for the A system and the B system is not performed so that the packet is transferred downstream immediately after (1-2) in <figref idref="DRAWINGS">FIG. 39</figref>.</p>
<p id="p-0326" num="0341">In this embodiment, since the receiving function unit of the packet transfer apparatus does not manage the sequence of transferred packets, when the arriving time difference between the A system and the B system is large (when no less than the packet waiting time), there is a possibility that a plurality of the same packets may be transferred downstream. Therefore, it is necessary to carefully set the route delay difference.</p>
<heading id="h-0026" level="1">Sixteenth Embodiment</heading>
<p id="p-0327" num="0342"><figref idref="DRAWINGS">FIG. 41</figref> shows a configuration of a receiving function unit <b>420</b> of the packet transfer apparatus <b>400</b> of this embodiment. The sending function unit is not shown. As shown in <figref idref="DRAWINGS">FIG. 41</figref>, the receiving function unit <b>420</b> of the packet transfer apparatus includes a counter unit <b>427</b> for managing sequence of transferred packets in addition to the configuration of the receiving function unit of the packet transfer apparatus in the fifteenth embodiment.</p>
<p id="p-0328" num="0343">The control unit <b>426</b> compares a sequence identifier of the oldest packet (arrived at the earliest time) in the memory A and the memory B with a counter value of the counter unit <b>427</b> indicating a sequence number of the already transferred packet so as to determine a not-yet-transferred packet to be transferred downstream next. The process procedure by the control unit <b>426</b> is described with reference to the flowchart shown in <figref idref="DRAWINGS">FIG. 42</figref>.</p>
<p id="p-0329" num="0344">As shown in <figref idref="DRAWINGS">FIG. 42</figref>, the control unit <b>426</b> checks presence or absence of packets of the memory A <b>422</b><sub>A </sub>and the memory B <b>422</b><sub>B</sub>, so that the procedure conditionally branches off to two routes that are a case where the packets exist in both systems and a case where a packet exists in one of the systems (step <b>701</b>).</p>
<p id="p-0330" num="0345">(2-1) When the packets exist in both systems, sequence identifiers CA and CB of packets of both of A and B systems (step <b>702</b>) are read so as to compare each of them with the counter value (CF). The procedure conditionally branches off to a case of CF&#x2267;CA or a case of CF&#x3c;CA (step <b>703</b>).</p>
<p id="p-0331" num="0346">(2-1-1) When CF&#x2267;CA, the A system packet is discarded, the packet is deleted from the memory A, then comparison between CB and CF is performed (steps <b>704</b>, <b>705</b>).</p>
<p id="p-0332" num="0347">(2-1-1-1) When CF&#x2267;CB, the B system packet is also discarded, the packet is deleted from the memory B, then, the state returns to the both system packet referring state (step <b>706</b>).</p>
<p id="p-0333" num="0348">(2-1-1-2) When CF&#x3c;CB, the state returns to the both packet referring state while the B system packet remains in a waiting state (step <b>707</b>).</p>
<p id="p-0334" num="0349">(2-1-2) When CF&#x3c;CA in step <b>703</b>, comparison between CB and CF is performed while the A system packet remains in a waiting state (step <b>708</b>).</p>
<p id="p-0335" num="0350">(2-1-2-1) When CF&#x2267;CB, the B packet is discarded and is deleted from the memory B, and the state returns to the both packet referring state while the A system packet remains in the packet waiting state (step <b>709</b>).</p>
<p id="p-0336" num="0351">(2-1-2-2) In step <b>708</b>, when CF&#x3c;CB, comparison between CA and CB is performed while the A and B system packets remain in a waiting state (step <b>710</b>).</p>
<p id="p-0337" num="0352">(2-1-2-2-1) When CA&#x3c;CB, the A system packet is transferred downstream, and the packet is deleted from the memory. After the counter value is reset to be CF=CA, the state returns to the both packet referring state while the B system packet remains in a waiting state (step <b>711</b>).</p>
<p id="p-0338" num="0353">(2-1-2-2-2) When CA=CB, the A system packet (or B system packet) is transferred downstream, and the transferred packet is deleted from the memory. After the counter value is reset to be CF=CA (CB), the B system (A system) packet is discarded. That is, the packet is deleted from the memory (step <b>712</b>). Then, the state returns to the both packet referring state while the B system packet remains in a waiting state (step <b>712</b>).</p>
<p id="p-0339" num="0354">(2-1-2-2-3) When CA&#x3e;CB, the B system packet is transferred downstream, and the packet is deleted from the memory. After the counter value is reset to be CF=CB, the state returns to the both packet referring state while the A system packet remains in a waiting state (step <b>713</b>).</p>
<p id="p-0340" num="0355">(2-2) When a packet exists in only one memory A or B in step <b>701</b>, the procedure branches off to a case where the packet exists only in the A system or a case where the packet exists only in the B system (step <b>714</b>).</p>
<p id="p-0341" num="0356">(2-2-1) When the packet exists only in the A system, the packet waiting time in the B system is checked (step <b>715</b>).</p>
<p id="p-0342" num="0357">(2-2-1-1) When the packet waiting time in the B system has not yet expired, the state returns to the both system packet referring state.</p>
<p id="p-0343" num="0358">(2-2-1-2) When the packet waiting time in the B system has expired, the sequence identifier CA of the A system packet is read out so that comparison with CF is performed (steps <b>716</b>, <b>717</b>).</p>
<p id="p-0344" num="0359">(2-2-1-2-1) When CF&#x2267;CA, the A system packet is discarded by deleting it from the memory A so that the state returns to the both system packet referring state (step <b>718</b>).</p>
<p id="p-0345" num="0360">(2-2-1-2-2) When CA&#x3c;CA, the A system packet is transferred downstream, and the packet is deleted from the memory. After the counter value is reset to be CF=CA, the state returns to the both packet referring state (step <b>719</b>).</p>
<p id="p-0346" num="0361">(2-2-2) When the packet exists only in the B system in step <b>714</b>, the packet waiting time in the A system is checked (step <b>720</b>).</p>
<p id="p-0347" num="0362">(2-2-2-1) When the packet waiting time in the A system has not yet expired, the state returns to the both system packet referring state.</p>
<p id="p-0348" num="0363">(2-2-2-2) When the packet waiting time in the A system has expired, the sequence identifier CB of the B system packet is read out so that comparison with CF is performed (steps <b>721</b>, <b>722</b>).</p>
<p id="p-0349" num="0364">(2-2-1-2-1) When CF&#x2267;CB, the B system packet is discarded by deleting it from the memory B so that the state returns to the both system packet referring state (step <b>723</b>).</p>
<p id="p-0350" num="0365">(2-2-1-2-2) When CA&#x3c;CB, the B system packet is transferred downstream, and the packet is deleted from the memory. After the counter value is reset to be CF=CB, the state returns to the both packet referring state (step <b>724</b>).</p>
<p id="p-0351" num="0366">In this embodiment, the counter value (CF) that is a sequence of already-transferred packets is compared with the sequence identifiers (C1&#x2dc;Cn) of target packets of n systems (n=2 in this embodiment). Then, a packet to be transferred next is determined to be a packet of a sequence, in C1&#x2dc;Cn, that is greater than CF and that is the smallest among C1&#x2dc;Cn (when there are plural packets of the smallest sequence, any one of them is selected).</p>
<p id="p-0352" num="0367">In this embodiment, since the sequence of the already-transferred packet is managed using the counter value CF, even when the arrival time difference of the same packets between the A system and the B system (when no less than the packet waiting time), the uninterruptible configuration can be realized without transferring a plurality of the same packets downstream.</p>
<p id="p-0353" num="0368">As an identifier for identifying the sameness among packets, a timestamp can be used instead of using the above-mentioned sequence identifier. In this case, the send side packet transfer apparatus provides the timestamp to a target packet. Then, the receiving side packet transfer apparatus compares timestamps arriving from a plurality of systems so as to identify the sequence.</p>
<p id="p-0354" num="0369">In addition, for identifying the already-transferred packet in the receiving side like the present embodiment, m (m is an integer no less than 1) timestamps from the newest packet are stored, and each of the stored timestamps is compared with a timestamp of a packet arriving next, so that it is determined whether the arriving packet is an already transferred packet or not-yet-transferred packet.</p>
<p id="p-0355" num="0370">In this case, the receiving function unit of the packet transfer apparatus includes a memory for storing the timestamps shown in <figref idref="DRAWINGS">FIG. 43</figref>. As the memory, a RAM or CAM can be used. When using the RAM, comparison target data is compared with each piece of data stored in the memory so as to determine the sameness. When using the CAM, the comparison target data can be collectively compared with the data list in the memory so that quick determination can be realized.</p>
<p id="p-0356" num="0371">In addition to providing the identifier for determining the sameness to the packet, the receiving side may apply a predetermined function to an arriving packet so as to determine the sameness among packets based on a value obtained by the function. As the function, a predetermined hash function can be used, for example.</p>
<p id="p-0357" num="0372">In this case, for identifying the already-transferred packet, a memory like one shown in <figref idref="DRAWINGS">FIG. 43</figref> is held as shown in <figref idref="DRAWINGS">FIG. 44</figref>. In the same way as the case of <figref idref="DRAWINGS">FIG. 43</figref>, RAM, CAM and the like can be used as the memory.</p>
<p id="p-0358" num="0373">The method described in this embodiment for determining whether the arriving packet is an already-transferred packet can be applied to other embodiments.</p>
<heading id="h-0027" level="1">Seventeenth Embodiment</heading>
<p id="p-0359" num="0374">The configuration of the receiving function unit in the seventeenth embodiment is the same as that in the sixteenth embodiment shown in <figref idref="DRAWINGS">FIG. 41</figref>, but process operations are different.</p>
<p id="p-0360" num="0375">In this embodiment, among n (n=2 in this embodiment) independent routes, a route from which a packet arrives first after starting communication is regarded as an active system, and a value (CF) of the counter storing a sequence of the already-transferred packet is compared with a sequence identifier (ci: 1&#x2267;i&#x2267;n) of a packet in the system adopted as the active system, so that a packet having a sequence larger than CF is determined to be a packet to be transferred next and the packet is transferred downstream. In addition, when arrival of packets stops in the active system, another route from which a packet arrives first next is adopted as a new active system so that the packet is transferred downstream.</p>
<p id="p-0361" num="0376">Process operations in the seventeenth embodiment is described using flowcharts shown in <figref idref="DRAWINGS">FIGS. 45 and 46</figref>.</p>
<p id="p-0362" num="0377">In a method shown in <figref idref="DRAWINGS">FIG. 45</figref>, among the A system and the B system, one from which a packet arrives first is regarded as a 0 system (another is 1 system) so as to transfer the packet, when communication in the 0 system stops due to failure or construction, a 1 system packet is transferred, and when the 0 system is recovered, the system is returned to the 0 system. The flowchart of <figref idref="DRAWINGS">FIG. 45</figref> is described in the following.</p>
<p id="p-0363" num="0378">First, the procedure branches off conditionally on a system, between the A system and the B system, from which a packet arrives first (step <b>801</b>).</p>
<p id="p-0364" num="0379">(3-1) When the A system packet arrives first, or when packets of the A system and the B system arrive at the same time, the sequence identifier CA of the A system is read out (step <b>802</b>), so that CA is compared with the counter value (CF) (step <b>803</b>). The procedure conditionally branches off according to a case of CF&#x2267;CA or a case of CF&#x3c;CA.</p>
<p id="p-0365" num="0380">(3-1-1) When CF&#x3c;CA, the A system packet is transferred, the packet is deleted from the memory A, CF is set to be CF=CA, and the oldest packet is deleted if any B system packet exists (step <b>804</b>), and checking for presence or absence of packet in memory A is performed (step <b>805</b>).</p>
<p id="p-0366" num="0381">(3-1-1-1) In step <b>805</b>, when a packet exists in the memory A, the process returns to the procedure for reading out the sequence of packet.</p>
<p id="p-0367" num="0382">(3-1-1-2) In step <b>805</b>, when the packet does not exist in the memory A, checking for presence or absence of packet in memory A is performed (step <b>806</b>).</p>
<p id="p-0368" num="0383">(3-1-1-2-1) When the packet exists in the memory B in step <b>806</b>, the sequence identifier CB of the B system is read out (step <b>807</b>), so that CB is compared with the counter value (CF) (step <b>808</b>). The procedure conditionally branches off according to a case of CF&#x2267;CB or a case of CF&#x3c;CB.</p>
<p id="p-0369" num="0384">(3-1-1-2-1-1) When CF&#x2267;CB, the B system packet is discarded, and after the packet is deleted from the memory B (step <b>809</b>), the procedure returns to checking of presence or absence of the packet in memory A.</p>
<p id="p-0370" num="0385">(3-1-1-2-1-2) When CF&#x3c;CB, the B system packet is transferred, the packet is deleted from the memory, and after CF is set to be CF=CB (step <b>810</b>), the procedure returns to checking of presence or absence of packet in the memory A.</p>
<p id="p-0371" num="0386">(3-1-1-2-2) When there is no packet in the memory B in step <b>806</b>, the procedure returns to first arrival checking for the A and B systems.</p>
<p id="p-0372" num="0387">(3-1-2) When CF&#x2267;CA in step <b>803</b>, the A system packet is discarded, the packet is deleted from the memory A (step <b>811</b>), and the procedure returns to checking of presence or absence of the packet in memory A. After that, processes the same as steps <b>805</b>&#x2dc;<b>810</b> are performed.</p>
<p id="p-0373" num="0388">(3-2) When the B system packet arrives first in step <b>801</b>, the sequence identifier CB of the B system is read out (step <b>812</b>), so that CB is compared with the counter value (CF) (step <b>813</b>). The procedure conditionally branches off according to a case of CF&#x2267;CB or a case of CF&#x3c;CB.</p>
<p id="p-0374" num="0389">(3-2-1) When CF&#x3c;CB, the B system packet is transferred, the packet is deleted from the memory B, CF is set to be CF=CB, and the oldest packet in the A system is deleted if any packet exists in the A system (step <b>814</b>), and checking for presence or absence of packet in memory B is performed (step <b>815</b>).</p>
<p id="p-0375" num="0390">(3-2-1-1) In step <b>815</b>, when a packet exists in memory B, the procedure returns to a procedure for reading out the sequence of packet.</p>
<p id="p-0376" num="0391">(3-2-1-2) In step <b>815</b>, when the packet does not exist in the memory B, checking for presence or absence of packet in memory A is performed (step <b>816</b>).</p>
<p id="p-0377" num="0392">(3-2-1-2-1) When the packet exists in the memory A in step <b>816</b>, the sequence identifier CA of the A system is read out (step <b>817</b>), so that CA is compared with the counter value (CF) (step <b>818</b>). The procedure conditionally branches off according to a case of CF&#x2267;CA or a case of CF&#x3c;CA.</p>
<p id="p-0378" num="0393">(3-2-1-2-1-1) When CF&#x2267;CA, the A system packet is discarded by deleting the packet from the memory A (step <b>819</b>), and the procedure returns to checking of presence or absence of the packet in memory B.</p>
<p id="p-0379" num="0394">(3-2-1-2-1-2) When CF&#x3c;CA, the A system packet is transferred, the packet is deleted from the memory, and after CF is set to be CF=CA (step <b>820</b>), the procedure returns to checking of presence or absence of the packet in the memory B.</p>
<p id="p-0380" num="0395">(3-2-1-2-2) When there is no packet in the memory A in step <b>816</b>, the procedure returns to first arrival checking for the A and B systems.</p>
<p id="p-0381" num="0396">(3-2-2) When CF&#x2267;CB in step <b>813</b>, the B system packet is discarded, the packet is deleted from the memory B (step <b>821</b>), and the procedure returns to checking of presence or absence of the packet in memory B. After that, processes the same as steps <b>815</b>&#x2dc;<b>820</b> are performed.</p>
<p id="p-0382" num="0397">In a method shown in <figref idref="DRAWINGS">FIG. 46</figref>, a side at which a packet arrives first is regarded as the 0 system and the packet is transferred (another system is regarded as the 1 system), and when the 0 system stops, a packet of the 1 system is transferred. Then, irrespective of whether the 0 system recovers or not, the 1 system packet is used until the communication by the 1 system is interrupted due to failure, construction and the like.</p>
<p id="p-0383" num="0398">When the first arriving side is the A system, the procedure returns to &#x201c;checking of presence or absence of the packet of the memory A (step <b>805</b>)&#x201d; after step <b>809</b> or <b>810</b> in the flowchart of <figref idref="DRAWINGS">FIG. 45</figref>. Instead of that, in the flowchart shown in <figref idref="DRAWINGS">FIG. 46</figref>, the procedure returns to &#x201c;checking of presence or absence of the packet of the memory B&#x201d;. When the first arriving side is the B system, the procedure returns to &#x201c;checking of presence or absence of the packet of the memory B (step <b>815</b>)&#x201d; after step <b>820</b> or <b>819</b> in the flowchart of <figref idref="DRAWINGS">FIG. 45</figref>. Instead of that, in the flowchart shown in <figref idref="DRAWINGS">FIG. 46</figref>, the procedure returns to &#x201c;checking of presence or absence of the packet of the memory A&#x201d;.</p>
<p id="p-0384" num="0399">In the processes of the steps <b>805</b>, <b>815</b>, <b>905</b> and <b>915</b> in the methods shown in <figref idref="DRAWINGS">FIGS. 45 and 46</figref>, the step may move to a next step only after the waiting time timer expires. Accordingly, frequency of switching between the systems can be reduced.</p>
<heading id="h-0028" level="1">Eighteenth Embodiment</heading>
<p id="p-0385" num="0400"><figref idref="DRAWINGS">FIG. 47</figref> shows a block diagram of a receiving function unit <b>520</b> in the eighteenth embodiment. Although this configuration is the same as that of the fifth embodiment shown in <figref idref="DRAWINGS">FIG. 38</figref>, the control unit <b>526</b> does not refer to the sequence identifier of the packet in this embodiment.</p>
<p id="p-0386" num="0401"><figref idref="DRAWINGS">FIG. 48</figref> shows an operation flowchart. In this embodiment, a system in which the packet arrives first is regarded as the 0 system that is the active system, then, the packet is transferred (steps <b>1002</b>-<b>1003</b>, steps <b>1007</b>-<b>1008</b>). Determination for switching between the 0 system and the 1 system is performed according to presence or absence of a packet in the memory of the receiving function unit <b>520</b> and according to whether the packet waiting time expires or not (steps <b>1004</b>-<b>1005</b>, steps <b>1009</b>-<b>1010</b>). <figref idref="DRAWINGS">FIG. 48</figref> shows a case in which, after the active system is changed from the 0 system to the 1 system, the system is not returned to the 0 system unless the 1 system is interrupted. <figref idref="DRAWINGS">FIG. 49</figref> shows another example. The example shown in <figref idref="DRAWINGS">FIG. 49</figref> shows a case in which, after the active system is changed from the 0 system to the 1 system, the active system is returned to the 0 system when the 0 system recovers.</p>
<heading id="h-0029" level="1">Nineteenth Embodiment</heading>
<p id="p-0387" num="0402">Next, the nineteenth embodiment is described. <figref idref="DRAWINGS">FIG. 50</figref> shows a network configuration diagram in this embodiment. As shown in <figref idref="DRAWINGS">FIG. 50</figref>, this network is a multipoint-multipoint network for sending packets to a plurality destinations from a plurality of sources.</p>
<p id="p-0388" num="0403"><figref idref="DRAWINGS">FIG. 51</figref> shows a packet configuration example for the Ethernet in this embodiment. As shown in <figref idref="DRAWINGS">FIG. 51(</figref><i>a</i>), a VLAN tag (4 bytes) corresponding to a route for transferring the packet and a source, and sequence information (4 bytes) are added. In addition, a configuration shown in <figref idref="DRAWINGS">FIG. 51(</figref><i>b</i>) can be also adopted. In the case of <figref idref="DRAWINGS">FIG. 51(</figref><i>b</i>), in addition to providing a VLAN tag of 4 bytes as route information, an ID number for identifying a source is provided in the sequence identifier.</p>
<p id="p-0389" num="0404"><figref idref="DRAWINGS">FIG. 52</figref> is a block diagram of the receiving function unit <b>620</b> of the packet transfer apparatus <b>600</b> in this embodiment. The sending function unit is not shown. In this embodiment, since a different sequence identifier is provided for each source, a configuration for realizing functions of embodiments described so far is provided for each source. That is, as shown in <figref idref="DRAWINGS">FIG. 52</figref>, the receiving function unit <b>620</b> of this embodiment includes, for each source, a memory A <b>622</b><sub>A</sub>, a memory B <b>622</b><sub>B</sub>, a control unit <b>626</b> and a counter unit <b>627</b>. In addition, a control unit <b>628</b> is provided. The control unit <b>628</b> recognizes source information to identify a storing destination memory for each source.</p>
<heading id="h-0030" level="1">Twentieth Embodiment</heading>
<p id="p-0390" num="0405"><figref idref="DRAWINGS">FIG. 53</figref> shows another example of the receiving function unit <b>720</b> of the packet transfer apparatus <b>700</b> that can be applied to the network shown in <figref idref="DRAWINGS">FIG. 50</figref>.</p>
<p id="p-0391" num="0406">In the configuration shown in <figref idref="DRAWINGS">FIG. 53</figref>, the memory A, B is not differentiated for each source. That is, one memory A <b>722</b><sub>A </sub>and one memory B <b>722</b><sub>B </sub>are provided. In this embodiment, the control unit <b>728</b> obtains values of CA and CB and source information from packets in the memory A and the memory B, and transfers the values of CA and CB to the control unit <b>726</b> corresponding to a source based on the source information. The control unit <b>726</b> corresponding to the source performs sequence comparison of the packets, and sequence comparison result is returned to the control unit <b>728</b>. The control unit <b>728</b> performs discard/transfer/waiting for a packet for the memory A <b>722</b><sub>A </sub>and the memory B <b>722</b><sub>B </sub>based on the sequence comparison result. The process procedure for one source is the same as one in embodiments described so far.</p>
<heading id="h-0031" level="1">Twenty First Embodiment</heading>
<p id="p-0392" num="0407">In the above-mentioned embodiments, when using the counter value as the sequence identifier for determining the sameness of packets, since the counter value is finite (return to 0 after reaching the maximum value), a counter value once returned to 0 can not be distinguished from a counter value before returning to 0. Thus, in this embodiment, it is managed whether the counter returns to 0, and the counter values are compared considering it.</p>
<p id="p-0393" num="0408"><figref idref="DRAWINGS">FIG. 54</figref> shows a configuration of the receiving function unit <b>820</b> of the packet transfer apparatus in this embodiment. As shown in <figref idref="DRAWINGS">FIG. 54</figref>, the receiving function unit <b>820</b> includes an arrival counter/circulation counter unit <b>829</b> for each of the A system and the B system in addition to the configuration shown in <figref idref="DRAWINGS">FIG. 41</figref>.</p>
<p id="p-0394" num="0409">Operation of the apparatus is described with reference to <figref idref="DRAWINGS">FIG. 55</figref>.</p>
<p id="p-0395" num="0410">In the A system and the B system, circulation is managed independently. In the following, although circulation management in the A system is described, the same procedure applies for the B system.</p>
<p id="p-0396" num="0411">When a packet of a sequence n<sub>1 </sub>arrives at the A system, the value of the arrival counter of the A system is set to be n<sub>1</sub>, and the circulation timer of the A system of the control unit <b>826</b> is reset ((1) in <figref idref="DRAWINGS">FIG. 55</figref>). By the time when a next packet arrives, if the circulation timer counts a time from n<sub>1 </sub>to the maximum value of the sequence number, 1 is added to the circulation counter of the A system ((2) in <figref idref="DRAWINGS">FIG. 55</figref>). Assuming that the maximum value of the sequence number is N<sub>max</sub>, the time can be represented as (time corresponding to (minimum frame length+inter-frame interval))&#xd7;(N<sub>max</sub>&#x2212;n<sub>1</sub>). When a next packet arrives before the circulation counter changes, a sequence number of the packet is used for sequence comparison as it is.</p>
<p id="p-0397" num="0412">When a next packet (sequence n<sub>2</sub>) of the A system arrives within a delay time difference between the A system and the B system ((3) of <figref idref="DRAWINGS">FIG. 55</figref>), if the circulation counter is in a state in which 1 is added and if n<sub>2</sub>&#x3c;n<sub>1</sub>, the sequence of the packet of the A system is set to be n<sub>2</sub>+N<sub>max </sub>and it is used for sequence comparison. Although the circulation counter is in a state in which 1 is added, if n<sub>2</sub>&#x2267;n<sub>1</sub>, sequence comparison is performed using n<sub>2 </sub>as it is. After (2), if a next packet does not arrive within the delay difference time between the A system and the B system, the transferred counter value is returned to 0.</p>
<p id="p-0398" num="0413">In the above-mentioned processes, at the time when circulation counters become the same between the A system and the B system, both circulation counters are returned to 0. In addition, the maximum value N<sub>max </sub>of the sequence is set such that (delay difference between A and B)&#x2266;((time corresponding to (minimum frame length (64 bytes)+inter-frame interval)&#xd7;N<sub>max</sub>).</p>
<p id="p-0399" num="0414">In addition, by storing the number of times the counter value is returned to 0 in the receiving side, the number of times the counter value is returned to 0 and the counter value can be used for comparison in the receiving side. <figref idref="DRAWINGS">FIG. 56</figref> shows a configuration example of a packet for the Ethernet when adopting this method. As shown in <figref idref="DRAWINGS">FIG. 56</figref>, in addition to the counter value, the number of times the counter is returned to 0 is recorded. In the receiving side, the number and the counter value of a packet are compared with those of another packet. That is, when the number of times the counter is returned to 0 is the same, the counter value is compared.</p>
<p id="p-0400" num="0415">The present invention is not limited to the specifically disclosed embodiments, and variations and modifications may be made without departing from the scope of the invention.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>The invention claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A packet transfer method performed by packet transfer apparatuses provided in a packet sending side and a receiving side in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, comprising:
<claim-text>setting, two or more independent routes between the sending side packet transfer apparatus and the receiving side packet transfer apparatus;</claim-text>
<claim-text>at the sending side packet transfer apparatus:
<claim-text>inserting, information identifying a sequence of a packet into a part of the packet that is not a header portion referred to for determining the transfer destination of the packet;</claim-text>
<claim-text>copying the packet to generate two or more packets; and</claim-text>
<claim-text>sending the packets at substantially a same time over the independent routes respectively;</claim-text>
</claim-text>
<claim-text>at the receiving side packet transfer apparatus:
<claim-text>receiving each packet from the independent routes;</claim-text>
<claim-text>identifying packets having the same information and the sequence based on the information identifying the sequence for each packet;</claim-text>
<claim-text>selecting a first packet of one of the packets of a same sequence so as to send the selected one of the packets downstream, in response to a first sequence number of the first packet being equal to a reference counter number;</claim-text>
<claim-text>selecting a second packet of one of the packets of the same sequence so as to send the selected one of the packets downstream, in response to a second sequence number of the second packet being equal to the reference counter number when the first sequence number of the first packet is greater than the reference counter number; and</claim-text>
<claim-text>discarding a remaining one of the packets which is not selected by the selecting,</claim-text>
</claim-text>
<claim-text>wherein, when only one of the packets of the same sequence is received by the receiving, only the received one of the packets is sent downstream.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The packet transfer method as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the sending side packet transfer apparatus inserts route identifying information, for identifying an independent route, as a part of the destination information for determining the transfer destination in the communication network, and sends the packet to a route identified by a route identifier.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The packet transfer method as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref> or <claim-ref idref="CLM-00002">2</claim-ref>, wherein the sending side packet transfer apparatus inserts source identifying information, at least for identifying the sending side packet transfer apparatus, into the packet, and
<claim-text>the receiving side packet transfer apparatus refers to the source identifying information so as to identify packets having the same information and the sequence.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The packet transfer method as claimed <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the two or more independent routes are two or more routes that are physically independent or two or more private lines.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. A packet transfer apparatus used in a packet transfer system including a plurality of packet transfer apparatuses provided in a packet sending side and a receiving side via two or more independent routes in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, the packet transfer apparatus comprising:
<claim-text>a sending function unit and a receiving function unit,</claim-text>
<claim-text>the sending function unit including:
<claim-text>an inserting unit configured to insert information identifying a sequence of a packet into a part of the packet that is not a header portion referred to for determining the transfer destination of the packet,</claim-text>
<claim-text>a copying unit configured to copy the packet to generate two or more packets, and</claim-text>
<claim-text>a sending unit configured to send at substantially a same time the packets over the independent routes respectively; and</claim-text>
</claim-text>
<claim-text>the receiving function unit including:
<claim-text>a receiving unit configured to receive each of the packets from the independent routes,</claim-text>
<claim-text>an identifying unit configured to identify packets having the same information and the sequence based on the information identifying the sequence for each of the packets,</claim-text>
<claim-text>a selecting unit configured to select a first packet of one of the packets of a same sequence so as to send the selected one of the packets downstream, in response to a first sequence number of the first packet being equal to a reference counter number, and select a second packet of one of the packets of the same sequence so as to send the selected one of the packets downstream, in response to a second sequence number of the second packet being equal to the reference counter number when the first sequence number of the first packet is greater than the reference counter number, and</claim-text>
<claim-text>a discarding unit configured to discard a remaining one of the packets which is not selected by the selecting,</claim-text>
</claim-text>
<claim-text>wherein, when only one of the packets of the same sequence is received by the receiving unit only the received one of the packets is sent downstream.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein the inserting unit in the sending function unit inserts route identifying information, for identifying an independent route, as a part of destination information for determining the transfer destination in the communication network, and the sending unit sends the packet to a route identified by a route identifier.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00005">claim 5</claim-ref> or <claim-ref idref="CLM-00006">6</claim-ref>, wherein the inserting unit in the sending function unit inserts source identifying information, at least for identifying the sending side packet transfer apparatus, into the packet, and
<claim-text>the identifying unit in the receiving function means refers to the source identifying information so as to identify packets having the same information and the sequence.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein the two or more independent routes are two or more routes that are physically independent or two or more private lines.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. A packet transfer method performed by packet transfer apparatuses provided in a packet sending side and a receiving side in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, comprising:
<claim-text>setting two or more independent routes between the sending side packet transfer apparatus and the receiving side packet transfer apparatus;</claim-text>
<claim-text>at the sending side packet transfer apparatus:
<claim-text>distinguishing a high reliability packet from non-high reliability packets by referring to a part of a packet header of the packet;</claim-text>
<claim-text>copying the high reliability packet into multiple packets for sending to all of the independent routes respectively;</claim-text>
<claim-text>sending at substantially a same time the multiple packets generated by the copying to all of the independent routes respectively;</claim-text>
</claim-text>
<claim-text>at the receiving side packet transfer apparatus:
<claim-text>determining whether an arriving packet received from the independent routes is the high reliability packet by referring to the part of the packet header,</claim-text>
<claim-text>identifying high reliability packets having the same information and the sequence based on the information identifying the sequence for each high reliability packet;</claim-text>
<claim-text>selecting a first packet of one of the high reliability packets of a same sequence so as to send the selected one of the packets downstream, in response to a first sequence number of the first packet being equal to a reference counter number;</claim-text>
<claim-text>selecting a second packet of one of the high reliability packets of the same sequence so as to send the selected one of the packets downstream, in response to a second sequence number of the second packet being equal to the reference counter number when the first sequence number of the first packet is greater than the reference counter number; and</claim-text>
<claim-text>discarding a remaining one of the packets which is not selected by the selecting,</claim-text>
</claim-text>
<claim-text>wherein, when only one of the high reliability packets of the same sequence is received by the receiving, only the received one of the packets is sent downstream.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The packet transfer method as claimed in <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein, when a packet to be transferred is an Ethernet packet, the part of the packet header is any one of a port number at which the packet arrives in a previous switch of a packet transfer apparatus of the packet transfer apparatuses, a Type value of layer 3 protocol in a frame header, a destination MAC address in a frame header, a source MAC address, a priority (class of service (CoS) value) included in 802.1Q VLAN tag, VLAN-ID, a DiffServ code/point value (type of service (ToS) value) included in an IP header, a destination port number, a source port number of User Datagram Protocol (UDP), a destination port number, and a source port number of Transmission Control Protocol (TCP),
<claim-text>when the packet to be transferred is a packet for Multiprotocol Label Switching (MPLS), the part of the packet header is any one of a destination MAC address, a source MAC address, and a CoS value (experimental (Exp) value) of a shim header, and</claim-text>
<claim-text>when the packet to be transferred includes an IP packet, the part of the packet header is any one of a ToS value of the IP packet, a source IP address, and a destination IP address.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The packet transfer method as claimed in <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the receiving side packet transfer apparatus determines the sameness of the multiple packets arriving from the independent routes based on a value obtained by applying a predetermined function to each of the multiple packets arriving from the independent routes.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The packet transfer method as claimed in <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the sending side packet transfer apparatus inserts a sequence identifier or a timestamp into a sent one of the multiple packets, wherein the receiving side packet transfer apparatus determines the sameness of the multiple packets arriving from the independent routes by referring to the sequence identifier or the timestamp inserted in the sending side.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The packet transfer method as claimed in <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein, when one or more VLAN tags or shim headers are provided to the sent one of the multiple packets, the sending side packet transfer apparatus inserts the sequence identifier or the timestamp in the inside of an innermost VLAN tag or header in the VLAN tags or shim headers, and the receiving side packet transfer apparatus determines a position for reading out the sequence identifier or the timestamp inserted in the sent one of the multiple packets according to an inserted position.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The packet transfer method as claimed in <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein, a format of the sequence identifier or the timestamp inserted into the sent one of the multiple packets by the sending side packet transfer apparatus is the same as a format of a VLAN tag conforming to 802.1Q standard, and the sending side packet transfer apparatus writes sequence information or time information into a VLAN-ID field of the VLAN tag.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The packet transfer method as claimed in <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein a field in which sequence information or time information is written as the sequence identifier or the timestamp inserted into the sent one of the multiple packets by the sending side packet transfer apparatus has an arbitrary length.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The packet transfer method as claimed in <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the sending side packet transfer apparatus provides one or more route identifiers to the sent one of the multiple packets, and reflects, to at least one route identifier among the route identifiers, priority that is provided to the sent one of the multiple packets in a user network.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The packet transfer method as claimed in <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the sending side packet transfer apparatus provides the route identifier using a VLAN tag or a shim header, and determines priority by referring to the part of a header of the packet so as to reflect the priority to the route identifier,
<claim-text>wherein, when a packet to be transferred is an Ethernet packet, the part of the packet header is any one of a port number at which the packet arrives in a previous switch of a packet transfer apparatus of the packet transfer apparatuses, a Type value of layer 3 protocol in the packet header, a destination MAC address in a frame header, a source MAC address, a priority (class of service (CoS) value) included in 802.1Q VLAN tag, VLAN-ID, a DiffServ code/point value (type of service (ToS) value) included in an IP header, a destination port number, a source port number of User Datagram Protocol (UDP), a destination port number, and a source port number of Transmission Control Protocol (TCP),</claim-text>
<claim-text>when the packet to be transferred is a packet for Multiprotocol Label Switching (MPLS), the part of the packet header is any one of a destination MAC address, a source MAC address, and a CoS value (experimental (Exp) value) of a shim header, and</claim-text>
<claim-text>when the packet to be transferred includes an IP packet, the part of the packet header is any one of a ToS value of the IP packet, a source IP address, and a destination IP address.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. A packet transfer method performed by packet transfer apparatuses provided in a packet sending side and a receiving side in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, comprising:
<claim-text>setting two or more independent routes between the sending side packet transfer apparatus and the receiving side packet transfer apparatus;</claim-text>
<claim-text>at the sending side packet transfer apparatus:
<claim-text>copying the packet so as to send copied packets to all of the independent routes; and</claim-text>
<claim-text>sending at substantially a same time the copied packets generated by the copying to all of the independent routes respectively;</claim-text>
</claim-text>
<claim-text>at the receiving side packet transfer apparatus:
<claim-text>receiving the copied packets from each of the independent routes;</claim-text>
<claim-text>referring to sameness identifying information of each copied packet in order to identify copied packets having the same information; and</claim-text>
<claim-text>sending downstream a designated packet, among the copied packets having the same information, that has not yet been transferred,</claim-text>
</claim-text>
<claim-text>wherein the referring further includes:
<claim-text>storing, using the receiving side packet transfer apparatus, the sameness identifying information of copied packets already forwarded downstream for m (m being an integer equal to or greater than one) preceding packets from a newest received copied packet, and</claim-text>
<claim-text>comparing the stored sameness identifying information with sameness identifying information of a next arriving copied packet so as to determine whether the arriving copied packet is one already forwarded or not by comparing values of sequence identifiers of plural copied packets received from the independent routes against a value of a sequence identifier of an already forwarded packet; and</claim-text>
</claim-text>
<claim-text>the sending further includes, sending, based on the comparing, a copied packet of a respective plurality of copied packets downstream that has a sequence identifier that is greater than a value of a sequence identifier of a last already forwarded packet and that is smaller than a sequence identifier of the other of the respective plurality of copied packets.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The packet transfer method as claimed in <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein the sameness identifying information is a sequence identifier or a timestamp inserted into the copied packet, or a value obtained by applying a predetermined function to the copied packet.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The packet transfer method as claimed in <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein a CAM (Content Addressable Memory) is used as a memory for storing the sameness identifying information in the receiving side packet transfer apparatus.</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. A packet transfer method performed by packet transfer apparatuses provided in a packet sending side and a receiving side in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, comprising:
<claim-text>at the sending side packet transfer apparatus:
<claim-text>setting a plurality of independent routes between the sending side packet transfer apparatus and the receiving side packet transfer apparatus;</claim-text>
<claim-text>inserting a sequence identifier identifying a sequence of packets into a send packet;</claim-text>
<claim-text>copying, using the sending side packet transfer apparatus, the send packet in order to send copied packets to all of the independent routes; and</claim-text>
<claim-text>sending at substantially a same time the copied packets generated by the copying to all of the independent routes respectively;</claim-text>
</claim-text>
<claim-text>at the receiving side packet transfer apparatus:
<claim-text>receiving the copied packets from each of the independent routes</claim-text>
<claim-text>referring to the sequence identifier of each copied packet in order to identify copied packets having the same information and the sequence; and</claim-text>
<claim-text>forwarding downstream a first received packet of one of the packets having the same information,</claim-text>
</claim-text>
<claim-text>wherein, in the receiving side packet transfer apparatus, a route from which a copied the first received packet arrives first, from a start of communication among the independent routes, is regarded as an active system, the receiving side packet transfer apparatus compares a value of the sequence identifier of an already forwarded packet against a value of the sequence identifier of the first received packet received in the active system in order to determine a copied packet having a sequence identifier greater than the value of the sequence identifier of the already forwarded packet as a packet to be transferred next, and</claim-text>
<claim-text>when arrival of packets is interrupted for a predetermined time in the active system, another system is set as a new active system, and a second received packet of one of the packets having the same information received in the new active system is transferred downstream.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00022" num="00022">
<claim-text>22. A packet transfer apparatus used in a packet transfer system including a plurality of packet transfer apparatuses provided in a packet sending side and a receiving side via two or more independent routes in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, the packet transfer apparatus comprising:
<claim-text>a sending function unit and a receiving function unit,</claim-text>
<claim-text>the sending function unit including
<claim-text>a distinguishing unit configured to distinguish a high reliability packet from non-high reliability packets by referring to a part of a packet header of the packet, and copying the high reliability packet into multiple packets to send them to all of the independent routes, and</claim-text>
<claim-text>a sending unit configured to send the multiple packets at substantially a same time to all of the independent routes, respectively; and</claim-text>
</claim-text>
<claim-text>the receiving function unit including
<claim-text>a determining unit configured to determine whether an arriving packet received from the independent routes is the high reliability packet by referring to the part of the packet header,</claim-text>
<claim-text>an identifying unit configured to identify high reliability packets having the same information and a sequence based on the information identifying the sequence for each high reliability packet;</claim-text>
<claim-text>a selecting unit configured to select a first packet of one of the high reliability packets of a same sequence so as to send the selected one of the packets downstream, in response to a first sequence number of the first packet being equal to a reference counter number, and to select a second packet of one of the high reliability packets of the same sequence so as to send the selected one of the packets downstream, in response to a second sequence number of the second packet being equal to the reference counter number when the first sequence number of the first packet is greater than the reference counter number; and</claim-text>
<claim-text>a discarding unit configured to discard a remaining one of the packets which is not selected by the selecting,</claim-text>
</claim-text>
<claim-text>wherein, when only one of the high reliability packets of the same sequence is received by the receiving unit, only the received one of the packets is sent downstream.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00023" num="00023">
<claim-text>23. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00022">claim 22</claim-ref>, wherein, when a packet to be transferred is an Ethernet packet, the part of the packet header is any one of a port number at which the packet arrives in a previous switch of the packet transfer apparatus, a Type value of layer 3 protocol in a frame header, a destination MAC address in a frame header, a source MAC address, a priority (class of service (CoS) value) included in 802.1Q VLAN tag, VLAN-ID, a DiffServ code/point value (type of service (ToS) value) included in an IP header, a destination port number, a source port number of User Datagram Protocol (UDP), a destination port number, and a source port number of Transmission Control Protocol (TCP),
<claim-text>when the packet to be transferred is a packet for Multiprotocol Label Switching (MPLS), the part of the packet header is any one of a destination MAC address, a source MAC address, and a CoS value (experimental (Exp) value) of a shim header, and</claim-text>
<claim-text>when the packet to be transferred includes an IP packet, the part of the packet header is any one of a ToS value of the IP packet, a source IP address, and a destination IP address.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00024" num="00024">
<claim-text>24. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00022">claim 22</claim-ref>, wherein the receiving function unit determines the sameness of the multiple packets arriving from the independent routes based on a value obtained by applying a predetermined function to each of the multiple packets arriving from the independent routes.</claim-text>
</claim>
<claim id="CLM-00025" num="00025">
<claim-text>25. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00022">claim 22</claim-ref>, wherein the receiving function unit determines the sameness of the multiple packets arriving from the independent routes by referring to a sequence identifier or a timestamp inserted in the sending side.</claim-text>
</claim>
<claim id="CLM-00026" num="00026">
<claim-text>26. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00025">claim 25</claim-ref>, wherein, when one or more VLAN tags or shim headers are provided to a sent one of the multiple packets, the sending function unit inserts the sequence identifier or the timestamp in the inside of an innermost VLAN tag or header in the VLAN tags or shim headers, and the receiving function unit determines a position for reading out the sequence identifier or the timestamp inserted in the sent one of the multiple packets according to an inserted position.</claim-text>
</claim>
<claim id="CLM-00027" num="00027">
<claim-text>27. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00025">claim 25</claim-ref>, wherein, a format of the sequence identifier or the timestamp inserted into a sent one of the multiple packets by the sending function unit is the same as a format of a VLAN tag conforming to 802.1Q standard, and the sending function unit writes sequence information or time information into a VLAN-ID field of the VLAN tag.</claim-text>
</claim>
<claim id="CLM-00028" num="00028">
<claim-text>28. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00025">claim 25</claim-ref>, wherein a field in which sequence information or time information is written as the sequence identifier or the timestamp inserted into a sent one of the multiple packets by the sending function means has an arbitrary length.</claim-text>
</claim>
<claim id="CLM-00029" num="00029">
<claim-text>29. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00022">claim 22</claim-ref>, wherein the sending function unit provides one or more route identifiers to a sent one of the multiple packets, and reflects, to at least one route identifier among the route identifiers, priority that is provided to the sent one of the multiple packets in a user network.</claim-text>
</claim>
<claim id="CLM-00030" num="00030">
<claim-text>30. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00029">claim 29</claim-ref>, wherein the sending function unit provides the route identifier using a VLAN tag or a shim header to the sent one of the multiple packets, and determines priority by referring to a part of the packet header so as to reflect the priority to the route identifier,
<claim-text>wherein, when a packet to be transferred is an Ethernet packet, the part of the packet header is any one of a port number at which the sent multiple packet arrives in a previous switch of the packet transfer apparatus, a Type value of layer 3 protocol in a frame header, a destination MAC address in a frame header, a source MAC address, a priority (class of service (CoS) value) included in 802.1Q VLAN tag, VLAN-ID, a DiffServ code/point value (type of service (ToS) value) included in an IP header, a destination port number, a source port number of User Datagram Protocol (UDP), a destination port number, and a source port number of Transmission Control Protocol (TCP),</claim-text>
<claim-text>when the packet to be transferred is a packet for Multiprotocol Label Switching (MPLS), the part of the packet header is any one of a destination MAC address, a source MAC address, and a CoS value (experimental (Exp) value) of a shim header, and</claim-text>
<claim-text>when the packet to be transferred includes an IP packet, the part of the packet header is any one of a ToS value of the IP packet, a source IP address, and a destination IP address.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00031" num="00031">
<claim-text>31. A packet transfer apparatus used in a packet transfer system including a plurality of packet transfer apparatuses provided in a packet sending side and a receiving side via two or more independent routes in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, the packet transfer apparatus comprising:
<claim-text>a sending function unit and a receiving function unit,</claim-text>
<claim-text>the sending function unit includes</claim-text>
<claim-text>a copying unit configured to copy the packet in order to send copied packets to all of the independent routes, and</claim-text>
<claim-text>a sending unit configured to send the copied packet at substantially a same time to all of the independent routes respectively;</claim-text>
<claim-text>the receiving function unit comprising:</claim-text>
<claim-text>a receiving unit configured to receive the copied packets from each of the independent routes;</claim-text>
<claim-text>a referring unit configured to refer to sameness identifying information of each copied packet in order to identify packets having the same information,</claim-text>
<claim-text>wherein the referring unit further includes storing unit configured to store the sameness identifying information of copied packets already forwarded downstream for m (m is an integer equal to or greater than one) preceding copied packets from a newest received copied packet, and the referring unit compares stored sameness identifying information with sameness identifying information of a next arriving copied packet in order to determine whether the arriving copied packet is one already forwarded or not by comparing values of sequence identifiers of plural copied packets received from the independent routes against a value of a sequence identifier of an already forwarded packet; and</claim-text>
<claim-text>a forwarding unit configured to forward, based on the comparison performed by the referring unit, a copied packet of a respective plurality of copied packets downstream that has a sequence identifier that is greater than a value of a sequence identifier of a last already forwarded packet and that is smaller than a sequence identifier of the other of the respective plurality of copied packets.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00032" num="00032">
<claim-text>32. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein the sameness identifying information is a sequence identifier or a timestamp inserted into the copied packet, or a value obtained by applying a predetermined function to the copied packet.</claim-text>
</claim>
<claim id="CLM-00033" num="00033">
<claim-text>33. The packet transfer apparatus as claimed in <claim-ref idref="CLM-00031">claim 31</claim-ref>, wherein the receiving function unit includes a CAM (Content Addressable Memory) as a memory for storing the sameness identifying information.</claim-text>
</claim>
<claim id="CLM-00034" num="00034">
<claim-text>34. A packet transfer apparatus used in a packet transfer system including a plurality of packet transfer apparatuses provided in a packet sending side and a receiving side via two or more independent routes in a communication network for transferring a packet by determining a transfer destination by referring to destination information of the packet, the packet transfer apparatus comprising:
<claim-text>a sending function unit and a receiving function unit,</claim-text>
<claim-text>the sending function unit including
<claim-text>an inserting unit configured to insert a sequence identifier for identifying a sequence of packets to a send packet and copying the send packet in order to send copied packets to the independent routes, and</claim-text>
<claim-text>a sending unit configured to send the copied packet at substantially a same time to all of the independent routes respectively; and</claim-text>
</claim-text>
<claim-text>the receiving function including</claim-text>
<claim-text>a receiving unit configured to receive the copied packets from each of the independent routes and referring to the sequence identifier of each copied packet in order to identify copied packets having the same information and the sequence, and to forward downstream a first received packet of one of the packets having the same information,</claim-text>
<claim-text>wherein, in the receiving function unit, a route from which the first received packet arrives first, from a start of communication among the independent routes, is regarded as an active system, the receiving function unit compares a value of the sequence identifier of an already forwarded packet against a value of the sequence identifier of the first received packet received in the active system so as to determine a packet having a sequence identifier greater than the value of the sequence identifier of the already forwarded packet as a packet to be transferred next, and</claim-text>
<claim-text>when arrival of packets is interrupted for a predetermined time in the active system, another system is set as a new active system, and a second received packet of one of the packets having the same information received in the new active system is transferred downstream. </claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
