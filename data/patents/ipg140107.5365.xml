<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08626465-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08626465</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12886494</doc-number>
<date>20100920</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>610</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>01</class>
<subclass>C</subclass>
<main-group>17</main-group>
<subgroup>38</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>702 99</main-classification>
<further-classification>702 92</further-classification>
<further-classification>702 93</further-classification>
<further-classification>702141</further-classification>
<further-classification>702150</further-classification>
</classification-national>
<invention-title id="d2e53">Calibrating sensor measurements on mobile devices</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5075693</doc-number>
<kind>A</kind>
<name>McMillan et al.</name>
<date>19911200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5165269</doc-number>
<kind>A</kind>
<name>Nguyen</name>
<date>19921100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>5349529</doc-number>
<kind>A</kind>
<name>Masumoto et al.</name>
<date>19940900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>5761094</doc-number>
<kind>A</kind>
<name>Olson et al.</name>
<date>19980600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>5946813</doc-number>
<kind>A</kind>
<name>Nachbaur et al.</name>
<date>19990900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6311129</doc-number>
<kind>B1</kind>
<name>Lin</name>
<date>20011000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>6384384</doc-number>
<kind>B1</kind>
<name>Connolly et al.</name>
<date>20020500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>6408245</doc-number>
<kind>B1</kind>
<name>An et al.</name>
<date>20020600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>6424914</doc-number>
<kind>B1</kind>
<name>Lin</name>
<date>20020700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>6508316</doc-number>
<kind>B2</kind>
<name>Estes et al.</name>
<date>20030100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>6539639</doc-number>
<kind>B2</kind>
<name>Smith</name>
<date>20030400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>6622091</doc-number>
<kind>B2</kind>
<name>Perlmutter et al.</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>6651003</doc-number>
<kind>B2</kind>
<name>Woloszyk et al.</name>
<date>20031100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>6768452</doc-number>
<kind>B2</kind>
<name>Gilkes</name>
<date>20040700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>6807485</doc-number>
<kind>B1</kind>
<name>Green</name>
<date>20041000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>6964107</doc-number>
<kind>B1</kind>
<name>Ahola</name>
<date>20051100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>6988049</doc-number>
<kind>B1</kind>
<name>Wirtz et al.</name>
<date>20060100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>7196660</doc-number>
<kind>B2</kind>
<name>Abraham</name>
<date>20070300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>7210236</doc-number>
<kind>B2</kind>
<name>Sato et al</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00020">
<document-id>
<country>US</country>
<doc-number>7248983</doc-number>
<kind>B2</kind>
<name>Fillatreau et al.</name>
<date>20070700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00021">
<document-id>
<country>US</country>
<doc-number>7275008</doc-number>
<kind>B2</kind>
<name>Plyvanainen</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00022">
<document-id>
<country>US</country>
<doc-number>7324906</doc-number>
<kind>B2</kind>
<name>Sato et al.</name>
<date>20080100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00023">
<document-id>
<country>US</country>
<doc-number>7331115</doc-number>
<kind>B2</kind>
<name>Schierbeek et al.</name>
<date>20080200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00024">
<document-id>
<country>US</country>
<doc-number>7346452</doc-number>
<kind>B2</kind>
<name>Ford et al.</name>
<date>20080300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00025">
<document-id>
<country>US</country>
<doc-number>7388541</doc-number>
<kind>B1</kind>
<name>Yang</name>
<date>20080600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00026">
<document-id>
<country>US</country>
<doc-number>7391366</doc-number>
<kind>B2</kind>
<name>Park et al.</name>
<date>20080600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00027">
<document-id>
<country>US</country>
<doc-number>7400974</doc-number>
<kind>B2</kind>
<name>Fuchs et al.</name>
<date>20080700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00028">
<document-id>
<country>US</country>
<doc-number>7415354</doc-number>
<kind>B2</kind>
<name>Alexander</name>
<date>20080800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00029">
<document-id>
<country>US</country>
<doc-number>7451549</doc-number>
<kind>B1</kind>
<name>Sodhi et al.</name>
<date>20081100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00030">
<document-id>
<country>US</country>
<doc-number>7458166</doc-number>
<kind>B2</kind>
<name>Parks et al.</name>
<date>20081200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00031">
<document-id>
<country>US</country>
<doc-number>7548200</doc-number>
<kind>B2</kind>
<name>Garin</name>
<date>20090600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00032">
<document-id>
<country>US</country>
<doc-number>7565839</doc-number>
<kind>B2</kind>
<name>Stewart et al.</name>
<date>20090700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00033">
<document-id>
<country>US</country>
<doc-number>8061049</doc-number>
<kind>B2</kind>
<name>Mayor et al.</name>
<date>20111100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00034">
<document-id>
<country>US</country>
<doc-number>2003/0135327</doc-number>
<kind>A1</kind>
<name>Levine et al.</name>
<date>20030700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00035">
<document-id>
<country>US</country>
<doc-number>2005/0174324</doc-number>
<kind>A1</kind>
<name>Liberty et al.</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00036">
<document-id>
<country>US</country>
<doc-number>2005/0223575</doc-number>
<kind>A1</kind>
<name>Fillatreau et al.</name>
<date>20051000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00037">
<document-id>
<country>US</country>
<doc-number>2005/0240347</doc-number>
<kind>A1</kind>
<name>Yang</name>
<date>20051000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00038">
<document-id>
<country>US</country>
<doc-number>2005/0246099</doc-number>
<kind>A1</kind>
<name>Jendbro et al.</name>
<date>20051100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00039">
<document-id>
<country>US</country>
<doc-number>2005/0288805</doc-number>
<kind>A1</kind>
<name>Moore</name>
<date>20051200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00040">
<document-id>
<country>US</country>
<doc-number>2006/0066295</doc-number>
<kind>A1</kind>
<name>Tamura et al.</name>
<date>20060300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>324202</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00041">
<document-id>
<country>US</country>
<doc-number>2006/0190174</doc-number>
<kind>A1</kind>
<name>Li et al.</name>
<date>20060800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00042">
<document-id>
<country>US</country>
<doc-number>2006/0195254</doc-number>
<kind>A1</kind>
<name>Ladetto et al.</name>
<date>20060800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00043">
<document-id>
<country>US</country>
<doc-number>2006/0271295</doc-number>
<kind>A1</kind>
<name>McLaren et al.</name>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00044">
<document-id>
<country>US</country>
<doc-number>2007/0156337</doc-number>
<kind>A1</kind>
<name>Yanni</name>
<date>20070700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00045">
<document-id>
<country>US</country>
<doc-number>2008/0066331</doc-number>
<kind>A1</kind>
<name>Brzezinski et al.</name>
<date>20080300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00046">
<document-id>
<country>US</country>
<doc-number>2008/0143595</doc-number>
<kind>A1</kind>
<name>Colley et al.</name>
<date>20080600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00047">
<document-id>
<country>US</country>
<doc-number>2008/0147686</doc-number>
<kind>A1</kind>
<name>Colley et al.</name>
<date>20080600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00048">
<document-id>
<country>US</country>
<doc-number>2008/0201096</doc-number>
<kind>A1</kind>
<name>Wright et al.</name>
<date>20080800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00049">
<document-id>
<country>US</country>
<doc-number>2009/0033807</doc-number>
<kind>A1</kind>
<name>Sheng et al.</name>
<date>20090200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>348734</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00050">
<document-id>
<country>US</country>
<doc-number>2009/0054075</doc-number>
<kind>A1</kind>
<name>Boejer</name>
<date>20090200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00051">
<document-id>
<country>US</country>
<doc-number>2009/0070058</doc-number>
<kind>A1</kind>
<name>Lin</name>
<date>20090300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00052">
<document-id>
<country>US</country>
<doc-number>2009/0089001</doc-number>
<kind>A1</kind>
<name>Lin</name>
<date>20090400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00053">
<document-id>
<country>US</country>
<doc-number>2009/0171607</doc-number>
<kind>A1</kind>
<name>Chen et al.</name>
<date>20090700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00054">
<document-id>
<country>US</country>
<doc-number>2009/0172599</doc-number>
<kind>A1</kind>
<name>Nezu</name>
<date>20090700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00055">
<document-id>
<country>US</country>
<doc-number>2009/0326851</doc-number>
<kind>A1</kind>
<name>Tanenhaus</name>
<date>20091200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00056">
<document-id>
<country>US</country>
<doc-number>2010/0121599</doc-number>
<kind>A1</kind>
<name>Boeve et al.</name>
<date>20100500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00057">
<document-id>
<country>US</country>
<doc-number>2010/0305853</doc-number>
<kind>A1</kind>
<name>Schulze et al.</name>
<date>20101200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00058">
<document-id>
<country>US</country>
<doc-number>2011/0106474</doc-number>
<kind>A1</kind>
<name>Kulik et al.</name>
<date>20110500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00059">
<document-id>
<country>EP</country>
<doc-number>1 221 586</doc-number>
<date>20020700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00060">
<document-id>
<country>JP</country>
<doc-number>2005-134343</doc-number>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00061">
<document-id>
<country>WO</country>
<doc-number>WO 2008/122904</doc-number>
<date>20081000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00062">
<document-id>
<country>WO</country>
<doc-number>WO 2009/068116</doc-number>
<date>20090600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00063">
<othercit>Seong Yun Cho et al., &#x201c;A Calibration Technique for a Two-Axis Magnetic Compass in Telematics Devices,&#x201d; Jun. 2005, <i>ETRI Journal</i>, 27( 3):280-288.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00064">
<othercit>Chris M. Goulet, &#x201c;Magnetic Declination, Frequently Asked Questions,&#x201d; Oct. 2001, Version 4.4, [Online] [Retrieved on May 16, 2009]. Retrieved from the Internet: URL: http://www.geocities.com/magnetic<sub>&#x2014;</sub>declination/, 16 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00065">
<othercit>PNI Sensor Corporation, &#x201c;Calibration Computations for Practical Compassing using the PNI-11096 Magnetometer ASIC&#x201d;, Aug. 2008, PNI Corporation &#xa9; 2001, Santa Rosa, CA, 3 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00066">
<othercit>PNI Sensor Corporation, &#x201c;Multipoint Calibration Primer&#x201d;, (no publication date available), PNI Corporation, Santa Rosa, CA, 10 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00067">
<othercit>An Overview of the Earth's Magnetic Field, &#x201c;The Earth's Magnetic Field&#x2014;An Overview&#x201d;, [Online] [Retrieved on May 16, 2009]. Retrieved from the Internet: URL: http://www.geomag.bgs.ac.uk/earthmag.html, 10 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00068">
<othercit>The Earth's magnetic field, EPS 122: Lecture 5&#x2014;Earth's magnetic field, 11 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00069">
<othercit>Apptism, iTopoMaps, &#xa9; 2009 Apptism, [Online] [Retrieved on Jun. 2, 2009]. Retrieved from the Internet: URL: http://www.apptism.com/apps/itopomaps, 4 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00070">
<othercit>Apptism, Compass Go, &#xa9; 2009 Apptism, [Online] [Retrieved on Jun. 3, 2009]. Retrieved from the Internet: URL: http://www.apptism.com/apps/compass-go, 2 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00071">
<othercit>Apptism, Focalware, &#xa9; 2009 Apptism, [Online] [Retrieved on Jun. 3, 2009]. Retrieved from the Internet: URL: http://www.apptism.com/apps/focalware, 2 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00072">
<othercit>Harper et al., &#x201c;Process for Improving GPS acquisition assistance data and server-side location determination for cellular networks,&#x201d; <i>2004 Intl Symp on GNSS/GPS</i>, Dec. 6-8, 2004, Sydney, Australia, 15 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00073">
<othercit>Zhang and Gao, &#x201c;A Novel Auto-calibration Method of the Vector Magnetometer,&#x201d; <i>Ninth Intl Conf on Electronic Measurement </i>&#x26; <i>Instruments</i>, ICEMI '2009, pp. 1-145 through 1-150.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00074">
<othercit>Camps et al., &#x201c;Numerical Calibration for 3-Axis Accelerometers and Magnetomors,&#x201d; <i>IEEE</i>, 2009, pp. 217-231.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00075">
<othercit>Huang et al., &#x201c;Automatically Identifying Geographic Direction,&#x201d; U.S. Appl. No. 12/477,865, filed Jun. 3, 2009.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00076">
<othercit>Mayor et al., &#x201c;Restoring and Storing Magnetometer Calibration Data,&#x201d; U.S. Appl. No. 12/479,483, filed Jun. 5, 2009.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00077">
<othercit>Mayor et al., &#x201c;Magnetometer Accuracy and Use,&#x201d; U.S. Appl. No. 12/479,717, filed Jun. 5, 2009.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00078">
<othercit>Mayor et al., &#x201c;Context Determination to Assist Location Determination Accuracy,&#x201d; U.S. Appl. No. 12/549,250, filed Aug. 27, 2009.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00079">
<othercit>Piemonte et al., &#x201c;Dynamic Compass Calibration in a Portable Device,&#x201d; U.S. Appl. No. 12/479,203, filed Jun. 5, 2009.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00080">
<othercit>Mayor et al., &#x201c;Accuracy Indications for an Electronic Compass in a Portable Device,&#x201d; U.S. Appl. No. 12/479,196, filed Jun. 5, 2009.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00081">
<othercit>Piemonte et al., &#x201c;Determining Heading Using Magnetometer Data and angular Rate Data,&#x201d; U.S. Appl. No. 12/886,531, filed Sep. 20, 2010.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00082">
<othercit>Tu, &#x201c;Magnetometer Calibration,&#x201d; U.S. Appl. No. 12/899,392, filed Oct. 6, 2010.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00083">
<othercit>&#x201c;Honeywell 3-Axis Digital Compass IC, HMC5843 Electronic Compass,&#x201d; Honeywell International Inc. [online]; retrieved from the Internet: &#x3c;URL: http://www.honeywell.com/sites/portal?smap=aerospace&#x26;page=Magnetic-Sensors3&#x26;theme=T15&#x26;catID=CF84B17AB-A90F-716D-10BC-A1E75441138E&#x26;id=HF916B4E0-4F71-9DB5-DFA8-51B1944918EE&#x26;sel=2&#x26;se14=1&#x3e;, retrieved on Jun. 5, 2005, 1 page.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00084">
<othercit>Westerberg, &#x201c;Compass Go,&#x201d; Apple Apps Store, Oct. 10, 2008, 3 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00085">
<othercit>Mayor et al., Magnetometer Accuracy and Use, U.S. Appl. No. 13/699,403, filed Nov. 5, 2012.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00086">
<othercit>Adiprawita, W., et al., &#x201c;Development of AHRS (Attitude and Heading Reference System) for Autonomous UAV (Unmanned Aerial Vehicle),&#x201d; Proceedings of the International Conference on Electrical Engineering and Informatics, Institut Teknologi Bandung, Indonesia, Jun. 17-19, 2007, 4 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>20</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>702 92</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>702 93</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>702 99</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>702130</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>702136</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>702150-153</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>701211</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>701216</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>701300</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>34099512</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>34099524</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>34099527</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>4</number-of-drawing-sheets>
<number-of-figures>4</number-of-figures>
</figures>
<us-related-documents>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>61319139</doc-number>
<date>20100330</date>
</document-id>
</us-provisional-application>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20110246117</doc-number>
<kind>A1</kind>
<date>20111006</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Moore</last-name>
<first-name>Christopher</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>King</last-name>
<first-name>Brian Michael</first-name>
<address>
<city>Santa Cruz</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Vieta</last-name>
<first-name>William Matthew</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="004" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Tu</last-name>
<first-name>Xiaoyuan</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="005" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Piemonte</last-name>
<first-name>Patrick</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Moore</last-name>
<first-name>Christopher</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>King</last-name>
<first-name>Brian Michael</first-name>
<address>
<city>Santa Cruz</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Vieta</last-name>
<first-name>William Matthew</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="004" designation="us-only">
<addressbook>
<last-name>Tu</last-name>
<first-name>Xiaoyuan</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="005" designation="us-only">
<addressbook>
<last-name>Piemonte</last-name>
<first-name>Patrick</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Fish &#x26; Richardson P.C.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Apple Inc.</orgname>
<role>02</role>
<address>
<city>Cupertino</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Kundu</last-name>
<first-name>Sujoy</first-name>
<department>2857</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Sensor measurements are used to detect when a device incorporating the sensor is stationary. While the device is stationary, sensor measurements at a current device temperature are used to estimate model parameters. The model parameters can be used in a state estimator to provide an estimated attitude that can be provided to other applications. In some implementations, the estimated attitude can be used to mitigate interference in other sensor measurements.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="143.00mm" wi="256.37mm" file="US08626465-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="257.64mm" wi="167.89mm" orientation="landscape" file="US08626465-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="240.28mm" wi="178.14mm" orientation="landscape" file="US08626465-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="254.42mm" wi="183.90mm" file="US08626465-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="242.23mm" wi="185.17mm" file="US08626465-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATION</heading>
<p id="p-0002" num="0001">This application claims priority to pending U.S. Provisional Application Ser. No. 61/319,139, entitled &#x201c;Calibrating Sensor Measurements on Mobile Devices&#x201d;, filed on Mar. 30, 2010, the entire contents of which are hereby incorporated by reference.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">TECHNICAL FIELD</heading>
<p id="p-0003" num="0002">This disclosure relates generally to calibrating sensor measurements on mobile devices.</p>
<heading id="h-0003" level="1">BACKGROUND</heading>
<p id="p-0004" num="0003">Angular rate sensors are used to measure the rotational velocity of an object without a fix point for referencing. A Micro-Electro-Mechanical System (MEMS) angular rate sensor (or MEMS gyro) can be incorporated into mobile devices due to its small size, weight and low cost. The principle of operation is based on the Coriolis effect. A MEMS resonator is driven at a certain frequency (e.g., about 10 kHz). Due to the angular rate the Coriolis force excites a second oscillation perpendicular to the first one. This oscillation is proportional to the angular rate and can be measured using capacitive methods. Application examples include but are not limited to: image stabilisation (e.g., in cameras or mobile phones); input devices for virtual reality applications; platform stabilisation; sensors for game consoles; and sensors for navigation systems.</p>
<p id="p-0005" num="0004">The MEMS gyro is susceptible to bias, scale factor errors, and axis cross-sensitivities, as well as high frequency noise. Cross-axis sensitivity is strongly affected by mounting stresses, while the magnitudes of the bias and scale factor errors are related to external temperature. For example, changes in gyro bias are approximately linear to changes in external temperature. To mitigate the effects of gyro bias, the gyro bias can be estimated using known mathematical formulations and subtracted from the raw gyro data. Calibration using measurements at known angular rates can be used to determine the cross-axis sensitivity. Unfortunately, constraints on processing speed, power and memory can make these mathematical formulations impracticable for applications running on mobile devices with limited resources.</p>
<heading id="h-0004" level="1">SUMMARY</heading>
<p id="p-0006" num="0005">Sensor measurements are used to detect when a device incorporating the sensor is stationary. While the device is stationary, sensor measurements at a current device temperature are used to estimate model parameters. The model parameters can be used in a state estimator to provide an estimated attitude that can be provided to other applications. In some implementations, the estimated attitude can be used to mitigate interference in other sensor measurements.</p>
<p id="p-0007" num="0006">The details of one or more implementations of calibrating sensor measurements on mobile devices are set forth in the accompanying drawings and the description below. Other features, aspects, and advantages of calibrating sensor measurements on mobile devices will become apparent from the description, the drawings, and the claims.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0008" num="0007"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of an exemplary sensor measurement calibration system.</p>
<p id="p-0009" num="0008"><figref idref="DRAWINGS">FIG. 2</figref> is a flow diagram illustrating various exemplary processes performed by the state estimator of <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. 3</figref> is a flow diagram of an exemplary process for estimating model parameters and determining an estimated attitude based on the model parameters.</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram of an exemplary hardware architecture for implementing the system and processes referenced in <figref idref="DRAWINGS">FIGS. 1-3</figref>.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<p id="p-0012" num="0011">Like reference symbols in the various drawings indicate like elements.</p>
<heading id="h-0006" level="1">DETAILED DESCRIPTION</heading>
<heading id="h-0007" level="1">Exemplary Sensor Measurement Calibration System</heading>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of an exemplary sensor measurement calibration system <b>100</b>. In some implementations, system <b>100</b> can include an angular rate sensor <b>102</b> (e.g., a MEMS gyro), motion detector <b>104</b>, model parameter estimator <b>106</b>, state estimator <b>108</b>, calibration database <b>110</b>, accelerometer <b>112</b> and an optional interference mitigation module <b>114</b>. System <b>100</b> can be incorporated in a variety of mobile devices, including but not limited to: a handheld computer, a personal digital assistant (PDA), a cellular telephone, an electronic tablet, a network appliance, a digital camera, a video camera, a smart phone, an enhanced general packet radio service (EGPRS) mobile phone, a media player, a navigation device, an email device, a game console, or a combination of any two or more of these devices. In some implementations, some or all of the components of system <b>100</b> can be included on one or more integrated circuit (IC) chips.</p>
<p id="p-0014" num="0013">In some implementations, an attitude of a device can be updated using body angular rates. The body angular rates can be represented by an angular rates vector {right arrow over (&#x3c9;)}. The components of the angular rates vector {right arrow over (&#x3c9;)} represent angular rates in the x, y and z axes, respectively, in a local coordinate frame of the device. In some implementations, the angular rates vector {right arrow over (&#x3c9;)} can be measured using three MEMS gyros, one on each of the x, y and z axes of the local coordinate frame.</p>
<p id="p-0015" num="0014">Generally, the attitude of the device can be represented by a reference quaternion {right arrow over (q)}<sub>ref </sub>a follows:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>{right arrow over (q)}</i><sub>ref</sub><i>=[q</i><sub>x</sub><i>q</i><sub>y</sub><i>q</i><sub>z</sub><i>q</i><sub>w</sub>]<sup>T</sup>,<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>q</i><sub>w</sub>=cos(<i>f/</i>2)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>q</i><sub>x</sub><i>=J</i><sub>x </sub>sin(<i>f/</i>2)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>q</i><sub>y</sub><i>=J</i><sub>y </sub>sin(<i>f/</i>2)&#x2032;<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>q</i><sub>z</sub><i>=J</i><sub>z </sub>sin(<i>f/</i>2)&#x2003;&#x2003;(1)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where
</p>
<p id="p-0016" num="0015">{right arrow over (J)}=unit vector along axis of rotation</p>
<p id="p-0017" num="0016">f=total rotation angle.</p>
<p id="p-0018" num="0017">A reference quaternion change rate formulation based on a small angle approximation is given by</p>
<p id="p-0019" num="0018">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mo>[</mo>
          <mtable>
            <mtr>
              <mtd>
                <msub>
                  <mover>
                    <mi>q</mi>
                    <mo>.</mo>
                  </mover>
                  <mi>x</mi>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <msub>
                  <mover>
                    <mi>q</mi>
                    <mo>.</mo>
                  </mover>
                  <mi>y</mi>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <msub>
                  <mover>
                    <mi>q</mi>
                    <mo>.</mo>
                  </mover>
                  <mi>z</mi>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <msub>
                  <mover>
                    <mi>q</mi>
                    <mo>.</mo>
                  </mover>
                  <mi>w</mi>
                </msub>
              </mtd>
            </mtr>
          </mtable>
          <mo>]</mo>
        </mrow>
        <mo>=</mo>
        <mrow>
          <mrow>
            <mrow>
              <mfrac>
                <mn>1</mn>
                <mn>2</mn>
              </mfrac>
              <mo>&#x2061;</mo>
              <mrow>
                <mo>[</mo>
                <mtable>
                  <mtr>
                    <mtd>
                      <msub>
                        <mi>q</mi>
                        <mi>w</mi>
                      </msub>
                    </mtd>
                    <mtd>
                      <mrow>
                        <mo>-</mo>
                        <msub>
                          <mi>q</mi>
                          <mi>z</mi>
                        </msub>
                      </mrow>
                    </mtd>
                    <mtd>
                      <mrow>
                        <mo>-</mo>
                        <msub>
                          <mi>q</mi>
                          <mi>y</mi>
                        </msub>
                      </mrow>
                    </mtd>
                  </mtr>
                  <mtr>
                    <mtd>
                      <msub>
                        <mi>q</mi>
                        <mi>z</mi>
                      </msub>
                    </mtd>
                    <mtd>
                      <msub>
                        <mi>q</mi>
                        <mi>w</mi>
                      </msub>
                    </mtd>
                    <mtd>
                      <mrow>
                        <mo>-</mo>
                        <msub>
                          <mi>q</mi>
                          <mi>x</mi>
                        </msub>
                      </mrow>
                    </mtd>
                  </mtr>
                  <mtr>
                    <mtd>
                      <msub>
                        <mi>q</mi>
                        <mi>y</mi>
                      </msub>
                    </mtd>
                    <mtd>
                      <msub>
                        <mi>q</mi>
                        <mi>x</mi>
                      </msub>
                    </mtd>
                    <mtd>
                      <msub>
                        <mi>q</mi>
                        <mi>w</mi>
                      </msub>
                    </mtd>
                  </mtr>
                  <mtr>
                    <mtd>
                      <mrow>
                        <mo>-</mo>
                        <msub>
                          <mi>q</mi>
                          <mi>x</mi>
                        </msub>
                      </mrow>
                    </mtd>
                    <mtd>
                      <mrow>
                        <mo>-</mo>
                        <msub>
                          <mi>q</mi>
                          <mi>y</mi>
                        </msub>
                      </mrow>
                    </mtd>
                    <mtd>
                      <mrow>
                        <mo>-</mo>
                        <msub>
                          <mi>q</mi>
                          <mi>z</mi>
                        </msub>
                      </mrow>
                    </mtd>
                  </mtr>
                </mtable>
                <mo>]</mo>
              </mrow>
            </mrow>
            <mo>&#x2061;</mo>
            <mrow>
              <mo>[</mo>
              <mtable>
                <mtr>
                  <mtd>
                    <msub>
                      <mi>&#x3c9;</mi>
                      <mi>x</mi>
                    </msub>
                  </mtd>
                </mtr>
                <mtr>
                  <mtd>
                    <msub>
                      <mi>&#x3c9;</mi>
                      <mi>y</mi>
                    </msub>
                  </mtd>
                </mtr>
                <mtr>
                  <mtd>
                    <msub>
                      <mi>&#x3c9;</mi>
                      <mi>z</mi>
                    </msub>
                  </mtd>
                </mtr>
              </mtable>
              <mo>]</mo>
            </mrow>
          </mrow>
          <mo>&#x2062;</mo>
          <mrow>
            <mi>dt</mi>
            <mo>.</mo>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>2</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0020" num="0019">Equation (2) can be integrated in discrete time to obtain the final attitude of the device represented by reference quaternion {right arrow over (q)}<sub>ref</sub>.</p>
<p id="p-0021" num="0020">The angular rate vector {right arrow over (&#x3c9;)} is output from angular sensor <b>102</b> and input to motion detector <b>104</b>. Additionally, a current temperature T of the device is input to motion detector <b>104</b>. The current temperature T can be provided by a temperature sensor in angular sensor <b>102</b> or located elsewhere in the device. In some implementations, the angular rate vector {right arrow over (&#x3c9;)} can be scale-corrected before input into motion detector <b>104</b>.</p>
<p id="p-0022" num="0021">In some implementations, motion detector <b>104</b> identifies when the device is stationary. Let {right arrow over (&#x3c9;)}<sub>1 </sub>. . . {right arrow over (&#x3c9;)}<sub>n </sub>be the latest n samples of angular rate from a three axis angular sensor <b>102</b>, expressed in degrees per second. Let T<sub>1 </sub>. . . T<sub>n </sub>be the latest angular sensor temperature samples corresponding to the angular rates {right arrow over (&#x3c9;)}<sub>1 </sub>. . . {right arrow over (&#x3c9;)}<sub>n</sub>.</p>
<p id="p-0023" num="0022">At each new calibration time t, the following quantities are updated per axis:</p>
<p id="p-0024" num="0023">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mover>
            <mi>&#x3c9;</mi>
            <mi>_</mi>
          </mover>
          <mo>=</mo>
          <mrow>
            <mfrac>
              <mn>1</mn>
              <mi>n</mi>
            </mfrac>
            <mo>&#x2062;</mo>
            <mrow>
              <munderover>
                <mo>&#x2211;</mo>
                <mrow>
                  <mi>i</mi>
                  <mo>=</mo>
                  <mn>1</mn>
                </mrow>
                <mi>n</mi>
              </munderover>
              <mo>&#x2062;</mo>
              <msub>
                <mi>&#x3c9;</mi>
                <mi>i</mi>
              </msub>
            </mrow>
          </mrow>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>3</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <msup>
            <mover>
              <mi>&#x3c9;</mi>
              <mi>_</mi>
            </mover>
            <mn>2</mn>
          </msup>
          <mo>=</mo>
          <mrow>
            <mfrac>
              <mn>1</mn>
              <mi>n</mi>
            </mfrac>
            <mo>&#x2062;</mo>
            <mrow>
              <munderover>
                <mo>&#x2211;</mo>
                <mrow>
                  <mi>i</mi>
                  <mo>=</mo>
                  <mn>1</mn>
                </mrow>
                <mi>n</mi>
              </munderover>
              <mo>&#x2062;</mo>
              <msubsup>
                <mi>&#x3c9;</mi>
                <mi>i</mi>
                <mn>2</mn>
              </msubsup>
            </mrow>
          </mrow>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>4</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <mover>
          <mi>T</mi>
          <mi>_</mi>
        </mover>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <mn>1</mn>
            <mi>n</mi>
          </mfrac>
          <mo>&#x2062;</mo>
          <mrow>
            <munderover>
              <mo>&#x2211;</mo>
              <mrow>
                <mi>i</mi>
                <mo>=</mo>
                <mn>1</mn>
              </mrow>
              <mi>n</mi>
            </munderover>
            <mo>&#x2062;</mo>
            <mrow>
              <mi>T</mi>
              <mo>.</mo>
            </mrow>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>5</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0025" num="0024">And from equations (3) and (4), the variance per axis is given by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>&#x3c3;<sup>2</sup>= <o ostyle="single">&#x3c9;</o><sup>2</sup>&#x2212;({right arrow over (&#x3c9;)})<sup>2</sup>.&#x2003;&#x2003;(6).<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0026" num="0025">Since the angular rate should theoretically be zero if the device is stationary, if &#x3c3;<sup>2 </sup>is less than a threshold <o ostyle="single">&#x3c9;</o> can be used as an estimate of the angular rate bias at the current temperature <o ostyle="single">T</o>. <o ostyle="single">&#x3c9;</o>, <o ostyle="single">T</o> (collectively, referred to as a &#x201c;calibration point&#x201d;) and the calibration time t can be stored in calibration database <b>110</b>. Old values of <o ostyle="single">&#x3c9;</o>, <o ostyle="single">T</o> stored in calibration database <b>110</b> that have a temperature close to <o ostyle="single">T</o> can be removed. Calibration database <b>110</b> can be updated as the device ages. For example, an aging algorithm can be applied where the oldest calibration points are removed from calibration database <b>110</b> on a scheduled basis or in response to a trigger event. For example, calibration database <b>110</b> can be pruned of all but the N latest calibration points in each 1&#xb0; C. temperature bin. Additionally, {right arrow over ({right arrow over (&#x3c9;)} can be input to state estimator <b>108</b> as a measurement of the current angular sensor bias.</p>
<p id="p-0027" num="0026">In some implementations, model parameter estimator <b>106</b> can track a linear approximation of the calibration points stored in calibration database <b>110</b>. For example, as calibration points are added to calibration database <b>110</b>, model parameter estimator <b>106</b> can track the following quantities per axis:</p>
<p id="p-0028" num="0027">
<maths id="MATH-US-00003" num="00003">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <munderover>
          <mo>&#x2211;</mo>
          <mrow>
            <mi>i</mi>
            <mo>=</mo>
            <mn>1</mn>
          </mrow>
          <mi>n</mi>
        </munderover>
        <mo>&#x2062;</mo>
        <msub>
          <mi>T</mi>
          <mi>i</mi>
        </msub>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>7</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <munderover>
            <mo>&#x2211;</mo>
            <mrow>
              <mi>i</mi>
              <mo>=</mo>
              <mn>1</mn>
            </mrow>
            <mi>n</mi>
          </munderover>
          <mo>&#x2062;</mo>
          <msubsup>
            <mi>T</mi>
            <mi>i</mi>
            <mn>2</mn>
          </msubsup>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>8</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <munderover>
            <mo>&#x2211;</mo>
            <mrow>
              <mi>i</mi>
              <mo>=</mo>
              <mn>1</mn>
            </mrow>
            <mi>n</mi>
          </munderover>
          <mo>&#x2062;</mo>
          <msub>
            <mi>&#x3c9;</mi>
            <mi>i</mi>
          </msub>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>9</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <munderover>
          <mo>&#x2211;</mo>
          <mrow>
            <mi>i</mi>
            <mo>=</mo>
            <mn>1</mn>
          </mrow>
          <mi>n</mi>
        </munderover>
        <mo>&#x2062;</mo>
        <mrow>
          <msub>
            <mi>&#x3c9;</mi>
            <mi>i</mi>
          </msub>
          <mo>&#x2062;</mo>
          <mrow>
            <msub>
              <mi>T</mi>
              <mi>i</mi>
            </msub>
            <mo>.</mo>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>10</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0029" num="0028">The angular rate bias versus temperature slope, m, can be computed per axis from equations (7)-(10) as:</p>
<p id="p-0030" num="0029">
<maths id="MATH-US-00004" num="00004">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mrow>
            <mi>m</mi>
            <mo>=</mo>
            <mrow>
              <mrow>
                <mo>[</mo>
                <mrow>
                  <mrow>
                    <mi>n</mi>
                    <mo>&#x2062;</mo>
                    <mrow>
                      <munderover>
                        <mo>&#x2211;</mo>
                        <mrow>
                          <mi>i</mi>
                          <mo>=</mo>
                          <mn>1</mn>
                        </mrow>
                        <mi>n</mi>
                      </munderover>
                      <mo>&#x2062;</mo>
                      <msubsup>
                        <mi>T</mi>
                        <mi>i</mi>
                        <mn>2</mn>
                      </msubsup>
                    </mrow>
                  </mrow>
                  <mo>-</mo>
                  <msup>
                    <mrow>
                      <mo>(</mo>
                      <mrow>
                        <munderover>
                          <mo>&#x2211;</mo>
                          <mrow>
                            <mi>i</mi>
                            <mo>=</mo>
                            <mn>1</mn>
                          </mrow>
                          <mi>n</mi>
                        </munderover>
                        <mo>&#x2062;</mo>
                        <msub>
                          <mi>T</mi>
                          <mi>i</mi>
                        </msub>
                      </mrow>
                      <mo>)</mo>
                    </mrow>
                    <mn>2</mn>
                  </msup>
                </mrow>
                <mo>]</mo>
              </mrow>
              <mo>&#x2061;</mo>
              <mrow>
                <mo>[</mo>
                <mrow>
                  <mrow>
                    <mi>n</mi>
                    <mo>&#x2062;</mo>
                    <mrow>
                      <munderover>
                        <mo>&#x2211;</mo>
                        <mrow>
                          <mi>i</mi>
                          <mo>=</mo>
                          <mn>1</mn>
                        </mrow>
                        <mi>n</mi>
                      </munderover>
                      <mo>&#x2062;</mo>
                      <mrow>
                        <mo>(</mo>
                        <mrow>
                          <msub>
                            <mi>&#x3c9;</mi>
                            <mi>i</mi>
                          </msub>
                          <mo>&#x2062;</mo>
                          <msub>
                            <mi>T</mi>
                            <mi>i</mi>
                          </msub>
                        </mrow>
                        <mo>)</mo>
                      </mrow>
                    </mrow>
                  </mrow>
                  <mo>-</mo>
                  <mrow>
                    <mrow>
                      <mo>(</mo>
                      <mrow>
                        <munderover>
                          <mo>&#x2211;</mo>
                          <mrow>
                            <mi>i</mi>
                            <mo>=</mo>
                            <mn>1</mn>
                          </mrow>
                          <mi>n</mi>
                        </munderover>
                        <mo>&#x2062;</mo>
                        <msub>
                          <mi>T</mi>
                          <mi>i</mi>
                        </msub>
                      </mrow>
                      <mo>)</mo>
                    </mrow>
                    <mo>&#x2062;</mo>
                    <mrow>
                      <mo>(</mo>
                      <mrow>
                        <munderover>
                          <mo>&#x2211;</mo>
                          <mrow>
                            <mi>i</mi>
                            <mo>=</mo>
                            <mn>1</mn>
                          </mrow>
                          <mi>n</mi>
                        </munderover>
                        <mo>&#x2062;</mo>
                        <msub>
                          <mi>&#x3c9;</mi>
                          <mi>i</mi>
                        </msub>
                      </mrow>
                      <mo>)</mo>
                    </mrow>
                  </mrow>
                </mrow>
                <mo>]</mo>
              </mrow>
            </mrow>
          </mrow>
          <mo>]</mo>
        </mrow>
        <mo>.</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>11</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0031" num="0030">The angular rate bias versus temperature offset, b, can be computed per axis from equations (7)-(10) as:</p>
<p id="p-0032" num="0031">
<maths id="MATH-US-00005" num="00005">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mrow>
            <mi>b</mi>
            <mo>=</mo>
            <mrow>
              <mrow>
                <mo>[</mo>
                <mrow>
                  <mrow>
                    <mi>n</mi>
                    <mo>&#x2062;</mo>
                    <mrow>
                      <munderover>
                        <mo>&#x2211;</mo>
                        <mrow>
                          <mi>i</mi>
                          <mo>=</mo>
                          <mn>1</mn>
                        </mrow>
                        <mi>n</mi>
                      </munderover>
                      <mo>&#x2062;</mo>
                      <msubsup>
                        <mi>T</mi>
                        <mi>i</mi>
                        <mn>2</mn>
                      </msubsup>
                    </mrow>
                  </mrow>
                  <mo>-</mo>
                  <msup>
                    <mrow>
                      <mo>(</mo>
                      <mrow>
                        <munderover>
                          <mo>&#x2211;</mo>
                          <mrow>
                            <mi>i</mi>
                            <mo>=</mo>
                            <mn>1</mn>
                          </mrow>
                          <mi>n</mi>
                        </munderover>
                        <mo>&#x2062;</mo>
                        <msub>
                          <mi>T</mi>
                          <mi>i</mi>
                        </msub>
                      </mrow>
                      <mo>)</mo>
                    </mrow>
                    <mn>2</mn>
                  </msup>
                </mrow>
                <mo>]</mo>
              </mrow>
              <mo>&#x2061;</mo>
              <mrow>
                <mo>[</mo>
                <mrow>
                  <mrow>
                    <mrow>
                      <mo>(</mo>
                      <mrow>
                        <munderover>
                          <mo>&#x2211;</mo>
                          <mrow>
                            <mi>i</mi>
                            <mo>=</mo>
                            <mn>1</mn>
                          </mrow>
                          <mi>n</mi>
                        </munderover>
                        <mo>&#x2062;</mo>
                        <msubsup>
                          <mi>T</mi>
                          <mi>i</mi>
                          <mn>2</mn>
                        </msubsup>
                      </mrow>
                      <mo>)</mo>
                    </mrow>
                    <mo>&#x2062;</mo>
                    <mrow>
                      <mo>(</mo>
                      <mrow>
                        <munderover>
                          <mo>&#x2211;</mo>
                          <mrow>
                            <mi>i</mi>
                            <mo>=</mo>
                            <mn>1</mn>
                          </mrow>
                          <mi>n</mi>
                        </munderover>
                        <mo>&#x2062;</mo>
                        <msub>
                          <mi>&#x3c9;</mi>
                          <mi>i</mi>
                        </msub>
                      </mrow>
                      <mo>)</mo>
                    </mrow>
                  </mrow>
                  <mo>-</mo>
                  <mrow>
                    <mrow>
                      <mo>(</mo>
                      <mrow>
                        <munderover>
                          <mo>&#x2211;</mo>
                          <mrow>
                            <mi>i</mi>
                            <mo>=</mo>
                            <mn>1</mn>
                          </mrow>
                          <mi>n</mi>
                        </munderover>
                        <mo>&#x2062;</mo>
                        <msub>
                          <mi>T</mi>
                          <mi>i</mi>
                        </msub>
                      </mrow>
                      <mo>)</mo>
                    </mrow>
                    <mo>&#x2062;</mo>
                    <mrow>
                      <mo>(</mo>
                      <mrow>
                        <munderover>
                          <mo>&#x2211;</mo>
                          <mrow>
                            <mi>i</mi>
                            <mo>=</mo>
                            <mn>1</mn>
                          </mrow>
                          <mi>n</mi>
                        </munderover>
                        <mo>&#x2062;</mo>
                        <mrow>
                          <msub>
                            <mi>&#x3c9;</mi>
                            <mi>i</mi>
                          </msub>
                          <mo>&#x2062;</mo>
                          <msub>
                            <mi>T</mi>
                            <mi>i</mi>
                          </msub>
                        </mrow>
                      </mrow>
                      <mo>)</mo>
                    </mrow>
                  </mrow>
                </mrow>
                <mo>]</mo>
              </mrow>
            </mrow>
          </mrow>
          <mo>]</mo>
        </mrow>
        <mo>.</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>12</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0033" num="0032">For three axis sensors, a temperature slope vector {right arrow over (m)} and temperature bias offset vector {right arrow over (b)}=[b<sub>x </sub>b<sub>y </sub>b<sub>z</sub>] are input to state estimator <b>108</b>, where these vector quantities are used to compute an estimated attitude of the device using an attitude estimation filter, as described in reference to <figref idref="DRAWINGS">FIG. 2</figref>.</p>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIG. 2</figref> is a flow diagram illustrating various exemplary processes performed by the state estimator <b>108</b> of <figref idref="DRAWINGS">FIG. 1</figref>. In some implementations, state estimator <b>108</b> can implement update paths <b>200</b>-<b>204</b> for updating state variables. In this example, angular rate sensor <b>102</b> can be a three axis MEMS gyro.</p>
<p id="p-0035" num="0034">A first path <b>200</b> can perform a temperature estimate update using a temperature estimation filter, the current temperature T and the estimated temperature slope vector in {right arrow over (m)} received from model parameter estimator <b>106</b>. The slope vector {right arrow over (m)} and temperature bias offset vector {right arrow over (b)} define a linear model that describes a base bias vector {right arrow over (b)}<sub>base </sub>for a given temperature T given by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>{right arrow over (b)}</i><sub>base</sub><i>={right arrow over (m)}*T+{right arrow over (b)}.</i>&#x2003;&#x2003;(13)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0036" num="0035">A bias delta vector {right arrow over (&#x3b2;)} can then be defined by the difference between the true bias at a given time {right arrow over (b)}<sub>true </sub>and the base bias vector {right arrow over (b)}<sub>base </sub>as follows:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>{right arrow over (&#x3b2;)}=<i>{right arrow over (b)}</i><sub>true</sub><i>&#x2212;{right arrow over (b)}</i><sub>base</sub>,&#x2003;&#x2003;(14)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where the base bias vector {right arrow over (b)}<sub>base </sub>accounts for the bias over a long period of time and the bias delta vector {right arrow over (&#x3b2;)} accounts for the bias for local (in time) variation.
</p>
<p id="p-0037" num="0036">A second update path <b>201</b> can perform an acceleration update using an acceleration vector {right arrow over (a)} received from accelerometer <b>112</b>. The acceleration vector {right arrow over (a)} can be scale-corrected before it is input into state estimator <b>108</b>. If the acceleration vector has too much dynamic acceleration the update can be completed without further action by state estimator <b>108</b>. If the acceleration vector does not have too much dynamic acceleration, a time update can be performed and a gravity vector {right arrow over (g)} can be computed in the local coordinate frame of the device. The gravity vector and other quantities can be used in an attitude estimation filter as described below.</p>
<p id="p-0038" num="0037">A third update path <b>202</b> can perform a gyro update by first subtracting the base bias vector {right arrow over (b)}<sub>base </sub>from the angular rate vector {right arrow over (&#x3c9;)} to generate a temperature compensated angular rate vector {right arrow over (&#x3c9;)}<sub>c</sub>=({right arrow over (&#x3c9;)}&#x2212;m*T&#x2212;b)=[&#x3c9;<sub>cx </sub>&#x3c9;<sub>cy </sub>&#x3c9;<sub>cz</sub>] and then subtracting the bias delta vector {right arrow over (&#x3b2;)} from the compensated angular rate vector {right arrow over (&#x3c9;)}<sub>c </sub>to generate an estimated angular rate vector {right arrow over ({circumflex over (&#x3c9;)}=({right arrow over (&#x3c9;)}<sub>c</sub>&#x2212;&#x3b2;)=[{circumflex over (&#x3c9;)}<sub>x </sub>{circumflex over (&#x3c9;)}<sub>y </sub>{circumflex over (&#x3c9;)}<sub>z</sub>] and storing the estimated angular rate vector in a buffer. The reference quaternion, {right arrow over (q)}<sub>ref</sub>, can be propagated using equation (15) below:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>q</i><sub>delta</sub>=[sin(|{right arrow over ({circumflex over (&#x3c9;)}|*<i>dt/</i>2)*{right arrow over ({circumflex over (&#x3c9;)}/|{right arrow over ({circumflex over (&#x3c9;)}|, cos(|{right arrow over ({circumflex over (&#x3c9;)}|*<i>dt/</i>2)],<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>{right arrow over (q)}</i><sub>ref</sub><i>=q</i><sub>delta</sub><img id="CUSTOM-CHARACTER-00001" he="3.13mm" wi="2.46mm" file="US08626465-20140107-P00001.TIF" alt="custom character" img-content="character" img-format="tif"/><i>{right arrow over (q)}</i><sub>ref</sub>,&#x2003;&#x2003;(15)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where <img id="CUSTOM-CHARACTER-00002" he="3.13mm" wi="2.46mm" file="US08626465-20140107-P00001.TIF" alt="custom character" img-content="character" img-format="tif"/> is quaternion multiplication.
</p>
<p id="p-0039" num="0038">Other approximations or formulations for updating quaternion or direction cosine matrix formulations can also be used. If the estimated angular rate vector {right arrow over ({circumflex over (&#x3c9;)} diverges from the actual angular rate vector {right arrow over (&#x3c9;)}, a time update can be performed. If the magnitude of the temperature compensated angular rate {right arrow over (&#x3c9;)}<sub>c </sub>is less than some predetermined threshold a low pass filter (LPF) can be updated as described below.</p>
<p id="p-0040" num="0039">A fourth update path <b>203</b> can perform a gyro bias update by computing a estimated angular rate vector {right arrow over ({circumflex over (&#x3c9;)} and updating the state of bias delta vector {right arrow over (&#x3b2;)} using the attitude estimation filter.</p>
<p id="p-0041" num="0040">A fifth update path <b>204</b> can perform a gyro bias linear fit update by replacing the temperature bias model in the attitude estimation filter with the new model provided, updating the bias delta vector {right arrow over (&#x3b2;)} and the LPF appropriately.</p>
<heading id="h-0008" level="1">Exemplary Kalman Filter Formulations</heading>
<p id="p-0042" num="0041">The temperature estimation filter and attitude estimation filter referenced above can be implemented using Kalman filter formulations to improve accuracy. In some implementations, two independent Kalman filters can be used: one to estimate temperature, and one to estimate attitude. The Kalman filters can be decoupled for computational efficiency reasons as well as logical reasons.</p>
<p id="p-0043" num="0042">In some implementations, the temperature estimation filter can be a classic Kalman Filter with temperature T and temperature rate {dot over (T)} as states. The temperature estimation filter state and temperature estimation filter transition matrix can be represented by:</p>
<p id="p-0044" num="0043">
<maths id="MATH-US-00006" num="00006">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>X</mi>
          <mo>=</mo>
          <mrow>
            <mo>(</mo>
            <mtable>
              <mtr>
                <mtd>
                  <mi>T</mi>
                </mtd>
              </mtr>
              <mtr>
                <mtd>
                  <mover>
                    <mi>T</mi>
                    <mo>.</mo>
                  </mover>
                </mtd>
              </mtr>
            </mtable>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>16</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <mi>&#x3a6;</mi>
        <mo>=</mo>
        <mrow>
          <mrow>
            <mo>(</mo>
            <mtable>
              <mtr>
                <mtd>
                  <mn>1</mn>
                </mtd>
                <mtd>
                  <mrow>
                    <mi>&#x394;</mi>
                    <mo>&#x2062;</mo>
                    <mstyle>
                      <mspace width="0.3em" height="0.3ex"/>
                    </mstyle>
                    <mo>&#x2062;</mo>
                    <mi>t</mi>
                  </mrow>
                </mtd>
              </mtr>
              <mtr>
                <mtd>
                  <mn>0</mn>
                </mtd>
                <mtd>
                  <mn>1</mn>
                </mtd>
              </mtr>
            </mtable>
            <mo>)</mo>
          </mrow>
          <mo>.</mo>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>17</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0045" num="0044">The attitude estimation filter can be based on a multiplicative extended Kalman filter formulation. The filter can propagate the reference quaternion {right arrow over (q)}<sub>ref </sub>with the compensated angular rate vector {right arrow over (&#x3c9;)}<sub>c</sub>. The attitude estimation filter state can include a local attitude error vector {right arrow over (&#x3b8;)} derived from the reference quaternion {right arrow over (q)}<sub>ref </sub>and the bias delta vector {right arrow over (&#x3b2;)}. The attitude estimation filter state X, transition matrix &#x3a6;, attitude process noise matrix Q and measurement matrix H for the accelerometer can be represented in continuous time format as follows:</p>
<p id="p-0046" num="0045">
<maths id="MATH-US-00007" num="00007">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>X</mi>
          <mo>=</mo>
          <mrow>
            <mo>(</mo>
            <mtable>
              <mtr>
                <mtd>
                  <mover>
                    <mi>&#x3b8;</mi>
                    <mo>&#x21c0;</mo>
                  </mover>
                </mtd>
              </mtr>
              <mtr>
                <mtd>
                  <mover>
                    <mi>&#x3b2;</mi>
                    <mo>&#x21c0;</mo>
                  </mover>
                </mtd>
              </mtr>
            </mtable>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>18</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>&#x3a6;</mi>
          <mo>=</mo>
          <mrow>
            <mo>(</mo>
            <mtable>
              <mtr>
                <mtd>
                  <mrow>
                    <mo>-</mo>
                    <msub>
                      <mrow>
                        <mo>&#xf603;</mo>
                        <mover>
                          <mi>&#x3c9;</mi>
                          <mo>&#x21c0;</mo>
                        </mover>
                        <mo>&#xf604;</mo>
                      </mrow>
                      <mi>x</mi>
                    </msub>
                  </mrow>
                </mtd>
                <mtd>
                  <mrow>
                    <mo>-</mo>
                    <msub>
                      <mi>I</mi>
                      <mrow>
                        <mn>3</mn>
                        <mo>&#xd7;</mo>
                        <mn>3</mn>
                      </mrow>
                    </msub>
                  </mrow>
                </mtd>
              </mtr>
              <mtr>
                <mtd>
                  <msub>
                    <mi>O</mi>
                    <mrow>
                      <mn>3</mn>
                      <mo>&#xd7;</mo>
                      <mn>3</mn>
                    </mrow>
                  </msub>
                </mtd>
                <mtd>
                  <mrow>
                    <mrow>
                      <mo>-</mo>
                      <msup>
                        <mi>&#x3bb;</mi>
                        <mrow>
                          <mo>-</mo>
                          <mn>1</mn>
                        </mrow>
                      </msup>
                    </mrow>
                    <mo>&#xb7;</mo>
                    <msub>
                      <mi>I</mi>
                      <mrow>
                        <mn>3</mn>
                        <mo>&#xd7;</mo>
                        <mn>3</mn>
                      </mrow>
                    </msub>
                  </mrow>
                </mtd>
              </mtr>
            </mtable>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>19</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>Q</mi>
          <mo>=</mo>
          <mrow>
            <mo>(</mo>
            <mtable>
              <mtr>
                <mtd>
                  <mrow>
                    <mi>diag</mi>
                    <mo>&#x2061;</mo>
                    <mrow>
                      <mo>(</mo>
                      <msub>
                        <mi>N</mi>
                        <mi>&#x3b8;</mi>
                      </msub>
                      <mo>)</mo>
                    </mrow>
                  </mrow>
                </mtd>
                <mtd>
                  <msub>
                    <mi>O</mi>
                    <mrow>
                      <mn>3</mn>
                      <mo>&#xd7;</mo>
                      <mn>3</mn>
                    </mrow>
                  </msub>
                </mtd>
              </mtr>
              <mtr>
                <mtd>
                  <msub>
                    <mi>O</mi>
                    <mrow>
                      <mn>3</mn>
                      <mo>&#xd7;</mo>
                      <mn>3</mn>
                    </mrow>
                  </msub>
                </mtd>
                <mtd>
                  <mrow>
                    <mi>diag</mi>
                    <mo>&#x2061;</mo>
                    <mrow>
                      <mo>(</mo>
                      <msub>
                        <mi>N</mi>
                        <mi>&#x3b2;</mi>
                      </msub>
                      <mo>)</mo>
                    </mrow>
                  </mrow>
                </mtd>
              </mtr>
            </mtable>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>20</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <msub>
            <mi>H</mi>
            <mi>acc</mi>
          </msub>
          <mo>&#x2061;</mo>
          <mrow>
            <mo>(</mo>
            <mtable>
              <mtr>
                <mtd>
                  <msub>
                    <mrow>
                      <mo>&#xf603;</mo>
                      <mover>
                        <mi>g</mi>
                        <mover>
                          <mo>&#x21c0;</mo>
                          <mo>^</mo>
                        </mover>
                      </mover>
                      <mo>&#xf604;</mo>
                    </mrow>
                    <mi>x</mi>
                  </msub>
                </mtd>
                <mtd>
                  <msub>
                    <mi>O</mi>
                    <mrow>
                      <mn>3</mn>
                      <mo>&#xd7;</mo>
                      <mn>3</mn>
                    </mrow>
                  </msub>
                </mtd>
              </mtr>
            </mtable>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>21</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>H</mi>
          <mi>bias</mi>
        </msub>
        <mo>=</mo>
        <mrow>
          <mo>(</mo>
          <mtable>
            <mtr>
              <mtd>
                <msub>
                  <mi>O</mi>
                  <mrow>
                    <mn>3</mn>
                    <mo>&#xd7;</mo>
                    <mn>3</mn>
                  </mrow>
                </msub>
              </mtd>
              <mtd>
                <msub>
                  <mi>I</mi>
                  <mrow>
                    <mn>3</mn>
                    <mo>&#xd7;</mo>
                    <mn>3</mn>
                  </mrow>
                </msub>
              </mtd>
            </mtr>
          </mtable>
          <mo>)</mo>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>22</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
where &#x3bb; is a Gauss-Markov time constant, O<sub>n&#xd7;m </sub>is an n&#xd7;m zero matrix, I<sub>n&#xd7;m </sub>an n&#xd7;m identity matrix, and |{right arrow over (&#x3c9;)}|<sub>x</sub>, |{right arrow over (&#x11d;)}|<sub>x </sub>are left cross product matrices.
</p>
<p id="p-0047" num="0046">In practice, a second order discrete approximation can be used for the attitude estimation filter and temperature estimation filter. In the above formulations, an assumption is made that the process noise matrix Q for the attitude error and bias are independent and so can be specified by the matrix diagonals N<sub>&#x3b8; </sub>and N<sub>&#x3b2;</sub>. The measurement matrix can be the accelerometer measurement matrix, which can be defined in terms of the filter's current estimate of gravity {right arrow over (&#x11d;)} generated from the reference quaternion {right arrow over (q)}<sub>ref</sub>. Measurement noise matrices R for the temperature estimation filter and attitude estimation filter are assumed diagonal and have quantities that can be determined empirically using simulations or other known statistical methods. Initial values for the error covariance matrices P can also be selected empirically using simulations or other known statistical methods.</p>
<p id="p-0048" num="0047">The matrices described above can be used in an extended Kalman filter formulation, which includes a time update phase and a measurement update phase as follows:</p>
<p id="p-0049" num="0048">A. Time Update
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0000">
    <ul id="ul0002" list-style="none">
        <li id="ul0002-0001" num="0049">1. Propagate state
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>{right arrow over ({circumflex over (x)}</i><sup>&#x2212;</sup><sub>k</sub><i>=&#x3a6;{right arrow over ({circumflex over (x)}</i><sub>k-1</sub><i>+B{right arrow over (u)}</i><sub>k-1 </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
</li>
        <li id="ul0002-0002" num="0050">2. Propagate error covariance
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>P</i><sub>k</sub><sup>&#x2212;</sup><i>=&#x3a6;P</i><sub>k-1</sub>&#x3a6;<sup>T</sup><i>+Q </i><?in-line-formulae description="In-line Formulae" end="tail"?>
</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0050" num="0051">B. Measurement Update
<ul id="ul0003" list-style="none">
    <li id="ul0003-0001" num="0000">
    <ul id="ul0004" list-style="none">
        <li id="ul0004-0001" num="0052">1. Compute Kalman gain
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>K</i><sub>k</sub><i>=P</i><sub>k</sub><sup>&#x2212;</sup><i>H</i><sup>T</sup>(<i>HP</i><sub>k</sub><sup>&#x2212;</sup><i>H</i><sup>T</sup><i>+R</i>)<sup>&#x2212;1 </sup><?in-line-formulae description="In-line Formulae" end="tail"?>
</li>
        <li id="ul0004-0002" num="0053">2. Update estimate with measurement and Kalman gain
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>{right arrow over ({circumflex over (x)}</i><sub>k</sub><i>={right arrow over ({circumflex over (x)}</i><sub>k</sub><sup>&#x2212;</sup><i>+K</i><sub>k</sub>(<i>{right arrow over (z)}</i><sub>k</sub><i>&#x2212;H{right arrow over ({circumflex over (x)}</i><sub>k</sub><sup>&#x2212;</sup>)<?in-line-formulae description="In-line Formulae" end="tail"?>
</li>
        <li id="ul0004-0003" num="0054">3. Update error covariance with Kalman gain
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>P</i><sub>k</sub>=(<i>I&#x2212;K</i><sub>k</sub><i>H</i>)<i>P</i><sub>k</sub><sup>&#x2212;</sup><?in-line-formulae description="In-line Formulae" end="tail"?>
</li>
    </ul>
    </li>
</ul>
</p>
<heading id="h-0009" level="1">Low Pass Bias Estimates</heading>
<p id="p-0051" num="0055">There can be a number of components that eventually contribute to a gyro bias estimate. In general, these components can be divided into two categories: bias/temperature model and bias delta from the temperature model.</p>
<p id="p-0052" num="0056">Generally, a temperature/bias relationship is maintained in system <b>100</b>, which defines the mean bias value for a given temperature over time. This is a long-term relationship. Shorter term variation from the mean bias at a given temperature&#x2014;the bias delta vector ({right arrow over (&#x3b2;)})&#x2014;can be assumed to be a Gauss-Markov noise model.</p>
<p id="p-0053" num="0057">The bias delta vector can be updated through the Kalman filter formulation. These updates can come in one of three ways: through an accelerometer measurement update, direct measurement update coming from motion detector <b>104</b> or direct measurement update coming from the LPF.</p>
<p id="p-0054" num="0058">In some implementations, a long-term running average of the temperature compensated angular rate vector {right arrow over (&#x3c9;)}<sub>c </sub>can be an early estimate of the bias delta vector {right arrow over (&#x3b2;)}. The LPF can be implemented as a first order auto-regressive filter LPF<sub>n</sub>=&#x3b1;<sub>n</sub>&#xb7;LPF<sub>n-1</sub>+(1&#x2212;&#x3b1;<sub>n</sub>)&#xb7;&#x3c9;<sub>n </sub>with a dynamic update rate. The compensated angular rate vector {right arrow over (&#x3c9;)}<sub>c </sub>values are fed into the LPF if the values are less than a predetermined threshold on the magnitude of the compensated angular rate vector. The update rate &#x3b1;<sub>n </sub>can be chosen to be larger if the magnitude of {right arrow over (&#x3c9;)}<sub>c </sub>is larger, and smaller if the magnitude of {right arrow over (&#x3c9;)}<sub>c </sub>is smaller.</p>
<p id="p-0055" num="0059">This estimate can be periodically applied (e.g., 5 Hz) as a direct measurement to the attitude estimation filter. The measurement noise can be modified to depend roughly on how long the LPF has been running. The purpose of the LPF is to allow for the update of {right arrow over (&#x3b2;)} in regions where significant uncertainty exists as defined through the attitude estimation filter's covariance matrix. These updates can be performed even when the device is moving slowly.</p>
<heading id="h-0010" level="1">Exemplary Interference Mitigation Module</heading>
<p id="p-0056" num="0060">The optional interference mitigation module <b>114</b> can use the reference quaternion output by state estimator <b>108</b> to detect changes in the external magnetic field vector. The module keeps track of the last known magnetometer measurement vector {right arrow over (m)}<sub>k </sub>at time k and the device's estimated attitude A<sub>k </sub>at time k, which can be provided by state estimator <b>108</b>. Module <b>114</b> transforms the measurement vector {right arrow over (m)}<sub>k </sub>into a world coordinate frame using the inverse of A<sub>k</sub>:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>{right arrow over (m)}</i><sub>k</sub><sup>w</sup><i>=A</i><sub>k</sub><sup>&#x2212;1</sup><i>{right arrow over (m)}</i><sub>k</sub>.&#x2003;&#x2003;(23)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0057" num="0061">At each offset-corrected magnetometer measurement vector {right arrow over (m)}<sub>i </sub>at time i, module <b>114</b> reads the current estimated attitude A<sub>i </sub>at time i and constructs a synthetic magnetometer measurement vector {right arrow over (m)}<sub>i</sub><sup>s </sup>at time i:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>{right arrow over (m)}</i><sub>i</sub><sup>s</sup><i>=A</i><sub>i</sub><i>{right arrow over (m)}</i><sub>k</sub><sup>w</sup>.<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0058" num="0062">If the magnetometer measurement vector {right arrow over (m)}<sub>k </sub>expressed in the world frame is substantially constant, the angle between vectors {right arrow over (m)}<sub>i</sub><sup>s </sup>and {right arrow over (m)}<sub>i</sub>,</p>
<p id="p-0059" num="0063">
<maths id="MATH-US-00008" num="00008">
<math overflow="scroll">
<mfrac>
  <mrow>
    <msub>
      <mi>&#x3b8;</mi>
      <mi>i</mi>
    </msub>
    <mo>=</mo>
    <mrow>
      <msup>
        <mi>cos</mi>
        <mrow>
          <mo>-</mo>
          <mn>1</mn>
        </mrow>
      </msup>
      <mo>&#x2061;</mo>
      <mrow>
        <mo>(</mo>
        <mrow>
          <msubsup>
            <mi>m</mi>
            <mi>i</mi>
            <mi>s</mi>
          </msubsup>
          <mo>&#xb7;</mo>
          <msub>
            <mi>m</mi>
            <mi>i</mi>
          </msub>
        </mrow>
        <mo>)</mo>
      </mrow>
    </mrow>
  </mrow>
  <mrow>
    <mrow>
      <mo>&#xf603;</mo>
      <msubsup>
        <mover>
          <mi>m</mi>
          <mo>&#x21c0;</mo>
        </mover>
        <mi>i</mi>
        <mi>s</mi>
      </msubsup>
      <mo>&#xf604;</mo>
    </mrow>
    <mo>&#x2062;</mo>
    <mrow>
      <mo>&#xf603;</mo>
      <msub>
        <mover>
          <mi>m</mi>
          <mo>&#x21c0;</mo>
        </mover>
        <mi>i</mi>
      </msub>
      <mo>&#xf604;</mo>
    </mrow>
  </mrow>
</mfrac>
</math>
</maths>
<br/>
should be zero. When the variance of &#x3b8;<sub>i </sub>within a defined window is below a threshold, and there are no other known sources of magnetometer interference present (e.g., a vibration source), the offset-corrected magnetometer measurement vector {right arrow over (m)}<sub>i </sub>can be used to calculate compass heading. Otherwise, the synthetic magnetometer measurement vector m<sub>i</sub><sup>s </sup>can be used to calculate compass heading.
</p>
<heading id="h-0011" level="1">Exemplary Sensor Calibration Process Flow</heading>
<p id="p-0060" num="0064"><figref idref="DRAWINGS">FIG. 3</figref> is a flow diagram of an exemplary process <b>300</b> for estimating model parameters and determining an estimated attitude based on the estimated model parameters. Process <b>300</b> can be implemented by a sensor data calibration system of a device, such as sensor measurement calibration system <b>100</b>.</p>
<p id="p-0061" num="0065">In some implementations, process <b>300</b> can begin by determining if a device is stationary (<b>302</b>). For example, a motion detector (e.g., motion detector <b>104</b>) can use angular rates from the angular rate sensor (e.g., MEMS gyro) to determine if the device is stationary. In some implementations, a variance of window averaged angular rates can be compared against a threshold value to determine if the device is stationary, as described in reference to <figref idref="DRAWINGS">FIG. 1</figref>. In other implementations, other sensor data can be used to detect when the device is stationary, such as accelerations from accelerometer <b>112</b>.</p>
<p id="p-0062" num="0066">If the device is determined to be stationary (<b>304</b>), a calibration opportunity exists and a window averaged bias vector for the current temperature can be calculated based on the angular rate data output by the angular rate sensor (<b>306</b>). The window averaged bias vector and a corresponding temperature can be stored in a calibration database (<b>308</b>). Model parameters can be calculated from a linear fit of the bias vectors and temperatures stored in the calibration database (<b>310</b>). The estimated attitude of the device can be determined using the model parameters (<b>312</b>). The estimating can be implemented in two independent estimation filters: one filter for estimating temperature and one filter for estimating attitude. The estimation filters can be implemented using Kalman filter formulations. The estimated attitude can optionally be used to mitigate interference in other sensor measurements (<b>314</b>), such as a magnetometer measurement.</p>
<heading id="h-0012" level="1">Exemplary Device Architecture</heading>
<p id="p-0063" num="0067"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram of an exemplary device hardware architecture for implementing the sensor calibration system <b>100</b> and processes referenced in <figref idref="DRAWINGS">FIGS. 1-3</figref>. The device can include memory interface <b>402</b>, one or more data processors, image processors and/or processors <b>404</b>, and peripherals interface <b>406</b>. Memory interface <b>402</b>, one or more processors <b>404</b> and/or peripherals interface <b>406</b> can be separate components or can be integrated in one or more integrated circuits. The various components in the device, for example, can be coupled by one or more communication buses or signal lines.</p>
<p id="p-0064" num="0068">Sensors, devices, and subsystems can be coupled to peripherals interface <b>406</b> to facilitate multiple functionalities. For example, angular rate sensor <b>410</b> (e.g., a MEMS gyro), magnetometer sensor <b>412</b>. Location processor <b>414</b> (e.g., GPS receiver) can be connected to peripherals interface <b>406</b> to provide geopositioning. Accelerometer <b>416</b> can also be connected to peripherals interface <b>406</b> to provide data that can be used to determine change of speed and direction of movement of the mobile device.</p>
<p id="p-0065" num="0069">Camera subsystem <b>420</b> and an optical sensor <b>422</b>, e.g., a charged coupled device (CCD) or a complementary metal-oxide semiconductor (CMOS) optical sensor, can be utilized to facilitate camera functions, such as recording photographs and video clips.</p>
<p id="p-0066" num="0070">Communication functions can be facilitated through one or more wireless communication subsystems <b>424</b>, which can include radio frequency receivers and transmitters and/or optical (e.g., infrared) receivers and transmitters. The specific design and implementation of the communication subsystem <b>424</b> can depend on the communication network(s) over which a mobile device is intended to operate. For example, a mobile device can include communication subsystems <b>424</b> designed to operate over a GSM network, a GPRS network, an EDGE network, a Wi-Fi or WiMax network, and a Bluetooth network. In particular, the wireless communication subsystems <b>424</b> can include hosting protocols such that the mobile device can be configured as a base station for other wireless devices.</p>
<p id="p-0067" num="0071">Audio subsystem <b>426</b> can be coupled to a speaker <b>428</b> and a microphone <b>430</b> to facilitate voice-enabled functions, such as voice recognition, voice replication, digital recording, and telephony functions.</p>
<p id="p-0068" num="0072">I/O subsystem <b>440</b> can include touch screen controller <b>442</b> and/or other input controller(s) <b>444</b>. Touch-screen controller <b>442</b> can be coupled to a touch screen <b>446</b> or pad. Touch screen <b>446</b> and touch screen controller <b>442</b> can, for example, detect contact and movement or break thereof using any of a plurality of touch sensitivity technologies, including but not limited to capacitive, resistive, infrared, and surface acoustic wave technologies, as well as other proximity sensor arrays or other elements for determining one or more points of contact with touch screen <b>446</b>.</p>
<p id="p-0069" num="0073">Other input controller(s) <b>444</b> can be coupled to other input/control devices <b>448</b>, such as one or more buttons, rocker switches, thumb-wheel, infrared port, USB port, and/or a pointer device such as a stylus. The one or more buttons (not shown) can include an up/down button for volume control of speaker <b>428</b> and/or microphone <b>430</b>.</p>
<p id="p-0070" num="0074">In one implementation, a pressing of the button for a first duration may disengage a lock of the touch screen or pad <b>446</b>; and a pressing of the button for a second duration that is longer than the first duration may turn power to the device on or off. The user may be able to customize a functionality of one or more of the buttons. The touch screen <b>446</b> can, for example, also be used to implement virtual or soft buttons and/or a keyboard.</p>
<p id="p-0071" num="0075">In some implementations, the device can present recorded audio and/or video files, such as MP3, AAC, and MPEG files. In some implementations, the device can include the functionality of an MP3 player.</p>
<p id="p-0072" num="0076">Memory interface <b>402</b> can be coupled to memory <b>450</b>. Memory <b>450</b> can include high-speed random access memory and/or non-volatile memory, such as one or more magnetic disk storage devices, one or more optical storage devices, and/or flash memory (e.g., NAND, NOR). Memory <b>450</b> can store operating system <b>452</b>, such as Darwin, RTXC, LINUX, UNIX, OS X, WINDOWS, or an embedded operating system such as VxWorks. Operating system <b>452</b> may include instructions for handling basic system services and for performing hardware dependent tasks. In some implementations, operating system <b>452</b> can include a kernel (e.g., UNIX kernel).</p>
<p id="p-0073" num="0077">Memory <b>450</b> may also store communication instructions <b>454</b> to facilitate communicating with one or more additional devices, one or more computers and/or one or more servers. Memory <b>450</b> may include graphical user interface instructions <b>456</b> to facilitate graphic user interface processing; sensor processing instructions <b>458</b> to facilitate sensor-related processing and functions; phone instructions <b>460</b> to facilitate phone-related processes and functions; electronic messaging instructions <b>462</b> to facilitate electronic-messaging related processes and functions; web browsing instructions <b>464</b> to facilitate web browsing-related processes and functions; media processing instructions <b>466</b> to facilitate media processing-related processes and functions; GPS/Navigation instructions <b>468</b> to facilitate GPS and navigation-related processes and instructions; and camera instructions <b>470</b> to facilitate camera-related processes and functions. The memory <b>450</b> may also store other software instructions (not shown), such as security instructions, web video instructions to facilitate web video-related processes and functions, and/or web shopping instructions to facilitate web shopping-related processes and functions. In some implementations, the media processing instructions <b>466</b> are divided into audio processing instructions and video processing instructions to facilitate audio processing-related processes and functions and video processing-related processes and functions, respectively. An activation record and International Mobile Equipment Identity (IMEI) or similar hardware identifier can also be stored in memory <b>450</b>. Memory <b>450</b> can include instructions for sensor measurement calibration <b>472</b> and sensor calibration data <b>474</b> (e.g., database <b>110</b> storing calibration points).</p>
<p id="p-0074" num="0078">Each of the above identified instructions and applications can correspond to a set of instructions for performing one or more functions described above. These instructions need not be implemented as separate software programs, procedures, or modules. Memory <b>450</b> can include additional instructions or fewer instructions. Furthermore, various functions of the mobile device may be implemented in hardware and/or in software, including in one or more signal processing and/or application specific integrated circuits.</p>
<p id="p-0075" num="0079">The features described can be implemented in digital electronic circuitry, or in computer hardware, firmware, software, or in combinations of them. The features can be implemented in a computer program product tangibly embodied in an information carrier, e.g., in a machine-readable storage device, for execution by a programmable processor; and method steps can be performed by a programmable processor executing a program of instructions to perform functions of the described implementations by operating on input data and generating output. Alternatively or addition, the program instructions can be encoded on a propagated signal that is an artificially generated signal, e.g., a machine-generated electrical, optical, or electromagnetic signal, that is generated to encode information fro transmission to suitable receiver apparatus for execution by a programmable processor.</p>
<p id="p-0076" num="0080">The described features can be implemented advantageously in one or more computer programs that are executable on a programmable system including at least one programmable processor coupled to receive data and instructions from, and to transmit data and instructions to, a data storage system, at least one input device, and at least one output device. A computer program is a set of instructions that can be used, directly or indirectly, in a computer to perform a certain activity or bring about a certain result. A computer program can be written in any form of programming language (e.g., Objective-C, Java), including compiled or interpreted languages, and it can be deployed in any form, including as a stand-alone program or as a module, component, subroutine, or other unit suitable for use in a computing environment.</p>
<p id="p-0077" num="0081">Suitable processors for the execution of a program of instructions include, by way of example, both general and special purpose microprocessors, and the sole processor or one of multiple processors or cores, of any kind of computer. Generally, a processor will receive instructions and data from a read-only memory or a random access memory or both. The essential elements of a computer are a processor for executing instructions and one or more memories for storing instructions and data. Generally, a computer will also include, or be operatively coupled to communicate with, one or more mass storage devices for storing data files; such devices include magnetic disks, such as internal hard disks and removable disks; magneto-optical disks; and optical disks. Storage devices suitable for tangibly embodying computer program instructions and data include all forms of non-volatile memory, including by way of example semiconductor memory devices, such as EPROM, EEPROM, and flash memory devices; magnetic disks such as internal hard disks and removable disks; magneto-optical disks; and CD-ROM and DVD-ROM disks. The processor and the memory can be supplemented by, or incorporated in, ASICs (application-specific integrated circuits).</p>
<p id="p-0078" num="0082">To provide for interaction with a user, the features can be implemented on a computer having a display device such as a CRT (cathode ray tube) or LCD (liquid crystal display) monitor for displaying information to the user and a keyboard and a pointing device such as a mouse or a trackball by which the user can provide input to the computer.</p>
<p id="p-0079" num="0083">The features can be implemented in a computer system that includes a back-end component, such as a data server, or that includes a middleware component, such as an application server or an Internet server, or that includes a front-end component, such as a client computer having a graphical user interface or an Internet browser, or any combination of them. The components of the system can be connected by any form or medium of digital data communication such as a communication network. Examples of communication networks include, e.g., a LAN, a WAN, and the computers and networks forming the Internet.</p>
<p id="p-0080" num="0084">The computer system can include clients and servers. A client and server are generally remote from each other and typically interact through a network. The relationship of client and server arises by virtue of computer programs running on the respective computers and having a client-server relationship to each other.</p>
<p id="p-0081" num="0085">One or more features or steps of the disclosed embodiments can be implemented using an API. An API can define on or more parameters that are passed between a calling application and other software code (e.g., an operating system, library routine, function) that provides a service, that provides data, or that performs an operation or a computation.</p>
<p id="p-0082" num="0086">The API can be implemented as one or more calls in program code that send or receive one or more parameters through a parameter list or other structure based on a call convention defined in an API specification document. A parameter can be a constant, a key, a data structure, an object, an object class, a variable, a data type, a pointer, an array, a list, or another call. API calls and parameters can be implemented in any programming language. The programming language can define the vocabulary and calling convention that a programmer will employ to access functions supporting the API.</p>
<p id="p-0083" num="0087">In some implementations, an API call can report to an application the capabilities of a device running the application, such as input capability, output capability, processing capability, power capability, communications capability, etc.</p>
<p id="p-0084" num="0088">A number of implementations have been described. Nevertheless, it will be understood that various modifications may be made. For example, elements of one or more implementations may be combined, deleted, modified, or supplemented to form further implementations. As yet another example, the logic flows depicted in the figures do not require the particular order shown, or sequential order, to achieve desirable results. In addition, other steps may be provided, or steps may be eliminated, from the described flows, and other components may be added to, or removed from, the described systems. Accordingly, other implementations are within the scope of the following claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001" nb-file="US08626465-20140107-M00001.NB">
<img id="EMI-M00001" he="16.93mm" wi="76.20mm" file="US08626465-20140107-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002" nb-file="US08626465-20140107-M00002.NB">
<img id="EMI-M00002" he="28.19mm" wi="76.20mm" file="US08626465-20140107-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00003" nb-file="US08626465-20140107-M00003.NB">
<img id="EMI-M00003" he="38.10mm" wi="76.20mm" file="US08626465-20140107-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00004" nb-file="US08626465-20140107-M00004.NB">
<img id="EMI-M00004" he="8.81mm" wi="76.20mm" file="US08626465-20140107-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00005" nb-file="US08626465-20140107-M00005.NB">
<img id="EMI-M00005" he="8.81mm" wi="76.20mm" file="US08626465-20140107-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00006" nb-file="US08626465-20140107-M00006.NB">
<img id="EMI-M00006" he="16.93mm" wi="76.20mm" file="US08626465-20140107-M00006.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00007" nb-file="US08626465-20140107-M00007.NB">
<img id="EMI-M00007" he="39.88mm" wi="76.20mm" file="US08626465-20140107-M00007.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00008" nb-file="US08626465-20140107-M00008.NB">
<img id="EMI-M00008" he="7.79mm" wi="76.20mm" file="US08626465-20140107-M00008.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A computer-implemented method performed by one or more processors of a mobile device, comprising:
<claim-text>receiving one or more sensor measurements from a sensor onboard the mobile device;</claim-text>
<claim-text>determining if the device is stationary based on the one or more sensor measurements;</claim-text>
<claim-text>at a first time, upon determining that the device is stationary, calculating one or more model parameters for a current temperature from the sensor measurements, wherein calculating the one or more model parameters includes calculating a measurement bias based on the one or more sensor measurements that are received when the mobile device is determined to be stationary at the first time;</claim-text>
<claim-text>storing, in a calibration database, a calibration point, the calibration point comprising the measurement bias and the current temperature; and</claim-text>
<claim-text>at a second time that occurs after the first time, estimating an attitude of the device using the measurement bias based on a temperature measured at the second time and the temperature of the calibration point.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>mitigating interference in other sensor measurements using the estimated attitude.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, where the sensor measurements are angular rate and the model parameters include measurement bias and temperature slope.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, where determining whether the device is stationary, comprises:
<claim-text>calculating a variance from window averaged sensor measurements; and</claim-text>
<claim-text>determining if the variance exceeds a threshold.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, where calculating one or more model parameters, comprises:
<claim-text>calculating a linear fit of calibration points and temperature slope.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, where estimating an attitude comprises:
<claim-text>estimating temperature using a first estimation filter having a filter state including temperature and temperature rate; and</claim-text>
<claim-text>estimating an attitude of the device using a second estimation filter having a filter state including local attitude error and measurement bias.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, where the first and second estimation filters are Kalman filter formulations.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>maintaining a running average of temperature compensated angular rates as an estimate of measurement bias.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, where maintaining a running average comprises:
<claim-text>filtering angular rates using a low pass filter with a dynamic update rate that is selected based on magnitudes of the angular rates.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. A system for estimating an attitude of a mobile device, comprising:
<claim-text>a sensor onboard the mobile device;</claim-text>
<claim-text>a processor coupled to the sensor and configured to execute instructions which cause the processor to perform operations comprising:
<claim-text>receiving one or more sensor measurements from the sensor;</claim-text>
<claim-text>determining if the device is stationary based on the one or more sensor measurements;</claim-text>
<claim-text>at a first time, upon determining that the device is stationary, calculating one or more model parameters for a current temperature from the sensor measurements, wherein calculating the one or more model parameters includes calculating a measurement bias based on the one or more sensor measurements that are received when the mobile device is determined to be stationary at the first time</claim-text>
<claim-text>storing, in a calibration database, a calibration point, the calibration point comprising the measurement bias and the current temperature; and</claim-text>
<claim-text>at a second time that occurs after the first time, estimating an attitude of the device using the measurement bias based on a temperature measured at the second time and the temperature of the calibration point.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The system of <claim-ref idref="CLM-00010">claim 10</claim-ref>, where the processor is configured to execute instructions to mitigate interference in other sensor measurements using the estimated attitude.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The system of <claim-ref idref="CLM-00010">claim 10</claim-ref>, where the sensor measurements are angular rate and the model parameters include measurement bias and temperature slope.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The system of <claim-ref idref="CLM-00010">claim 10</claim-ref>, where the processor is configured to execute instructions to calculate a variance from window averaged sensor measurements, and to determine if the variance exceeds a threshold.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The system of <claim-ref idref="CLM-00010">claim 10</claim-ref>, where the processor is configured to execute instructions to calculate a linear fit of calibration points and temperature slope.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The system of <claim-ref idref="CLM-00010">claim 10</claim-ref>, where the processor is configured to execute instructions to estimate temperature using a first estimation filter having a filter state including temperature and temperature rate, and to estimate an attitude of the device using a second estimation filter having a filter state including local attitude error and measurement bias.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The system of <claim-ref idref="CLM-00015">claim 15</claim-ref>, where the first and second estimation filters are Kalman filter formulations.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The system of <claim-ref idref="CLM-00010">claim 10</claim-ref>, where the processor is configured to execute instructions to maintain a running average of temperature compensated angular rates as an estimate of measurement bias.</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The system of <claim-ref idref="CLM-00017">claim 17</claim-ref>, where the processor is configured to execute instructions to filter angular rates using a low pass filter with a dynamic update rate that is selected based on magnitudes of the angular rates.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The system of <claim-ref idref="CLM-00010">claim 10</claim-ref>, where the sensor is a gyroscope.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. A non-transitory storage device storing a computer program operable to cause one or more processors of a mobile device to perform operations comprising:
<claim-text>receiving one or more sensor measurements from a sensor onboard the mobile device;</claim-text>
<claim-text>determining if the device is stationary based on the one or more sensor measurements;</claim-text>
<claim-text>at a first time, upon determining that the device is stationary, calculating one or more model parameters for a current temperature from the sensor measurements, wherein calculating the one or more model parameters includes calculating a measurement bias based on the one or more sensor measurements that are received when the mobile device is determined to be stationary at the first time;</claim-text>
<claim-text>storing, in a calibration database, a calibration point, the calibration point comprising the measurement bias and the current temperature; and</claim-text>
<claim-text>at a second time that occurs after the first time, estimating an attitude of the device using the measurement bias based on a temperature measured at the second time and the temperature of the calibration point. </claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
