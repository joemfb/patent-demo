<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08625928-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08625928</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12985836</doc-number>
<date>20110106</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>P2010-009452</doc-number>
<date>20100119</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>177</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>K</subclass>
<main-group>9</main-group>
<subgroup>36</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>382284</main-classification>
</classification-national>
<invention-title id="d2e71">Information processing apparatus, information processing method, and program therefor</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5577131</doc-number>
<kind>A</kind>
<name>Oddou</name>
<date>19961100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382173</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6549681</doc-number>
<kind>B1</kind>
<name>Takiguchi et al.</name>
<date>20030400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382294</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6707934</doc-number>
<kind>B1</kind>
<name>Takeda et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382124</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6714689</doc-number>
<kind>B1</kind>
<name>Yano et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382284</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6751341</doc-number>
<kind>B2</kind>
<name>Oosawa</name>
<date>20040600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382132</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2008/0181494</doc-number>
<kind>A1</kind>
<name>Watanabe et al.</name>
<date>20080700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382167</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2010/0303364</doc-number>
<kind>A1</kind>
<name>Yamada</name>
<date>20101200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382201</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2011/0058715</doc-number>
<kind>A1</kind>
<name>Doering et al.</name>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382128</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2011/0075945</doc-number>
<kind>A1</kind>
<name>Yamaji</name>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382284</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>JP</country>
<doc-number>07-174538</doc-number>
<date>19950700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>JP</country>
<doc-number>9-91410</doc-number>
<date>19970400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>JP</country>
<doc-number>2002-305647</doc-number>
<date>20021000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>JP</country>
<doc-number>2004-072685</doc-number>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>JP</country>
<doc-number>2007-024764</doc-number>
<date>20070200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00015">
<othercit>Cross-correlation, (Dec. 16, 2009), Wikipedia.</othercit>
</nplcit>
<category>cited by examiner</category>
</us-citation>
<us-citation>
<nplcit num="00016">
<othercit>Japanese Office Action issued Aug. 27, 2013 for corresponding Japanese Appln. No. 2010-009452.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>7</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>None</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>14</number-of-drawing-sheets>
<number-of-figures>21</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20110176731</doc-number>
<kind>A1</kind>
<date>20110721</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Fukushi</last-name>
<first-name>Gakuho</first-name>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
<residence>
<country>JP</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Fukushi</last-name>
<first-name>Gakuho</first-name>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>K&#x26;L Gates LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Sony Corporation</orgname>
<role>03</role>
<address>
<city>Tokyo</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Zarka</last-name>
<first-name>David</first-name>
<department>2666</department>
</primary-examiner>
<assistant-examiner>
<last-name>Wang</last-name>
<first-name>Carol</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">An information processing apparatus includes a generation section, a selection section, a matching processing section, and a calculation section. The generation section generates source image blocks obtained by dividing a connection area of a source image into areas, and template image blocks obtained by dividing a connection area of a template image into areas, the connection area of the template image being superimposed on the connection area of the source image. The selection section selects target image blocks as targets individually subjected to matching processing, based on luminance information of each template image block. The matching processing section calculates relative position information of corresponding image blocks as images corresponding to the target image blocks and the target image blocks. The calculation section calculates relative position shift information of the connection area of the source image and that of the template image based on the relative position information.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="211.16mm" wi="164.59mm" file="US08625928-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="205.06mm" wi="148.67mm" orientation="landscape" file="US08625928-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="249.94mm" wi="174.33mm" orientation="landscape" file="US08625928-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="149.94mm" wi="126.92mm" file="US08625928-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="181.36mm" wi="115.32mm" file="US08625928-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="253.15mm" wi="173.65mm" orientation="landscape" file="US08625928-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="255.69mm" wi="160.87mm" orientation="landscape" file="US08625928-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="180.09mm" wi="158.92mm" orientation="landscape" file="US08625928-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="246.04mm" wi="167.89mm" orientation="landscape" file="US08625928-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="177.55mm" wi="143.51mm" file="US08625928-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="180.68mm" wi="128.78mm" file="US08625928-20140107-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="231.31mm" wi="165.35mm" file="US08625928-20140107-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="241.55mm" wi="150.62mm" orientation="landscape" file="US08625928-20140107-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="237.07mm" wi="158.24mm" orientation="landscape" file="US08625928-20140107-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="214.04mm" wi="178.14mm" file="US08625928-20140107-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">CROSS REFERENCES TO RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">The present application claims priority to Japanese Priority Patent Application JP 2010-009452 filed in the Japan Patent Office on Jan. 19, 2010, the entire content of which is hereby incorporated by reference.</p>
<heading id="h-0002" level="1">BACKGROUND</heading>
<p id="p-0003" num="0002">The present application relates to an information processing apparatus, an information processing method, and a program therefor that are capable of combining a plurality of images.</p>
<p id="p-0004" num="0003">From the past, there is known a stitching technique of connecting a plurality of images having physically continuous information, and the stitching technique is used for panoramic photography, photographing of microscope images, or the like. In the stitching technique, it is important to appropriately set a mutual positional relationship between a plurality of images to be connected to one another.</p>
<p id="p-0005" num="0004">For example, processing such as template matching is performed on the entire area in which the plurality of images are superimposed on one another, and accordingly an offset value for setting an optimum mutual positional relationship between the plurality of images to be connected is calculated.</p>
<p id="p-0006" num="0005">Further, for example, Japanese Patent Application Laid-open No. Hei 09-91410 (hereinafter, referred to as Patent Document 1; see paragraphs [0054] to [0071], FIGS. 10 and 11, and the like) discloses a panorama image synthesis system in which a synthesis parameter for connecting a plurality of images is set as follows. First, as shown in FIG. 11 of Patent Document 1, coincidence points in two images 91 and 92 to be connected are designated by a user as user designation points 93 and 94, respectively. Next, a search range 95 with the user designation point 94 as the center on the image 92 is defined. Then, a template image cut out with the user designation point 93 on the image 91 as the center is superimposed within the search range 95 and a difference in a pixel unit is calculated. A point at which the sum of the differences is minimum is calculated as a true corresponding point between the images 91 and 92, and the synthesis parameter described above is calculated based on the calculated true corresponding point.</p>
<heading id="h-0003" level="1">SUMMARY</heading>
<p id="p-0007" num="0006">However, in a case where the processing described above is performed on the entire area in which a plurality of images are superimposed on each other, an amount of computation is increased and a processing time period necessary for synthesis of images becomes long. In addition, in the panorama image synthesis system disclosed in Patent Document 1, a user designates user designation points, and a true corresponding point between the images 91 and 92 is calculated based on the user designation points. Therefore, a burden on the user is increased.</p>
<p id="p-0008" num="0007">In view of the circumstances as described above, it is desirable to provide an information processing apparatus, an information processing method, and a program therefor that are capable of connecting a plurality of images in a short processing time period and with less burden on a user.</p>
<p id="p-0009" num="0008">According to an embodiment, there is provided an information processing apparatus including a generation means, a selection means, a matching processing means, and a calculation means.</p>
<p id="p-0010" num="0009">The generation means generates a plurality of source image blocks obtained by dividing a connection area of a source image into a plurality of areas, and a plurality of template image blocks obtained by dividing a connection area of a template image into a plurality of areas, the connection area of the template image being superimposed on the connection area of the source image.</p>
<p id="p-0011" num="0010">The selection means selects a plurality of target image blocks as targets individually subjected to matching processing, based on luminance information of each of the template image blocks generated by the generation means.</p>
<p id="p-0012" num="0011">The matching processing means calculates, by performing the matching processing on corresponding image blocks as images corresponding to the plurality of target image blocks selected by the selection means, in the plurality of source image blocks generated by the generation means, and the plurality of target image blocks, relative position information of the corresponding image blocks and the target image blocks.</p>
<p id="p-0013" num="0012">The calculation means calculates relative position shift information of the connection area of the source image and the connection area of the template image, based on the relative position information calculated by the matching processing means.</p>
<p id="p-0014" num="0013">In the information processing apparatus, the connection area of the source image and the connection area of the template image to be superimposed thereon are each divided into the plurality of areas, and the plurality of source image blocks and the plurality of template image blocks are generated. Then, the target image blocks are selected from the plurality of template image blocks, and the relative position information of the target image blocks and the corresponding image blocks is calculated. Based on the position information, the relative position shift information of the connection area of the source image and the connection area of the template image is calculated. Accordingly, the matching processing for the entire connection areas superimposed on each other, and the designation of coincide points by a user are unnecessary, with the result that the source image and the template image can be connected to each other appropriately with less burden on the user and in a short processing time period.</p>
<p id="p-0015" num="0014">The generation means may generate the plurality of template image blocks that correspond to the plurality of source image blocks and have a smaller size than that of the plurality of source image blocks.</p>
<p id="p-0016" num="0015">In this case, the matching processing means may generate a correlation coefficient that is based on luminance information of each of the corresponding image blocks and luminance information of each of the target image blocks in accordance with a position of each of the target image blocks within each of the corresponding image blocks, to thereby perform the matching processing, and calculate the generated correlation coefficient as the relative position information.</p>
<p id="p-0017" num="0016">Further, the calculation means may calculate the relative position shift information by cumulatively adding the correlation coefficients of the target image blocks, the correlation coefficients being calculated by the matching processing means.</p>
<p id="p-0018" num="0017">In the information processing apparatus, as the relative position information of the corresponding image block and the target image block, the correlation coefficients are calculated. The correlation coefficients are cumulatively added, with the result that the relative position shift information of the connection area of the source image and the connection area of the template image can be predicted, and the position shift information with high accuracy can be calculated in a short processing time period.</p>
<p id="p-0019" num="0018">The calculation means may generate tentative position shift information by cumulatively adding the correlation coefficients of the target image blocks, and calculate, when the tentative position shift information included in a tolerance set in advance is generated continuously by a predetermined number of times, the tentative position shift information included in the tolerance as the relative position shift information.</p>
<p id="p-0020" num="0019">In the information processing apparatus, the correlation coefficients are cumulatively added, with the result that the tentative position shift information is generated. When the generated tentative position shift information meets the above condition, the tentative position shift information is calculated as final position shift information. By setting the above condition as appropriate, it is possible to set the accuracy of the calculated position shift information, duration of the processing time period, or the like as appropriate.</p>
<p id="p-0021" num="0020">The selection means may calculate a standard deviation value of luminance values for each of the template image blocks, and select the template image blocks having the standard deviation value equal to or larger than a predetermined threshold value, as the target image blocks.</p>
<p id="p-0022" num="0021">By selecting the target image blocks based on the standard deviation value, it is possible to select optimum target image blocks for the matching processing. Accordingly, the position information with high reliability is calculated, with the result that the position shift information can be calculated accurately in a short time period.</p>
<p id="p-0023" num="0022">The selection means may give a first priority order to the template image block having a first standard deviation value, the first priority order representing a priority for which the matching processing is performed by the matching processing means, give a second priority order to the template image block having the standard deviation value smaller than the first standard deviation value, the second priority order having the priority lower than the first priority order, and select the template image block to which the first priority order is given and the template image block to which the second priority order is given, as the target image blocks.</p>
<p id="p-0024" num="0023">Accordingly, the position information with high reliability is selected first, with the result that the position shift information can be calculated accurately in a short time period.</p>
<p id="p-0025" num="0024">The selection means may select a first template image block and a second template image block that is separated from the first template image block by a predetermined distance or more in the connection area of the template image, as the target image blocks.</p>
<p id="p-0026" num="0025">In the information processing apparatus, the first and second template image blocks that are separated from each other in the connection area of the template image by a predetermined distance or more are selected as the target image blocks. Accordingly, the position information is calculated without positional displacement in the connection area. As a result, the position shift information can be calculated accurately based on the calculated position information.</p>
<p id="p-0027" num="0026">According to an embodiment, there is provided an information processing method executed by an information processing apparatus, the information processing method including the following steps.</p>
<p id="p-0028" num="0027">Specifically, the information processing apparatus generates a plurality of source image blocks obtained by dividing a connection area of a source image into a plurality of areas, and a plurality of template image blocks obtained by dividing a connection area of a template image into a plurality of areas, the connection area of the template image being superimposed on the connection area of the source image.</p>
<p id="p-0029" num="0028">A plurality of target image blocks are selected as targets individually subjected to matching processing, based on luminance information of each of the generated template image blocks.</p>
<p id="p-0030" num="0029">By performing the matching processing on corresponding image blocks as images corresponding to the selected target image blocks, in the generated source image blocks, and the plurality of target image blocks, relative position information of the corresponding image blocks and the target image blocks is calculated.</p>
<p id="p-0031" num="0030">Relative position shift information of the connection area of the source image and the connection area of the template image is calculated based on the calculated relative position information.</p>
<p id="p-0032" num="0031">According to an embodiment, there is provided a program causing an information processing apparatus to execute the information processing method described above. The program may be recorded on a recording medium.</p>
<p id="p-0033" num="0032">According to an embodiment, there is provided an information processing apparatus including a generation section, a selection section, a matching processing section, and a calculation section.</p>
<p id="p-0034" num="0033">The generation section is configured to generate a plurality of source image blocks obtained by dividing a connection area of a source image into a plurality of areas, and a plurality of template image blocks obtained by dividing a connection area of a template image into a plurality of areas, the connection area of the template image being superimposed on the connection area of the source image.</p>
<p id="p-0035" num="0034">The selection section is configured to select a plurality of target image blocks as targets individually subjected to matching processing, based on luminance information of each of the template image blocks generated by the generation section.</p>
<p id="p-0036" num="0035">The matching processing section is configured to calculate, by performing the matching processing on corresponding image blocks as images corresponding to the plurality of target image blocks selected by the selection section, in the plurality of source image blocks generated by the generation section, and the plurality of target image blocks, relative position information of the corresponding image blocks and the target image blocks.</p>
<p id="p-0037" num="0036">The calculation section is configured to calculate relative position shift information of the connection area of the source image and the connection area of the template image, based on the relative position information calculated by the matching processing section.</p>
<p id="p-0038" num="0037">As described above, according to an embodiment, it is possible to connect a plurality of images to one another with less burden on a user and in a short processing time period.</p>
<p id="p-0039" num="0038">These and other objects, features and advantages of the present application will become more apparent in light of the following detailed description of best mode embodiments thereof, as illustrated in the accompanying drawings.</p>
<p id="p-0040" num="0039">Additional features and advantages are described herein, and will be apparent from the following Detailed Description and the figures.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE FIGURES</heading>
<p id="p-0041" num="0040"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram showing the structure of an information processing system including at least an information processing apparatus according to a first embodiment;</p>
<p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. 2</figref> are diagrams for explaining stitching processing for digital images, in which an operation of a PC according to the first embodiment is explained;</p>
<p id="p-0043" num="0042"><figref idref="DRAWINGS">FIG. 3</figref> is a flowchart showing the outline of processing of the PC according to the first embodiment;</p>
<p id="p-0044" num="0043"><figref idref="DRAWINGS">FIG. 4</figref> is a flowchart showing a specific algorithm of each processing shown in <figref idref="DRAWINGS">FIG. 3</figref>;</p>
<p id="p-0045" num="0044"><figref idref="DRAWINGS">FIG. 5</figref> is a diagram showing source image blocks and template image blocks according to the first embodiment;</p>
<p id="p-0046" num="0045"><figref idref="DRAWINGS">FIG. 6</figref> is a diagram for explaining a method of selecting target image blocks according to the first embodiment;</p>
<p id="p-0047" num="0046"><figref idref="DRAWINGS">FIG. 7</figref> is a diagram for explaining matching processing of the target image block and a corresponding image block according to the first embodiment in detail;</p>
<p id="p-0048" num="0047"><figref idref="DRAWINGS">FIG. 8</figref> is a diagram for explaining a cumulative result map and a cumulative offset value according to the first embodiment;</p>
<p id="p-0049" num="0048"><figref idref="DRAWINGS">FIG. 9</figref> are diagrams for explaining parameters used for judging stability of the cumulative offset value according to the first embodiment;</p>
<p id="p-0050" num="0049"><figref idref="DRAWINGS">FIG. 10</figref> is a flowchart showing the outline of processing of a PC as an information processing apparatus according to a second embodiment;</p>
<p id="p-0051" num="0050"><figref idref="DRAWINGS">FIG. 11</figref> is a flowchart showing a specific algorithm of each processing shown in <figref idref="DRAWINGS">FIG. 10</figref>;</p>
<p id="p-0052" num="0051"><figref idref="DRAWINGS">FIG. 12</figref> are diagrams for explaining the processing of statistical value management shown in <figref idref="DRAWINGS">FIG. 10</figref>;</p>
<p id="p-0053" num="0052"><figref idref="DRAWINGS">FIG. 13</figref> are diagrams showing processing results of stitching processing according to a second embodiment, and those of stitching processing as Comparative example; and</p>
<p id="p-0054" num="0053"><figref idref="DRAWINGS">FIG. 14</figref> are diagrams showing a difference between the stitching processing according to the second embodiment and the stitching processing as Comparative example.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0055" num="0054">Embodiments of the present application will be described below in detail with reference to the drawings.</p>
<p id="p-0056" num="0055">Hereinafter, an embodiment will be described with reference to the drawings.</p>
<p id="p-0057" num="0056">(First Embodiment)</p>
<p id="p-0058" num="0057">[Structure of Information Processing Apparatus]</p>
<p id="p-0059" num="0058"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram showing the structure of an information processing system including at least an information processing apparatus according to a first embodiment. As the information processing apparatus, for example, a PC (Personal Computer) <b>100</b> is used.</p>
<p id="p-0060" num="0059">The PC <b>100</b> includes a CPU (Central Processing Unit) <b>101</b>, a ROM (Read Only Memory) <b>102</b>, a RAM (Random Access Memory) <b>103</b>, an input/output interface <b>105</b>, and a bus <b>104</b> that connects those components.</p>
<p id="p-0061" num="0060">To the input/output interface <b>105</b>, a display unit <b>106</b>, an input unit <b>107</b>, a storage unit <b>108</b>, a communication unit <b>109</b>, a drive unit <b>110</b>, and the like are connected.</p>
<p id="p-0062" num="0061">The display unit <b>106</b> is a display device using, for example, liquid crystal, EL (Electro-Luminescence), or a CRT (Cathode Ray Tube).</p>
<p id="p-0063" num="0062">The input unit <b>107</b> is, for example, a pointing device, a keyboard, a touch panel, or other operation apparatus. In a case where the input unit <b>107</b> includes a touch panel, the touch panel can be integrated with the display unit <b>106</b>.</p>
<p id="p-0064" num="0063">The storage unit <b>108</b> is a nonvolatile storage device such as an HDD (Hard Disk Drive), a flash memory, and other solid-state memory.</p>
<p id="p-0065" num="0064">The drive unit <b>110</b> is a device capable of driving a removable recording medium <b>111</b> such as an optical recording medium, a floppy disk (registered trademark), a magnetic recording tape, and a flash memory. In contrast to this, the storage unit <b>108</b> is often used as a device that mainly drives a non-removable recording medium and is incorporated in the PC <b>100</b> in advance.</p>
<p id="p-0066" num="0065">The communication unit <b>109</b> is a modem, a router, or other communication device that is connectable to a LAN (Local Area Network), a WAN (Wide Area Network), or the like, and is used for communicating with other devices. The communication unit <b>109</b> may perform wireless or wired communication. The communication unit <b>109</b> is used independently from the PC <b>100</b> in many cases.</p>
<p id="p-0067" num="0066">[Operation of Information Processing Apparatus]</p>
<p id="p-0068" num="0067">To describe the operation of the PC <b>100</b> of this embodiment, first, stitching processing for digital images will be described. <figref idref="DRAWINGS">FIG. 2</figref> are diagrams for explaining the stitching processing.</p>
<p id="p-0069" num="0068">The stitching processing is processing of appropriately connecting a source image <b>1</b> and a template image <b>2</b> that have physically continuous information, as shown in <figref idref="DRAWINGS">FIGS. 2A and 2B</figref>. The source image <b>1</b> has an overlap image A as a connection area, and the template image <b>2</b> has an overlap image B as a connection area. The source image <b>1</b> and the template image <b>2</b> are connected such that the overlap image A and the overlap image B are superimposed on each other.</p>
<p id="p-0070" num="0069"><figref idref="DRAWINGS">FIG. 2A</figref> shows a case where the overlap images A and B are completely identical to each other as image data. In this case, the overlap images A and B are superimposed on each other as they are with relative positions thereof being not shifted, and thus the source image <b>1</b> and the template image <b>2</b> are appropriately connected to each other. Accordingly, the information of the relative position shift between the overlap images A and B, that is, an offset value in x and y directions shown in <figref idref="DRAWINGS">FIG. 2</figref> is (0,0).</p>
<p id="p-0071" num="0070"><figref idref="DRAWINGS">FIG. 2B</figref> shows a case where the overlap images A and B are not completely identical to each other as image data. For example, due to errors of photographing accuracy, a difference in time at which images are taken, and the like caused when the source image <b>1</b> and the template image <b>2</b> are photographed, the state as shown in <figref idref="DRAWINGS">FIG. 2B</figref> is caused. In this case, if the relative position shift between the overlap images A and B is not taken into consideration, the source image <b>1</b> and the template image <b>2</b> are not appropriately connected to each other. In <figref idref="DRAWINGS">FIG. 2B</figref>, an offset value is (4,7), and the overlap image B is shifted from the overlap image A by 4 (pixels) in the x direction and 7 (pixels) in the y direction and superimposed on each other. Accordingly, the source image <b>1</b> and the template image <b>2</b> are appropriately connected to each other.</p>
<p id="p-0072" num="0071">With the PC <b>100</b> of this embodiment, the offset value described above is calculated. The operation of the PC <b>100</b> therefor will be described in detail.</p>
<p id="p-0073" num="0072"><figref idref="DRAWINGS">FIG. 3</figref> is a flowchart showing the outline of processing of the PC <b>100</b> as an information processing apparatus according to this embodiment. <figref idref="DRAWINGS">FIG. 4</figref> is a flowchart showing a specific algorithm of each processing shown in <figref idref="DRAWINGS">FIG. 3</figref>.</p>
<p id="p-0074" num="0073">The following processing of the PC <b>100</b> (each processing section) is realized in cooperation with software stored in the storage unit <b>108</b>, the ROM <b>102</b>, or the like and hardware resources of the PC <b>100</b>. Specifically, the CPU <b>101</b> loads a program constituting the software, which is stored in the storage unit <b>108</b>, the ROM <b>102</b>, or the like, to the RAM <b>103</b>, and executes the program, with the result that the following processing is realized.</p>
<p id="p-0075" num="0074">A source image <b>1</b> and a template image <b>2</b> to be connected to each other are input by an overlap image input section (Step <b>101</b>, Step <b>201</b>). The entire source image <b>1</b> and template image <b>2</b> may be input, or only an overlap image A of the source image <b>1</b> and an overlap image B of the template image <b>2</b> may be input.</p>
<p id="p-0076" num="0075">Each of the overlap images A and B is divided into a plurality of areas by an overlap image block division section (Step <b>102</b>, Step <b>202</b>). This processing is referred to as division into blocks, and images obtained by dividing the overlap image A into blocks are referred to as source image blocks. Further, images obtained by dividing the overlap image B into blocks are referred to as template image blocks.</p>
<p id="p-0077" num="0076"><figref idref="DRAWINGS">FIG. 5</figref> is a diagram showing the source image blocks and the template image blocks. In this embodiment, the overlap images A and B each having a size of 4,048&#xd7;450 (pixels) are set. Then, a block area <b>3</b> located at the center of the overlap image A is divided into blocks, and 29 source image blocks <b>4</b> each having a size of 256&#xd7;256 (pixels) are generated. As shown in <figref idref="DRAWINGS">FIG. 5</figref>, adjacent source image blocks <b>4</b> are provided on the overlap image A so that half areas thereof are superimposed on each other.</p>
<p id="p-0078" num="0077">When a size of each side of the source image block <b>4</b> is defined, a size of a margin <b>5</b> in the overlap image A is also determined. The margin <b>5</b> is allocated equally on the top, bottom, left, and right portions of the overlap image A, and thus the block area <b>3</b> is provided at the center of the overlap image A. Accordingly, it is possible to generate the source image blocks <b>4</b> while avoiding an edge portion of the overlap image A, in which photographing distortion due to a lens is large. As a result, it is possible to improve the accuracy of an image block offset value that will be described later, which is calculated using the source image blocks <b>4</b>.</p>
<p id="p-0079" num="0078">At the center of the overlap image B, a block area <b>6</b> whose size is smaller than that of the block area <b>3</b> is provided. The block area <b>6</b> of the overlap image B is provided so as to be included in an area <b>3</b>&#x2032; corresponding to the block area <b>3</b> of the overlap image A. Further, the block area <b>6</b> is provided at the center of the area <b>3</b>&#x2032;. This block area <b>6</b> is divided into blocks, and 29 template image blocks <b>7</b> each having a size of 128&#xd7;128 (pixels) are generated.</p>
<p id="p-0080" num="0079">The source image block <b>4</b> and the template image block <b>7</b> correspond to each other one for one. <figref idref="DRAWINGS">FIG. 5</figref> shows a positional relationship between the source image block <b>4</b> and the template image block <b>7</b> that correspond to each other. This is a positional relationship between image blocks (blocks n), obtained when an offset value is set to (0,0) and the overlap images A and B are superimposed on each other, and the template image block <b>7</b> is positioned at the center of the source image block <b>4</b>.</p>
<p id="p-0081" num="0080">The size and the number of overlap images A and B, source image blocks <b>4</b>, and template image blocks <b>7</b> described above may be set as appropriate. Further, the positions or the like of the block areas <b>3</b> and <b>6</b> in the overlap images A and B can also be set as appropriate.</p>
<p id="p-0082" num="0081"><figref idref="DRAWINGS">FIG. 5</figref> shows a case where an end portion of the source image <b>1</b> on the right-hand side and an end portion of the template image <b>2</b> on the left-hand side are connected to each other. However, an end portion of the source image <b>1</b> on the left-hand side and an end portion of the template image <b>2</b> on the right-hand side may be connected to each other. Alternatively, the template image <b>2</b> may be connected to an end portion of the source image <b>1</b> on the upper side or the lower side. In this case, the source image blocks <b>4</b> and the template image blocks <b>7</b> are aligned in a lateral direction viewed in <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0083" num="0082">A plurality of target image blocks as targets subjected to matching processing with source image blocks <b>4</b> corresponding thereto are selected from the template image blocks <b>7</b> by an extraction section for blocks used in computation (Step <b>103</b>).</p>
<p id="p-0084" num="0083"><figref idref="DRAWINGS">FIG. 6</figref> is a diagram for explaining a method of selecting target image blocks. In this embodiment, an indicator of &#x201c;presence of texture&#x201d; is used for an optimum target image block <b>8</b> in the matching processing. Based on the indicator, a standard deviation value of luminance values for each template image block <b>7</b> is calculated, and depending on whether the standard deviation value is equal to or larger than a predetermined threshold value, the presence or absence of the texture is judged (Steps <b>203</b> and <b>204</b>). The predetermined threshold value is set to 10.0, for example, and a template image block <b>7</b> having a standard deviation value of 10.0 or larger is judged to have texture.</p>
<p id="p-0085" num="0084">Physically, the standard deviation value of luminance values indicates a degree of discrepancy from an average luminance value of the template image blocks <b>7</b>. Therefore, a template image block <b>7</b> having a standard deviation value equal to or larger than a threshold value is an image having a small number of flat portions and many changes in luminance value in the distribution of luminance values. Accordingly, it can be said that such a template image block <b>7</b> has physical characteristics adequate for the matching processing.</p>
<p id="p-0086" num="0085">A predetermined number of template image blocks <b>7</b> having a standard deviation value equal to or larger than a threshold value is set to be a computation candidate block group <b>9</b>. Then, those template image blocks <b>7</b> are sorted out in descending order of standard deviation values, and set as the target image blocks <b>8</b> subjected to the matching processing in that order (Step <b>205</b>).</p>
<p id="p-0087" num="0086">In <figref idref="DRAWINGS">FIG. 6</figref>, the computation candidate block group <b>9</b> is formed of four target image blocks <b>8</b>. Further, starting with a target image block <b>8</b> (block <b>7</b>) having a larger standard deviation value, the order (1 to 4) representing priority for which the matching processing described below is performed is given. It should be noted that the number of target image blocks <b>8</b> constituting the computation candidate block group <b>9</b> may be set as appropriate.</p>
<p id="p-0088" num="0087">The target image block <b>8</b> and a corresponding image block as a source image block <b>4</b> that corresponds to this target image block <b>8</b> are subjected to the matching processing by an offset calculation section. Then, an optimum offset value of the target image block <b>8</b> and the corresponding image block is calculated (Step <b>104</b>, Step <b>206</b>). In this embodiment, template matching processing is adopted, but other matching processing may be adopted. Hereinafter, the matching processing described above will be described.</p>
<p id="p-0089" num="0088">The target image block <b>8</b> (128&#xd7;128 (pixels)) is moved within the corresponding image block (256&#xd7;256 (pixels)), and a correlation coefficient in an area in which the target image block <b>8</b> and the corresponding image block are superimposed is calculated. Then, a correlation coefficient at each position within the corresponding image block is stored as a single result map. The single result map is to be relative position information of the corresponding image block and the target image block <b>8</b>. The correlation coefficient is calculated based on luminance values of the pixels of the corresponding image block and luminance values of the pixels of the target image block <b>8</b>, by the following expression of a normalized correlation coefficient.</p>
<p id="p-0090" num="0089">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>R</mi>
          <mo>&#x2061;</mo>
          <mrow>
            <mo>(</mo>
            <mrow>
              <mi>x</mi>
              <mo>,</mo>
              <mi>y</mi>
            </mrow>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>=</mo>
        <mfrac>
          <mrow>
            <munder>
              <mo>&#x2211;</mo>
              <mrow>
                <msup>
                  <mi>x</mi>
                  <mi>&#x2032;</mi>
                </msup>
                <mo>,</mo>
                <msup>
                  <mi>y</mi>
                  <mi>&#x2032;</mi>
                </msup>
              </mrow>
            </munder>
            <mo>&#x2062;</mo>
            <mrow>
              <mrow>
                <mi>T</mi>
                <mo>&#x2061;</mo>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <msup>
                      <mi>x</mi>
                      <mi>&#x2032;</mi>
                    </msup>
                    <mo>,</mo>
                    <msup>
                      <mi>y</mi>
                      <mi>&#x2032;</mi>
                    </msup>
                  </mrow>
                  <mo>)</mo>
                </mrow>
              </mrow>
              <mo>&#xb7;</mo>
              <mrow>
                <mi>S</mi>
                <mo>&#x2061;</mo>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mrow>
                      <mi>x</mi>
                      <mo>+</mo>
                      <msup>
                        <mi>x</mi>
                        <mi>&#x2032;</mi>
                      </msup>
                    </mrow>
                    <mo>,</mo>
                    <mrow>
                      <mi>y</mi>
                      <mo>+</mo>
                      <msup>
                        <mi>y</mi>
                        <mi>&#x2032;</mi>
                      </msup>
                    </mrow>
                  </mrow>
                  <mo>)</mo>
                </mrow>
              </mrow>
            </mrow>
          </mrow>
          <msqrt>
            <mrow>
              <munder>
                <mo>&#x2211;</mo>
                <mrow>
                  <msup>
                    <mi>x</mi>
                    <mi>&#x2032;</mi>
                  </msup>
                  <mo>,</mo>
                  <msup>
                    <mi>y</mi>
                    <mi>&#x2032;</mi>
                  </msup>
                </mrow>
              </munder>
              <mo>&#x2062;</mo>
              <mrow>
                <msup>
                  <mrow>
                    <mi>T</mi>
                    <mo>&#x2061;</mo>
                    <mrow>
                      <mo>(</mo>
                      <mrow>
                        <msup>
                          <mi>x</mi>
                          <mi>&#x2032;</mi>
                        </msup>
                        <mo>,</mo>
                        <msup>
                          <mi>y</mi>
                          <mi>&#x2032;</mi>
                        </msup>
                      </mrow>
                      <mo>)</mo>
                    </mrow>
                  </mrow>
                  <mn>2</mn>
                </msup>
                <mo>&#xb7;</mo>
                <mrow>
                  <munder>
                    <mo>&#x2211;</mo>
                    <mrow>
                      <msup>
                        <mi>x</mi>
                        <mi>&#x2032;</mi>
                      </msup>
                      <mo>,</mo>
                      <msup>
                        <mi>y</mi>
                        <mi>&#x2032;</mi>
                      </msup>
                    </mrow>
                  </munder>
                  <mo>&#x2062;</mo>
                  <msup>
                    <mrow>
                      <mi>S</mi>
                      <mo>&#x2061;</mo>
                      <mrow>
                        <mo>(</mo>
                        <mrow>
                          <mrow>
                            <mi>x</mi>
                            <mo>+</mo>
                            <msup>
                              <mi>x</mi>
                              <mi>&#x2032;</mi>
                            </msup>
                          </mrow>
                          <mo>,</mo>
                          <mrow>
                            <mi>y</mi>
                            <mo>+</mo>
                            <msup>
                              <mi>y</mi>
                              <mi>&#x2032;</mi>
                            </msup>
                          </mrow>
                        </mrow>
                        <mo>)</mo>
                      </mrow>
                    </mrow>
                    <mn>2</mn>
                  </msup>
                </mrow>
              </mrow>
            </mrow>
          </msqrt>
        </mfrac>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>[</mo>
        <mrow>
          <mi>Expression</mi>
          <mo>&#x2062;</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>&#x2062;</mo>
          <mn>1</mn>
        </mrow>
        <mo>]</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0091" num="0090">R(x,y): Coordinates of single result map</p>
<p id="p-0092" num="0091">T(x,y): Luminance value of pixel of coordinates (x,y) within target image block <b>8</b></p>
<p id="p-0093" num="0092">S(x,y): Luminance value of pixel of coordinates (x,y) within corresponding image block</p>
<p id="p-0094" num="0093">x&#x2032;=0 . . . w&#x2212;1</p>
<p id="p-0095" num="0094">y&#x2032;=0 . . . h&#x2212;1 (Area in which target image block <b>8</b> and corresponding image block are superimposed is set as w&#xd7;h.)</p>
<p id="p-0096" num="0095">As to the coordinates (x,y) of each image, in a case where the size of an image is m&#xd7;m (pixels), the upper left of each image is set to (0,0), and the lower right is set to (m&#x2212;1,m&#x2212;1). Accordingly, in this embodiment, up to R (0,0) to R (128,128), T (0,0) to T (127,127), S (0,0) to S (255,255) are present. Further, both w and h are 128.</p>
<p id="p-0097" num="0096">The correlation coefficient at each position, stored as a single result map, takes a value of 0 or more and 1 or less. Based on a position whose correlation coefficient is the largest, an image block offset value that is an optimum offset value of the target image block <b>8</b> and the corresponding image block is calculated.</p>
<p id="p-0098" num="0097"><figref idref="DRAWINGS">FIG. 7</figref> is a diagram for explaining the matching processing of the target image block <b>8</b> and the corresponding image block described above in detail. For easy understanding of the explanation, in <figref idref="DRAWINGS">FIG. 7</figref>, the size of the corresponding image block <b>10</b> (source image block <b>4</b>) is illustrated in 10&#xd7;10 (pixels). Further, the size of the target image block <b>8</b> (template image block <b>7</b>) is illustrated in 8&#xd7;8 (pixels). In addition, here, the computation candidate block group <b>9</b> is constituted of three target image blocks <b>8</b>, and each of the target image blocks <b>8</b> is given the order that is based on a standard deviation value of luminance values thereof.</p>
<p id="p-0099" num="0098">The target image block <b>8</b> set as the order 1 and the corresponding image block <b>10</b> are subjected to the matching processing, and a single result map R<sub>1 </sub>shown in <figref idref="DRAWINGS">FIG. 7</figref> is generated. Correlation coefficients stored as the single result map R<sub>1 </sub>are as follows.</p>
<p id="p-0100" num="0099">R(0,0): 0</p>
<p id="p-0101" num="0100">R(1,0): 0.2</p>
<p id="p-0102" num="0101">R(2,0): 0.1</p>
<p id="p-0103" num="0102">R(0,1): 0.2</p>
<p id="p-0104" num="0103">R(1,1): 0.3</p>
<p id="p-0105" num="0104">R(2,1): 0.2</p>
<p id="p-0106" num="0105">R(0,2): 0.1</p>
<p id="p-0107" num="0106">R(1,2): 0.1</p>
<p id="p-0108" num="0107">R(2,2): 0</p>
<p id="p-0109" num="0108">Accordingly, the position at which a correlation coefficient is the highest in the single result map R<sub>1 </sub>is R(1,1). This position is a relative positional relationship between the target image block <b>8</b> and the corresponding image block <b>10</b>, which is obtained when the offset value is set to (0,0) and the overlap images A and B are superimposed on each other, as described with reference to <figref idref="DRAWINGS">FIG. 5</figref>. In other words, an image block offset value of the target image block <b>8</b> set as the order 1 and the corresponding image block <b>10</b> is (0,0).</p>
<p id="p-0110" num="0109">In a single result map R<sub>2 </sub>generated by the matching processing performed on the target image block <b>8</b> set as the order 2 and the corresponding image block <b>10</b>, R(2,1) has the largest correlation coefficient. Therefore, an image block offset value of the target image block <b>8</b> and the corresponding image block <b>10</b> is (1,0). An image block offset value of the target image block <b>8</b> set as the order 3 and the corresponding image block <b>10</b> is (&#x2212;1,1), from a single result map R<sub>3</sub>.</p>
<p id="p-0111" num="0110">It should be noted that as the computation for calculating correlation values stored as the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3</sub>, various computations for judging similarity between image blocks are conceived from a simple one in which a square of a difference of luminance values of pixels in an area in which the target image block <b>8</b> and the corresponding image block <b>10</b> are superimposed on each other is calculated, to a somewhat complicated one in which a correlation is calculated for a shift from a pixel average value of each image block.</p>
<p id="p-0112" num="0111">The single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3 </sub>as to the respective target image blocks <b>8</b> and corresponding image blocks <b>10</b> are cumulatively added by a stability judgment section, and cumulative result maps are generated (Step <b>207</b>). Then, from the generated cumulative result maps, cumulative offset values as tentative position shift information of the overlap images A and B are calculated. It is judged whether the calculated cumulative offset values converge with a predetermined allowable value (Step <b>105</b>, Step <b>208</b>). In Step <b>208</b>, a cumulative offset value judged to be stable is output as a final offset value of the overlap images A and B.</p>
<p id="p-0113" num="0112"><figref idref="DRAWINGS">FIG. 8</figref> is a diagram for explaining the cumulative result map and the cumulative offset value. First, the single result map R<sub>1 </sub>as to the target image block <b>8</b> set as the order 1 and the corresponding image block <b>10</b> described with reference to <figref idref="DRAWINGS">FIG. 7</figref> is set as a cumulative result map Rio. Then, a cumulative offset value (0,0) is calculated from a position R(1,1) at which a cumulative correlation coefficient is the largest in the cumulative result map R<sub>10</sub>.</p>
<p id="p-0114" num="0113">Next, cumulative correlation coefficients at respective positions of the cumulative result map R<sub>10</sub>, and correlation coefficients at respective positions of the single result map R<sub>2 </sub>as to the target image block <b>8</b> set as the order 2 and the corresponding image block <b>10</b> are added. Accordingly, a cumulative result map R<sub>20 </sub>is set. A cumulative offset value (1,0) is calculated from a position R(2,1) at which a cumulative correlation coefficient is the largest in the cumulative result map R<sub>20</sub>.</p>
<p id="p-0115" num="0114">Similarly, correlation coefficients of the cumulative result map R<sub>20 </sub>and the single result map R<sub>3 </sub>are added, and a cumulative result map R<sub>30 </sub>is set. A position at which a cumulative correlation coefficient is the largest in the cumulative result map R<sub>30 </sub>is R(2,1), and accordingly a cumulative offset value is (1,0). This value is different from the offset value (&#x2212;1,1) calculated from the single result map R<sub>3</sub>, and is equal to the cumulative offset value (1,0) calculated from the cumulative result map R<sub>20</sub>. The generation of cumulative result maps and the calculation of cumulative offset values are performed until it is judged that a cumulative offset value is stable.</p>
<p id="p-0116" num="0115">In the matching processing of the target image block <b>8</b> and the corresponding image block <b>10</b>, there may be a case where the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3 </sub>do not show the same tendency due to local characteristics or the like of each image block. In this regard, the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3 </sub>are cumulatively added and the cumulative result maps R<sub>10</sub>, R<sub>20</sub>, R<sub>30 </sub>are generated. The cumulative result maps R<sub>10</sub>, R<sub>20</sub>, R<sub>30 </sub>have constant converge expectations as compared to the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3</sub>. This is because (an average value of) the cumulative map values obtained by calculating correlation coefficients for all the target image blocks <b>8</b> and cumulatively adding those values becomes mathematically substantially equal to a value obtained in a case where correlation coefficients are calculated for the entire overlap images A and B without performing the division into blocks.</p>
<p id="p-0117" num="0116">For example, a case where a normalized correlation calculation is performed on data (s0, s1, s2, s3) and data (t0, t1, t2, t3) all at once, and a case where the calculation is performed twice for data (s0, s1) and (t0, t1), and data (s2, s3) and (t2, t3) and then results thereof are added, are compared to each other. The expression used in the case where the calculation is performed all at once is as follows.</p>
<p id="p-0118" num="0117">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>Normalized</mi>
          <mo>&#x2062;</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>&#x2062;</mo>
          <mi>correlation</mi>
          <mo>&#x2062;</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>&#x2062;</mo>
          <mi>coefficient</mi>
        </mrow>
        <mo>=</mo>
        <mfrac>
          <mrow>
            <mo>(</mo>
            <mrow>
              <mrow>
                <mi>s</mi>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mrow>
                  <mn>0</mn>
                  <mo>&#xb7;</mo>
                  <mi>t</mi>
                </mrow>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mn>0</mn>
              </mrow>
              <mo>+</mo>
              <mrow>
                <mi>s</mi>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mrow>
                  <mn>1</mn>
                  <mo>&#xb7;</mo>
                  <mi>t</mi>
                </mrow>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mn>1</mn>
              </mrow>
              <mo>+</mo>
              <mrow>
                <mi>s</mi>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mrow>
                  <mn>2</mn>
                  <mo>&#xb7;</mo>
                  <mi>t</mi>
                </mrow>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mn>2</mn>
              </mrow>
              <mo>+</mo>
              <mrow>
                <mi>s</mi>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mrow>
                  <mn>3</mn>
                  <mo>&#xb7;</mo>
                  <mi>t</mi>
                </mrow>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mn>3</mn>
              </mrow>
            </mrow>
            <mo>)</mo>
          </mrow>
          <msqrt>
            <mrow>
              <mrow>
                <mo>(</mo>
                <mrow>
                  <mrow>
                    <mi>s</mi>
                    <mo>&#x2062;</mo>
                    <mstyle>
                      <mspace width="0.3em" height="0.3ex"/>
                    </mstyle>
                    <mo>&#x2062;</mo>
                    <msup>
                      <mn>0</mn>
                      <mn>2</mn>
                    </msup>
                  </mrow>
                  <mo>+</mo>
                  <mrow>
                    <mi>s</mi>
                    <mo>&#x2062;</mo>
                    <mstyle>
                      <mspace width="0.3em" height="0.3ex"/>
                    </mstyle>
                    <mo>&#x2062;</mo>
                    <msup>
                      <mn>1</mn>
                      <mn>2</mn>
                    </msup>
                  </mrow>
                  <mo>+</mo>
                  <mrow>
                    <mi>s</mi>
                    <mo>&#x2062;</mo>
                    <mstyle>
                      <mspace width="0.3em" height="0.3ex"/>
                    </mstyle>
                    <mo>&#x2062;</mo>
                    <msup>
                      <mn>2</mn>
                      <mn>2</mn>
                    </msup>
                  </mrow>
                  <mo>+</mo>
                  <mrow>
                    <mi>s</mi>
                    <mo>&#x2062;</mo>
                    <mstyle>
                      <mspace width="0.3em" height="0.3ex"/>
                    </mstyle>
                    <mo>&#x2062;</mo>
                    <msup>
                      <mn>3</mn>
                      <mn>2</mn>
                    </msup>
                  </mrow>
                </mrow>
                <mo>)</mo>
              </mrow>
              <mo>&#xb7;</mo>
              <mrow>
                <mo>(</mo>
                <mrow>
                  <mrow>
                    <mi>t</mi>
                    <mo>&#x2062;</mo>
                    <mstyle>
                      <mspace width="0.3em" height="0.3ex"/>
                    </mstyle>
                    <mo>&#x2062;</mo>
                    <msup>
                      <mn>0</mn>
                      <mn>2</mn>
                    </msup>
                  </mrow>
                  <mo>+</mo>
                  <mrow>
                    <mi>t</mi>
                    <mo>&#x2062;</mo>
                    <mstyle>
                      <mspace width="0.3em" height="0.3ex"/>
                    </mstyle>
                    <mo>&#x2062;</mo>
                    <msup>
                      <mn>1</mn>
                      <mn>2</mn>
                    </msup>
                  </mrow>
                  <mo>+</mo>
                  <mrow>
                    <mi>t</mi>
                    <mo>&#x2062;</mo>
                    <mstyle>
                      <mspace width="0.3em" height="0.3ex"/>
                    </mstyle>
                    <mo>&#x2062;</mo>
                    <msup>
                      <mn>2</mn>
                      <mn>2</mn>
                    </msup>
                  </mrow>
                  <mo>+</mo>
                  <mrow>
                    <mi>t</mi>
                    <mo>&#x2062;</mo>
                    <mstyle>
                      <mspace width="0.3em" height="0.3ex"/>
                    </mstyle>
                    <mo>&#x2062;</mo>
                    <msup>
                      <mn>3</mn>
                      <mn>2</mn>
                    </msup>
                  </mrow>
                </mrow>
                <mo>)</mo>
              </mrow>
            </mrow>
          </msqrt>
        </mfrac>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>[</mo>
        <mrow>
          <mi>Expression</mi>
          <mo>&#x2062;</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>&#x2062;</mo>
          <mn>2</mn>
        </mrow>
        <mo>]</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0119" num="0118">On the other hand, the expression used in the case where the data is divided into two for the calculation and results thereof are added is as follows.</p>
<p id="p-0120" num="0119">
<maths id="MATH-US-00003" num="00003">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>Normalized</mi>
          <mo>&#x2062;</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>&#x2062;</mo>
          <mi>correlation</mi>
          <mo>&#x2062;</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>&#x2062;</mo>
          <mi>coefficient</mi>
        </mrow>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <mrow>
              <mo>(</mo>
              <mrow>
                <mrow>
                  <mi>s</mi>
                  <mo>&#x2062;</mo>
                  <mstyle>
                    <mspace width="0.3em" height="0.3ex"/>
                  </mstyle>
                  <mo>&#x2062;</mo>
                  <mrow>
                    <mn>0</mn>
                    <mo>&#xb7;</mo>
                    <mi>t</mi>
                  </mrow>
                  <mo>&#x2062;</mo>
                  <mstyle>
                    <mspace width="0.3em" height="0.3ex"/>
                  </mstyle>
                  <mo>&#x2062;</mo>
                  <mn>0</mn>
                </mrow>
                <mo>+</mo>
                <mrow>
                  <mi>s</mi>
                  <mo>&#x2062;</mo>
                  <mstyle>
                    <mspace width="0.3em" height="0.3ex"/>
                  </mstyle>
                  <mo>&#x2062;</mo>
                  <mrow>
                    <mn>1</mn>
                    <mo>&#xb7;</mo>
                    <mi>t</mi>
                  </mrow>
                  <mo>&#x2062;</mo>
                  <mstyle>
                    <mspace width="0.3em" height="0.3ex"/>
                  </mstyle>
                  <mo>&#x2062;</mo>
                  <mn>1</mn>
                </mrow>
              </mrow>
              <mo>)</mo>
            </mrow>
            <msqrt>
              <mrow>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mrow>
                      <mi>s</mi>
                      <mo>&#x2062;</mo>
                      <mstyle>
                        <mspace width="0.3em" height="0.3ex"/>
                      </mstyle>
                      <mo>&#x2062;</mo>
                      <msup>
                        <mn>0</mn>
                        <mn>2</mn>
                      </msup>
                    </mrow>
                    <mo>+</mo>
                    <mrow>
                      <mi>s</mi>
                      <mo>&#x2062;</mo>
                      <mstyle>
                        <mspace width="0.3em" height="0.3ex"/>
                      </mstyle>
                      <mo>&#x2062;</mo>
                      <msup>
                        <mn>1</mn>
                        <mn>2</mn>
                      </msup>
                    </mrow>
                  </mrow>
                  <mo>)</mo>
                </mrow>
                <mo>&#xb7;</mo>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mrow>
                      <mi>t</mi>
                      <mo>&#x2062;</mo>
                      <mstyle>
                        <mspace width="0.3em" height="0.3ex"/>
                      </mstyle>
                      <mo>&#x2062;</mo>
                      <msup>
                        <mn>0</mn>
                        <mn>2</mn>
                      </msup>
                    </mrow>
                    <mo>+</mo>
                    <mrow>
                      <mi>t</mi>
                      <mo>&#x2062;</mo>
                      <mstyle>
                        <mspace width="0.3em" height="0.3ex"/>
                      </mstyle>
                      <mo>&#x2062;</mo>
                      <msup>
                        <mn>1</mn>
                        <mn>2</mn>
                      </msup>
                    </mrow>
                  </mrow>
                  <mo>)</mo>
                </mrow>
              </mrow>
            </msqrt>
          </mfrac>
          <mo>+</mo>
          <mfrac>
            <mrow>
              <mo>(</mo>
              <mrow>
                <mrow>
                  <mi>s</mi>
                  <mo>&#x2062;</mo>
                  <mstyle>
                    <mspace width="0.3em" height="0.3ex"/>
                  </mstyle>
                  <mo>&#x2062;</mo>
                  <mrow>
                    <mn>2</mn>
                    <mo>&#xb7;</mo>
                    <mi>t</mi>
                  </mrow>
                  <mo>&#x2062;</mo>
                  <mstyle>
                    <mspace width="0.3em" height="0.3ex"/>
                  </mstyle>
                  <mo>&#x2062;</mo>
                  <mn>2</mn>
                </mrow>
                <mo>+</mo>
                <mrow>
                  <mi>s</mi>
                  <mo>&#x2062;</mo>
                  <mstyle>
                    <mspace width="0.3em" height="0.3ex"/>
                  </mstyle>
                  <mo>&#x2062;</mo>
                  <mrow>
                    <mn>3</mn>
                    <mo>&#xb7;</mo>
                    <mi>t</mi>
                  </mrow>
                  <mo>&#x2062;</mo>
                  <mstyle>
                    <mspace width="0.3em" height="0.3ex"/>
                  </mstyle>
                  <mo>&#x2062;</mo>
                  <mn>3</mn>
                </mrow>
              </mrow>
              <mo>)</mo>
            </mrow>
            <msqrt>
              <mrow>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mrow>
                      <mi>s</mi>
                      <mo>&#x2062;</mo>
                      <mstyle>
                        <mspace width="0.3em" height="0.3ex"/>
                      </mstyle>
                      <mo>&#x2062;</mo>
                      <msup>
                        <mn>2</mn>
                        <mn>2</mn>
                      </msup>
                    </mrow>
                    <mo>+</mo>
                    <mrow>
                      <mi>s</mi>
                      <mo>&#x2062;</mo>
                      <mstyle>
                        <mspace width="0.3em" height="0.3ex"/>
                      </mstyle>
                      <mo>&#x2062;</mo>
                      <msup>
                        <mn>3</mn>
                        <mn>2</mn>
                      </msup>
                    </mrow>
                  </mrow>
                  <mo>)</mo>
                </mrow>
                <mo>&#xb7;</mo>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mrow>
                      <mi>t</mi>
                      <mo>&#x2062;</mo>
                      <mstyle>
                        <mspace width="0.3em" height="0.3ex"/>
                      </mstyle>
                      <mo>&#x2062;</mo>
                      <msup>
                        <mn>2</mn>
                        <mn>2</mn>
                      </msup>
                    </mrow>
                    <mo>+</mo>
                    <mrow>
                      <mi>t</mi>
                      <mo>&#x2062;</mo>
                      <mstyle>
                        <mspace width="0.3em" height="0.3ex"/>
                      </mstyle>
                      <mo>&#x2062;</mo>
                      <msup>
                        <mn>3</mn>
                        <mn>2</mn>
                      </msup>
                    </mrow>
                  </mrow>
                  <mo>)</mo>
                </mrow>
              </mrow>
            </msqrt>
          </mfrac>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>[</mo>
        <mrow>
          <mi>Expression</mi>
          <mo>&#x2062;</mo>
          <mstyle>
            <mspace width="0.8em" height="0.8ex"/>
          </mstyle>
          <mo>&#x2062;</mo>
          <mn>3</mn>
        </mrow>
        <mo>]</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0121" num="0120">The two expressions above include a division by a norm product, so the values do not perfectly coincide with each other but they become very close to each other. Therefore, it is found that the cumulative result maps R<sub>10</sub>, R<sub>20</sub>, R<sub>30 </sub>have constant converge expectations. It should be noted that if it is possible to ignore the influence caused when an absolute value of luminance values in each image block becomes large, the division by a norm product may not be performed and the addition may be performed only in the numerator part. In this case, two values to be calculated perfectly coincide with each other.</p>
<p id="p-0122" num="0121">As described above, in this embodiment, as relative position information of the corresponding image blocks <b>10</b> and the target image blocks <b>8</b>, the correlation coefficients are stored as the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3</sub>. Then, the correlation coefficients of the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3 </sub>are cumulatively added, with the result that the cumulative result maps R<sub>10</sub>, R<sub>20</sub>, R<sub>30 </sub>are generated. Accordingly, a converge point of the cumulative offset value, which is a final offset value of the overlap image A as the source image <b>1</b> and the overlap image B as the template image <b>2</b>, can be predicted, with the result that a highly-accurate final offset value can be calculated for a short processing time.</p>
<p id="p-0123" num="0122">In addition, as described above, the template image blocks <b>7</b> having a standard deviation value equal to or larger than a predetermined threshold value are selected as optimum target image blocks <b>8</b> for the matching processing for generating the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3</sub>. Accordingly, the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3 </sub>with high reliability are generated.</p>
<p id="p-0124" num="0123">Further, the template image blocks <b>7</b> are given the order representing propriety for which the matching processing is performed in descending order of standard deviation values, and are set as the target image blocks <b>8</b>, with the result that from an image block with higher reliability, the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3 </sub>are generated. Accordingly, a highly-accurate final offset value can be calculated for a short processing time.</p>
<p id="p-0125" num="0124">The judgment on stability of the cumulative offset value will be described. For example, with use of the following two parameters, the stability of the cumulative offset value is judged.</p>
<p id="p-0126" num="0125">Tolerance for judging a cumulative offset value to be &#x201c;not changed&#x201d; when the cumulative offset value is compared with the previously-calculated cumulative offset value</p>
<p id="p-0127" num="0126">The number of times representing how many times &#x201c;not changed&#x201d; is necessary to be judged in order to determine that a cumulative offset value is stable</p>
<p id="p-0128" num="0127"><figref idref="DRAWINGS">FIG. 9</figref> are diagrams for explaining the parameter a. As shown in <figref idref="DRAWINGS">FIGS. 9A</figref>, <b>9</b>B, and <b>9</b>C, the tolerances are set as appropriate, and the judgment on &#x201c;changed&#x201d; and &#x201c;not changed&#x201d; of the calculated cumulative offset values are carried out. In other words, as compared to the previously-calculated cumulative offset value, a cumulative offset value whose difference between the x coordinate and the y coordinate is smaller than the tolerance becomes a cumulative offset value included in the tolerance range.</p>
<p id="p-0129" num="0128">The parameter b. will be described. For example, when the judgment of &#x201c;not changed&#x201d; by the parameter a. is successively obtained twice, that cumulative offset value is judged to be stable. Alternatively, the judgment of &#x201c;not changed&#x201d; is successively obtained three times, the cumulative offset value is judged to be stable. In other words, the stability of a cumulative offset value is judged using the number of times the judgment of &#x201c;not changed&#x201d; is successively obtained, as a standard.</p>
<p id="p-0130" num="0129">In this manner, when the calculated cumulative offset value meets the conditions defined by the parameters a. and b., it is judged that the cumulative offset value is stable. The cumulative offset value that have been judged to be stable is set as a final offset value of the overlap images A and B (Yes of Step <b>208</b>). By setting the parameters a. and b. as appropriate, it is possible to set as appropriate a processing time necessary for calculating a final offset value or the accuracy of a final offset value of the overlap images A and B. Parameters different from the parameters a. and b. described in this embodiment may be used.</p>
<p id="p-0131" num="0130">It should be noted that in a case where the cumulative offset values calculated by cumulatively adding all the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3 </sub>of the selected target image blocks <b>8</b> are not judged to be stable (No of Step <b>208</b>), other target image blocks <b>8</b> are selected in Step <b>205</b>.</p>
<p id="p-0132" num="0131">As described above, in the PC <b>100</b> as an information processing apparatus according to this embodiment, the overlap image A of the source image <b>1</b>, and the overlap image B of the template image <b>2</b> that is superimposed on the overlap image A are each divided into a plurality of areas. Accordingly, a plurality of source image blocks <b>4</b> and a plurality of template image blocks <b>7</b> are generated. Then, target image blocks <b>8</b> are selected from the plurality of template image blocks <b>7</b>, and single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3 </sub>as relative position information of the target image blocks <b>8</b> and corresponding image blocks <b>10</b> are generated. Based on the single result maps R<sub>1</sub>, R<sub>2</sub>, R<sub>3</sub>, a final offset value as relative position shift information of the overlap image A of the source image <b>1</b> and the overlap image B of the template image <b>2</b> is calculated. Therefore, the matching processing is unnecessary to be performed on the entire overlap images A and B superimposed on each other, and a user does not need to designate a coincidence point. As a result, it is possible to appropriately connect the source image <b>1</b> and the template image <b>2</b> with less burden on the user for a short processing time.</p>
<p id="p-0133" num="0132">(Second Embodiment)</p>
<p id="p-0134" num="0133">An information processing apparatus according to a second embodiment will be described with an example of a PC. In the following description, the structure and operations that are the same as those of the PC <b>100</b> described in the first embodiment will not be described or simply described.</p>
<p id="p-0135" num="0134"><figref idref="DRAWINGS">FIG. 10</figref> is a flowchart showing the outline of processing of a PC as an information processing apparatus according to this embodiment. <figref idref="DRAWINGS">FIG. 11</figref> is a flowchart showing a specific algorithm of each processing shown in <figref idref="DRAWINGS">FIG. 10</figref>.</p>
<p id="p-0136" num="0135">As shown in <figref idref="DRAWINGS">FIGS. 10 and 11</figref>, in the PC according to this embodiment, a cumulative offset value that has been judged to be stable by the stability judgment section in Step <b>105</b> is output to a statistical value management section.</p>
<p id="p-0137" num="0136"><figref idref="DRAWINGS">FIG. 12</figref> are diagrams for explaining the processing of the statistical value management section. For example, as shown in <figref idref="DRAWINGS">FIG. 12</figref>, a subject <b>11</b> is photographed separately in nine partial images <b>12</b> (numbers 0 to 8 shown in <figref idref="DRAWINGS">FIG. 12</figref>). Then, as shown in <figref idref="DRAWINGS">FIG. 12A</figref>, eight images (numbers 0 to 7) of the nine partial images <b>12</b> are connected by the stitching processing described in the first embodiment.</p>
<p id="p-0138" num="0137">As shown in <figref idref="DRAWINGS">FIG. 12A</figref>, the partial image <b>12</b> (number 0) and the partial image <b>12</b> (number 1) are connected in the y direction, and a final offset value calculated at this time is (&#x2212;5,2). The partial image <b>12</b> (number 1) and the partial image <b>12</b> (number 2) are also connected in the y direction, and a final offset value is (&#x2212;4,2). The partial image <b>12</b> (number 6) and the partial image <b>12</b> (number 7) are similarly connected, and a final offset value is (&#x2212;5,2).</p>
<p id="p-0139" num="0138">Those three final offset values are cumulatively added, to thereby calculate a direction-offset cumulative value (&#x2212;14,6). Further, a direction counter value that is the number of cumulative additions is set to 3. The direction-offset cumulative value (&#x2212;14,6) is divided by the direction counter value of 3, to thereby calculate a direction estimate value (&#x2212;5,2) as a statistical value. In a case where a direction offset value cannot be divided by the direction counter value, for example, round-off, round-down, round-up, or the like is performed to calculate a statistical value.</p>
<p id="p-0140" num="0139">In this manner, based on the direction-offset cumulative value obtained by cumulatively adding final offset values calculated in the past for the x direction and the y direction, and the direction counter value that is the number of additions, an average value of final offset values for each connection direction is calculated. The calculated average value is stored as a statistical value.</p>
<p id="p-0141" num="0140">As shown in <figref idref="DRAWINGS">FIG. 12B</figref>, ninth partial image <b>12</b> (number 8) is connected to the partial image <b>12</b> (number 7) in the y direction. At that time, the calculated final offset value and the stored statistical value (&#x2212;5,2) are compared with each other, and it is judged whether a prominent discrepancy is found therebetween (Step <b>209</b>). For example, in a case where an absolute value of a difference between the final offset value and the statistical value (&#x2212;5,2) is equal to or larger than a predetermined threshold value, it is judged that there is a prominent discrepancy. As the predetermined threshold value, for example, a value of about 20 is conceived.</p>
<p id="p-0142" num="0141">In a case where it is judged that there is a prominent discrepancy between the final offset value and the statistical value (&#x2212;5,2) (Yes of Step <b>209</b>), as shown in <figref idref="DRAWINGS">FIG. 12B</figref>, the statistical value (&#x2212;5,2) is applied mutatis mutandis as a final offset value, and the calculated final offset value is not used (Step <b>210</b>). Accordingly, for example, the case where an inappropriate final offset value is calculated due to a photographing environment at a time when the partial images <b>12</b> are photographed, photographed dust or the like that is judged as texture, and the like, can be supported.</p>
<p id="p-0143" num="0142">Further, assuming that it is judged that no target image blocks <b>8</b> having texture, which are optimum for the matching processing, are present in Step <b>204</b> shown in <figref idref="DRAWINGS">FIG. 11</figref>, also in this case, the statistical value is applied mutatis mutandis as a final offset value in Step <b>210</b>.</p>
<p id="p-0144" num="0143">In a case where it is judged that a prominent discrepancy is not found between the final offset value and the statistical value (&#x2212;5,2) (No of Step <b>209</b>), based on the calculated final offset value, the partial image <b>12</b> (number 8) and the partial image <b>12</b> (number 7) are connected to each other. Then, the final offset value is added to the direction-offset cumulative value, and the direction counter value is incremented (Step <b>211</b>). Specifically, the direction-offset cumulative value (&#x2212;14,6) and the vale 3 of the direction counter value described above are set in the past in Step <b>211</b>.</p>
<p id="p-0145" num="0144"><figref idref="DRAWINGS">FIG. 13</figref> are diagrams showing processing results of the stitching processing according to this embodiment, and those of stitching processing as Comparative example. As shown in <figref idref="DRAWINGS">FIGS. 13A and 13B</figref>, in this case, processing results obtained when a part of an image of an observation target object <b>13</b> that is obtained by an optical microscope is photographed separately in nine partial images <b>12</b> (numbers 0 to 8), and those images are subjected to the stitching processing are shown. The nine partial images <b>12</b> are connected to each other in the order from the partial image <b>12</b> (number 0) to the partial image <b>12</b> (number 8) in directions indicated by index 1 to index 8.</p>
<p id="p-0146" num="0145">In the stitching processing as Comparative example, the matching processing is performed on the entire overlap images A and B without dividing the overlap images A and B into blocks. On the other hand, in the stitching processing according to this embodiment, a computation candidate block group <b>9</b> is constituted of three target image blocks <b>8</b> (see blk of <figref idref="DRAWINGS">FIG. 13C</figref>). In addition, the tolerance for the stability judgment shown in <figref idref="DRAWINGS">FIG. 9</figref> is set to &#xb1;1, and the number of times the stability judgment is performed is set to two.</p>
<p id="p-0147" num="0146">As shown in <figref idref="DRAWINGS">FIG. 13C</figref>, final offset values obtained by the two types of processing compared to each other are substantially equal values, and differences thereof can be considered to be in a range of the tolerance. In terms of a calculation time period, in the stitching processing according to this embodiment, the total of the calculation time period is 0.648 seconds. Compared with this, the stitching processing of Comparative example takes 7.151 seconds. Specifically, it is found that in the stitching processing according to this embodiment, the calculation time period is short to a large extent and high-speed stitching processing is realized.</p>
<p id="p-0148" num="0147"><figref idref="DRAWINGS">FIG. 14</figref> are diagrams showing a difference between the stitching processing according to this embodiment, and the stitching processing as Comparative example. <figref idref="DRAWINGS">FIGS. 14A and 14B</figref> show the same block area <b>6</b> of the template image <b>2</b>.</p>
<p id="p-0149" num="0148">In the stitching processing as Comparative example, a standard deviation value of luminance values for the entire block area <b>6</b> is calculated, and the presence/absence of texture is judged. Then, the matching processing is performed on the entire block area <b>6</b> that is judged to have texture. As shown in <figref idref="DRAWINGS">FIG. 14A</figref>, a standard deviation value of the entire block area <b>6</b> is 4.72, which is low. Therefore, highly-accurate matching processing is difficult to be performed with this block area <b>6</b>. Alternatively, in a case where a threshold value of the standard deviation value is set for the judgment of the presence/absence of texture, it is highly likely that the block area <b>6</b> is judged to have no texture. In that case, the block area <b>6</b> is not used for the matching processing.</p>
<p id="p-0150" num="0149">As shown in <figref idref="DRAWINGS">FIG. 14B</figref>, in the stitching processing of this embodiment, the block area <b>6</b> is divided into blocks and a plurality of template image blocks <b>7</b> are generated. In the template image blocks <b>7</b> positioned on the lower side of the block area <b>6</b> when viewed in <figref idref="DRAWINGS">FIG. 14B</figref>, standard deviation values become large. Therefore, those template image blocks <b>7</b> can be used as target image blocks <b>8</b> for calculating a final offset value of the overlap images A and B.</p>
<p id="p-0151" num="0150">In this manner, in the stitching processing described as Comparative example, a standard deviation value is calculated for the entire block area <b>6</b>, and this value is set as an index value of the texture judgment. Therefore, for example, in a case where a most part of the block area <b>6</b> is plain, the plain area is dominant and a standard deviation value becomes low. As a result, the accuracy of the stitching processing is reduced, or the block area <b>6</b> is not used for the stitching processing.</p>
<p id="p-0152" num="0151">However, in the stitching processing of this embodiment, the block area <b>6</b> is divided into blocks and a standard deviation value is calculated for each of the generated template image blocks <b>7</b>, to thereby judge the presence/absence of texture. Therefore, in a case where minute texture is present, the minute texture is detected with high sensitivity and can be used as a target image block <b>8</b> in the stitching processing.</p>
<p id="p-0153" num="0152">(Third Embodiment)</p>
<p id="p-0154" num="0153">An information processing apparatus according to a third embodiment will be described with an example of a PC. In this PC, a method of selecting target image blocks is different from that of the PC <b>100</b> according to the first embodiment described above.</p>
<p id="p-0155" num="0154">In the PC <b>100</b> of the first embodiment, in Step <b>205</b> shown in <figref idref="DRAWINGS">FIG. 4</figref>, a predetermined number of template image blocks having a standard deviation value equal to or larger than a predetermined threshold value is selected as a computation candidate block group. Then, those template image blocks are sorted out in descending order of standard deviation values, and set in the order as target image blocks to be targets of the matching processing.</p>
<p id="p-0156" num="0155">In the PC according to this embodiment, as a computation candidate block group, a predetermined number of template image blocks having a standard deviation value equal to or larger than a predetermined threshold value is selected as follows. First, a first template image block is selected. Next, on an overlap image of the template image, a second template image that is separate from the first template image block by a predetermined distance (pixel) or more is selected.</p>
<p id="p-0157" num="0156">In other words, in this embodiment, as a computation candidate block group, the first and second template image blocks that are separated from each other by a predetermined distance or more on the overlap image are selected. For example, a plurality of template image blocks including at least a set of template image blocks separated from each other by a predetermined distance or more may be selected as a computation candidate block group. Alternatively, a plurality of template image blocks including two arbitrary template image blocks separated from each other by a predetermined distance or more may be selected as a computation candidate block group.</p>
<p id="p-0158" num="0157">From the computation candidate block group thus selected, target image blocks are set in descending order of standard deviation values. Accordingly, on the overlap image of the template image, a single result map is generated without positional displacement. As a result, based on the generated single result map, a final offset value can be calculated accurately.</p>
<p id="p-0159" num="0158">The stitching processing performed by the information processing apparatus according to the embodiments described above is used in a system that digitizes an image of a cell, a tissue, an organ, or the like of a living body, which is captured by an optical microscope, for example, in the field of medicine or pathology, to examine the tissue or the like by a doctor or a pathologist or diagnose a patient based on the digitized image, or other systems. However, it is confirmed that the stitching processing is also applicable to many materials other than the cell, the tissue, the organ, or the like of the living body, and accordingly the stitching processing is also applicable to other fields in addition to the field of medicine or the like. In addition, the stitching processing in the embodiments described above is also applicable to other digital images, without being limited to the images captured by the optical microscope.</p>
<p id="p-0160" num="0159">(Other Embodiments)</p>
<p id="p-0161" num="0160">Embodiments according to the present application are not limited to the embodiments described above, and other various embodiments may be possible.</p>
<p id="p-0162" num="0161">In the embodiments described above, the PC is exemplified as the information processing apparatus. However, a scanner apparatus having a function of an optical microscope may be used as an information processing apparatus according to this embodiment, and the stitching processing may be performed with the scanner apparatus or the like.</p>
<p id="p-0163" num="0162">As shown in <figref idref="DRAWINGS">FIG. 5</figref>, in the first embodiment described above, a setting is made such that the offset value is set to (0,0) and the template image block <b>7</b> is positioned at the center of the source image block <b>4</b> when the overlap images A and B are superimposed on each other. However, a relative positional relationship at this time between the source image block <b>4</b> and the template image block <b>7</b> can be set as appropriate. For example, in a case where a setting is made such that the template image block <b>7</b> is positioned at the upper left corner of the source image block <b>4</b>, a position R(x,y) and an image block offset value (x,y) of the single result map shown in <figref idref="DRAWINGS">FIG. 7</figref> are calculated as the same value, with the result that the processing time can be shortened.</p>
<p id="p-0164" num="0163">The size and shape of the source image block and the template image block may be set as appropriate. For example, the size of the source image block and that of the template image block may be identical to each other as long as a relationship between the image block offset value and the final offset value can be grasped.</p>
<p id="p-0165" num="0164">As shown in <figref idref="DRAWINGS">FIG. 6</figref>, in the first embodiment described above, in order to select an optimum target image block for the matching processing, a standard deviation value of luminance values for each template image block is calculated. However, an indicator for selecting an optimum target image block for the matching processing is not limited to the standard deviation value. For example, a target image block may be selected based on an amount of high frequency components for each template image block. Alternatively, a target image block may be selected based on a difference between a maximum luminance value and a minimum luminance value of a template image block, that is, the magnitude of a dynamic range. In addition, a target image block may be selected based on various types of information relating to contrast of luminance values.</p>
<p id="p-0166" num="0165">As shown in <figref idref="DRAWINGS">FIG. 12</figref>, the subject <b>11</b> is photographed separately in the nine partial images <b>12</b>, and a statistical value is calculated based on a final offset value calculated when the partial images <b>12</b> are connected. Other embodiment in which such a statistical value is used will be described.</p>
<p id="p-0167" num="0166">For example, it is assumed that an image of an observation target object that is captured by an optical microscope is photographed by a digital system, and the digital image is subjected to stitching processing by the information processing apparatus according to the embodiments described above. A light source or an optical system of the optical microscope can be managed, and a constant photographing condition can be maintained in a chronological order or on a space. Therefore, if a statistical value in the past stitching processing is calculated for each predetermined photographing condition, the statistical value can be used when different observation target objects are photographed under the same photographing condition, and images thereof are subjected to the stitching processing.</p>
<p id="p-0168" num="0167">It should be understood that various changes and modifications to the presently preferred embodiments described herein will be apparent to those skilled in the art. Such changes and modifications can be made without departing from the spirit and scope and without diminishing its intended advantages. It is therefore intended that such changes and modifications be covered by the appended claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001" nb-file="US08625928-20140107-M00001.NB">
<img id="EMI-M00001" he="18.37mm" wi="76.20mm" file="US08625928-20140107-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002" nb-file="US08625928-20140107-M00002.NB">
<img id="EMI-M00002" he="11.68mm" wi="76.20mm" file="US08625928-20140107-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00003" nb-file="US08625928-20140107-M00003.NB">
<img id="EMI-M00003" he="11.68mm" wi="76.20mm" file="US08625928-20140107-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>The application is claimed as follows:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. An information processing apparatus, comprising:
<claim-text>a generation means for generating a plurality of source image blocks obtained by dividing a connection area of a source image into a plurality of areas, and a plurality of template image blocks obtained by dividing a connection area of a template image into a plurality of areas, the connection area of the template image being superimposed on the connection area of the source image;</claim-text>
<claim-text>a selection means for selecting a plurality of target image blocks as targets individually subjected to matching processing, based on luminance information of each of the template image blocks generated by the generation means;</claim-text>
<claim-text>a matching processing means for calculating, by performing the matching processing on corresponding image blocks as images corresponding to the plurality of target image blocks selected by the selection means, in the plurality of source image blocks generated by the generation means, and the plurality of target image blocks, relative position information of the corresponding image blocks and the target image blocks; and</claim-text>
<claim-text>a calculation means for calculating relative position shift information of the connection area of the source image and the connection area of the template image, based on the relative position information calculated by the matching processing means, wherein</claim-text>
<claim-text>the generation means generates the plurality of template image blocks that correspond to the plurality of source image blocks and have a smaller size than that of the plurality of source image blocks,</claim-text>
<claim-text>the matching processing means generates a correlation coefficient that is based on luminance information of each of the corresponding image blocks and luminance information of each of the target image blocks in accordance with a position of each of the target image blocks within each of the corresponding image blocks, to thereby perform the matching processing, and calculates the generated correlation coefficient as the relative position information, and</claim-text>
<claim-text>the calculation means calculates the relative position shift information by cumulatively adding the correlation coefficients of the target image blocks, the correlation coefficients being calculated by the matching processing means.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The information processing apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein
<claim-text>the calculation means generates tentative position shift information by cumulatively adding the correlation coefficients of the target image blocks, and calculates, when the tentative position shift information included in a tolerance set in advance is generated continuously by a predetermined number of times, the tentative position shift information included in the tolerance as the relative position shift information.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The information processing apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein
<claim-text>the selection means calculates a standard deviation value of luminance values for each of the template image blocks, and selects the template image blocks having the standard deviation value equal to or larger than a predetermined threshold value, as the target image blocks.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The information processing apparatus according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein
<claim-text>the selection means gives a first priority order to the template image block having a first standard deviation value, the first priority order representing a priority for which the matching processing is performed by the matching processing means, gives a second priority order to the template image block having the standard deviation value smaller than the first standard deviation value, the second priority order having the priority lower than the first priority order, and selects the template image block to which the first priority order is given and the template image block to which the second priority order is given, as the target image blocks.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The information processing apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein
<claim-text>the selection means selects a first template image block and a second template image block that is separated from the first template image block by a predetermined distance or more in the connection area of the template image, as the target image blocks.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. An information processing method executed by an information processing apparatus, comprising the steps of:
<claim-text>generating, by the information processing apparatus, a plurality of source image blocks obtained by dividing a connection area of a source image into a plurality of areas, and a plurality of template image blocks obtained by dividing a connection area of a template image into a plurality of areas, the connection area of the template image being superimposed on the connection area of the source image, wherein the plurality of template image blocks that correspond to the plurality of source image blocks have a smaller size than that of the plurality of source image blocks;</claim-text>
<claim-text>selecting, by the information processing apparatus, a plurality of target image blocks as targets individually subjected to matching processing, based on luminance information of each of the generated template image blocks;</claim-text>
<claim-text>calculating, by the information processing apparatus, by performing the matching processing on corresponding image blocks as images corresponding to the selected target image blocks, in the generated source image blocks, and the plurality of target image blocks, relative position information of the corresponding image blocks and the target image blocks; and</claim-text>
<claim-text>calculating, by the information processing apparatus, relative position shift information of the connection area of the source image and the connection area of the template image, based on the calculated relative position information, wherein a correlation coefficient is generated that is based on luminance information of each of the corresponding image blocks and luminance information of each of the target image blocks in accordance with a position of each of the target image blocks within each of the corresponding image blocks, to thereby perform the matching processing, wherein the generated correlation coefficient is calculated as the relative position information, and wherein the relative position shift information is calculated by cumulatively adding the correlation coefficients of the target image blocks, the correlation coefficients being calculated by matching processing.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. A non-transitory computer readable medium storing a program causing an information processing apparatus to execute:
<claim-text>generating a plurality of source image blocks obtained by dividing a connection area of a source image into a plurality of areas, and a plurality of template image blocks obtained by dividing a connection area of a template image into a plurality of areas, the connection area of the template image being superimposed on the connection area of the source image, wherein the plurality of template image blocks that correspond to the plurality of source image blocks have a smaller size than that of the plurality of source image blocks;</claim-text>
<claim-text>selecting a plurality of target image blocks as targets individually subjected to matching processing, based on luminance information of each of the generated template image blocks;</claim-text>
<claim-text>calculating, by performing the matching processing on corresponding image blocks as images corresponding to the selected target image blocks, in the generated source image blocks, and the plurality of target image blocks, relative position information of the corresponding image blocks and the target image blocks; and</claim-text>
<claim-text>calculating relative position shift information of the connection area of the source image and the connection area of the template image, based on the calculated relative position information, wherein a correlation coefficient is generated that is based on luminance information of each of the corresponding image blocks and luminance information of each of the target image blocks in accordance with a position of each of the target image blocks within each of the corresponding image blocks, to thereby perform the matching processing, wherein the generated correlation coefficient is calculated as the relative position information, and wherein the relative position shift information is calculated by cumulatively adding the correlation coefficients of the target image blocks, the correlation coefficients being calculated by matching processing. </claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
