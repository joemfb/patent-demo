<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08624923-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08624923</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>13547184</doc-number>
<date>20120712</date>
</document-id>
</application-reference>
<us-application-series-code>13</us-application-series-code>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>09</class>
<subclass>G</subclass>
<main-group>5</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>345629</main-classification>
<further-classification>382271</further-classification>
<further-classification>382275</further-classification>
</classification-national>
<invention-title id="d2e43">Method of forming an image based on a plurality of image frames, image processing system and digital camera</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5033103</doc-number>
<kind>A</kind>
<name>Sillart</name>
<date>19910700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382275</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5345262</doc-number>
<kind>A</kind>
<name>Yee et al.</name>
<date>19940900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>348745</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6009206</doc-number>
<kind>A</kind>
<name>Acharya</name>
<date>19991200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382271</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>2008/0024683</doc-number>
<kind>A1</kind>
<name>Damera-Venkata et al.</name>
<date>20080100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>348744</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2008/0165258</doc-number>
<kind>A1</kind>
<name>Wajs</name>
<date>20080700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>3482221</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2009/0220172</doc-number>
<kind>A1</kind>
<name>Wajs</name>
<date>20090900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>382284</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2011/0228139</doc-number>
<kind>A1</kind>
<name>Wajs</name>
<date>20110900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>348239</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>EP</country>
<doc-number>1 154 633</doc-number>
<kind>A1</kind>
<date>20011100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00009">
<othercit>O. Ratib, &#x201c;PFT/CT Image Navigation and Communication&#x201d;, Journal of Nuclear Medicine Soc, Nucl. Med. USA, vol. 45, No. 1, Jan. 2004, pp. 46S-55S, XP008065310.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00010">
<othercit>J. Boyce, &#x201c;Noise Reduction of Image Sequences Using Adaptive Motion Compensated Frame Averaging&#x201d;, Institute of Electrical and Electronics Engineers, vol. 5, Conf. 17, Mar. 23, 1992, pp. 461-464, XP008065310.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00011">
<othercit>M.E. Winter et al., &#x201c;Resolution Enhancement of Hyperspectral Data&#x201d;, Aerospace Conference Proceedings, 2002, IEEE vol. 3, Mar. 9-16, 2002, pp. 1523-1529, XP010604287.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00012">
<othercit>Li Ling et al., &#x201c;Fusion of Images with Different Spatial Resolution&#x201d;, Geosicence and Remote Sensing Symposium Preceedings, 1998, vol. 3, Jul. 6, 1998, pp. 1310-1313, XP010292937.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00013">
<othercit>B. K. Gunturk et al., &#x201c;Multi-Frame Information Fusion for Gray-Scale and Spatial Enhancement of Images&#x201d;, Proceedings 2003 International Conference on Image Processing, vol. 3, 2003, pp. ll 319-ll 322, XP002385719.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>8</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>345629</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>348744</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>348745</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>382271</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>382275</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>5</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>12089997</doc-number>
</document-id>
<parent-status>ABANDONED</parent-status>
<parent-pct-document>
<document-id>
<country>WO</country>
<doc-number>PCT/EP2005/055186</doc-number>
<date>20051012</date>
</document-id>
</parent-pct-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>13547184</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20120274814</doc-number>
<kind>A1</kind>
<date>20121101</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Wajs</last-name>
<first-name>Andrew Augustine</first-name>
<address>
<city>Haarlem</city>
<country>NL</country>
</address>
</addressbook>
<residence>
<country>NL</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Wajs</last-name>
<first-name>Andrew Augustine</first-name>
<address>
<city>Haarlem</city>
<country>NL</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Nixon Peabody LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
<agent sequence="02" rep-type="attorney">
<addressbook>
<last-name>Costellia</last-name>
<first-name>Jeffrey L.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Silvercrest Investment Holdings Limited</orgname>
<role>03</role>
<address>
<city>Tortola</city>
<country>VG</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Harrison</last-name>
<first-name>Chante</first-name>
<department>2679</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Image fusion based on a modified method of frame averaging for noise removal by partly averaging over images having a smaller resolution than the desired resolution of the de-noised image. The set of images which are summed for averaging out noise consists of two subsets. The first set of images has a resolution (in terms of number of pixels) being smaller than the resolution of the images in the second set. The resolution of the images in the second set is the resolution of the &#x2018;high-definition&#x2019; de-noised output image. The lower resolution images are up-sampled by scaling their pixel numbers to that desired output image. The gradation of the first set images is also adapted to avoid intensity saturation (flare) due to sommation. Image fusing is also done in fourier space using the high frequency components from the higher resolution images and the lower ones from the lower resolution images.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="175.09mm" wi="147.15mm" file="US08624923-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="101.52mm" wi="134.20mm" file="US08624923-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="179.41mm" wi="151.21mm" file="US08624923-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="193.72mm" wi="145.03mm" file="US08624923-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="186.69mm" wi="143.76mm" file="US08624923-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="194.14mm" wi="140.29mm" file="US08624923-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<p id="p-0002" num="0001">The invention relates to a method of forming a combined image based on a plurality of image frames.</p>
<heading id="h-0001" level="1">TECHNICAL FIELD</heading>
<p id="p-0003" num="0002">The invention also relates to a system for processing arrays of intensity values, each array being suitable for representing an image frame at a resolution corresponding to the number of intensity values in the array.</p>
<p id="p-0004" num="0003">The invention also relates to an imaging apparatus, e.g. a digital camera.</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0005" num="0004">International patent application PCT/EP2005/052121 was filed before and published under number WO/2006/119802A1 after the date of filing of the present application, and is thus comprised in the state of the art according to Art. 54(3) EPC only. It describes a method of forming a combined final image from a plurality of image frames, including the steps of obtaining a first and at least one further array of pixel values, each array of intensity values encoding light intensity levels a each of a respective number of pixel positions in the respective image frame, the number determining the spatial resolution of the image frame concerned. A set of derived arrays of intensity values is generated, each derived array being based on a respective one of the obtained arrays of intensity levels and encoding light intensity levels at each of a common number of pixel positions in at least a region of overlap of the respective image frames. An array of combined intensity values is generated. Each element in that array is based on a sum of intensity values represented by a corresponding element in each of the respective derived arrays of intensity values. An array of intensity values encoding the combined final image is provided, the array being based on the array of combined intensity values. A first array of intensity values encoding at least the region of overlap at a higher resolution than the further arrays of intensity values is obtained. An array of intensity values encoding at least the region of overlap in the combined final image at a higher spatial resolution than the further arrays of intensity values is provided. The array of intensity values encoding the combined final image is based on a sufficient number of intensity values in the first array of intensity values to encode the region of overlap at a higher resolution than the further arrays of intensity values.</p>
<p id="p-0006" num="0005">Forming a combined image by adding a plurality of image frames at least partially depicting the same region has the effect that the region of overlap has a higher Signal-to-Noise Ratio (SNR) in the combined image than in the individual image frames. However, in an image processing system, intensity values assume one of a range of discrete values, the number of which is determined by the number of bits by which the values are represented. This in turn is determined by the dynamic range allowed by the format in which the combined image is displayed, e.g. the JPEG standard or the resolution of a computer display. If the sum of the intensity values corresponding to a pixel in the respective image frames exceeds the maximum allowed by the range of discrete values, the sum value is clipped to stay within the range. If this happens for many intensity values in the array of intensity values representing the combined image, the combined image appears over-exposed.</p>
<p id="p-0007" num="0006">It is an object of the invention to provide a method, system, imaging apparatus and computer program of the types indicated above, for providing in an efficient manner a combined image that has a relatively good SNR and little or no over-exposure.</p>
<p id="p-0008" num="0007">This object is achieved according to the invention by providing a method of forming a combined image based on a plurality of image frames, including:</p>
<p id="p-0009" num="0008">obtaining a first set of at least one array of intensity values for representing an image frame at a resolution corresponding to the number of intensity values in the array, and</p>
<p id="p-0010" num="0009">obtaining a second set of at least one array of intensity values for representing an image frame at a resolution corresponding to the number of intensity values in the array,</p>
<p id="p-0011" num="0010">wherein the combined image is represented by a final array of intensity values,</p>
<p id="p-0012" num="0011">wherein at least some of the intensity values in the final array are each obtained by executing a step of summing an intensity value from each of at least one array of intensity values based on at least one array of intensity values in only the first set and an intensity value from each of at least one array of intensity values based on at least one array of intensity values in only the second set, wherein, prior to executing the summing step, only the intensity values of the arrays in the first set are mapped from a scale within a first range to a scale within a second range.</p>
<p id="p-0013" num="0012">Because at least some of the intensity values in the final array are each obtained by executing a step of summing an intensity value from each of at least one array of intensity values based on at least two arrays of intensity values, the SNR is improved. Because the intensity values of the arrays in the first set are mapped from a scale within a first range to a scale within a second range prior to executing the summing step, it is possible to use the full dynamic range allowed by the representation of the intensity values without going beyond the end of the scale on which they are represented. For this purpose, the second range is different from the first range. Because only the intensity values of the arrays in the first set are mapped, the method is relatively efficient.</p>
<p id="p-0014" num="0013">An embodiment of the invention includes obtaining a first set and a second set arranged such that the image frames represented by the arrays in the first set are represented at lower resolutions than the image frames represented by the arrays in the second set</p>
<p id="p-0015" num="0014">This has the effect of increased efficiency, as relatively few intensity values are mapped from the scale within the first range to the scale within the second range.</p>
<p id="p-0016" num="0015">In an embodiment, the at least one array of intensity values based on at least one array of intensity values in only the first set contains coefficients in the spatial frequency domain, the at least one array of intensity values based on at least one array of intensity values in only the second set contains coefficients in the spatial frequency domain and the intensity values in the final array are formed by coefficients in the spatial frequency domain,</p>
<p id="p-0017" num="0016">wherein at least one lower-order coefficient in the final array is obtained by summing an intensity value from each of the at least one array of intensity values based on at least one array of intensity values in only the first set and an intensity value from each of at least one array of intensity values based on at least one array of intensity values in only the second set,
<br/>
wherein at least one higher-order coefficient in the final array is obtained on the basis of only arrays of intensity values based on the second set.
</p>
<p id="p-0018" num="0017">This is a relatively efficient way of obtaining a combined image represented at a relatively high resolution on the basis of a first set of arrays representing image frames at a lower resolution and a second set of arrays representing image frames at a higher resolution. Interpolation or similar techniques to increase the resolution of the image frames represented by the arrays of the first set is not required. Instead, the information in the higher resolution image frames represented by the second set is used to generate a relatively high-resolution combined image, whereas summation of the lower-order coefficients serves to decrease the perceptible noise in the image.</p>
<p id="p-0019" num="0018">In an embodiment, at least some of the arrays of intensity values in the first and second set are obtained by reading out measurement values from an image-capturing device comprising an array of light-sensitive cells, wherein each intensity value in the final array is based on at least one intensity value in an array comprised in the second set.</p>
<p id="p-0020" num="0019">Because the arrays in the first set represent image frames at a lower resolution they contain fewer intensity values. Thus, the time to read out the measurement values is reduced. This allows the image frames represented by the first and second sets of arrays to be read out in quick succession, decreasing the effect of camera shake or movement in the scene that is captured. Because each intensity value in the final array is based on at least one intensity value in an array comprised in the second set, the effect of decreased blur due to movement is not obtained at the expense of the resolution of the combined image.</p>
<p id="p-0021" num="0020">An embodiment includes determining an upper limit of the second range at least partly in dependence on the number of arrays of intensity values in the second set.</p>
<p id="p-0022" num="0021">Thus, the risk of an over-exposed combined image is reduced.</p>
<p id="p-0023" num="0022">In an embodiment, at least one of the arrays of intensity values in the first set is obtained by obtaining a plurality of arrays of intensity values for representing an image frame at a resolution corresponding to the number of intensity values in the array, and by summing an intensity value from each of the plurality of arrays to obtain a corresponding intensity value in the at least one array in the first set.</p>
<p id="p-0024" num="0023">Thus, an array representing an image that is the sum of a plurality of image frames is scaled. This has the effect of decreasing the amount of scaling that has to be done, making the method more efficient. In addition, random noise over the plurality of arrays that are summed to form an array in the first set is filtered out by means of the addition.</p>
<p id="p-0025" num="0024">In an embodiment, at least one of the arrays of intensity values in the first set is obtained by obtaining a plurality of arrays of intensity values for representing an image frame at a resolution corresponding to the number of intensity values in the array, wherein the method further includes</p>
<p id="h-0003" num="0000">summing an intensity value from each of the obtained plurality of arrays to obtain a corresponding intensity value in an intermediate combined array, and</p>
<p id="h-0004" num="0000">determining an upper limit of the second range at least partly in dependence on at least one intensity value in the intermediate combined array.</p>
<p id="p-0026" num="0025">Thus, the appropriate extent of the second range can be determined relatively accurately, since it is based on an array of intensity values that is quite representative of the final array. This embodiment is also relatively efficient, since it does not require an analysis of each of a plurality of arrays in the first set.</p>
<p id="p-0027" num="0026">In an embodiment, at least the arrays of intensity values in the first set are obtained by obtaining a plurality of arrays of intensity values for representing colour image frames in a first colour space, and applying a transformation to a plurality of arrays of values in a second colour space, wherein, in the first colour space, an image frame is represented by parameter value combinations, each parameter indicating the intensity of one of a plurality of colour components, whereas, in the second colour space, an image frame is represented by parameter value combinations, one parameter of the combination indicating a hue and at least one of the other parameters being indicative of light intensity.</p>
<p id="p-0028" num="0027">This embodiment has the advantage that the mapping from the first scale to the second scale need be carried out on fewer arrays of intensity values. Instead of separate arrays of intensity values for each colour component, or arrays of intensity value combinations, only the array or arrays of parameter values indicative of light intensity in the second colour space, or arrays derived based thereon, need be processed. The colour information is contained in an array of parameter values indicating hues, which need not be scaled to prevent saturation of the combined image.</p>
<p id="p-0029" num="0028">According to another aspect, there is provided in accordance with the invention a system for processing arrays of intensity values, each array being suitable for representing an image frame at a resolution corresponding to the number of intensity values in the array,</p>
<p id="p-0030" num="0029">wherein the system is configured to retrieve a first set of at least one array of intensity values and a second set of at least one array of intensity values, the arrays in the first set and arrays in the second set representing respective image frames, and to form a final array of intensity values representing a combined image,</p>
<p id="p-0031" num="0030">wherein the system is configured to obtain each of at least some of the intensity values in the final array by executing a step of summing an intensity value from each of at least one array of intensity values based on at least one array of intensity values in only the first set and an intensity value from each of at least one array of intensity values based on at least one array of intensity values in only the second set, and</p>
<p id="p-0032" num="0031">wherein the system is configured to map, prior to executing the summing step, only the intensity values of the arrays in the first set from a scale within a first range to a scale within a second range.</p>
<p id="p-0033" num="0032">According to another aspect, there is provided in accordance with the invention an imaging apparatus, e.g. a digital camera, comprising a processor and at least one storage device for storing a plurality of arrays of intensity values, wherein the imaging apparatus is configured to execute a method according to the invention.</p>
<p id="p-0034" num="0033">The imaging apparatus makes relatively efficient use of digital signal processing capacity. In particular, because not all arrays of pixel values are scaled, the amount of values to be retrieved from a look-up table implementing the mapping function is relatively low.</p>
<p id="p-0035" num="0034">According to another aspect of the invention, there is provided a computer program, including a set of instructions capable, when incorporated in a machine-readable medium, of causing a system having information processing capabilities to perform a method according the invention.</p>
<p id="p-0036" num="0035">The computer program can be run on a general-purpose computer for post-processing of captured images, or it can be provided in the form of firmware for an image-capturing device such as a digital camera.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0037" num="0036">The invention will be explained in further detail with reference to the accompanying drawings, in which</p>
<p id="p-0038" num="0037"><figref idref="DRAWINGS">FIG. 1</figref> illustrates schematically a digital camera equipped to implement a method of forming a combined image;</p>
<p id="p-0039" num="0038"><figref idref="DRAWINGS">FIG. 2</figref> illustrates schematically a first embodiment of a method of forming a combined image;</p>
<p id="p-0040" num="0039"><figref idref="DRAWINGS">FIG. 3</figref> illustrates schematically a second embodiment of a method of forming a combined image;</p>
<p id="p-0041" num="0040"><figref idref="DRAWINGS">FIG. 4</figref> illustrates schematically a third embodiment of a method of forming a combined image; and</p>
<p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. 5</figref> illustrates schematically a fourth embodiment of a method of forming a combined image.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0006" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0043" num="0042"><figref idref="DRAWINGS">FIG. 1</figref> illustrates some components of a digital camera <b>1</b> as an example of an imaging apparatus adapted for implementing the methods described below. Other examples of suitable imaging apparatus include scanners and photocopying apparatus. Because the methods of forming a combined image require relatively little processing capacity, it is advantageous to apply them in the digital camera <b>1</b>.</p>
<p id="p-0044" num="0043">The digital camera <b>1</b> includes a lens system <b>2</b> for focussing on one or more objects in a scene that is to be represented by a combined image. When a shutter <b>3</b> is opened, the scene is projected through an aperture in a diaphragm <b>4</b> onto a photosensitive area of an image-capturing device <b>5</b>. Instead of the shutter <b>3</b>, an electronic shutter implemented by suitable control of the image-capturing device <b>5</b> could be used. The shutter time is controllable, as is the diameter of the aperture. The image-capturing device <b>5</b> can be a device implemented in Complementary Metal-Oxide Semiconductor (CMOS) technology, or a Charge-Coupled Device (CCD) sensor, for example. The photosensitive area of the image-capturing device <b>5</b> is divided into areas occupied by pixel cells. Each pixel cell includes a device for generating a signal indicative of the intensity of light to which the area that the pixel cell occupies is exposed. An integral of the signal generated by a device is formed during exposure, for example by accumulation of photocurrent in a capacitor. Subsequent to exposure for the duration of an exposure time interval, the values of the integrals of the generated signals are read out row by row.</p>
<p id="p-0045" num="0044">The (analogue) values that are read out are provided to an Analogue-to-Digital (A/D-)converter <b>6</b>. The A/D converter samples and quantises the signals received from the image-capturing device <b>5</b>. This involves recording the intensity values on a scale with discrete levels, the number of which is determined by the number of bits of resolution of the digital words provided as output by the A/D converter <b>6</b>. Thus, the A/D-converter <b>6</b> provides as output an array of intensity values recorded on a scale occupying a first range. Each intensity value is associated with a particular pixel position in an image frame, corresponding to a photosensitive cell or a plurality of adjacent photosensitive cells. In the latter case, the values read out from the image-capturing device <b>5</b> are preferably obtained by &#x201c;binning&#x201d; the values corresponding to a plurality of adjacent photosensitive cells. The areas to which the &#x201c;binned&#x201d; values correspond may overlap.</p>
<p id="p-0046" num="0045">Each exposure of the image-capturing device <b>5</b> thus results in an array of intensity values representing an image frame. As will be explained in more detail below, the intensity values of one or more arrays may be mapped to a different scale occupying a second range by a Digital Signal Processor (DSP) <b>7</b>. In certain embodiments, the DSP <b>7</b> is also suitable for performing such operations as interpolation between pixel values and optionally compression of the image. It may also carry out a transformation of the intensity values to the spatial frequency domain, such as a Direct Cosine Transform (DCT).</p>
<p id="p-0047" num="0046">Arrays of intensity values are stored in a storage device <b>8</b>. The storage device can be any usual type of storage device, e.g. built-in flash memory, replaceable flash memory modules, an optical disk drive or a magnetic disk drive.</p>
<p id="p-0048" num="0047">Capturing and processing of images is carried out under control of a microprocessor <b>9</b>, which issues commands over a bus <b>10</b>. The microprocessor <b>9</b> is assisted by a co-processor <b>11</b> in the illustrated embodiment. The co-processor <b>11</b> is preferably a digital signal processor for performing image compression, for example in accordance with the JPEG standard. The microprocessor <b>9</b> comprises a volatile memory and has access to instructions stored in Read-Only Memory (ROM) module <b>12</b>. The instructions provide the digital camera <b>1</b> with the capability to perform a method of forming a combined image by adding a plurality of captured image frames, which method is carried out under the control of the microprocessor <b>9</b>.</p>
<p id="p-0049" num="0048">Other components connected to the bus <b>10</b> include an input interface module <b>13</b> for receiving user commands, and an output interface module <b>14</b> for returning status information. In the illustrated embodiment, a motion sensor <b>15</b> is present for sensing and measuring movement of the digital camera <b>1</b>. In other embodiments, a series of image frames captured in rapid succession is analysed to determine the amount and/or direction of movement of the digital camera <b>1</b>. In addition, the digital camera <b>1</b> comprises an exposure metering device <b>16</b> and a flash driver <b>17</b> for directing the operation of a flash (not shown).</p>
<p id="p-0050" num="0049">In use, a user issues a command to form a single image of a scene, which is passed on to the microprocessor <b>9</b> through the input interface module <b>13</b> and the bus <b>10</b>. In response, the microprocessor <b>9</b> controls the digital camera <b>1</b> such that a plurality of underexposed image frames or image frames with a high ISO setting are captured. A high ISO setting means that the sensitivity of the image-capturing device <b>5</b>, calibrated along the linear film speed scale according to international standard ISO 5800:1987 is set to a high level. The captured images represent respective scenes that overlap at least partially. Each image frame, specifically each colour component of an image frame, is represented by an array of pixel values. Each pixel value corresponds to the light intensity of the associated colour component over an area associated with a pixel. Given that each area associated with a pixel corresponds to a part of the area of the image-capturing device <b>5</b>, which is constant, the number of intensity values contained in an array corresponds to the spatial resolution of the image frame. This is also the case where the intensity values are coefficients in the spatial frequency domain, since the inclusion of more values in an array corresponds to the presence of coefficients of a higher order.</p>
<p id="p-0051" num="0050">To obtain the sequence of individually underexposed image frames, the microprocessor <b>9</b> determines a desired exposure for a final image to be formed on the basis of the image frames. This exposure is divided over the image frames. The desired exposure can be determined from user input or automatically on the basis of one or more values obtained from the exposure metering device <b>16</b>. Exposure levels for each of the image frames result in settings of the diaphragm <b>4</b>, shutter speed and flash intensity. In addition, the microprocessor <b>9</b> determines amplification levels for the signals read out from the image-capturing device. These determine the range of values within which the intensity values in the arrays representing the image frames lie. The number of bits with which the intensity values are represented determines the dynamic range of the intensity values. In the example, it will be assumed that the intensity values are represented in eight bits, so that there are 255 possible non-zero values. Instead of underexposing the image frames, the linear-scale ISO setting (also known as ASA number) of the image-capturing device <b>5</b> can be increased by the same factor as the underexposure factor. This results in increased noise levels in the individual frames, which are reduced through the combination processes presented below.</p>
<p id="p-0052" num="0051">In the embodiments described herein, a distinction is made between a first set of arrays of intensity values representing associated respective image frames and a second set of arrays of intensity values representing associated respective image frames. The distinction is made on the basis of how the arrays are processed subsequent to capturing of the image frames.</p>
<p id="p-0053" num="0052">In a first embodiment, depicted in <figref idref="DRAWINGS">FIG. 2</figref>, a first set <b>18</b> of arrays of intensity values represents image frames at a relatively low spatial resolution, whereas a second set <b>19</b> of arrays of intensity values represents image frames at a relatively high resolution. Since the spatial resolution is proportional to the number of intensity values in the arrays, it follows that the arrays in the first set contain fewer values than those in the second set <b>19</b>. This reduces the processing requirements, which is advantageous, as will become clear.</p>
<p id="p-0054" num="0053">It is noted that the amount of processing is already reduced merely by the division of a sequence of arrays into the first set <b>18</b> and second set <b>19</b>, so that the fact that the first set represents image frames at a lower resolution than the second set is an advantageous, but optional feature. Furthermore, it is not required, but efficient in terms of processing, that the arrays that share a set all have the same number of elements, i.e. that the image frames they represent each have the same resolution. In the illustrated embodiment, a final array <b>20</b> of intensity values representing a combined image is formed on the basis of the arrays in the first and second set <b>18</b>,<b>19</b> only. In other embodiments, there may be a third set of arrays representing image frames in the sequence of successively captured image frames on which the combined image is based.</p>
<p id="p-0055" num="0054">An object of the method illustrated in <figref idref="DRAWINGS">FIG. 2</figref> is to scale the intensity values in the arrays of the first set <b>18</b> such that the final array <b>20</b> contains intensity values that occupy the full dynamic range. The method serves to prevent a situation in which all the intensity values in the final array are clipped at the highest of the 255 values afforded by an eight-bit representation.</p>
<p id="p-0056" num="0055">In a first step <b>21</b>, one or more arrays of intensity values in the first set <b>18</b> of arrays are at least partially analysed. In one embodiment, the analysis comprises the forming of a histogram of some or all of the intensity values. To reduce the processing effort required to generate a histogram, only one value in every block of sixty-four values could be used.</p>
<p id="p-0057" num="0056">If a significant number of intensity values lies above a threshold value, then a mapping function is required, which mapping function is determined in a second step <b>22</b>. The second step <b>22</b> is followed by a step <b>23</b> in which a look-up table <b>24</b> is generated on the basis of the mapping function. For each of 255 intensity values, a scaled value is entered into the look-up table <b>24</b>. Using a look-up table allows the mapping to be carried out by the DSP <b>7</b>, which is relatively efficient. Thus, the use of a look-up table makes the methods presented herein quite suitable for implementation in an imaging apparatus, such as the digital camera <b>1</b>.</p>
<p id="p-0058" num="0057">Only the arrays of intensity values in the first set <b>18</b> are mapped (step <b>25</b>) to arrays of scaled intensity values in a set <b>26</b>. Each intensity value is used as an index into the look-up table <b>24</b> to determine its scaled value. It will be appreciated that, by scaling only the intensity values in the arrays forming the first set <b>18</b>, a smaller look-up table is required. Moreover, the number of look-up operations is much reduced. As will be seen, the final array <b>20</b> can still represent a combined image at a higher resolution, because each intensity value in the final array is based on at least one intensity value in an array comprised in the second set <b>19</b>. It is noted that the mapping function is applied directly to the arrays of intensity values in the first set <b>18</b> in other embodiments, so that the look-up table <b>24</b> is dispensed with.</p>
<p id="p-0059" num="0058">The mapping function used to populate the look-up table <b>24</b> maps the intensity values from a first scale within a first range to a second scale occupying a second, smaller range. In one embodiment, the upper limit of the second scale is determined on the basis of at least two factors. A first factor is the extent to which the intensity values of the arrays analysed in the first step <b>21</b> exceed a certain threshold value. The second factor is based on the number of arrays of intensity values in the second set <b>19</b>. More specifically, the threshold value is the maximum value of the dynamic range for encoding the values in the final array <b>20</b>, divided by the number of arrays in the first and second sets <b>18</b>,<b>19</b>. The mapping function is chosen to ensure that a substantial proportion of the intensity values in each of the arrays of the set <b>26</b> of arrays of scaled intensity values remain below the threshold. The second factor in this example is based on the ratio of the number of arrays in the second set <b>19</b> to the number of arrays in the first set <b>18</b>. The upper value of the second scale is obtained by reducing the threshold by an amount corresponding to this ratio. Thus, the fact that, only the arrays in the first set <b>18</b> of the first and second sets <b>18</b>,<b>19</b> are scaled is taken into account.</p>
<p id="p-0060" num="0059">In an embodiment that is more efficient in its implementation, a fixed curve or look-up table is used to determine the scaling in dependence only on the number of arrays of intensity values in the first and second sets <b>18</b>,<b>19</b>. Alternatively, a mapping function could be selected in dependence on the degree of overexposure or, equivalently, the factor by which the sensitivity of the image-capturing device <b>5</b> used to capture the arrays of intensity values on which the arrays in the first and second sets <b>18</b>,<b>19</b> are respectively based has been increased.</p>
<p id="p-0061" num="0060">In an advantageous embodiment, the first step <b>21</b> is preceded by a step (not shown), in which the first and second sets <b>18</b>, <b>19</b> of arrays of intensity values are obtained by obtaining a plurality of arrays of intensity values for representing colour image frames in a first colour space, and applying a transformation to a plurality of arrays of values in a second colour space, wherein, in the first colour space, an image frame is represented by parameter value combinations, each parameter indicating the intensity of one of a plurality of colour components, whereas, in the second colour space, an image frame is represented by parameter value combinations, one parameter of the combination indicating a hue and at least one of the other parameters being indicative of light intensity. In the specific embodiment, arrays of intensity values representing image frames in the RGB (Red Green Blue) colour space are transformed to respective arrays of parameter values representing image frames in the HLS (Hue, Lightness, Saturation) colour space. The RGB colour space is an additive colour space, wherein the intensity of each of the three colour components is encoded separately. If the entire method depicted in <figref idref="DRAWINGS">FIG. 2</figref> is carried out in the RGB colour space, then the method would in essence have to be carried out in triplicate. The first and second steps <b>21</b>,<b>22</b> would involve analysis of the three arrays that belong together in the sense that they represent a colour component of the same image frame. At least the scaling step <b>25</b> involves scaling three arrays of intensity values per image frame. In the HLS colour space, an image is represented by the parameter combination Hue, indicating the relative strengths of three colour components, Saturation, providing a scale from a grey level to a full colour, and Lightness (also called Luminance) corresponding substantially to the average intensity of the colour components. Only the arrays of Lightness values in the first set <b>18</b> are scaled. It is noted that the HSV (Hue, Saturation, Value) colour space is usable as an alternative to the HSL colour space, and that the CMYK and YUV colour spaces are alternatives to the RGB colour space.</p>
<p id="p-0062" num="0061">As mentioned, each intensity value in the final array <b>20</b> is based on at least one intensity value in an array comprised in the second set <b>19</b> of arrays of intensity values.</p>
<p id="p-0063" num="0062">In the embodiment illustrated in <figref idref="DRAWINGS">FIG. 2</figref>, this is assured by summing corresponding pixel values of each of the arrays in the set <b>26</b> of arrays of scaled intensity values In order to obtain a high-resolution combined image, a set <b>27</b> of resolution-adjusted arrays is generated (step <b>28</b>). In this step <b>28</b>, the spatial resolution of the arrays in the set <b>26</b> of arrays of scaled intensity values is adjusted by a multiplication factor, and is increased. An alternative would be to decrease the resolution of the image frames represented by the arrays in the second set <b>19</b>. One way of increasing the spatial resolution of the image frames represented by the arrays in the set <b>26</b> of arrays of scaled intensity values is to interpolate between the intensity values in the arrays of scaled intensity values.</p>
<p id="p-0064" num="0063">The final array <b>20</b> is obtained by summing (step <b>29</b>) an intensity value from each of the arrays in the set <b>27</b> of resolution-adjusted arrays and value from each of the second set <b>19</b> of arrays. Intensity values corresponding to the same pixel in the scene represented by the image frames are added.</p>
<p id="p-0065" num="0064">To take account of camera shake, an additional step (not shown) is carried out to correct the image frames. The correction may be carried out prior to the first step <b>21</b> shown in <figref idref="DRAWINGS">FIG. 2</figref>, so that the arrays of the first and second set <b>18</b>,<b>19</b> are the result of the correction operation. In this case, each array in the first and second sets <b>18</b>,<b>19</b> is based on an array of intensity values obtained by the image-capturing device <b>5</b> and corrected in accordance with a motion vector. The motion vector describes the motion of the camera <b>1</b> between the points in time at which the arrays of intensity values were obtained by the image-capturing device. It is based on data obtained from the motion sensor <b>15</b> or based on an analysis of the captured image frames using a method described more fully in international patent application PCT/EP04/051080, which is hereby incorporated by reference. In that application, a method is described that includes calculating a motion vector representing at least a component indicative of relative movement of at least a part of successive image frames in a sequence of image frames, wherein the step of calculating the motion vector includes a step of determining at least a first term in a series expansion representing at least one element of the motion vector, which step includes an estimation process wherein at least the part in each of a plurality of the image frames is repositioned in accordance with the calculated motion vector. The estimation process includes calculation of a measure of energy contained in an upper range of the spatial frequency spectrum of the combined image and the step of determining at least the first term includes at least one further iteration of the estimation process to maximise the energy.</p>
<p id="p-0066" num="0065">In an alternative embodiment, the image frames are aligned using a method known per se by the name of Random Sample Consensus (RANSAC). This method is suitable where there is sufficient light to capture image frames.</p>
<p id="p-0067" num="0066"><figref idref="DRAWINGS">FIG. 3</figref> illustrates a variant of the method shown in <figref idref="DRAWINGS">FIG. 2</figref>. This embodiment is also based on a first set <b>30</b> of arrays of intensity values and a second set <b>31</b> of arrays of intensity values. Each intensity value is a pixel value, corresponding to the light intensity of an associated colour component over an area associated with a pixel. What has been stated above regarding the first and second set <b>18</b>,<b>19</b> shown in <figref idref="DRAWINGS">FIG. 2</figref> applies equally to the first and second set <b>30</b>,<b>31</b> shown in <figref idref="DRAWINGS">FIG. 3</figref>. Again, this description will assume that the arrays of intensity value in the first set <b>30</b> of arrays represent image frames at a lower resolution than the arrays in the second set <b>31</b>.</p>
<p id="p-0068" num="0067">A first step <b>32</b> in the method of <figref idref="DRAWINGS">FIG. 3</figref> corresponds to the first step <b>21</b> shown in <figref idref="DRAWINGS">FIG. 3</figref>. In a subsequent step <b>33</b>, a mapping function is again determined in order to map the intensity values of the arrays in the first set <b>30</b> from a scale occupying a first range to a second scale occupying a second range. The mapping function is determined on the basis of at least parts of some or all of the arrays in the first set <b>30</b>. It is determined in substantially the same way as in the embodiment of <figref idref="DRAWINGS">FIG. 2</figref>. Similarly, a look-up table <b>34</b> is created in a step <b>34</b> following the step <b>33</b> of determining the mapping function. The look-up table <b>34</b> is used (step <b>36</b>) to generate a set <b>37</b> of arrays of scaled intensity values, in which each array is based on a corresponding array in the first set <b>30</b> of arrays of intensity values.</p>
<p id="p-0069" num="0068">The variant of <figref idref="DRAWINGS">FIG. 3</figref> differs from the one shown in <figref idref="DRAWINGS">FIG. 2</figref>, in that a transformation to the spatial frequency domain is carried out in another step <b>38</b> subsequent to the scaling step <b>36</b>. This transformation step <b>38</b> is implemented using a Discrete Cosine Transform (DCT) in the illustrated example. The set <b>37</b> of arrays of scaled intensity values is the basis for a first set <b>39</b> of arrays of DCT coefficients. The second set <b>31</b> of arrays of intensity values is the basis for a second set <b>40</b> of arrays of DCT coefficients. It is observed that the DCT transform is part of the JPEG (Joint Photographic Experts Group) compression algorithm, and that it is advantageous to implement such an algorithm in a special-purpose processor, such as the DSP <b>7</b> or co-processor <b>11</b>. A transformation from the RGB colour space to the HLS colour space is also part of the JPEG algorithm, so that this feature is also applied to advantage in the embodiment illustrated in <figref idref="DRAWINGS">FIG. 3</figref>. The transformation between colour spaces has been detailed above.</p>
<p id="p-0070" num="0069">A summation step <b>41</b> is carried out in the spatial frequency domain to obtain a final array <b>42</b> of DCT coefficients. The final array <b>42</b> forms an array of intensity values representing a combined image, since each coefficient is indicative of the intensity level of a spatial frequency component, and the set of spatial frequency components contains all the information necessary to render the combined image. The low-frequency coefficients of the final array <b>42</b> are obtained by summing the low-frequency coefficients of each array in the first set <b>39</b> of arrays of DCT coefficients and the low-frequency coefficients of each array in the second set <b>40</b> of arrays of DCT coefficients. The high-frequency coefficients are obtained by summing the high-frequency coefficients of each array in the second set <b>40</b> of arrays of DCT coefficients. Since these higher-order coefficients are absent in the (smaller) arrays of the first set <b>39</b> of arrays of DCT coefficients, only some of the intensity values in the final array <b>42</b> of DCT coefficients are obtained on the basis of both the first and second set <b>30</b>,<b>31</b> of arrays of intensity values. The summation step <b>41</b> is preferably implemented so as to take account of the differing number of addends used to obtain each coefficient in the final array <b>42</b>.</p>
<p id="p-0071" num="0070">An Inverse Discrete Cosine Transformation (IDCT) <b>43</b> results in an array <b>44</b> of intensity values in the spatial domain. Both the transformation step <b>38</b> and the IDCT <b>43</b> are advantageously carried out by the co-processor <b>11</b> in the digital camera <b>1</b>.</p>
<p id="p-0072" num="0071"><figref idref="DRAWINGS">FIG. 4</figref> illustrates an embodiment for simplifying the determination of the mapping function from the first scale to the second scale, as well as simplifying the scaling step. It operates on the basis of a first set <b>45</b> of arrays of pixel values and a second set <b>46</b> of arrays of pixel values.</p>
<p id="p-0073" num="0072">A first sum array <b>47</b> is formed in a first step <b>48</b>. On the assumption that the arrays in the first set <b>45</b> represent respective image frames at the same resolution, each intensity value in the first sum array is obtained by summing the corresponding intensity values from each of the arrays in the first set <b>45</b>. If the resolutions are not the same, interpolation may be carried out first, or the arrays representing higher-resolution image frames may be reduced to correspond to a common resolution. The first sum array <b>47</b> is also suitable for representing an image frame, albeit one based on a plurality of preceding image frames, and forms a set of arrays consisting of one member. In alternative embodiments, a plurality of sum arrays could be formed, each based on a subset of arrays in the first set <b>45</b>, with the plurality of sum arrays forming a first set in the terminology used herein.</p>
<p id="p-0074" num="0073">The first sum array <b>47</b> of intensity values is analysed (step <b>49</b>) to determine a mapping function for mapping a first scale occupying a first range to a second scale occupying a second range. As described before, the analysis advantageously comprises the forming of a histogram of some or all of the intensity values, i.e. DCT coefficients. Again, this may be carried out using one value per block of intensity values within the first sum array. However, the embodiment of <figref idref="DRAWINGS">FIG. 4</figref>, because only the first sum array <b>47</b> is analysed, allows for a more involved analysis as compared to embodiments in which a number of arrays of intensity values have to be analysed.</p>
<p id="p-0075" num="0074">If a significant number of intensity values lies above a threshold value, then a mapping function is required. A look-up table <b>50</b> is generated (step <b>51</b>) on the basis of the mapping function. For each of, for example, 255 intensity values, a scaled value is entered into the look-up table <b>50</b>.</p>
<p id="p-0076" num="0075">Only the first sum array <b>47</b> of intensity values is mapped (step <b>52</b>) to a scaled first sum array <b>53</b>. Preferably, the arrays in the first set <b>45</b> of intensity values represent image frames at a lower resolution than the arrays in the second set <b>46</b> of arrays. Even if this is not the case, it is still feasible to generate a first sum array <b>47</b> representing a combined image frame at a lower resolution than that at which image frames are represented by the arrays in the second set <b>46</b> of arrays of intensity values. Thus, the number of look-up operations is kept relatively small.</p>
<p id="p-0077" num="0076">As before, the mapping function used to populate the look-up table <b>50</b> maps the intensity values from a first scale within a first range to a second scale occupying a second, smaller range. The upper limit of the second scale is again determined on the basis of at least two factors. A first facfor is the extent to which the intensity values of the first sum array <b>47</b> exceed a certain threshold value. The second factor is based on the number of arrays of intensity values in the second set <b>46</b>. More specifically, the threshold value is the maximum value of the dynamic range for encoding the values in the first sum array <b>47</b>. The mapping function is chosen to ensure that a substantial proportion of the intensity values in the scaled first sum array <b>53</b> remain below the threshold. The second factor in this example is based on the ratio of the number of arrays in the second set <b>46</b> to the number of arrays in the first set <b>45</b>. The upper value of the second scale is obtained by reducing the threshold by an amount corresponding to this ratio. Thus, the fact that, only the first sum array <b>47</b> is scaled, and not also the arrays in the second set <b>46</b> of arrays of intensity values, is taken into account.</p>
<p id="p-0078" num="0077">Scaling only the first sum array <b>47</b> reduces even further the number of look-up operations. Nevertheless, it would be possible to analyse the first sum array <b>47</b> to derive a mapping function for scaling the individual arrays in the first set <b>45</b> of arrays, which are then added after having been scaled. Alternatively, it would be possible to analyse the individual frames in the first set <b>45</b> of arrays of intensity values, in order to derive a mapping function for scaling the first sum array <b>47</b>. The effect of scaling the first sum array <b>47</b> is to reduce the amount of noise that propagates to a final array <b>54</b> of intensity values representing a combined image.</p>
<p id="p-0079" num="0078">The final array <b>54</b> of intensity values represents a combined image at a higher resolution than the scaled first sum array <b>53</b>. For this reason, the latter is processed (step <b>55</b>) to obtain a resolution-adjusted scaled first sum array <b>56</b>. Again, interpolation is a method by which the intensity values in the resolution-adjusted scaled first sum array <b>56</b> can be obtained.</p>
<p id="p-0080" num="0079">The final array <b>54</b> is obtained in a final step <b>57</b>. In this step <b>57</b>, each intensity value in the final array <b>54</b> of intensity values is obtained by summing an intensity value from the resolution-adjusted scaled first sum array <b>56</b> and the corresponding respective intensity values from each of the arrays in the second set <b>46</b> of arrays of intensity values. It will be apparent that the final array <b>54</b> is thus formed of intensity values that are each based on at least one intensity value in an array in the second set <b>46</b> of arrays of intensity values, to achieve a high-resolution representation of the combined image.</p>
<p id="p-0081" num="0080"><figref idref="DRAWINGS">FIG. 5</figref> shows a variant in which calculation is largely carried out in the spatial frequency domain, and which does not necessarily require interpolation or another process for increasing the resolution at which an image frame is represented. The variant illustrated in <figref idref="DRAWINGS">FIG. 5</figref> commences with a DCT operation <b>58</b>. The DCT operation <b>58</b> is used to obtain a first set <b>59</b> of arrays of DCT coefficients for representing a set of corresponding image frames at a first resolution. This first set <b>59</b> is based on a set <b>60</b> of arrays of pixel values encoding the image frames in the spatial domain as opposed to the spatial frequency domain. A second set <b>61</b> of arrays of DCT coefficients is based on a second set <b>62</b> of arrays of pixel values encoding image frames in the spatial domain at a second resolution. In this example, it will again be assumed that the second resolution is higher than the first resolution.</p>
<p id="p-0082" num="0081">In a subsequent step <b>63</b>, the arrays in the first set <b>59</b> of arrays of DCT coefficients are processed to obtain a first sum array <b>64</b>. Each DCT coefficient in the first sum array <b>64</b> is obtained by summing the corresponding DCT coefficients in the respective arrays of the first set <b>59</b>.</p>
<p id="p-0083" num="0082">The first sum array <b>64</b> is analysed to determine (step <b>65</b>) a mapping function mapping the DOT coefficients in the first sum array <b>64</b> from a first scale occupying a first range to a second scale occupying a second, preferably smaller, range. This step <b>65</b> is carried out using any of the methods outlined above with regard to the corresponding steps <b>22</b>, <b>33</b>, <b>49</b> in the methods of <figref idref="DRAWINGS">FIGS. 2-4</figref>. Subsequently (step <b>66</b>) a look-up table <b>67</b> is created on the basis of the mapping function.</p>
<p id="p-0084" num="0083">The mapping functions is based at least partly on the number of arrays in the second set <b>61</b> of arrays of DCT coefficients. This is done because only the DCT coefficients in the first sum array <b>64</b> are mapped from the first scale to the second scale (step <b>68</b>), whereas those in the arrays forming the second set <b>61</b> of arrays of DCT coefficients are not. The result of the scaling carried out in this step <b>68</b> is a scaled first sum array <b>69</b>.</p>
<p id="p-0085" num="0084">The scaled first sum array <b>69</b> and the arrays in the second set <b>61</b> of arrays of DCT coefficients are summed in a step <b>70</b> similar to the summation step <b>41</b> in the embodiment illustrated in <figref idref="DRAWINGS">FIG. 3</figref>. A final array <b>71</b> of DCT coefficients is obtained. The lower-order DCT coefficients in the final array <b>71</b> of DCT coefficients are each obtained by summing the lower-order coefficients of the scaled first sum array <b>69</b>, which is based on the first sum array <b>64</b>, and the corresponding lower-order coefficients of the arrays of the second set <b>61</b> of arrays of DCT coefficients. The higher-order DCT coefficients in the final array <b>71</b> are obtained by summing the corresponding higher-order coefficients in the arrays comprised in the second set <b>61</b> of arrays of DCT coefficients only. Thus, the final array <b>71</b> of DCT coefficients is suitable for representing the combined image at a relatively high resolution, at least higher than that of the image frames represented by the first sum array <b>64</b>.</p>
<p id="p-0086" num="0085">An inverse DCT operation <b>72</b> transforms the final array <b>71</b> of DCT coefficients into a final array <b>73</b> of pixel values, each corresponding to a light intensity over an area occupied by a pixel in the combined image.</p>
<p id="p-0087" num="0086">The invention is not limited to the described embodiments, which may be varied within the scope of the accompanying claims. In particular, the methods outlined herein are suitable for partial or complete execution by another type of image processing system than the digital camera <b>1</b>. For example, a general-purpose personal computer or work station may carry out the method on the basis of a first set of arrays of pixel values and a second set of arrays of pixel values in a sequence of arrays captured in rapid succession by the digital camera <b>1</b> and stored in the storage device <b>8</b>. Processing of the arrays for relative alignment of at least the region of overlap between the image frames represented by them is an advantageous feature of each embodiment.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. Method of forming a combined image based on a plurality of image frames, including:
<claim-text>capturing the plurality of image frames by means of an image capturing device (<b>5</b>);</claim-text>
<claim-text>obtaining a first set (<b>18</b>;<b>30</b>;<b>47</b>;<b>64</b>) of at least one array of intensity values for representing an image frame at a resolution corresponding to the number of intensity values in the array from the plurality of image frames, and obtaining a second set (<b>19</b>;<b>31</b>;<b>46</b>;<b>61</b>) of at least one array of intensity values for representing an image frame at a resolution corresponding to the number of intensity values in the array from the plurality of image frames, wherein the combined image is represented by a final array (<b>20</b>;<b>42</b>;<b>54</b>;<b>71</b>) of intensity values;</claim-text>
<claim-text>determining a mapping function (<b>22</b>;<b>33</b>;<b>49</b>;<b>65</b>) for mapping the intensity values of the arrays in the first set (<b>18</b>;<b>30</b>,<b>47</b>;<b>64</b>) from a scale within a first range to a scale within a second range;</claim-text>
<claim-text>mapping the intensity values of the arrays in the first set (<b>18</b>;<b>30</b>,<b>47</b>;<b>64</b>) on the basis of the mapping function;</claim-text>
<claim-text>obtaining at least some of the intensity values in the final array (<b>20</b>;<b>42</b>;<b>54</b>;<b>71</b>) by executing a step (<b>29</b>;<b>41</b>;<b>57</b>;<b>70</b>) of summing an intensity value from each of at least one array (<b>27</b>;<b>39</b>;<b>56</b>;<b>69</b>) of intensity values based on at least one array of intensity values in only the first set (<b>18</b>;<b>30</b>;<b>47</b>;<b>64</b>) and an intensity value from each of at least one array (<b>19</b>;<b>40</b>;<b>46</b>;<b>61</b>) of intensity values based on at least one array of intensity values in only the second set (<b>19</b>;<b>31</b>;<b>46</b>;<b>61</b>); and</claim-text>
<claim-text>arranging the first set (<b>18</b>;<b>30</b>;<b>47</b>;<b>64</b>) and the second set (<b>19</b>;<b>31</b>;<b>46</b>;<b>61</b>) such that the image frames represented by the arrays in the first set (<b>18</b>;<b>30</b>;<b>47</b>;<b>64</b>) are represented at lower resolutions than the image frames represented by the arrays in the second set (<b>19</b>;<b>31</b>;<b>46</b>;<b>61</b>),</claim-text>
<claim-text>wherein at least some of the arrays of intensity values in the first and second set are obtained by reading out measurement values from an image-capturing device comprising an array of light-sensitive cells, wherein each intensity value in the final array (<b>20</b>;<b>42</b>;<b>54</b>;<b>71</b>) is based on at least one intensity value in an array comprised in the second set.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. Method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the at least one array (<b>39</b>;<b>69</b>) of intensity values based on at least one array of intensity values in only the first set (<b>30</b>;<b>64</b>) contains coefficients in the spatial frequency domain, wherein the at least one array (<b>40</b>;<b>61</b>) of intensity values based on at least one array of intensity values in only the second set (<b>31</b>;<b>61</b>) contains coefficients in the spatial frequency domain and wherein the intensity values in the final array (<b>42</b>;<b>71</b>) are formed by coefficients in the spatial frequency domain,
<claim-text>wherein at least one lower order coefficient in the final array (<b>42</b>;<b>71</b>) is obtained by summing an intensity value from each of the at least one array (<b>39</b>;<b>69</b>) of intensity values based on at least one array of intensity values in only the first set (<b>30</b>;<b>64</b>) and an intensity value from each of at least one array (<b>40</b>;<b>61</b>) of intensity values based on at least one array of intensity values in only the second set (<b>31</b>;<b>61</b>), wherein at least one higher order coefficient in the final array (<b>42</b>;<b>71</b>) is obtained on the basis of only arrays (<b>40</b>;<b>61</b>) of intensity values based on the second set (<b>31</b>;<b>61</b>).</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. Method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, including determining an upper limit of the second range at least partly in dependence on the number of arrays of intensity values in the second set (<b>19</b>;<b>31</b>;<b>46</b>;<b>61</b>).</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. Method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein at least one of the arrays of intensity values in the first set (<b>47</b>;<b>64</b>) is obtained by obtaining a plurality of arrays (<b>45</b>;<b>60</b>) of intensity values for representing an image frame at a resolution corresponding to the number of intensity values in the array, and by summing an intensity value from each of the plurality of arrays (<b>45</b>;<b>60</b>) to obtain a corresponding intensity value in the at least one array in the first set (<b>47</b>;<b>64</b>).</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. Method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein at least one of the arrays of intensity values in the first set (<b>18</b>;<b>30</b>;<b>47</b>;<b>64</b>) is obtained by obtaining a plurality of arrays (<b>45</b>;<b>60</b>) of intensity values for representing an image frame at a resolution corresponding to the number of intensity values in the array, wherein the method further includes summing an intensity value from each of the obtained plurality of arrays (<b>45</b>;<b>60</b>) to obtain a corresponding intensity value in an intermediate combined array (<b>47</b>;<b>64</b>), and determining an upper limit of the second range at least partly in dependence on at least one intensity value in the intermediate combined array (<b>47</b>;<b>64</b>).</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. Method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein at least the arrays of intensity values in the first set are obtained by obtaining a plurality of arrays of intensity values for representing colour image frames in a first colour space, and applying a transformation to a plurality of arrays of values in a second colour space, wherein, in the first colour space, an image frame is represented by parameter value combinations, each parameter indicating the intensity of one of a plurality of colour components, whereas, in the second colour space, an image frame is represented by parameter value combinations, one parameter of the combination indicating a hue and at least one of the other parameters being indicative of light intensity.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. System for processing arrays of intensity values, each array being suitable for representing an image frame at a resolution corresponding to the number of intensity values in the array,
<claim-text>the system comprising an imaging apparatus (<b>1</b>), which comprises a processor (<b>7</b>,<b>9</b>,<b>11</b>) and at least one storage device (<b>8</b>) for storing the arrays of intensity values wherein the system is configured to:</claim-text>
<claim-text>capture a plurality of image frames by means of an image capturing device (<b>5</b>);</claim-text>
<claim-text>retrieve a first set (<b>18</b>;<b>30</b>;<b>47</b>;<b>64</b>) of at least one array of intensity values and a second set (<b>19</b>;<b>31</b>;<b>46</b>;<b>61</b>) of at least one array of intensity values from the plurality of image frames, the arrays in the first set (<b>18</b>;<b>30</b>;<b>47</b>;<b>64</b>) and arrays in the second set representing respective image frames, and to form a final array (<b>20</b>;<b>42</b>;<b>54</b>;<b>71</b>) of intensity values representing a combined image, wherein the system is configured to obtain each of at least some of the intensity values in the final array (<b>20</b>;<b>42</b>;<b>54</b>;<b>71</b>) by:</claim-text>
<claim-text>determining a mapping function (<b>22</b>;<b>33</b>;<b>49</b>;<b>65</b>) for mapping the intensity values of the arrays in the first set (<b>18</b>;<b>30</b>,<b>47</b>;<b>64</b>) from a scale within a first range to a scale within a second range;</claim-text>
<claim-text>mapping the intensity values of the arrays in the first set (<b>18</b>;<b>30</b>,<b>47</b>;<b>64</b>) on the basis of the mapping function;</claim-text>
<claim-text>executing a step of summing an intensity value from each of at least one array (<b>27</b>;<b>39</b>;<b>56</b>;<b>69</b>) of intensity values based on at least one array of intensity values in only the first set (<b>18</b>;<b>30</b>;<b>47</b>;<b>64</b>) and an intensity value from each of at least one array of intensity values based on at least one array (<b>19</b>;<b>40</b>;<b>46</b>;<b>61</b>); and</claim-text>
<claim-text>arranging the first set (<b>18</b>;<b>30</b>;<b>47</b>;<b>64</b>) and the second set (<b>19</b>;<b>31</b>;<b>46</b>;<b>61</b>) such that the image frames represented by the arrays in the first set (<b>18</b>;<b>30</b>;<b>47</b>;<b>64</b>) are represented at lower resolutions than the image frames represented by the arrays in the second set (<b>19</b>;<b>31</b>;<b>46</b>;<b>61</b>),</claim-text>
<claim-text>wherein at least some of the arrays of intensity values in the first and second set are obtained by reading out measurement values from an image-capturing device comprising an array of light-sensitive cells, wherein each intensity value in the final array (<b>20</b>;<b>42</b>;<b>54</b>;<b>71</b>) is based on at least one intensity value in an array comprised in the second set.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. Imaging apparatus (<b>1</b>), comprising a processor (<b>7</b>,<b>9</b>,<b>11</b>) and at least one storage device (<b>8</b>) for storing a plurality of arrays of intensity values, wherein the imaging apparatus is configured to execute a method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>. </claim-text>
</claim>
</claims>
</us-patent-grant>
