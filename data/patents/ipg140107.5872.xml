<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08626981-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08626981</doc-number>
<kind>B1</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>13071411</doc-number>
<date>20110324</date>
</document-id>
</application-reference>
<us-application-series-code>13</us-application-series-code>
<us-term-of-grant>
<us-term-extension>294</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>13</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>12</main-group>
<subgroup>00</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>13</main-group>
<subgroup>14</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>13</main-group>
<subgroup>38</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>710316</main-classification>
<further-classification>710241</further-classification>
</classification-national>
<invention-title id="d2e53">SAS expander with non-blocking virtual PHY architecture</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6798744</doc-number>
<kind>B1</kind>
<name>Loewen et al.</name>
<date>20040900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370235</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>7496700</doc-number>
<kind>B1</kind>
<name>Chong et al.</name>
<date>20090200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 52</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>7574542</doc-number>
<kind>B2</kind>
<name>Burroughs et al.</name>
<date>20090800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 74</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7624206</doc-number>
<kind>B2</kind>
<name>Bailey et al.</name>
<date>20091100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 51</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7644168</doc-number>
<kind>B2</kind>
<name>Grieff et al.</name>
<date>20100100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709229</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>7953917</doc-number>
<kind>B2</kind>
<name>Seto</name>
<date>20110500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710300</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>8116226</doc-number>
<kind>B1</kind>
<name>Liao et al.</name>
<date>20120200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370254</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>8255607</doc-number>
<kind>B2</kind>
<name>Jones et al.</name>
<date>20120800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710316</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>8352649</doc-number>
<kind>B2</kind>
<name>Liu et al.</name>
<date>20130100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 62</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>8443117</doc-number>
<kind>B2</kind>
<name>Katano et al.</name>
<date>20130500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 19</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2004/0190554</doc-number>
<kind>A1</kind>
<name>Galloway</name>
<date>20040900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370474</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2006/0271722</doc-number>
<kind>A1</kind>
<name>Marushak et al.</name>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710316</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>2007/0100847</doc-number>
<kind>A1</kind>
<name>Slutz et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>707100</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>2007/0162592</doc-number>
<kind>A1</kind>
<name>Marks et al.</name>
<date>20070700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709224</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>2007/0274231</doc-number>
<kind>A1</kind>
<name>Marks et al.</name>
<date>20071100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370254</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>2009/0094620</doc-number>
<kind>A1</kind>
<name>Kalwitz et al.</name>
<date>20090400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>719325</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>2009/0235130</doc-number>
<kind>A1</kind>
<name>Cagno et al.</name>
<date>20090900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>714715</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>2012/0246521</doc-number>
<kind>A1</kind>
<name>Washiya et al.</name>
<date>20120900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>714 48</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>2012/0311224</doc-number>
<kind>A1</kind>
<name>Myrah et al.</name>
<date>20121200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710316</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00020">
<document-id>
<country>JP</country>
<doc-number>07212551</doc-number>
<kind>A</kind>
<date>19950800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-cpc-text>H04N 1/23</classification-cpc-text>
</us-citation>
<us-citation>
<patcit num="00021">
<document-id>
<country>JP</country>
<doc-number>2000020447</doc-number>
<kind>A</kind>
<date>20000100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-cpc-text>G06F 13/14</classification-cpc-text>
</us-citation>
<us-citation>
<patcit num="00022">
<document-id>
<country>JP</country>
<doc-number>2012108905</doc-number>
<kind>A</kind>
<date>20120600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-cpc-text>G06F 13/14</classification-cpc-text>
</us-citation>
<us-citation>
<nplcit num="00023">
<othercit>&#x201c;NNRD43197: Double Tape Recording Techniques (Data Security Mode, Performance Mode)&#x201d;, Mar. 1, 2000, IBM Technical Disclosure Bulletin, Iss. 431, p. 518.</othercit>
</nplcit>
<category>cited by examiner</category>
</us-citation>
<us-citation>
<nplcit num="00024">
<othercit>&#x201c;NN9409307: Device Arbitration and Selection Method for Personal Computers&#x201d;, Sep. 1, 1994, IBM Technical Disclosure Bulletin, vol. 37, Iss. 9, pp. 307-312.</othercit>
</nplcit>
<category>cited by examiner</category>
</us-citation>
<us-citation>
<nplcit num="00025">
<othercit>Penokie, George, &#x201c;Information Technology-SAS Protocol Layer (SPL)&#x201d;, Working Draft American National Standard, Project T10/2124-D, Revision 07, Jul. 21, 2010, pp. 1-680.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>2</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>710316</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>710241</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>6</number-of-drawing-sheets>
<number-of-figures>6</number-of-figures>
</figures>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Roberts</last-name>
<first-name>Phillip Wayne</first-name>
<address>
<city>Colorado Springs</city>
<state>CO</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Tabor</last-name>
<first-name>Gregory Arthur</first-name>
<address>
<city>Colorado Springs</city>
<state>CO</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Schwemmer</last-name>
<first-name>Kurt Marshall</first-name>
<address>
<city>Colorado Springs</city>
<state>CO</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="004" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Adams</last-name>
<first-name>John Matthew</first-name>
<address>
<city>Colorado Springs</city>
<state>CO</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="005" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Benavidez</last-name>
<first-name>Armando Garza</first-name>
<address>
<city>Fountain</city>
<state>CO</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Roberts</last-name>
<first-name>Phillip Wayne</first-name>
<address>
<city>Colorado Springs</city>
<state>CO</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Tabor</last-name>
<first-name>Gregory Arthur</first-name>
<address>
<city>Colorado Springs</city>
<state>CO</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Schwemmer</last-name>
<first-name>Kurt Marshall</first-name>
<address>
<city>Colorado Springs</city>
<state>CO</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="004" designation="us-only">
<addressbook>
<last-name>Adams</last-name>
<first-name>John Matthew</first-name>
<address>
<city>Colorado Springs</city>
<state>CO</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="005" designation="us-only">
<addressbook>
<last-name>Benavidez</last-name>
<first-name>Armando Garza</first-name>
<address>
<city>Fountain</city>
<state>CO</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>TIPS Group</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Maxim Integrated Products, Inc.</orgname>
<role>02</role>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Zaman</last-name>
<first-name>Faisal M</first-name>
<department>2111</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A SAS expander includes a switch core, a number of SAS expander phys coupled to the switch core, an SMP originator coupled to the switch core and an SMP receptor coupled to the switch core. In an embodiment, the SMP originator is configured to only send connection requests and the SMP receptor is configured to only receive connection requests. Program instructions stored in non-transient digital storage media include code segments detecting a new connection request, code segments determining whether the new connection request is in conflict with an existing connection request and code segments determining if there is a free destination receptor phy. In an embodiment, the free destination receptor phy is never operationally used for an origination of a connection request.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="160.61mm" wi="183.22mm" file="US08626981-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="199.47mm" wi="171.45mm" orientation="landscape" file="US08626981-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="191.18mm" wi="162.05mm" orientation="landscape" file="US08626981-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="223.94mm" wi="181.78mm" file="US08626981-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="214.12mm" wi="154.09mm" orientation="landscape" file="US08626981-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="217.59mm" wi="175.01mm" file="US08626981-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="212.77mm" wi="179.07mm" file="US08626981-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND</heading>
<p id="p-0002" num="0001">Serial Attached SCSI (SAS) is a computer bus used to move data to and from computer storage devices such as hard drives and tape drives. SAS depends on a point-to-point serial protocol that replaces the parallel SCSI bus technology that first appeared in the mid 1980s in data centers and workstations, and it uses the standard SCSI command set. A typical SAS system includes one or more &#x201c;Initiators&#x201d;, one or more &#x201c;Targets&#x201d; and a &#x201c;Service Delivery Subsystem.&#x201d; A Service Delivery Subsystem may include one or more &#x201c;Expanders.&#x201d;</p>
<p id="p-0003" num="0002">An Initiator is a device that originates device-service and task-management requests for processing by a target device and receives responses for the same requests from other target devices. For example, Initiators may be provided as an on-board component on the motherboard (as is the case with many server-oriented motherboards) or as an add-on host bus adaptor.</p>
<p id="p-0004" num="0003">A Target is a device containing logical units and target ports that receive service (e.g. disk service) and task management requests for processing and sends responses for the same requests to initiator devices. Examples of target devices are hard disks and disk array systems.</p>
<p id="p-0005" num="0004">A Service Delivery Subsystem is part of an input/output (I/O) system that transmits information between an Initiator and a Target. Typically cables and connectors connecting an Initiator and a Target comprise a Service Delivery Subsystem. Optionally, Expanders or backplanes can be considered a part of the Service Delivery Subsystem.</p>
<p id="p-0006" num="0005">Expanders are devices that form part of a Service Delivery Subsystem and facilitate communication between SAS devices. Expanders facilitate the connection of one or more Initiators to one or more Targets.</p>
<p id="p-0007" num="0006">The SAS architecture includes six layers, namely the Physical layer, the Phy layer, the Link layer, the Port layer, the Transport layer and the Application layer. The T10 technical committee of the International Committee for Information Technology Standards (INCITS) and affiliates develop and maintain the SAS protocol and define the architecture of the various layers. See, for example, <i>Information technology&#x2014;SAS Protocol Layer </i>(<i>SPL</i>), Revision 07, 21 Jul. 2010, American National Standard for Information Technology, Ref. No. ISO/IEC 14776-261:201 X, incorporated herein by reference in its entirety, and hereafter referred to as <i>SAS Protocol Layer</i>. On pages 19-20 of <i>SAS Protocol Layer</i>, &#x201c;SAS&#x201d; is defined as &#x201c;Serial Attached SCSI&#x201d;, &#x201c;SCSI&#x201d; is defined as &#x201c;Small Computer System Interface family of standards&#x201d;, and &#x201c;SMP&#x201d; is defined as Serial Management Protocol.</p>
<p id="p-0008" num="0007">Expanders, as noted above, can be used to allow one or more Initiators to communicate with one or more Targets. When a connection request is made by an Initiator for communication with a Target, or by a Target for a communication with an Initiator, one or more Expanders can attempt to provide a pathway between the Initiator and the Target. An Expander implementing SAS protocols as used herein may be alternatively referred to as a &#x201c;SAS expander.&#x201d;</p>
<p id="p-0009" num="0008">An example SAS expander <b>10</b> of the prior art includes a switch core <b>12</b>, a plurality of SAS expander phys <b>14</b> coupled to the switch core <b>12</b>, and one or more SMP internal ports <b>16</b> coupled to the switch core <b>12</b>. The example SAS expander <b>10</b> also includes, in this example, a microcontroller (&#x3bc;C) <b>18</b> and memory <b>20</b>. SAS expander <b>10</b> often forms a part of an integrated circuit <b>22</b> as will be appreciated by those of skill in the art.</p>
<p id="p-0010" num="0009">The SAS expander phys <b>14</b> typically include a link layer <b>24</b>, a phy layer <b>26</b> and a serial transceiver <b>28</b>. The SMP internal ports <b>16</b> typically each include a link layer <b>30</b> and a virtual phy connection <b>32</b>. As noted by the arrows <b>34</b>, the SAS expander phys <b>14</b> each can operate as a connection originator and as a connection receptor.</p>
<p id="p-0011" num="0010">In typical implementations, a SAS expander <b>10</b> has but a single SMP internal phy. As used herein, a &#x201c;phy&#x201d; is a single endpoint for transmitting and receiving data and a &#x201c;port&#x201d; is one or more phys that share the same SAS address. If the port is busy in a connection, then other requests for the port will wait for the pending connection to terminate. If, for example, the SAS expander <b>10</b> is operating as a connection receptor it will not be able to operate as a connection originator until it is done. This can be a problem during high traffic congestion periods. Adding additional SMP virtual phys can help with this problem, but there is always the problem of having all SMP virtual phys busy servicing incoming connection requests, thereby precluding operation as a connection originator until one of the pending connections terminates.</p>
<p id="p-0012" num="0011">An example of high traffic congestion occurs during a &#x201c;self-configuration&#x201d; process of a SAS expander. Self-configuration is an integral part of SAS protocol in which SAS expanders discover all other devices in their domain and fill out their routing tables. During self-configuration, many requests to open pathways (&#x201c;OPEN&#x201d; requests) are competing for a limited number of SMP internal phys, leading to the OPEN requests waiting an excessive amount of time for the SMP internal phys to become available.</p>
<p id="p-0013" num="0012">During self-configuration (and other high traffic situations) there will be contention between multiple SAS expanders that are trying to connect to each other. This contention will result in one SAS expander backing off and accepting a higher priority connection request from another SAS expander, forcing the prior lower priority connection to be dropped and retried. This requires complex firmware and covers a larger set of boundary conditions. As a rough rule of thumb, with two interconnected SAS expanders undergoing self-configuration, roughly twice as much time is required to complete the set of requests in progress due to this contention.</p>
<p id="p-0014" num="0013">These and other limitations of the prior art will become apparent to those of skill in the art upon a reading of the following descriptions and a study of the several figures of the drawing.</p>
<heading id="h-0002" level="1">SUMMARY</heading>
<p id="p-0015" num="0014">By way of example and not limitation, an improved SAS expander includes: a switch core; a number of SAS expander phys coupled to the switch core; an SMP originator coupled to the switch core, the SMP originator being configured to send connection requests; and an SMP receptor coupled to the switch core, the SMP receptor being configured to receive connection requests.</p>
<p id="p-0016" num="0015">By way of further example and not limitation, program instructions stored in non-transient digital storage media include: code segments detecting a new connection request; code segments determining whether the new connection request is in conflict with an existing connection request; and code segments determining if there is a free destination receptor phy, where the free destination receptor phy is not operationally used for an origination of a connection request.</p>
<p id="p-0017" num="0016">By way of further example and not limitation, a method for operating an expander includes: directing an incoming connection request to a virtual phy receptor of the expander, wherein the virtual phy receptor is not used for sending outgoing connection requests; and sending outgoing connection requests from a virtual phy originator of the expander, wherein the virtual phy originator is not used for receiving incoming connection requests.</p>
<p id="p-0018" num="0017">By way of non-limiting example, certain embodiments are effective to increase the operational efficiency of a SAS expander system, particularly during periods of high traffic congestion such as during self-configuration of large domains.</p>
<p id="p-0019" num="0018">These and other embodiments and advantages and other features disclosed herein will become apparent to those of skill in the art upon a reading of the following descriptions and a study of the several figures of the drawing.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0020" num="0019">Several example embodiments will now be described with reference to the drawings, wherein like components are provided with like reference numerals. The example embodiments are intended to illustrate, but not to limit, the invention. The drawings include the following figures:</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of a SAS expander of the prior art;</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram of an improved SAS expander, set forth by way of example and not limitation;</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 3</figref> is a flow diagram of a non-limiting example process which can be implemented by the SAS expander of <figref idref="DRAWINGS">FIG. 2</figref>;</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram including two interconnected SAS expanders in a first non-limiting operating example;</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram including four interconnected SAS expanders in a second non-limiting operating example; and</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 6</figref> is a block diagram including four interconnected SAS expanders in a third non-limiting operating example.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTIONS</heading>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 1</figref> was described with reference to the prior art. Like reference numerals will refer to like components in the descriptions set forth herein.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 2</figref> is block diagram, set forth by way of example and not limitation, of a SAS expander <b>36</b> including a switch core <b>38</b>, a plurality of SAS expander phys <b>40</b> coupled to the switch core <b>38</b>, a SMP originator <b>42</b> coupled to the switch core <b>38</b>, and a SMP receptor <b>44</b> coupled to the switch core <b>38</b>. The SAS expander <b>36</b> also includes, in this example, a microcontroller (&#x3bc;C) <b>70</b> and memory <b>72</b>. SAS expander <b>38</b> often forms a part of an integrated circuit <b>50</b>, as will be appreciated by those of ordinary skill in the art.</p>
<p id="p-0029" num="0028">As used herein, by way of example, a &#x201c;switch core&#x201d; refers to circuitry implementing Expander Connection Manager (ECM) and Expander Connection Router (ECR) functionalities. As well known to those of skill in the art, an ECM implements a control function that sets up and tears down connections and the ECR comprises a crossbar multiplexer, for example, that routes the actual data. Switch core <b>38</b> includes virtual phy connection logic <b>52</b> which ensures that an &#x201c;incoming&#x201d; connection request from a SAS expander phy <b>40</b> is routed only to a SMP receptor <b>44</b>. That is, in this example, logic <b>52</b> never routes an incoming connection request to a SMP originator <b>42</b>. Logic <b>52</b> can take many forms, including discrete logic, state machines, microcontrollers, etc.</p>
<p id="p-0030" num="0029">SAS expander phys <b>40</b> preferably include a link layer <b>54</b>, a phy layer <b>56</b>, and a serial transceiver <b>58</b>. An arbitrary number of SAS expander phys <b>40</b> can be provided depending upon the application. For example, twelve SAS expander phys <b>40</b> can be provided. The link layers <b>54</b> of the SAS expander phys <b>40</b> are coupled to switch core <b>38</b> for bidirectional communication, and the serial transceivers <b>58</b> provide bidirectional serial data links to other devices (including, for example, other SAS expanders) which may be within or outside of integrated circuit <b>50</b>.</p>
<p id="p-0031" num="0030">SMP originator <b>42</b> includes a link layer <b>62</b> and a &#x201c;virtual phy&#x201d; connection originator <b>64</b>. It should be noted that SMP originator <b>42</b>, in this example, is used only to originate connection requests. In this example, one or more SMP originators <b>42</b> may be coupled to switch core <b>38</b>.</p>
<p id="p-0032" num="0031">SMP receptor <b>44</b> includes a link layer <b>66</b> and a &#x201c;virtual phy&#x201d; connection receptor <b>68</b>. It should be noted that SMP receptor <b>44</b>, in this example, is used only to receive connection requests. In this example, one or more SMP receptors <b>44</b> may be coupled to switch core <b>38</b>.</p>
<p id="p-0033" num="0032">It should be noted that SMP originator <b>42</b> and SMP receptor <b>44</b> are &#x201c;asymmetrical&#x201d; and &#x201c;non-blocking&#x201d; in that one is used only for originating connections and one is used only for receiving connections. This type of virtual phy architecture where a pair of virtual phys has one virtual phy used only for originating connections and has another virtual phy used only for receiving connections may referred to herein as &#x201c;an asymmetrical virtual phy architecture&#x201d; and/or as &#x201c;a non-blocking virtual phy architecture.&#x201d;</p>
<p id="p-0034" num="0033">Microcontroller <b>70</b> provides programmable logic control for SAS expander <b>36</b>. By way of non-limiting example, microcontroller <b>70</b> can be a MIPS microcontroller core developed by MIPS Technologies of Sunnyvale, Calif. Other microcontrollers, microprocessors, etc. are also suitable examples of programmable logic devices. In other examples, microprocessor <b>70</b> may be replaced with other forms of logic, such as state machines, or eliminated.</p>
<p id="p-0035" num="0034">Microcontroller <b>70</b> is coupled to memory <b>72</b> (e.g. non-transitory computer readable media) which can be provided &#x201c;on chip&#x201d; as shown or which may be accessed &#x201c;off chip&#x201d; by a connection <b>74</b>. Suitable memory <b>72</b> includes, without limitation, RAM, ROM, EPROM, flash memory, etc. In other examples, memory <b>72</b> may be replaced with other forms of memory or eliminated.</p>
<p id="p-0036" num="0035">Microcontroller <b>70</b> can be connected to SAS expander phys <b>40</b>, switch core <b>38</b>, SMP originators <b>42</b> and SMP receptors <b>44</b> as indicated by broken lines <b>76</b>, <b>78</b> and <b>80</b>, respectively, to connect to provide programmable logic control for SAS expander <b>36</b>. The program, comprising a plurality of code segments, can be stored, for example, in memory <b>72</b> or elsewhere.</p>
<p id="p-0037" num="0036"><figref idref="DRAWINGS">FIG. 3</figref> is a flow diagram of a non-limiting example process <b>82</b> which can be implemented by SAS expander <b>36</b>. By way of non-limiting example, process <b>82</b> may include program instructions stored in memory <b>72</b> or elsewhere and implemented by microcontroller <b>70</b>. By way of further non-limiting example, process <b>82</b> may provide programmable logic control of the link layers <b>54</b>, <b>62</b> and <b>66</b> of <figref idref="DRAWINGS">FIG. 2</figref>.</p>
<p id="p-0038" num="0037">The process <b>82</b> is initiated with an OPEN address frame received (&#x201c;connection request&#x201d;) event <b>84</b>. A decision operation <b>86</b> determines if the OPEN that was just received has crossed with an OPEN that had previously been forwarded by the same phy. If not, an operation <b>88</b> determines if there is a free destination phy. If not, operation idles as indicated at <b>89</b> until there is a free destination phy. Once a destination phy is available, a decision operation <b>90</b> determines whether there are multiple OPEN requests vying for that destination phy in an arbitration process. If the OPEN request does not win the arbitration with the other OPEN requests (e.g. because it has a lower priority that a competing OPEN request), a decision operation <b>92</b> determines whether the higher priority OPEN was forwarded from the destination phy. If not, process control returns to operation <b>88</b>. If decision operation <b>92</b> determines that the higher priority OPEN was forwarded from the destination phy the received OPEN is ignored (e.g. &#x201c;dropped&#x201d;) in an operation <b>98</b> and the process <b>82</b> is completed.</p>
<p id="p-0039" num="0038">If decision operation <b>90</b> determines that the OPEN request won the arbitration with other competing OPEN requests, such as by being the highest priority OPEN request, a decision operation <b>100</b> determines whether the OPEN request came from a virtual phy. If so, an operation <b>102</b> sets a DISABLE/BACKOFF flag for that destination phy and the OPEN is forwarded to the destination phy in an operation <b>104</b>, and the process <b>82</b> is completed. If operation <b>100</b> determines that the OPEN did not come from the virtual phy, the OPEN is forwarded to the destination phy in operation <b>104</b> without setting the flag.</p>
<p id="p-0040" num="0039">If operation <b>86</b> determines the received OPEN has crossed with a high priority OPEN that had been previously forwarded by the same phy, a decision operation determines if the crossing OPEN is of a higher priority. If so, the received OPEN is ignored in operation <b>98</b> and process <b>82</b> is completed. If the crossing OPEN is not of a higher priority, a decision operation <b>108</b> determines if there is a BACKOFF REVERSE PATH condition. If not, the other (&#x201c;crossing&#x201d;) OPEN is forced to the BACKOFF RETRY condition, after which operational control is given to operation <b>88</b>.</p>
<p id="p-0041" num="0040">If decision operation <b>108</b> determines that there is a BACKOFF REVERSE PATH condition, a decision operation <b>112</b> determines if the DISABLE/BACKOFF flag is set for the destination phy. If not, the received open is forwarded to the destination phy in operation <b>104</b> and the process <b>82</b> is completed. If the DISABLE/BACKOFF flag is set for the destination phy, operation control is given to operation <b>110</b> to force the other OPEN to the BACKOFF RETRY condition.</p>
<p id="p-0042" num="0041">The various protocols described herein are defined by industry standards. For example, the definitions of OPEN, BACKOFF REVERSE PATH, BACKOFF RETRY and other protocols are coordinated by the aforementioned T10 technical committee of the INCITS. As another example, the SAS expander link layer and arbitration behavior are described in Clause 7 of SAS-1.1 and SAS-2.0 and Clause 6 of the SPL (SAS Protocol Layer) standard (which substantially the same as SAS2.1). These standards can be found, for example, at http://t10.org/drafts.htm. SAS-1.1, having a full title of Serial Attached SCSI-1.1, is dated 2005 Sep. 21, Rev. 10, ANSI INCITS 417-2006, and is incorporated herein by reference in its entirety. SAS-2, having a full title of Serial Attached SCSI-2, is dated 2009 Apr. 18, Rev. 16, ANSI INCITS 457-2010, and is also incorporated herein by reference in its entirety. SPL, having a full title of SAS Protocol Layer, is dated 2010/07/21, Rev. 07, and is designated T10 Project 2124-D, and is also incorporated by reference in its entirety.</p>
<p id="p-0043" num="0042">It will be appreciated from the forgoing that the example SAS expander <b>36</b> has an asymmetric architecture because, unlike the prior art, the virtual phys are either originators (&#x201c;send only&#x201d;) or receptors (&#x201c;receive only&#x201d;). In this example, each SAS expander <b>36</b> has one or more SMP originators <b>42</b> and one or more SMP receptors <b>44</b>. In this example, the switch core <b>38</b> ensures that OPEN requests are only directed to SMP receptors <b>40</b>. Also, in this example, microcontroller <b>70</b> ensures that OPEN requests are only sent from SMP originators <b>42</b>. Therefore, SMP originators <b>42</b> and SMP receptors can be of the same design (e.g. capable of both originating and receiving) and logic external to these virtual phy can determine how they operate. Alternatively, as other non-limiting examples, SMP originators and SMP receptors can be of different designs and/or external logic coupled to these virtual phy can be modified or eliminated.</p>
<p id="p-0044" num="0043">It will be appreciated that process <b>82</b> handles the standard BACKOFF REVERSE PATH protocol differently than in the prior art due to the asymmetric architecture of its virtual phys. This allows SAS expander <b>36</b> to use the same SAS address for both the SMP originator <b>42</b> and the SMP receptor <b>44</b> without routing incoming OPEN requests to the SMP originator <b>42</b>.</p>
<p id="p-0045" num="0044">By way of non-limiting example, if SMP originator <b>42</b> originates a connection through a SAS expander phy <b>40</b>, BACKOFF REVERSE PATH is disabled for that SAS expander phy <b>40</b>. If an OPEN request comes in on the same link into that SAS expander phy <b>40</b>, the BACKOFF REVERSE PATH is disallowed, so that a BACKOFF RETRY occurs instead, and the partial pathway initiated by the SMP originator is torn down. This allows the incoming OPEN to be routed by the switch core <b>38</b> to the SMP receptor <b>44</b>. The SMP originator then takes a non-blocking path out of a different SAS expander phy <b>40</b>.</p>
<p id="p-0046" num="0045"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram including two interconnected SAS expanders <b>36</b>A and <b>36</b>B in a first non-limiting operating example. The asymmetric architecture of SAS expanders allows two simultaneous paths <b>114</b> and <b>116</b> between the virtual phys without any contention. As a result, each SAS expander <b>36</b> can simultaneously handle both an incoming connection and an outgoing connection.</p>
<p id="p-0047" num="0046"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram including four interconnected SAS expanders <b>36</b>A, <b>36</b>B, <b>36</b>C and <b>36</b>D in a second non-limiting operating example. In this example, SAS expander <b>36</b>A is receiving multiple pending incoming requests indicated by pathways <b>118</b>, <b>122</b> and <b>124</b>, all of which are routed by switch core <b>38</b>A to SMP receptor <b>44</b>A. These multiple requests will be arbitrated and one (pathway <b>118</b> in this example) will win and be connected to the SMP receptor <b>44</b>A. Despite the multiple incoming requests, the SMP originator <b>42</b>A is still free to make an outgoing request on pathway <b>120</b>. In this example, only SAS expander <b>36</b>A has two successful pathways to and from other SAS expanders <b>36</b>.</p>
<p id="p-0048" num="0047"><figref idref="DRAWINGS">FIG. 6</figref> is a block diagram including four interconnected SAS expanders <b>36</b>A, <b>36</b>B, <b>36</b>C and <b>36</b>D in a third non-limiting operating example. In this example, each of the SAS expanders <b>36</b> has a successful path to and from another SAS expander, namely pathways <b>126</b>, <b>128</b>, <b>130</b> and <b>132</b> in this example. This is a very efficient configuration, as will be appreciated by those of skill in the art.</p>
<p id="p-0049" num="0048">While various examples have been described in relation to SMP virtual phys, it should be noted that other protocols embodied in SAS technology are also applicable, e.g. SSP virtual phys. Furthermore, a asymmetrical virtual phy architecture (&#x201c;non-blocking virtual phy architecture&#x201d;) is useful in other protocols, such as the new protocols related to PCI-Express, currently under development by the T10 committee. It is therefore intended that the concepts, combinations, and architectures as set forth herein to include such alternative protocols.</p>
<p id="p-0050" num="0049">Although various embodiments have been described using specific terms and devices, such description is for illustrative purposes only. The words used are words of description rather than of limitation. It is to be understood that changes and variations may be made by those of ordinary skill in the art without departing from the spirit or the scope of the present invention, which is set forth in the following claims. In addition, it should be understood that aspects of various other embodiments may be interchanged either in whole or in part. It is therefore intended that the claims be interpreted in accordance with the true spirit and scope of the invention without limitation or estoppel.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A SAS expander comprising:
<claim-text>a switch core;</claim-text>
<claim-text>a plurality of SAS expander phys coupled to said switch core;</claim-text>
<claim-text>a Serial Management Protocol (SMP) originator coupled to said switch core, said SMP originator being configured to send connection requests, wherein said switch core is configured to not direct to said SMP originator an incoming connection request from an SAS expander phy;</claim-text>
<claim-text>an SMP receptor coupled to said switch core, said SMP receptor being configured to receive connection requests; and</claim-text>
<claim-text>a programmable controller configured to not direct to said SMP receptor an outgoing connection request to be sent to an SAS expander phy, said programmable controller including a microcontroller coupled to non-transient digital storage media storing program instructions including</claim-text>
<claim-text>(a) code segments detecting a new connection request,</claim-text>
<claim-text>(b) code segments determining whether said new connection request is in conflict with an existing connection request,</claim-text>
<claim-text>(c) code segments determining if there is a free SMP receptor,</claim-text>
<claim-text>(d) code segments for arbitrating connection requests for said free SMP receptor if it is determined that there is a free SMP receptor, said arbitrating connection requests determining a winning connection request,</claim-text>
<claim-text>(e) code segments for forwarding said winning connection request to said free SMP receptor, and</claim-text>
<claim-text>(f) code segments which disable BACKOFF REVERSE PATH for said free SMP receptor if said winning connection request came from a virtual phy.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A SAS expander as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref> comprising code segments stored in said non-transient digital storage media forcing a BACKOFF RETRY if there is no BACKOFF REVERSE PATH condition or if said BACKOFF REVERSE PATH for said free SMP receptor is disabled.</claim-text>
</claim>
</claims>
</us-patent-grant>
