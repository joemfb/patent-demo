<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08624559-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08624559</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12904893</doc-number>
<date>20101014</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>470</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>02</class>
<subclass>J</subclass>
<main-group>7</main-group>
<subgroup>14</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>320162</main-classification>
<further-classification>320149</further-classification>
<further-classification>320164</further-classification>
</classification-national>
<invention-title id="d2e53">Excessive current detection controls method</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5159218</doc-number>
<kind>A</kind>
<name>Murry et al.</name>
<date>19921000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>310 68 B</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5355305</doc-number>
<kind>A</kind>
<name>Seem et al.</name>
<date>19941000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>700 41</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6445980</doc-number>
<kind>B1</kind>
<name>Vyers</name>
<date>20020900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>700282</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7085611</doc-number>
<kind>B2</kind>
<name>Yoo et al.</name>
<date>20060800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>700 41</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7196493</doc-number>
<kind>B2</kind>
<name>McGee et al.</name>
<date>20070300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>320104</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>7940027</doc-number>
<kind>B2</kind>
<name>Desprez et al.</name>
<date>20110500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>320134</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>8203314</doc-number>
<kind>B2</kind>
<name>Odaohhara</name>
<date>20120600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>320150</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2006/0022642</doc-number>
<kind>A1</kind>
<name>McGee et al.</name>
<date>20060200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>320132</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2009/0091296</doc-number>
<kind>A1</kind>
<name>Desprez et al.</name>
<date>20090400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>320134</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2009/0140697</doc-number>
<kind>A1</kind>
<name>Hurley et al.</name>
<date>20090600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>320139</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2009/0195211</doc-number>
<kind>A1</kind>
<name>Wang et al.</name>
<date>20090800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>320136</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2009/0195212</doc-number>
<kind>A1</kind>
<name>Chiasson et al.</name>
<date>20090800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>320136</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>2009/0212758</doc-number>
<kind>A1</kind>
<name>Asinovski et al.</name>
<date>20090800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>323355</main-classification></classification-national>
</us-citation>
</us-references-cited>
<number-of-claims>20</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>320162</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>320164</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>320165</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>320132</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>324428</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>324434</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>6</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20120091971</doc-number>
<kind>A1</kind>
<date>20120419</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Syed</last-name>
<first-name>Asif A.</first-name>
<address>
<city>Canton</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Leutheuser</last-name>
<first-name>Andrew H.</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Lin</last-name>
<first-name>Jian</first-name>
<address>
<city>Beverly Hills</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="004" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Lograsso</last-name>
<first-name>Joseph M.</first-name>
<address>
<city>Troy</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="005" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Matthe&#x2032;</last-name>
<first-name>Roland</first-name>
<address>
<city>Bloomfield Hills</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Syed</last-name>
<first-name>Asif A.</first-name>
<address>
<city>Canton</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Leutheuser</last-name>
<first-name>Andrew H.</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Lin</last-name>
<first-name>Jian</first-name>
<address>
<city>Beverly Hills</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="004" designation="us-only">
<addressbook>
<last-name>Lograsso</last-name>
<first-name>Joseph M.</first-name>
<address>
<city>Troy</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="005" designation="us-only">
<addressbook>
<last-name>Matthe&#x2032;</last-name>
<first-name>Roland</first-name>
<address>
<city>Bloomfield Hills</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<last-name>Miller</last-name>
<first-name>John A.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
<agent sequence="02" rep-type="attorney">
<addressbook>
<orgname>Miller IP Group, PLC</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>GM Global Technology Operations LLC</orgname>
<role>02</role>
<address>
<city>Detroit</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Dunn</last-name>
<first-name>Drew A</first-name>
<department>2859</department>
</primary-examiner>
<assistant-examiner>
<last-name>DiBenedetto</last-name>
<first-name>Michael</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A method for controlling charging and discharging of a battery pack for an electric or hybrid vehicle to prevent overheating damage. Current flowing into or out of the battery pack is monitored, and root mean square (RMS) current is integrated over a time window and compared to a threshold to determine if power needs to be regulated in order to prevent damage to the cells in the battery pack. If the time-integrated RMS current exceeds the threshold, a closed-loop proportional-integral (PI) controller is activated to regulate power input or output. The controller will continue to regulate power until the time-integrated RMS current drops below the threshold. Various thresholds can be defined for different time windows. The gains used in the PI controller can also be adjusted to scale the amount of power regulation.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="109.73mm" wi="157.90mm" file="US08624559-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="158.75mm" wi="123.36mm" orientation="landscape" file="US08624559-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="246.63mm" wi="198.88mm" orientation="landscape" file="US08624559-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="241.13mm" wi="184.57mm" orientation="landscape" file="US08624559-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="179.32mm" wi="158.75mm" file="US08624559-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="247.99mm" wi="168.91mm" file="US08624559-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0002" num="0001">1. Field of the Invention</p>
<p id="p-0003" num="0002">This invention relates generally to a method for controlling power into and out of a battery pack and, more particularly, to a method for controlling charging power into and discharging power out of a battery pack for an electric or hybrid vehicle, which monitors root mean square current integrated over time and regulates power if a current threshold is exceeded.</p>
<p id="p-0004" num="0003">2. Discussion of the Related Art</p>
<p id="p-0005" num="0004">Electric vehicles and gasoline/electric hybrid vehicles are rapidly gaining popularity in today's automotive marketplace. Electric and hybrid vehicles offer several desirable features, such as reduced emissions, reduced usage of petroleum-based fuels, and potentially lower operating costs. A key component of both electric and hybrid vehicles is the battery pack. Battery packs in these vehicles typically consist of numerous interconnected cells, which can deliver a lot of power on demand. The battery pack also represents a substantial portion of the vehicle's cost. In order to maximize vehicle driving range and maximize battery pack life, the current to and from the battery pack must be controlled so that the battery pack does not charge or discharge too quickly, which can lead to overheating damage and other problems.</p>
<p id="p-0006" num="0005">Various methods of monitoring battery packs to prevent overheating have been developed and implemented. These methods include monitoring temperature in the battery pack to detect an over-temperature condition, and monitoring state of charge of the battery pack to determine if the battery pack is being charged or discharged too quickly. However, these methods both have disadvantages. Temperature in a battery pack can only economically be monitored at a few discrete locations within the battery pack; therefore, there may be places in the battery pack which are hotter than the temperature sensors indicate, in which case it is possible that some cells in the battery pack are already damaged by the time a high temperature is detected. Also, there is a time lag involved in the heating of the battery pack, which creates a risk that power-regulating action will only be taken after some damage is already done. State of charge monitoring is typically done for every cell in the battery pack, but state of charge measurement can have a cumulative error, which makes it difficult to accurately determine whether some battery pack cells are about to experience damage. State of charge, like temperature, is also an after-the-fact indicator.</p>
<p id="p-0007" num="0006">In order to more effectively protect battery packs from damage, a closed-loop, predictive monitoring and control method is needed. A method which monitors charging and discharging current over a certain time window can be used to proactively determine if power needs to be regulated in order to prevent damage to battery pack cells, thus overcoming the limitations of existing methods. Such a method can also be implemented in a way that improves the drivability of the vehicle, while still preserving the durability of the battery pack.</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0008" num="0007">In accordance with the teachings of the present invention, a method for controlling charging and discharging of a battery pack for an electric or hybrid vehicle is disclosed. Current flowing into or out of the battery pack is monitored, and root mean square (RMS) current is integrated over a time window and compared to a threshold to determine if power needs to be regulated in order to prevent damage to the cells in the battery pack. If the time-integrated RMS current exceeds the threshold, a closed-loop proportional-integral (PI) controller is activated to regulate power input or output. The controller will continue to regulate power until the time-integrated RMS current drops below the threshold. Various thresholds can be defined for different time windows. The gains used in the PI controller can also be adjusted to scale the amount of power regulation.</p>
<p id="p-0009" num="0008">Additional features of the present invention will become apparent from the following description and appended claims, taken in conjunction with the accompanying drawings.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic diagram of an electric vehicle battery pack power management system;</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 2</figref> is a graph of battery pack current versus time, showing how a rolling average RMS current is calculated;</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 3</figref> is a graph of RMS current thresholds as a function of duration time;</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram of a system error calculation module which can be used to calculate an &#x201c;error&#x201d; power amount to be used in a proportional integral (PI) control module;</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram of the PI control module as would be implemented in the controller of <figref idref="DRAWINGS">FIG. 1</figref>; and</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 6</figref> is a flow chart diagram of a process used by the controller of <figref idref="DRAWINGS">FIG. 1</figref> to monitor and regulate charging and discharging power in the battery pack.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION OF THE EMBODIMENTS</heading>
<p id="p-0016" num="0015">The following discussion of the embodiments of the invention directed to a current monitoring and control method for battery packs is merely exemplary in nature, and is in no way intended to limit the invention or its applications or uses. For example, the disclosed method is described in terms of its application to electric or hybrid vehicle battery packs, but the method may be equally applicable to battery packs in utility vehicles, such as forklifts and golf carts, and non-vehicle-based battery packs.</p>
<p id="p-0017" num="0016">Battery packs in electric and hybrid vehicles are typically large enough that thermal management of them is a concern. Unlike small batteries used in computers and electronic devices, electric and hybrid vehicle battery packs consist of many cells tightly packed together, which means that each cell does not have sufficient exposed surface area to allow effective air cooling. The thermal management problem is compounded by the high currents needed to drive an electric or hybrid vehicle, as heat is released during charging and discharging. High operating temperatures are known to be detrimental to battery packs, such as lithium ion battery packs of the type used in many electric and hybrid vehicles.</p>
<p id="p-0018" num="0017">It is therefore imperative that the cells in a battery pack are protected from overheating during charging or discharging operations. Electric vehicle battery packs normally have an integral cooling system to remove heat from the battery pack as necessary to maintain temperature below a certain threshold. Battery pack control systems have also been developed which limit the amount of charging or discharging current based on either temperature or state of charge considerations. These existing control methods and systems may not always fully protect the battery pack from damage, because they are designed to react to a temperature or state of charge measurement which may include error and/or time lag. To overcome these problems, a new type of battery pack control method is disclosed herein, which uses a time-history of charging or discharging current as a basis for power regulation.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic diagram of an electric vehicle battery pack power management system <b>10</b>. A vehicle <b>12</b> uses one or more electric motors (not shown) for propulsion, with electrical energy for the motors provided by a battery pack <b>14</b>. The battery pack <b>14</b> is fitted with a plurality of voltage and temperature sensors <b>16</b>, which monitor voltage (as an indicator of state of charge) and temperature in the battery pack <b>14</b>. Other parameters may also be monitored by the voltage and temperature sensors <b>16</b>, and measurements may be taken at multiple locations throughout the battery pack <b>14</b>. A power cable <b>18</b> carries all charging and discharging current into and out of the battery pack <b>14</b>. Charging current comes from a charging transformer (not shown), while discharging current goes to the electric motors. A current sensor <b>20</b> continuously measures the charging or discharging current.</p>
<p id="p-0020" num="0019">A controller <b>22</b> is used to monitor and control the current into and out of the battery pack <b>14</b>, based on measurements from the current sensor <b>20</b>. The controller <b>22</b> is in communication with the voltage and temperature sensors <b>16</b> via connections <b>24</b>, and with the current sensor <b>20</b> via a connection <b>26</b>. The connections <b>24</b> and <b>26</b> may be wired or wireless. The controller <b>22</b> is configured to limit the charging or discharging power if necessary in order to prevent overheating damage to the battery pack <b>14</b>, as will be discussed in detail below.</p>
<p id="p-0021" num="0020">The present invention proposes monitoring the actual current into (charging) or out of (discharging) the battery pack <b>14</b>, and using time-integrated root mean square (RMS) current as a basis for a control algorithm. The algorithm tracks the RMS current over various time intervals, and compares the RMS current against thresholds for the time intervals. If the RMS current exceeds a threshold, a closed-loop proportional-integral (PI) control algorithm, implemented in the controller <b>22</b>, regulates power. The PI control algorithm in the controller <b>22</b> continues to regulate power until the RMS current drops below the threshold value.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 2</figref> is a graph <b>30</b> showing how rolling average RMS current is calculated for various time windows. In the graph <b>30</b>, horizontal axis <b>40</b> represents time, and vertical axis <b>50</b> represents the square of current flowing into or out of the battery pack <b>14</b>. Curve <b>60</b> is a plot of current-squared as a function of time, for a typical operation of the battery pack <b>14</b> in the vehicle <b>12</b>. In order to prevent excessive charging or discharging current in the battery pack <b>14</b>, it is necessary to monitor RMS current for various time windows, where the time windows look backwards in time from the present time. For example, let hash mark <b>42</b> represent the present time, hash mark <b>44</b> represent a time 30 seconds prior to hash mark <b>42</b>, and hash mark <b>46</b> represent a time 60 seconds prior to hash mark <b>42</b>. Then line <b>62</b> represents the mean-square current for the past 30 seconds, and line <b>64</b> represents the mean-square current for the past 60 seconds. As can be seen on the graph <b>30</b>, the line <b>62</b>, which is the 30-second rolling average RMS current and can be designated as I<sub>30</sub><sup>2</sup>, has a current-squared value shown by hash mark <b>52</b>. Similarly, the line <b>64</b>, which is the 60-second rolling average RMS current and can be designated as I<sub>60</sub><sup>2</sup>, has a current-squared value shown by hash mark <b>54</b>. RMS current for any time window can be found by taking the square root of the mean-square current for that time window. Rolling average RMS current can be calculated for any time windows which are considered relevant; for example, the time windows might include the past 30 seconds, the past 60 seconds, the past 2 minutes, and the past 5 minutes.</p>
<p id="p-0023" num="0022">With the method defined above for calculating rolling average RMS current for various time windows, it is necessary to define one or more thresholds to be used by the controller <b>22</b> in order to determine whether a power limitation must be applied at any point in time. While a single threshold value for RMS current would be simplest to implement, both vehicle performance and battery pack life can be better optimized by using a multiple-threshold model. <figref idref="DRAWINGS">FIG. 3</figref> is a graph <b>70</b> showing how multiple RMS current thresholds can be defined. Time is plotted along horizontal axis <b>80</b> of the graph <b>70</b>, while RMS current is plotted along vertical axis <b>90</b>. Threshold lines <b>102</b>, <b>104</b>, <b>106</b>, and <b>108</b> represent RMS current threshold values which can be used in conjunction with the rolling average RMS currents defined above and shown on the graph <b>30</b>. In the example shown on the graph <b>70</b>, hash mark <b>82</b> is at a time of 30 seconds. Therefore, the threshold line <b>102</b> represents the threshold for the 30-second rolling average RMS current, I<sub>30</sub><sup>2</sup>, as defined above, having an RMS current threshold value designated by hash mark <b>92</b>. Hash mark <b>84</b> is at a time of 60 seconds, so the threshold line <b>104</b> represents the threshold for the 60 second rolling average RMS current, I<sub>60</sub><sup>2</sup>, having an RMS current threshold value designated by hash mark <b>94</b>.</p>
<p id="p-0024" num="0023">The logic behind the multiple-threshold model is that the battery pack <b>14</b> can handle a high charging or discharging power for a short period of time without sustaining damage, but power must be reduced somewhat if continued for an extended period of time. If only a single threshold were used, and the threshold was defined by the threshold line <b>102</b>, then the battery pack <b>14</b> could sustain damage if the threshold current was allowed to continue for several minutes. On the other hand, if only a single threshold were used, and the threshold was defined by the threshold line <b>108</b>, then short term vehicle performance would be unnecessarily penalized by not allowing a higher current draw for a short period of time. The multiple-threshold model allows both battery pack durability and vehicle performance to be optimized.</p>
<p id="p-0025" num="0024">In a similar fashion, the threshold lines <b>106</b> and <b>108</b> are defined, each one being associated with a longer rolling average time window and having a successively lower threshold current value. In the example of the graph <b>70</b>, the threshold line <b>106</b> extends out to hash mark <b>86</b> at a time of 2 minutes, and has a threshold current value designated by hash mark <b>96</b>. And the threshold line <b>108</b> is shown as a continuous-duty threshold with no time limit, and has a threshold current value designated by hash mark <b>98</b>. More or fewer thresholds could be defined than the four shown on the graph <b>70</b>.</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIGS. 2 and 3</figref> as described above illustrate the concept of rolling average RMS current values, and the associated threshold current values. A detailed discussion of the calculation of the rolling average RMS currents, and the control algorithms used to limit power when necessary, follows.</p>
<p id="p-0027" num="0026">To obtain the mean-square current for a certain time window, the following theoretical formulation can be defined:</p>
<p id="p-0028" num="0027">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msup>
          <mi>I</mi>
          <mn>2</mn>
        </msup>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <mn>1</mn>
            <mrow>
              <msub>
                <mi>t</mi>
                <mn>2</mn>
              </msub>
              <mo>-</mo>
              <msub>
                <mi>t</mi>
                <mn>1</mn>
              </msub>
            </mrow>
          </mfrac>
          <mo>&#x2062;</mo>
          <mrow>
            <msubsup>
              <mo>&#x222b;</mo>
              <mrow>
                <mi>t</mi>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mn>1</mn>
              </mrow>
              <mrow>
                <mi>t</mi>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mn>2</mn>
              </mrow>
            </msubsup>
            <mo>&#x2062;</mo>
            <mrow>
              <mrow>
                <mo>(</mo>
                <msup>
                  <mrow>
                    <mi>I</mi>
                    <mo>&#x2061;</mo>
                    <mrow>
                      <mo>(</mo>
                      <mi>t</mi>
                      <mo>)</mo>
                    </mrow>
                  </mrow>
                  <mn>2</mn>
                </msup>
                <mo>)</mo>
              </mrow>
              <mo>&#x2062;</mo>
              <mstyle>
                <mspace width="0.2em" height="0.2ex"/>
              </mstyle>
              <mo>&#x2062;</mo>
              <mrow>
                <mo>&#x2146;</mo>
                <mi>t</mi>
              </mrow>
            </mrow>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>1</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
Where I is current, t is time, and t<sub>1 </sub>and t<sub>2 </sub>are the beginning and ending times of the time window.
</p>
<p id="p-0029" num="0028">From Equation (1), RMS current can be defined as:</p>
<p id="p-0030" num="0029">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msub>
          <mi>I</mi>
          <mi>rms</mi>
        </msub>
        <mo>=</mo>
        <msqrt>
          <mfrac>
            <mrow>
              <msubsup>
                <mo>&#x222b;</mo>
                <mrow>
                  <mi>t</mi>
                  <mo>&#x2062;</mo>
                  <mstyle>
                    <mspace width="0.3em" height="0.3ex"/>
                  </mstyle>
                  <mo>&#x2062;</mo>
                  <mn>1</mn>
                </mrow>
                <mrow>
                  <mi>t</mi>
                  <mo>&#x2062;</mo>
                  <mstyle>
                    <mspace width="0.3em" height="0.3ex"/>
                  </mstyle>
                  <mo>&#x2062;</mo>
                  <mn>2</mn>
                </mrow>
              </msubsup>
              <mo>&#x2062;</mo>
              <mrow>
                <mrow>
                  <mo>(</mo>
                  <msup>
                    <mrow>
                      <mi>I</mi>
                      <mo>&#x2061;</mo>
                      <mrow>
                        <mo>(</mo>
                        <mi>t</mi>
                        <mo>)</mo>
                      </mrow>
                    </mrow>
                    <mn>2</mn>
                  </msup>
                  <mo>)</mo>
                </mrow>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.2em" height="0.2ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mrow>
                  <mo>&#x2146;</mo>
                  <mi>t</mi>
                </mrow>
              </mrow>
            </mrow>
            <mrow>
              <msub>
                <mi>t</mi>
                <mn>2</mn>
              </msub>
              <mo>-</mo>
              <msub>
                <mi>t</mi>
                <mn>1</mn>
              </msub>
            </mrow>
          </mfrac>
        </msqrt>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>2</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
</p>
<p id="p-0031" num="0030">In order to implement the control algorithm in an electronic processor, such as the controller <b>22</b>, a discrete method for calculating rolling average RMS current is needed. The mean square of the current at a time step can be calculated as:</p>
<p id="p-0032" num="0031">
<maths id="MATH-US-00003" num="00003">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <msubsup>
          <mover>
            <mi>I</mi>
            <mi>_</mi>
          </mover>
          <mi>k</mi>
          <mn>2</mn>
        </msubsup>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <mn>1</mn>
            <mi>n</mi>
          </mfrac>
          <mo>&#x2062;</mo>
          <mrow>
            <munderover>
              <mo>&#x2211;</mo>
              <mrow>
                <mi>i</mi>
                <mo>=</mo>
                <mrow>
                  <mi>k</mi>
                  <mo>-</mo>
                  <mi>n</mi>
                  <mo>+</mo>
                  <mn>1</mn>
                </mrow>
              </mrow>
              <mi>k</mi>
            </munderover>
            <mo>&#x2062;</mo>
            <mstyle>
              <mspace width="0.3em" height="0.3ex"/>
            </mstyle>
            <mo>&#x2062;</mo>
            <msubsup>
              <mi>I</mi>
              <mi>i</mi>
              <mn>2</mn>
            </msubsup>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>3</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
Where k is the current time step, n is the number of samples, i is the incremental step number, and I is current.
</p>
<p id="p-0033" num="0032">The rolling average of mean square current over the samples n can be calculated using an exponentially weighted moving average filter, with calibrated weights which represent the definite integral, as follows:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>&#x12a;</i><sub>k</sub><sup>2</sup><i>=w&#x12a;</i><sub>k-1</sub><sup>2</sup>+(1<i>&#x2212;w</i>)<i>I</i><sub>k</sub><sup>2</sup>&#x2003;&#x2003;(4)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where
</p>
<p id="p-0034" num="0033">
<maths id="MATH-US-00004" num="00004">
<math overflow="scroll">
<mrow>
  <mrow>
    <mi>w</mi>
    <mo>=</mo>
    <mfrac>
      <mi>n</mi>
      <mrow>
        <mi>n</mi>
        <mo>+</mo>
        <mn>1</mn>
      </mrow>
    </mfrac>
  </mrow>
  <mo>,</mo>
</mrow>
</math>
</maths>
<br/>
which implies that
</p>
<p id="p-0035" num="0034">
<maths id="MATH-US-00005" num="00005">
<math overflow="scroll">
<mrow>
  <mrow>
    <mo>(</mo>
    <mrow>
      <mn>1</mn>
      <mo>-</mo>
      <mi>w</mi>
    </mrow>
    <mo>)</mo>
  </mrow>
  <mo>=</mo>
  <mrow>
    <mrow>
      <mo>(</mo>
      <mfrac>
        <mn>1</mn>
        <mrow>
          <mi>n</mi>
          <mo>+</mo>
          <mn>1</mn>
        </mrow>
      </mfrac>
      <mo>)</mo>
    </mrow>
    <mo>.</mo>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram of a system error calculation module <b>120</b> which can be used to calculate an &#x201c;error&#x201d; power amount to be used in a PI control module. On line <b>130</b>, current-squared data is input from the current sensor <b>20</b>. The current-squared signal on the line <b>130</b> is of the type represented by the curve <b>60</b> on the graph <b>30</b>. At box <b>132</b>, the exponentially weighted moving average filter is applied, as described in Equations (3) and (4), to produce the rolling average mean square current for any desired time window. The rolling average mean square current is provided to product function <b>134</b>, where it is multiplied by time, from box <b>136</b>, to produce an &#x12a;<sup>2</sup>t value. The &#x12a;<sup>2</sup>t value is provided to summing junction <b>138</b> where the appropriate threshold for the time window, from box <b>140</b>, is subtracted. This results in a function u at box <b>142</b> which represents the &#x201c;error&#x201d;, or the amount in excess of the threshold, expressed as current-squared-time. The function u is provided to product function <b>144</b>, where it is divided by time from box <b>146</b>, resulting in an &#x12a;<sup>2 </sup>error value. At box <b>148</b>, the square root is taken, which results in an &#x12a; error value. At product function <b>150</b>, the &#x12a; error value is multiplied by the output voltage of the battery pack <b>14</b>, from box <b>152</b>, resulting in system &#x201c;error&#x201d; as a function of time at box <b>154</b>, expressed as a power in watts. The error value at the box <b>154</b> may be converted to kilowatts by dividing by 1000. A sign convention is defined such that the system error function, e(t), is negative if a threshold is exceeded during battery pack charging, and e(t) is positive if a threshold is exceeded during discharging (vehicle driving).</p>
<p id="p-0037" num="0036"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram of a proportional integral (PI) control module <b>160</b> as would be implemented in the controller <b>22</b>. The error function e(t) from the module <b>120</b> is provided as input on line <b>162</b>, which splits at junction <b>164</b> to a proportional block <b>166</b> and an integral block <b>168</b>. The proportional block <b>166</b> computes a control term which is proportional to the error function, that is, the proportional term at the box <b>166</b> is equal to a gain constant K<sub>p </sub>multiplied by the error function e(t). The integral block <b>168</b> computes a control term which is a function of the integral of the error signal, that is, the integral term at the box <b>168</b> is equal to a gain constant K<sub>i </sub>multiplied by the time integral of the error function e(t). The outputs of the proportional block <b>166</b> and the integral block <b>168</b> are added at summing junction <b>170</b> to produce an overall PI control signal.</p>
<p id="p-0038" num="0037">At box <b>172</b>, a clipping function is applied to the integral term from the box <b>168</b>. The clipping function at the box <b>172</b> serves to clip the integral term so that it falls between a maximum value and a minimum value, where the maximum and minimum values depend on whether the battery pack <b>14</b> is being charged or discharged. In charging mode, the maximum value for the integral term is equal to the negative of the proportional term, while the minimum value is equal to the negative of a charging power limit, P<sub>chlim</sub>, minus the proportional term. In discharging mode, the maximum value for the integral term is equal to the negative of a discharging power limit, P<sub>dchlim</sub>, minus the proportional term, while the minimum value is equal to the negative of the proportional term. The proportional term from the box <b>166</b> is not affected by the clipping function at the box <b>172</b>. The output of the clipping function at the box <b>172</b> goes to summing junction <b>174</b>, where it is added to either the charging power limit, P<sub>chlim</sub>, or the discharging power limit, P<sub>dchlim</sub>, from box <b>176</b>. The output of the PI control module <b>160</b> is the power setting for the current iteration of the process, on line <b>178</b>. The power setting on the line <b>178</b> is equal to either the charging or discharging power limit, plus the sum of the proportional term from the box <b>166</b> and the integral term from the box <b>168</b>, where the integral term may have been clipped at the box <b>172</b>. The sign convention is such that the proportional and integral control terms, which are computed from the &#x201c;error&#x201d; signal, have a reducing effect on the power setting; that is, in charging mode, when power is a positive value, the proportional control term and the integral control term are negative, thus reducing the power setting; and vice versa for discharging mode. The nature of the clipping function is such that the output power setting will have a value somewhere between zero and the appropriate power limit (P<sub>chlim </sub>or P<sub>dchlim</sub>).</p>
<p id="p-0039" num="0038"><figref idref="DRAWINGS">FIG. 6</figref> is a flow chart diagram <b>200</b> of an overall process used by the controller <b>22</b> to monitor current and regulate charging and discharging power in the battery pack <b>14</b>. The flow chart diagram <b>200</b> describes the processes used in the system error calculation module <b>120</b> and the PI control module <b>160</b>. The process begins at start oval <b>202</b>. At box <b>204</b>, the rolling average mean square current is calculated, per the box <b>132</b> of the module <b>120</b>. At box <b>206</b>, the mean square current is multiplied by time, to obtain the I<sup>2</sup>t value, per the product function <b>134</b>. At box <b>208</b>, the error function u is obtained by subtracting the I<sup>2</sup>t value from the appropriate threshold, per the summing junction <b>138</b>. Also at the box <b>208</b>, the sign of the error function u is determined. The sign convention is defined such that charging power is positive and system error during charging is negative, while discharging power is negative and system error during discharging is positive. At box <b>210</b>, the system error function, e(t), is calculated by dividing the error function u by time, taking the square root, multiplying by system voltage, and applying the appropriate positive or negative sign from the box <b>208</b>. The calculations of the box <b>210</b> represent the product function <b>140</b>, the box <b>142</b>, the product function <b>144</b>, and the box <b>146</b> of the module <b>120</b>.</p>
<p id="p-0040" num="0039">At decision diamond <b>212</b>, the process branches, depending on the sign of the system error function, e(t). If the error function is negative, the process proceeds to the charging branch at box <b>214</b>. At the box <b>214</b>, the proportional term of the PI control module <b>160</b> is calculated, per the box <b>166</b>. At box <b>216</b>, the integral term of the PI control module <b>160</b> is calculated, per the box <b>168</b>. Decision diamonds <b>218</b> and <b>222</b> serve to clip the integral term, that is, to keep it between certain extremes, as discussed above. At the decision diamond <b>218</b>, the integral term from the box <b>216</b> is checked to determine if it is greater than the value of the proportional term from the box <b>214</b>; if so, the integral term is set equal to the proportional term; if not, then the integral term is left unchanged and the process proceeds to the decision diamond <b>222</b>. At the decision diamond <b>222</b>, the integral term from the box <b>216</b> is checked to determine if it is less than a minimum value for charging mode, where the minimum value is defined as the constant charging power limit, P<sub>chlim</sub>, minus the proportional term from the box <b>214</b>; if so, the integral term is set equal to the minimum value for charging mode; if not, then the integral term is left unchanged and the process proceeds to box <b>226</b>. At the box <b>226</b>, the overall PI control signal for charging is calculated by adding the proportional term from the box <b>214</b> to the integral term, where the integral term comes from the box <b>216</b> and may be modified (clipped) at the box <b>220</b> or the box <b>224</b>. At box <b>228</b>, the value for charging power is calculated by adding the overall PI control signal from the box <b>226</b> to the charging power limit, P<sub>chlim</sub>. The charging branch of the process ends at terminus oval <b>230</b>.</p>
<p id="p-0041" num="0040">At the decision diamond <b>212</b>, if the error function is positive, the process proceeds to the discharging branch at box <b>234</b>. At the box <b>234</b>, the proportional term of the PI control module <b>160</b> is calculated, per the box <b>166</b>. At box <b>236</b>, the integral term of the PI control module <b>160</b> is calculated, per the box <b>168</b>. Decision diamonds <b>238</b> and <b>242</b> serve to clip the integral term, that is, to keep it between certain extremes. At the decision diamond <b>238</b>, the integral term from the box <b>236</b> is checked to determine if it is less than a maximum value for discharging mode, where the maximum value is defined as the constant (negative) discharging power limit, P<sub>dchlim</sub>, minus the proportional term from the box <b>234</b>; if so, the integral term is set equal to the maximum value for discharging mode; if not, then the integral term is left unchanged and the process proceeds to the decision diamond <b>242</b>. At the decision diamond <b>242</b>, the integral term from the box <b>236</b> is checked to determine if it is greater than the negative of the proportional term from the box <b>234</b>; if so, the integral term is set equal to the negative of the proportional term; if not, then the integral term is left unchanged and the process proceeds to box <b>246</b>. At the box <b>246</b>, the overall PI control signal for discharging is calculated by adding the proportional term from the box <b>234</b> to the integral term, where the integral term comes from the box <b>236</b> and may be modified (clipped) at the box <b>240</b> or the box <b>244</b>. At box <b>248</b>, the value for discharging power is calculated by subtracting the overall PI control signal from the box <b>246</b> from the discharging power limit, P<sub>dchlim</sub>. The discharging branch of the process also ends at the terminus oval <b>230</b>.</p>
<p id="p-0042" num="0041">The net effect of the process shown in the flow chart diagram <b>200</b> is that when a threshold is first exceeded, the controller <b>22</b> begins to ramp down the charging or discharging power, at a rate which is based on the gain constants K<sub>K </sub>and K<sub>i </sub>in the PI control module <b>160</b>. If the rolling average RMS current continues to exceed the threshold as more time passes, the power will ramp down further until, in some cases, the charging or discharging power is equal to zero. With little or no current flowing, the rolling average current is destined to drop below the threshold value after a certain amount of time, and the power will be increased. The power can actually begin to ramp back up before the rolling average current drops below the threshold, as this is the nature of the PI control module <b>160</b>, and can be tailored with the choice of the gain constants K<sub>p </sub>and K<sub>i </sub>and the power limits P<sub>chlim </sub>and P<sub>dchlim</sub>.</p>
<p id="p-0043" num="0042">When the controller <b>22</b> is limiting power because a threshold has been exceeded, the actual power limitation could be implemented in a number of ways&#x2014;including manipulating the voltage differential between the motor or charging transformer and the battery pack <b>14</b>, reducing current by adding a resistance along the power cable <b>18</b>, or other methods. The location and mechanization of the actual power limiter can be decided based on cost, reliability, packaging considerations, or other factors. In any case, the control methodology disclosed above, by monitoring actual current over various time windows, provides robust control of battery pack charging and discharging power, thus preventing damage to the battery pack <b>14</b>, while providing optimal performance for the vehicle's driver.</p>
<p id="p-0044" num="0043">The foregoing discussion discloses and describes merely exemplary embodiments of the present invention. One skilled in the art will readily recognize from such discussion and from the accompanying drawings and claims that various changes, modifications and variations can be made therein without departing from the spirit and scope of the invention as defined in the following claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001" nb-file="US08624559-20140107-M00001.NB">
<img id="EMI-M00001" he="7.03mm" wi="76.20mm" file="US08624559-20140107-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002" nb-file="US08624559-20140107-M00002.NB">
<img id="EMI-M00002" he="10.92mm" wi="76.20mm" file="US08624559-20140107-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00003" nb-file="US08624559-20140107-M00003.NB">
<img id="EMI-M00003" he="9.14mm" wi="76.20mm" file="US08624559-20140107-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00004" nb-file="US08624559-20140107-M00004.NB">
<img id="EMI-M00004" he="5.67mm" wi="76.20mm" file="US08624559-20140107-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00005" nb-file="US08624559-20140107-M00005.NB">
<img id="EMI-M00005" he="6.35mm" wi="76.20mm" file="US08624559-20140107-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method for controlling charging and discharging power in a battery pack, said method comprising:
<claim-text>measuring current flowing into or out of the battery pack with a current sensor;</claim-text>
<claim-text>establishing a threshold value for current for each time window of a plurality of time windows, where the threshold value is lower for longer time windows;</claim-text>
<claim-text>calculating a root mean square current for each time window of the plurality of time windows from the measured current;</claim-text>
<claim-text>comparing the root mean square current for each time window of the plurality of time windows to the threshold value for the time window; and</claim-text>
<claim-text>controlling the charging or discharging power if the root mean square current for any of the plurality of time windows exceeds the threshold value for the time window.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein calculating a root mean square current for a plurality of time windows includes using an exponentially weighted moving average filter.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein controlling the charging or discharging power includes reducing the charging or discharging power if the root mean square current for any of the plurality of time windows exceeds the threshold value for the time window.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein controlling the charging or discharging power includes computing an error function, and using a proportional integral control algorithm to compute a power setting.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00004">claim 4</claim-ref> wherein using a proportional integral control algorithm to compute a power setting includes:
<claim-text>calculating a proportional term based on the error function;</claim-text>
<claim-text>calculating an integral term based on the error function;</claim-text>
<claim-text>clipping the integral term if necessary to keep it between a maximum value and a minimum value;</claim-text>
<claim-text>adding the proportional term and the integral term together; and</claim-text>
<claim-text>adding a power limit value to the sum of the proportional term and the integral term to obtain the power setting.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00005">claim 5</claim-ref> wherein clipping the integral term includes defining the maximum value and the minimum value for charging power to be different than the maximum value and the minimum value for discharging power.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00005">claim 5</claim-ref> wherein adding a power limit value includes defining the power limit value for charging power to be different than the power limit value for discharging power.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the battery pack is a lithium ion battery pack.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the battery pack is used in an electric vehicle or a hybrid vehicle.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. A method for controlling charging and discharging power in a lithium-ion battery pack in an electric vehicle, said method comprising:
<claim-text>measuring current flowing into or out of the battery pack with a current sensor;</claim-text>
<claim-text>establishing a threshold value for current for each time window of a plurality of time windows, where the threshold value is lower for longer time windows;</claim-text>
<claim-text>calculating a rolling average root mean square current for each time window of the plurality of time windows from the measured current;</claim-text>
<claim-text>comparing the rolling average root mean square current for each time window of a plurality of time windows to the threshold value for the time window; and</claim-text>
<claim-text>controlling the charging or discharging power, where the charging or discharging power is reduced if the rolling average root mean square current for any of the plurality of time windows exceeds the threshold value for the time window.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref> wherein calculating a rolling average root mean square current includes using an exponentially weighted moving average filter.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref> wherein controlling the charging or discharging power includes computing an error function, and using a proportional integral control algorithm to compute a power setting.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The method of <claim-ref idref="CLM-00012">claim 12</claim-ref> wherein using a proportional integral control algorithm to compute a power setting includes:
<claim-text>calculating a proportional term based on the error function;</claim-text>
<claim-text>calculating an integral term based on the error function;</claim-text>
<claim-text>clipping the integral term if necessary to keep it between a maximum value and a minimum value;</claim-text>
<claim-text>adding the proportional term and the integral term together; and</claim-text>
<claim-text>adding a power limit value to the sum of the proportional term and the integral term to obtain the power setting.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The method of <claim-ref idref="CLM-00013">claim 13</claim-ref> wherein clipping the integral term includes defining the maximum value and the minimum value for charging power to be different than the maximum value and the minimum value for discharging power.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. A power management system for a battery pack providing electrical energy to an apparatus, said power management system comprising:
<claim-text>a current sensor for measuring current flowing into or out of the battery pack;</claim-text>
<claim-text>a controller for managing charging and discharging power in the battery pack, said controller being responsive to measurement signals from the current sensor and being configured to limit the power to prevent damage to the battery pack if the current, averaged over each time window of a plurality of time windows, exceeds a threshold value for the time window, where the threshold value is lower for longer time windows; and</claim-text>
<claim-text>means for limiting charging and discharging power in the battery pack in response to signals from the controller.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The power management system of <claim-ref idref="CLM-00015">claim 15</claim-ref> wherein the controller includes a system error calculation module and a proportional integral control module.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The power management system of <claim-ref idref="CLM-00016">claim 16</claim-ref> wherein the system error calculation module in the controller is configured to calculate, for each time window of the plurality of time windows, a rolling average root mean square current using an exponentially weighted moving average filter, calculate the difference between the rolling average root mean square current and the threshold value for the time window, and compute a system error function based on the difference.</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The power management system of <claim-ref idref="CLM-00016">claim 16</claim-ref> wherein the proportional integral control module in the controller is configured to calculate a proportional term and an integral term based on the output of the system error calculation module, clip the integral term if necessary to keep it between a maximum value and a minimum value, add the proportional term and the integral term together, and add a power limit value to the sum of the proportional term and the integral term to obtain a power setting.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The power management system of <claim-ref idref="CLM-00018">claim 18</claim-ref> wherein the maximum value, the minimum value, and the power limit value are all different for charging power than for discharging power.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The power management system of <claim-ref idref="CLM-00015">claim 15</claim-ref> wherein the battery pack is a lithium-ion battery pack and the apparatus is an electric vehicle. </claim-text>
</claim>
</claims>
</us-patent-grant>
