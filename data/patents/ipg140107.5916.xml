<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08627025-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08627025</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12973902</doc-number>
<date>20101221</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>372</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>12</main-group>
<subgroup>16</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>711162</main-classification>
<further-classification>711163</further-classification>
<further-classification>711165</further-classification>
</classification-national>
<invention-title id="d2e53">Protecting data during different connectivity states</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6079000</doc-number>
<kind>A</kind>
<name>Cooper et al.</name>
<date>20000600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711162</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>7162587</doc-number>
<kind>B2</kind>
<name>Hiken et al.</name>
<date>20070100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711135</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>7168001</doc-number>
<kind>B2</kind>
<name>Johnson et al.</name>
<date>20070100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>714 13</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>8219759</doc-number>
<kind>B2</kind>
<name>Gokaraju et al.</name>
<date>20120700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711133</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2001/0001870</doc-number>
<kind>A1</kind>
<name>Ofek et al.</name>
<date>20010500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2004/0059870</doc-number>
<kind>A1</kind>
<name>Ash et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711119</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2004/0088331</doc-number>
<kind>A1</kind>
<name>Therrien et al.</name>
<date>20040500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2004/0088508</doc-number>
<kind>A1</kind>
<name>Ballard et al.</name>
<date>20040500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711162</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2005/0187891</doc-number>
<kind>A1</kind>
<name>Johnson et al.</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>707  1</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2008/0091895</doc-number>
<kind>A1</kind>
<name>Chen</name>
<date>20080400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711162</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2008/0256140</doc-number>
<kind>A1</kind>
<name>Lazzaro et al.</name>
<date>20081000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2009/0089862</doc-number>
<kind>A1</kind>
<name>Sun</name>
<date>20090400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>2010/0280999</doc-number>
<kind>A1</kind>
<name>Atluri et al.</name>
<date>20101100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>707657</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>2011/0010499</doc-number>
<kind>A1</kind>
<name>Tsukamoto et al.</name>
<date>20110100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711118</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>2011/0066805</doc-number>
<kind>A1</kind>
<name>Janschitz et al.</name>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711115</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>2011/0246721</doc-number>
<kind>A1</kind>
<name>Crisan</name>
<date>20111000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711130</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>2011/0264875</doc-number>
<kind>A1</kind>
<name>Watanabe</name>
<date>20111000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711162</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>2012/0210084</doc-number>
<kind>A1</kind>
<name>Carroll et al.</name>
<date>20120800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>711162</main-classification></classification-national>
</us-citation>
<us-citation>
<nplcit num="00019">
<othercit>Redi, et al., &#x201c;Mobile IP: A Solution for Transparent, Seamless Mobile Computer Communications&#x201d;, Retrieved at &#x3c;&#x3c; http://research.microsoft.com/pubs/68436/mobile-ip.pdf &#x3e;&#x3e;, Fuji-Keizai's Report on Upcoming Trends in Mobile Computing and Communications, 1998, pp. 1-10.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00020">
<othercit>Takasugi, et al., &#x201c;Seamless Service Platform for Following a User's Movement in a Dynamic Network Environment&#x201d;, Retrieved at &#x3c;&#x3c; http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.90.5555&#x26;rep=rep1&#x26;type=pdf &#x3e;&#x3e;, Pervasive Computing and Communications, 2003. (PerCom 2003). Proceedings of the First IEEE International Conference, Mar. 23-26, 2003, pp. 8.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00021">
<othercit>Satyanarayanan, et al., &#x201c;Towards seamless mobility on pervasive hardware&#x201d;, Retrieved at &#x3c;&#x3c; http://isr.cmu.edu/doc/isr-pmc05.pdf &#x3e;&#x3e;, Pervasive and Mobile Computing, vol. 1, No. 2, Jul. 2005, pp. 33.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00022">
<othercit>Babineau, Brian, &#x201c;Next Generation NAS: A market perspective on the recently introduced Snap Server 500 Series&#x201d;, Retrieved at &#x3c;&#x3c; http://www.snapserver.com/pdf/reviews/ESG<sub>&#x2014;</sub>NextGenNAS.pdf &#x3e;&#x3e;, Jun. 2006, pp. 1-5.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>20</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>711162</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711163</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>711165</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>7</number-of-drawing-sheets>
<number-of-figures>7</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20120159078</doc-number>
<kind>A1</kind>
<date>20120621</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Doshi</last-name>
<first-name>Apurva Ashwin</first-name>
<address>
<city>Seattle</city>
<state>WA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Lyakhovitskiy</last-name>
<first-name>Grigory Borisovich</first-name>
<address>
<city>Bothell</city>
<state>WA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Raciborski</last-name>
<first-name>Bohdan W.</first-name>
<address>
<city>Redmond</city>
<state>WA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Doshi</last-name>
<first-name>Apurva Ashwin</first-name>
<address>
<city>Seattle</city>
<state>WA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Lyakhovitskiy</last-name>
<first-name>Grigory Borisovich</first-name>
<address>
<city>Bothell</city>
<state>WA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Raciborski</last-name>
<first-name>Bohdan W.</first-name>
<address>
<city>Redmond</city>
<state>WA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Microsoft Corporation</orgname>
<role>02</role>
<address>
<city>Redmond</city>
<state>WA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Lane</last-name>
<first-name>John</first-name>
<department>2189</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Aspects of the subject matter described herein relate to data protection. In aspects, during a backup cycle, backup copies may be created for files that are new or that have changed since the last backup. If external backup storage is not available, the backup copies may be stored in a cache located on the primary storage. If backup storage is available, the backup copies may be stored in the backup storage device and backup copies that were previously stored in the primary storage may be copied to the backup storage. The availability of the backup storage may be detected and used to seamlessly switch between backing up files locally and remotely as availability of the backup storage changes.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="174.84mm" wi="330.88mm" file="US08627025-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="248.16mm" wi="189.99mm" orientation="landscape" file="US08627025-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="106.26mm" wi="133.35mm" file="US08627025-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="194.65mm" wi="120.99mm" orientation="landscape" file="US08627025-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="189.23mm" wi="150.45mm" orientation="landscape" file="US08627025-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="180.68mm" wi="169.08mm" file="US08627025-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="183.81mm" wi="175.26mm" file="US08627025-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="231.06mm" wi="140.38mm" file="US08627025-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND</heading>
<p id="p-0002" num="0001">Many people who use computers recognize the need to create backup copies of the data that is stored on the computers. Not only does computer hardware sometime fail, but sometimes files are overwritten or deleted on accident. Unfortunately, for various reasons, many of the people who recognize the need to create backup copies of their data do not actually protect their data through regular or even non-regular backups.</p>
<p id="p-0003" num="0002">The subject matter claimed herein is not limited to embodiments that solve any disadvantages or that operate only in environments such as those described above. Rather, this background is only provided to illustrate one exemplary technology area where some embodiments described herein may be practiced.</p>
<heading id="h-0002" level="1">SUMMARY</heading>
<p id="p-0004" num="0003">Briefly, aspects of the subject matter described herein relate to data protection. In aspects, during a backup cycle, backup copies may be created for files that are new or that have changed since the last backup. If external backup storage is not available, the backup copies may be stored in a cache located on the primary storage. If backup storage is available, the backup copies may be stored in the backup storage device and backup copies that were previously stored in the primary storage may be copied to the backup storage. The availability of the backup storage may be detected and used to seamlessly switch between backing up files locally and remotely as availability of the backup storage changes.</p>
<p id="p-0005" num="0004">This Summary is provided to briefly identify some aspects of the subject matter that is further described below in the Detailed Description. This Summary is not intended to identify key or essential features of the claimed subject matter, nor is it intended to be used to limit the scope of the claimed subject matter.</p>
<p id="p-0006" num="0005">The phrase &#x201c;subject matter described herein&#x201d; refers to subject matter described in the Detailed Description unless the context clearly indicates otherwise. The term &#x201c;aspects&#x201d; is to be read as &#x201c;at least one aspect.&#x201d; Identifying aspects of the subject matter described in the Detailed Description is not intended to identify key or essential features of the claimed subject matter.</p>
<p id="p-0007" num="0006">The aspects described above and other aspects of the subject matter described herein are illustrated by way of example and not limited in the accompanying figures in which like reference numerals indicate similar elements and in which:</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0008" num="0007"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram representing an exemplary general-purpose computing environment into which aspects of the subject matter described herein may be incorporated;</p>
<p id="p-0009" num="0008"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram that generally represents an exemplary environment in which aspects of the subject matter described herein may be implemented;</p>
<p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram that illustrates versions of and other data related to two exemplary files that may be backed up in accordance with aspects of the subject matter described herein;</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram that generally represents actions that may occur in freeing space in a cache in accordance with aspects of the subject matter described herein;</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram that represents a system configured in accordance with aspects of the subject matter described herein;</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIGS. 6-7</figref> are flow diagrams that generally represent exemplary actions that may occur in accordance with aspects of the subject matter described herein.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION</heading>
<heading id="h-0005" level="1">Definitions</heading>
<p id="p-0014" num="0013">As used herein, the term &#x201c;includes&#x201d; and its variants are to be read as open-ended terms that mean &#x201c;includes, but is not limited to.&#x201d; The term &#x201c;or&#x201d; is to be read as &#x201c;and/or&#x201d; unless the context clearly dictates otherwise. The term &#x201c;based on&#x201d; is to be read as &#x201c;based at least in part on.&#x201d; The terms &#x201c;one embodiment&#x201d; and &#x201c;an embodiment&#x201d; are to be read as &#x201c;at least one embodiment.&#x201d; The term &#x201c;another embodiment&#x201d; is to be read as &#x201c;at least one other embodiment.&#x201d;</p>
<p id="p-0015" num="0014">As used herein, terms such as &#x201c;a,&#x201d; &#x201c;an,&#x201d; and &#x201c;the&#x201d; are inclusive of one or more of the indicated item or action. In particular, in the claims a reference to an item generally means at least one such item is present and a reference to an action means at least one instance of the action is performed.</p>
<p id="p-0016" num="0015">Sometimes herein the terms &#x201c;first,&#x201d; &#x201c;second,&#x201d; &#x201c;third,&#x201d; and so forth are used. The use of these terms, particularly in the claims, is not intended to imply an ordering but is rather used for identification purposes. For example, the phrase &#x201c;first version&#x201d; and &#x201c;second version&#x201d; does not necessarily mean that the first version is the very first version or was created before the second version or even that the first version is requested or operated on before the second versions. Rather, these phrases are used to identify different versions.</p>
<p id="p-0017" num="0016">Headings are for convenience only; information on a given topic may be found outside the section whose heading indicates that topic.</p>
<p id="p-0018" num="0017">Other definitions, explicit and implicit, may be included below.</p>
<p id="h-0006" num="0000">Exemplary Operating Environment</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 1</figref> illustrates an example of a suitable computing system environment <b>100</b> on which aspects of the subject matter described herein may be implemented. The computing system environment <b>100</b> is only one example of a suitable computing environment and is not intended to suggest any limitation as to the scope of use or functionality of aspects of the subject matter described herein. Neither should the computing environment <b>100</b> be interpreted as having any dependency or requirement relating to any one or combination of components illustrated in the exemplary operating environment <b>100</b>.</p>
<p id="p-0020" num="0019">Aspects of the subject matter described herein are operational with numerous other general purpose or special purpose computing system environments or configurations. Examples of well-known computing systems, environments, or configurations that may be suitable for use with aspects of the subject matter described herein comprise personal computers, server computers, hand-held or laptop devices, multiprocessor systems, microcontroller-based systems, set-top boxes, programmable consumer electronics, network PCs, minicomputers, mainframe computers, personal digital assistants (PDAs), gaming devices, printers, appliances including set-top, media center, or other appliances, automobile-embedded or attached computing devices, other mobile devices, distributed computing environments that include any of the above systems or devices, and the like.</p>
<p id="p-0021" num="0020">Aspects of the subject matter described herein may be described in the general context of computer-executable instructions, such as program modules, being executed by a computer. Generally, program modules include routines, programs, objects, components, data structures, and so forth, which perform particular tasks or implement particular abstract data types. Aspects of the subject matter described herein may also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network. In a distributed computing environment, program modules may be located in both local and remote computer storage media including memory storage devices.</p>
<p id="p-0022" num="0021">With reference to <figref idref="DRAWINGS">FIG. 1</figref>, an exemplary system for implementing aspects of the subject matter described herein includes a general-purpose computing device in the form of a computer <b>110</b>. A computer may include any electronic device that is capable of executing an instruction. Components of the computer <b>110</b> may include a processing unit <b>120</b>, a system memory <b>130</b>, and a system bus <b>121</b> that couples various system components including the system memory to the processing unit <b>120</b>. The system bus <b>121</b> may be any of several types of bus structures including a memory bus or memory controller, a peripheral bus, and a local bus using any of a variety of bus architectures. By way of example, and not limitation, such architectures include Industry Standard Architecture (ISA) bus, Micro Channel Architecture (MCA) bus, Enhanced ISA (EISA) bus, Video Electronics Standards Association (VESA) local bus, Peripheral Component Interconnect (PCI) bus also known as Mezzanine bus, Peripheral Component Interconnect Extended (PCI-X) bus, Advanced Graphics Port (AGP), and PCI express (PCIe).</p>
<p id="p-0023" num="0022">The computer <b>110</b> typically includes a variety of computer-readable media. Computer-readable media can be any available media that can be accessed by the computer <b>110</b> and includes both volatile and nonvolatile media, and removable and non-removable media. By way of example, and not limitation, computer-readable media may comprise computer storage media and communication media.</p>
<p id="p-0024" num="0023">Computer storage media includes both volatile and nonvolatile, removable and non-removable media implemented in any method or technology for storage of information such as computer-readable instructions, data structures, program modules, or other data. Computer storage media includes RAM, ROM, EEPROM, flash memory or other memory technology, CD-ROM, digital versatile discs (DVDs) or other optical disk storage, magnetic cassettes, magnetic tape, magnetic disk storage or other magnetic storage devices, or any other medium which can be used to store the desired information and which can be accessed by the computer <b>110</b>.</p>
<p id="p-0025" num="0024">Communication media typically embodies computer-readable instructions, data structures, program modules, or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media. The term &#x201c;modulated data signal&#x201d; means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal. By way of example, and not limitation, communication media includes wired media such as a wired network or direct wired connection, and wireless media such as acoustic, RF, infrared and other wireless media. Combinations of any of the above should also be included within the scope of computer-readable media.</p>
<p id="p-0026" num="0025">The system memory <b>130</b> includes computer storage media in the form of volatile and/or nonvolatile memory such as read only memory (ROM) <b>131</b> and random access memory (RAM) <b>132</b>. A basic input/output system <b>133</b> (BIOS), containing the basic routines that help to transfer information between elements within computer <b>110</b>, such as during start-up, is typically stored in ROM <b>131</b>. RAM <b>132</b> typically contains data and/or program modules that are immediately accessible to and/or presently being operated on by processing unit <b>120</b>. By way of example, and not limitation, <figref idref="DRAWINGS">FIG. 1</figref> illustrates operating system <b>134</b>, application programs <b>135</b>, other program modules <b>136</b>, and program data <b>137</b>.</p>
<p id="p-0027" num="0026">The computer <b>110</b> may also include other removable/non-removable, volatile/nonvolatile computer storage media. By way of example only, <figref idref="DRAWINGS">FIG. 1</figref> illustrates a hard disk drive <b>141</b> that reads from or writes to non-removable, nonvolatile magnetic media, a magnetic disk drive <b>151</b> that reads from or writes to a removable, nonvolatile magnetic disk <b>152</b>, and an optical disc drive <b>155</b> that reads from or writes to a removable, nonvolatile optical disc <b>156</b> such as a CD ROM or other optical media. Other removable/non-removable, volatile/nonvolatile computer storage media that can be used in the exemplary operating environment include magnetic tape cassettes, flash memory cards, digital versatile discs, other optical discs, digital video tape, solid state RAM, solid state ROM, and the like. The hard disk drive <b>141</b> may be connected to the system bus <b>121</b> through the interface <b>140</b>, and magnetic disk drive <b>151</b> and optical disc drive <b>155</b> may be connected to the system bus <b>121</b> by an interface for removable non-volatile memory such as the interface <b>150</b>.</p>
<p id="p-0028" num="0027">The drives and their associated computer storage media, discussed above and illustrated in <figref idref="DRAWINGS">FIG. 1</figref>, provide storage of computer-readable instructions, data structures, program modules, and other data for the computer <b>110</b>. In <figref idref="DRAWINGS">FIG. 1</figref>, for example, hard disk drive <b>141</b> is illustrated as storing operating system <b>144</b>, application programs <b>145</b>, other program modules <b>146</b>, and program data <b>147</b>. Note that these components can either be the same as or different from operating system <b>134</b>, application programs <b>135</b>, other program modules <b>136</b>, and program data <b>137</b>. Operating system <b>144</b>, application programs <b>145</b>, other program modules <b>146</b>, and program data <b>147</b> are given different numbers herein to illustrate that, at a minimum, they are different copies.</p>
<p id="p-0029" num="0028">A user may enter commands and information into the computer <b>110</b> through input devices such as a keyboard <b>162</b> and pointing device <b>161</b>, commonly referred to as a mouse, trackball, or touch pad. Other input devices (not shown) may include a microphone, joystick, game pad, satellite dish, scanner, a touch-sensitive screen, a writing tablet, or the like. These and other input devices are often connected to the processing unit <b>120</b> through a user input interface <b>160</b> that is coupled to the system bus, but may be connected by other interface and bus structures, such as a parallel port, game port or a universal serial bus (USB).</p>
<p id="p-0030" num="0029">A monitor <b>191</b> or other type of display device is also connected to the system bus <b>121</b> via an interface, such as a video interface <b>190</b>. In addition to the monitor, computers may also include other peripheral output devices such as speakers <b>197</b> and printer <b>196</b>, which may be connected through an output peripheral interface <b>195</b>.</p>
<p id="p-0031" num="0030">The computer <b>110</b> may operate in a networked environment using logical connections to one or more remote computers, such as a remote computer <b>180</b>. The remote computer <b>180</b> may be a personal computer, a server, a router, a network PC, a peer device or other common network node, and typically includes many or all of the elements described above relative to the computer <b>110</b>, although only a memory storage device <b>181</b> has been illustrated in <figref idref="DRAWINGS">FIG. 1</figref>. The logical connections depicted in <figref idref="DRAWINGS">FIG. 1</figref> include a local area network (LAN) <b>171</b> and a wide area network (WAN) <b>173</b>, but may also include other networks. Such networking environments are commonplace in offices, enterprise-wide computer networks, intranets, and the Internet.</p>
<p id="p-0032" num="0031">When used in a LAN networking environment, the computer <b>110</b> is connected to the LAN <b>171</b> through a network interface or adapter <b>170</b>. When used in a WAN networking environment, the computer <b>110</b> may include a modem <b>172</b> or other means for establishing communications over the WAN <b>173</b>, such as the Internet. The modem <b>172</b>, which may be internal or external, may be connected to the system bus <b>121</b> via the user input interface <b>160</b> or other appropriate mechanism. In a networked environment, program modules depicted relative to the computer <b>110</b>, or portions thereof, may be stored in the remote memory storage device. By way of example, and not limitation, <figref idref="DRAWINGS">FIG. 1</figref> illustrates remote application programs <b>185</b> as residing on memory device <b>181</b>. It will be appreciated that the network connections shown are exemplary and other means of establishing a communications link between the computers may be used.</p>
<p id="h-0007" num="0000">Protecting Data</p>
<p id="p-0033" num="0032">As mentioned previously, people often neglect to create backup copies of their data. <figref idref="DRAWINGS">FIG. 2</figref> is a block diagram that generally represents an exemplary environment in which aspects of the subject matter described herein may be implemented. As illustrated, the environment includes an apparatus <b>205</b> that includes primary storage <b>210</b>. The apparatus <b>205</b> is also connected to a backup storage <b>215</b>.</p>
<p id="p-0034" num="0033">The apparatus <b>205</b> may be implemented using one or more computing devices. Such devices may include, for example, personal computers, server computers, hand-held or laptop devices, multiprocessor systems, microcontroller-based systems, set-top boxes, programmable consumer electronics, network PCs, minicomputers, mainframe computers, cell phones, personal digital assistants (PDAs), gaming devices, printers, appliances including set-top, media center, or other appliances, automobile-embedded or attached computing devices, other mobile devices, distributed computing environments that include any of the above systems or devices, and the like. An exemplary device that may be configured to act as the apparatus <b>205</b> comprises the computer <b>110</b> of <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0035" num="0034">The primary storage <b>210</b> may include any storage media capable of storing data. The term data is to be read broadly to include anything that may be represented by one or more computer storage elements. Logically, data may be represented as a series of 1's and 0's in volatile or non-volatile memory. In computers that have a non-binary storage medium, data may be represented according to the capabilities of the storage medium. Data may be organized into different types of data structures including simple data types such as numbers, letters, and the like, hierarchical, linked, or other related data types, data structures that include multiple other data structures or simple data types, and the like. Some examples of data include information, program code, program state, program data, other data, and the like. The primary storage <b>210</b> may be implemented using the computer storage media described in conjunction with <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0036" num="0035">In one embodiment, the primary storage <b>210</b> may be internal to the apparatus <b>205</b>. In this embodiment, the primary storage <b>210</b> may be attached to the apparatus <b>205</b> in various ways as will be appreciated by those skilled in the art. As one example, the primary storage <b>210</b> may comprise a hard disk that is attached to an internal structure of the apparatus <b>205</b>.</p>
<p id="p-0037" num="0036">In another embodiment, the primary storage <b>210</b> may be external, or include components that are both internal and external to the apparatus <b>205</b>. For example, the primary storage may include a USB storage device, an iSCSI connected storage device, and the like.</p>
<p id="p-0038" num="0037">The primary storage <b>210</b> may include one or more physical devices that are of the same or different types. The one or more physical devices may be formatted with a file system. The apparatus <b>205</b> may rely on the primary storage <b>210</b> as the default storage to store file system objects (hereinafter sometimes referred to as files).</p>
<p id="p-0039" num="0038">The line <b>220</b> represents a connection from the apparatus <b>205</b> to the backup storage <b>215</b>. The computer may be connected to the backup storage <b>215</b> in a variety of ways. For example, the computer may be connected to the backup storage <b>215</b> via direct wired media such as a USB cable, IEEE 1394 cable, fiber-optic cable, or other physical media, wireless media such as RF, infrared, and other wireless media, and the like. The line <b>220</b> may represent a network that includes servers, routers, switches, and other networking devices, and the like that logically connects the apparatus <b>205</b> to the backup storage <b>215</b>.</p>
<p id="p-0040" num="0039">The backup storage <b>215</b> may become available and unavailable to the apparatus <b>205</b> and may be susceptible to being connected and disconnected frequently from the apparatus <b>205</b>. Furthermore, the backup storage <b>215</b> may change states between available and unavailable at predictable or unpredictable times&#x2014;at least from the perspective of the apparatus <b>205</b>.</p>
<p id="p-0041" num="0040">When the apparatus <b>205</b> detects that the backup storage <b>215</b> is available (e.g., the backup storage <b>215</b> has been connected to the computer, turned on, or otherwise made available), the apparatus <b>205</b> may seek to backup files that are stored on the primary storage <b>210</b> to the backup storage <b>215</b>.</p>
<p id="p-0042" num="0041">Because the backup storage <b>215</b> may be disconnected or otherwise made unavailable to the apparatus <b>205</b> at any time, the apparatus <b>205</b> may include logic and maintain data to track progress of creating backup copies of files of the primary storage <b>210</b> to the backup storage <b>215</b>.</p>
<p id="p-0043" num="0042">In addition, the apparatus <b>205</b> may also maintain a backup copy of files, including those that have been added or changed since last backup, on the primary storage <b>210</b> itself. Added may include added to a protected namespace (e.g., adding a file to a directory that is configured for backup), added by changing the protected namespace to include the file (e.g., changing the directories to be backed up), and the like. As used herein, the term changed is meant to include files that have been added or files that have been changed. For example, while the backup storage <b>215</b> is unavailable, a data protection engine executing on the apparatus <b>205</b> may periodically create copies of files that have changed on the primary storage <b>210</b> and store these copies in a designated location on the primary storage <b>210</b>. This designated location is sometimes referred to as a cache. Later, when the backup storage <b>215</b> becomes available, the data protection engine may copy the backup copies from the primary storage <b>210</b> to the backup storage <b>215</b>.</p>
<p id="p-0044" num="0043">If the backup storage <b>215</b> becomes unavailable while the computer is copying a file to the backup storage <b>215</b>, the apparatus <b>205</b> may maintain data that indicates that the file was not successfully copied, data that indicates how much of the file was copied to the backup storage, or other data indicative of the status of copying the file to the backup storage <b>215</b>.</p>
<p id="p-0045" num="0044">In particular, for each file that needs to be backed up the backup storage <b>215</b>, backup data may be maintained that indicates one of three states: not started, in progress (i.e., copied to cache), and processed (e.g., copied to backup storage). Not started indicates that the file has been marked as needing to be backed up, but that creating a backup copy of the file has not completed and perhaps not even started to either the cache of the primary storage <b>210</b> or the backup storage <b>215</b>. Sometimes as used herein not started is referred to as not completely copied. In progress means that a copy of the file has been created and stored on the cache of the primary storage <b>210</b>, but that the file has not been completely copied to the backup storage <b>215</b>. Processed means that a backup copy of the file has been stored on the backup storage <b>215</b>.</p>
<p id="p-0046" num="0045">A file may go from the not started state to the in progress state or the processed state, depending on whether the backup storage <b>215</b> is available or unavailable. In one embodiment, if the backup storage <b>215</b> is available, a copy of the file may stored on the backup storage <b>215</b> without creating a copy of the file for storage on the cache of the primary storage <b>210</b>. In another embodiment, a copy of the file may be stored both on the backup storage <b>215</b> and in the cache even if the backup storage <b>215</b> is available at the time the copy is made.</p>
<p id="p-0047" num="0046">After a file goes to the in progress state, the file may go to the processed state after the backup storage <b>215</b> becomes available and the file is copied from the cache to the backup storage <b>215</b>.</p>
<p id="p-0048" num="0047"><figref idref="DRAWINGS">FIG. 3</figref> is a block diagram that illustrates versions of and other data related to two exemplary files that may be backed up in accordance with aspects of the subject matter described herein. As illustrated, there are files <b>301</b> and <b>302</b>. File <b>301</b> has versions <b>305</b>-<b>308</b> while file <b>302</b> has version <b>310</b>-<b>315</b>. The versions <b>305</b>-<b>308</b> and <b>310</b>-<b>315</b> represent different versions of the files <b>301</b>-<b>302</b>, respectively, as the versions existed at certain times. The data <b>321</b> and <b>322</b> represents backup state that may be stored regarding the files <b>301</b> and <b>302</b>, respectively.</p>
<p id="p-0049" num="0048">In operation, only the last version of a file may be in the not started state. For example, the last version <b>308</b> of the file <b>301</b> may be in the not started state while the last version <b>315</b> of the file <b>302</b> may be in the not started state. The last version of a file is not required to be in the not started state and may be in the in progress state or the processed state.</p>
<p id="p-0050" num="0049">Various updates may occur to the data <b>321</b> and <b>322</b> depending on what happens while attempting to backup versions of files. For example, if a file is in the not started state and a data protection engine attempts to back up the file and the file changes during the backup attempt, the version may be remarked as not started. In addition, updates to namespace records may occur as will be explained in more detail below.</p>
<p id="p-0051" num="0050">In backup data for a file, there may be one or more versions that are marked as processed as well as one or more versions that are marked as in process. An exemplary representation of this data is illustrated by data <b>321</b> and <b>322</b>, where P stands for processed, IP stands for in progress, and NS stands for not started.</p>
<p id="p-0052" num="0051">Returning to <figref idref="DRAWINGS">FIG. 2</figref>, the apparatus <b>205</b> may include hardware and/or software that detects when the state of availability changes for the backup storage <b>215</b>. When the state changes, the data protection engine may be informed or otherwise become aware of the state change and may take actions to seamlessly continue protecting changed files by copying the files to a designated portion of the primary storage <b>210</b> or the backup storage <b>215</b>. For example, if the backup storage <b>215</b> becomes unavailable while the data protection engine is copying a file from the primary storage <b>210</b> to the backup storage <b>215</b>, the data protection engine may copy the file to a cache on the primary storage <b>210</b> and may subsequently copy other files that change to the cache on the primary storage <b>210</b> until the backup storage <b>215</b> again becomes available.</p>
<p id="p-0053" num="0052">Likewise, if the backup storage <b>215</b> becomes available while the data protection engine is copying files from the primary storage <b>210</b> to a cache in the primary storage <b>210</b>, the data protection engine may start copying changed files from the primary storage <b>210</b> to the backup storage <b>215</b> and may also copy files from the cache in the primary storage <b>210</b> to the backup storage <b>215</b>.</p>
<p id="p-0054" num="0053">The term cache as used herein means a portion of the primary storage <b>210</b> that is reserved or used to store backup copies of files. The cache may be located in a directory or may be spread throughout the file system of the primary storage <b>210</b>. The cache may be expandable, shrinkable, or fixed in size and may be dependent on a total size of the primary storage <b>210</b>.</p>
<p id="p-0055" num="0054">When the backup storage <b>215</b> is not available, backup copies of files may be copied to a cache in the primary storage <b>210</b>. Once a version of a file is successfully copied to the cache, the state of the version may be marked as in progress.</p>
<p id="p-0056" num="0055">That backup storage <b>215</b> may be treated as unavailable for a given file if it does not include enough free space to store a backup copy of a file that needs to be backed up. In that case, the file may be copied to the cache in the primary storage <b>210</b>. Once space becomes available on the backup storage <b>215</b> or a different backup storage device is connected, the file may then be copied to the backup storage. When it is connected to the apparatus <b>205</b>, the backup storage <b>215</b> may treated as available for files that are small enough to fit in the free space of the backup storage <b>215</b> while at the same time being treated as unavailable for files that are not small enough to fit in the free space.</p>
<p id="p-0057" num="0056">If the cache gets full, various actions may be taken to protect files that have changed on the primary storage <b>210</b>. In one embodiment, a configurable number of the most recent files are protected. For example, referring to <figref idref="DRAWINGS">FIG. 3</figref>, if there is not enough space on the cache for version associated with record <b>330</b> of the file <b>302</b>, the backup copy for the in progress copy of the file associated with the record <b>325</b> may be deleted from the cache to make room for another copy of the file <b>302</b> to be stored on the cache.</p>
<p id="p-0058" num="0057">In some cases when seeking to free space in the cache, an old version may be selected from a different file than the one for which a backup copy is needed. For example, referring to <figref idref="DRAWINGS">FIG. 3</figref>, if space is needed in the cache to back up a version of the file <b>301</b>, the space freed from the cache may come from deleting one or more versions associated with the file <b>302</b> or other files. In one embodiment, the one or more versions may be selected based on age because they are the oldest versions stored in the cache.</p>
<p id="p-0059" num="0058">In addition to deleting a version of a file from the cache, a namespace record may be modified to accommodate the deletion of this version from the cache. To track a namespace for versions of files over time, a catalog may be maintained as disclosed in a United States patent application entitled &#x201c;FILE SYSTEM BACKUP USING CHANGE JOURNAL,&#x201d; filed Dec. 3, 2010, having Ser. No. 12/959,401, which application is assigned to the assignee of this patent application and hereby incorporated by reference. This catalog may be updated by 1) removing a namespace record for each version that is deleted from the cache and 2) potentially updating a remaining namespace record to account for the change in time covered by a version associated with the namespace record.</p>
<p id="p-0060" num="0059"><figref idref="DRAWINGS">FIG. 4</figref> is a block diagram that generally represents actions that may occur in freeing space in a cache in accordance with aspects of the subject matter described herein. The data <b>410</b> includes backup data for versions of a file. The data <b>405</b> includes namespace data associated with the records of the data <b>410</b>. In particular, the namespace records <b>415</b>-<b>420</b> are associated with the versions <b>425</b>-<b>430</b> of the file <b>410</b> and indicate that the version <b>425</b> existed from time <b>1</b>-<b>3</b>, the version <b>426</b> existed from time <b>4</b>-<b>9</b>, the version <b>427</b> existed from time <b>10</b>-<b>15</b>, the version <b>428</b> existed from time <b>16</b>-<b>18</b>, and version <b>429</b> existed from time <b>19</b>-<b>21</b>, and the version <b>420</b> existed from time <b>22</b> onward.</p>
<p id="p-0061" num="0060">After deleting the version <b>427</b> and its associated namespace record <b>417</b>, the namespace record <b>416</b> may be changed to indicate an end time of the version <b>427</b> as illustrated by the data <b>412</b>. If the namespace record associated with the record <b>324</b> is the last in the lineage for a file (e.g., the file was deleted and a new file having the same name was created), the namespace record for the previous version may not be changed to have an end time of the deleted namespace record.</p>
<p id="p-0062" num="0061">If a version is deleted from the cache for an in progress record that is the last record for the file, the state of the backup for the last record may be changed from in progress to not started. The last record may also be flagged to indicate that the file is not to be backed up into the cache unless the file changes again.</p>
<p id="p-0063" num="0062">It is possible that an in progress record that is about to be deleted is associated with a file that has partially been copied to the backup storage <b>215</b> already. If the backup storage <b>215</b> is not available at the time of deletion, the file record may not be deleted completely. Instead, the file record may be marked with a &#x201c;to be deleted&#x201d; flag. Once the backup storage <b>215</b> becomes available again and the data protection engine is able to delete the partial copy of the file, the file record may then be deleted completely. In one implementation, the data protection engine may process files marked with the &#x201c;to be deleted&#x201d; flag before backing up files to the backup storage <b>215</b>. Namespace changes described previously may be performed immediately, even if the backup storage <b>215</b> is not available at the moment.</p>
<p id="p-0064" num="0063"><figref idref="DRAWINGS">FIG. 5</figref> is a block diagram that represents a system configured in accordance with aspects of the subject matter described herein. The components illustrated in <figref idref="DRAWINGS">FIG. 5</figref> are exemplary and are not meant to be all-inclusive of components that may be needed or included. In other embodiments, the components described in conjunction with <figref idref="DRAWINGS">FIG. 5</figref> may be included in other components (shown or not shown) or placed in subcomponents without departing from the spirit or scope of aspects of the subject matter described herein. In some embodiments, the components and/or functions described in conjunction with <figref idref="DRAWINGS">FIG. 5</figref> may be distributed across multiple devices.</p>
<p id="p-0065" num="0064">Turning to <figref idref="DRAWINGS">FIG. 5</figref>, the apparatus <b>500</b> may include data protection components <b>510</b>, a store <b>535</b>, a communications mechanism <b>530</b>, and other components (not shown). The apparatus <b>500</b> corresponds to the apparatus <b>205</b> and may be implemented as the apparatus <b>205</b> may be implemented.</p>
<p id="p-0066" num="0065">The communications mechanism <b>530</b> allows the apparatus <b>500</b> to communicate with other entities. For example, the communications mechanism <b>530</b> may allow the apparatus to communicate with one or more devices (e.g., network attached storage, a storage area network device, a file server, or the like) that store backup copies of files included on the primary storage <b>535</b>. The communications mechanism <b>530</b> may be a network interface or adapter <b>170</b>, modem <b>172</b>, USB or other port, or any other mechanism for establishing communications as described in conjunction with <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0067" num="0066">The primary storage <b>535</b> is any storage media capable of storing data including files of the apparatus <b>500</b>. The primary storage <b>535</b> may be implemented with a file system, database, volatile memory such as RAM, other storage, some combination of the above, and the like and may be distributed across multiple devices. The primary storage <b>535</b> may be external, internal, or include components that are both internal and external to the apparatus <b>500</b>. The primary storage <b>535</b> may operate similar to the primary storage <b>210</b> of <figref idref="DRAWINGS">FIG. 2</figref>.</p>
<p id="p-0068" num="0067">The backup storage <b>540</b> also includes any storage media capable of storing data. The backup storage <b>540</b> is external to the apparatus <b>500</b> and may be stand alone or implemented on a server. The backup storage <b>540</b> may be implemented using a file system, database, nonvolatile memory, volatile memory such as RAM, other storage, some combination of the above, and the like and may be distributed across multiple devices. The backup storage <b>540</b> may operate similar to the backup storage <b>210</b> of <figref idref="DRAWINGS">FIG. 2</figref>.</p>
<p id="p-0069" num="0068">The data protection components <b>510</b> may include a change detector <b>515</b>, a cache manager <b>520</b>, a data protection engine <b>517</b>, a connectivity detector <b>525</b>, and other components (not shown). As used herein, the term component is to be read to include hardware such as all or a portion of a device, a collection of one or more software modules or portions thereof, some combination of one or more software modules or portions thereof and one or more devices or portions thereof, and the like.</p>
<p id="p-0070" num="0069">The connectivity detector <b>525</b> may be operable to determine the availability of the backup storage <b>540</b> as availability has been described in conjunction with <figref idref="DRAWINGS">FIG. 2</figref>.</p>
<p id="p-0071" num="0070">The change detector <b>515</b> is a component that detects whether changes have occurred to files of a protected namespace. For example, the change detector <b>515</b> may use timestamps, may monitor changes made to the file system, or may use other mechanisms to determine whether changes have occurred. Based on the teachings herein, those skilled in the art may recognize other ways for detecting whether changes have occurred to files that may be used without departing from the spirit or scope of aspects of the subject matter described herein.</p>
<p id="p-0072" num="0071">When the change detector <b>515</b> determines that a file has changed, the change detector <b>515</b> may communicate with the data protection engine <b>517</b> to indicate the file has changed. In response, the data protection engine <b>517</b> may undertake actions to back up the file (and other files that have changed) to the primary storage <b>535</b> or the backup storage <b>540</b>. For example, the data protection engine may perform actions including:</p>
<p id="p-0073" num="0072">1. If the backup storage <b>540</b> is available, copying a file to the backup storage <b>540</b>; and</p>
<p id="p-0074" num="0073">2. If the backup storage <b>540</b> is not available, copying the file to the cache via the cache manager <b>520</b>.</p>
<p id="p-0075" num="0074">Under the direction of the data protection engine <b>517</b>, the cache manager <b>520</b> may operate to store, in a cache, backup copies of versions of the files located on the primary storage <b>535</b>. The cache manager <b>520</b> may be further operable to delete versions of files in the cache to make additional free space available in the cache for storing recent versions of files.</p>
<p id="p-0076" num="0075">In conjunction with deleting files in the cache via the cache manager <b>520</b>, the data protection engine <b>517</b> may be further operable to update a data structure (e.g., such as a catalog) to delete records (e.g., a namespace record and a file record) associated with a deleted version of a file. The data protection engine <b>517</b> may also update another record (e.g., a previous namespace record) associated with a second version of the file to indicate that the second version has an ending time of the deleted version as mentioned previously in conjunction with <figref idref="DRAWINGS">FIGS. 2-4</figref>.</p>
<p id="p-0077" num="0076">The data protection engine <b>517</b> may also maintain state of copying the files to storage as mentioned previously where the state includes: not started, copied to cache, and copied to second storage.</p>
<p id="p-0078" num="0077"><figref idref="DRAWINGS">FIGS. 6-7</figref> are flow diagrams that generally represent exemplary actions that may occur in accordance with aspects of the subject matter described herein. For simplicity of explanation, the methodology described in conjunction with <figref idref="DRAWINGS">FIGS. 6-7</figref> is depicted and described as a series of acts. It is to be understood and appreciated that aspects of the subject matter described herein are not limited by the acts illustrated and/or by the order of acts. In one embodiment, the acts occur in an order as described below. In other embodiments, however, the acts may occur in parallel, in another order, and/or with other acts not presented and described herein. Furthermore, not all illustrated acts may be required to implement the methodology in accordance with aspects of the subject matter described herein. In addition, those skilled in the art will understand and appreciate that the methodology could alternatively be represented as a series of interrelated states via a state diagram or as events.</p>
<p id="p-0079" num="0078">Turning to <figref idref="DRAWINGS">FIG. 6</figref>, at block <b>605</b>, the actions begin. At block <b>610</b>, a determination is made that a file has changed and needs to be backed up. For example, referring to <figref idref="DRAWINGS">FIG. 5</figref>, the change detector <b>515</b> may detect that a change has occurred to a file on the primary storage <b>535</b>.</p>
<p id="p-0080" num="0079">At block <b>615</b>, backup storage availability may be detected. For example, referring to <figref idref="DRAWINGS">FIG. 5</figref>, the connectivity detector <b>525</b> may receive notification from an operating system (OS) component, may poll an OS or other component, may inspect data structures that indicate connectivity, may attempt to communicate with the backup storage, or may take other actions or the like to detect whether the backup storage <b>540</b> is available to the apparatus <b>500</b>. Detecting that the backup storage <b>540</b> is available may include determining that the backup storage <b>540</b> has been directly connected via a wired or wireless media or detecting that backup storage <b>540</b> is reachable via a network connected to the apparatus <b>500</b>. Detecting whether the backup storage <b>540</b> is available may also involve checking free space on the backup storage <b>540</b> as described previously. If the free space is less than the size of the file, it may be determined that the backup storage <b>540</b> is not available.</p>
<p id="p-0081" num="0080">At block <b>620</b>, if the backup storage is available, the actions continue at block <b>625</b>; otherwise, the actions continue at block <b>630</b>.</p>
<p id="p-0082" num="0081">At block <b>625</b>, the file is copied to the backup storage. For example, referring to <figref idref="DRAWINGS">FIG. 5</figref>, the data protection engine <b>517</b> may attempt to copy a file from the primary storage <b>535</b> to the backup storage <b>540</b>. If the attempt is successful, the actions continue at block <b>635</b>; otherwise, the actions may continue at block <b>640</b>.</p>
<p id="p-0083" num="0082">At block <b>630</b>, the file is copied to the cache of the primary storage. For example, referring to <figref idref="DRAWINGS">FIG. 5</figref>, the data protection engine <b>517</b> may attempt to copy a file from the primary storage <b>535</b> to cache on the primary storage <b>535</b>.</p>
<p id="p-0084" num="0083">Before copying the file to the cache, a check may be performed to determine if the cache has enough free space in which to copy the file. If not, space may be freed in the cache previously prior to copying the file to the cache. This may involve deleting a first namespace record and a file record associated with a version that is being deleted and updating a second namespace record to have an ending time of the first namespace record as mentioned previously.</p>
<p id="p-0085" num="0084">If the attempt to copy the file to the cache successful, the actions continue at block <b>635</b>; otherwise, the actions may continue at block <b>640</b>.</p>
<p id="p-0086" num="0085">At block <b>635</b>, state and other information (e.g., a catalog that includes a namespace) of the backup operation may be updated. For example, referring to <figref idref="DRAWINGS">FIG. 5</figref>, the data protection engine <b>517</b> may update the state of the backup from not started to in progress if the file was copied to the cache or to processed if the file was copied to the backup storage <b>540</b>. Updating the other information may include updating a data structure to indicate whether the file has been copied to the cache, the backup storage, or both the cache and the backup storage.</p>
<p id="p-0087" num="0086">If at any time the availability of the backup storage changes state, subsequent backup operations may proceed accordingly. For example, if the backup storage state changes from being available to no longer available, this may be detected (e.g., through a failure of a file operation, through notification of state change, or the like), and the file may then be copied to the cache. Likewise, if the backup storage state changes from unavailable to available, files may begin being copied from the primary storage <b>535</b> to the backup storage <b>540</b>.</p>
<p id="p-0088" num="0087">In some implementations, a data protection engine may have time constraints for copying files to the backup storage. For example, the data protection engine may be given a certain amount of time to backup changed files to the backup storage. As another example, a computer hosting the data protection engine may notify the data protection engine of a pending shutdown (e.g., a user may shut a laptop lid). Based on these time constraints, the data protection engine may stop the copying operation of a file while maintaining an indication that the file still needs to be copied. Maintaining an indication may include leaving the state of the file (e.g., not started or in progress) unchanged. When another backup cycle is started, the data protection engine may resume copying one or more portions of the file that were not copied in the previous backup cycle to the cache or second storage.</p>
<p id="p-0089" num="0088">At block <b>640</b>, other actions, if any, may be performed.</p>
<p id="p-0090" num="0089">Turning to <figref idref="DRAWINGS">FIG. 7</figref> at block <b>705</b>, the actions begin. At block <b>710</b>, a file change is detected. For example, referring to <figref idref="DRAWINGS">FIG. 5</figref>, the change detector <b>515</b> may detect that a change has occurred to a file on the primary storage <b>535</b>.</p>
<p id="p-0091" num="0090">At block <b>715</b>, the second storage may be detected at not available. For example, referring to <figref idref="DRAWINGS">FIG. 5</figref>, the connectivity detector <b>525</b> may detect that the backup storage is not connected to the apparatus <b>500</b>.</p>
<p id="p-0092" num="0091">At block <b>720</b>, the cache is checked to determine whether the cache has sufficient free space to store a copy of the file. For example, the data protection engine <b>517</b> may employ the cache manager <b>520</b> to check the free space of the cache stored on the primary storage <b>535</b>. For example, the cache may not have sufficient free space to store a copy of the file.</p>
<p id="p-0093" num="0092">At block <b>725</b>, space in the cache is freed to make room for copying the file. For example, employing the cache manager <b>520</b>, the data protection engine <b>517</b> may delete previous versions of files and update data structures as previously indicated.</p>
<p id="p-0094" num="0093">At block <b>730</b>, the file may be copied to the cache. For example, referring to <figref idref="DRAWINGS">FIG. 5</figref>, the data protection engine <b>517</b> may employ the cache manager <b>520</b> to copy a file from the primary storage <b>535</b> to the cache.</p>
<p id="p-0095" num="0094">If during a backup cycle, the backup storage is detected as available, files from the cache may be copied from the cache to the backup storage as indicated in block <b>740</b>. For example, referring to <figref idref="DRAWINGS">FIG. 5</figref>, the data protection engine <b>517</b> may receive notification from the connectivity detector <b>525</b> that the backup storage <b>540</b> is available.</p>
<p id="p-0096" num="0095">At block <b>745</b>, in response to the indication of availability above, files may be copied from the cache to the backup storage. For example, referring to <figref idref="DRAWINGS">FIG. 5</figref>, after receiving an indication that the backup storage <b>540</b> is available, the data protection engine <b>517</b> may start copying files from the cache to the backup storage <b>540</b>.</p>
<p id="p-0097" num="0096">In addition if a time constraint dictates that the backup cycle end, the data protection engine may stop the copying of files and may maintain data structures that indicate the files that still need to be backed up as well as the portions of the files that need to be backed up for files that were only partially copied.</p>
<p id="p-0098" num="0097">At block <b>730</b>, other actions, if any, may be performed.</p>
<p id="p-0099" num="0098">As can be seen from the foregoing detailed description, aspects have been described related to data protection. While aspects of the subject matter described herein are susceptible to various modifications and alternative constructions, certain illustrated embodiments thereof are shown in the drawings and have been described above in detail. It should be understood, however, that there is no intention to limit aspects of the claimed subject matter to the specific forms disclosed, but on the contrary, the intention is to cover all modifications, alternative constructions, and equivalents falling within the spirit and scope of various aspects of the subject matter described herein.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method implemented at least in part by a computer, the computer comprising a cache storage, a primary storage device, the computer further comprising a network interface providing intermittent connectivity via a network to a backup storage device on the network, the method comprising:
<claim-text>performing a single backup cycle to backup the primary storage device, the single backup cycle comprising:
<claim-text>identifying target files on the primary storage device that have changed and need to be backed up;</claim-text>
<claim-text>monitoring for availability of the backup storage device via the network to detect when the backup storage device becomes available and to detect when the backup storage device becomes unavailable;</claim-text>
<claim-text>when copying a first portion of the target files from the primary storage device to the backup storage device and the monitoring indicates that the backup storage device has become unavailable, copying the first portion of the target files to a cache on the primary storage device and updating status information indicating that the first portion of the target files are in the process of being backed up;</claim-text>
<claim-text>when about to copy a second portion of the target files from the primary storage device to the cache the monitoring indicates that the backup storage device has become available: beginning copying the first portion of the target files from the cache to the backup storage, beginning copying of the second portion of the target files from the primary storage device to the backup storage device, and as the target files in the first portion of the target files are copied from the cache storage to the backup storage device updating the status information to indicate that such files have been backed up.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein monitoring for availability comprises checking free space on the backup storage device and if the free space is less than a size of a file to be backed up determining that the backup storage is not available.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the cache is stored on the primary storage device, the method further comprising freeing space in the cache prior to copying a file to the cache.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein freeing space in the cache comprises deleting a first namespace record and a file record and updating a second namespace record to have an ending time of the first namespace record.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising updating the status information to indicate whether a target file has been copied to the cache, the backup storage device, or to both the cache and the backup storage device.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising, based on time constraints, stopping a copying operation of a target file, maintaining an indication that the target file or a portion thereof still needs to be copied, and upon another backup cycle copying the file or the portion thereof to the cache or backup storage device.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. A computer comprising:
<claim-text>a primary storage storing target files to be backed up to a backup storage, the target files comprising files on the primary storage identified as requiring backup;</claim-text>
<claim-text>a cache manager operable to store, in a cache, backup copies of the target files on the primary storage, wherein the cache is maintained on the primary storage;</claim-text>
<claim-text>a connectivity detector operable to monitor for changes in availability and unavailability of a backup storage to store backup copies of the target files; and</claim-text>
<claim-text>a data protection engine operable to communicate with the connectivity detector when performing a backup to obtain changes in availability and unavailability of the backup storage and to perform a single backup cycle to backup the target files from the primary storage, the single backup cycle comprising:
<claim-text>whenever the backup storage is determined to have become available: whenever there are backup copies of target files in the cache that have not been copied to the backup storage copying same to the backup storage, and whenever there are target files on the primary storage that still require backup copying same to the backup storage,</claim-text>
<claim-text>whenever the backup storage is determined to have become unavailable: stopping any copying to the backup storage of target files still requiring backup and instead copying those of the target files still requiring backup to the cache via the cache manager, and</claim-text>
<claim-text>for each target file, tracking whether such target file has been copied to the cache or to the backup storage.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The system of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the primary storage is internal to the apparatus and the backup storage is external to the apparatus.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The system of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the backup storage is connected to the apparatus via a direct wired connection.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The system of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the backup storage is connected to the apparatus via a network.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The system of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the cache manager is further operable to delete in the cache a first version of a target file, and wherein the data protection engine is further operable to update a data structure to delete records associated with the first version and to update another record associated with a previous version of the file to indicate that the previous version has an ending time of the first version.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The system of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the data protection engine is further operable to indicate a state of copying a target file, the state including: not completely copied to cache or second storage, copied to cache, and copied to second storage.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. A method of performing a backup for a primary storage device of a computing device, the method comprising:
<claim-text>executing a backup engine that backs files on the primary storage device up to a backup device, the primary storage device comprising a cache, and during a single backup cycle the backup engine:
<claim-text>tracks backup statuses of respective target files on the primary storage as either incomplete, in-progress, or complete;</claim-text>
<claim-text>each time there is a determination that the backup device has become available, responds by: beginning to copy any files in the cache to the backup device and changing corresponding statuses to indication completion as such files finish being copied to the backup device, and by beginning to copy files from the primary device to the backup device and changing corresponding statuses to indicate completion as such files finish being copied to the backup device; and</claim-text>
<claim-text>each time there is a determination that the backup device has become unavailable: stopping copying any files in the cache to the backup device and leaving the corresponding statuses indicating in-progress, stopping copying files from the primary device to the backup device, and beginning copying files from the primary device to the cache and changing the corresponding statuses to indicate in-progress.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. A method according to <claim-ref idref="CLM-00013">claim 13</claim-ref>, further comprising monitoring for availability of the backup device to make the determinations that the backup device is available or unavailable.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. A method according to <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein the backup device connects with the computing device via a local bus or direct wireless connection.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. A method according to <claim-ref idref="CLM-00013">claim 13</claim-ref>, further comprising monitoring for availability of the backup device to make the determinations that the backup device is available or unavailable.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. A method according to <claim-ref idref="CLM-00013">claim 13</claim-ref>, further comprising determining that the cache has reached a capacity and in response eliminating files from the cache according to age of the files in the cache.</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. A method according to <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the primary storage is internal to the computing device and the backup storage is external to the computing device.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. A method according to <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the method permits the backup cycle to complete backing up the target files despite the backup device becoming unavailable during the backup cycle.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. A method according to <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the target files were identified as files on the primary storage device that have changed.</claim-text>
</claim>
</claims>
</us-patent-grant>
