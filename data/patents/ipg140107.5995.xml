<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08627118-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08627118</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12785818</doc-number>
<date>20100524</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>637</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>1</main-group>
<subgroup>26</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>1</main-group>
<subgroup>32</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>713300</main-classification>
<further-classification>713310</further-classification>
<further-classification>713320</further-classification>
</classification-national>
<invention-title id="d2e53">Chassis power allocation using expedited power permissions</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5752046</doc-number>
<kind>A</kind>
<name>Oprescu et al.</name>
<date>19980500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6804616</doc-number>
<kind>B2</kind>
<name>Bodas</name>
<date>20041000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>702 61</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>7043647</doc-number>
<kind>B2</kind>
<name>Hansen et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7051215</doc-number>
<kind>B2</kind>
<name>Zimmer et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713300</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7353415</doc-number>
<kind>B2</kind>
<name>Zaretsky et al.</name>
<date>20080400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713320</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>7484111</doc-number>
<kind>B2</kind>
<name>Fund</name>
<date>20090100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2002/0007463</doc-number>
<kind>A1</kind>
<name>Fung</name>
<date>20020100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2004/0117536</doc-number>
<kind>A1</kind>
<name>Franke et al.</name>
<date>20040600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2004/0268157</doc-number>
<kind>A1</kind>
<name>Dake et al.</name>
<date>20041200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2006/0206730</doc-number>
<kind>A1</kind>
<name>Cartes et al.</name>
<date>20060900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713300</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2007/0061599</doc-number>
<kind>A1</kind>
<name>Mentzer et al.</name>
<date>20070300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713300</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2008/0136607</doc-number>
<kind>A1</kind>
<name>Ratcliff et al.</name>
<date>20080600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>2008/0244283</doc-number>
<kind>A1</kind>
<name>Elliott et al.</name>
<date>20081000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>2008/0244311</doc-number>
<kind>A1</kind>
<name>Elliott et al.</name>
<date>20081000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>2008/0313476</doc-number>
<kind>A1</kind>
<name>Hansen</name>
<date>20081200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713300</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>2009/0171511</doc-number>
<kind>A1</kind>
<name>Tolentino</name>
<date>20090700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>15</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>713300</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>713310</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>713320</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>3</number-of-drawing-sheets>
<number-of-figures>4</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20110289327</doc-number>
<kind>A1</kind>
<date>20111124</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Nolterieke</last-name>
<first-name>Michael H.</first-name>
<address>
<city>Raleigh</city>
<state>NC</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Pagan</last-name>
<first-name>William G.</first-name>
<address>
<city>Durham</city>
<state>NC</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Nolterieke</last-name>
<first-name>Michael H.</first-name>
<address>
<city>Raleigh</city>
<state>NC</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Pagan</last-name>
<first-name>William G.</first-name>
<address>
<city>Durham</city>
<state>NC</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<last-name>Seal</last-name>
<first-name>Cynthia G.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
<agent sequence="02" rep-type="attorney">
<addressbook>
<last-name>Streets</last-name>
<first-name>Jeffrey L.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>International Business Machines Corporation</orgname>
<role>02</role>
<address>
<city>Armonk</city>
<state>NY</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Yanchus, III</last-name>
<first-name>Paul</first-name>
<department>2116</department>
</primary-examiner>
<assistant-examiner>
<last-name>Choudhury</last-name>
<first-name>Zahid</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">In one embodiment, a fixed chassis power budget is dynamically allocated to a plurality of servers inserted into a multi-server chassis. An inserted server may be inventoried by sequentially identifying server components, categorically-defined component power limits, and actual component power requirements of the inventoried components. A power permission may be granted to the inserted server prior to completion of the inventory, based on power-related information inferred from a chassis and server specification or from the inventoried components.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="239.35mm" wi="185.59mm" file="US08627118-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="238.42mm" wi="184.57mm" file="US08627118-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="241.05mm" wi="176.95mm" orientation="landscape" file="US08627118-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="243.59mm" wi="188.47mm" file="US08627118-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND</heading>
<p id="p-0002" num="0001">1. Field of the Invention</p>
<p id="p-0003" num="0002">The present invention relates to power management in a rack-mountable server chassis.</p>
<p id="p-0004" num="0003">2. Background of the Related Art</p>
<p id="p-0005" num="0004">A datacenter is a facility having one or more racks of computer equipment housed in a computer room for convenient access by datacenter personnel. The computer room provides a controlled environment and infrastructure conducive to operating the computer equipment. For example, a computer room may provide electrical utilities with the capacity to power a large volume of rack-mounted computer equipment, and a cooling system capable of removing the correspondingly large quantity of heat generated by the rack-mounted computer equipment. The cooling system in many installations will include a particular arrangement of equipment racks into alternating hot aisles and cold aisles, and a computer room air conditioner (&#x201c;CRAC&#x201d;) capable of maintaining a room temperature well below the temperature limits of the computer equipment.</p>
<p id="p-0006" num="0005">Each rack may support one or more equipment chassis in a stacked relationship. For example, a rack mountable multi-server chassis typically includes multiple server bays having standardized dimensions, so that each server bay can receive a server of corresponding size. The server bays may be closely spaced and aligned to consolidate the servers in a compact, high-density arrangement. A multi-server chassis will also typically include support modules providing shared resources to the servers, such as a power module providing electrical power to the servers, a blower module for moving air through the servers, a network module providing network connectivity to the servers, and a supervisory controller for managing power and other chassis resources. Using support modules to provide shared resources allows the individual servers and the chassis receiving the servers to be made even smaller and more compact.</p>
<p id="p-0007" num="0006">Servers are typically hot pluggable, so that each server may be individually inserted into a respective bay without significant interruption to any other servers already installed and operating within the multi-server chassis. When a server is inserted into a server bay of the chassis, connectors on the back of the server may mate with corresponding connectors on a midplane or backplane within the chassis, providing electrical power to the server and network connectivity between the server and other servers and equipment. A server may also boot when inserted into a bay. As the server boots, the server may gather information about its own onboard resources, such as hardware and software. When this process is complete, the server may request an amount of power permission from the supervisory controller. The length of time it takes for a server to fully boot, and to subsequently request power permission from a supervisory controller, can be considerable. In some systems, this process of generating an inventory may take more than a minute to complete.</p>
<heading id="h-0002" level="1">BRIEF SUMMARY</heading>
<p id="p-0008" num="0007">A first example embodiment of the present invention provides a method, wherein a fixed chassis power budget is allocated among one or more servers in a multi-server chassis. An insertion of a server into the multi-server chassis is detected. The inserted server is inventoried in response to the insertion. The inventorying includes sequentially identifying a plurality of server components and obtaining a component power requirement of each server component. A power permission is granted to the inserted server prior to completing the inventorying. Upon completing the inventorying, a power permission is granted to the inserted server according to the total power requirements of the plurality of server components.</p>
<p id="p-0009" num="0008">A second example embodiment of the invention provides a power management system including a local controller on a server and a supervisory controller on the multi-server chassis. The local controller is configured for generating an inventory of server components of a server in response to insertion of the server into a multi-server chassis, and for requesting a power permission upon completion of the inventory as a function of the inventoried server components. The supervisory controller is configured for dynamically allocating a fixed chassis power budget among servers in the chassis, including selectively granting the requested power permission to the inserted server upon completion of the inventory and granting a power permission to the inserted server prior to completion of the inventory.</p>
<p id="p-0010" num="0009">A third example embodiment provides a computer program product including computer usable program code embodied on a computer usable storage medium. The computer program product includes computer usable program code for allocating a fixed chassis power budget among one or more servers in a multi-server chassis, for detecting an insertion of a server into the multi-server chassis, for receiving and selectively granting a request for a power permission from the inserted server, and for granting a power permission to the inserted server prior to receiving the request for the power permission.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE SEVERAL VIEWS OF THE DRAWINGS</heading>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic diagram of a computer system that may be power-managed according to one or more embodiments of the invention.</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 2</figref> is a flowchart summarizing a method of managing a chassis power budget according to an embodiment of the invention.</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 3</figref> is a table providing an example of a chassis power budget for the hypothetical type-XYZ chassis of <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 4</figref> is a table providing an example inventory for an individual server.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0015" num="0014">Embodiments of the present invention are directed to expediting power permission to a server after it has been installed in a multi-server chassis. In one embodiment, a chassis supervisory controller dynamically allocates a fixed power budget among the servers in the chassis, including selectively granting power permissions to each of the installed servers. In response to the insertion and connection of a server, an inventory is generated to identify the components of the installed server and the power requirements associated with those components. Although the total server power requirement is not known until completion of the inventory, power permission may be granted to a server prior to completing an inventory of the components included within the server. In some cases, power permission may be granted to a server even prior to obtaining any component inventory data about the server.</p>
<p id="p-0016" num="0015">The maximum power requirement of a specific server is a function of its individual components and is often less than a server power limit (SPL) specified for a server of its type. For example, a server specification may limit every server of a hypothetical type &#x201c;ABC&#x201d; to a server power limit of 500 W. However, the actual power requirement of a particular type-ABC server may be less than the server power limit of 500 W, depending on how the server is configured. For example, a fully functioning type-ABC server may have fewer than all of the components allowed by the server specification, or the power requirements of the individual components may be less than the power limits for that component as provided by the server specification. Thus, if the chassis power budget has a sufficient amount of power remaining unallocated to other servers, power permission may be granted to an additional server in the full amount of the server power limit (e.g. 500 W) without any delay waiting for a server component inventory. As the inventory process progresses, and/or upon completion of the inventory, the power permission may be granted or adjusted according to the actual power requirements of inventoried components. Thus, power permission may be granted to a server before a full inventory can be obtained.</p>
<p id="p-0017" num="0016">The method may be implemented in the form of a computer program product embodied on a computer usable storage medium including computer usable program code for performing the methods steps. The method may also be implemented by a power management system including a supervisory controller, such as the chassis management module, and a local controller provided on each server.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic diagram of a computer system <b>10</b> that may be power-managed according to one or more embodiments of the invention. The computer system <b>10</b> includes a rack mountable multi-server chassis <b>12</b> having a plurality (&#x201c;M&#x201d;) of server bays <b>14</b> for receiving up to a like number of servers <b>20</b>. The servers <b>20</b> are labeled from &#x201c;Server <b>1</b>&#x201d; to &#x201c;Server M&#x201d; and the server bays <b>14</b> are individually labeled &#x201c;Bay <b>1</b>&#x201d; to &#x201c;Bay M.&#x201d; Each server bay <b>14</b> may have a standard size, as set forth in a chassis specification <b>16</b>, for receiving a server <b>20</b> having corresponding standard dimensions of height &#x201c;H,&#x201d; width &#x201c;W,&#x201d; and depth &#x201c;D.&#x201d; The standard, uniform sizing of the server bays <b>14</b> and of the servers <b>20</b> allows the servers <b>20</b> to be interchangeably inserted into any of the bays <b>14</b> for hot plugging into the chassis <b>12</b>. The first four bays (Bay <b>1</b> to Bay <b>4</b>) are shown occupied by four servers (Server <b>1</b> to Server <b>4</b>) having been inserted into respective server bays <b>14</b>. Server M is shown outside the chassis, but ready for insertion into Bay M, as indicated.</p>
<p id="p-0019" num="0018">The servers <b>20</b> in this embodiment are optionally blade servers, which receive shared chassis resources such as power, cooling, and network connectivity from a plurality of support modules <b>30</b> in the chassis. The support modules <b>30</b> include, by way of example, a power module <b>31</b>, a chassis management module <b>32</b>, a blower module <b>33</b>, and a network switch module <b>34</b>. The power module <b>31</b> supplies power to the servers <b>20</b> currently in the chassis <b>12</b>. The chassis management module <b>32</b> manages chassis resources, such as the allocation of power from the power module <b>31</b> to the various servers <b>20</b> in the chassis <b>12</b>. The blower module <b>33</b> generates airflow through the chassis <b>12</b> to cool the servers. The network switch module <b>34</b> provides connectivity between the chassis <b>12</b> and a network, such as a local area network (LAN) or a wide area network (WAN), such as the Internet. More than one support module of the same particular type may be provided in the chassis <b>12</b>, either as redundant support modules or as support modules operating in tandem, so that the described functionality of a support module may equally apply to the functionality of a redundant support module of the same type, or to the combined functionality of two or more support modules of the same type.</p>
<p id="p-0020" num="0019">The chassis <b>12</b> in this embodiment has a hypothetical chassis type &#x201c;XYZ.&#x201d; The chassis <b>12</b> is configured according to the chassis specification <b>16</b> for the type-XYZ chassis. The chassis specification <b>16</b> defines various physical and electrical chassis parameters for the type-XYZ chassis <b>12</b>. For example, the chassis specification <b>16</b> may include the number of server bays and the type of server(s) that is/are compatible with the chassis. Here, a hypothetical type &#x201c;ABC&#x201d; server is compatible with the chassis <b>12</b>. The chassis specification <b>16</b> also includes a fixed chassis power budget predefined for a type-XYZ chassis having M server bays <b>14</b>. The chassis power budget establishes a total amount of power allowed to the chassis <b>12</b>. The chassis power budget may be allocated among the servers <b>20</b> by the chassis management module <b>32</b>.</p>
<p id="p-0021" num="0020">Each server <b>20</b> in this embodiment is the hypothetical type &#x201c;ABC&#x201d; server configured according to a server specification <b>22</b>. The server specification <b>22</b> may include, for example, a specific listing of categories of components that may be included with a type-ABC server, along with the corresponding connections (such as slots, ports, or sockets) for &#x201c;N&#x201d; server components. The term &#x201c;server component&#x201d; may include a hardware element and a software element such as firmware used to operate the hardware. The hardware and software elements may both affect the power requirement of a component. The server specification <b>22</b> defines the permissible components by categories (for example processors, memory modules, and graphics cards), without limiting each connection to a particular part number. Thus, a connection for a particular category of server component may interchangeably receive more than one different component of that category and have a component power requirement of less than or equal to a categorically-defined component power limit. For example, the server specification <b>22</b> includes two processor sockets (category=processor) and eight DIMM slots (category=memory module or DIMM), but does not limit each processor socket to receiving only one specific model number of processor. Accordingly, a 100 W processor, a 75 W processor, and a 50 W processor may each be interchangeably operable with one of the processor sockets. Thus, the particular selection of installed components determines the actual power requirement of the components and, accordingly, affects the total power requirement of the server. Not all ports, slots, or sockets are required to be occupied for a functioning type-ABC server. For example, a functioning server may be configured with only one processor and four DIMMs, leaving a second processor socket and four DIMM slots unoccupied.</p>
<p id="p-0022" num="0021">The chassis management module <b>32</b> cannot immediately ascertain the actual power requirement of a particular server <b>20</b> upon insertion. Rather, the server must first take an inventory to identify the components and their corresponding power requirements. The total power requirement of the inserted server is the sum of the power requirements of the components in the inventory. However, the server specification <b>22</b> and chassis specification <b>16</b> provide information about the inserted server that is useful in managing power to the chassis <b>12</b>. Specifically, the chassis management module can determine certain parameters of the server directly from the chassis specification <b>16</b>. For example, the chassis specification <b>16</b> limits a type-XYZ chassis <b>12</b> to receive only type-ABC servers. Therefore, the chassis management module <b>32</b> can be programmed with the server power limit (500 W in this example) of any received server <b>20</b> based on the server specification <b>22</b>. In an alternative implementation, the chassis <b>12</b> may receive more than one type of server, and the chassis management module <b>32</b> is configured to detect the server type upon insertion, such as by transferring vital product data (VPD) or having a unique pin configuration. In yet another implementation, the chassis may not be programmed with the server power limit of a type-ABC server, and the inserted server, itself, could instead report to the chassis a server power limit for a server of its type. The server power limit is one example of information may be used by the chassis management module, as described further below, to expedite the granting of a power permission to an inserted server prior to completion of a server inventory for the inserted server.</p>
<p id="p-0023" num="0022">Typically, a server management module (&#x201c;SMM&#x201d;) will automatically inventory the components of a server <b>20</b> in response to insertion of the server <b>20</b> into a server bay <b>14</b>. The process of generating the inventory may be controlled by the server management module <b>24</b>, the chassis management module <b>32</b>, or both. Optionally, the server management module may be an integrated management module (IMM) and/or the chassis management module may be an advanced management module (AMM). The server management module <b>24</b> is a service processor on the system board of the server <b>20</b> that may optionally also perform conventional power management tasks, such as monitoring the power consumption of the server <b>20</b> and throttling the processors and memory. The process of generating an inventory may be part of a server boot process or a separate process controlled by the server management module <b>24</b>. In the context of managing power to the servers <b>20</b>, the chassis management module <b>32</b> is a supervisory controller and the server management module <b>24</b> on each server <b>20</b> is a local controller.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 2</figref> is a flowchart summarizing a method of managing a fixed chassis power budget according to an embodiment of the invention. The chassis power budget may be predefined in a chassis specification according to chassis type, or otherwise programmed or manually entered to be accessible to the chassis management module. Step <b>50</b> involves detecting the insertion of a server into a chassis. In one implementation, a chassis management module may invoke a server power limit with a value equal to a power limit set by the chassis specification for the server bay into which the server is inserted. In another implementation, the chassis management module may infer a server power limit from a server specification of the inserted server. In yet another implementation, the inserted server may read the VPD for its model type and look up the server power limit for a server of its type or model number. and report the server power limit to the chassis management module. Alternatively, a combination of the foregoing server power limit approaches may be used. For example, the chassis may initially set a server power limit according to a power limit for the chassis bay in the chassis specification, and the server may subsequently report its actual server power limit (which may be a lower value than the chassis-specified server power limit). Step <b>52</b> involves comparing the server power limit for the inserted server to the unallocated chassis power. The unallocated chassis power may be computed as the fixed chassis power budget less the power already allocated in the form of power permissions to other servers already installed in the chassis. In step <b>52</b>, if the server power limit is less than or equal to the unallocated chassis power, then a power permission is immediately granted to the inserted server in an amount equal to the value of the server power limit according to step <b>54</b>. This power permission is thus granted prior to generating a server inventory for the inserted server, which is initiated in step <b>56</b>. If, however, the server power limit is determined to be greater than the unallocated chassis power in conditional step <b>52</b>, then no power permission is yet granted to the inserted server according to step <b>58</b>.</p>
<p id="p-0025" num="0024">The process of inventorying the server involves examining the server to identify components of the server and the corresponding component power requirement (CPR) of each component. Each iteration of step <b>60</b> involves identifying one of the components and the CPR of the identified component. The component power requirement is the actual amount of power the identified component requires, even though the component may not always operate at the full value of its CPR. Each time step <b>60</b> is repeated, another one of the server components is identified along with its CPR. The identity and component power requirement (CPR) of each component may be reported in stages to the chassis management module as the inventory progresses. For example, each stage may involve reporting the identity and CPR of one server component or a subset of fewer than all the server components on the inserted server. Each stage may also be timed, so that upon the expiration of a preselected time interval, the components and component power requirements identified during that time interval are reported.</p>
<p id="p-0026" num="0025">Step <b>62</b> involves identifying a component category associated with the component identified in step <b>60</b>, along with a component power limit predefined for that category. The predefined component power limit is a maximum amount of power that any component in that component category may consume, whereas the component power requirement is the maximum power that a particular component requires. Thus, for each component, the component power requirement may be equal to or less than the categorically-defined component power limit. Conditional step <b>64</b> involves comparing the component power requirement (determined in step <b>60</b>) to the categorically-defined component power limit for that component type (determined in step <b>62</b>). If the power requirement of the current component is less than the component power limit, then the difference between those two power values is determined. That difference is subtracted from the value of the server power limit (SPL) in step <b>66</b>. Step <b>66</b> is applied to all the components inventoried up to that point, so that the difference between the categorically-defined component power limit and the component power requirement for each component inventoried thus far is subtracted from the value of the server power limit to obtain a &#x201c;reduced&#x201d; server power limit.</p>
<p id="p-0027" num="0026">The reduced SPL is merely an intermediate calculation representing the maximum amount of power the server may consume based on what is known about the inventoried components, and does not represent an actual reduction in the server power limit, since the server power limit is fixed for a particular server. For example, if the server power limit specified for a type-ABC server is 500 W, but the component power requirement of an installed CPU is 25 W less than a categorically-defined component power limit of 50 W for processors, then the server power consumption is expected to be no greater than a reduced SPL value of 475 W, which is equal to the 500 W server power limit reduced by 25 W. The sequence of steps <b>60</b>, <b>62</b>, <b>64</b>, <b>66</b>, <b>68</b>, <b>72</b>, and <b>74</b> spell out an iterative process whereby a diminishing worst-case power consumption value (the reduced server power limit calculation) is obtained for an inserted blade as information about the server is obtained. Thus, the power permission may be granted to the server as early as possible, and the value of a previously granted power permission may be progressively diminished, if possible, as the inventorying process advances.</p>
<p id="p-0028" num="0027">In conditional step <b>68</b>, the reduced server power value (computed in step <b>66</b>) is compared to the unallocated chassis power. If the reduced server power value is less than or equal to the unallocated chassis power, then step <b>70</b> involves either granting or updating a power permission to the server in the amount of the reduced server power. If a power permission was previously granted in step <b>54</b> prior to initiating the process of generating an inventory, or in a preceding iteration of step <b>70</b>, then the power permission is updated (lowered) in step <b>70</b> to the amount of the reduced server power calculated in step <b>66</b>. If a power permission was not previously granted, but the reduced server power value computed in step <b>66</b> is now less than or equal to the unallocated chassis power based on the components inventoried so far, then power permission is granted in step <b>70</b>. If, alternatively, the reduced server power value calculated in step <b>66</b> exceeds the unallocated chassis power according to conditional step <b>68</b>, then the power permission is not granted or adjusted. Conditional step <b>72</b> determines whether the server inventory is complete. The server inventory is complete if all of the server components have been identified and a total power requirement of the identified server components obtained. If the server inventory is incomplete, as determined according to step <b>72</b>, then the next component to be inventoried is selected in step <b>74</b>, and another iteration of step <b>62</b> is applied to the component selected in step <b>74</b>.</p>
<p id="p-0029" num="0028">The flowchart of <figref idref="DRAWINGS">FIG. 2</figref> describes how power permissions may be minimized by detecting that optional server components are either absent or have component power requirements that are less than categorically-defined component power limits specified for a server of that type. Optionally, power permissions may be reduced even further than as described in the flowchart of <figref idref="DRAWINGS">FIG. 2</figref>, by also identifying that the server or component thereof is capable of operating in a throttled, or reduced power state. Thus, if the server management module knows that it can force processors to stay in a throttled state, the server management module could report an even lower server power requirement and/or component power requirements, and enforce the throttled states as a matter of policy if desired. Such an approach may be used in a case of difficult power loading, such as if every bay of the chassis had a server, and each server's power requirement were equal to or nearly as high as the categorically-defined server power limit, so that the chassis power budget would otherwise be exceeded without enforcing the throttled state of one or more servers or server components. At another extreme, if the chassis power budget were sufficient to operate servers at up to the server power requirements or server power limits, the servers might be allowed by the chassis management module to operate at their highest performance capabilities.</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 3</figref> is a table of a chassis power budget for the hypothetical XYZ chassis <b>12</b> of <figref idref="DRAWINGS">FIG. 1</figref>. The chassis power budget is 2000 W in this example, so that no more than a total of 2000 W may be allocated to all of the servers in the chassis combined. A total of M server bays are included, as identified in column <b>62</b>. However, not all of the server bays need to be occupied for a fully functioning chassis. The first four bays are presently occupied by type-ABC servers, as indicated in column <b>64</b>, which have a 500 W server power limit, as indicated in column <b>66</b>. The servers in server bays <b>1</b>-<b>4</b> have previously been inventoried and therefore have known server power requirements listed in column <b>68</b>. The server power requirements are based on the total component power requirements of the individual servers. As indicated in column <b>68</b>, the server in Bay <b>1</b> requires 400 W, the server in Bay <b>2</b> requires 450 W, the server in Bay <b>3</b> requires 300 W, and the server in Bay <b>4</b> requires 400 W, which power requirements are all less than the 500 W server power limit for a type-ABC server. Server M is not yet installed, and therefore has not been inventoried. The amount of power required by Server M is to be determined upon insertion and inventorying Server M to obtain the server components and their respective power requirements. If all five servers (<b>1</b>-<b>4</b> and M) each consumed the server power limit of 500 W, then the chassis power budget of 2000 W would already be met by the servers in Bays <b>1</b>-<b>4</b>. However, because the servers <b>1</b>-<b>4</b> consume a total power of 1550 W, the unallocated chassis power is 450 W prior to inserting server M.</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 4</figref> is a chart of an inventory for Server M prepared in response to insertion of Server M into the chassis. The chart is arranged in the order that server components of Server M are added to the inventory. Times T<b>1</b> through T<b>8</b> are listed in column <b>70</b>, occurring in chronological order. The components are numbered in the time-order in which they are added to the inventory in column <b>72</b>. The category of each component is indicated in column <b>74</b>. The categorically-defined component power limit for the components is indicated in column <b>76</b>. As the process of generating an inventory progresses, the actual component power requirement is obtained as indicated in column <b>78</b>. Thus, for example, component <b>1</b> (Processor <b>1</b>) is added to the inventory at time T<b>1</b>, and is determined to be a processor having a categorically-defined component power limit of 100 W, and an actual power requirement of only 75 W; Component <b>2</b> (Processor <b>2</b>) is added to the inventory at time T<b>2</b>, and is determined to also be a processor having a categorically-defined component power limit of 100 W, and an actual power requirement of only 75 W; Components <b>3</b>-<b>10</b> (DIMMs <b>1</b>-<b>8</b>) are added to the inventory as a group at time T<b>3</b>, and have a total categorically-defined component power limit of 50 W but a total component power requirement of only 30 W; and so forth.</p>
<p id="p-0032" num="0031">Because Processors <b>1</b> and <b>2</b> each have a power requirement of 25 W less than their categorically-defined component power limit, it can already be determined at time T<b>2</b> that Server M will require at most 450 W, which is a reduced SPL value computed as the type-ABC server power limit of 500 W reduced by 50 W. This 450 W reduced SPL value can be satisfied by the unallocated chassis power of 450 W. Thus, power permission of 450 W can already be granted at time T<b>2</b>, which may be a substantial amount of time before every component in Server M has been added to the inventory. Although not required, the power permission to Server M may be updated at any point when it is determined that one of the components added to the inventory has a component power requirement that is less than the categorically-defined component power limit for a component of that category. Upon completion of the inventorying of Server M at about Time T<sub>N</sub>, the power permission to Server M may be reduced to the actual power requirement of Server M, which is 350 W.</p>
<p id="p-0033" num="0032">As will be appreciated by one skilled in the art, aspects of the present invention may be embodied as a system, method or computer program product. Accordingly, aspects of the present invention may take the form of an entirely hardware embodiment, an entirely software embodiment (including firmware, resident software, micro-code, etc.) or an embodiment combining software and hardware aspects that may all generally be referred to herein as a &#x201c;circuit,&#x201d; &#x201c;module&#x201d; or &#x201c;system.&#x201d; Furthermore, aspects of the present invention may take the form of a computer program product embodied in one or more computer readable medium(s) having computer readable program code embodied thereon.</p>
<p id="p-0034" num="0033">Any combination of one or more computer readable medium(s) may be utilized. The computer readable medium may be a computer readable signal medium or a computer readable storage medium. A computer readable storage medium may be, for example, but not limited to, an electronic, magnetic, optical, electromagnetic, infrared, or semiconductor system, apparatus, or device, or any suitable combination of the foregoing. More specific examples (a non-exhaustive list) of the computer readable storage medium would include the following: an electrical connection having one or more wires, a portable computer diskette, a hard disk, a random access memory (RAM), a read-only memory (ROM), an erasable programmable read-only memory (EPROM or Flash memory), an optical fiber, a portable compact disc read-only memory (CD-ROM), an optical storage device, a magnetic storage device, or any suitable combination of the foregoing. In the context of this document, a computer readable storage medium may be any tangible medium that can contain, or store a program for use by or in connection with an instruction execution system, apparatus, or device.</p>
<p id="p-0035" num="0034">A computer readable signal medium may include a propagated data signal with computer readable program code embodied therein, for example, in baseband or as part of a carrier wave. Such a propagated signal may take any of a variety of forms, including, but not limited to, electro-magnetic, optical, or any suitable combination thereof. A computer readable signal medium may be any computer readable medium that is not a computer readable storage medium and that can communicate, propagate, or transport a program for use by or in connection with an instruction execution system, apparatus, or device.</p>
<p id="p-0036" num="0035">Program code embodied on a computer readable medium may be transmitted using any appropriate medium, including but not limited to wireless, wireline, optical fiber cable, RF, etc., or any suitable combination of the foregoing.</p>
<p id="p-0037" num="0036">Computer program code for carrying out operations for aspects of the present invention may be written in any combination of one or more programming languages, including an object oriented programming language such as Java, Smalltalk, C++ or the like and conventional procedural programming languages, such as the &#x201c;C&#x201d; programming language or similar programming languages. The program code may execute entirely on the user's computer, partly on the user's computer, as a stand-alone software package, partly on the user's computer and partly on a remote computer or entirely on the remote computer or server. In the latter scenario, the remote computer may be connected to the user's computer through any type of network, including a local area network (LAN) or a wide area network (WAN), or the connection may be made to an external computer (for example, through the Internet using an Internet Service Provider).</p>
<p id="p-0038" num="0037">Aspects of the present invention are described below with reference to flowchart illustrations and/or block diagrams of methods, apparatus (systems) and computer program products according to embodiments of the invention. It will be understood that each block of the flowchart illustrations and/or block diagrams, and combinations of blocks in the flowchart illustrations and/or block diagrams, can be implemented by computer program instructions. These computer program instructions may be provided to a processor of a general purpose computer, special purpose computer, or other programmable data processing apparatus to produce a machine, such that the instructions, which execute via the processor of the computer or other programmable data processing apparatus, create means for implementing the functions/acts specified in the flowchart and/or block diagram block or blocks.</p>
<p id="p-0039" num="0038">These computer program instructions may also be stored in a computer readable medium that can direct a computer, other programmable data processing apparatus, or other devices to function in a particular manner, such that the instructions stored in the computer readable medium produce an article of manufacture including instructions which implement the function/act specified in the flowchart and/or block diagram block or blocks.</p>
<p id="p-0040" num="0039">The computer program instructions may also be loaded onto a computer, other programmable data processing apparatus, or other devices to cause a series of operational steps to be performed on the computer, other programmable apparatus or other devices to produce a computer implemented process such that the instructions which execute on the computer or other programmable apparatus provide processes for implementing the functions/acts specified in the flowchart and/or block diagram block or blocks.</p>
<p id="p-0041" num="0040">The flowchart and block diagrams in the Figures illustrate the architecture, functionality, and operation of possible implementations of systems, methods and computer program products according to various embodiments of the present invention. In this regard, each block in the flowchart or block diagrams may represent a module, segment, or portion of code, which comprises one or more executable instructions for implementing the specified logical function(s). It should also be noted that, in some alternative implementations, the functions noted in the block may occur out of the order noted in the figures. For example, two blocks shown in succession may, in fact, be executed substantially concurrently, or the blocks may sometimes be executed in the reverse order, depending upon the functionality involved. It will also be noted that each block of the block diagrams and/or flowchart illustration, and combinations of blocks in the block diagrams and/or flowchart illustration, can be implemented by special purpose hardware-based systems that perform the specified functions or acts, or combinations of special purpose hardware and computer instructions.</p>
<p id="p-0042" num="0041">The terminology used herein is for the purpose of describing particular embodiments only and is not intended to be limiting of the invention. As used herein, the singular forms &#x201c;a&#x201d;, &#x201c;an&#x201d; and &#x201c;the&#x201d; are intended to include the plural forms as well, unless the context clearly indicates otherwise. It will be further understood that the terms &#x201c;comprises&#x201d; and/or &#x201c;comprising,&#x201d; when used in this specification, specify the presence of stated features, integers, steps, operations, elements, components and/or groups, but do not preclude the presence or addition of one or more other features, integers, steps, operations, elements, components, and/or groups thereof. The terms &#x201c;preferably,&#x201d; &#x201c;preferred,&#x201d; &#x201c;prefer,&#x201d; &#x201c;optionally,&#x201d; &#x201c;may,&#x201d; and similar terms are used to indicate that an item, condition or step being referred to is an optional (not required) feature of the invention.</p>
<p id="p-0043" num="0042">The corresponding structures, materials, acts, and equivalents of all means or steps plus function elements in the claims below are intended to include any structure, material, or act for performing the function in combination with other claimed elements as specifically claimed. The description of the present invention has been presented for purposes of illustration and description, but it is not intended to be exhaustive or limited to the invention in the form disclosed. Many modifications and variations will be apparent to those of ordinary skill in the art without departing from the scope and spirit of the invention. The embodiment was chosen and described in order to best explain the principles of the invention and the practical application, and to enable others of ordinary skill in the art to understand the invention for various embodiments with various modifications as are suited to the particular use contemplated.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method, comprising:
<claim-text>allocating a fixed chassis power budget among one or more servers in a multi-server chassis;</claim-text>
<claim-text>detecting an insertion of a server into the multi-server chassis;</claim-text>
<claim-text>initially granting a power permission to the inserted server;</claim-text>
<claim-text>after granting the power permission, generating an inventory of the inserted server in a plurality of stages, each stage including identifying one or more of a plurality of server components and obtaining a component power requirement of each server component identified in that stage; and</claim-text>
<claim-text>upon completion of each stage, adjusting the power permission to the inserted server according to the component power requirements of the one or more server components inventoried in that stage.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>identifying a server type of the inserted server and obtaining a server power limit predefined for the server type, wherein total power requirements of the plurality of server components is less than or equal to the server power limit; and</claim-text>
<claim-text>initially setting the power permission equal to the server power limit prior to initiating the step of generating the inventory.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00002">claim 2</claim-ref>, further comprising:
<claim-text>setting the power permission equal to the total power requirements of the plurality of server components upon completion of the inventory.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>identifying a component category associated with each inventoried component;</claim-text>
<claim-text>obtaining a predefined component power limit for each component category, wherein the component power requirement for one or more of the server components is less than the component power limit of the associated component categories; and</claim-text>
<claim-text>for each inventoried component having a component power requirement of less than the component power limit for the associated component category, reducing the power permission to the server by an amount equal to the difference between the component power limit and the component power requirement of the inventoried component.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00004">claim 4</claim-ref>, further comprising:
<claim-text>computing an unallocated chassis power as the fixed chassis power budget minus any presently granted power permissions; and</claim-text>
<claim-text>increasing the unallocated chassis power by an amount equal to each reduction of the power permission to the inserted server.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>computing a total of the power requirement of the server components after all of the server components have been inventoried; and</claim-text>
<claim-text>setting the power permission to the inserted server equal to the total power requirement of the server components.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>setting the power permission to a value of less than a total power requirement of the server components; and</claim-text>
<claim-text>continuously throttling the one or more of the server components to enforce the power permission.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. A power management system, comprising:
<claim-text>a local controller on a server, the local controller configured for generating an inventory of server components of the server in a plurality of stages in response to insertion of the server into a multi-server chassis, wherein each stage includes identifying one or more of the server components and obtaining a component power requirement of each server component identified in that stage, and the local controller further configured for requesting a reduced power permission upon completion of the inventory as a function of the inventoried server components; and</claim-text>
<claim-text>a supervisory controller on the multi-server chassis, the supervisory controller for dynamically allocating a fixed chassis power budget among servers in the chassis, including initially granting a power permission to the inserted server before performing the inventory and subsequently granting the reduced power permission to the inserted server upon completion of the inventory.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The power management system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the supervisory controller is configured for identifying a server type of the inserted server and obtaining a server power limit predefined for the server type, wherein a total of the power requirements of the plurality of server components is less than or equal to the server power limit, and initially setting the power permission equal to the server power limit before performing the inventory.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The power management system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the local controller on each server comprises a service processor on a system board of the inserted server.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The power management system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the supervisory controller comprises a hot-pluggable chassis management module.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The power management system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the server components comprise hardware components, software components, or combinations thereof.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The power management system of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the hardware components are selected from the group consisting of a processor, a memory module, a graphics card, and a hard drive.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. A computer program product including computer usable program code embodied on a non-transitory computer readable storage medium, the computer program product including:
<claim-text>computer usable program code for allocating a fixed chassis power budget among one or more servers in a multi-server chassis;</claim-text>
<claim-text>computer usable program code for detecting an insertion of a server into the multi-server chassis;</claim-text>
<claim-text>computer usable program code for receiving and granting a request for a power permission from the inserted server;</claim-text>
<claim-text>computer usable program code for, after granting the power permission, generating an inventory of the inserted server in a plurality of stages, each stage including identifying one or more of a plurality of server components and obtaining a component power requirement of each server component identified in that stage; and</claim-text>
<claim-text>computer usable program code for, upon completion of each stage, adjusting the power permission to the inserted server according to the component power requirements of the one or more server components inventoried in that stage.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The computer program product of <claim-ref idref="CLM-00014">claim 14</claim-ref>, further comprising:
<claim-text>computer usable program code for identifying a server type of the inserted server and obtaining a server power limit predefined for the server type, wherein a total of the power requirements of the plurality of server components is less than or equal to the server power limit; and</claim-text>
<claim-text>computer usable program code for setting the power permission equal to the server power limit. </claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
