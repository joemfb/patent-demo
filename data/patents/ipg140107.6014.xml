<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08627137-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08627137</doc-number>
<kind>B1</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12883895</doc-number>
<date>20100916</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>574</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>11</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>714  42</main-classification>
<further-classification>709203</further-classification>
<further-classification>709230</further-classification>
<further-classification>709238</further-classification>
<further-classification>370218</further-classification>
<further-classification>370222</further-classification>
<further-classification>3702362</further-classification>
<further-classification>370256</further-classification>
<further-classification>714  411</further-classification>
</classification-national>
<invention-title id="d2e53">Graceful handling of critical traffic blackholing faults</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>7178052</doc-number>
<kind>B2</kind>
<name>Hebbar et al.</name>
<date>20070200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>7706281</doc-number>
<kind>B2</kind>
<name>Dalal et al.</name>
<date>20100400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>7710882</doc-number>
<kind>B1</kind>
<name>Previdi et al.</name>
<date>20100500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7715307</doc-number>
<kind>B2</kind>
<name>Walton et al.</name>
<date>20100500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370216</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7738495</doc-number>
<kind>B2</kind>
<name>Dalal et al.</name>
<date>20100600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>7751336</doc-number>
<kind>B2</kind>
<name>Hopps et al.</name>
<date>20100700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>7769886</doc-number>
<kind>B2</kind>
<name>Naseh et al.</name>
<date>20100800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>7773611</doc-number>
<kind>B2</kind>
<name>Booth, III et al.</name>
<date>20100800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2003/0119555</doc-number>
<kind>A1</kind>
<name>Friesen et al.</name>
<date>20030600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455560</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2005/0007951</doc-number>
<kind>A1</kind>
<name>Lapuh et al.</name>
<date>20050100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370225</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2006/0056303</doc-number>
<kind>A1</kind>
<name>Aggarwal et al.</name>
<date>20060300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370248</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2006/0126495</doc-number>
<kind>A1</kind>
<name>Guichard et al.</name>
<date>20060600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370216</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>2006/0256712</doc-number>
<kind>A1</kind>
<name>Imajuku et al.</name>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370218</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>2007/0104197</doc-number>
<kind>A1</kind>
<name>King</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>2007/0162565</doc-number>
<kind>A1</kind>
<name>Hanselmann</name>
<date>20070700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>2007/0211623</doc-number>
<kind>A1</kind>
<name>Nishioka</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370218</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>2008/0037526</doc-number>
<kind>A1</kind>
<name>Dong</name>
<date>20080200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370352</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>2008/0049621</doc-number>
<kind>A1</kind>
<name>McGuire et al.</name>
<date>20080200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>3702362</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>2009/0196181</doc-number>
<kind>A1</kind>
<name>Retana et al.</name>
<date>20090800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00020">
<document-id>
<country>US</country>
<doc-number>2009/0201803</doc-number>
<kind>A1</kind>
<name>Filsfils et al.</name>
<date>20090800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370222</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00021">
<document-id>
<country>US</country>
<doc-number>2010/0103846</doc-number>
<kind>A1</kind>
<name>Chiabaut et al.</name>
<date>20100400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370256</main-classification></classification-national>
</us-citation>
<us-citation>
<nplcit num="00022">
<othercit>Moy, J. &#x201c;OSPF Version 2,&#x201d; RFC 2328, Apr. 1998, pp. 1-245.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00023">
<othercit>Li, T., et al., &#x201c;IS-IS Extensions for Traffic Engineering,&#x201d; RFC 5305, Oct. 2008, pp. 1-18.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>23</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>370218</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370222</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>3702362</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370256</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709203</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709230</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709238</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>714  411</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>714  42</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>9</number-of-drawing-sheets>
<number-of-figures>9</number-of-figures>
</figures>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Vaidya</last-name>
<first-name>Nikunj R.</first-name>
<address>
<city>Milpitas</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Mohapatra</last-name>
<first-name>Pradosh</first-name>
<address>
<city>Fremont</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Satyanarayana</last-name>
<first-name>Arun</first-name>
<address>
<city>Fremont</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="004" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Bhagra</last-name>
<first-name>Pankaj</first-name>
<address>
<city>Fremont</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="005" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Filsfils</last-name>
<first-name>Clarence</first-name>
<address>
<city>Brussels</city>
<country>BE</country>
</address>
</addressbook>
<residence>
<country>BE</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Vaidya</last-name>
<first-name>Nikunj R.</first-name>
<address>
<city>Milpitas</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Mohapatra</last-name>
<first-name>Pradosh</first-name>
<address>
<city>Fremont</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Satyanarayana</last-name>
<first-name>Arun</first-name>
<address>
<city>Fremont</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="004" designation="us-only">
<addressbook>
<last-name>Bhagra</last-name>
<first-name>Pankaj</first-name>
<address>
<city>Fremont</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="005" designation="us-only">
<addressbook>
<last-name>Filsfils</last-name>
<first-name>Clarence</first-name>
<address>
<city>Brussels</city>
<country>BE</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Novak Druce Connolly Bove + Quigg LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Cisco Technology, Inc.</orgname>
<role>02</role>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Lottich</last-name>
<first-name>Joshua P</first-name>
<department>2113</department>
</primary-examiner>
<assistant-examiner>
<last-name>Arcos</last-name>
<first-name>Jeison C</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">In one embodiment, a network device may detect a data plane critical fault condition, while a corresponding control plane is not experiencing a critical fault condition. In response to a network device based critical fault condition, the network device may activate and advertise an increased and expensive usable metric for each network interface of the network device. On the other hand, in response to an interface based critical fault condition, the network device may activate and advertise an increased and expensive usable metric for one or more particular network interfaces of the interface based critical fault, and signals, over the control plane to a corresponding network device at an opposing end of each particular network interface of the interface based critical fault, a request to activate and advertise an increased and expensive usable metric at the opposing end of each particular network interface.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="244.26mm" wi="179.75mm" file="US08627137-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="206.59mm" wi="129.12mm" orientation="landscape" file="US08627137-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="204.98mm" wi="174.92mm" orientation="landscape" file="US08627137-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="158.83mm" wi="149.27mm" orientation="landscape" file="US08627137-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="208.53mm" wi="129.12mm" orientation="landscape" file="US08627137-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="204.30mm" wi="131.49mm" orientation="landscape" file="US08627137-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="214.46mm" wi="121.24mm" orientation="landscape" file="US08627137-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="204.64mm" wi="121.24mm" orientation="landscape" file="US08627137-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="203.96mm" wi="121.24mm" orientation="landscape" file="US08627137-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="253.07mm" wi="179.58mm" file="US08627137-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">TECHNICAL FIELD</heading>
<p id="p-0002" num="0001">The present disclosure relates generally to computer networks, and, more particularly, to critical fault handling for traffic blackholing faults on routers.</p>
<heading id="h-0002" level="1">BACKGROUND</heading>
<p id="p-0003" num="0002">When a critical fault impacts both the data plane and control plane of a network device, routing protocols generally detect the faults and successfully divert away the traffic if there is sufficient redundancy. However, when only the data plane fails, leaving the control plane functional, traffic may be &#x201c;blackholed,&#x201d; such that the control plane assumes that the connection is functioning, but the data plane is physically unable to forward the traffic.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0004" num="0003">The embodiments herein may be better understood by referring to the following description in conjunction with the accompanying drawings in which like reference numerals indicate identically or functionally similar elements, of which:</p>
<p id="p-0005" num="0004"><figref idref="DRAWINGS">FIG. 1</figref> illustrates an example computer network;</p>
<p id="p-0006" num="0005"><figref idref="DRAWINGS">FIGS. 2A-B</figref> illustrate an example network device/node;</p>
<p id="p-0007" num="0006"><figref idref="DRAWINGS">FIGS. 3A-B</figref> illustrate an example computer network with a network device based critical traffic blackhole data plane fault;</p>
<p id="p-0008" num="0007"><figref idref="DRAWINGS">FIGS. 4A-B</figref> illustrate an example computer network with an interface based critical traffic blackhole data plane fault;</p>
<p id="p-0009" num="0008"><figref idref="DRAWINGS">FIG. 5</figref> illustrates an example computer network with Traffic Engineering tunnels; and</p>
<p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. 6</figref> illustrates an example procedure for gracefully handling critical traffic blackholing data plane faults.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DESCRIPTION OF EXAMPLE EMBODIMENTS</heading>
<heading id="h-0005" level="1">Overview</heading>
<p id="p-0011" num="0010">According to one or more embodiments of the disclosure, a network device having one or more network interfaces may detect a data plane critical fault condition, while a corresponding control plane is not experiencing a fault condition. Depending upon whether the detected critical fault condition is interface based or network device based, the network device may respond to the critical fault condition, e.g., to prevent blackholing of traffic. In response to a network device based critical fault condition, the network device may activate and advertise an increased and expensive usable metric for each network interface of the network device. On the other hand, in response to an interface based critical fault condition, the network device may activate and advertise an increased and expensive usable metric for one or more particular network interfaces of the interface based critical fault, and signals, over the control plane to a corresponding network device at an opposing end of each particular network interface of the interface based critical fault, a request to activate and advertise an increased and expensive usable metric at the opposing end of each particular network interface. In this manner, critical traffic blackholing critical faults may be handled that may otherwise go undetected by a functioning control plane. Also, in one or more embodiments, gracefully diverting the traffic away from the affected interface employs a technique that prevents any occurrence of microloops.</p>
<heading id="h-0006" level="1">Description</heading>
<p id="p-0012" num="0011">A computer network is a geographically distributed collection of nodes interconnected by communication links and segments for transporting data between end nodes, such as personal computers and workstations. Many types of networks are available, with the types ranging from local area networks (LANs) to wide area networks (WANs). LANs typically connect the nodes over dedicated private communications links located in the same general physical location, such as a building or campus. WANs, on the other hand, typically connect geographically dispersed nodes over long-distance communications links, such as common carrier telephone lines, optical lightpaths, synchronous optical networks (SONET), or synchronous digital hierarchy (SDH) links. The Internet is an example of a WAN that connects disparate networks throughout the world, providing global communication between nodes on various networks. The nodes typically communicate over the network by exchanging discrete frames or packets of data according to predefined protocols, such as the Transmission Control Protocol/Internet Protocol (TCP/IP). In this context, a protocol consists of a set of rules defining how the nodes interact with each other. Computer networks may be further interconnected by an intermediate network node, such as a router, to extend the effective &#x201c;size&#x201d; of each network.</p>
<p id="p-0013" num="0012">Since management of interconnected computer networks can prove burdensome, smaller groups of computer networks may be maintained as routing domains or autonomous systems. The networks within an autonomous system (AS) are typically coupled together by conventional &#x201c;intradomain&#x201d; routers configured to execute intradomain routing protocols, and are generally subject to a common authority. To improve routing scalability, a service provider (e.g., an ISP) may divide an AS into multiple &#x201c;areas&#x201d; or &#x201c;levels.&#x201d; It may be desirable, however, to increase the number of nodes capable of exchanging data; in this case, interdomain routers executing interdomain routing protocols are used to interconnect nodes of the various ASes. Moreover, it may be desirable to interconnect various ASes that operate under different administrative domains. As used herein, an AS, area, or level is generally referred to as a &#x201c;domain.&#x201d;</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic block diagram of an example computer network <b>100</b>, e.g., a service provider &#x201c;core&#x201d; network, illustratively comprising nodes/devices interconnected by links as shown. For example, the illustrative network <b>100</b> may comprise one or more provider edge (PE) devices PE<b>1</b>-<b>4</b> located at the periphery of the network, e.g., to interconnect with various customer edge (CE) devices of customer networks. The PE devices may in turn be interconnected via one or more intermediate (core) nodes or provider (P) devices P<b>1</b>-<b>4</b> within the core of the network, as may be appreciated by those skilled in the art. Those skilled in the art will understand that any number of nodes, devices, links, etc. may be used in the computer network, and that the view shown herein is for simplicity. Those skilled in the art will also understand that while the embodiments described herein is described generally with relation to a provider network, it may apply to any network configuration within an Autonomous System (AS) or area, or throughout multiple ASes or areas, etc., particularly those arranged with a degree of redundancy within the network, as may be appreciated by those skilled in the art.</p>
<p id="p-0015" num="0014">Data packets <b>140</b> (e.g., traffic, messages, etc.) may be exchanged among the nodes/devices of the computer network <b>100</b> using predefined network communication protocols such as the Transmission Control Protocol/Internet Protocol (TCP/IP), User Datagram Protocol (UDP), Asynchronous Transfer Mode (ATM) protocol, Frame Relay protocol, Internet Packet Exchange (IPX) protocol, various tunneling protocols, etc., as noted herein. As shown, illustrative traffic flows F<b>1</b> and F<b>2</b> may traverse a particular device, P<b>1</b>, based on various routing protocols or other decisive mechanisms.</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 2A</figref> is a schematic block diagram of an example node/device <b>200</b> that may be used with one or more embodiments described herein, e.g., as a router or other network device. The device comprises a plurality of network interfaces <b>210</b>, one or more processors <b>220</b>, and a memory <b>240</b> interconnected by a system bus <b>250</b>. The network interfaces <b>210</b> contain the mechanical, electrical, and signaling circuitry for communicating data over physical links coupled to the network <b>100</b>. The network interfaces may be configured to transmit and/or receive data using a variety of different communication protocols, including, inter alia, TCP/IP, UDP, ATM, synchronous optical networks (SONET), wireless protocols, Frame Relay, Ethernet, Fiber Distributed Data Interface (FDDI), etc. Notably, a physical network interface <b>210</b> may also be used to implement one or more virtual network interfaces, such as for Virtual Private Network (VPN) access, known to those skilled in the art. Further, network interfaces <b>210</b> may be configured transmit and/or receive traffic (e.g., packets) using one or more queues <b>212</b>, which may be specific to each network interface as shown, or may be generally controlled by the device <b>200</b>.</p>
<p id="p-0017" num="0016">The memory <b>240</b> comprises a plurality of storage locations that are addressable by the processor(s) <b>220</b> and the network interfaces <b>210</b> for storing software programs and data structures associated with the embodiments described herein. The processor <b>220</b> may comprise necessary elements or logic adapted to execute the software programs and manipulate the data structures. An operating system <b>242</b> (e.g., the Internetworking Operating System, or IOS&#xae;, of Cisco Systems, Inc.), portions of which are typically resident in memory <b>240</b> and executed by the processor(s), functionally organizes the node by, inter alia, invoking network operations in support of software processes and/or services executing on the device. These software processes and/or services may comprise routing process/services <b>244</b>, an illustrative signaling process <b>245</b>, and a fault aggregator <b>248</b>, each as described herein. It will be apparent to those skilled in the art that other types of processors and memory, including various computer-readable media, may be used to store and execute program instructions pertaining to the techniques described herein. It is also noted herein that any of the processes may alternatively be embodied as modules, composed of software, hardware, firmware, or any combination thereof.</p>
<p id="p-0018" num="0017">Routing services <b>244</b> contain computer executable instructions executed by processor <b>220</b> to perform functions provided by one or more routing protocols, such as the Interior Gateway Protocol (IGP) (e.g., Open Shortest Path First, &#x201c;OSPF,&#x201d; and Intermediate-System-to-Intermediate-System, &#x201c;IS-IS&#x201d;), the Border Gateway Protocol (BGP), etc., as will be understood by those skilled in the art. These functions may be configured to manage a forwarding information database containing, e.g., data used to make forwarding decisions. In particular, changes in the network topology may be communicated among routers <b>200</b> using routing protocols, such as the conventional OSPF and IS-IS link-state protocols (e.g., to &#x201c;converge&#x201d; to an identical view of the network topology). Notably, routing services <b>244</b> may also perform functions related to virtual routing protocols, such as maintaining virtual routing and forwarding (VRF) instances, or tunneling protocols, such as for Multi-Protocol Label Switching (MPLS), etc., each as will be understood by those skilled in the art.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 2B</figref> illustrates an alternative view of network device <b>200</b>. For instance, a network device <b>200</b> may comprise various components arranged logically as a plurality of &#x201c;planes&#x201d; or partitions, where each plane is responsible for various actions. For example, a typical network device may comprise a control plane <b>292</b>, which controls the general activity of the device, interconnected generally to a data plane (or forwarding plane) <b>296</b>, generally comprising network interfaces, circuitry, queues, etc. for physically forwarding traffic. One or more fabric planes <b>294</b> are a part of the data plane (e.g., and control plane), and may provide various services, as may be appreciated by those skilled in the art. Note also, that the fault aggregator <b>248</b> is shown as a component of the alternative view, and that various virtual devices <b>249</b> (e.g., virtual routers configured with virtual control planes, forwarding planes, and/or data planes) may also be present on the network device as may further be understood by those skilled in the art.</p>
<p id="p-0020" num="0019">As noted above, when a critical fault impacts both the data plane and control plane of a network device, routing protocols generally detect the faults and successfully divert away the traffic if there is sufficient redundancy. For instance, routing protocols (e.g., process <b>244</b>) may detect most Layer-1 physical faults, such as broken links, completely hardware failures, etc., through various measures, such as missing &#x201c;hello&#x201d; messages or other notifications. As such, the routing protocols act accordingly, and reconverge to divert the traffic. However, when only the data plane fails, leaving the control plane functional, traffic may be &#x201c;blackholed,&#x201d; such that the control plane assumes that the connection is functioning, but the data plane is physically unable to direct the traffic. For example, queuing circuits in the data-path may run out of resources (an &#x201c;OOR&#x201d; out of resources condition) where low priority buffers are exhausted (e.g., due to memory-leak or sustained over-subscription, etc.), but the high priority buffers are not exhausted (due to light traffic or protected). Often, control plane traffic, such as routing protocol exchanges, is sent over high priority buffers (queues <b>212</b>), and thus routing protocols may not be able to easily detect a data plane problem on the low priority buffers/queues <b>212</b>.</p>
<p id="p-0021" num="0020">According to embodiments of the disclosure, therefore, a mechanism is described herein where a network device (e.g., router) can selectively remove itself or its interfaces/links (in case only a subset of links are affected) from the network, e.g., without incurring any significant microloops, upon detecting a failure undetectable by existing mechanisms such as control plane packets (or planned critical faults, such as service upgrades). For instance, the embodiments herein specifically target the faults that may cause blackholing scenarios when control plane and data plane operation are out of sync. That is, during the traffic-blackholing fault occurrence, the control plane is generally in a healthy state while only the data-plane is impacted, since, as noted above, if the control plane is also impacted, the traffic should automatically get diverted by routing protocols. As used herein, therefore, the control plane may still be used as a communication transport to network peers to signal diversion of traffic as described in detail below.</p>
<p id="p-0022" num="0021">Illustratively, the techniques described herein may be performed by hardware, software, and/or firmware, such as in accordance with fault aggregator process/entity <b>248</b> (e.g., a platform manager), which may contain computer executable instructions executed by the processor <b>220</b> to perform functions relating to the novel techniques described herein, e.g., in conjunction with routing process <b>244</b> operating in a generally conventional manner, such that the fault aggregator may notify the routing protocols of process <b>244</b> to take specific action to reroute the traffic as described herein. Also, signaling process <b>245</b> may also contain computer executable instructions executed by the processor <b>220</b> to perform functions relating to the novel techniques described herein, such as illustratively being embodied as a bidirectional forwarding and detection (BFD) process, or sub-process of routing process <b>244</b> (e.g., IGP signaling), etc.</p>
<p id="p-0023" num="0022">Operationally, the network device is configured to first detect a data plane critical fault condition, which may occur when a corresponding control plane is not experiencing a critical fault condition. For instance, as noted previously, when a router encounters a critical (e.g., layer 1) fault in the data-path, routing protocols lose their periodic hellos and thus reroute the traffic to another redundant link in the network. However, there are certain critical data plane faults that may not cause protocol hellos to be dropped, but potentially can drop data packets. Such faults introduce compromised traffic impacts, such as traffic-blackholing or other performance (e.g., throughput) degradation. For example, low-priority buffers in an ASIC may be leaked out (not available) whereas high-priority queues are still available due to special buffer-reservation built into ASICs, thus causing the routing protocol hellos to be transmitted to continue advertising to the device's peers that this device is still the best route to forward traffic.</p>
<p id="p-0024" num="0023">Example critical data plane fault conditions, therefore, may comprise, among other things: multiple fabric planes being down; out of resources (OOR) conditions (e.g., memory, processing, buffers/queues, etc.); specifically out of buffer (OOB) conditions (e.g., surpassing queue utilization thresholds). In addition, various manual selections may cause a detectable critical fault condition, such as in-service software upgrades (ISSUs) or faults, which are usually done on a live router. Note that in this case, should an ISSU itself not trigger a critical fault, a resultant critical fault or unsuccessful upgrade during the ISSU may result in a detected critical fault, accordingly. Other example critical data plane faults may also be detected, such as a number of usable links within a link bundle remaining alive, or losing a substantial portion of a backplane fabric, e.g., due to hardware issues, parity errors, etc., which may constrain/reduce the backplane bandwidth while allowing enough bandwidth for the control plane to keep adjacencies alive, thus causing congestion and/or blackholing effect. Other, possibly platform specific faults may also be configured for detection by fault aggregator <b>248</b>, such as multicast planes/processing being down; losing a standby/redundant route processor; and process placement faults (e.g., where a rack online insertion and removal or &#x201c;OIR&#x201d; did not successfully move the processes to other racks).</p>
<p id="p-0025" num="0024">Notably, certain critical data plane faults, such as those described above, may be associated with configurable thresholds upon which a critical fault condition is detected. For instance, customers can configure an availability threshold of a certain number of fabric planes/cards going down that would trigger a fault (or a minimum number remaining), or a certain percentage of available resources (e.g., queue depth/overrun), etc.</p>
<p id="p-0026" num="0025">Once the fault aggregator <b>248</b> detects one of these critical fault conditions, generally indicative of potential problems such as blackholing, it may then be determined whether the detected critical fault condition is interface based (i.e., for one or more particular interfaces <b>210</b> of the network device) or network device based (i.e., a device-wide fault, such as shared resources). This determination may be made based on the type of fault, such as certain faults pertaining to interfaces specifically (e.g., queue-based) and other faults pertaining to the entire device (e.g., fabric planes). Notably, according to one or more aspects herein, faults that overlap in occurrence may be considered, such as when one fault is in process (e.g., in a &#x201c;delay&#x201d; state, being recovered) and another fault occurs. Generally, when two faults have occurred, the following scenarios and actions may result:
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0000">
    <ul id="ul0002" list-style="none">
        <li id="ul0002-0001" num="0026">(1) When there is currently an interface-specific fault state and a router-wide fault occurs, the router-wide fault is activated;</li>
        <li id="ul0002-0002" num="0027">(2) If the current fault is a router-wide fault and an interface-specific fault occurs, then the interface-specific fault is held until the router-wide fault is deactivated, and then the interface-specific fault is activated (if still in effect);</li>
        <li id="ul0002-0003" num="0028">(3) If the current fault is a router-wide fault and another router-wide fault occurs, any fault-based timers may be reset, and the new fault is activated (note that no action may be needed, as the action may already be effect);</li>
        <li id="ul0002-0004" num="0029">(4) If the current fault is an interface-specific fault and a new fault for a new interface occurs, this new fault may be activated.
<br/>
(Note that a dampening mechanism may be introduced to account for a same fault occurring repeatedly.)
</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0027" num="0030">If the detected fault is network device based (e.g., &#x201c;router-wide&#x201d;), then the goal is to divert traffic away from the network device entirely. This may be achieved by activating and advertising, e.g., via IGP, an increased and expensive usable metric for each network interface of the network device. Specifically, the metric is increased, meaning larger (more costly/expensive) than a current metric used for each respective interface, and is expensive, meaning that compared to average cost links/interfaces of the network <b>100</b>, the interfaces should generally be avoided given alternative (e.g., redundant) options. In one embodiment, IGP advertisements (of routing process <b>244</b>) may be used to distribute the metric(s). When OSPF is used, a global maximum metric may be used, illustratively including stubs. On the other hand, when IS-IS is used, a maximum metric value less two may be used. Specifically, either the OSPF or IS-IS maximum metrics are the maximum usable metric. In particular, since in IS-IS, the actual maximum value is reserved, and the maximum less one deems a link (network interface) as unreachable, the applicable usable metric in this case is the maximum value less two. This approach for using IS-IS metrics maximum value less two helps to forward traffic if there is no network level redundancy for that routing device. This also simulates the behavior exhibited by OSPF when max-metric is enabled/advertised. Note also that for IS-IS, the metric value may change depending upon the metric style used (e.g., normal or wide). Additionally, when IGP is synchronized with a label distribution is protocol (LDP), i.e., if &#x201c;LDP-IGP sync&#x201d; is active, then bringing down an LDP session associated with a faulty interface (link) would be sufficient to divert away the transit traffic from utilizing that link.</p>
<p id="p-0028" num="0031"><figref idref="DRAWINGS">FIG. 3A</figref> illustrates the example computer network of <figref idref="DRAWINGS">FIG. 1</figref>, showing a response to a network device based (router-wide) critical data plane fault. In particular, assuming that the device P<b>1</b> has detected a device based fault, then it activates and advertises a &#x201c;high&#x201d; cost on all of its interfaces (indicated by the letter &#x201c;H&#x201d;). Accordingly, the previous flows F<b>1</b> and F<b>2</b> traversing P<b>1</b> may be redirected around P<b>1</b> as shown once routing protocols have reacted (e.g., gracefully) to the critical data-plane fault of P<b>1</b> (understood by the peer devices in the network at least by expensive use of the interfaces).</p>
<p id="p-0029" num="0032">By using the increased, expensive (yet usable) metrics (e.g., the maximum), an important caveat is granted to the embodiments herein. In particular, if there is not actually any redundancy in the network to route around the faulted links, such as at various edge devices of certain networks, then the expensive (faulted) links may still be used as a last resort. That is, if even only a relatively small amount of traffic (e.g., 10%) makes it through the potentially blackholing device/interface, that may be considered as better than none of the traffic. <figref idref="DRAWINGS">FIG. 3B</figref> illustrates this point, having removed a redundant link between PE<b>1</b> and P<b>3</b>, thus forcing the flow F<b>1</b> to traverse the faulted device P<b>1</b> (e.g., with potentially degraded performance). For this reason, also, the &#x201c;overload&#x201d; bit of IS-IS is not used, since all traffic toward the faulty link without a redundant path will be completely dropped, rather than at least attempting a degraded performance route as shown in <figref idref="DRAWINGS">FIG. 3B</figref>. (Note also that it may be possible to use an &#x201c;R-bit&#x201d; in OSPFv3, to prevent the router from being used for IPv6 transit traffic.)</p>
<p id="p-0030" num="0033">If, on the other hand, the critical data plane fault is specific to an interface or set of interfaces, the goal is to divert the traffic away from that particular interface/link or set (e.g., links on a shared line card). In response to an interface based critical fault condition, then, the increased and expensive usable metric as described above may be activated for the one or more particular (&#x201c;affected&#x201d;) network interfaces of the fault, and advertised into the network. In addition, the network device may signal a request (over the control plane) to a corresponding network device to activate and advertise an increased and expensive usable metric at the opposing end of each opposing end of each particular faulted network interface. That is, through this signaling exchange, the increased and expensive (e.g., maximum) metric will be activated on both ends of the link and thus transit traffic through the interface is diverted away from that link, if possible.</p>
<p id="p-0031" num="0034"><figref idref="DRAWINGS">FIGS. 4A and 4B</figref> illustrate an example traffic redirection in response to a single interface fault, such as between P<b>1</b> (the detecting/faulty device) and PE<b>1</b>, which is interconnected to P<b>1</b> via the faulty interface. P<b>1</b>, for example, may detect the critical fault condition on the particular interface to PE<b>1</b>, activates the expensive metric (shown again as &#x201c;H&#x201d;), and informs PE<b>1</b> to do the same. PE<b>1</b> receives the request, and may act accordingly. As shown, then, flows F<b>1</b> (<figref idref="DRAWINGS">FIG. 4A</figref>) and F<b>2</b> (<figref idref="DRAWINGS">FIG. 4B</figref>) may be redirected away from that faulty interface due to the high cost of the link, though unlike a network device based fault as described above, not necessarily away from the device (P<b>1</b>), as shown in <figref idref="DRAWINGS">FIG. 4B</figref>. Note that for a network device based fault, the signaling is not required as the entire device is expensive to traverse. In the event of an interface based fault, however, without increasing the cost at both ends of the link, devices may still use the faulty interface as an ingress to reach the comparatively low cost egress interfaces of the network device. In other words, the signaling is beneficial because the new metric can be activated on only one end of the link by IGP, which could divert the egress traffic on that &#x201c;affected&#x201d; interface, but it would not divert the traffic that is in the ingress direction on the interface.</p>
<p id="p-0032" num="0035">The above signaling may be performed by signaling process <b>245</b>, such as extensions to bidirectional forwarding detection (BFD) messages and/or IGP messages. In one embodiments, an extension in IGP signals BFD to advertise the new increased and expensive metric to its peer on that interface (e.g., P<b>1</b> signaling to PE<b>1</b>), and BFD may be extended to receive this notification from IGP (e.g., at P<b>1</b>), and to propagate a received BFD message from a peer (e.g., by PE<b>1</b>) into IGP, which in turn activates the new metric on the other end of the affected link. BFD may be used in this embodiment for its particular ability to provide acknowledgments (acks). In an alternative embodiment, IGP based signaling may also be used. For instance, IGPs such as IS-IS may have a 3-way handshake mechanism which may be utilized to achieve the signaling, thus avoiding the need for BFD operations. Notably, in either embodiment, since the control plane is still functioning while the data plane is broken, the control plane may be used as a transport to signal the other (peer) end to adjust the metric.</p>
<p id="p-0033" num="0036">In accordance with one or more embodiments herein, techniques for minimizing the occurrence of &#x201c;microloops&#x201d; (or &#x201c;micro-loops&#x201d;) are also provided. In particular, an even more graceful &#x201c;costing out&#x201d; of the affected links may be provided that reduces microloop occurrence. For example, assuming the topology shown in <figref idref="DRAWINGS">FIG. 1</figref>, if a blackhole fault occurs on P<b>2</b>'s linecard that impacts the link P<b>2</b>-P<b>1</b>, P<b>2</b> would need to take an action to initiate costing-out the link P<b>2</b>-P<b>1</b> in both directions, hence on both the ends. Microloops may occur in this case when the new metric has not completely propagated to all neighboring nodes. For instance, assuming all the links have a metric of one (1) initially, and that there are no &#x201c;diagonal&#x201d; connections (P<b>1</b>-P<b>4</b> or P<b>2</b>-P<b>3</b>), P<b>1</b> may advertise the directed link P<b>1</b>&#x2192;P<b>2</b> with a metric of max-2, which may then cause a transient state: P<b>1</b> routes to P<b>2</b> via P<b>3</b> (P<b>1</b> knows that the directed link P<b>1</b>=&#x3e;P<b>2</b> is max-2) while P<b>3</b> has not yet received the new metric of the directed link P<b>1</b>=&#x3e;P<b>2</b>, and hence P<b>3</b> routes to P<b>2</b> via P<b>1</b>.</p>
<p id="p-0034" num="0037">To avoid microloops, therefore, one or more embodiments herein may incrementally activate (and advertise) increased metrics until reaching a final expensive usable metric, such that the change from one particularly chosen metric to a next one (along with an appropriate delay) does not cause any microloops in the network. An algorithm that may be used to determine specifically chosen increments may consist in finding all the children devices that depend on the directed link that needs to be modified, and then finding a set of metrics such that at each step (increment), one level of child dependency is impacted (e.g., the grandchildren, then the children, and so on). An illustrative example algorithm that may be used is described in &#x201c;Avoiding transient loops during the convergence of link-state routing protocols,&#x201d; by Pierre Francois and Olivier Bonaventure, IEEE/ACM Transactions on Networking, 15(6):1280-1932, December 2007.</p>
<p id="p-0035" num="0038">As an example implementation, in the above topology, the algorithm would allow P<b>1</b> to realize that it should first set the metric to 2 and propagate it. Indeed, with metric 2, P<b>1</b> does not change its route to P<b>2</b>, while P<b>3</b> will change its route. At this time, P<b>1</b> can set the corresponding P<b>1</b>-P<b>2</b> metric to max-2. Accordingly, the detecting network device may signal to its peers to initiate the incremental increases, and may also perform the increases incrementally as well. Once the ultimate metric (e.g., maximum, max-2, or other expensive chosen metric), acknowledgments may be communicated between the peer devices, e.g., in order to indicate when the faulty interface may enter a maintenance status (or out-of-service, &#x201c;OOS&#x201d; status).</p>
<p id="p-0036" num="0039">Notably, a fault is identified, it may be beneficial to dynamically initiate a recovery mechanism (e.g., auto-recovery or node reload) once the routing protocols have gracefully rerouted the traffic. That is, the embodiments herein may request that traffic be rerouted from problematic interfaces/devices, the detecting network device may itself attempt to recover from the fault state to be eligible to route the traffic once more.</p>
<p id="p-0037" num="0040">While the above description addresses certain core functionalities of one or more embodiments here, other considerations may also be made. For example, to provide the customer with better control over the functionalities various knobs may be provided to allow a &#x201c;sticky expensive metric,&#x201d; in which case, the new metric persists even after the fault goes away and would need to receive a manual fault clearing/removal by an operator. Alternatively, a &#x201c;non-sticky expensive metric&#x201d; may be set to stop expensive metric advertisement after a sufficient wait-time (configurable), once the fault disappears. In other words, in response to determining that the critical fault condition has cleared, the corresponding activated increased and expensive usable metrics may be removed, in response to either expiration of a timer or a manual response. Note also that when a fault is cleared, messages/signals may be exchanged to remove the new metric from peer ends of the interfaces, if so necessary (interface based faults).</p>
<p id="p-0038" num="0041">Further, the embodiments herein may be used in operation with the Traffic Engineering (TE) implementations (e.g., tunnels or other virtual circuits), as shown in <figref idref="DRAWINGS">FIG. 5</figref>, where P<b>1</b> is a head-end node for virtual circuit VC<b>1</b>, and a tail-end node for VC<b>2</b>. If the affected network device is a head-end node or a mid-point node (P<b>1</b> for VC<b>1</b>), then the increased and expensive may be handled during a next re-optimization cycle. In other words, in response to the network device being a head-end device for a TE virtual circuit, and in response to an interface based critical fault condition, the network device may reoptimize the virtual circuit to avoid the one or more particular faulty network interfaces. Alternatively, if the device is a tail-end node, then the effect of increasing the metric may not help to divert the traffic off the tunnel if the tail-end loopback has no redundant tail. Thus, the tail-end node may be configured to signal to a head-end node to bring down the virtual circuit (e.g., tunnel), such as P<b>1</b> telling PE<b>4</b> to bring down VC<b>2</b>. This may be accomplished using Path-Err messages (e.g., with a &#x201c;Fatal&#x201d; bit set) of the Resource Reservation Protocol (RSVP), as opposed to waiting for a reoptimization timer, so that virtual circuit resources may be released and traffic diverted through a backup tunnel on the head-end node. Also, as noted above, OSPF has provided an option (knob) to include stubs in the expensive (e.g., max) metric, and thus when a tail-end node of a virtual circuit activates the new metric on detection of a fault, it could prevent traffic being forwarded towards that loopback, thus for tail-end nodes, the traffic can be diverted to an alternative path. Since IS-IS does not natively have an equivalent option, a novel &#x201c;route invalidation&#x201d; option is created herein to provide this functionality.</p>
<p id="p-0039" num="0042">Moreover, another consideration is to interconnect with IP fast reroute (FRR) features, and force an FRR trigger on the detecting network device. Also, with the proposed BFD extensions, the additional signaling latency is generally very small, so, the peer end could also detect and trigger a high-priority recovery mechanism (e.g., IP-FRR) as well. Additionally, TE-FRR may also be used for interface (per-link) faults, to trigger fast divergence of traffic on the backup links.</p>
<p id="p-0040" num="0043">Finally, if the network device contains a plurality of virtual network devices <b>249</b>, then in response to a network device based critical fault condition, each virtual network device may be informed of the critical fault condition through signaling. That is, on certain routers, where virtual network devices (e.g., secure domain routers, or &#x201c;SDRs&#x201d;) are supported, such that one physical device is logically partitioned into a number of virtual devices, then any device-wide faults may be propagated to the routing protocols in all virtual devices (all logical partitions). Note that critical faults specific to an interface may be acted upon within that specific virtual network device, accordingly.</p>
<p id="p-0041" num="0044"><figref idref="DRAWINGS">FIG. 6</figref> illustrates an example simplified procedure for gracefully handling critical traffic blackholing data plane faults in accordance with one or more embodiments described herein. The procedure <b>600</b> starts at step <b>605</b>, and continues to step <b>610</b>, where a network device <b>200</b> (e.g., P<b>1</b>) detects a data plane critical fault condition (without control plane fault) as described in detail above. If it is determined in step <b>615</b> that the fault is a network device based fault, then in step <b>620</b> the device may activate and advertise an increased and expensive usable metric for each network interface of network device. For instance, as noted above, the increase may be incremental (e.g., to avoid microloops). Also, if there are virtual devices <b>249</b>, then those devices may be signaled (informed) of the fault condition to act accordingly, as well.</p>
<p id="p-0042" num="0045">If, in step <b>615</b>, it is determined that the fault is an interface based fault, then in step <b>625</b> the network device may activate and advertise (e.g., incrementally) an increased and expensive usable metric for each particular network interface of the detected fault. In addition, in step <b>630</b>, the network device may send a signal or request over the still-functioning control plane to a corresponding network device at opposing ends of the faulty network interfaces to indicate that the corresponding network device(s) do the same. Notably, in step <b>630</b>, it is implied that the corresponding network device receives the request, and performs the requested operation, accordingly.</p>
<p id="p-0043" num="0046">As described above, if (for an interface based fault) the network device is a head-end device for a TE virtual circuit, then in step <b>635</b> the device may reoptimize the virtual circuit to avoid the faulty interface(s). Also, in step <b>640</b>, if (for either type of fault) the network device is a tail-end device for a TE virtual circuit, then the device may signal to a corresponding head-end node/device to bring down the virtual circuit. The head-end node in step <b>640</b> may then, if so configured, create a new virtual circuit, most likely avoiding the faulty (e.g., now high cost) interfaces.</p>
<p id="p-0044" num="0047">Once the critical fault condition is cleared in step <b>645</b>, then in step <b>650</b> the network device may remove the corresponding activated increased and expensive usable metrics from the affected network interfaces (e.g., the faulty ones or all of them). Note that as mentioned above, the removal in step <b>650</b> may occur after a timer or after a manual response to remove the metrics. The procedure <b>600</b> may then end in step <b>655</b>.</p>
<p id="p-0045" num="0048">The novel techniques described herein gracefully handle critical traffic blackholing data plane faults in a computer network. By allowing network devices to signal blackholing faults to the rest of the network, the novel techniques allow other network devices to route around the problem in question avoiding microloops, thus increasing the network's overall availability (e.g., useful for self-healing networks). In particular, the techniques described above allow customers to leverage redundancy in their network during such traffic blackholing data plane critical faults. For instance, traffic is handled gracefully without causing traffic drops (critical for video/mission critical applications), and microloops are prevented during the diversion of customer traffic. In addition, the techniques above allow customers to gracefully &#x201c;cost-out&#x201d; a single link under an out of service (OOS) maintenance window, which keeps the control-plane activate (&#x201c;up&#x201d;) but diverts the data-plane traffic.</p>
<p id="p-0046" num="0049">While there have been shown and described illustrative embodiments that gracefully handle critical data plane faults in a computer network, it is to be understood that various other adaptations and modifications may be made within the spirit and scope of the embodiments herein. For example, the embodiments have been shown and described herein using specific signaling and advertising protocols (e.g., BFD and IGP). However, the embodiments in their broader sense are not so limited, and may, in fact, be used with other suitable signaling/advertising protocols. Also, while the above description is shown primarily with regard to physical data plane functionality and related faults, other critical &#x201c;virtual data plane&#x201d; faults may also utilize the techniques herein.</p>
<p id="p-0047" num="0050">The foregoing description has been directed to specific embodiments. It will be apparent, however, that other variations and modifications may be made to the described embodiments, with the attainment of some or all of their advantages. For instance, it is expressly contemplated that the components and/or elements described herein can be implemented as software being stored on a tangible computer-readable medium (e.g., disks/CDs/etc.) having program instructions executing on a computer, hardware, firmware, or a combination thereof. Accordingly this description is to be taken only by way of example and not to otherwise limit the scope of the embodiments herein. Therefore, it is the object of the appended claims to cover all such variations and modifications as come within the true spirit and scope of the embodiments herein.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method, comprising:
<claim-text>detecting, in a network device having one or more network interfaces, a data plane critical fault condition associated with a data plane, wherein a corresponding control plane to the data plane is not experiencing a critical fault condition;</claim-text>
<claim-text>determining whether the detected data plane critical fault condition is one of either an interface based critical fault condition for one or more particular network interfaces of the network device or a network device based critical fault condition;</claim-text>
<claim-text>in response to the data plane critical fault condition being the network device based critical fault condition, activating and advertising an increased and expensive usable metric for each network interface of the network device; and</claim-text>
<claim-text>in response to the data plane critical fault condition being the interface based critical fault condition:
<claim-text>activating and advertising an increased and expensive usable metric for the one or more particular network interfaces of the interface based critical fault condition; and</claim-text>
<claim-text>signaling, over the control plane to a corresponding network device at an opposing end of each particular network interface of the interface based critical fault condition, a request to activate and advertise a corresponding increased and expensive usable metric at the opposing end of each particular network interface.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>incrementally activating one or more increased metrics until reaching the increased and expensive usable metric.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>determining whether the data plane critical fault condition has cleared; and</claim-text>
<claim-text>in response to determining that the data plane critical fault condition has cleared, removing corresponding activated increased and expensive usable metrics.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method as in <claim-ref idref="CLM-00003">claim 3</claim-ref>, further comprising:
<claim-text>removing the corresponding activated increased and expensive usable metrics in response to one of either expiration of a timer or a manual response.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein signaling comprises utilizing one of either Interior Gateway Protocol (IGP) messages or bidirectional forwarding detection (BFD) messages.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>determining whether the network device is a head-end device for a traffic engineering (TE) virtual circuit or a tail-end device for a TE virtual circuit;</claim-text>
<claim-text>in response to the network device being a head-end device for a TE virtual circuit, and in response to the interface based critical fault condition, reoptimizing the virtual circuit to avoid the one or more particular network interfaces; and</claim-text>
<claim-text>in response to the network device being a tail-end device for a TE virtual circuit, signaling to a head-end node of the TE virtual circuit to bring down the virtual circuit.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the network device contains a plurality of virtual network devices, the method further comprising:
<claim-text>in response to the network device based critical fault condition, signaling the critical fault condition to each virtual network device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the increased and expensive usable metric is an Open Shortest Path First (OSPF) maximum metric.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method as in <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the OSPF maximum metric includes stubs.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the increased and expensive usable metric is an Intermediate-System-to-Intermediate-System (IS-IS) maximum metric value less two.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>bringing down a Label Distribution Protocol (LDP) session on each network interface having an increased and expensive usable metric thereon.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the data plane critical fault condition is selected from a group consisting of: multiple fabric planes of the network device being down; significant backplane bandwidth reduction; out of resources (OOR) conditions; and surpassing queue utilization thresholds.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The method as in <claim-ref idref="CLM-00012">claim 12</claim-ref>, further comprising:
<claim-text>configuring thresholds upon which at least one of the network device based critical fault condition and the interface based critical fault condition are detected.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the data plane critical fault condition is a manual selection.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>receiving a signal over the control plane from a corresponding network device at a particular network interface, the signal indicating a request to activate and advertise a second increased and expensive usable metric at the particular network interface; and, in response,</claim-text>
<claim-text>activating and advertising the second increased and expensive usable metric at the particular network interface.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. An apparatus, comprising:
<claim-text>one or more network interfaces;</claim-text>
<claim-text>a processor coupled to the network interfaces and adapted to execute one or more processes; and</claim-text>
<claim-text>a memory adapted to store a process executable by the processor, the process when executed operable to:
<claim-text>detect a data plane critical fault condition associated with a data plane, wherein a corresponding control plane to the data plane is not experiencing a critical fault condition;</claim-text>
<claim-text>determine whether the detected data plane critical fault condition is one of either an interface based critical fault condition for one or more particular network interfaces of the apparatus or an apparatus based critical fault condition;</claim-text>
<claim-text>in response to the data plane critical fault condition being the apparatus based critical fault condition, activate and advertise an increased and expensive usable metric for each network interface of the apparatus; and</claim-text>
<claim-text>in response to the data plane critical fault condition being the interface based critical fault condition:
<claim-text>activate and advertise an increased and expensive usable metric for the one or more particular network interfaces of the interface based critical fault condition; and</claim-text>
<claim-text>signal, over the control plane to a corresponding network device at an opposing end of each particular network interface of the interface based critical fault condition, a request to activate and advertise a corresponding increased and expensive usable metric at the opposing end of each particular network interface.</claim-text>
</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The apparatus as in <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the process when executed is further operable to:
<claim-text>incrementally activate one or more increased metrics until reaching the increased and expensive usable metric.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The apparatus as in <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the process when executed is further operable to:
<claim-text>determine whether the data plane critical fault condition has cleared; and</claim-text>
<claim-text>in response to determining that the data plane critical fault condition has cleared, remove corresponding activated increased and expensive usable metrics.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The apparatus as in <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the increased and expensive usable metric is one of either an Open Shortest Path First (OSPF) global maximum metric or an Intermediate-System-to-Intermediate-System (IS-IS) maximum metric value less two.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The apparatus as in <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the data plane critical fault condition is selected from a group consisting of: multiple fabric planes of the apparatus being down; significant backplane bandwidth reduction; out of resources (OOR) conditions; surpassing queue utilization thresholds, and a manual selection.</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. The apparatus as in <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the process when executed is further operable to:
<claim-text>receive a signal over the control plane from a corresponding network device at a particular network interface, the signal indicating a request to activate and advertise a second increased and expensive usable metric at the particular network interface; and, in response,</claim-text>
<claim-text>activate and advertise the second increased and expensive usable metric at the particular network interface.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00022" num="00022">
<claim-text>22. A non-transitory computer-readable media having software encoded thereon, the software when executed on a network device having one or more network interfaces operable to:
<claim-text>detect a data plane critical fault condition associated with a data plane, wherein a corresponding control plane to the data plane is not experiencing a critical fault condition;</claim-text>
<claim-text>determine whether the detected data plane critical fault condition is one of either an interface based critical fault condition for one or more particular network interfaces of the network device or a network device based critical fault condition;</claim-text>
<claim-text>in response to the data plane critical fault condition being the network device based critical fault condition, activate and advertise an increased and expensive usable metric for each network interface of the network device; and</claim-text>
<claim-text>in response to the data plane critical fault condition being the interface based critical fault condition:
<claim-text>activate and advertise an increased and expensive usable metric for the one or more particular network interfaces of the interface based critical fault condition; and</claim-text>
<claim-text>signal, over the control plane to a corresponding network device at an opposing end of each particular network interface of the interface based critical fault condition, a request to activate and advertise a corresponding increased and expensive usable metric at the opposing end of each particular network interface.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00023" num="00023">
<claim-text>23. The non-transitory computer-readable media as in <claim-ref idref="CLM-00022">claim 22</claim-ref>, the software when executed further operable to:
<claim-text>incrementally activate one or more increased metrics until reaching the increased and expensive usable metric.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
