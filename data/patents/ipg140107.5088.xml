<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08626187-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08626187</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>13152972</doc-number>
<date>20110603</date>
</document-id>
</application-reference>
<us-application-series-code>13</us-application-series-code>
<us-term-of-grant>
<us-term-extension>118</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20090101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>W</subclass>
<main-group>24</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>4554561</main-classification>
<further-classification>4554042</further-classification>
<further-classification>455433</further-classification>
<further-classification>455457</further-classification>
<further-classification>455420</further-classification>
<further-classification>455421</further-classification>
</classification-national>
<invention-title id="d2e53">Monitoring geofence exit</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>2008/0188226</doc-number>
<kind>A1</kind>
<name>Tsai et al.</name>
<date>20080800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455443</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>2008/0225810</doc-number>
<kind>A1</kind>
<name>Buchwald</name>
<date>20080900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>2009/0170528</doc-number>
<kind>A1</kind>
<name>Bull et al.</name>
<date>20090700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>2010/0277309</doc-number>
<kind>A1</kind>
<name>Anderson et al.</name>
<date>20101100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2011/0029370</doc-number>
<kind>A1</kind>
<name>Roeding et al.</name>
<date>20110200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2011/0059748</doc-number>
<kind>A1</kind>
<name>Taylor et al.</name>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2011/0061080</doc-number>
<kind>A1</kind>
<name>Hill et al.</name>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2013/0062474</doc-number>
<kind>A1</kind>
<name>Baldwin et al.</name>
<date>20130300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>246122 R</main-classification></classification-national>
</us-citation>
<us-citation>
<nplcit num="00009">
<othercit>Hermersdorf, et al. &#x201c;Indoor Positioning with a WLAN Access Point List on a Mobile Device&#x201d;, WSW'06 at SenSys'06, Oct. 31, 2006, Boulder, Colorado, USA.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00010">
<othercit>Notification of Transmittal of the International Search Report and the Written Opinion of the International Searching Authority, dated Sep. 11, 2012, for International application No. PCT/US2012/038004, filed May 15, 2012. 11 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00011">
<othercit>Anmol Sheth et al: &#x201c;Geo-fencing: Confining Wi-Fi Coverage to Physical Boundaries,&#x201d; May 11, 2009, Pervasive Computing, Springer Berlin Heidelberg, Berlin, Heidelberg, XP019117457, ISBN: 978-3-642-01515-1. pp. 274-290.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>24</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>4554042</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455433</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>4554561-4566</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455457</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455420</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455421</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>4554221</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>24</number-of-drawing-sheets>
<number-of-figures>28</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20120309409</doc-number>
<kind>A1</kind>
<date>20121206</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Grosman</last-name>
<first-name>Yefim</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Marti</last-name>
<first-name>Lukas M.</first-name>
<address>
<city>Santa Clara</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Grainger</last-name>
<first-name>Morgan</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="004" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Mayor</last-name>
<first-name>Robert</first-name>
<address>
<city>Half Moon Bay</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="005" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Huang</last-name>
<first-name>Ronald K.</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Grosman</last-name>
<first-name>Yefim</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Marti</last-name>
<first-name>Lukas M.</first-name>
<address>
<city>Santa Clara</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Grainger</last-name>
<first-name>Morgan</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="004" designation="us-only">
<addressbook>
<last-name>Mayor</last-name>
<first-name>Robert</first-name>
<address>
<city>Half Moon Bay</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="005" designation="us-only">
<addressbook>
<last-name>Huang</last-name>
<first-name>Ronald K.</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Fish &#x26; Richardson P.C.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Apple Inc.</orgname>
<role>02</role>
<address>
<city>Cupertino</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Cai</last-name>
<first-name>Wayne</first-name>
<department>2644</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Methods, program products, and systems for monitoring geofence exits using wireless access points are disclosed. In general, in one aspect, a mobile device can detect one or more entry gateways that are wireless access points selected for monitoring a geofence. The mobile device can determine that the mobile device is located in the geofence based on the detection. The mobile device can monitor the entry gateways and one or more exit gateways, which can be wireless access points observable by the mobile device when the mobile device is in the geofence. When the mobile device determines, after a number of scans using a wireless processor, that the entry gateways and exit gateways are unobservable, the mobile device can use an application processor to determine whether the mobile device has exited from the geofence.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="150.62mm" wi="166.96mm" file="US08626187-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="239.18mm" wi="191.60mm" file="US08626187-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="235.20mm" wi="183.56mm" file="US08626187-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="239.86mm" wi="194.31mm" file="US08626187-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="233.17mm" wi="166.20mm" orientation="landscape" file="US08626187-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="247.90mm" wi="182.29mm" file="US08626187-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="169.67mm" wi="169.67mm" file="US08626187-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="179.58mm" wi="170.18mm" file="US08626187-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="251.29mm" wi="178.90mm" file="US08626187-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="244.52mm" wi="164.17mm" file="US08626187-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="190.92mm" wi="178.90mm" file="US08626187-20140107-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="243.92mm" wi="183.56mm" orientation="landscape" file="US08626187-20140107-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="223.10mm" wi="154.09mm" file="US08626187-20140107-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="215.73mm" wi="156.13mm" file="US08626187-20140107-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="227.84mm" wi="183.56mm" file="US08626187-20140107-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="199.64mm" wi="132.42mm" orientation="landscape" file="US08626187-20140107-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="247.90mm" wi="181.61mm" orientation="landscape" file="US08626187-20140107-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00017" num="00017">
<img id="EMI-D00017" he="225.81mm" wi="171.53mm" orientation="landscape" file="US08626187-20140107-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00018" num="00018">
<img id="EMI-D00018" he="247.90mm" wi="170.86mm" orientation="landscape" file="US08626187-20140107-D00018.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00019" num="00019">
<img id="EMI-D00019" he="183.39mm" wi="170.69mm" file="US08626187-20140107-D00019.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00020" num="00020">
<img id="EMI-D00020" he="241.22mm" wi="130.64mm" orientation="landscape" file="US08626187-20140107-D00020.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00021" num="00021">
<img id="EMI-D00021" he="231.82mm" wi="178.22mm" file="US08626187-20140107-D00021.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00022" num="00022">
<img id="EMI-D00022" he="163.49mm" wi="186.94mm" file="US08626187-20140107-D00022.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00023" num="00023">
<img id="EMI-D00023" he="249.94mm" wi="180.93mm" file="US08626187-20140107-D00023.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00024" num="00024">
<img id="EMI-D00024" he="246.55mm" wi="176.87mm" orientation="landscape" file="US08626187-20140107-D00024.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">TECHNICAL FIELD</heading>
<p id="p-0002" num="0001">This disclosure relates generally to location-based processing on a mobile device.</p>
<heading id="h-0002" level="1">BACKGROUND</heading>
<p id="p-0003" num="0002">A modern mobile device can incorporate functions of a computer, a cellular transceiver, and a wireless (e.g., WiFi&#x2122;) transceiver. For example, the mobile device can perform traditional computer functions, such as executing application programs, storing various data, and displaying digital images. These functions can be performed in an application subsystem of the mobile device. The application subsystem can include an application processor, an application operating system, and various input/output devices. Using the cellular transceiver, the mobile device can function as a cellular phone. Using the wireless transceiver, the mobile device can access a communications network through one or more wireless access points (WAPs).</p>
<p id="p-0004" num="0003">Some of the functions performed by a mobile device can be functions based on a geofence. A geofence can include a virtual boundary of a real-world geographic area. The mobile device can be programmed to perform a task when the mobile device is located inside of a geofence. The mobile device can determine whether the mobile device is located inside of a geofence by comparing a location of the mobile device with coordinates of the geographic area. A conventional mobile device can determine the current location using cell tower triangulation or global positioning system (GPS) functions. The application processor of the mobile device can perform the triangulation or GPS calculations.</p>
<heading id="h-0003" level="1">SUMMARY</heading>
<p id="p-0005" num="0004">Methods, program products, and systems for monitoring a geofence using wireless access points are disclosed. In general, in one aspect, a mobile device receives data defining the geofence. The mobile device can select, from multiple wireless access points, one or more wireless access points for monitoring the geofence. The selected wireless access points can be monitored by a wireless processor of the mobile device. The wireless processor can detect a potential entry of the geofence when at least one of the selected one or more wireless access points is detected. Upon a detection of the potential entry of the geofence by the wireless processor, the mobile device can wake an application processor of the mobile device to determine whether the mobile device is inside of the geofence.</p>
<p id="p-0006" num="0005">In another aspect, a mobile device can detect one or more entry gateways that are wireless access points selected for monitoring a geofence. The mobile device can determine that the mobile device is located in the geofence based on the detection. The mobile device can monitor the entry gateways and one or more exit gateways, which can be wireless access points observable by the mobile device when the mobile device is in the geofence. When the mobile device determines, after a number of scans using a wireless processor, that the entry gateways and exit gateways are unobservable, the mobile device can use an application processor to determine whether the mobile device has exited from the geofence.</p>
<p id="p-0007" num="0006">In another aspect, a mobile device can monitor multiple geofences simultaneously. The mobile device can create a temporary geofence based on a current location of the mobile device. The mobile device can designate one or more wireless access points observable from each of the multiple geofences as common gateways for monitoring the temporary geofence. When the mobile device determines, after a number of scans using a wireless processor, that the common gateways are unobservable, the mobile device can wake an application processor to determine whether the mobile device has exited from each of the multiple geofences.</p>
<p id="p-0008" num="0007">In another aspect, a mobile device can receive data defining a geofence. The mobile device can select, from multiple wireless access points, one or more wireless access points for monitoring the geofence. The selected wireless access points can be monitored by a wireless processor of the mobile device. The wireless processor can detect a potential exit of the geofence when none of the selected one or more wireless access points is detected by the wireless processor for a threshold number of consecutive scans. Upon a detection of the potential exit of the geofence by the wireless processor, the mobile device can wake an application processor of the mobile device to determine whether the mobile device exited the geofence.</p>
<p id="p-0009" num="0008">In another aspect, the mobile device can select, from multiple wireless access points, one or more wireless access points for monitoring a geofence. Selecting the one or more wireless access points can include determining multiple geographic regions corresponding to the geofence. The mobile device can select the one or more wireless access points based on a maximum total number of wireless access points to be selected and an access point allowance for each of the geographic regions. The access point allowance can indicate a maximum number of wireless access points to be selected for the geographic region. The mobile device can detect a potential entry or exit of the geofence by monitoring the selected one or more wireless access points using a wireless processor. Upon a detection of the potential entry or exit of the geofence by the wireless processor, the mobile device can wake an application processor of the mobile device to determine whether the mobile device is inside or outside of the geofence.</p>
<p id="p-0010" num="0009">The techniques described in this specification can be implemented to achieve the following advantages. Battery power can be conserved. Geofence monitoring can require constant or frequent location identification. The location identification is conventionally performed by an application processor. A mobile device implementing the described technology can monitor a geofence using a wireless processor (e.g., a WiFi&#x2122; chip), which often consumes less power than the application processor. The application processor can be put to an inactive mode, and be awakened when a location of the mobile device relative to the geofence has changed. Thus, the constant or frequent location identification operations can be performed by a less power-hungry component most of the time.</p>
<p id="p-0011" num="0010">A relative position between a mobile device and a geofence can be detected by monitoring wireless access points using a wireless processor with limited scanning capacity without sacrificing accuracy. A geofence can be associated with more wireless access points than the wireless processor can monitor. A mobile device can select, using techniques described in this specification, a number of statistically more important wireless access points for scanning. Thus, the mobile device can monitor the geofence under constraints of the capacity of the wireless processor, or monitor multiple geofences at the same time.</p>
<p id="p-0012" num="0011">The details of one or more implementations of the subject matter of this specification are set forth in the accompanying drawings and the description below. Other features, aspects, and advantages of subject matter will become apparent from the description, the drawings, and the claims.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIGS. 1A-1C</figref> are diagrams illustrating exemplary techniques of monitoring a geofence.</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram illustrating exemplary components of a system implementing techniques of monitoring a geofence using wireless access points.</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIGS. 3A and 3B</figref> are diagrams illustrating exemplary error prevention techniques in monitoring a geofence.</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIGS. 4A-4D</figref> are flowcharts illustrating exemplary operations of monitoring a geofence.</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 5</figref> is a diagram illustrating an exemplary user interface of a mobile device using a geofence-based service.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 6</figref> is a flowchart illustrating an exemplary process of selecting wireless access points for monitoring a geofence.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 7</figref> is a diagram illustrating exemplary techniques for selecting wireless access points for monitoring using a geographic grid.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIGS. 8A and 8B</figref> are diagrams illustrating exemplary wireless access point allowances used in identifying candidate wireless access points for selection.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIGS. 9A and 9B</figref> are diagrams illustrating exemplary stages of assigning wireless access point allowances to a geographic grid.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 9C</figref> is a flowchart illustrating an exemplary process of identifying candidate wireless access points based on geographic regions.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 9D</figref> is an exemplary histogram illustrating techniques of identifying candidate wireless access points based on channel optimization.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 10</figref> is a diagram illustrating exemplary techniques for evaluating a set of candidate wireless access points.</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 11</figref> is a diagram illustrating exemplary techniques of selecting wireless access points for monitoring a geofence from sets of candidate wireless access points.</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 12</figref> is a diagram illustrating exemplary techniques of selecting wireless access points for multiple geofences from sets of candidate wireless access points.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 13A</figref> is a flowchart illustrating exemplary operations for selecting wireless access points for monitoring multiple geofences.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 13B</figref> illustrates an exemplary application of the operations of <figref idref="DRAWINGS">FIG. 13A</figref>.</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 14</figref> is a block diagram illustrating exemplary components of a system implementing techniques of selecting wireless access points for monitoring a geofence.</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 15</figref> is a flowchart illustrating exemplary operations of wireless access point selection.</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 16</figref> is a block diagram illustrating an exemplary device architecture of a mobile device implementing the features and operations described in reference to <figref idref="DRAWINGS">FIGS. 1-15</figref>.</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 17</figref> is a block diagram of an exemplary network operating environment for the mobile devices of <figref idref="DRAWINGS">FIGS. 1-16</figref>.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<p id="p-0033" num="0032">Like reference symbols in the various drawings indicate like elements.</p>
<heading id="h-0005" level="1">DETAILED DESCRIPTION</heading>
<heading id="h-0006" level="1">Exemplary Detection of a Geofence</heading>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIGS. 1A and 1B</figref> are diagrams illustrating exemplary techniques of detecting a geofence. Detecting a geofence can include detecting whether a mobile device is located inside or outside of a geofence. <figref idref="DRAWINGS">FIG. 1A</figref> is a diagram illustrating exemplary techniques of detecting an entry into a geofence by mobile device <b>100</b>.</p>
<p id="p-0035" num="0034">Mobile device <b>100</b> can be an exemplary mobile device that implements the techniques of detecting a geofence. Mobile device <b>100</b> can include application subsystem <b>102</b> that includes an application processor, wireless communications subsystem <b>104</b> that includes a wireless processor, and a baseband subsystem that includes a baseband processor.</p>
<p id="p-0036" num="0035">Mobile device <b>100</b> can be configured to detect a potential entry into geofence <b>110</b> using wireless communication subsystem <b>104</b>. Geofence <b>110</b> can include a fence location (e.g., a center of the fence) and a fence dimension (e.g., a radius when the fence is a circle). The fence location can include latitude and longitude coordinates. Geofence <b>110</b> can be associated with an entity (e.g., a company, school, or home).</p>
<p id="p-0037" num="0036">To detect the potential entry into geofence <b>110</b>, mobile device <b>100</b> can select one or more wireless access points for monitoring. The one or more wireless access points can be selected from wireless access points determined to be detectable from a mobile device when a mobile device is located in geofence <b>110</b>. The selected one or more wireless access points are represented in <figref idref="DRAWINGS">FIG. 1A</figref> and other figures as black triangles. The selected one or more wireless access points can include wireless access point <b>112</b>. Not all wireless access points that are detectable from a mobile device when a mobile device is located in geofence <b>110</b> need to be selected for monitoring geofence <b>110</b>. For example, wireless access point <b>114</b> can be such a wireless access point not selected by mobile device <b>100</b>. In <figref idref="DRAWINGS">FIG. 1A</figref> and other figures, the wireless access points that are (a) detectable from mobile device <b>100</b> when mobile device <b>100</b> is located in geofence <b>110</b> and (b) not selected by mobile device <b>100</b> for monitoring are represented as white triangles. The selection is facilitated by virtual geographic grid <b>116</b>. Virtual geographic grid <b>116</b> is a geographic area corresponding to geofence <b>110</b> that is created by mobile device <b>100</b> for determining which wireless access point to select. Further details of selecting wireless access points are described below in reference to <figref idref="DRAWINGS">FIGS. 6-15</figref>.</p>
<p id="p-0038" num="0037">Mobile device <b>100</b> can monitor an entry into geofence <b>110</b> by scanning signals from the selected one or more wireless access points using wireless communications subsystem <b>104</b>. Wireless communications subsystem <b>104</b> can include a wireless processor and fence detection instructions <b>108</b>. Execution of fence detection instructions <b>108</b> can cause the wireless processor to scan one or more communication channels to detect signals from wireless access points and device identifiers of the wireless access points. The device identifier of a wireless access point can include, for example, a media access control (MAC) address of the wireless access point. If the scan detects a device identifier and the device identifier matches a device identifier of one of the selected wireless access points, a potential fence entry can be detected. Mobile device <b>100</b> can scan signals continuously or frequently without draining a battery, when wireless communications subsystem <b>104</b> consumes a small amount of power during each scan.</p>
<p id="p-0039" num="0038">In this example, wireless communications subsystem <b>104</b> of mobile device <b>100</b> detects (<b>111</b>) a signal associated with a device identifier matching that of wireless access point <b>112</b>. Accordingly, wireless communications subsystem <b>104</b> detects a potential entry into geofence <b>110</b>. Upon the detection of the potential entry, wireless communications subsystem <b>104</b> can activate application subsystem <b>102</b>. Activating application subsystem <b>102</b> can include, for example, waking application subsystem <b>102</b> from a &#x201c;sleep&#x201d; state. Inactive application subsystem <b>102</b> is represented as an unshaded block in <figref idref="DRAWINGS">FIG. 1A</figref> and other figures. Activated application subsystem <b>102</b> is represented as a shaded block in <figref idref="DRAWINGS">FIG. 1A</figref> and other figures.</p>
<p id="p-0040" num="0039">Application subsystem <b>102</b> can include an application processor and geofence instructions <b>106</b>. Application subsystem <b>102</b> can be configured to, upon being activated by wireless communications subsystem <b>104</b>, execute geofence instructions <b>106</b> to determine whether mobile device <b>100</b> entered into geofence <b>110</b>. Geofence instructions <b>106</b> can include location determination instructions and location comparison instructions. The location determination instructions can, upon execution, cause application subsystem <b>102</b> to determine a current location of mobile device <b>100</b> using various location-determining devices or programs. Determining a current location of mobile device <b>100</b> may or may not include operations by wireless communications subsystem <b>104</b>. The location comparison instructions can, upon execution, cause application subsystem <b>102</b> to compare (<b>117</b>) the current location with geofence <b>110</b>.</p>
<p id="p-0041" num="0040">If application subsystem <b>102</b> determines that the current location is inside of geofence <b>110</b> (e.g., at location <b>118</b>), application subsystem <b>102</b> can determine that mobile device <b>100</b> entered geofence <b>110</b>, and perform a task associated with the entry of geofence <b>110</b>. The task can include, for example, displaying or sounding an alarm, displaying an advertisement, or activating a security measure.</p>
<p id="p-0042" num="0041">If application subsystem <b>102</b> determines that the current location is not in geofence <b>110</b>, application subsystem <b>102</b> can determine that mobile device <b>100</b> did not enter geofence <b>110</b>, and that the potential entry detected by wireless communications subsystem <b>104</b> may be an error. Application subsystem <b>102</b> can perform error prevention operations regarding wireless access point <b>112</b> (e.g., &#x201c;blacklisting&#x201d; wireless access point <b>112</b>). Further details of the error correction operations are described below in reference to <figref idref="DRAWINGS">FIGS. 3A and 3B</figref>.</p>
<p id="p-0043" num="0042">After determining the current location of mobile device <b>100</b> and determining that an entry into geofence <b>110</b> did or did not occur, application subsystem <b>102</b> can stop monitoring the current location and allows the wireless communications subsystem to continue the scanning for determining a potential entry to another geofence, or for determining a potential exit from geofence <b>110</b>. Thus, application subsystem <b>102</b> can be deactivated (e.g., put to &#x201c;sleep&#x201d; mode) while the wireless subsystem continues monitoring geofence <b>110</b>.</p>
<p id="p-0044" num="0043"><figref idref="DRAWINGS">FIG. 1B</figref> is a diagram illustrating exemplary techniques of detecting an exit from a geofence. Mobile device <b>100</b> can be a device that has determined to be located in geofence <b>110</b> using the techniques described in reference to <figref idref="DRAWINGS">FIG. 1A</figref>. Application subsystem <b>102</b> of mobile device <b>100</b> can be in a deactivated mode (e.g., a &#x201c;sleep&#x201d; mode).</p>
<p id="p-0045" num="0044">Upon detecting that mobile device <b>100</b> entered geofence <b>110</b>, fence detection instructions <b>108</b> can cause a wireless processor of wireless communications subsystem <b>104</b> to scan wireless access points to detect a potential exit. The wireless processor can scan communication channels for signals from (a) the wireless access points selected based on grid <b>116</b>, and (b) wireless access points not selected but are detectable by mobile device <b>100</b> when mobile device <b>100</b> is in geofence <b>110</b> (e.g., wireless access point <b>114</b>). When the wireless processor does not detect (<b>113</b>) a signal from any of wireless access points of (a) and (b) in N consecutive scans, wireless communications subsystem <b>104</b> can determine that a potential exit of geofence <b>110</b> has occurred. The number N can be a scan threshold.</p>
<p id="p-0046" num="0045">Upon detecting the potential exit, wireless communications subsystem <b>104</b> can activate application subsystem <b>102</b>. Application subsystem <b>102</b> can then determine a current location of mobile device <b>100</b> (e.g., location <b>120</b>) and compare (<b>117</b>) the current location with geofence <b>110</b>. If, based on the comparison, application subsystem <b>102</b> determines that the current location is outside of geofence <b>110</b>, application subsystem <b>102</b> can determine that mobile device <b>100</b> exited geofence <b>110</b>. Wireless communications subsystem <b>104</b> can then scan the wireless access points selected based on grid <b>116</b> and determine whether there is another potential entry into geofence <b>110</b>. In some implementations, mobile device <b>100</b> can monitor multiple wireless access points to monitor multiple geofences.</p>
<p id="p-0047" num="0046"><figref idref="DRAWINGS">FIG. 1C</figref> is a diagram illustrating exemplary techniques of detecting an exit from a geofence when multiple geofences are monitored. Mobile device <b>100</b> can be a device that has determined to be located in geofence <b>110</b> using the techniques described in reference to <figref idref="DRAWINGS">FIGS. 1A and 1B</figref>. Application subsystem <b>102</b> of mobile device <b>100</b> can be in a deactivated mode (e.g., a &#x201c;sleep&#x201d; mode).</p>
<p id="p-0048" num="0047">In addition to geofence <b>110</b>, mobile device <b>100</b> can be located in geofences <b>144</b> and <b>146</b>. Geofences <b>144</b> and <b>146</b> can be geofences that intersect geofence <b>110</b>. Each of geofences <b>110</b>, <b>144</b>, and <b>146</b> can correspond to a set of wireless access points for monitoring the respective geofence. Mobile device <b>100</b> can move in such a way that mobile device enters and exits a geofence (e.g., geofence <b>110</b>) while remaining in the other geofences (e.g., geofences <b>144</b> and <b>146</b>). For example, mobile device <b>100</b> can move from location <b>148</b> (which is inside each of geofences <b>110</b>, <b>144</b>, and <b>146</b>) to location <b>150</b> (which is inside of geofences <b>144</b> and <b>146</b>, but outside of geofence <b>110</b>).</p>
<p id="p-0049" num="0048">Mobile device <b>100</b> can monitor geofences <b>110</b>, <b>144</b>, and <b>146</b> by creating temporary geofence <b>152</b>. Mobile device <b>100</b> can create temporary geofence <b>152</b> based on a current location of mobile device <b>100</b> when mobile device <b>100</b> is located in multiple geofences. For example, when an application processor of mobile device <b>100</b> determines that mobile device <b>100</b> in geofence <b>110</b> and geofence <b>144</b>, mobile device <b>100</b> can create a first temporary geofence. When the application processor determines that mobile device <b>100</b> subsequently entered geofence <b>146</b> while still in geofences <b>110</b> and <b>144</b>, mobile device <b>100</b> can create temporary geofence <b>152</b>. Mobile device <b>100</b> can designate the current location (e.g., location <b>148</b>) as a location of temporary geofence <b>152</b>. Mobile device <b>100</b> can designate a specified dimension (e.g., 100 meters) as a dimension (e.g., a radius) of temporary geofence <b>152</b>.</p>
<p id="p-0050" num="0049">Mobile device <b>100</b> can designate one or more exit gateways for monitoring temporary geofence <b>152</b>. The exit gateways can be selected from wireless access points located within temporary geofence <b>152</b> or otherwise related to temporary geofence <b>152</b>. The exit gateways can be wireless access points observable from geofences <b>110</b>, <b>142</b>, and <b>146</b> in which mobile device <b>100</b> is located. The exit gateways can include wireless access point <b>154</b>, which was previously selected by mobile device <b>100</b> to monitor at least one of geofences <b>110</b>, <b>142</b>, or <b>146</b>. The exit gateways can include wireless access point <b>156</b>, which was not previously selected for monitoring a geofence but is observable by mobile device <b>100</b> when mobile device <b>100</b> is located at location <b>148</b>.</p>
<p id="p-0051" num="0050">Upon creating temporary geofence <b>152</b> and designating the exit gateways (e.g., wireless access points <b>154</b> and <b>156</b>), fence detection instructions <b>108</b> can cause a wireless processor of wireless communications subsystem <b>104</b> to scan the exit gateways to detect a potential exit. The wireless processor can scan (<b>158</b> and <b>160</b>) communication channels for signals from the exit gateways. When the wireless processor does not detect a signal from any of the exit gateways in N consecutive scans, wireless communications subsystem <b>104</b> can determine that a potential exit of temporary geofence <b>152</b> has occurred. The number N can be a scan threshold.</p>
<p id="p-0052" num="0051">Upon detecting the potential exit from temporary geofence <b>152</b>, wireless communications subsystem <b>104</b> can activate application subsystem <b>102</b>. Application subsystem <b>102</b> can then determine new location <b>150</b> of mobile device <b>100</b> and compare new location <b>150</b> with each of the geofences <b>110</b>, <b>144</b>, and <b>146</b>. If, based on the comparison, application subsystem <b>102</b> determines that new location <b>150</b> is outside of geofence <b>110</b>, but still in geofence <b>144</b> and <b>146</b>, application subsystem <b>102</b> can determine that mobile device <b>100</b> exited geofence <b>110</b>. Mobile device <b>100</b> can then create a new temporary geofence and associate a new set of exit gateways for monitoring the new temporary geofence, and thus monitoring exit of geofence <b>144</b> and <b>146</b>. Mobile device <b>100</b> can monitor wireless access gateways associated with geofence <b>110</b> for re-entry into geofence <b>110</b>.</p>
<heading id="h-0007" level="1">Exemplary Fence Detection System</heading>
<p id="p-0053" num="0052"><figref idref="DRAWINGS">FIG. 2</figref> is a block diagram illustrating exemplary components of a system implementing techniques of monitoring a geofence using wireless access points. The system can be implemented on mobile device <b>100</b> as described above in reference to <figref idref="DRAWINGS">FIGS. 1A and 1B</figref>.</p>
<p id="p-0054" num="0053">Mobile device <b>100</b> can include application subsystem <b>102</b>. Application subsystem <b>102</b> can include software and hardware components configured to perform operations of geofence detection. Application subsystem <b>102</b> can include geofence definition unit <b>202</b>. Geofence definition unit <b>202</b> is a component of application subsystem <b>102</b> configured to receive data defining a geofence. Geofence definition unit <b>202</b> can receive the data defining the geofence from a user interface (e.g., a touch-sensitive display screen), from a remote server, or from an application program executing on mobile device <b>100</b>.</p>
<p id="p-0055" num="0054">The data received by geofence definition unit <b>202</b> can be processed by geofence processing unit <b>204</b>. Geofence processing unit <b>204</b> can be a component of application subsystem configured to perform operations relating to geofence detection. Geofence processing unit <b>204</b> can include geofence instructions <b>106</b> and geofence interface <b>206</b>. Geofence interface <b>206</b> can be a component of geofence processing unit <b>204</b> configured to interface between a system component (e.g., geofence definition unit <b>202</b>) and geofence instructions <b>106</b>.</p>
<p id="p-0056" num="0055">Geofence instructions <b>106</b> can include instructions that, upon execution, cause application processor <b>208</b> to perform various operations. The operations can include access point selection operations and location determination operations. When performing the access point selection operations, application processor <b>208</b> can select, based on the data defining the geofence received from geofence definition unit <b>202</b>, one or more wireless access points from data store <b>230</b>. Data store <b>230</b> is a component of application subsystem <b>102</b> configured to store a list of identifiers of wireless access points and related information. The data stored in data store <b>230</b> can be received from a remote server.</p>
<p id="p-0057" num="0056">Geofence processing unit <b>204</b> can send the selected wireless access points to wireless communications subsystem <b>104</b> for monitoring. Wireless communications subsystem <b>104</b> can include interface <b>212</b> configured to send information to application subsystem <b>102</b> or receive information from application subsystem <b>102</b>. Wireless communications subsystem <b>104</b> can include data store <b>216</b>. Data store <b>216</b> is a component of wireless communications subsystem <b>104</b> configured to store a list of wireless access points received from application subsystem <b>102</b>. Wireless communications subsystem <b>104</b> can include wireless transceiver <b>220</b>. Fence detection instructions <b>108</b>, when executed, can cause wireless transceiver <b>220</b> to scan for wireless signals.</p>
<p id="p-0058" num="0057">In addition to a list of the selected wireless access points, geofence processing unit <b>204</b> can send operation modes instructions to wireless communications subsystem <b>104</b>. The operation modes can include entry detection mode and exit detection mode. When wireless communications subsystem <b>104</b> operates under entry detection mode, if wireless transceiver <b>220</b> detects a signal from a wireless access point matching one of the wireless access points stored in data store <b>216</b>, wireless communications subsystem <b>104</b> can send an activation signal to application subsystem <b>102</b> for detecting an entry. When wireless communications subsystem <b>104</b> operates under exit detection mode, wireless communications subsystem <b>104</b> can count a number of consecutive scans in which wireless transceiver <b>220</b> does not detect any wireless access points that can match the wireless access points stored in data store <b>216</b>. Then, wireless communications subsystem <b>104</b> can send an activation signal to application subsystem <b>102</b> for detecting an exit.</p>
<p id="p-0059" num="0058">Wireless communications subsystem <b>104</b> can monitor multiple geofences concurrently, including monitoring the wireless access points for each of the geofences. Wireless communications subsystem <b>104</b> can operate in an entry detection mode for one geofence, and in an exit detection mode for another geofence. Some or all components of wireless communications subsystem <b>104</b> can be implemented on a wireless processor (e.g., a WiFi&#x2122; chip).</p>
<heading id="h-0008" level="1">Exemplary Error Prevention</heading>
<p id="p-0060" num="0059"><figref idref="DRAWINGS">FIGS. 3A and 3B</figref> are diagrams illustrating error prevention in monitoring a geofence. False positives of potential geofence entry or exit can occur. A false positive occurs when a wireless processor detects a potential entry of a geofence, but the entry did not actually occur. Error prevention techniques can be utilized to prevent a future false positive based on a known false positive.</p>
<p id="p-0061" num="0060"><figref idref="DRAWINGS">FIG. 3A</figref> illustrates exemplary geofence <b>110</b> and an error tolerance zone <b>302</b>. Some of the potential entries of mobile device <b>100</b> into geofence <b>110</b> (as described above in reference to <figref idref="DRAWINGS">FIGS. 1A-1C</figref>, and <b>2</b>) can be detected when mobile device <b>100</b> did not enter into geofence <b>110</b>. To reduce the false positives, error tolerance zone <b>302</b> can be created.</p>
<p id="p-0062" num="0061">Example geofence <b>110</b> is a circular geofence having a center and a radius. Wireless communications subsystem <b>104</b> of mobile device <b>100</b> can detect a signal from wireless access point <b>304</b> designated for monitoring geofence <b>110</b>. Then, application subsystem can determine that mobile device <b>100</b> is located at location <b>314</b>. If location <b>314</b> is outside error tolerance zone <b>302</b>, mobile device <b>100</b> can determine that wireless access point <b>304</b> is unreliable for monitoring geofence <b>110</b>. Accordingly, mobile device <b>100</b> can blacklist wireless access point <b>304</b>. In some implementations, blacklisting wireless access point <b>304</b> can include excluding wireless access point <b>304</b> from future monitoring. In some implementations, blacklisting wireless access point <b>304</b> can include reducing a probability that wireless access point <b>304</b> is selected for monitoring geofence <b>110</b>. For example, mobile device <b>100</b> can assign a score to wireless access point <b>304</b> that reduces a weight of wireless access point <b>304</b> in device selection operations.</p>
<p id="p-0063" num="0062">Error tolerance zone <b>302</b> can be defined using an error tolerance value. The error tolerance value can include a threshold distance from an edge of geofence <b>110</b>. Thus, if the distance between location <b>314</b> and center of geofence <b>110</b> is greater than a sum of the radius of geofence <b>110</b> and the threshold distance, mobile device <b>100</b> can determine that wireless access point <b>304</b> is unreliable for monitoring geofence <b>110</b>.</p>
<p id="p-0064" num="0063"><figref idref="DRAWINGS">FIG. 3B</figref> illustrates exemplary geofence <b>318</b> and an error tolerance zone <b>320</b>. A geofence can have any shape and size. For example, geofence <b>318</b> can be an ellipse defined using a center and a width and a height, or a polygon defined using vertices of the polygon. Error tolerance zone <b>320</b> can be defined using a threshold distance from each edge of the ellipse or polygon.</p>
<heading id="h-0009" level="1">Exemplary Fence Detection Processes</heading>
<p id="p-0065" num="0064"><figref idref="DRAWINGS">FIGS. 4A and 4B</figref> are flowcharts illustrating exemplary operations of monitoring a geofence. <figref idref="DRAWINGS">FIG. 4A</figref> is a flowchart illustrating exemplary operations <b>400</b> of monitoring a geofence. The operations can be performed by mobile device <b>100</b> as described above in reference to the previous figures.</p>
<p id="p-0066" num="0065">Mobile device <b>100</b> can receive (<b>402</b>) data defining a geofence. The data defining the geofence can include a fence location and a fence dimension. The fence location can include latitude, longitude, and altitude coordinates. The fence location can be a center point of the geofence. The fence dimension can be a radius. The data can be received from a user.</p>
<p id="p-0067" num="0066">Mobile device <b>100</b> can identify (<b>404</b>) one or more wireless access points for monitoring the geofence. Identifying the one or more wireless access points can include selecting the one or more wireless access points from multiple geofences. The selection operations will be described in further details below in reference to <figref idref="DRAWINGS">FIGS. 6-15</figref>.</p>
<p id="p-0068" num="0067">Mobile device <b>100</b> can determine (<b>406</b>) a tentative location of mobile device <b>100</b> relative to the geofence. A location of mobile device <b>100</b> relative to the geofence can include a location inside of the geofence or a location outside of the geofence. Mobile device <b>100</b> can use a wireless processor of the mobile device to determine the tentative location of the mobile device relative to the geofence. To determine the tentative location, mobile device <b>100</b> can monitor the one or more identified access points. Monitoring the access points can include scanning, on one or more channels, a signal from the one or more identified wireless access points. Detecting at least one of the one or more identified wireless access points can include receiving a signal associated with a media access control (MAC) address of a wireless access point, the MAC address of the wireless access point matching one of a list of MAC addresses associated with the one or more identified wireless access points. The wireless processor can include a wireless chip that consumes less power than the application processor.</p>
<p id="p-0069" num="0068">Determining the tentative location of the mobile device relative to the geofence can include detecting a potential entry into the geofence, or detecting a potential exit from a geofence. In a potential entry case, determining the tentative location of the mobile device relative to the geofence can include detecting a potential entry of the geofence when at least one of the one or more identified wireless access points is detected by the wireless processor. In a potential exit case, determining the tentative location of the mobile device relative to the geofence can include detecting a potential exit from the geofence when, in a threshold number of consecutive scans, none of the one or more identified wireless access points and none of the wireless access points detectable in the geofence is detected.</p>
<p id="p-0070" num="0069">Upon determining the tentative location of the mobile device relative to the geofence by the wireless processor, mobile device <b>100</b> can wake an application processor of mobile device <b>100</b>. Waking the application processor of mobile device <b>100</b> can include changing the application processor of mobile device <b>100</b> from an inactive state (e.g., power conserving state) to an active state. Mobile device <b>100</b> can use the application processor to determine (<b>408</b>) whether mobile device <b>100</b> is inside of the geofence. Determining whether mobile device <b>100</b> is inside of the geofence can include enabling the application processor of mobile device <b>100</b> to determine a current location of mobile device <b>100</b>, and determine whether the current location is located inside of the geofence. If the application processor of mobile device <b>100</b> determines, based on the current location, that an entry has occurred, mobile device <b>100</b> can proceed to determine a potential exit using the wireless processor.</p>
<p id="p-0071" num="0070">If the application processor of mobile device <b>100</b> determines that mobile device <b>100</b> is located inside of the geofence, the application processor can perform a task related to the geofence. The application processor can set the operation mode of the wireless processor to an exit detection mode. If the wireless processor tentatively determined that mobile device <b>100</b> is located inside of the geofence, but the application processor of mobile device <b>100</b> determines that mobile device <b>100</b> is located outside of and at least a threshold away from the geofence, the application processor can perform error prevention operations. For example, after the wireless processor tentatively determined that mobile device <b>100</b> is located inside of the geofence, mobile device <b>100</b> can determine, using the application processor, that mobile device <b>100</b> is located at a distance away from the geofence. The application processor can determine that the distance exceeds an error threshold. Then, mobile device <b>100</b> can designate a detected wireless access point as an unreliable wireless access point, including excluding the wireless access point from future monitoring or decreasing an access point score associated with the wireless access point.</p>
<p id="p-0072" num="0071">Upon an exit from a geofence, mobile device <b>100</b> can set the wireless processor to an entry detection mode.</p>
<p id="p-0073" num="0072"><figref idref="DRAWINGS">FIG. 4B</figref> is a flowchart illustrating exemplary operations <b>420</b> of monitoring a geofence exit. The operations can be performed by mobile device <b>100</b> as described above in reference to the previous figures. Mobile device <b>100</b> can determine (<b>422</b>), using an application processor of mobile device <b>100</b>, that mobile device <b>100</b> is inside of a geofence.</p>
<p id="p-0074" num="0073">Mobile device <b>100</b> can monitor (<b>424</b>), using the wireless processor, a combined collection of wireless access points. The combined collection of wireless access points can include (a) one or more wireless access points identified in stage <b>404</b> as described in reference to <figref idref="DRAWINGS">FIG. 4A</figref>, and (b) one or more currently visible wireless access points. Monitoring the combined collection of wireless access points can include scanning for signals from the combined collection of wireless access points using the wireless processor.</p>
<p id="p-0075" num="0074">Mobile device <b>100</b> can determine (<b>426</b>), that for at least a threshold number of scans, none of the combined collection of wireless access points is observable. Then, mobile device <b>100</b> can wake the application processor of mobile device <b>100</b>. Mobile device <b>100</b> can determine (<b>428</b>) whether mobile device <b>100</b> exited from the geofence using the application processor. When the application processor of mobile device <b>100</b> that mobile device <b>100</b> exited from the geofence, mobile device <b>100</b> can perform a task associated with the exit from the geofence (e.g., displaying or sounding an alarm).</p>
<p id="p-0076" num="0075"><figref idref="DRAWINGS">FIG. 4C</figref> is a flowchart illustrating exemplary operations <b>440</b> of monitoring a geofence exit. The operations can be performed by mobile device <b>100</b> as described above in reference to the previous figures. Mobile device <b>100</b> can determine (<b>442</b>), using an application processor of mobile device <b>100</b>, that mobile device <b>100</b> is inside of a geofence. Determining that mobile device <b>100</b> is inside of the geofence can include monitoring, using a wireless processor of mobile device <b>100</b>, one or more entry gateways. The one or more entry gateways can be one or more wireless access points selected for monitoring an entry into the geofence. Determining that mobile device <b>100</b> is inside of the geofence can include waking the application processor and using the application processor to determine that the mobile device entered the geofence upon detecting, by the wireless processor, at least one of the one or more entry gateways. The application processor can determine a location of mobile device <b>100</b> using various location-determination devices or programs.</p>
<p id="p-0077" num="0076">Mobile device <b>100</b> can designate (<b>444</b>) one or more exit gateways. The exit gateways can include one or more wireless access points observable when mobile device <b>100</b> is in the geofence. Mobile device <b>100</b> can use the exit gateways to monitor an exit from the geofence.</p>
<p id="p-0078" num="0077">Mobile device <b>100</b> can detect (<b>446</b>) an exit from the geofence based at least in part on monitoring the exit gateways. Detecting the exit can include monitoring, using the wireless processor, a combined collection of wireless access points including the one or more entry gateways and the one or more exit gateways. Mobile device <b>100</b> can determine that, for at least a threshold number of scans by the wireless processor, none of the combined collection of wireless access points is observable by the wireless processor. Then, mobile device <b>100</b> can wake the application processor of the mobile device to determine whether the mobile device exited the geofence.</p>
<p id="p-0079" num="0078"><figref idref="DRAWINGS">FIG. 4D</figref> is a flowchart illustrating exemplary operations <b>450</b> of monitoring a geofence exit when a mobile device is in multiple geofences. The operations can be performed by mobile device <b>100</b> as described above in reference to the previous figures.</p>
<p id="p-0080" num="0079">Mobile device <b>100</b> can determine that mobile device <b>100</b> is located in multiple geofences, for example, a first geofence and a second geofence. The first geofence can intersect the second geofence. Upon determining that mobile device <b>100</b> is located in both geofences, mobile device <b>100</b> can create (<b>452</b>) a temporary geofence around a current location of mobile device <b>100</b>. Creating the temporary geofence can include defining the temporary geofence using a fence location and a fence dimension. The fence location can be a current location of mobile device <b>100</b>. The current location can be determined by an application processor of mobile device <b>100</b>. The fence dimension can be a specified value (e.g., 100 meters). In some implementations, the fence dimension can be determined based on the sizes of the first geofence and second geofence.</p>
<p id="p-0081" num="0080">Mobile device <b>100</b> can identify one or more common gateways for monitoring the temporary geofence. The common gateways can include one or more wireless access points that are observable by mobile device <b>100</b> when mobile device <b>100</b> is in the first geofence and the second geofence.</p>
<p id="p-0082" num="0081">Mobile device <b>100</b> can monitor (<b>454</b>) an exit of the temporary geofence. Monitoring the exit of the temporary geofence can include scanning signals from the identified common gateways using a wireless processor.</p>
<p id="p-0083" num="0082">Mobile device <b>100</b> can detect (<b>456</b>) whether the mobile device is inside of the first geofence and whether the mobile device is inside of the second geofence upon detecting the exit from the temporary geofence. Upon detecting the exit from the temporary geofence, mobile device <b>100</b> can wake an application processor of mobile device <b>100</b> to determine whether mobile device <b>100</b> exited from the first geofence or whether mobile device <b>100</b> exited from the second geofence. Detecting the exit from the temporary geofence can include determining, using the wireless processor of mobile device <b>100</b>, that the common gateways are unobservable in a threshold number of consecutive scans.</p>
<heading id="h-0010" level="1">Exemplary User Interface of a Geofence Detection System</heading>
<p id="p-0084" num="0083"><figref idref="DRAWINGS">FIG. 5</figref> is a diagram illustrating an exemplary user interface of a mobile device using a geofence-based service. The mobile device can be mobile device <b>100</b> as described above. Mobile device <b>100</b> can allow a user to create geofence <b>110</b> using the user interface. Mobile device <b>100</b> can be, for example, a handheld computer, a personal digital assistant, a cellular telephone, an electronic tablet, a network appliance, a camera, a smart phone, an enhanced general packet radio service (EGPRS) mobile phone, a network base station, a media player, a navigation device, an email device, a game console, or a combination of any two or more of these data processing devices or other data processing devices.</p>
<p id="p-0085" num="0084">In some implementations, mobile device <b>100</b> can include touch sensitive screen <b>502</b>. Mobile device <b>100</b> can provide map <b>504</b> for display on touch sensitive screen <b>502</b>. Mobile device <b>100</b> can receive a touch input on map <b>504</b>. Based on a location of the touch input on map <b>504</b>, mobile device <b>100</b> can create geofence <b>110</b> when mobile device <b>100</b> receives an input (e.g., a tap on &#x201c;Create Fence&#x201d; button <b>508</b>). Geofence <b>110</b> can have a location (e.g., a center) that corresponds to the location of the touch input on map <b>504</b>. Upon creation of the geofence, mobile device <b>100</b> can select, from multiple wireless access points, one or more wireless access points for monitoring geofence <b>110</b>.</p>
<p id="p-0086" num="0085">Mobile device <b>100</b> can associate a task with geofence <b>110</b>. For example, mobile device <b>100</b> can receive a user input to associate an application program with geofence <b>110</b>. In the example shown, geofence <b>110</b> can correspond to a beach area. The application program can be an application that retrieves information related to surf condition at the beach area.</p>
<p id="p-0087" num="0086">Mobile device <b>100</b> can invoke the application program when mobile device <b>100</b> enters geofence <b>110</b>. If mobile device <b>100</b> detects at least one of the selected wireless access points, mobile device <b>100</b> can use various location determination operations to determine that mobile device <b>100</b> entered geofence <b>110</b>. Upon determination that mobile device <b>100</b> entered geofence <b>110</b>, mobile device <b>100</b> can provide for display interface <b>510</b> of the application program. Interface <b>510</b> can include, for example, text information relating to surf condition associated with the geofence, and controls <b>512</b> and <b>514</b> for navigating through pages of the text information.</p>
<p id="p-0088" num="0087">A search bar <b>524</b> and a bookmarks list object <b>526</b> can be displayed at the top of interface <b>510</b>. Below the bottom of interface <b>510</b> one or more display objects can be displayed, for example a search object <b>528</b>, a directions object <b>530</b>, a map view object <b>532</b>, and a current location object <b>534</b>.</p>
<p id="p-0089" num="0088">Search bar <b>524</b> can be used to find an address or other location on the map. For example, a user can enter a home address in search bar <b>524</b>. Bookmarks list object <b>526</b> can, for example, display a Bookmarks list that contains addresses that are frequently visited, such as the user's home address. The Bookmarks list can also, for example, contain special bookmarks such as bookmarked locations of mobile device <b>100</b>.</p>
<p id="p-0090" num="0089">Search object <b>528</b> can be used to display search bar <b>524</b> and other map related search menus. Directions object <b>530</b> can, for example, display a menu interface that allows the user to enter a start and end location. The interface can then display information (e.g., directions and travel time for a route from the start location to the end location). Map view object <b>532</b> can display a menu that can allow the user to select display options for a crowdware application program. Current location object <b>534</b> can allow the user to see a geographic region on map <b>504</b> indicating where mobile device <b>100</b> is currently located.</p>
<heading id="h-0011" level="1">Exemplary Access Point Selection Techniques</heading>
<p id="p-0091" num="0090"><figref idref="DRAWINGS">FIG. 6</figref> is a flowchart illustrating exemplary process <b>600</b> for selecting wireless access points for monitoring a geofence. Process <b>600</b> can be performed by mobile device <b>100</b> (as described above).</p>
<p id="p-0092" num="0091">Upon receiving geofence <b>110</b> (as described above in reference to <figref idref="DRAWINGS">FIGS. 1 and 5</figref>), mobile device <b>100</b> can designate (<b>602</b>) multiple geographic regions to correspond to geofence <b>110</b>. Mobile device <b>100</b> can select wireless access points for monitoring geofence <b>110</b> based on the geographic regions. Further details of designating the geographic regions will be described below in reference to <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0093" num="0092">Mobile device <b>100</b> can identify (<b>604</b>) candidate wireless access points for monitoring in each of the geographic regions. Further details of identifying candidate wireless access points for monitoring in each of the geographic regions will be described below in reference to <figref idref="DRAWINGS">FIGS. 8A-8B</figref> and <b>9</b>A-<b>9</b>B.</p>
<p id="p-0094" num="0093">Mobile device <b>100</b> can iterate through the geographic regions and evaluate (<b>606</b>) a detection probability for each region. The detection probability of a region can indicate a probability that a mobile device <b>100</b>, if located in the region, can detect a wireless access point selected for monitoring, and thus detecting a potential entry into geofence <b>110</b>. The detection probability of a region can be measured using a probing point detection probability. Further details of evaluating the probing point detection probability will be described below in reference to <figref idref="DRAWINGS">FIG. 10</figref>.</p>
<p id="p-0095" num="0094">Based on the detection probability of the regions, mobile device <b>100</b> can calculate (<b>608</b>) a detection probability for the regions as a whole. The detection probability for the regions as a whole can indicate a likelihood that mobile device <b>100</b> can determine a potential entry into geofence <b>110</b> using the set of the candidate wireless access points. This probability can be measured using a value designated as a grid detection probability. Further details of calculating and applying the grid detection probability will be described below in reference to <figref idref="DRAWINGS">FIG. 10</figref>. Based on the grid detection probability, mobile device <b>100</b> can select (<b>610</b>) one or more wireless access points for monitoring geofence <b>110</b> or other geofences or both.</p>
<p id="p-0096" num="0095"><figref idref="DRAWINGS">FIG. 7</figref> is a diagram illustrating exemplary techniques for selecting wireless access points for monitoring using a geographic grid. Mobile device <b>100</b> (as described above) can perform the operations of selecting the wireless access points.</p>
<p id="p-0097" num="0096">Mobile device <b>100</b> can receive geofence <b>110</b> from a user (e.g., as described in reference to <figref idref="DRAWINGS">FIG. 5</figref>). Upon receiving geofence <b>110</b>, mobile device <b>100</b> can designate multiple geographic regions to correspond to geofence <b>110</b>. For example, mobile device <b>100</b> can create virtual geographic grid <b>116</b> that corresponds to geofence <b>110</b>. Mobile device <b>100</b> can select wireless access points based on virtual geographic grid <b>116</b>.</p>
<p id="p-0098" num="0097">Geographic grid <b>116</b> can include N&#xd7;N equally distributed tiles. Each tile can be a substantially rectangular area. Each tile can have a same size. For example, geographic grid <b>116</b> can include 25 square tiles. Mobile device <b>100</b> can determine the total number of tiles (N<sup>2</sup>) in grid <b>116</b> based on a scanning capacity of a wireless processor of mobile device <b>100</b>. Specifically, the number of tiles can be determined using the following formula:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>N</i><sup>2</sup>=(floor(&#x221a;{square root over (MAX_EL)}))<sup>2</sup>,&#x2003;&#x2003;(1)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where N<sup>2 </sup>is the total number of tiles, MAX_EL is a maximum number of elements, which can correspond to the total number of wireless access points a wireless processor can monitor (e.g., <b>150</b>).
</p>
<p id="p-0099" num="0098">When geofence <b>110</b> is a units wide and a units long, each tile can have a size of (a/N)<sup>2</sup>. Geofence <b>110</b> can be served by MAX_AP number of wireless access points. In this example, geofence <b>110</b> is a substantially circular area having center <b>702</b>. Center <b>702</b> can be associated with a latitude and a longitude. Geofence <b>110</b> can have a radius a/2. In various implementations, the geographic regions can have other shapes and varying sizes. Mobile device <b>100</b> can select wireless access points for monitoring geofence <b>110</b> based on a total number of wireless access points to scan, and a maximum number of wireless access points to scan in each of the geographic regions. This maximum number will be referred to as a wireless access point allowance, as described in further details below in reference to <figref idref="DRAWINGS">FIGS. 8A and 8B</figref>.</p>
<heading id="h-0012" level="1">Per-Region Limitations in Selecting Wireless Access Points</heading>
<p id="p-0100" num="0099"><figref idref="DRAWINGS">FIGS. 8A and 8B</figref> are diagrams illustrating exemplary wireless access point allowances used in selecting wireless access points. A wireless access point allowance can be a value associated with a tile in geographic grid <b>116</b>. The value can indicate a maximum number of wireless access points located in the tile that can be selected. <figref idref="DRAWINGS">FIG. 8A</figref> illustrates an allowance setting where wireless access point allowance is set to &#x201c;1&#x201d; for each tile. The allowances are shown as numbers in the tiles. In this setting, at most one wireless access point can be selected in each tile. If, for example, wireless access points <b>802</b> and <b>804</b> are both located in tile <b>806</b> of geographic grid <b>116</b>, at most one of wireless access points <b>802</b> and <b>804</b> can be selected for monitoring a geofence. A selected wireless access point is represented using a black triangle; an unselected one, a white triangle.</p>
<p id="p-0101" num="0100"><figref idref="DRAWINGS">FIG. 8B</figref> illustrates an allowance setting where different wireless access point allowances are associated with different tiles. In some implementations, the wireless access point allowance for tile <b>806</b> is set to three. Accordingly, both wireless access points <b>802</b> and <b>804</b> can be selected. Not all tiles are equal. Some tiles may have greater wireless access point allowance than others. For example, tiles located at or near a center of geographic grid <b>116</b> can have higher wireless access point allowances than tiles located at the edge do.</p>
<p id="p-0102" num="0101"><figref idref="DRAWINGS">FIGS. 9A and 9B</figref> are diagrams illustrating exemplary stages of assigning wireless access point allowances to a geographic grid. Selecting wireless access points can include identifying sets of candidate wireless access points in multiple iterations. In each iteration, a set of candidate wireless access points can be identified. In each iteration, one or more wireless access point allowances can be increased. <figref idref="DRAWINGS">FIG. 9A</figref> shows exemplary wireless access point allowances assigned in an iteration (e.g., an initial iteration). A wireless access point allowance associated with center tile <b>902</b> can have a higher value than a wireless access point allowance associated with edge tile <b>904</b>. <figref idref="DRAWINGS">FIG. 9B</figref> shows exemplary wireless access point allowances assigned in a subsequent iteration. The wireless access point allowances assigned in previous iterations can be increased.</p>
<p id="p-0103" num="0102"><figref idref="DRAWINGS">FIG. 9C</figref> is a flowchart illustrating exemplary process <b>920</b> of identifying candidate wireless access points based on geographic regions. Process <b>920</b> can be performed by a mobile device such as mobile device <b>100</b> as described above. The geographic regions can be tiles in a geographic grid corresponding to a geofence. Mobile device <b>100</b> can add wireless access points to geographic regions in multiple iterations, and designate the wireless access points added in an iteration and its prior iterations as a set of candidate wireless access points.</p>
<p id="p-0104" num="0103">Mobile device <b>100</b> can initialize (<b>922</b>) the geographic regions. Initializing the geographic regions can include assigning a wireless access point allowance to each of the geographic regions in a setting as described above in reference to <figref idref="DRAWINGS">FIG. 9A</figref>.</p>
<p id="p-0105" num="0104">Mobile device <b>100</b> can order (<b>924</b>) the not-yet-added wireless access points by an access point score (AP score) associated with each wireless access point. The AP score of a wireless access point is a value that can indicate an importance of the wireless access point. The AP score of the wireless access point can be determined by (a) a number of observations of the wireless access point, which can be a number of times various mobile devices detected or communicated with the wireless access point in the past; or (b) a time of observation, where an observation closer to present time can correspond to a higher score; or (c) a combination of (a) and (b).</p>
<p id="p-0106" num="0105">Mobile device <b>100</b> can add (<b>926</b>) the not-yet-added wireless access points to the geographic regions based on AP scores and the wireless access point allowance of each geographic region. For example, if (a) a wireless access point having a high AP score is associated with a region (based on a location of the wireless access point), and (b) a number of selected access points in the region has not reached the wireless access point allowance, then, mobile device <b>100</b> can add the wireless access point to the region. In some implementations, adding the not-yet-added wireless access points to the geographic regions can include selecting the wireless access points to be added based on channel optimization in addition to the AP scores. Channel optimization will be described in further details below in reference to <figref idref="DRAWINGS">FIG. 9D</figref>.</p>
<p id="p-0107" num="0106">Mobile device <b>100</b> can calculate (<b>928</b>) a grid detection probability for wireless access points already added. Each set of candidate wireless access points can be associated with a grid detection probability. The grid detection probability can indicate the probability of detecting the geofence by monitoring the candidate wireless access points in the set (e.g., the already added wireless access points). The grid detection probability can be used to balance accuracy (the more wireless access points to monitor, the likelier the detection) and efficiency (the more wireless access points to monitor, the higher the power consumption), and to balance whether to use limited scan capacity of a wireless processor (e.g., 150 access points at one time) to monitor this or another geofence. Further details on calculating the grid detection probability will be described below in reference to <figref idref="DRAWINGS">FIG. 10</figref>.</p>
<p id="p-0108" num="0107">Mobile device <b>100</b> can determine (<b>930</b>) whether all wireless access points geographically corresponding to the grid are added. Determining whether all wireless access points geographically corresponding to the grid are added can include performing a search in a wireless access point list using the location of the grid as an index. If all are added, process <b>920</b> can terminate.</p>
<p id="p-0109" num="0108">If there are more wireless access points, mobile device <b>100</b> can increment (<b>932</b>) wireless access point allowances for the geographic regions. For example, mobile device <b>100</b> can increment the wireless access point allowances according to <figref idref="DRAWINGS">FIG. 9B</figref>. After the incrementing operations, mobile device <b>100</b> can iterate the operations by returning to stage <b>924</b>.</p>
<heading id="h-0013" level="1">Channel Optimization</heading>
<p id="p-0110" num="0109"><figref idref="DRAWINGS">FIG. 9D</figref> is exemplary histogram <b>960</b> illustrating techniques of identifying candidate wireless access points based on channel optimization. Channel optimization can be performed by a mobile device such as mobile device <b>100</b> as described above.</p>
<p id="p-0111" num="0110">Mobile device <b>100</b> can use a wireless processor to monitor the selected wireless access points for a geofence. The wireless processor can scan multiple channels for signals from the wireless access points. The wireless processor often consumes more power when more channels are scanned. Mobile device <b>100</b> can reduce the number of channels scanned by selecting as many wireless access points that operate in the same channels as possible, when other conditions are equal.</p>
<p id="p-0112" num="0111">Mobile device <b>100</b> can store a list of wireless access points. Each of the wireless access points can be associated with a channel in which the wireless access point operates. Mobile device <b>100</b> can generated histogram <b>960</b> on all wireless channels (e.g., channel <b>1</b> through channel <b>11</b>) using a probability density function. Each channel can be assigned a channel score based on the probability density function for a given geofence or for a given group of geofences. The probability density function can indicate a likelihood that a wireless access point operates in a particular channel. In some implementations, the channel score of a channel can be determined based on a number of wireless access points using this channel.</p>
<p id="p-0113" num="0112">In some implementations, mobile device <b>100</b> can use the probability density function to identify the most common access points for a given group of fences. Mobile device <b>100</b> can select these access points for monitoring the group of geofences. The selection can improve a likelihood of observing a wireless access point by mobile device <b>100</b>. In some implementations, mobile device <b>100</b> can identify one or more popular channels. For example, mobile device <b>100</b> can select top X (e.g., three or four) most populate channels. In some implementations, mobile device <b>100</b> can specify selection threshold <b>962</b>. Mobile device <b>100</b> can designate the wireless channels whose channel scores satisfy the selection threshold <b>962</b> as the popular channels.</p>
<p id="p-0114" num="0113">Mobile device <b>100</b> can make wireless access points operating in the popular channels more likely to be selected. In some implementations, mobile device <b>100</b> can increase the AP score of a wireless access point operating in a popular channel. In some implementations, mobile device <b>100</b> can select the wireless access points from wireless access points operating the popular channels. Accordingly, when monitoring a geofence, a wireless processor of mobile device <b>100</b> may, for example, scan three or four channels rather than all channels.</p>
<heading id="h-0014" level="1">Evaluating Selected Wireless Access Points</heading>
<p id="p-0115" num="0114"><figref idref="DRAWINGS">FIG. 10</figref> is a diagram illustrating exemplary techniques for evaluating a set of candidate wireless access points. The techniques can be implemented on a mobile device such as mobile device <b>100</b> as described above.</p>
<p id="p-0116" num="0115">Mobile device <b>100</b> can evaluate multiple sets of candidate wireless access points, and determine which set of candidate wireless access points is finally selected for monitoring geofence <b>110</b>. Each set of candidate wireless access points be a set of wireless access points added in an iteration (I) and the iteration's prior iterations (1, . . . I&#x2212;1) of process <b>920</b> as described above in reference to <figref idref="DRAWINGS">FIG. 9C</figref>. To evaluate each set of candidate wireless access points, mobile device <b>100</b> can determine a grid detection probability for each set.</p>
<p id="p-0117" num="0116">Mobile device <b>100</b> can determine the grid detection probability using multiple probing points. Mobile device <b>100</b> can designate at least one probing point (e.g., probing point <b>1002</b>) for each geographic region. A probing point (PP) is a virtual point from which a probability of detecting at least one of the already-added wireless access points can be calculated. The probability will be referred to as a probing point detection probability. Mobile device <b>100</b> can determine the grid detection probability based on the probing point detection probability of each probing point.</p>
<p id="p-0118" num="0117">To calculate a probing point detection probability for probing point <b>1002</b>, mobile device <b>100</b> can model signal propagation of a wireless access point using path loss calculation below.
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>P</i><sub>k</sub>=&#x2212;10&#x3b2; log<sub>10</sub>(<i>d</i>)+<i>P</i><sub>0</sub>+&#x3b7;,&#x2003;&#x2003;(2)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where P<sub>k </sub>is a signal strength at a point that is at distance d away from the wireless access point (e.g., wireless access point <b>1004</b>), P<sub>0 </sub>is a signal strength at the wireless access point, &#x3b7; is a constant which accounts for system losses, and &#x3b2; is path loss exponent. The path loss exponent can reflect an environment of the signal propagation. For example, outdoors, in free space, &#x3b2; can have a value of two; in shadowed urban area, &#x3b2; can have a value between 2.7 and 5. In buildings, in line-of-sight, &#x3b2; can have a value between 1.6 and 1.8; when obstructions exist, &#x3b2; can have a value between 4 and 6. A potential detection range of a wireless access point can be determined when a signal strength ratio P<sub>k</sub>/P<sub>0 </sub>is in the range from &#x2212;30 dB to &#x2212;113 dB.
</p>
<p id="p-0119" num="0118">According to formula (2), detectability of a wireless access point can be subject to variations such as indoor/outdoor propagation, wireless transmission power, among others. Mobile device <b>100</b> can base the calculation of a probing point detection probability on a lower bound detection distance, which can be defined using the following calculation:</p>
<p id="p-0120" num="0119">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>Z</mi>
          <mo>=</mo>
          <mfrac>
            <mrow>
              <mo>&#xf605;</mo>
              <mrow>
                <msub>
                  <mi>&#x3b8;</mi>
                  <mi>u</mi>
                </msub>
                <mo>-</mo>
                <msub>
                  <mi>&#x3b8;</mi>
                  <mn>0</mn>
                </msub>
              </mrow>
              <mo>&#xf606;</mo>
            </mrow>
            <msub>
              <mi>&#x3c3;</mi>
              <mrow>
                <mi>&#x3b8;</mi>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.3em" height="0.3ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mi>u</mi>
              </mrow>
            </msub>
          </mfrac>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>3</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
where Z is the lower bound detection distance, &#x3b8;u is a potential user location, &#x3b8;<sub>0 </sub>is an estimated location of the wireless access point (which can be determined using an independent process by a server), and &#x3c3;<sub>&#x3b8;u </sub>is an estimated lower bound signal propagation.
</p>
<p id="p-0121" num="0120">Mobile device <b>100</b> can then determine a probability of probing point PP detecting a wireless access point by integrating over the lower bound detection distance using the following calculation:</p>
<p id="p-0122" num="0121">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <msub>
            <mi>P</mi>
            <mrow>
              <mi>DPP</mi>
              <mo>&#x2192;</mo>
              <msub>
                <mi>SAP</mi>
                <mi>n</mi>
              </msub>
            </mrow>
          </msub>
          <mo>=</mo>
          <mrow>
            <mfrac>
              <mn>2</mn>
              <mi>&#x3c0;</mi>
            </mfrac>
            <mo>&#x2062;</mo>
            <mrow>
              <msubsup>
                <mo>&#x222b;</mo>
                <mi>Z</mi>
                <mi>&#x221e;</mi>
              </msubsup>
              <mo>&#x2062;</mo>
              <mrow>
                <msup>
                  <mi>&#x2147;</mi>
                  <mrow>
                    <mo>-</mo>
                    <msup>
                      <mi>t</mi>
                      <mn>2</mn>
                    </msup>
                  </mrow>
                </msup>
                <mo>&#x2062;</mo>
                <mstyle>
                  <mspace width="0.2em" height="0.2ex"/>
                </mstyle>
                <mo>&#x2062;</mo>
                <mrow>
                  <mo>&#x2146;</mo>
                  <mi>t</mi>
                </mrow>
              </mrow>
            </mrow>
          </mrow>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>4</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
where
</p>
<p id="p-0123" num="0122">
<maths id="MATH-US-00003" num="00003">
<math overflow="scroll">
<msub>
  <mi>P</mi>
  <msub>
    <mi>D</mi>
    <mrow>
      <mi>PP</mi>
      <mo>&#x2192;</mo>
      <msub>
        <mi>SAP</mi>
        <mi>n</mi>
      </msub>
    </mrow>
  </msub>
</msub>
</math>
</maths>
<br/>
is a probability of probing point PP detecting an nth selected wireless access point SAPn (e.g., wireless access point <b>1004</b>); Z is the lower bound detection distance, and t is a distance over which the probing point detection probability is integrated.
</p>
<p id="p-0124" num="0123">Mobile device <b>100</b> can determine a probing point detection probability based on the probabilities that a probing point detects, or does not detect, wireless access points already added, using the following calculations:</p>
<p id="p-0125" num="0124">
<maths id="MATH-US-00004" num="00004">
<math overflow="scroll">
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mrow>
            <msub>
              <mi>P</mi>
              <mi>D</mi>
            </msub>
            <mo>&#x2061;</mo>
            <mrow>
              <mo>(</mo>
              <msub>
                <mi>PP</mi>
                <mi>k</mi>
              </msub>
              <mo>)</mo>
            </mrow>
          </mrow>
          <mo>=</mo>
          <mrow>
            <mn>1</mn>
            <mo>-</mo>
            <mrow>
              <mrow>
                <mo>(</mo>
                <mrow>
                  <mn>1</mn>
                  <mo>-</mo>
                  <msub>
                    <mi>P</mi>
                    <mrow>
                      <msub>
                        <mi>D</mi>
                        <msub>
                          <mi>PP</mi>
                          <mi>k</mi>
                        </msub>
                      </msub>
                      <mo>-&#x3e;</mo>
                      <msub>
                        <mi>SAP</mi>
                        <mn>1</mn>
                      </msub>
                    </mrow>
                  </msub>
                </mrow>
                <mo>)</mo>
              </mrow>
              <mo>&#x2062;</mo>
              <mrow>
                <mo>(</mo>
                <mrow>
                  <mn>1</mn>
                  <mo>-</mo>
                  <msub>
                    <mi>P</mi>
                    <mrow>
                      <msub>
                        <mi>D</mi>
                        <msub>
                          <mi>PP</mi>
                          <mi>k</mi>
                        </msub>
                      </msub>
                      <mo>-&#x3e;</mo>
                      <msub>
                        <mi>SAP</mi>
                        <mn>2</mn>
                      </msub>
                    </mrow>
                  </msub>
                </mrow>
                <mo>)</mo>
              </mrow>
              <mo>&#x2062;</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>&#x2062;</mo>
              <mi>&#x2026;</mi>
              <mo>&#x2062;</mo>
              <mstyle>
                <mspace width="0.8em" height="0.8ex"/>
              </mstyle>
              <mo>&#x2062;</mo>
              <mrow>
                <mo>(</mo>
                <mrow>
                  <mn>1</mn>
                  <mo>-</mo>
                  <msub>
                    <mi>P</mi>
                    <mrow>
                      <msub>
                        <mi>D</mi>
                        <msub>
                          <mi>PP</mi>
                          <mi>k</mi>
                        </msub>
                      </msub>
                      <mo>-&#x3e;</mo>
                      <msub>
                        <mi>SAP</mi>
                        <mi>n</mi>
                      </msub>
                    </mrow>
                  </msub>
                </mrow>
                <mo>)</mo>
              </mrow>
            </mrow>
          </mrow>
        </mrow>
        <mo>,</mo>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>5</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
</maths>
<br/>
where P<sub>D</sub>(PP<sub>k</sub>) is a probing point detection probability for the kth probing point PPk (e.g., probing point <b>1002</b>).
</p>
<p id="p-0126" num="0125">Mobile device <b>100</b> can determine the grid detection probability for a set of candidate wireless access points based on the probing point detection probability for each probing point. The grid detection probability can be an average of the probing point detection probabilities for all probing points, or a minimum probing point detection probability among all probing points.</p>
<heading id="h-0015" level="1">Selecting Access Points from Candidates</heading>
<p id="p-0127" num="0126"><figref idref="DRAWINGS">FIG. 11</figref> is a diagram illustrating exemplary techniques of selecting wireless access points for a monitoring geofence from sets of candidate wireless access points. The techniques can be implemented on a mobile device, such as mobile device <b>100</b> as described above. Mobile device <b>100</b> can store identifiers of a set of wireless access points <b>1102</b> that are located sufficiently close to a geofence such that the wireless access points <b>1102</b> can potentially be used to monitor the geofence.</p>
<p id="p-0128" num="0127">Using the operations described above (e.g., in reference to <figref idref="DRAWINGS">FIGS. 8A-10</figref>), mobile device <b>100</b> can identify sets of candidate wireless access points <b>1104</b>, <b>1106</b>, and <b>1108</b>. Each set of candidate wireless access points <b>1104</b>, <b>1106</b>, or <b>1108</b> can include one or more wireless access points from the set of wireless access points <b>1102</b>. Each set of candidate wireless access points <b>1104</b>, <b>1106</b>, or <b>1108</b> can correspond to a detection probability (e.g., a grid detection probability as described above in reference to <figref idref="DRAWINGS">FIG. 10</figref>). For example, set <b>1104</b>, including wireless access points AP<b>1</b> and AP<b>2</b>, can be associated with a grid detection probability 0.1; set <b>1106</b>, including wireless access points AP<b>1</b> through AP<b>4</b>, can be associated with a grid detection probability 0.3; set <b>1108</b>, including wireless access points AP<b>1</b> through AP<b>8</b>, can be associated with a grid detection probability 0.8.</p>
<p id="p-0129" num="0128">In some implementations, mobile device <b>100</b> can select the set of candidate wireless access points to monitor a geofence based on improvement of detection probability over selecting another set of candidate wireless access points. For example, mobile device <b>100</b> can select a set (e.g., set <b>1108</b>) that provides most improvement in detection probability per additional wireless access point added.</p>
<p id="p-0130" num="0129"><figref idref="DRAWINGS">FIG. 12</figref> is a diagram illustrating exemplary techniques of selecting wireless access points for multiple geofences from sets of candidate wireless access points. A mobile device, such as mobile device <b>100</b> as described above, can monitor multiple geofences. Monitoring multiple geofences can include scanning for signals from multiple wireless access points designated for monitoring each geofence.</p>
<p id="p-0131" num="0130">For example, mobile device <b>100</b> can be configured to monitor a first, a second, and a third geofence. Using the operations described above (e.g., in reference to <figref idref="DRAWINGS">FIGS. 8A-11</figref>), mobile device <b>100</b> can identify sets of candidate wireless access points <b>1104</b>, <b>1106</b>, and <b>1108</b> for monitoring the first geofence. Mobile device <b>100</b> can identify sets of candidate wireless access points <b>1204</b>, <b>1206</b>, and <b>1208</b> for monitoring the second geofence. Mobile device <b>100</b> can identify sets of candidate wireless access points <b>1214</b>, <b>1216</b>, and <b>1218</b> for monitoring the third geofence. When selecting wireless access points to monitor, mobile device <b>100</b> can ensure that the total number of wireless access points to monitor the first, second, and third geofences satisfy (e.g., do not exceed) an access point threshold. The access point threshold can be determined based on a configuration of a wireless processor (e.g., a maximum scan capacity of a WiFi&#x2122; chip) of mobile device <b>100</b>. Further details of selecting wireless access points that satisfy the access point threshold will be described below in reference to <figref idref="DRAWINGS">FIG. 13A</figref>.</p>
<p id="p-0132" num="0131"><figref idref="DRAWINGS">FIG. 13A</figref> is a flowchart illustrating exemplary operations <b>1300</b> for selecting wireless access points for monitoring multiple geofences. The operations can be performed by a mobile device such as mobile device <b>100</b> as described above.</p>
<p id="p-0133" num="0132">Mobile device <b>100</b> can initialize (<b>1302</b>) an access point budget and fence scores. The access point budget can be a value indicating how many more wireless access points can be selected, for example, based on a scanning capacity of a wireless processor, and wireless access points already selected. Initializing the access point budget can include setting the access point budget to an initial value based on the scanning capacity. A fence score of a geofence can be a detection probability (e.g., a grid detection probability) determined based on wireless access points already selected for the geofence. Initializing the fence score can include setting the fence scores of all geofences being considered to zero.</p>
<p id="p-0134" num="0133">Mobile device <b>100</b> can iterate (<b>1304</b>) through the geofences and select the wireless access points. Iterating through the geofences can include selecting wireless access points for monitoring each geofence. During the iteration, mobile device <b>100</b> can determine (<b>1306</b>) if the access point budget remains greater than zero. If the access point budget reaches zero, mobile device <b>100</b> can stop selecting wireless access points. Otherwise, mobile device <b>100</b> can continue the iterations.</p>
<p id="p-0135" num="0134">If the access point budget remains greater than zero, mobile device <b>100</b> can add (<b>1308</b>) one or more wireless access points to the geofence currently being iterated upon and determine a current fence score.</p>
<p id="p-0136" num="0135">Iterating (<b>1304</b>) through the geofences can include performing the following operations based on the geofences to be monitored. Mobile device <b>100</b> can select one or more wireless access points for geofence <b>110</b> being iterated upon when iteration conditions are satisfied. The iteration conditions can be satisfied when:
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0000">
    <ul id="ul0002" list-style="none">
        <li id="ul0002-0001" num="0136">(1) The fence score of geofence <b>110</b> has room of improvement (e.g., the fence score of geofence <b>110</b> is less than a maximum fence score);</li>
        <li id="ul0002-0002" num="0137">(2) A next fence score is significantly better than the current fence score. The next fence score is a detection probability of geofence <b>110</b> if the one or more wireless access points being considered are indeed selected. The next fence score is significantly better than a current fence score if the difference between the fence score and the current fence score satisfies a threshold; and</li>
        <li id="ul0002-0003" num="0138">(3) The access point budget is greater than zero.</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0137" num="0139">Upon selecting the one or more wireless access points, mobile device <b>100</b> can assign the above-calculated next fence score as a new current fence score of the geofence being iterated upon, and decrease the access point budget by the number of wireless access points selected.</p>
<p id="p-0138" num="0140"><figref idref="DRAWINGS">FIG. 13B</figref> illustrates an exemplary application of the operations of <figref idref="DRAWINGS">FIG. 13A</figref>. For illustration, mobile device <b>100</b> (as described above) selects wireless access points for monitoring a first geofence (geofence <b>1320</b>), a second geofence, (geofence <b>1322</b>), and a third geofence (geofence <b>1324</b>). Each of geofences <b>1320</b>, <b>1322</b>, and <b>1324</b> can be associated with multiple sets of candidate wireless access points with corresponding fence score. For example, geofence <b>1320</b> can be associated with a first set of four candidate access points, with associating fence score 0.1, a second set of six candidate access points with associating fence score 0.5, a third set of eight candidate access points with associating fence score 0.8.</p>
<p id="p-0139" num="0141">During initialization operations (as indicated by arrows marked &#x201c;0&#x201d;), the fence scores of each of geofences <b>1320</b>, <b>1322</b>, and <b>1324</b> can be set to zero. After the initialization, mobile device <b>100</b> can iterate through geofences <b>1320</b>, <b>1322</b>, and <b>1324</b> and the sets of candidate wireless access points associated with the geofences in the order (1-9) as specified next to the arrows, until iteration conditions are no longer satisfied.</p>
<heading id="h-0016" level="1">Exemplary Access Point Selection System</heading>
<p id="p-0140" num="0142"><figref idref="DRAWINGS">FIG. 14</figref> is a block diagram illustrating exemplary components of a system implementing techniques of selecting wireless access points for monitoring a geofence. Wireless access point selection system <b>1402</b> can be a component of a mobile device (e.g., mobile device <b>100</b> as described above) that is configured to select one or more wireless access points for monitoring a geofence.</p>
<p id="p-0141" num="0143">Wireless access point selection system <b>1402</b> can include data store <b>230</b>, which can store a list of wireless access points. Each wireless access point can be associated with a location, a channel, and an AP score. The location of a wireless access point can be an estimated location that may or may not correspond to a physical location of the wireless access point. The locations and AP scores can be determined by a remote server, or by mobile device <b>100</b>. Data store <b>230</b> can be implemented in a database (e.g., a relational or objective database) or a flat file stored on a storage device.</p>
<p id="p-0142" num="0144">Wireless access point selection system <b>1402</b> can include geofence data store <b>1404</b>. Geofence data store <b>1404</b> can store information on one or more geofences, including, for example, locations and dimension of the geofences.</p>
<p id="p-0143" num="0145">Wireless access point selection system <b>1402</b> can include geofence analyzer <b>1406</b>. Geofence analyzer <b>1406</b> is a component of wireless access point selection system <b>1402</b> configured to create a geographic grid including one or more geographic regions (e.g., tiles). Each wireless access point in data store <b>230</b> can have a location corresponding to one of the geographic regions. Geofence analyzer <b>1406</b> can designate one or more points in each geographic region as probing points. Geofence analyzer <b>1406</b> can include hardware and software components.</p>
<p id="p-0144" num="0146">Wireless access point selection system <b>1402</b> can include probability score calculator <b>1408</b>. Probability score calculator <b>1408</b> is a component of wireless access point selection system <b>1402</b> configured to calculate probing point detection probabilities for each probing point, and the grid detection probability for each set of candidate wireless access points based on the probing point detection probabilities. Probability score calculator <b>1408</b> can include hardware and software components. Output from probability score calculator <b>1408</b> can be fed to geofence analyzer <b>1406</b> according to the iterative process as described above in reference to <figref idref="DRAWINGS">FIG. 13A</figref>.</p>
<p id="p-0145" num="0147">Wireless access point selection system <b>1402</b> can include channel optimizer <b>1410</b>. Channel optimizer <b>1410</b> is a component of wireless access point selection system <b>1402</b> configured to perform channel optimization operations based on channel information from data store <b>230</b>. Channel optimizer <b>1410</b> can include hardware and software components.</p>
<p id="p-0146" num="0148">Wireless access point selection system <b>1402</b> can include wireless access point selector <b>1412</b>. Wireless access point selector <b>1412</b> is a component of wireless access point selection system <b>1402</b> configured to perform selection operations for one or more geofences based on the probabilities calculated by probability score calculator <b>1408</b> and channel information from channel optimizer <b>1410</b>. Wireless access point selector <b>1412</b> can include hardware and software components.</p>
<p id="p-0147" num="0149">Wireless access point selection system <b>1402</b> can include selected access point data store <b>1414</b>. Selected access point data store <b>1414</b> is a component of wireless access point selection system <b>1402</b> configured to store a list of wireless access points selected by wireless access point selector <b>1412</b>. Wireless access point selection system <b>1402</b> can send the selected wireless access points to a wireless processor of mobile device <b>100</b> for monitoring one or more geofences.</p>
<heading id="h-0017" level="1">Exemplary Access Point Selection Operations</heading>
<p id="p-0148" num="0150"><figref idref="DRAWINGS">FIG. 15</figref> is flowchart illustrating exemplary operations <b>1500</b> of wireless access point selection. Operations <b>1500</b> can be performed by mobile device <b>100</b> as described above.</p>
<p id="p-0149" num="0151">Mobile device <b>100</b> can receive (<b>1502</b>) a geofence. The geofence can be defined by a fence location and a fence dimension. The geofence can be received from a user</p>
<p id="p-0150" num="0152">Mobile device <b>100</b> can select (<b>1504</b>), from multiple wireless access points, one or more wireless access points for monitoring the geofence. Selecting the one or more wireless access points can include determining multiple geographic regions corresponding to the geofence, and selecting the one or more wireless access points based on a maximum total number of wireless access points to be selected and an access point allowance for each of the geographic regions. The access point allowance can indicate a maximum number of wireless access points to be selected for the geographic region. Mobile device <b>100</b> can determine the maximum number of wireless access points to be selected based at least in part on a monitoring capacity of the wireless processor.</p>
<p id="p-0151" num="0153">Determining the geographic regions corresponding to the geofence can include dividing a geographic area associated with the geofence into multiple tiles. Each geographic region can correspond to a tile. Each tile can be a substantially rectangular area.</p>
<p id="p-0152" num="0154">The wireless access points selected for monitoring the geofence can be stored on mobile device <b>100</b>. Each wireless access point can be represented by a wireless access point identifier (e.g., a MAC address). Each wireless access point can be associated with an access point location. The access point location can be associated with (e.g., located in) one of the geographical regions for monitoring. Each wireless access point can be associated with an access point score indicating a worthiness of the wireless access point in monitoring the geofence. Each wireless access point can be associated with a channel number. The channel number can indicate on which channel a wireless access point sends and receives signals.</p>
<p id="p-0153" num="0155">Selecting the one or more wireless access points can include iteratively performing scoring operations. The scoring operations can include setting or increasing the access point allowance for each of the geographic regions. The scoring operations can include ordering, based on the access point scores, wireless access points that have not yet been added to a geographic region, where the access point location associated with the not yet added wireless access point corresponds to the destination geographic region. The scoring operations can include designating already added access points as candidate wireless access points and calculating a detection probability based on the candidate wireless access point. Selecting the one or more wireless access points can include selecting the one or more wireless access points from the candidate wireless access points based on the maximum total number of wireless access points and the detection probabilities calculated in the iterative scoring operations.</p>
<p id="p-0154" num="0156">Mobile device <b>100</b> can select the one or more wireless access points further based on communication channels between mobile device <b>100</b> and the wireless access points. Selecting the one or more wireless access points can include determining one or more preferred wireless access points for each of the communication channels using a probability density function, and selecting the one or more wireless access points from the preferred wireless access points. Determining one or more preferred wireless access points for each of the communication channels can include determining a popularity score of each of the communication channels using a probability density function and a number of wireless access points using the communication channel. Determining one or more preferred wireless access points for each of the communication channels can include determining the one or more preferred wireless access points based on the popularity scores of the communication channels.</p>
<p id="p-0155" num="0157">Mobile device <b>100</b> can calculate the detection probability using probability calculation operations. The probability calculation operations can include designating at least one point in each of the geographic regions as a probing point. Mobile device <b>100</b> can calculate a probing point detection probability for each probing point. The probing point detection probability can indicate a likelihood that a mobile device located at the probing point can detect any chosen access point for monitoring the geofence. Mobile device <b>100</b> can calculate the detection probability based on the probing point detection probabilities of the probing points, including calculating a probability of not detecting any of the selected access points at any of the probing points using calculation (5) as described above in reference to <figref idref="DRAWINGS">FIG. 10</figref>.</p>
<p id="p-0156" num="0158">Operations <b>1500</b> can include selecting one or more wireless access points for monitoring another geofence, such that a total number of the selected wireless access points representing the geofence and the selected wireless access points representing the other geofence does not exceeding the maximum number of wireless access points as allowable to be monitored by mobile device <b>100</b> at one time. Mobile device <b>100</b> can iteratively determine whether to select one or more candidate wireless access points for monitoring the geofence or to select the one or more candidate wireless access points for monitoring the other geofence in each iteration based on an amount of improvement that results from each selection.</p>
<p id="p-0157" num="0159">Mobile device <b>100</b> can determine (<b>1506</b>) a tentative location of the mobile device relative to the geofence, including monitoring the selected one or more wireless access points using a wireless processor and tentatively determine, for example, whether mobile device <b>100</b> is inside of the geofence or outside of the geofence. The wireless processor can be a WiFi&#x2122; chip. Monitoring the selected one or more wireless access points comprises scanning, on one or more channels, a signal from the selected one or more wireless access points. Mobile device <b>100</b> can wake an application processor of mobile device <b>100</b>. Using the application processor, mobile device <b>100</b> can determine whether mobile device <b>100</b> is located inside of the geofence.</p>
<heading id="h-0018" level="1">Exemplary Mobile Device Architecture</heading>
<p id="p-0158" num="0160"><figref idref="DRAWINGS">FIG. 16</figref> is a block diagram of an exemplary architecture <b>1600</b> for the mobile devices of <figref idref="DRAWINGS">FIGS. 1-8</figref>. A mobile device can include memory interface <b>1602</b>, one or more data processors, image processors and/or processors <b>1604</b>, and peripherals interface <b>1606</b>. Memory interface <b>1602</b>, one or more processors <b>1604</b> and/or peripherals interface <b>1606</b> can be separate components or can be integrated in one or more integrated circuits. Processors <b>1604</b> can include application processors, baseband processors, and wireless processors. The various components in mobile device <b>100</b>, for example, can be coupled by one or more communication buses or signal lines.</p>
<p id="p-0159" num="0161">Sensors, devices, and subsystems can be coupled to peripherals interface <b>1606</b> to facilitate multiple functionalities. For example, motion sensor <b>1610</b>, light sensor <b>1612</b>, and proximity sensor <b>1614</b> can be coupled to peripherals interface <b>1606</b> to facilitate orientation, lighting, and proximity functions of the mobile device. Location processor <b>1615</b> (e.g., GPS receiver) can be connected to peripherals interface <b>1606</b> to provide geopositioning. Electronic magnetometer <b>1616</b> (e.g., an integrated circuit chip) can also be connected to peripherals interface <b>1606</b> to provide data that can be used to determine the direction of magnetic North. Thus, electronic magnetometer <b>1616</b> can be used as an electronic compass. Motion sensor <b>1610</b> can include one or more accelerometers configured to determine change of speed and direction of movement of the mobile device. Gravimeter <b>1617</b> can include one or more devices connected to peripherals interface <b>1606</b> and configured to measure a local gravitational field of Earth.</p>
<p id="p-0160" num="0162">Camera subsystem <b>1620</b> and an optical sensor <b>1622</b>, e.g., a charged coupled device (CCD) or a complementary metal-oxide semiconductor (CMOS) optical sensor, can be utilized to facilitate camera functions, such as recording photographs and video clips.</p>
<p id="p-0161" num="0163">Communication functions can be facilitated through one or more wireless communication subsystems <b>1624</b>, which can include radio frequency receivers and transmitters and/or optical (e.g., infrared) receivers and transmitters. The specific design and implementation of the communication subsystem <b>1624</b> can depend on the communication network(s) over which a mobile device is intended to operate. For example, a mobile device can include communication subsystems <b>1624</b> designed to operate over a GSM network, a GPRS network, an EDGE network, a Wi-Fi or WiMax network, and a Bluetooth network. In particular, the wireless communication subsystems <b>1624</b> can include hosting protocols such that the mobile device can be configured as a base station for other wireless devices.</p>
<p id="p-0162" num="0164">Audio subsystem <b>1626</b> can be coupled to a speaker <b>1628</b> and a microphone <b>1630</b> to facilitate voice-enabled functions, such as voice recognition, voice replication, digital recording, and telephony functions.</p>
<p id="p-0163" num="0165">I/O subsystem <b>1640</b> can include touch screen controller <b>1642</b> and/or other input controller(s) <b>1644</b>. Touch-screen controller <b>1642</b> can be coupled to a touch screen <b>1646</b> or pad. Touch screen <b>1646</b> and touch screen controller <b>1642</b> can, for example, detect contact and movement or break thereof using any of a plurality of touch sensitivity technologies, including but not limited to capacitive, resistive, infrared, and surface acoustic wave technologies, as well as other proximity sensor arrays or other elements for determining one or more points of contact with touch screen <b>1646</b>.</p>
<p id="p-0164" num="0166">Other input controller(s) <b>1644</b> can be coupled to other input/control devices <b>1648</b>, such as one or more buttons, rocker switches, thumb-wheel, infrared port, USB port, and/or a pointer device such as a stylus. The one or more buttons (not shown) can include an up/down button for volume control of speaker <b>1628</b> and/or microphone <b>1630</b>.</p>
<p id="p-0165" num="0167">In one implementation, a pressing of the button for a first duration may disengage a lock of the touch screen <b>1646</b>; and a pressing of the button for a second duration that is longer than the first duration may turn power to mobile device <b>100</b> on or off. The user may be able to customize a functionality of one or more of the buttons. The touch screen <b>1646</b> can, for example, also be used to implement virtual or soft buttons and/or a keyboard.</p>
<p id="p-0166" num="0168">In some implementations, mobile device <b>100</b> can present recorded audio and/or video files, such as MP3, AAC, and MPEG files. In some implementations, mobile device <b>100</b> can include the functionality of an MP3 player, such as an iPod&#x2122; Mobile device <b>100</b> may, therefore, include a pin connector that is compatible with the iPod. Other input/output and control devices can also be used.</p>
<p id="p-0167" num="0169">Memory interface <b>1602</b> can be coupled to memory <b>1650</b>. Memory <b>1650</b> can include high-speed random access memory and/or non-volatile memory, such as one or more magnetic disk storage devices, one or more optical storage devices, and/or flash memory (e.g., NAND, NOR). Memory <b>1650</b> can store operating system <b>1652</b>, such as Darwin, RTXC, LINUX, UNIX, OS X, WINDOWS, or an embedded operating system such as VxWorks. Operating system <b>1652</b> may include instructions for handling basic system services and for performing hardware dependent tasks. In some implementations, operating system <b>1652</b> can include a kernel (e.g., UNIX kernel).</p>
<p id="p-0168" num="0170">Memory <b>1650</b> may also store communication instructions <b>1654</b> to facilitate communicating with one or more additional devices, one or more computers and/or one or more servers. Memory <b>1650</b> may include graphical user interface instructions <b>1656</b> to facilitate graphic user interface processing; sensor processing instructions <b>1658</b> to facilitate sensor-related processing and functions; phone instructions <b>1660</b> to facilitate phone-related processes and functions; electronic messaging instructions <b>1662</b> to facilitate electronic-messaging related processes and functions; web browsing instructions <b>1664</b> to facilitate web browsing-related processes and functions; media processing instructions <b>1666</b> to facilitate media processing-related processes and functions; GPS/Navigation instructions <b>1668</b> to facilitate GPS and navigation-related processes and instructions; camera instructions <b>1670</b> to facilitate camera-related processes and functions; magnetometer data <b>1672</b> and calibration instructions <b>1674</b> to facilitate magnetometer calibration. The memory <b>1650</b> may also store other software instructions (not shown), such as security instructions, web video instructions to facilitate web video-related processes and functions, and/or web shopping instructions to facilitate web shopping-related processes and functions. In some implementations, the media processing instructions <b>1666</b> are divided into audio processing instructions and video processing instructions to facilitate audio processing-related processes and functions and video processing-related processes and functions, respectively. An activation record and International Mobile Equipment Identity (IMEI) or similar hardware identifier can also be stored in memory <b>1650</b>. Memory <b>1650</b> can include geofence instructions <b>1676</b> that can be used receive a geofence defined by a user, identifying one or more wireless access points for monitoring the geofence, monitoring the geofence using the identified wireless access points, and perform tasks associated with the geofence upon determining the mobile device is inside or outside the geofence.</p>
<p id="p-0169" num="0171">Each of the above identified instructions and applications can correspond to a set of instructions for performing one or more functions described above. These instructions need not be implemented as separate software programs, procedures, or modules. Memory <b>1650</b> can include additional instructions or fewer instructions. Furthermore, various functions of the mobile device may be implemented in hardware and/or in software, including in one or more signal processing and/or application specific integrated circuits.</p>
<heading id="h-0019" level="1">Exemplary Operating Environment</heading>
<p id="p-0170" num="0172"><figref idref="DRAWINGS">FIG. 17</figref> is a block diagram of an exemplary network operating environment <b>1700</b> for the mobile devices of <figref idref="DRAWINGS">FIGS. 1-9</figref>. Mobile devices <b>1702</b><i>a </i>and <b>1702</b><i>b </i>can, for example, communicate over one or more wired and/or wireless networks <b>1710</b> in data communication. For example, a wireless network <b>1712</b>, e.g., a cellular network, can communicate with a wide area network (WAN) <b>1714</b>, such as the Internet, by use of a gateway <b>1716</b>. Likewise, an access device <b>1718</b>, such as an 802.11g wireless access point, can provide communication access to the wide area network <b>1714</b>.</p>
<p id="p-0171" num="0173">In some implementations, both voice and data communications can be established over wireless network <b>1712</b> and the access device <b>1718</b>. For example, mobile device <b>1702</b><i>a </i>can place and receive phone calls (e.g., using voice over Internet Protocol (VoIP) protocols), send and receive e-mail messages (e.g., using Post Office Protocol 3 (POP3)), and retrieve electronic documents and/or streams, such as web pages, photographs, and videos, over wireless network <b>1712</b>, gateway <b>1716</b>, and wide area network <b>1714</b> (e.g., using Transmission Control Protocol/Internet Protocol (TCP/IP) or User Datagram Protocol (UDP)). Likewise, in some implementations, the mobile device <b>1702</b><i>b </i>can place and receive phone calls, send and receive e-mail messages, and retrieve electronic documents over the access device <b>1718</b> and the wide area network <b>1714</b>. In some implementations, mobile device <b>1702</b><i>a </i>or <b>1702</b><i>b </i>can be physically connected to the access device <b>1718</b> using one or more cables and the access device <b>1718</b> can be a personal computer. In this configuration, mobile device <b>1702</b><i>a </i>or <b>1702</b><i>b </i>can be referred to as a &#x201c;tethered&#x201d; device.</p>
<p id="p-0172" num="0174">Mobile devices <b>1702</b><i>a </i>and <b>1702</b><i>b </i>can also establish communications by other means. For example, wireless device <b>1702</b><i>a </i>can communicate with other wireless devices, e.g., other mobile devices, cell phones, etc., over the wireless network <b>1712</b>. Likewise, mobile devices <b>1702</b><i>a </i>and <b>1702</b><i>b </i>can establish peer-to-peer communications <b>1720</b>, e.g., a personal area network, by use of one or more communication subsystems, such as the Bluetooth&#x2122; communication devices. Other communication protocols and topologies can also be implemented.</p>
<p id="p-0173" num="0175">The mobile device <b>1702</b><i>a </i>or <b>1702</b><i>b </i>can, for example, communicate with one or more services <b>1730</b> and <b>1740</b> over the one or more wired and/or wireless networks. For example, one or more access point listing services <b>1730</b> can determine one or more identifiers of wireless access points, estimate locations of the wireless access points using location data harvested from one or more location-aware device, determining AP scores for wireless access points, determine a channel for each wireless access point, and provide the information to mobile device <b>1702</b><i>a </i>or <b>1702</b><i>b. </i></p>
<p id="p-0174" num="0176">Geofence service <b>1740</b> can, for example, provide geofence-based API such that users of mobile device <b>1702</b><i>a </i>or <b>1702</b><i>b </i>can develop geofence-based application programs The application programs can be provided for download to mobile device <b>1702</b><i>a </i>or <b>1702</b><i>b. </i></p>
<p id="p-0175" num="0177">Mobile device <b>1702</b><i>a </i>or <b>1702</b><i>b </i>can also access other data and content over the one or more wired and/or wireless networks. For example, content publishers, such as news sites, Really Simple Syndication (RSS) feeds, web sites, blogs, social networking sites, developer networks, etc., can be accessed by mobile device <b>1702</b><i>a </i>or <b>1702</b><i>b</i>. Such access can be provided by invocation of a web browsing function or application (e.g., a browser) in response to a user touching, for example, a Web object.</p>
<p id="p-0176" num="0178">A number of implementations of the invention have been described. Nevertheless, it will be understood that various modifications can be made without departing from the spirit and scope of the invention. For example, geographic regions used in wireless access point selection are represented as tiles. The collection of the geographic regions is represented as a grid. The actual shape of the geographic regions can vary.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001" nb-file="US08626187-20140107-M00001.NB">
<img id="EMI-M00001" he="6.69mm" wi="76.20mm" file="US08626187-20140107-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002" nb-file="US08626187-20140107-M00002.NB">
<img id="EMI-M00002" he="7.03mm" wi="76.20mm" file="US08626187-20140107-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00003" nb-file="US08626187-20140107-M00003.NB">
<img id="EMI-M00003" he="4.57mm" wi="76.20mm" file="US08626187-20140107-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00004" nb-file="US08626187-20140107-M00004.NB">
<img id="EMI-M00004" he="8.81mm" wi="76.20mm" file="US08626187-20140107-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method performed by a mobile device, comprising:
<claim-text>determining that the mobile device is inside of a first geofence defined by a plurality of first wireless access points and a second geofence defined by a plurality of second wireless access points, including determining that the mobile device has detected a signal from at least one of the first wireless access points and at least one of the second wireless access points;</claim-text>
<claim-text>creating a temporary geofence, including designating a current location of the mobile device as a fence location of the temporary geofence, the temporary geofence intersecting both the first geofence and the second geofence;</claim-text>
<claim-text>identifying one or more common gateways for monitoring the temporary geofence, the common gateways including one or more wireless access points observable by the mobile device when the mobile device is located in both of the first geofence and the second geofence;</claim-text>
<claim-text>designating at least one of the identified common gateways as an exit gateway for monitoring an exit from the temporary geofence;</claim-text>
<claim-text>detecting an exit of the mobile device from the temporary geofence, including determining that, for at least a threshold number of scans, the exit gateway is unobservable by the mobile device; and</claim-text>
<claim-text>upon detecting the exit from the temporary geofence, determining that the mobile device exited the first geofence or the second geofence.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein determining that the mobile device is inside of the first geofence and second geofence comprises:
<claim-text>detecting the signal by a wireless processor of the mobile device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein detecting the exit of the mobile device from the first geofence or the second geofence comprises:
<claim-text>determining that the exit gateway is unobservable by the wireless processor; and then</claim-text>
<claim-text>determining that the mobile device exited the first geofence or second geofence using an application processor of the mobile device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the temporary geofence has a pre-specified radius.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the second geofence intersects the first geofence.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the exit gateway is a wireless access point not previously selected for monitoring a geofence but is observable by the mobile device when the mobile device is located at the fence location of the temporary geofence.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein determining that the mobile device exited the first geofence or the second geofence comprises:
<claim-text>determining a new location of the mobile device; and</claim-text>
<claim-text>determining that the mobile device exited the first geofence or the second geofence based on a comparison between the new location and a location of the first geofence or a location of the second geofence.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein detecting that the mobile device exited the first geofence or the second geofence comprises:
<claim-text>determining, based on the comparison, that the mobile device is still located in both the first geofence and the second geofence;</claim-text>
<claim-text>creating a second temporary geofence; and</claim-text>
<claim-text>determining that the mobile device exited the first geofence or the second geofence when the mobile device exits the second temporary geofence.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. A non-transitory storage device storing computer program product configured to cause a mobile device to perform operations comprising:
<claim-text>determining that the mobile device is inside of a first geofence defined by a plurality of first wireless access points and a second geofence defined by a plurality of second wireless access points, including determining that the mobile device has detected a signal from at least one of the first wireless access points and at least one of the second wireless access points;</claim-text>
<claim-text>creating a temporary geofence, including designating a current location of the mobile device as a fence location of the temporary geofence, the temporary geofence intersecting both the first geofence and the second geofence;</claim-text>
<claim-text>identifying one or more common gateways for monitoring the temporary geofence, the common gateways including one or more wireless access points observable by the mobile device when the mobile device is located in both of the first geofence and the second geofence;</claim-text>
<claim-text>designating at least one of the identified common gateways as an exit gateway for monitoring an exit from the temporary geofence;</claim-text>
<claim-text>detecting an exit of the mobile device from the temporary geofence, including
<claim-text>determining that, for at least a threshold number of scans, the exit gateway is unobservable by the mobile device; and</claim-text>
</claim-text>
<claim-text>upon detecting the exit from the temporary geofence, determining that the mobile device exited the first geofence or the second geofence.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The non-transitory storage device of <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein determining that the mobile device is inside of the first geofence and second geofence comprises:
<claim-text>detecting the signal by a wireless processor of the mobile device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The non-transitory storage device of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein detecting the exit of the mobile device from the first geofence or the second geofence comprises:
<claim-text>determining that the exit gateway is unobservable by the wireless processor; and then</claim-text>
<claim-text>determining that the mobile device exited the first geofence or second geofence using an application processor of the mobile device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The non-transitory storage device of <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the temporary geofence has a pre-specified radius.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The non-transitory storage device of <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the second geofence intersects the first geofence.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The non-transitory storage device of <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the exit gateway is a wireless access point not previously selected for monitoring a geofence but is observable by the mobile device when the mobile device is located at the fence location of the temporary geofence.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The non-transitory storage device of <claim-ref idref="CLM-00014">claim 14</claim-ref>, wherein determining that the mobile device exited the first geofence or the second geofence comprises:
<claim-text>determining a new location of the mobile device; and</claim-text>
<claim-text>determining that the mobile device is in the first geofence or the second geofence based on a comparison between the new location and a location of the first geofence or a location of the second geofence.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The non-transitory storage device of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein detecting that the mobile device exited the first geofence or the second geofence comprises:
<claim-text>determining, based on the comparison, that the mobile device is still located in both the first geofence and the second geofence;</claim-text>
<claim-text>creating a second temporary geofence; and</claim-text>
<claim-text>determining that the mobile device exited the first geofence or the second geofence when the mobile device exits the second temporary geofence.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. A system, comprising:
<claim-text>a mobile device; and</claim-text>
<claim-text>a non-transitory storage device storing computer program product configured to cause the mobile device to perform operations comprising:
<claim-text>determining that the mobile device is inside of a geofence defined by a plurality of first wireless access points and a second geofence defined by a plurality of second wireless access points, including determining that the mobile device has detected a signal from at least one of the first wireless access points and at least one of the second wireless access points;</claim-text>
<claim-text>creating a temporary geofence, including designating a current location of the mobile device as a fence location of the temporary geofence, the temporary geofence intersecting both the first geofence and the second geofence;</claim-text>
<claim-text>identifying one or more common gateways for monitoring the temporary geofence, the common gateways including one or more wireless access points observable by the mobile device when the mobile device is located in both of the first geofence and the second geofence;</claim-text>
<claim-text>designating at least one of the identified common gateways as an exit gateway for monitoring an exit from the temporary geofence; and</claim-text>
<claim-text>detecting an exit of the mobile device from the temporary geofence, including:</claim-text>
<claim-text>determining that, for at least a threshold number of scans, the exit gateway is unobservable by the mobile device; and</claim-text>
<claim-text>upon detecting the exit from the temporary geofence, determining that the mobile device exited the first geofence or the second geofence.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The system of <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein determining that the mobile device is inside of the first geofence and second geofence comprises:
<claim-text>detecting the signal by a wireless processor of the mobile device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The system of <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein detecting the exit of the mobile device from the first geofence or the second geofence comprises:
<claim-text>determining that the exit gateway is unobservable by the wireless processor; and then</claim-text>
<claim-text>determining that the mobile device exited the first geofence or second geofence using an application processor of the mobile device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The system of <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein the temporary geofence has a pre-specified radius.</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. The system of <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein the second geofence intersects the first geofence.</claim-text>
</claim>
<claim id="CLM-00022" num="00022">
<claim-text>22. The system of <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein the exit gateway is a wireless access point not previously selected for monitoring a geofence but is observable by the mobile device when the mobile device is located at the fence location of the temporary geofence.</claim-text>
</claim>
<claim id="CLM-00023" num="00023">
<claim-text>23. The system of <claim-ref idref="CLM-00022">claim 22</claim-ref>, wherein determining that the mobile device exited the first geofence or the second geofence comprises:
<claim-text>determining a new location of the mobile device; and</claim-text>
<claim-text>determining that the mobile device exited the first geofence or the second geofence based on a comparison between the new location and a location of the first geofence or a location of the second geofence.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00024" num="00024">
<claim-text>24. The system of <claim-ref idref="CLM-00023">claim 23</claim-ref>, wherein detecting that the mobile device exited the first geofence or the second geofence comprises:
<claim-text>determining, based on the comparison, that the mobile device is still located in both the first geofence and the second geofence;</claim-text>
<claim-text>creating a second temporary geofence; and</claim-text>
<claim-text>determining that the mobile device exited the first geofence or the second geofence when the mobile device exits the second temporary geofence. </claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
