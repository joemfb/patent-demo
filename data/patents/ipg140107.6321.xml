<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08627477-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08627477</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>13238680</doc-number>
<date>20110921</date>
</document-id>
</application-reference>
<us-application-series-code>13</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>CN</country>
<doc-number>2009 1 0106341</doc-number>
<date>20090323</date>
</priority-claim>
</priority-claims>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>29</main-group>
<subgroup>06</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>726 24</main-classification>
</classification-national>
<invention-title id="d2e61">Method, apparatus, and system for detecting a zombie host</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>7760640</doc-number>
<kind>B2</kind>
<name>Brown et al.</name>
<date>20100700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370235</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>8056132</doc-number>
<kind>B1</kind>
<name>Chang et al.</name>
<date>20111100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 23</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>2003/0046577</doc-number>
<kind>A1</kind>
<name>Silverman</name>
<date>20030300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713200</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>2006/0107318</doc-number>
<kind>A1</kind>
<name>Jeffries et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 22</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2007/0097976</doc-number>
<kind>A1</kind>
<name>Wood et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370392</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2007/0192855</doc-number>
<kind>A1</kind>
<name>Hulten et al.</name>
<date>20070800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 22</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2008/0005316</doc-number>
<kind>A1</kind>
<name>Feaver</name>
<date>20080100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2008/0080518</doc-number>
<kind>A1</kind>
<name>Hoeflin et al.</name>
<date>20080400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>37039542</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2009/0006569</doc-number>
<kind>A1</kind>
<name>Morss et al.</name>
<date>20090100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709206</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2010/0162350</doc-number>
<kind>A1</kind>
<name>Jeong et al.</name>
<date>20100600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726  1</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2010/0313264</doc-number>
<kind>A1</kind>
<name>Xie et al.</name>
<date>20101200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 22</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2011/0320816</doc-number>
<kind>A1</kind>
<name>Yao et al.</name>
<date>20111200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713171</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>CN</country>
<doc-number>101360019</doc-number>
<kind>A</kind>
<date>20090200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>EP</country>
<doc-number>1739921</doc-number>
<date>20070100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>WO</country>
<doc-number>WO2010/108422</doc-number>
<kind>A1</kind>
<date>20100900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00016">
<othercit>Wang et al. An Advanced Hybrid Peer-to-Peer Botnet Dependable and Secure Computing, HotBots' 07, First Workshop on Hoti Topics in Understanding Botnets, Usenix, The Advanced, Computing Systems Association, Apr. 10, 2007, Cambridge, MA http://static.usenix.org/event/hotbots07.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00017">
<othercit>Grizzard et al., &#x201c;Peer-to-Peer Botnets: Overview and Case Study,&#x201d; Published in: Proceeding HotBots '07 Proceedings of the first conference on First Workshop on Hot Topics in Understanding Botnets, Usenix Association Berkeley, CA USA, 2007, http://dl.acm.org/citation.cfm?id=1323129.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00018">
<othercit>Weizhou, Research on Detecting Botnets, China Academic Journal Electronic Publishing House, http://www.cnki.net, Nov. 22, 2007.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00019">
<othercit>International Search Report issued in related PCT/CN2010/071151, Jun. 3, 2010.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00020">
<othercit>Written Opinion of the International Searching Authority issued in related PCT/CN2010/071151 dated Jun. 3, 2010.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00021">
<othercit>Ying, Research and Application of NAT Technique, Research and Exploration N. Laboratory, Aug. 2007.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00022">
<othercit>EPO Extended European Search Report dated Jul. 18, 2012, issued in related European Application No. 10755422.2, Huawei Technologies Co., Ltd. (10 pages).</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00023">
<othercit>Kim et al., &#x201c;A Flow-based Method for Abnormal Network Traffic Detection&#x201d;, <i>Network Operations and Management Symposium</i>, IEEE, Seoul, Korea, Apr. 19-23, 2004, IEEE, Piscataway, New Jersey, vol. 1, Apr. 19, 2004, pp. 599-612.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00024">
<othercit>&#x201c;NetFlow&#x201d;, Wikipedia article: anonymous, Mar. 6, 2009 (4 pages). Retrieved from the internet: http://en.wikipedia.org/w/index.php?title=NetFlow&#x26;oldid=275391012 (retrieved on Jul. 11, 2012).</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00025">
<othercit>&#x201c;User Guide for Cisco Security MARS Local Controller&#x2014;Chapter 2: Report and Mitigation Devices Overview&#x201d;, Jun. 20, 2007 (58 pages). Retrieved from the internet: http://www.cisco.com/univercd/cc/td/doc/product/vpn/ciscosec/mars/4<sub>&#x2014;</sub>2/uglc/cfgover.pdf (retrieved on Jul. 11, 2012).</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00026">
<othercit>1<sup>st </sup>Office Action in corresponding Chinese Patent Application No. 200910106341.6 (Feb. 26, 2013).</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>17</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>726 24</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>2</number-of-drawing-sheets>
<number-of-figures>3</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>PCT/CN2010/071151</doc-number>
<date>20100319</date>
</document-id>
<parent-status>PENDING</parent-status>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>13238680</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20120011589</doc-number>
<kind>A1</kind>
<date>20120112</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Chen</last-name>
<first-name>Xu</first-name>
<address>
<city>Beijing</city>
<country>CN</country>
</address>
</addressbook>
<residence>
<country>CN</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Shen</last-name>
<first-name>Shuo</first-name>
<address>
<city>Shenzhen</city>
<country>CN</country>
</address>
</addressbook>
<residence>
<country>CN</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Chen</last-name>
<first-name>Xu</first-name>
<address>
<city>Beijing</city>
<country>CN</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Shen</last-name>
<first-name>Shuo</first-name>
<address>
<city>Shenzhen</city>
<country>CN</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Leydig, Voit &#x26; Mayer, Ltd.</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Huawei Technologies Co., Ltd.</orgname>
<role>03</role>
<address>
<city>Shenzhen</city>
<country>CN</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>McNally</last-name>
<first-name>Michael S</first-name>
<department>2436</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">The present invention relates to the communications field, and in particular, to a detection method, an apparatus, and a network with detection functions. The present invention solves the problem that the Botnet cannot be detected on a current communication network. The detection method is used to detect a Botnet and includes: obtaining a network address translation (NAT) table; detecting a behavior plane and a communication plane of a host according to the NAT table; and performing cluster analysis on results of detection on the communication plane and the behavior plane.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="117.43mm" wi="178.73mm" file="US08627477-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="137.24mm" wi="184.74mm" file="US08627477-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="227.84mm" wi="138.94mm" file="US08627477-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">This application is a continuation of International Application No. PCT/CN2010/071151, filed on Mar. 19, 2010, which claims priority to Chinese Patent Application No. 200910106341.6, filed on Mar. 23, 2009, both of which are hereby incorporated by reference in their entireties.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">FIELD OF THE INVENTION</heading>
<p id="p-0003" num="0002">The present invention relates to the communications field, and in particular, to a method, an apparatus, and a system for detecting a zombie host.</p>
<heading id="h-0003" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0004" num="0003">The Botnet is the biggest threat to current networks of operators. Most distribution denial of service (DDoS) attacks are initiated by the Botnet and pose great threats to telecom operators and their users. A controlled zombie host becomes a hotbed for malicious websites and junk mails, and also causes great information disclosures and economic losses.</p>
<p id="p-0005" num="0004">Among the conventional Botnet detection technologies, an effective technology is behavior-based detection. This technology uses a single host as the detection target, detects a communication plane and a behavior plane, and performs cluster analysis on detection results. Then, the technology performs correlation analysis to judge whether the single host is infected and determine abnormal activities performed by the single host if the single host is infected. The detection on the communication plane focuses on data streams, and detects the communication features of the Internet Protocol (IP) layer and transport layer. The detection on the behavior plane judges, according to various behaviors of the single host, whether the host performs such suspicious behaviors as downloading malicious software, scanning, and sending malicious software or a junk mail, and then judges whether the host is infected. This technology is used to observe and analyze various behaviors of a single host or other network devices, and make a judgment according to the network communication behaviors of the host. However, when a network address translation (NAT) device exists, the access side of an operator cannot identify a single host on a private network from a user gateway. Therefore, it cannot be determined that network behaviors are initiated by one host on a private network.</p>
<heading id="h-0004" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0006" num="0005">Embodiments of the present invention provide a method, an apparatus, and a system for detecting a zombie host to solve the technical problem that a zombie host on a private network equipped with a NAT device cannot be detected on current communication networks.</p>
<p id="p-0007" num="0006">An implementation of an embodiment of the present invention for solving the preceding technical problem is: providing a detection method. The method includes obtaining a NAT table; detecting a behavior plane and a communication plane of a host according to the NAT table; and analyzing results of detection on the behavior plane and the communication plane of the host to judge whether the host is a zombie host.</p>
<p id="p-0008" num="0007">Another implementation of an embodiment of the present invention for solving the preceding technical problem is as follows: A detection apparatus is configured to detect a Botnet and includes a NAT log server, a Netflow collector, and a network behavior log server. The NAT log server is configured to maintain a NAT table. The Netflow collector is configured to: maintain a communication plane flow table, compare a data time stamp with a time stamp of the NAT table, and determine translation entries to be matched. The network behavior log server is configured to: maintain a behavior plane attack alarm table, search the NAT table for entries that match a source IP address, a source port, and a NAT device identity (ID), and translate the source IP address and the source port into a public IP address and port according to the NAT table.</p>
<p id="p-0009" num="0008">Another implementation of an embodiment of the present invention for solving the preceding technical problem is as follows: A detection system includes at least one host on an internal private network and at least one detection apparatus located at the edge of an Internet service provider (ISP) network. When the host on the private network accesses the ISP network, the detection apparatus is configured to detect network behaviors of the host to judge whether the host is a zombie host.</p>
<p id="p-0010" num="0009">By using the detection system and detection method provided in embodiments of the present invention, the problem that the host on the private network cannot be confirmed from the operator side in a NAT scenario is solved. Thereby, Botnet detection solutions can be provided for operators.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic structural diagram of a network/system with detection functions according to an embodiment of the present invention;</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 2</figref> is a schematic structural diagram of a detection apparatus according to an embodiment of the present invention; and</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 3</figref> is a schematic flowchart of a detection method according to an embodiment of the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0006" level="1">DETAILED DESCRIPTION OF THE EMBODIMENTS</heading>
<p id="p-0014" num="0013">The following describes the implementation process of the present invention with reference to exemplary embodiments.</p>
<p id="p-0015" num="0014">NAT is a network address translation technology that permits a whole institution to appear on the Internet with a public Internet Protocol (IP) address. This technology translates an internal private IP address into a public IP address. With the NAT technology, an internal private IP address is used on an internal network such as an Intranet, and when an internal node needs to communicate with external networks, the internal private IP address is replaced by a public IP address, so that the public IP address is normally used on external public networks. NAT enables multiple computers to share the Internet connection, which solves the problem of public IP addresses shortage.</p>
<p id="p-0016" num="0015">There are three types of NAT, namely, static NAT, pooled NAT, and network address port translation (NAPT).</p>
<p id="p-0017" num="0016">Static NAT is the simplest and easiest to set and implement. It permanently maps the internal IP address of each host on an internal network to a legal IP address on an external network. Pooled NAT defines a series of legal addresses on the external network, and maps the legal addresses to the internal network by using a dynamic allocation method. NAPT maps internal addresses to different ports of an IP address on the external network.</p>
<p id="p-0018" num="0017">Pooled NAT translates only IP addresses, and allocates a temporary external IP address to each internal IP address. Pooled NAT is mainly applied to dial-up and frequent remote connections. After a remote user is connected, pooled NAT may allocate an IP address to the remote user; when the user is disconnected, the IP address may be released and reserved for future use.</p>
<p id="p-0019" num="0018">NAPT is a well-known translation mode. NAPT is generally applied in access devices, and may hide a small- and middle-sized network behind a legal IP address. Different from pooled NAT, NAPT maps an internal connection to an independent IP address on the external network, and adds a TCP port number selected by the NAT device to the IP address. When NAPT is used on the Internet, all different information flows seem to come from the same IP address. This merit enables NAPT to be practical in small offices. A small office may request an IP address from an Internet Service Provider (ISP) and connect multiple computers to the Internet through NAPT.</p>
<p id="p-0020" num="0019">In an embodiment of the present invention, the NAT device on the user side has a mapping table (or other forms of mapping) between a host ID and an IP address (a port number may be added if NAPT is applied). The IP address is a public IP address used by the host to perform external communication through the NAT device. The NAT device is a gateway or a firewall. The host ID includes a media access control (MAC) address of the host, a user name or an internal private IP address. The detection apparatus on the operator side is deployed or integrated with the edge router on the ISP network. The detection apparatus on the operator side needs to cluster and detect behaviors of each host to judge whether the host is a zombie host. The NAT device shares the NAT mapping with the detection apparatus on the operator side, so that the detection apparatus can categorize network behaviors by using the host ID.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic structural diagram of a network with detection functions according to an embodiment of the present invention. As shown in <figref idref="DRAWINGS">FIG. 1</figref>, the network includes at least one internal private network and at least one ISP network. The host on the internal private network accesses the ISP network through the NAT device and the edge router of the ISP network. The network further includes a detection apparatus. The detection apparatus is deployed or integrated with the edge router of the ISP network, and is configured to detect the network behaviors of the host accessing the ISP network to judge whether the host is a zombie host.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 1</figref> illustrates a detection system according to an embodiment of the present invention. The detection system is configured to detect a Botnet. The system includes at least one host on an internal private network and at least one detection apparatus located at the edge of the ISP network. When the host on the private network accesses the ISP network, the detection apparatus is configured to detect network behaviors of the host to judge whether the host is a zombie host.</p>
<p id="p-0023" num="0022">As shown in <figref idref="DRAWINGS">FIG. 2</figref>, the detection apparatus includes a NAT log server, a Netflow collector, and a network behavior log server.</p>
<p id="p-0024" num="0023">The NAT log server is configured to maintain a NAT table, that is, the mapping table between a host ID and an IP address. The IP address is a public IP address used by the host to perform external communication through the NAT device. The maintenance of the NAT table includes adding or deleting the mapping table between an internal private network host ID and the public IP address and recording such information as the start and end time of the address translation and the NAT device ID.</p>
<p id="p-0025" num="0024">The Netflow collector is configured to maintain a communication plane flow table and perform statistical analysis, for example, classification and clustering.</p>
<p id="p-0026" num="0025">The network behavior log server is configured to maintain a behavior plane attack alarm table that carries information such as downloading and spreading malicious software, scanning, and sending a junk mail.</p>
<p id="p-0027" num="0026">Optionally, the NAT log server is further configured to age the NAT table periodically. The aging time of old entries should be longer than that of the flow cache.</p>
<p id="p-0028" num="0027">Optionally, the Netflow collector is further configured to compare the data time stamp with the time stamp of the NAT table, and determine translation entries to be matched in the NAT table.</p>
<p id="p-0029" num="0028">Optionally, the network behavior log server is further configured to search the NAT table for entries that match the source IP address, source port, and NAT device ID according to the attack alarm table, and translate the source IP address and the source port into the public IP address and port according to the NAT table.</p>
<p id="p-0030" num="0029">In addition, the network behavior log server performs correlation analysis on the analysis results of the communication plane (which receives the Netflow) and abnormal records of the behavior plane (which receives the attack alarm); if entries are matched, the network behavior log server increases flow information or alarm information; otherwise, the network behavior log server creates entries.</p>
<p id="p-0031" num="0030">The zombie host may be located on the internal private network behind NAT. The unique ID of the zombie host may be restored through the mapping of the NAT. This case usually occurs under the following condition: After a user host on the internal private network is offline, the &#x3c;IP, Port&#x3e; pair leased by the user host in the NAT external network is released. A new user host on the internal private network is online, and leases the same &#x3c;IP, Port&#x3e; pair in the NAT address pool. Seen from the detection apparatus on the external network, this &#x3c;IP, Port&#x3e; pair in the NAT address pool is unchanged, but the actual host on the internal private network is already changed. Because the Botnet detection takes a long time, the user host on the internal private network may go online or offline frequently if the time is calculated by the day. The unique ID of the user host on the internal private network may be restored through the NAT mapping. This ID uniquely identifies the zombie host, and is used to detect the zombie host. It serves as an auxiliary function of the Botnet detection. The unique ID of the user host may be the MAC address of the host, internal private IP address or user name.</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 3</figref> is a schematic flowchart of a detection method according to an embodiment of the present invention. The method includes the following steps:</p>
<p id="p-0033" num="0032">S<b>1</b>. Obtain a NAT table.</p>
<p id="p-0034" num="0033">The detection apparatus obtains the NAT table. For example, the detection apparatus may obtain a mapping table between an internal private network host ID and an IP address from the NAT device, where the IP address is a public IP address used by the host to perform external communication through the NAT device.</p>
<p id="p-0035" num="0034">S<b>2</b>. Detect a behavior plane and a communication plane of the host according to the NAT table.</p>
<p id="p-0036" num="0035">The detection apparatus detects the behavior plane of the host according to the mapping table. For example, according to various behaviors of a single host, the detection apparatus judges whether the host is engaged in such suspicious behaviors as downloading malicious software, scanning, and sending malicious software or a junk mail, and then judges whether the host is infected as a zombie host.</p>
<p id="p-0037" num="0036">The detection apparatus uses data streams as the detection target, and checks the communication plane, for example, the communication features of the network layer and transport layer. The detection on the communication plane may be implemented by using the Netflow technology. The Netflow technology measures and counts IP data streams passing through a network device. It can record the traffic passing through the network device (for example, a router). The recorded features include a quintuple, time stamp or other contents in the packet header. The recorded data streams may be combined according to the quintuple or other features. The data streams recorded by the network device (for example, the router) may be cached in the Netflow device; after a certain amount of stream data is collected, the stream data is sent to the Netflow server through User Datagram Protocol (UDP) packets.</p>
<p id="p-0038" num="0037">S<b>3</b>. Analyze the results of detection on the communication plane and the behavior plane.</p>
<p id="p-0039" num="0038">Cluster analysis is performed on the results of detection on the communication plane and the behavior plane, followed by correlation analysis. In this way, whether the single host is infected is judged and the abnormal activities carried out by the infected single host are determined.</p>
<p id="p-0040" num="0039">On the behavior plane, the traffic features of the zombie IP stream are extracted after exceptions are detected through deep packet inspection (DPI). Because the communication plane includes all the IP traffic, the IP streams are clustered into several types on the communication plane, with each type having a traffic feature. The features of zombie IP streams detected on the behavior plane are compared with the features of IP streams on the communication plane; if the features are similar, zombie IP streams may also exist on the communication plane.</p>
<p id="p-0041" num="0040">In addition, whether the host is infected may be judged through independent Botnet detection and analysis on the behavior plane.</p>
<p id="p-0042" num="0041">By using the detection system and detection method provided in embodiments of the present invention, whether the host on the private network is a zombie host can be confirmed from the operator side in a NAT scenario. Thereby, Botnet detection solutions can be provided for operators.</p>
<p id="p-0043" num="0042">Based on the preceding description of embodiments, it is understandable to those skilled in the art that the present invention may be implemented through software in addition to a necessary universal hardware platform or through hardware only. In most circumstances, the former is preferred. Therefore, the essence of the technical solution of the present invention or the contributions to the prior art may be embodied as a software product. The software product is stored in a storage medium, and includes several instructions that enable a computer device (a personal computer, a server, or a network device) to perform the methods provided in the embodiments of the present invention.</p>
<p id="p-0044" num="0043">The above descriptions are merely exemplary embodiments of the present invention, but not intended to limit the scope of the present invention. Any modification, equivalent replacement, or improvement made without departing from the spirit and principle of the present invention should fall within the protection scope of the present invention. Therefore, the scope of the present invention is subject to the appended claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method for detecting a zombie host by an operator network located externally to a user side network, comprising:
<claim-text>obtaining a network address translation (NAT) table;</claim-text>
<claim-text>detecting, by a detection apparatus on the operator network, a behavior plane and a communication plane of a host on a user-side network according to the NAT table; and</claim-text>
<claim-text>analyzing a result of detecting the behavior plane and the communication plane of the host according to the NAT table to judge whether the host is the zombie host,</claim-text>
<claim-text>wherein the analyzing the result further comprises:</claim-text>
<claim-text>comparing features of zombie IP streams detected on the behavior plane with features of IP streams detected on the communication plane, and</claim-text>
<claim-text>determining that the zombie IP streams exist on the communication plane when the compared features of the zombie IP streams and the compared features of the IP streams are the same.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the NAT table is a mapping table that records mapping between an internal private network host identity (ID) and an Internet Protocol (IP) address, wherein the IP address is a public IP address used by the host to perform external communication through a NAT device.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the host ID comprises a media access control (MAC) address of the host or a user name or an internal private IP identifier.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the step of detecting the behavior plane and the communication plane of the host according to the NAT table comprises:
<claim-text>according to various behaviors of a single host, judging whether the host is engaged in suspicious behaviors, wherein the suspicious behaviors comprise at least one of the following behaviors: downloading malicious software, scanning, sending malicious software, and sending a junk mail; and</claim-text>
<claim-text>using data streams as a detection target, and checking communication features of an Internet Protocol (IP) layer and a transport layer.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein detecting the communication plane is implemented by using a Netflow technology.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the detection apparatus is integrated with an edge router on the operator network.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. An apparatus, located on an operator side network, for detecting a zombie host located on a user side network that is external to an operator side network, the apparatus comprising a processor and a non-transitory memory storage coupled with the processor, the non-transitory memory storage comprising:
<claim-text>a first module, configured to obtain a network address translation (NAT) table;</claim-text>
<claim-text>a second module, configured to detect a behavior plane and a communication plane of a host according to the NAT table; and</claim-text>
<claim-text>a third module, configured to analyze a result of detecting the behavior plane and the communication plane of the host according to the NAT table to judge whether the host is the zombie host; compare features of zombie IP streams detected on the behavior plane with features of IP streams detected on the communication plane, and determine the zombie IP streams exist on the communication plane when the compared features are the same.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The apparatus of <claim-ref idref="CLM-00007">claim 7</claim-ref>, comprising a NAT log server, a Netflow collector, and a network behavior log server, wherein:
<claim-text>the NAT log server is configured to maintain the NAT table;</claim-text>
<claim-text>the Netflow collector is configured to: maintain a communication plane flow table, compare a data time stamp with a time stamp of the NAT table, and determine translation entries to be matched in the NAT table; and</claim-text>
<claim-text>the network behavior log server is configured to: maintain a behavior plane attack alarm table, search the NAT table for entries that match a source Internet Protocol (IP) address, a source port, and a NAT device identity (ID) according to the attack alarm table, and translate the source IP address and the source port into a public IP address and port according to the NAT table.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The apparatus of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the NAT table is a mapping table that records mapping between an internal private network host ID and an IP address, wherein the IP address is a public IP address used by the host to perform external communication through a NAT device.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The apparatus of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the NAT log server is further configured to age the NAT table periodically, wherein the aging time of old entries is longer than that of the flow cache.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The apparatus of <claim-ref idref="CLM-00007">claim 7</claim-ref>, further comprising:
<claim-text>an edge router on the operator network;</claim-text>
<claim-text>wherein the edge router on the operator network is integrated with the processor.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. A network for detecting a Botnet located on an internal private network, comprising at least the internal private network, at least one Internet service provider (ISP) network external to the internal private network, and a detection apparatus located on the ISP network, wherein a host on the internal private network accesses the ISP network through a network address translation (NAT) device and an edge router of the ISP network and
<claim-text>the detection apparatus comprises a processor and a non-transitory memory storage coupled with the processor,</claim-text>
<claim-text>the non-transitory memory storage comprises:</claim-text>
<claim-text>a first module configured to obtain a network address translation (NAT) table;</claim-text>
<claim-text>a second module configured to detect a behavior plane and a communication plane of the host according to the NAT table;</claim-text>
<claim-text>a third module configured to analyze a result of detecting the behavior plane and the communication plane of the host according to the NAT table to judge whether the host is a zombie host, compare features of zombie IP streams detected on the behavior plane with features of IP streams detected on the communication plane, and determine the zombie IP streams exist on the communication plane when the compared features are the same.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The network of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the NAT device has a mapping table between a host identity (ID) and an IP address, wherein the IP address is a public IP address used by the host to perform external communication through the NAT device.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The network of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the host ID comprises a media access control (MAC) address of the host or a user name.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The network of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the detection apparatus is utilized for detecting the zombie host and configured to detect the Botnet and comprises a NAT log server, a Netflow collector, and a network behavior log server, wherein:
<claim-text>the NAT log server is configured to maintain the NAT table;</claim-text>
<claim-text>the Netflow collector is configured to: maintain a communication plane flow table, compare a data time stamp with a time stamp of the NAT table, and determine translation entries to be matched in the NAT table; and</claim-text>
<claim-text>the network behavior log server is configured to: maintain a behavior plane attack alarm table, search the NAT table for entries that match a source Internet Protocol (IP) address, a source port, and a NAT device identity (ID) according to the attack alarm table, and translate the source IP address and the source port into a public IP address and port according to the NAT table.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The network of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the NAT device is a gateway or a firewall.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The network of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the edge router on the ISP network is integrated with the detection apparatus. </claim-text>
</claim>
</claims>
</us-patent-grant>
