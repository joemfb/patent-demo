<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08627127-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08627127</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>13530901</doc-number>
<date>20120622</date>
</document-id>
</application-reference>
<us-application-series-code>13</us-application-series-code>
<us-term-of-grant>
<us-term-extension>46</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>1</main-group>
<subgroup>26</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>1</main-group>
<subgroup>32</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>713320</main-classification>
<further-classification>713323</further-classification>
<further-classification>713324</further-classification>
</classification-national>
<invention-title id="d2e53">Power-preserving communications architecture with long-polling persistent cloud channel for wireless network-connected thermostat</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>4049973</doc-number>
<kind>A</kind>
<name>Lambert</name>
<date>19770900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>4157506</doc-number>
<kind>A</kind>
<name>Spencer</name>
<date>19790600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>4174807</doc-number>
<kind>A</kind>
<name>Smith et al.</name>
<date>19791100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>4308991</doc-number>
<kind>A</kind>
<name>Peinetti et al.</name>
<date>19820100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>4528459</doc-number>
<kind>A</kind>
<name>Wiegel</name>
<date>19850700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>4656835</doc-number>
<kind>A</kind>
<name>Kidder et al.</name>
<date>19870400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>4657179</doc-number>
<kind>A</kind>
<name>Aggers et al.</name>
<date>19870400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>4695246</doc-number>
<kind>A</kind>
<name>Beilfuss et al.</name>
<date>19870900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>4742475</doc-number>
<kind>A</kind>
<name>Kaiser et al.</name>
<date>19880500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>4842510</doc-number>
<kind>A</kind>
<name>Grunden et al.</name>
<date>19890600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>4872828</doc-number>
<kind>A</kind>
<name>Mierzwinski et al.</name>
<date>19891000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>4948044</doc-number>
<kind>A</kind>
<name>Cacciatore</name>
<date>19900800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>4955806</doc-number>
<kind>A</kind>
<name>Grunden et al.</name>
<date>19900900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>5107918</doc-number>
<kind>A</kind>
<name>McFarlane et al.</name>
<date>19920400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>5158477</doc-number>
<kind>A</kind>
<name>Testa et al.</name>
<date>19921000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>5175439</doc-number>
<kind>A</kind>
<name>Haerer et al.</name>
<date>19921200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>5224648</doc-number>
<kind>A</kind>
<name>Simon et al.</name>
<date>19930700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>5251813</doc-number>
<kind>A</kind>
<name>Kniepkamp</name>
<date>19931000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>5255179</doc-number>
<kind>A</kind>
<name>Zekan et al.</name>
<date>19931000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00020">
<document-id>
<country>US</country>
<doc-number>5347982</doc-number>
<kind>A</kind>
<name>Binzer et al.</name>
<date>19940900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00021">
<document-id>
<country>US</country>
<doc-number>5452762</doc-number>
<kind>A</kind>
<name>Zillner, Jr.</name>
<date>19950900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00022">
<document-id>
<country>US</country>
<doc-number>5456407</doc-number>
<kind>A</kind>
<name>Stalsberg et al.</name>
<date>19951000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00023">
<document-id>
<country>US</country>
<doc-number>5460327</doc-number>
<kind>A</kind>
<name>Hill et al.</name>
<date>19951000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00024">
<document-id>
<country>US</country>
<doc-number>5462225</doc-number>
<kind>A</kind>
<name>Massara et al.</name>
<date>19951000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00025">
<document-id>
<country>US</country>
<doc-number>5467921</doc-number>
<kind>A</kind>
<name>Shreeve et al.</name>
<date>19951100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00026">
<document-id>
<country>US</country>
<doc-number>5506569</doc-number>
<kind>A</kind>
<name>Rowlette</name>
<date>19960400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00027">
<document-id>
<country>US</country>
<doc-number>5544036</doc-number>
<kind>A</kind>
<name>Brown, Jr. et al.</name>
<date>19960800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00028">
<document-id>
<country>US</country>
<doc-number>5570837</doc-number>
<kind>A</kind>
<name>Brown et al.</name>
<date>19961100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00029">
<document-id>
<country>US</country>
<doc-number>5595342</doc-number>
<kind>A</kind>
<name>McNair et al.</name>
<date>19970100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00030">
<document-id>
<country>US</country>
<doc-number>5611484</doc-number>
<kind>A</kind>
<name>Uhrich</name>
<date>19970300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00031">
<document-id>
<country>US</country>
<doc-number>5635896</doc-number>
<kind>A</kind>
<name>Tinsley et al.</name>
<date>19970600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00032">
<document-id>
<country>US</country>
<doc-number>5644173</doc-number>
<kind>A</kind>
<name>Elliason et al.</name>
<date>19970700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00033">
<document-id>
<country>US</country>
<doc-number>5655709</doc-number>
<kind>A</kind>
<name>Garnett et al.</name>
<date>19970800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00034">
<document-id>
<country>US</country>
<doc-number>5697552</doc-number>
<kind>A</kind>
<name>McHugh et al.</name>
<date>19971200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00035">
<document-id>
<country>US</country>
<doc-number>5736795</doc-number>
<kind>A</kind>
<name>Zuehlke et al.</name>
<date>19980400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00036">
<document-id>
<country>US</country>
<doc-number>5742833</doc-number>
<kind>A</kind>
<name>Dea et al.</name>
<date>19980400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713323</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00037">
<document-id>
<country>US</country>
<doc-number>5761083</doc-number>
<kind>A</kind>
<name>Brown, Jr. et al.</name>
<date>19980600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00038">
<document-id>
<country>US</country>
<doc-number>5802467</doc-number>
<kind>A</kind>
<name>Salazar et al.</name>
<date>19980900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00039">
<document-id>
<country>US</country>
<doc-number>5903139</doc-number>
<kind>A</kind>
<name>Kompelien</name>
<date>19990500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00040">
<document-id>
<country>US</country>
<doc-number>5926776</doc-number>
<kind>A</kind>
<name>Glorioso et al.</name>
<date>19990700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00041">
<document-id>
<country>US</country>
<doc-number>5957374</doc-number>
<kind>A</kind>
<name>Bias et al.</name>
<date>19990900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00042">
<document-id>
<country>US</country>
<doc-number>6060719</doc-number>
<kind>A</kind>
<name>DiTucci et al.</name>
<date>20000500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00043">
<document-id>
<country>US</country>
<doc-number>6084518</doc-number>
<kind>A</kind>
<name>Jamieson</name>
<date>20000700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00044">
<document-id>
<country>US</country>
<doc-number>6098893</doc-number>
<kind>A</kind>
<name>Berglund et al.</name>
<date>20000800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00045">
<document-id>
<country>US</country>
<doc-number>6116512</doc-number>
<kind>A</kind>
<name>Dushane et al.</name>
<date>20000900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00046">
<document-id>
<country>US</country>
<doc-number>6213404</doc-number>
<kind>B1</kind>
<name>Dushane et al.</name>
<date>20010400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00047">
<document-id>
<country>US</country>
<doc-number>6222719</doc-number>
<kind>B1</kind>
<name>Kadah</name>
<date>20010400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00048">
<document-id>
<country>US</country>
<doc-number>6275160</doc-number>
<kind>B1</kind>
<name>Ha</name>
<date>20010800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00049">
<document-id>
<country>US</country>
<doc-number>6315211</doc-number>
<kind>B1</kind>
<name>Sartain et al.</name>
<date>20011100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00050">
<document-id>
<country>US</country>
<doc-number>6356038</doc-number>
<kind>B2</kind>
<name>Bishel</name>
<date>20020300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00051">
<document-id>
<country>US</country>
<doc-number>6385510</doc-number>
<kind>B1</kind>
<name>Hoog et al.</name>
<date>20020500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00052">
<document-id>
<country>US</country>
<doc-number>6509838</doc-number>
<kind>B1</kind>
<name>Payne et al.</name>
<date>20030100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00053">
<document-id>
<country>US</country>
<doc-number>6513723</doc-number>
<kind>B1</kind>
<name>Mueller et al.</name>
<date>20030200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00054">
<document-id>
<country>US</country>
<doc-number>6566768</doc-number>
<kind>B2</kind>
<name>Zimmerman et al.</name>
<date>20030500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00055">
<document-id>
<country>US</country>
<doc-number>6574581</doc-number>
<kind>B1</kind>
<name>Bohrer et al.</name>
<date>20030600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00056">
<document-id>
<country>US</country>
<doc-number>6604023</doc-number>
<kind>B1</kind>
<name>Brown et al.</name>
<date>20030800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00057">
<document-id>
<country>US</country>
<doc-number>6619055</doc-number>
<kind>B1</kind>
<name>Addy</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00058">
<document-id>
<country>US</country>
<doc-number>6619555</doc-number>
<kind>B2</kind>
<name>Rosen</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00059">
<document-id>
<country>US</country>
<doc-number>6622115</doc-number>
<kind>B1</kind>
<name>Brown et al.</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00060">
<document-id>
<country>US</country>
<doc-number>6622925</doc-number>
<kind>B2</kind>
<name>Carner et al.</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00061">
<document-id>
<country>US</country>
<doc-number>6657418</doc-number>
<kind>B2</kind>
<name>Atherton</name>
<date>20031200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00062">
<document-id>
<country>US</country>
<doc-number>6743010</doc-number>
<kind>B2</kind>
<name>Bridgeman et al.</name>
<date>20040600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00063">
<document-id>
<country>US</country>
<doc-number>6794771</doc-number>
<kind>B2</kind>
<name>Orloff</name>
<date>20040900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00064">
<document-id>
<country>US</country>
<doc-number>6798341</doc-number>
<kind>B1</kind>
<name>Eckel et al.</name>
<date>20040900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00065">
<document-id>
<country>US</country>
<doc-number>6886754</doc-number>
<kind>B2</kind>
<name>Smith et al.</name>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00066">
<document-id>
<country>US</country>
<doc-number>6891838</doc-number>
<kind>B1</kind>
<name>Petite et al.</name>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00067">
<document-id>
<country>US</country>
<doc-number>6956463</doc-number>
<kind>B2</kind>
<name>Crenella et al.</name>
<date>20051000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00068">
<document-id>
<country>US</country>
<doc-number>6975958</doc-number>
<kind>B2</kind>
<name>Bohrer et al.</name>
<date>20051200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00069">
<document-id>
<country>US</country>
<doc-number>7167079</doc-number>
<kind>B2</kind>
<name>Smyth et al.</name>
<date>20070100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00070">
<document-id>
<country>US</country>
<doc-number>7174239</doc-number>
<kind>B2</kind>
<name>Butler et al.</name>
<date>20070200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00071">
<document-id>
<country>US</country>
<doc-number>7289887</doc-number>
<kind>B2</kind>
<name>Rodgers</name>
<date>20071000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00072">
<document-id>
<country>US</country>
<doc-number>7476988</doc-number>
<kind>B2</kind>
<name>Mulhouse et al.</name>
<date>20090100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00073">
<document-id>
<country>US</country>
<doc-number>7510126</doc-number>
<kind>B2</kind>
<name>Rossi et al.</name>
<date>20090300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00074">
<document-id>
<country>US</country>
<doc-number>7537171</doc-number>
<kind>B2</kind>
<name>Mueller et al.</name>
<date>20090500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00075">
<document-id>
<country>US</country>
<doc-number>7571865</doc-number>
<kind>B2</kind>
<name>Nicodem et al.</name>
<date>20090800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00076">
<document-id>
<country>US</country>
<doc-number>7605714</doc-number>
<kind>B2</kind>
<name>Thompson et al.</name>
<date>20091000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00077">
<document-id>
<country>US</country>
<doc-number>7648077</doc-number>
<kind>B2</kind>
<name>Rossi et al.</name>
<date>20100100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00078">
<document-id>
<country>US</country>
<doc-number>D614976</doc-number>
<kind>S</kind>
<name>Skafdrup et al.</name>
<date>20100500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00079">
<document-id>
<country>US</country>
<doc-number>7748640</doc-number>
<kind>B2</kind>
<name>Roher et al.</name>
<date>20100700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00080">
<document-id>
<country>US</country>
<doc-number>7755220</doc-number>
<kind>B2</kind>
<name>Sorg et al.</name>
<date>20100700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00081">
<document-id>
<country>US</country>
<doc-number>7775452</doc-number>
<kind>B2</kind>
<name>Shah et al.</name>
<date>20100800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00082">
<document-id>
<country>US</country>
<doc-number>7832465</doc-number>
<kind>B2</kind>
<name>Zou et al.</name>
<date>20101100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00083">
<document-id>
<country>US</country>
<doc-number>7837128</doc-number>
<kind>B2</kind>
<name>Helt et al.</name>
<date>20101100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00084">
<document-id>
<country>US</country>
<doc-number>7841542</doc-number>
<kind>B1</kind>
<name>Rosen</name>
<date>20101100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00085">
<document-id>
<country>US</country>
<doc-number>7900849</doc-number>
<kind>B2</kind>
<name>Barton et al.</name>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00086">
<document-id>
<country>US</country>
<doc-number>8131207</doc-number>
<kind>B2</kind>
<name>Hwang et al.</name>
<date>20120300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00087">
<document-id>
<country>US</country>
<doc-number>8161302</doc-number>
<kind>B2</kind>
<name>Woo</name>
<date>20120400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713310</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00088">
<document-id>
<country>US</country>
<doc-number>D660732</doc-number>
<kind>S</kind>
<name>Bould et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00089">
<document-id>
<country>US</country>
<doc-number>8195313</doc-number>
<kind>B1</kind>
<name>Fadell et al.</name>
<date>20120600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00090">
<document-id>
<country>US</country>
<doc-number>D677180</doc-number>
<kind>S</kind>
<name>Plitkins et al.</name>
<date>20130300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00091">
<document-id>
<country>US</country>
<doc-number>2002/0074865</doc-number>
<kind>A1</kind>
<name>Zimmerman et al.</name>
<date>20020600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00092">
<document-id>
<country>US</country>
<doc-number>2003/0064335</doc-number>
<kind>A1</kind>
<name>Canon</name>
<date>20030400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00093">
<document-id>
<country>US</country>
<doc-number>2003/0231001</doc-number>
<kind>A1</kind>
<name>Bruning</name>
<date>20031200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00094">
<document-id>
<country>US</country>
<doc-number>2004/0095237</doc-number>
<kind>A1</kind>
<name>Chen et al.</name>
<date>20040500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00095">
<document-id>
<country>US</country>
<doc-number>2004/0209209</doc-number>
<kind>A1</kind>
<name>Chodacki et al.</name>
<date>20041000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00096">
<document-id>
<country>US</country>
<doc-number>2004/0245349</doc-number>
<kind>A1</kind>
<name>Smith</name>
<date>20041200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00097">
<document-id>
<country>US</country>
<doc-number>2005/0043907</doc-number>
<kind>A1</kind>
<name>Eckel et al.</name>
<date>20050200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00098">
<document-id>
<country>US</country>
<doc-number>2005/0194456</doc-number>
<kind>A1</kind>
<name>Tessier et al.</name>
<date>20050900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00099">
<document-id>
<country>US</country>
<doc-number>2005/0195757</doc-number>
<kind>A1</kind>
<name>Kidder et al.</name>
<date>20050900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00100">
<document-id>
<country>US</country>
<doc-number>2005/0270151</doc-number>
<kind>A1</kind>
<name>Winick</name>
<date>20051200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>3405391</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00101">
<document-id>
<country>US</country>
<doc-number>2006/0009863</doc-number>
<kind>A1</kind>
<name>Lingemann</name>
<date>20060100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00102">
<document-id>
<country>US</country>
<doc-number>2006/0105697</doc-number>
<kind>A1</kind>
<name>Aronstam et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00103">
<document-id>
<country>US</country>
<doc-number>2006/0124759</doc-number>
<kind>A1</kind>
<name>Rossi et al.</name>
<date>20060600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00104">
<document-id>
<country>US</country>
<doc-number>2006/0149395</doc-number>
<kind>A1</kind>
<name>Archacki, Jr. et al.</name>
<date>20060700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00105">
<document-id>
<country>US</country>
<doc-number>2006/0186214</doc-number>
<kind>A1</kind>
<name>Simon et al.</name>
<date>20060800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00106">
<document-id>
<country>US</country>
<doc-number>2007/0045432</doc-number>
<kind>A1</kind>
<name>Juntunen</name>
<date>20070300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00107">
<document-id>
<country>US</country>
<doc-number>2007/0114295</doc-number>
<kind>A1</kind>
<name>Jenkins</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00108">
<document-id>
<country>US</country>
<doc-number>2007/0131787</doc-number>
<kind>A1</kind>
<name>Rossi et al.</name>
<date>20070600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00109">
<document-id>
<country>US</country>
<doc-number>2007/0228183</doc-number>
<kind>A1</kind>
<name>Kennedy et al.</name>
<date>20071000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00110">
<document-id>
<country>US</country>
<doc-number>2007/0241203</doc-number>
<kind>A1</kind>
<name>Wagner et al.</name>
<date>20071000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>236  1 C</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00111">
<document-id>
<country>US</country>
<doc-number>2008/0015742</doc-number>
<kind>A1</kind>
<name>Kulyk et al.</name>
<date>20080100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00112">
<document-id>
<country>US</country>
<doc-number>2008/0048046</doc-number>
<kind>A1</kind>
<name>Wagner et al.</name>
<date>20080200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00113">
<document-id>
<country>US</country>
<doc-number>2008/0054082</doc-number>
<kind>A1</kind>
<name>Evans</name>
<date>20080300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00114">
<document-id>
<country>US</country>
<doc-number>2008/0054084</doc-number>
<kind>A1</kind>
<name>Olson</name>
<date>20080300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00115">
<document-id>
<country>US</country>
<doc-number>2008/0147242</doc-number>
<kind>A1</kind>
<name>Roher et al.</name>
<date>20080600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00116">
<document-id>
<country>US</country>
<doc-number>2009/0045263</doc-number>
<kind>A1</kind>
<name>Mueller et al.</name>
<date>20090200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00117">
<document-id>
<country>US</country>
<doc-number>2009/0099697</doc-number>
<kind>A1</kind>
<name>Li et al.</name>
<date>20090400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00118">
<document-id>
<country>US</country>
<doc-number>2009/0140057</doc-number>
<kind>A1</kind>
<name>Leen</name>
<date>20090600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00119">
<document-id>
<country>US</country>
<doc-number>2009/0140060</doc-number>
<kind>A1</kind>
<name>Stoner et al.</name>
<date>20090600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00120">
<document-id>
<country>US</country>
<doc-number>2009/0195349</doc-number>
<kind>A1</kind>
<name>Frader-Thompson et al.</name>
<date>20090800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00121">
<document-id>
<country>US</country>
<doc-number>2009/0236433</doc-number>
<kind>A1</kind>
<name>Mueller et al.</name>
<date>20090900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00122">
<document-id>
<country>US</country>
<doc-number>2010/0006660</doc-number>
<kind>A1</kind>
<name>Leen et al.</name>
<date>20100100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00123">
<document-id>
<country>US</country>
<doc-number>2010/0070099</doc-number>
<kind>A1</kind>
<name>Watson et al.</name>
<date>20100300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00124">
<document-id>
<country>US</country>
<doc-number>2010/0084482</doc-number>
<kind>A1</kind>
<name>Kennedy et al.</name>
<date>20100400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>236 51</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00125">
<document-id>
<country>US</country>
<doc-number>2010/0106305</doc-number>
<kind>A1</kind>
<name>Pavlak et al.</name>
<date>20100400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00126">
<document-id>
<country>US</country>
<doc-number>2010/0106322</doc-number>
<kind>A1</kind>
<name>Grohman</name>
<date>20100400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00127">
<document-id>
<country>US</country>
<doc-number>2010/0168924</doc-number>
<kind>A1</kind>
<name>Tessier et al.</name>
<date>20100700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>700278</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00128">
<document-id>
<country>US</country>
<doc-number>2010/0182743</doc-number>
<kind>A1</kind>
<name>Roher</name>
<date>20100700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00129">
<document-id>
<country>US</country>
<doc-number>2010/0193592</doc-number>
<kind>A1</kind>
<name>Simon et al.</name>
<date>20100800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00130">
<document-id>
<country>US</country>
<doc-number>2010/0211224</doc-number>
<kind>A1</kind>
<name>Keeling et al.</name>
<date>20100800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00131">
<document-id>
<country>US</country>
<doc-number>2010/0305771</doc-number>
<kind>A1</kind>
<name>Rodgers</name>
<date>20101200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00132">
<document-id>
<country>US</country>
<doc-number>2010/0318227</doc-number>
<kind>A1</kind>
<name>Steinberg et al.</name>
<date>20101200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>700278</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00133">
<document-id>
<country>US</country>
<doc-number>2011/0025257</doc-number>
<kind>A1</kind>
<name>Weng</name>
<date>20110200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00134">
<document-id>
<country>US</country>
<doc-number>2011/0054699</doc-number>
<kind>A1</kind>
<name>Imes et al.</name>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00135">
<document-id>
<country>US</country>
<doc-number>2011/0253796</doc-number>
<kind>A1</kind>
<name>Posa et al.</name>
<date>20111000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00136">
<document-id>
<country>US</country>
<doc-number>2011/0290893</doc-number>
<kind>A1</kind>
<name>Steinberg</name>
<date>20111200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>236 493</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00137">
<document-id>
<country>US</country>
<doc-number>2012/0065783</doc-number>
<kind>A1</kind>
<name>Fadell et al.</name>
<date>20120300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00138">
<document-id>
<country>US</country>
<doc-number>2012/0066168</doc-number>
<kind>A1</kind>
<name>Fadell et al.</name>
<date>20120300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00139">
<document-id>
<country>US</country>
<doc-number>2012/0125559</doc-number>
<kind>A1</kind>
<name>Fadell et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00140">
<document-id>
<country>US</country>
<doc-number>2012/0125592</doc-number>
<kind>A1</kind>
<name>Fadell et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00141">
<document-id>
<country>US</country>
<doc-number>2012/0126019</doc-number>
<kind>A1</kind>
<name>Warren et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00142">
<document-id>
<country>US</country>
<doc-number>2012/0126020</doc-number>
<kind>A1</kind>
<name>Filson et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00143">
<document-id>
<country>US</country>
<doc-number>2012/0126021</doc-number>
<kind>A1</kind>
<name>Warren et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00144">
<document-id>
<country>US</country>
<doc-number>2012/0128025</doc-number>
<kind>A1</kind>
<name>Huppi et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00145">
<document-id>
<country>US</country>
<doc-number>2012/0130546</doc-number>
<kind>A1</kind>
<name>Matas et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00146">
<document-id>
<country>US</country>
<doc-number>2012/0130547</doc-number>
<kind>A1</kind>
<name>Fadell et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00147">
<document-id>
<country>US</country>
<doc-number>2012/0130548</doc-number>
<kind>A1</kind>
<name>Fadell et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00148">
<document-id>
<country>US</country>
<doc-number>2012/0130679</doc-number>
<kind>A1</kind>
<name>Fadell et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00149">
<document-id>
<country>US</country>
<doc-number>2012/0131504</doc-number>
<kind>A1</kind>
<name>Fadell et al.</name>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00150">
<document-id>
<country>US</country>
<doc-number>2012/0179300</doc-number>
<kind>A1</kind>
<name>Warren et al.</name>
<date>20120700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00151">
<document-id>
<country>US</country>
<doc-number>2012/0186774</doc-number>
<kind>A1</kind>
<name>Matsuoka et al.</name>
<date>20120700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00152">
<document-id>
<country>US</country>
<doc-number>2012/0191257</doc-number>
<kind>A1</kind>
<name>Corcoran et al.</name>
<date>20120700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00153">
<document-id>
<country>US</country>
<doc-number>2012/0199660</doc-number>
<kind>A1</kind>
<name>Warren et al.</name>
<date>20120800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00154">
<document-id>
<country>US</country>
<doc-number>2012/0203379</doc-number>
<kind>A1</kind>
<name>Sloo et al.</name>
<date>20120800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00155">
<document-id>
<country>US</country>
<doc-number>2012/0229521</doc-number>
<kind>A1</kind>
<name>Hales, IV et al.</name>
<date>20120900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00156">
<document-id>
<country>US</country>
<doc-number>2012/0232969</doc-number>
<kind>A1</kind>
<name>Fadell et al.</name>
<date>20120900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00157">
<document-id>
<country>US</country>
<doc-number>2012/0233478</doc-number>
<kind>A1</kind>
<name>Mucignat et al.</name>
<date>20120900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00158">
<document-id>
<country>US</country>
<doc-number>2012/0239221</doc-number>
<kind>A1</kind>
<name>Mighdoll et al.</name>
<date>20120900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00159">
<document-id>
<country>US</country>
<doc-number>2012/0248210</doc-number>
<kind>A1</kind>
<name>Warren et al.</name>
<date>20121000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00160">
<document-id>
<country>US</country>
<doc-number>2012/0248211</doc-number>
<kind>A1</kind>
<name>Warren et al.</name>
<date>20121000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00161">
<document-id>
<country>US</country>
<doc-number>2012/0256009</doc-number>
<kind>A1</kind>
<name>Mucignat et al.</name>
<date>20121000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00162">
<document-id>
<country>US</country>
<doc-number>2012/0273580</doc-number>
<kind>A1</kind>
<name>Warren et al.</name>
<date>20121100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00163">
<document-id>
<country>EP</country>
<doc-number>207295</doc-number>
<kind>A1</kind>
<date>19870100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00164">
<document-id>
<country>EP</country>
<doc-number>0 510 807</doc-number>
<kind>A2</kind>
<date>19921000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00165">
<document-id>
<country>EP</country>
<doc-number>0 660 287</doc-number>
<kind>A1</kind>
<date>19950600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00166">
<document-id>
<country>EP</country>
<doc-number>0 690 363</doc-number>
<kind>A2</kind>
<date>19960100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00167">
<document-id>
<country>EP</country>
<doc-number>1 275 037</doc-number>
<kind>B1</kind>
<date>20060200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00168">
<document-id>
<country>EP</country>
<doc-number>2 302 326</doc-number>
<kind>A1</kind>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00169">
<document-id>
<country>JP</country>
<doc-number>09298780</doc-number>
<kind>A</kind>
<date>19971100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00170">
<document-id>
<country>WO</country>
<doc-number>2008/054938</doc-number>
<kind>A2</kind>
<date>20080500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00171">
<document-id>
<country>WO</country>
<doc-number>2010/078459</doc-number>
<kind>A1</kind>
<date>20100700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00172">
<document-id>
<country>WO</country>
<doc-number>2012068436</doc-number>
<kind>A1</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00173">
<document-id>
<country>WO</country>
<doc-number>2012068437</doc-number>
<kind>A2</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00174">
<document-id>
<country>WO</country>
<doc-number>2012068447</doc-number>
<kind>A2</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00175">
<document-id>
<country>WO</country>
<doc-number>2012068453</doc-number>
<kind>A1</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00176">
<document-id>
<country>WO</country>
<doc-number>2012068459</doc-number>
<kind>A2</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00177">
<document-id>
<country>WO</country>
<doc-number>2012068495</doc-number>
<kind>A1</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00178">
<document-id>
<country>WO</country>
<doc-number>2012068503</doc-number>
<kind>A1</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00179">
<document-id>
<country>WO</country>
<doc-number>2012068507</doc-number>
<kind>A2</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00180">
<document-id>
<country>WO</country>
<doc-number>2012068517</doc-number>
<kind>A1</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00181">
<document-id>
<country>WO</country>
<doc-number>2012068526</doc-number>
<kind>A1</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00182">
<document-id>
<country>WO</country>
<doc-number>2012068591</doc-number>
<kind>A2</kind>
<date>20120500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00183">
<document-id>
<country>WO</country>
<doc-number>2012092622</doc-number>
<kind>A2</kind>
<date>20120700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00184">
<document-id>
<country>WO</country>
<doc-number>2012092625</doc-number>
<kind>A2</kind>
<date>20120700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00185">
<document-id>
<country>WO</country>
<doc-number>2012092627</doc-number>
<kind>A1</kind>
<date>20120700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00186">
<othercit>Arens, E., et al., &#x201c;Demand Response Enabling Technology Development&#x2014;Phase I Report: Jun. 2003-Nov. 2005,&#x201d; University of California Berkeley, Apr. 4, 2006, 108 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00187">
<othercit>Matty, T., &#x201c;Advanced Energy Management for Home Use,&#x201d; IEEE Transactions on Consumer Electronics, Aug. 1989, vol. 35, No. 3, pp. 584-588.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00188">
<othercit>International Search Report and Written Opinion of PCT/US2012/030084 mailed on Jul. 6, 2012, 7 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00189">
<othercit>Power Stealing Thermostats, Honeywell, Technical Publication No. 50-8433, 1997, 6 pages.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>20</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>713320</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>713323</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>713324</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>22</number-of-drawing-sheets>
<number-of-figures>25</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>13466815</doc-number>
<date>20120508</date>
</document-id>
<parent-status>PENDING</parent-status>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>13530901</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<continuation-in-part>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>13275307</doc-number>
<date>20111017</date>
</document-id>
<parent-status>PENDING</parent-status>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>13466815</doc-number>
</document-id>
</child-doc>
</relation>
</continuation-in-part>
<continuation-in-part>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>13267871</doc-number>
<date>20111006</date>
</document-id>
<parent-status>PENDING</parent-status>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>13275307</doc-number>
</document-id>
</child-doc>
</relation>
</continuation-in-part>
<continuation-in-part>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>13267877</doc-number>
<date>20111006</date>
</document-id>
<parent-status>PENDING</parent-status>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>13267871</doc-number>
</document-id>
</child-doc>
</relation>
</continuation-in-part>
<continuation-in-part>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>13034674</doc-number>
<date>20110224</date>
</document-id>
<parent-status>PENDING</parent-status>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>13267877</doc-number>
</document-id>
</child-doc>
</relation>
</continuation-in-part>
<continuation-in-part>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>13034678</doc-number>
<date>20110224</date>
</document-id>
<parent-status>PENDING</parent-status>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>13034674</doc-number>
</document-id>
</child-doc>
</relation>
</continuation-in-part>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>61627996</doc-number>
<date>20111021</date>
</document-id>
</us-provisional-application>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20120267089</doc-number>
<kind>A1</kind>
<date>20121025</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Mucignat</last-name>
<first-name>Andrea</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Steele</last-name>
<first-name>Oliver</first-name>
<address>
<city>Amherst</city>
<state>MA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Supramaniam</last-name>
<first-name>Senthil</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="004" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Hardison</last-name>
<first-name>Osborne</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="005" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Schultz</last-name>
<first-name>Richard J.</first-name>
<address>
<city>Mountain View</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="006" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Warren</last-name>
<first-name>Daniel A.</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="007" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Fiennes</last-name>
<first-name>Hugo</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="008" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Dutra</last-name>
<first-name>Jonathan A.</first-name>
<address>
<city>Saratoga</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="009" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Bell</last-name>
<first-name>David</first-name>
<address>
<city>Los Altos Hill</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="010" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Fadell</last-name>
<first-name>Anthony M.</first-name>
<address>
<city>Portola Valley</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="011" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Rodgers</last-name>
<first-name>Matthew L.</first-name>
<address>
<city>Los Gatos</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="012" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Smith</last-name>
<first-name>Ian C.</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="013" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Erickson</last-name>
<first-name>Grant M.</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="014" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Satterthwaite</last-name>
<first-name>Edwin H.</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="015" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Palmer</last-name>
<first-name>Joseph E.</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Mucignat</last-name>
<first-name>Andrea</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Steele</last-name>
<first-name>Oliver</first-name>
<address>
<city>Amherst</city>
<state>MA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Supramaniam</last-name>
<first-name>Senthil</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="004" designation="us-only">
<addressbook>
<last-name>Hardison</last-name>
<first-name>Osborne</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="005" designation="us-only">
<addressbook>
<last-name>Schultz</last-name>
<first-name>Richard J.</first-name>
<address>
<city>Mountain View</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="006" designation="us-only">
<addressbook>
<last-name>Warren</last-name>
<first-name>Daniel A.</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="007" designation="us-only">
<addressbook>
<last-name>Fiennes</last-name>
<first-name>Hugo</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="008" designation="us-only">
<addressbook>
<last-name>Dutra</last-name>
<first-name>Jonathan A.</first-name>
<address>
<city>Saratoga</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="009" designation="us-only">
<addressbook>
<last-name>Bell</last-name>
<first-name>David</first-name>
<address>
<city>Los Altos Hill</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="010" designation="us-only">
<addressbook>
<last-name>Fadell</last-name>
<first-name>Anthony M.</first-name>
<address>
<city>Portola Valley</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="011" designation="us-only">
<addressbook>
<last-name>Rodgers</last-name>
<first-name>Matthew L.</first-name>
<address>
<city>Los Gatos</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="012" designation="us-only">
<addressbook>
<last-name>Smith</last-name>
<first-name>Ian C.</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="013" designation="us-only">
<addressbook>
<last-name>Erickson</last-name>
<first-name>Grant M.</first-name>
<address>
<city>Sunnyvale</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="014" designation="us-only">
<addressbook>
<last-name>Satterthwaite</last-name>
<first-name>Edwin H.</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="015" designation="us-only">
<addressbook>
<last-name>Palmer</last-name>
<first-name>Joseph E.</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Kilpatrick Townsend &#x26; Stockton LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Nest Labs, Inc.</orgname>
<role>02</role>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Tran</last-name>
<first-name>Vincent</first-name>
<department>2115</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Provided according to one or more embodiments herein are methods, systems and related architectures for facilitating network communications between a wireless network-connected thermostat and a cloud-based management server in a manner that promotes reduced power usage and extended service life of a rechargeable battery of the thermostat, while at the same time accomplishing timely data transfer between the thermostat and the cloud-based management server for suitable and time-appropriate control of an HVAC system. The thermostat further comprises powering circuitry configured to: extract electrical power from one or more HVAC control wires in a manner that does not require a &#x201c;common&#x201d; wire; supply electrical power for thermostat operation; recharge the rechargeable battery (if needed) using any surplus extracted power; and discharge the rechargeable battery to assist in supplying electrical power for thermostat operation during intervals in which the extracted power alone is insufficient for thermostat operation.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="163.91mm" wi="228.85mm" file="US08627127-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="228.77mm" wi="169.16mm" file="US08627127-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="240.28mm" wi="182.03mm" file="US08627127-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="257.64mm" wi="177.21mm" file="US08627127-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="230.72mm" wi="175.18mm" orientation="landscape" file="US08627127-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="214.63mm" wi="175.34mm" file="US08627127-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="254.42mm" wi="171.70mm" orientation="landscape" file="US08627127-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="223.69mm" wi="161.46mm" orientation="landscape" file="US08627127-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="214.04mm" wi="165.18mm" orientation="landscape" file="US08627127-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="242.23mm" wi="191.60mm" orientation="landscape" file="US08627127-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="250.44mm" wi="186.77mm" orientation="landscape" file="US08627127-20140107-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="255.02mm" wi="194.23mm" orientation="landscape" file="US08627127-20140107-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="228.77mm" wi="176.95mm" orientation="landscape" file="US08627127-20140107-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="254.25mm" wi="197.61mm" file="US08627127-20140107-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="246.55mm" wi="191.85mm" file="US08627127-20140107-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="256.96mm" wi="167.89mm" orientation="landscape" file="US08627127-20140107-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="244.69mm" wi="184.07mm" file="US08627127-20140107-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00017" num="00017">
<img id="EMI-D00017" he="242.23mm" wi="173.06mm" orientation="landscape" file="US08627127-20140107-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00018" num="00018">
<img id="EMI-D00018" he="243.50mm" wi="187.11mm" file="US08627127-20140107-D00018.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00019" num="00019">
<img id="EMI-D00019" he="259.42mm" wi="192.28mm" orientation="landscape" file="US08627127-20140107-D00019.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00020" num="00020">
<img id="EMI-D00020" he="221.91mm" wi="174.67mm" file="US08627127-20140107-D00020.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00021" num="00021">
<img id="EMI-D00021" he="228.09mm" wi="185.84mm" orientation="landscape" file="US08627127-20140107-D00021.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00022" num="00022">
<img id="EMI-D00022" he="255.69mm" wi="187.79mm" orientation="landscape" file="US08627127-20140107-D00022.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCES TO RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">This patent application claims the benefit of U.S. Provisional Application No. 61/627,996 filed Oct. 21, 2011.</p>
<p id="p-0003" num="0002">This application is also a continuation of U.S. Ser. No. 13/466,815 filed on May 8, 2012 (Ref No. NES0179-US), which is a continuation-in-part of the following commonly-assigned applications: U.S. patent application Ser. No. 13/275,307, filed Oct. 17, 2011; U.S. patent application Ser. No. 13/267,871 filed Oct. 6, 2011; PCT Application No. PCT/US11/61437 filed Nov. 18, 2011; S. patent application Ser. No. 13/267,877, filed Oct. 6, 2011; U.S. Ser. No. 13/034,674 filed Feb. 24, 2011; and U.S. Ser. No. 13/034,678 filed Feb. 24, 2011.</p>
<p id="p-0004" num="0003">Each of the above-listed applications is hereby incorporated by reference in their entireties.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">TECHNICAL FIELD</heading>
<p id="p-0005" num="0004">This patent specification relates to system monitoring and control for property and/or environmental control systems. More particularly, this patent specification relates to systems and methods for using a network enabled, battery powered thermostat to monitor and control an HVAC system while conserving the use of energy.</p>
<heading id="h-0003" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0006" num="0005">Substantial effort and attention continue toward the development of newer and more sustainable energy supplies. The conservation of energy by increased energy efficiency remains crucial to the world's energy future. According to an October 2010 report from the U.S. Department of Energy, heating and cooling account for 56% of the energy use in a typical U.S. home, making it the largest energy expense for most homes. Along with improvements in the physical plant associated with home heating and cooling (e.g., improved insulation, higher efficiency furnaces), substantial increases in energy efficiency can be achieved by better control and regulation of home heating and cooling equipment.</p>
<p id="p-0007" num="0006">As is known, for example as discussed in the technical publication No. 50-8433, entitled &#x201c;Power Stealing Thermostats&#x201d; from Honeywell (1997), early thermostats used a bimetallic strip to sense temperature and respond to temperature changes in the room. The movement of the bimetallic strip was used to directly open and close an electrical circuit. Power was delivered to an electromechanical actuator, usually relay or contactor in the HVAC equipment whenever the contact was closed to provide heating and/or cooling to the controlled space. Since these thermostats did not require electrical power to operate, the wiring connections were very simple. Only one wire connected to the transformer and another wire connected to the load. Typically, a 24 VAC power supply transformer, the thermostat, and 24 VAC HVAC equipment relay were all connected in a loop with each device having only two external connections required.</p>
<p id="p-0008" num="0007">When electronics began to be used in thermostats the fact that the thermostat was not directly wired to both sides of the transformer for its power source created a problem. This meant either the thermostat had to have its own independent power source, such as a battery, or be hardwired directly from the system transformer. Direct hardwiring a &#x201c;common&#x201d; wire from the transformer to the electronic thermostat may be very difficult and costly. However, there are also disadvantages to using a battery for providing the operating power. One primary disadvantage is the need to continually check and replace the battery. If the battery is not properly replaced and cannot provide adequate power, the electronic thermostat may fail during a period of extreme environmental conditions.</p>
<p id="p-0009" num="0008">Because many households do not have a direct wire from the system transformer (such as a &#x201c;common&#x201d; wire), some thermostats have been designed to derive power from the transformer through the equipment load. The method for powering an electronic thermostat from the transformer with a single direct wire connection to the transformer is called &#x201c;power stealing&#x201d; or &#x201c;power sharing.&#x201d; The thermostat &#x201c;steals,&#x201d; &#x201c;shares&#x201d; or &#x201c;harvests&#x201d; its power during the &#x201c;OFF&#x201d; periods of the heating or cooling system by allowing a small amount of current to flow through it into the load coil below its response threshold (even at maximum transformer output voltage). During the &#x201c;ON&#x201d; periods of the heating or cooling system the thermostat draws power by allowing a small voltage drop across itself. Ideally, the voltage drop will not cause the load coil to dropout below its response threshold (even at minimum transformer output voltage). Examples of thermostats with power stealing capability include the Honeywell T8600, Honeywell T8400C, and the Emerson Model 1F97-0671. However, these systems do not have power storage means and therefore must always rely on power stealing or must use disposable batteries.</p>
<p id="p-0010" num="0009">Additionally, microprocessor controlled &#x201c;intelligent&#x201d; thermostats may have more advanced environmental control capabilities that can save energy while also keeping occupants comfortable. To do this, these thermostats require more information from the occupants as well as the environments where the thermostats are located. These thermostats may also be capable of connection to computer networks, including both local area networks (or other &#x201c;private&#x201d; networks) and wide area networks such as the Internet (or other &#x201c;public&#x201d; networks), in order to obtain current and forecasted outside weather data, cooperate in so-called demand-response programs (e.g., automatic conformance with power alerts that may be issued by utility companies during periods of extreme weather), enable users to have remote access and/or control thereof through their network-connected device (e.g., smartphone, tablet computer, PC-based web browser), and other advanced functionalities that may require network connectivity.</p>
<p id="p-0011" num="0010">Issues arise in relation to providing microprocessor-controlled, network-connected thermostats, one or more such issues being at least partially resolved by one or more of the embodiments described herein below. On the one hand, it is desirable to provide a thermostat having advanced functionalities such as those associated with relatively powerful microprocessors and reliable wireless communications chips, while also providing a thermostat that has an attractive, visually pleasing electronic display that users will find appealing to behold and interact with. On the other hand, it is desirable to provide a thermostat that is compatible and adaptable for installation in a wide variety of homes, including a substantial percentage of homes that are not equipped with the &#x201c;common&#x201d; wire discussed above. It is still further desirable to provide such a thermostat that accommodates easy do-it-yourself installation such that the expense and inconvenience of arranging for an HVAC technician to visit the premises to install the thermostat can be avoided for a large number of users. It is still further desirable to provide a thermostat having such processing power, wireless communications capabilities, visually pleasing display qualities, and other advanced functionalities, while also being a thermostat that, in addition to not requiring a &#x201c;common&#x201d; wire, likewise does not require to be plugged into household line current or a so-called &#x201c;power brick,&#x201d; which can be inconvenient for the particular location of the thermostat as well as unsightly.</p>
<heading id="h-0004" level="1">BRIEF SUMMARY OF THE INVENTION</heading>
<p id="p-0012" num="0011">Described herein are advanced, multi-sensing, microprocessor-controlled intelligent or &#x201c;learning&#x201d; control units for which one or more of the embodiments is particularly suitable, the control units providing a rich combination of processing capabilities, intuitive and visually pleasing user interfaces, and network connectivity, while at the same time not requiring a C-wire (or line power from a household 110V source such as a wall plug) even though the requisite underlying control unit hardware can require greater instantaneous power than power-stealing can safely provide. The described control unit achieves these goals at least by virtue of the use of a rechargeable battery (or equivalently capable onboard power storage medium) that may recharge during time intervals in which the hardware power usage is less than what power stealing can safely provide, and that will discharge to provide the needed extra electrical power during time intervals in which the hardware power usage is greater than what power stealing can safely provide. Provided according to one or more embodiments herein are methods, systems and related architectures for facilitating network communications between the control unit and a cloud-based management server in a manner that promotes reduced power usage and extended service life of the rechargeable battery, while at the same time accomplishing timely data transfer between the thermostat and the cloud-based management for suitable and time-appropriate control of a system.</p>
<p id="p-0013" num="0012">According to one embodiment, a thermostat is presented. The thermostat may include a plurality of heating, ventilation, and air conditioning (HVAC) connectors, a rechargeable battery, and a battery charging circuit configured to charge the rechargeable battery at least in part by harvesting power from an HVAC system through the plurality of HVAC connectors without requiring a common wire. The thermostat may also include a processor powered at least in part by the rechargeable battery. In one embodiment, the processor may be configured to operate in a low-power state, and a high-power state. The thermostat may further include a wireless communication module operatively coupled to the processor and configured to establish and maintain wireless communications with a router, including receiving transmissions from the router; and process the transmissions from the router by discriminating between a first type of transmission and a second type of transmission. In one embodiment, the first type of transmission may include keep-alive messages associated with a communication channel between a remote thermostat-controller server and the thermostat, and the second type of transmission may include information associated with controlling the HVAC system. The wireless communication module may be further configured to, in response to identifying a transmission of the second type during a time period in which the processor is operating in the low-power state, cause the processor to transition from the low-power state to the high-power state, whereby the processor can operate in the low-power state for an extended period of time while a Natural Address Translation (NAT) table entry in the router that is associated with the communication channel between the processor and the remote thermostat-controller server remains maintained during said extended period of time.</p>
<p id="p-0014" num="0013">According to another embodiment, a method of controlling an environmental condition may be presented. The method may include charging a power supply using a first power harvested from an external power source; and powering a circuit with energy from the power supply. In one embodiment, the circuit may be configured to operate in a plurality of modes, and the plurality of modes may include a low-power mode where the circuit uses less power than the first power, and an operating mode where the circuit uses more power than the first power. The method may also include establishing one or more communication channels with a server through a gateway; and communicating with the server using a protocol. In one embodiment, the protocol may include a time interval that represents a time that the gateway is expected to maintain the one or more communication channels between transmissions; a first type of transmission sent from the server at least in part to maintain one of the one or more communication channels at the gateway, and a second type of transmission comprising data for controlling the environmental condition. The method may additionally include discriminating between transmissions of the first type and transmissions of the second type, and in response to identifying a transmission of the first type during a time period in which the circuit is operating in the low-power mode; allowing the circuit to continue operating in the low-power mode. The method may further include, in response to identifying a transmission of the second type during a time period in which the circuit is operating in the low-power mode, causing the circuit to transition from the low-power mode to the operating mode, and initiating a change in the environmental condition according to the transmission of the second type.</p>
<p id="p-0015" num="0014">According to yet another embodiment, a system for controlling one or more property functions may be presented. The system may include a power manager including a power-storage module configured to provide a first power; and a power input configured to provide energy to the power-storage module by harvesting a second power from an external source, wherein the second power is less than the first power. The system may further include a processing function configured to control the one or more property functions and operate in a plurality of modes including a first mode where the processing function uses a third power and the third power is less than the second power, and a second mode where the processing function uses a fourth power that is higher than the second power and not greater than the first power. The system may additionally include a network-communication module configured to establish one or more communication channels to a controller server through a gateway; utilize a communication protocol with the controller server, where the communication protocol may include a time interval that represents a time that the gateway is expected to maintain the one or more communication channels between transmissions; receive a first transmission from the controller server through the one or more communication channels while the processing function operates in the first mode; determine that the first transmission was sent from the controller server to maintain one of the one or more communication channels, and that the first transmission does not require the processing function to operate in the second mode; receive a second transmission from the controller server through the one or more communication channels, wherein the second transmission includes information for controlling the one or more property functions; and cause the processing function to operate in the second mode after receiving the second transmission.</p>
<p id="p-0016" num="0015">Many other embodiments, features, and aspects are disclosed further herein.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 1</figref> illustrates an environment in which an embodiment of a controller may be used.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 2</figref> illustrates a heating, ventilation, and air conditioning system.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIGS. 3A-3B</figref> illustrate an embodiment of a controller.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIGS. 4A-4C</figref> illustrate auto-switching connectors, according to one embodiment.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 5</figref> illustrates a sense circuit.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIGS. 6A-6C</figref> illustrate power-supply systems and circuits according to one embodiment.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 7</figref> illustrates thermostats and computers on a private network connected to a cloud-based management server, according to one embodiment.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIGS. 8A-8B</figref> illustrate an embodiment of a cloud-based management server and a power-supply level.</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 9</figref> illustrates a cloud-based management server that both conserves energy and promotes high-performance operation of thermostats in accordance with embodiments of the present invention.</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIGS. 10A-10B</figref> illustrate diagrams of the operations of a thermostat communication server in accordance with some embodiments.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 11A</figref> illustrates a communication protocol using multiple channels according to one embodiment.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 11B-11D</figref> illustrate diagrams of the operations of a thermostat communication protocol in accordance with some embodiments.</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 12A</figref> illustrates a block diagram of a thermostat reporting group.</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 12B</figref> illustrates a flowchart of a thermostat reporting group.</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 13</figref> illustrates a network communication module selectively filtering messages sent from a server, according to one embodiment.</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 14</figref> illustrates a thermostat according to an embodiment;</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0006" level="1">DETAILED DESCRIPTION OF THE INVENTION</heading>
<p id="p-0033" num="0032">The subject matter of this patent specification relates to the subject matter of the following commonly assigned applications, each of which is incorporated by reference herein: U.S. Ser. No. 12/881,430 filed Sep. 14, 2010; U.S. Ser. No. 12/881,463 filed Sep. 14, 2010; U.S. Prov. Ser. No. 61/415,771 filed Nov. 19, 2010; U.S. Prov. Ser. No. 61/429,093 filed Dec. 31, 2010; U.S. Ser. No. 12/984,602 filed Jan. 4, 2011; U.S. Ser. No. 12/987,257 filed Jan. 10, 2011; U.S. Ser. No. 13/033,573 filed Feb. 23, 2011; U.S. Ser. No. 29/386,021, filed Feb. 23, 2011; U.S. Ser. No. 13/034,666 filed Feb. 24, 2011; U.S. Ser. No. 13/034,674 filed Feb. 24, 2011; U.S. Ser. No. 13/034,678 filed Feb. 24, 2011; U.S. Ser. No. 13/038,191 filed Mar. 1, 2011; U.S. Ser. No. 13/038,206 filed Mar. 1, 2011; U.S. Ser. No. 29/399,609 filed Aug. 16, 2011; U.S. Ser. No. 29/399,614 filed Aug. 16, 2011; U.S. Ser. No. 29/399,617 filed Aug. 16, 2011; U.S. Ser. No. 29/399,618 filed Aug. 16, 2011; U.S. Ser. No. 29/399,621 filed Aug. 16, 2011; U.S. Ser. No. 29/399,623 filed Aug. 16, 2011; U.S. Ser. No. 29/399,625 filed Aug. 16, 2011; U.S. Ser. No. 29/399,627 filed Aug. 16, 2011; U.S. Ser. No. 29/399,630 filed Aug. 16, 2011; U.S. Ser. No. 29/399,632 filed Aug. 16, 2011; U.S. Ser. No. 29/399,633 filed Aug. 16, 2011; U.S. Ser. No. 29/399,636 filed Aug. 16, 2011; U.S. Ser. No. 29/399,637 filed Aug. 16, 2011; U.S. Ser. No. 13/199,108, filed Aug. 17, 2011; U.S. Ser. No. 13/267,871 filed Oct. 6, 2011; U.S. Ser. No. 13/267,877 filed Oct. 6, 2011; U.S. Ser. No. 13/269,501, filed Oct. 7, 2011; U.S. Ser. No. 29/404,096 filed Oct. 14, 2011; U.S. Ser. No. 29/404,097 filed Oct. 14, 2011; U.S. Ser. No. 29/404,098 filed Oct. 14, 2011; U.S. Ser. No. 29/404,099 filed Oct. 14, 2011; U.S. Ser. No. 29/404,101 filed Oct. 14, 2011; U.S. Ser. No. 29/404,103 filed Oct. 14, 2011; U.S. Ser. No. 29/404,104 filed Oct. 14, 2011; U.S. Ser. No. 29/404,105 filed Oct. 14, 2011; U.S. Ser. No. 13/275,307 filed Oct. 17, 2011; U.S. Ser. No. 13/275,311 filed Oct. 17, 2011; U.S. Ser. No. 13/317,423 filed Oct. 17, 2011; U.S. Ser. No. 13/279,151 filed Oct. 21, 2011; U.S. Ser. No. 13/317,557 filed Oct. 21, 2011; U.S. Prov. Ser. No. 61/627,996 filed Oct. 21, 2011; PCT/US11/61339 filed Nov. 18, 2011; PCT/US11/61344 filed Nov. 18, 2011; PCT/US11/61365 filed Nov. 18, 2011; PCT/US11/61379 filed Nov. 18, 2011; PCT/US11/61391 filed Nov. 18, 2011; PCT/US11/61479 filed Nov. 18, 2011; PCT/US11/61457 filed Nov. 18, 2011; PCT/US11/61470 filed Nov. 18, 2011; PCT/US11/61339 filed Nov. 18, 2011; PCT/US11/61491 filed Nov. 18, 2011; PCT/US11/61437 filed Nov. 18, 2011; PCT/US11/61503 filed Nov. 18, 2011; U.S. Ser. No. 13/342,156 filed Jan. 2, 2012; PCT/US12/00008 filed Jan. 3, 2012; PCT/US12/20088 filed Jan. 3, 2012; PCT/US12/20026 filed Jan. 3, 2012; PCT/US12/00007 filed Jan. 3, 2012; U.S. Ser. No. 13/351,688 filed Jan. 17, 2012; U.S. Ser. No. 13/356,762 filed Jan. 24, 2012; PCT/US12/30084 filed Mar. 22, 2012; U.S. Ser. No. 13/434,573 filed Mar. 29, 2012; U.S. Ser. No. 13/434,560 filed Mar. 29, 2012; U.S. Ser. No. 13/440,907 filed Apr. 5, 2012; and U.S. Ser. No. 13/440,910 filed Apr. 5, 2012. The above-referenced patent applications are collectively referenced herein as &#x201c;the commonly assigned incorporated applications.&#x201d;</p>
<p id="p-0034" num="0033">In the following detailed description, for purposes of explanation, numerous specific details are set forth to provide a thorough understanding of the various embodiments of the present invention. Those of ordinary skill in the art will realize that these various embodiments of the present invention are illustrative only and are not intended to be limiting in any way. Other embodiments of the present invention will readily suggest themselves to such skilled persons having the benefit of this disclosure.</p>
<p id="p-0035" num="0034">In addition, for clarity purposes, not all of the routine features of the embodiments described herein are shown or described. One of ordinary skill in the art would readily appreciate that in the development of any such actual embodiment, numerous embodiment-specific decisions may be required to achieve specific design objectives. These design objectives will vary from one embodiment to another and from one developer to another. Moreover, it will be appreciated that such a development effort might be complex and time-consuming but would nevertheless be a routine engineering undertaking for those of ordinary skill in the art having the benefit of this disclosure.</p>
<p id="p-0036" num="0035">It is to be appreciated that while one or more embodiments are described further herein in the context of typical HVAC system used in a residential home, such as single-family residential home, the scope of the present teachings is not so limited. More generally, thermostats according to one or more of the embodiments are applicable for a wide variety of enclosures having one or more HVAC systems including, without limitation, duplexes, townhomes, multi-unit apartment buildings, hotels, retail stores, office buildings and industrial buildings. Further, it is to be appreciated that while the terms user, customer, installer, homeowner, occupant, guest, tenant, landlord, repair person, and the like may be used to refer to the person or persons who are interacting with the thermostat or other device or user interface in the context of one or more scenarios described herein, these references are by no means to be considered as limiting the scope of the present teachings with respect to the person or persons who are performing such actions.</p>
<p id="p-0037" num="0036">In addition to controlling HVAC systems, the embodiments described herein may also be used in the context of controlling any function related to property. As used herein, the term &#x201c;property controller,&#x201d; or commonly just &#x201c;controller&#x201d; may encompass HVAC controllers, thermostats, and many other types of controllers. For example, in addition to controlling an HVAC system, a controller may be used to control other property functions, such as sprinkler systems, light systems, security systems, entertainment systems, medical equipment, pet-care systems, emergency systems, distributed sensor networks, transportation systems, food-preservation systems, and/or any other type of system amenable to automated or interactive control. According to one embodiment, a property controller may be used to control an environmental condition, such as temperature, humidity, air flow, volume, and/or the like.</p>
<p id="p-0038" num="0037"><figref idref="DRAWINGS">FIG. 1</figref> is a diagram illustrating an exemplary enclosure using a thermostat <b>110</b> implemented in accordance with the present invention for controlling one or more environmental conditions. For example, enclosure <b>100</b> illustrates a single-family dwelling type of enclosure using a learning thermostat <b>110</b> (also referred to for convenience as &#x201c;thermostat <b>110</b>&#x201d;) for the control of heating and cooling provided by an HVAC system <b>120</b>. Alternate embodiments of the present invention may be used with other types of enclosures including a duplex, an apartment within an apartment building, a light commercial structure such as an office or retail store, or a structure or enclosure that is a combination of these and other types of enclosures.</p>
<p id="p-0039" num="0038">Some embodiments of thermostat <b>110</b> in <figref idref="DRAWINGS">FIG. 1</figref> incorporate one or more sensors to gather data from the environment associated with enclosure <b>100</b>. Sensors incorporated in thermostat <b>110</b> may detect occupancy, temperature, light and other environmental conditions and influence the control and operation of HVAC system <b>120</b>. Sensors incorporated within thermostat <b>110</b> do not protrude from the surface of the thermostat <b>110</b> thereby providing a sleek and elegant design that does not draw attention from the occupants in a house or other enclosure. As a result, thermostat <b>110</b> and readily fits with almost any d&#xe9;cor while adding to the overall appeal of the interior design.</p>
<p id="p-0040" num="0039">As used herein, a &#x201c;learning&#x201d; thermostat refers to a thermostat, or one of plural communicating thermostats in a multi-thermostat network, having an ability to automatically establish and/or modify at least one future setpoint in a heating and/or cooling schedule based on at least one automatically sensed event and/or at least one past or current user input.</p>
<p id="p-0041" num="0040">As used herein, a &#x201c;primary&#x201d; thermostat refers to a thermostat that is electrically connected to actuate all or part of an HVAC system, such as by virtue of electrical connection to HVAC control wires (e.g. W, G, Y, etc.) leading to the HVAC system.</p>
<p id="p-0042" num="0041">As used herein, an &#x201c;auxiliary&#x201d; thermostat refers to a thermostat that is not electrically connected to actuate an HVAC system, but that otherwise contains at least one sensor and influences or facilitates primary thermostat control of an HVAC system by virtue of data communications with the primary thermostat.</p>
<p id="p-0043" num="0042">In one scenario, the thermostat <b>110</b> is a primary learning thermostat and is wall-mounted and connected to all of the HVAC control wires, while the remote thermostat <b>112</b> is an auxiliary learning thermostat positioned on a nightstand or dresser, the auxiliary learning thermostat being similar in appearance and user-interface features as the primary learning thermostat, the auxiliary learning thermostat further having similar sensing capabilities (e.g., temperature, humidity, motion, ambient light, proximity) as the primary learning thermostat, but the auxiliary learning thermostat not being connected to any of the HVAC wires. Although it is not connected to any HVAC wires, the auxiliary learning thermostat wirelessly communicates with and cooperates with the primary learning thermostat for improved control of the HVAC system, such as by providing additional temperature data at its respective location in the enclosure, providing additional occupancy information, providing an additional user interface for the user, and so forth.</p>
<p id="p-0044" num="0043">It is to be appreciated that while certain embodiments are particularly advantageous where the thermostat <b>110</b> is a primary learning thermostat and the remote thermostat <b>112</b> is an auxiliary learning thermostat, the scope of the present teachings is not so limited. Thus, for example, while certain initial provisioning methods that automatically pair associate a network-connected thermostat with an online user account are particularly advantageous where the thermostat is a primary learning thermostat, the methods are more generally applicable to scenarios involving primary non-learning thermostats, auxiliary learning thermostats, auxiliary non-learning thermostats, or other types of network-connected thermostats and/or network-connected sensors. By way of further example, while certain graphical user interfaces for remote control of a thermostat may be particularly advantageous where the thermostat is a primary learning thermostat, the methods are more generally applicable to scenarios involving primary non-learning thermostats, auxiliary learning thermostats, auxiliary non-learning thermostats, or other types of network-connected thermostats and/or network-connected sensors. By way of even further example, while certain methods for cooperative, battery-conserving information polling of a thermostat by a remote cloud-based management server may be particularly advantageous where the thermostat is a primary learning thermostat, the methods are more generally applicable to scenarios involving primary non-learning thermostats, auxiliary learning thermostats, auxiliary non-learning thermostats, or other types of network-connected thermostats and/or network-connected sensors.</p>
<p id="p-0045" num="0044">Enclosure <b>100</b> further includes a private network accessible both wirelessly and through wired connections and may also be referred to as a Local Area Network or LAN. Network devices on the private network include a computer <b>124</b>, thermostat <b>110</b> and remote thermostat <b>112</b> in accordance with some embodiments of the present invention. In one embodiment, the private network is implemented using an integrated router <b>122</b> that provides routing, wireless access point functionality, firewall and multiple wired connection ports for connecting to various wired network devices, such as computer <b>124</b>. Each device is assigned a private network address from the integrated router <b>122</b> either dynamically through a service like Dynamic Host Configuration Protocol (DHCP) or statically through actions of a network administrator. These private network addresses may be used to allow the devices to communicate with each directly over the LAN. Other embodiments may instead use multiple discrete switches, routers and other devices (not shown) to perform more other networking functions in addition to functions as provided by integrated router <b>122</b>.</p>
<p id="p-0046" num="0045">Integrated router <b>122</b> further provides network devices access to a public network, such as the Internet, provided enclosure <b>100</b> has a connection to the public network generally through a cable-modem, DSL modem and an Internet service provider or provider of other public network service. Public networks like the Internet are sometimes referred to as a Wide-Area Network or WAN. In the case of the Internet, a public address is assigned to a specific device allowing the device to be addressed directly by other devices on the Internet. Because these public addresses on the Internet are in limited supply, devices and computers on the private network often use a router device, like integrated router <b>122</b>, to share a single public address through entries in Network Address Translation (NAT) table. The router makes an entry in the NAT table for each communication channel opened between a device on the private network and a device, server, or service on the Internet. A packet sent from a device on the private network initially has a &#x201c;source&#x201d; address containing the private network address of the sending device and a &#x201c;destination&#x201d; address corresponding to the public network address of the server or service on the Internet. As packets pass from within the private network through the router, the router replaces the &#x201c;source&#x201d; address with the public network address of the router and a &#x201c;source port&#x201d; that references the entry in the NAT table. The server on the Internet receiving the packet uses the &#x201c;source&#x201d; address and &#x201c;source port&#x201d; to send packets back to the router on the private network which in turn forwards the packets to the proper device on the private network doing a corresponding lookup on an entry in the NAT table.</p>
<p id="p-0047" num="0046">Entries in the NAT table allow both the computer device <b>124</b> and the thermostat <b>110</b> to establish individual communication channels with a thermostat management system (not shown) located on a public network such as the Internet. In accordance with some embodiments, a thermostat management account on the thermostat management system enables a computer device <b>124</b> in enclosure <b>100</b> to remotely access thermostat <b>110</b>. The thermostat management system passes information from the computer device <b>124</b> over the Internet and back to thermostat <b>110</b> provided the thermostat management account is associated with or paired with thermostat <b>110</b>. Accordingly, data collected by thermostat <b>110</b> also passes from the private network associated with enclosure <b>100</b> through integrated router <b>122</b> and to the thermostat management system over the public network. Other computer devices not in enclosure <b>100</b> such as Smartphones, laptops and tablet computers (not shown in <figref idref="DRAWINGS">FIG. 1</figref>) may also control thermostat <b>110</b> provided they have access to the public network where the thermostat management system and thermostat management account may be accessed. Further details on accessing the public network, such as the Internet, and remotely accessing a thermostat like thermostat <b>110</b> in accordance with embodiments of the present invention is described in further detail later herein.</p>
<p id="p-0048" num="0047">In some embodiments, thermostat <b>110</b> may wirelessly communicate with remote thermostat <b>112</b> over the private network or through an adhoc network formed directly with remote thermostat <b>112</b>. During communication with remote thermostat <b>112</b>, thermostat <b>110</b> may gather information remotely from the user and from the environment detectable by the remote thermostat <b>112</b>. For example, remote thermostat <b>112</b> may wirelessly communicate with the thermostat <b>110</b> providing user input from the remote location of remote thermostat <b>112</b> or may be used to display information to a user, or both. Like thermostat <b>110</b>, embodiments of remote thermostat <b>112</b> may also include sensors to gather data related to occupancy, temperature, light and other environmental conditions. In an alternate embodiment, remote thermostat <b>112</b> may also be located outside of the enclosure <b>100</b>.</p>
<p id="p-0049" num="0048"><figref idref="DRAWINGS">FIG. 2</figref> is a schematic diagram of an HVAC system controlled using a thermostat designed in accordance with embodiments of the present invention. HVAC system <b>120</b> provides heating, cooling, ventilation, and/or air handling for an enclosure <b>100</b>, such as a single-family home depicted in <figref idref="DRAWINGS">FIG. 1</figref>. System <b>120</b> depicts a forced air type heating and cooling system, although according to other embodiments, other types of HVAC systems could be used such as radiant heat based systems, heat-pump based systems, and others.</p>
<p id="p-0050" num="0049">In heating, heating coils or elements <b>242</b> within air handler <b>240</b> provide a source of heat using electricity or gas via line <b>236</b>. Cool air is drawn from the enclosure via return air duct <b>246</b> through filter <b>270</b>, using fan <b>238</b> and is heated through heating coils or elements <b>242</b>. The heated air flows back into the enclosure at one or more locations via supply air duct system <b>252</b> and supply air registers such as register <b>250</b>. In cooling, an outside compressor <b>230</b> passes a gas such as Freon through a set of heat exchanger coils <b>244</b> to cool the gas. The gas then goes through line <b>232</b> to the cooling coils <b>234</b> in the air handler <b>240</b> where it expands, cools and cools the air being circulated via fan <b>238</b>. A humidifier <b>254</b> may optionally be included in various embodiments that returns moisture to the air before it passes through duct system <b>252</b>. Although not shown in <figref idref="DRAWINGS">FIG. 2</figref>, alternate embodiments of HVAC system <b>120</b> may have other functionality such as venting air to and from the outside, one or more dampers to control airflow within the duct system <b>252</b> and an emergency heating unit. Overall operation of HVAC system <b>120</b> is selectively actuated by control electronics <b>212</b> communicating with thermostat <b>110</b> over control wires <b>248</b>.</p>
<p id="p-0051" num="0050">Referring to <figref idref="DRAWINGS">FIG. 3A</figref>, a schematic block diagram provides an overview of some components inside a thermostat in accordance with embodiments of the present invention. Thermostat <b>308</b> is similar to thermostat <b>112</b> in <figref idref="DRAWINGS">FIG. 1</figref> except that thermostat <b>308</b> also illustrates and highlights selected internal components including a Wi-Fi module <b>312</b> and antenna, a head unit processor <b>314</b> with associated memory <b>315</b>, a backplate processor <b>316</b> with associated memory <b>317</b>, and sensors <b>322</b> (e.g., temperature, humidity, motion, ambient light, proximity). In one embodiment, head unit processor <b>314</b> can be a Texas Instruments AM3703 Sitara ARM microprocessor while backplate processor <b>316</b>, which may be more specifically referenced to as a &#x201c;microcontroller&#x201d;, can be a Texas Instruments MSP430F microcontroller. Further details regarding the physical placement and configuration of the thermostat head unit, backplate, and other physical elements are described in the commonly assigned U.S. Ser. No. 13/199,108, supra. Both the head unit processor <b>314</b> and the backplate processor <b>316</b> may be considered &#x201c;processing functions,&#x201d; or more generally &#x201c;circuits.&#x201d; Although the embodiment of <figref idref="DRAWINGS">FIG. 3</figref> includes two processors, the processing function of the thermostat may encompass many other forms of hardware and/or software. By way of example, the processing function may include microprocessors, microcontrollers, field-programmable gate arrays (FPGAs), look-up tables, digital or analog circuit configurations, and/or the like. A processing function or circuit may also include multiple individual hardware components, such as a microprocessor and analog circuitry, two or more microprocessors, a microprocessor and one or more FPGAs, and/or other such arrangements.</p>
<p id="p-0052" num="0051">For some embodiments, the backplate processor <b>316</b> is a very low-power device that, while having some computational capabilities, is substantially less powerful than the head unit processor <b>314</b>. The backplate processor <b>316</b> is coupled to, and responsible for polling on a regular basis, most or all of the sensors <b>322</b> including the temperature and humidity sensors, motion sensors, ambient light sensors, and proximity sensors. For sensors <b>322</b> that may not be located on the backplate hardware itself but rather are located in the head unit, ribbon cables or other electrical connections between the head unit and backplate are provided for this purpose. Notably, there may be other sensors (not shown) for which the head unit processor <b>314</b> is responsible, with one example being a ring rotation sensor that senses the user rotation of an outer ring of the thermostat. Each of the head unit processor <b>314</b> and backplate processor <b>316</b> is capable of entering into a &#x201c;sleep&#x201d; state, and then &#x201c;waking up&#x201d; to perform various tasks.</p>
<p id="p-0053" num="0052">The backplate processor <b>316</b>, which in some embodiments will have a low-power sleep state that corresponds simply to a lower clock speed, generally enters into and out of its sleep mode substantially more often than does the more powerful head unit processor <b>314</b>. The backplate processor <b>316</b> is capable of waking up the head unit processor <b>314</b> from its sleep state. For one embodiment directed to optimal battery conservation, the head unit processor <b>314</b> is allowed to sleep when its operations are not being called for, while the backplate processor <b>316</b> performs polling of the sensors <b>322</b> on an ongoing basis, maintaining the sensor results in memory <b>317</b>. The backplate processor <b>316</b> will wake up the head unit processor <b>314</b> in the event that (i) the sensor data indicates that an HVAC operation may be called for, such as if the current temperature goes below a currently active heating setpoint, or (ii) the memory <b>317</b> gets full and the sensor data needs to be transferred up to the head unit processor <b>314</b> for storage in the memory <b>315</b>. The sensor data can then be pushed up to the cloud server (thermostat management server) during a subsequent active communication session between the cloud server and the head unit processor <b>314</b>.</p>
<p id="p-0054" num="0053">By way of example, the head unit processor <b>314</b> can draw on the order of 250 mW when awake and processing. Other controller functions, such as an LCD module, can draw on the order of 250 mW when active. Moreover, the Wi-Fi module <b>312</b> can draw 250 mW when active, and needs to be active on a consistent basis such as at a consistent 2% duty cycle in some scenarios. However, in order to avoid falsely tripping the HVAC relays for a large number of commercially used HVAC systems, power-stealing circuitry is often limited to power providing capacities on the order of 100 mW-200 mW, which would not be enough to supply the needed power for many common scenarios. Table 1 shows how the total system power consumption of an example embodiment might be calculated.</p>
<p id="p-0055" num="0054">
<tables id="TABLE-US-00001" num="00001">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="6">
<colspec colname="1" colwidth="35pt" align="left"/>
<colspec colname="2" colwidth="35pt" align="center"/>
<colspec colname="3" colwidth="42pt" align="center"/>
<colspec colname="4" colwidth="28pt" align="center"/>
<colspec colname="5" colwidth="35pt" align="center"/>
<colspec colname="6" colwidth="42pt" align="center"/>
<thead>
<row>
<entry namest="1" nameend="6" rowsep="1">TABLE 1</entry>
</row>
<row>
<entry namest="1" nameend="6" align="center" rowsep="1"/>
</row>
<row>
<entry/>
<entry/>
<entry/>
<entry>Timer</entry>
<entry/>
<entry>Ave.</entry>
</row>
<row>
<entry/>
<entry/>
<entry>Time in</entry>
<entry>per</entry>
<entry/>
<entry>Power per</entry>
</row>
<row>
<entry>Mode</entry>
<entry>Power</entry>
<entry>mode</entry>
<entry>day</entry>
<entry>%</entry>
<entry>24 h</entry>
</row>
<row>
<entry namest="1" nameend="6" align="center" rowsep="1"/>
</row>
</thead>
<tbody valign="top">
<row>
<entry/>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="6">
<colspec colname="1" colwidth="35pt" align="left"/>
<colspec colname="2" colwidth="35pt" align="center"/>
<colspec colname="3" colwidth="42pt" align="center"/>
<colspec colname="4" colwidth="28pt" align="char" char="."/>
<colspec colname="5" colwidth="35pt" align="center"/>
<colspec colname="6" colwidth="42pt" align="center"/>
<tbody valign="top">
<row>
<entry>Interactive</entry>
<entry>300 mW</entry>
<entry>60 s</entry>
<entry>4</entry>
<entry>0.28%</entry>
<entry>0.83 mW</entry>
</row>
<row>
<entry>Active</entry>
<entry>200 mW</entry>
<entry>10 s</entry>
<entry>192</entry>
<entry>2.22%</entry>
<entry>4.44 mW</entry>
</row>
<row>
<entry>Standby</entry>
<entry>&#x2002;11 mW</entry>
<entry>84,240 s&#x2003;&#x2002;&#x2009;</entry>
<entry>1</entry>
<entry>97.50%&#x2002;</entry>
<entry>10.73 mW&#x2002;</entry>
</row>
<row>
<entry/>
<entry/>
<entry/>
<entry/>
<entry>Ave</entry>
<entry>&#x2002;&#x2009;16 mW</entry>
</row>
<row>
<entry/>
<entry/>
<entry/>
<entry/>
<entry>Power:</entry>
</row>
<row>
<entry namest="1" nameend="6" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0056" num="0055">As can be seen from Table 1, the dominant power is that of standby, though waking the head unit 8 times per hour (192 times per day) is also not insignificant. Switching each HVAC zone also takes power, estimated at &#x2dc;1 mA @ 3.3v. One embodiment may be likely to be switching multiple circuits concurrently. This can significantly increase the power consumption and hence should also be optimized appropriately. In one embodiment, the processing functions may use more than 250 mW in the operating mode. In another embodiment, the processing functions may use more than 200 mW in the operating mode. In another embodiment, the processing functions may use more than 150 mW in the operating mode. In another embodiment, the processing functions may use less than 150 mW in the sleep mode. In another embodiment, the processing functions may use less than 100 mW in the sleep mode. Finally, in another embodiment, the processing functions may use less than 75 mW in the sleep mode.</p>
<p id="p-0057" num="0056">As used herein, the term &#x201c;network-communication module&#x201d; may include all forms of hardware and software used to communicate between the controller and a network. For example, a network-communication module may include the Wi-Fi module <b>312</b> in this embodiment, as well as a cellular network interface, an Ethernet adapter, a LAN adapter, a Bluetooth interface, and/or any other type of wired or wireless interface with a network. In the case of Wi-Fi module <b>312</b>, one embodiment may be implemented using Murata Wireless Solutions LBWA19XSLZ module, which is based on the Texas Instruments WL1270 chipset supporting the 802.11b/g/n WLAN standard. Embodiments of the present invention configure and program Wi-Fi module <b>312</b> to allow thermostat <b>308</b> to enter into a low power or &#x201c;sleep&#x201d; mode to conserve energy until one or several events occurs. For example, in some embodiments the Wi-Fi module <b>312</b> may leave this low power mode when a user physically operates thermostat <b>308</b>, which in turn may also cause activation of both head-unit processor <b>314</b> and backplate processor <b>316</b> for controlling functions in head-unit and backplate portions of thermostat <b>110</b>.</p>
<p id="p-0058" num="0057">It is also possible for Wi-Fi module <b>312</b> to wake from a low power mode at regular intervals in response to a beacon from wireless access point <b>324</b>. To conserve energy, Wi-Fi module <b>312</b> may briefly leave the low power mode to acknowledge the beacon as dictated by the appropriate wireless standard and then return to a low power mode without activating the processors or other components of thermostat <b>308</b> in <figref idref="DRAWINGS">FIG. 3A</figref>. In an alternative embodiment, Wi-Fi module <b>312</b> may also respond to the beacon by awaking briefly and then activating backplate processor <b>316</b>, head unit processor <b>314</b>, or other portions of thermostat <b>308</b> to gather data through sensors <b>322</b> and store the results in a data log <b>326</b> with a time stamp, event type and corresponding data listed for future reference. In accordance with one embodiment, backplate processor <b>316</b> may collect data in data log <b>326</b> and store in memory <b>320</b> for a period of time or until the log reaches a maximum predetermined size. At that point, the backplate processor <b>316</b> may wake head unit processor <b>314</b> to coordinate an upload of the data log <b>326</b> stored in memory <b>320</b> over a public network, such as the Internet, to cloud-based management server <b>516</b>. Uploading data log <b>326</b> less frequently saves time and energy associated with more frequent transmission of individual records or log entries.</p>
<p id="p-0059" num="0058">In yet another embodiment, Wi-Fi module <b>312</b> may selectively filter an incoming data packet to determine if the header is merely an acknowledgement packet (i.e., a keep-alive packet) or contains a payload that needs further processing. If the packet contains only a header and no payload, the Wi-Fi module <b>312</b> may be configured to either ignore the packet or send a return acknowledgement to the thermostat management system or other source of the packet received.</p>
<p id="p-0060" num="0059">In further embodiments, Wi-Fi module <b>312</b> may be used to establish multiple communication channels between thermostat <b>112</b> and a cloud-based management server as will be described and illustrated later in this disclosure. As previously described, thermostat <b>112</b> uses the multiple communication channels to receive different types of data classified with different levels of priority. In one embodiment, Wi-Fi module <b>312</b> may be programmed to use one or more filters and a wake-on-LAN feature to then selectively ignore or discard data arriving over one or more of these communication channels. For example, low-priority data arriving over a port on Wi-Fi module <b>312</b> may be discarded by disabling the corresponding wake-on-LAN feature associated with the port. This allows the communication channel to continue to operate yet conserves battery power by discarding or ignoring the low-priority packets.</p>
<p id="p-0061" num="0060">Operation of the microprocessors <b>314</b>, <b>316</b>, Wi-Fi module <b>312</b>, and other electronics may be powered by a rechargeable battery (not shown) located within the thermostat <b>110</b>. In some embodiments, the battery is recharged directly using 24 VAC power off a &#x201c;C&#x201d; wire drawn from the HVAC system or an AC-DC transformer coupled directly into the thermostat <b>110</b>. Alternatively, one or more different types of energy harvesting may also be used to recharge the internal battery if these direct methods are not available as described, for example, in U.S. Ser. No. 13/034,678, supra, and U.S. Ser. No. 13/267,871, supra. Embodiments of the present invention communicate and operate the thermostat <b>110</b> in a manner that promotes efficient use of the battery while also keeping the thermostat operating at a high level of performance and responsiveness controlling the HVAC system. Some embodiments may use the battery-level charge and the priority or relative importance of a communication to determine when a thermostat management system located on a public network such as the Internet may communicate with the thermostat <b>110</b>. Further details on the communication methods and system used in accordance with these embodiments are described in detail later herein.</p>
<p id="p-0062" num="0061">Turning now to power harvesting methods and systems, <figref idref="DRAWINGS">FIG. 3B</figref> is a block diagram of some circuitry of a thermostat, according to some embodiments. Circuitry <b>300</b>, according to some embodiments, is a backplate of a thermostat. A number of HVAC wires can be attached using HVAC terminals <b>372</b>. One example of which is the W<b>1</b> terminal <b>374</b>. Each terminal is used to control an HVAC function. According to some embodiments, each of the wires from the terminals W<b>1</b>, W<b>2</b>, Y<b>1</b>, Y<b>2</b>, G, O/B, AUX and E is connected to separate isolated FET drives <b>370</b>. The common HVAC functions for each of the terminals are: W<b>1</b> and W<b>2</b> heating; Y<b>1</b> and Y<b>2</b> for cooling; G for fan; O/B for heatpumps; and E for emergency heat. Note that although the circuitry <b>300</b> is able control <b>8</b> functions using the isolated FET drives <b>370</b>, according to some embodiments, other functions, or fewer functions can be controlled. For example circuitry for a more simply equipped HVAC system may only have a single heating (W), and single cooling (Y) and a fan (G), in which case there would only be three isolated FET drives <b>370</b>. According to an embodiment, 5 FET drives <b>370</b> are provided, namely heating (W), cooling (Y), fan (G), auxiliary (AUX) and compressor direction (O/B). Not shown are the circuit returns such as RH (return for heat) and RC (return for cooling). According to some embodiments the thermostat can control a humidifier and/or de-humidifier. Further details relating to isolated FET drives <b>370</b> are described in co-pending U.S. patent application Ser. No. 13/034,674, entitled &#x201c;Thermostat Circuitry for Connection to HVAC Systems,&#x201d; supra, which is incorporated herein by reference.</p>
<p id="p-0063" num="0062">The HVAC functions are controlled by the HVAC control general purpose input/outputs (GPIOs) <b>322</b> within microcontroller (MCU) <b>320</b>. MCU <b>320</b> is a general purpose microcontroller such as the MSP430 16-bit ultra-low power MCU available from Texas Instruments. MCU <b>320</b> communicates with the head unit via Head Unit Interface <b>340</b>. The head unit together with the backplate make up the thermostat. The head unit has user interface capability such that it can display information to a user via an LCD display and receive input from a user via buttons and/or touch screen input devices. According to some embodiments, the head unit has network capabilities for communication to other devices either locally or over the internet. Through such network capability, for example, the thermostat can send information and receive commands and setting from a computer located elsewhere inside or outside of the enclosure. The MCU detects whether the head unit is attached to the backplate via head unit detect <b>338</b>.</p>
<p id="p-0064" num="0063">Clock <b>342</b> provides a low frequency clock signal to MCU <b>320</b>, for example 32.768 kHz. According to some embodiments there are two crystal oscillators, one for high frequency such as 16 MHz and one for the lower frequency. Power for MCU <b>320</b> is supplied at power input <b>344</b> at 3.0 V. Circuitry <b>336</b> provides wiring detection, battery measurement, and buck input measurement. A temperature sensor <b>330</b> is provided, and according to some embodiments and a humidity sensor <b>332</b> are provided. According to some embodiments, one or more other sensors <b>334</b> are provided such as: pressure, proximity (e.g. using infrared), ambient light, and pyroelectric infrared (PIR).</p>
<p id="p-0065" num="0064">Power circuitry <b>350</b> is provided to supply power. According to some embodiments, when the thermostat is first turned on with insufficient battery power, a bootstrap power system is provided. A high voltage low dropout voltage regulator (LDO) <b>380</b> provides 3.0 volts of power for the bootstrap of the MCU <b>320</b>. The bootstrap function can be disabled under MCU control but according to some embodiments the bootstrap function is left enabled to provide a &#x201c;safety net&#x201d; if the head unit supply vanishes for any reason. For example, if the head-unit includes the re-chargeable battery <b>384</b> and is removed unexpectedly, the power would be lost and the bootstrap function would operate. The input to this Bootstrap LDO <b>380</b> is provided by connectors and circuitry <b>368</b> that automatically selects power from common <b>362</b> (highest priority), cool <b>366</b> (lower priority); or heat (lowest priority) <b>364</b>.</p>
<p id="p-0066" num="0065">In normal operation, a 3.0 volt primary LDO <b>382</b> powers the backplate circuitry and itself is powered by VCC Main. According to some embodiments, high voltage buck <b>360</b> is provided as a second supply in the backplate. The input to this supply is the circuitry <b>368</b>. According to some embodiments, the high voltage buck <b>380</b> can supply a maximum of 100 mA at 4.5v. According to some embodiments, the VCC main and the Primary LDO <b>382</b> can be powered by a rechargeable battery (shown in <figref idref="DRAWINGS">FIG. 7</figref>) in cases where there is no alternative power source (such as the high voltage buck or USB power, for example).</p>
<p id="p-0067" num="0066"><figref idref="DRAWINGS">FIGS. 4A-4C</figref> schematically illustrate the use of auto-switching connectors being used to automatically select a source for power harvesting, according to some embodiments. The connectors <b>362</b>, <b>364</b>, and <b>366</b> are connectors as shown in <figref idref="DRAWINGS">FIG. 3</figref>. For further details regarding automatically switching connectors, see co-pending U.S. patent application Ser. No. 13/034,666, entitled &#x201c;Thermostat Wiring Connector&#x201d; incorporated herein by reference. The connector <b>362</b> is used for connection to an HVAC &#x201c;C&#x201d; (common) wire and includes two switched pairs of normally closed secondary conductors <b>410</b> and <b>412</b>. The connector <b>366</b> is used for connection to an HVAC &#x201c;Y&#x201d; (cooling) wire and includes one switched pair of normally closed secondary conductors <b>454</b>. The connector <b>364</b> is used for connection to an HVAC &#x201c;W&#x201d; (heating) wire. Note that although not shown in <figref idref="DRAWINGS">FIGS. 4A-C</figref>, one or more additional pairs of switched secondary conductors can be provided with any of the connectors <b>362</b>, <b>366</b> and <b>365</b>, such as could be used for the purpose of electronically detecting the presence of an HVAC system wire to the connector. Power harvesting circuitry <b>460</b> is used to supply power to the thermostat and is also connected to the Rc wire <b>462</b> (or according to other embodiment the Rh wire). For example, the power harvesting circuitry <b>460</b> can include the HV buck <b>360</b> and Bootstrap LDO <b>380</b> as shown in and described with respect to FIGS. <b>3</b> and <b>6</b>A-B.</p>
<p id="p-0068" num="0067"><figref idref="DRAWINGS">FIG. 4A</figref> shows the case of the switches <b>454</b>, <b>410</b> and <b>412</b> when no C wire and no Y wire is attached. In this case all of the switches <b>454</b>, <b>410</b> and <b>412</b> are closed and the power harvesting circuitry <b>460</b> is connected at input <b>464</b> with the W wire via circuit paths <b>420</b>, <b>422</b> and <b>426</b>. <figref idref="DRAWINGS">FIG. 4B</figref> shows the case of the switches <b>454</b>, <b>410</b> and <b>412</b> when no C wire is attached but there is a Y wire attached. In this case switches <b>410</b> and <b>412</b> are closed but switch <b>454</b> is opened due to the presence of the Y wire. In this case the power harvesting circuitry <b>460</b> is connected at input <b>464</b> with the Y wire via circuit paths <b>424</b> and <b>428</b>. <figref idref="DRAWINGS">FIG. 4C</figref> shows the case of the switches <b>454</b>, <b>410</b> and <b>412</b> when both C and Y wires are attached. In this case all the switches <b>454</b>, <b>410</b> and <b>412</b> are open and the power harvesting circuitry <b>460</b> is connected at input <b>464</b> with the C wire via circuit path <b>430</b>. Note that the case of a connection of C and W wires and no Y wire is not shown but that in this case the W wire would not be connected to circuitry <b>420</b> since switch <b>410</b> would be open. Thus, through the use of circuitry and the connectors shown, the power harvesting circuitry is automatically switched so as to use connections to C, Y and W wires in decreasing order of priority. In one embodiment, the C wire is the highest priority as this ordinarily provides the best power source, if available. Note that according to some embodiments, the Y and W priorities are reversed to make W higher priority than Y.</p>
<p id="p-0069" num="0068"><figref idref="DRAWINGS">FIG. 5</figref> is a schematic of a half-bridge sense circuit, according to some embodiments. Circuit <b>500</b> provides voltage sensing, clipped to 3.0 volts, for presence detection and current sensing. At inputs <b>502</b>, <b>504</b> and <b>506</b> are the 24 VAC waveforms from three of the HVAC circuits. In the case shown in <figref idref="DRAWINGS">FIG. 5</figref>, inputs <b>502</b>, <b>504</b> and <b>506</b> are for HVAC W<b>1</b>, HVAC Y<b>1</b> and HVAC G, respectively. The sense input bias buffer <b>550</b> is provided as shown. Note that a voltage divider is used in each case that takes the voltage from 24 volts to approximately 4 volts. Clamp diodes <b>520</b><i>a</i>, <b>520</b><i>b </i>and <b>520</b><i>c </i>ensure that the voltage goes no higher or lower than the range of the microcontroller <b>320</b> (shown in <figref idref="DRAWINGS">FIG. 3</figref>). The Sense outputs <b>530</b>, <b>532</b> and <b>534</b> are connected to the microcontroller <b>320</b> so that the microcontroller <b>320</b> can sense the presence of a signal on the HVAC lines. The circuits are repeated for the other HVAC lines so that the microcontroller can detect signals on any of the HVAC lines.</p>
<p id="p-0070" num="0069"><figref idref="DRAWINGS">FIGS. 6A-B</figref> are schematics showing the high voltage buck, bootstrap LDO and battery LDO power circuitry, according to some embodiments. The circuitry in <figref idref="DRAWINGS">FIG. 6A-FIG</figref>. <b>6</b>B may be part of a power manager. As used herein, the term &#x201c;power manager&#x201d; may include any systems, subsystems, circuitry, inputs, connections, and/or devices that may be used to manage the power supplied to the rest of the controller. <figref idref="DRAWINGS">FIG. 6A</figref> shows the input <b>464</b> from the connector selected power, which corresponds to input <b>464</b> to power circuitry <b>460</b> in <figref idref="DRAWINGS">FIG. 4</figref>. The diodes <b>632</b> are used to rectify the AC power signal from the HVAC power transformer wire that is selected by the connector circuitry shown in <figref idref="DRAWINGS">FIG. 4</figref>. When the thermostat is installed in a building having two HVAC power transformers, such as may be the case when an existing HVAC heating-only system is upgraded to add an HVAC cooling system. In such cases, there are two power wires from the HVAC system, often called &#x201c;Rh&#x201d; the power wire directly from the heating system transformer, and &#x201c;Rc&#x201d; the power wire directly from the cooling transformer. Input <b>462</b> is from a terminal connected to the Rc wire. According to some embodiments, the Rc and Rh terminals are switched using automatic switching or other jumperless design, as shown and described in co-pending U.S. patent application Ser. No. 13/034,674, entitled &#x201c;Thermostat Circuitry for Connection to HVAC Systems,&#x201d; filed on even date herewith and which is incorporated herein by reference.</p>
<p id="p-0071" num="0070">Rectified input <b>624</b> is input to the high voltage buck circuit <b>610</b>, according to some embodiments. In buck circuit <b>610</b>, which corresponds to high voltage buck <b>360</b> in <figref idref="DRAWINGS">FIG. 3</figref>, the voltage on the input capacitors <b>612</b>, <b>614</b> and <b>616</b> of high voltage buck <b>610</b> can be measured by the MCU <b>320</b> (of <figref idref="DRAWINGS">FIG. 3</figref>) at node <b>620</b>, allowing the MCU to momentarily open the W<b>1</b> or Y<b>1</b> contacts during an &#x201c;enabled&#x201d; or &#x201c;on&#x201d; phase in order to recharge the buck input capacitors <b>612</b>, <b>614</b> and <b>616</b> and continue power harvesting. According to some embodiments, the same HVAC circuit (e.g. heating or cooling) is used for power harvesting, whether or not there is more than one HVAC function in the system. According to some other embodiments, when the thermostat is used with an HVAC system having two circuits (e.g. heating and cooling), the system will power harvest from the non-activated circuit. In cases where a common wire is available from the HVAC power transformer, the system might not power harvest at all from the heating and cooling circuits. According to some embodiments, the step down converter <b>630</b> is a high efficiency, high voltage 100 mA synchronous step-down converter such as the LTC3631 from Linear Technology. According to some embodiments, inductor <b>642</b> is a 100 uH power inductor such as the MOS6020 from Coilcraft. According to some embodiments, one or more other types of elements in addition to or instead of input capacitors <b>612</b>, <b>614</b> and <b>616</b> are used to store electrical energy during power harvesting when the HVAC function is active (or &#x201c;on&#x201d;). For example, magnetic elements such as inductors and/or transformers can be used.</p>
<p id="p-0072" num="0071">In order to control the HVAC functions, the HVAC function wire is shorted to the return or power wire. For example, in the case of heating, the W wire is shorted to the Rh (or R or Rc depending on the configuration). In the case of cooling the Y wire is shorted to the Rc (or R or Rh depending on the configuration). By shorting these two wires, the 24 VAC transformer is placed in series with a relay that controls the HVAC function. However, for power harvesting, a problem is that when these wires are shorted, there is no voltage across them, and when open, there is no current flow. Since power equals voltage multiplied by current, if either quantity is zero the power that can be extracted is zero. According to some embodiments, the power harvesting circuitry allows power to be taken from the two wires in both the states of HVAC&#x2014;the HVAC &#x201c;on&#x201d; and the HVAC &#x201c;off&#x201d;.</p>
<p id="p-0073" num="0072">In the HVAC &#x201c;off&#x201d; state, some energy can be harvested from these two wires by taking less energy than would cause the of the relay to turn on, which would cause the HVAC function to erroneously turn on. Based on testing, it has been found that HVAC functions generally do not turn on when (0.040 A*4.5V)=0.180 watts is extracted at the output. So after the input diodes, capacitors, and switching regulator, this allows us to take 40 mA at 4.5 volts from these wires without turning on the HVAC system.</p>
<p id="p-0074" num="0073">In the HVAC &#x201c;on&#x201d; state, the two wires must be connected together to allow current to flow, which turns on the HVAC relay. This, however, shorts out the input supply, so our system does not get any power when the HVAC &#x201c;on&#x201d; switch is closed. To get around this problem, the voltage is monitored on the capacitors <b>612</b>, <b>614</b> and <b>616</b> at the input switching power supply node <b>620</b>. When the voltage on these capacitors &#x201c;C<sub>in</sub>&#x201d; drops close to the point at which the switching power supply would &#x201c;Drop out&#x201d; and lose output regulation, for example at about +8 Volts, the HVAC &#x201c;on&#x201d; switch is turned off and C<sub>in </sub>is charged. During the time that C<sub>in </sub>is charging, current is still flowing in the HVAC relay, so the HVAC relay stays on. When the C<sub>in </sub>capacitor voltages increases some amount, for example about +16 Volts, the HVAC &#x201c;on&#x201d; switch is closed again, C<sub>in </sub>begins to discharge while it feeds the switching regulator, and current continues to flow in the HVAC relay. Note that C<sub>in </sub>is not allowed to discharge back to the HVAC &#x201c;on&#x201d; switch due to input diodes <b>632</b>. When the voltage on C<sub>in </sub>drops to about +8 Volts the HVAC &#x201c;on&#x201d; switch is turned off and the process repeats. This continues until the system tells the HVAC &#x201c;on&#x201d; switch to go off because HVAC is no longer needed. According to some embodiments, the ability of the HVAC &#x201c;on&#x201d; switch to turn on and off relatively quickly is provided by circuitry <b>450</b> as shown in and described with respect to <figref idref="DRAWINGS">FIG. 4</figref> of co-pending U.S. patent application Ser. No. 13/034,674, entitled &#x201c;Thermostat Circuitry for Connection to HVAC Systems,&#x201d; supra, which is incorporated herein by reference.</p>
<p id="p-0075" num="0074">According to some embodiments, one or more alternative power harvesting techniques are used. For example, rather than having the HVAC &#x201c;on&#x201d; switch turn on when the voltage on C<sub>in </sub>reaches a certain point, it the system might turn off the &#x201c;HVAC &#x201c;on&#x201d; switch for a predetermined period of time instead. According to some embodiments, power harvesting is enhanced by synchronizing the power harvesting with the AC current waveform.</p>
<p id="p-0076" num="0075"><figref idref="DRAWINGS">FIG. 6B</figref> is a schematic of high voltage low dropout voltage regulators used to provide bootstrap power and battery, according to some embodiments. The bootstrap LDO circuitry <b>680</b>, and battery LDO circuitry correspond to the bootstrap LDO <b>380</b> and battery LDO <b>382</b> in <figref idref="DRAWINGS">FIG. 3</figref> respectively. Rectified input <b>624</b> is input to bootstrap circuit <b>680</b>. According to some embodiments, regulator <b>670</b> is low-dropout linear regulator such as the TPS79801 from Texas Instruments. The output power <b>690</b> is provided to the backplate at 3.0V. The bootstrap disable signal <b>680</b> can be used to disable the bootstrap power unit, as shown. The input <b>660</b> comes from VCC main, which can be, for example, from the rechargeable battery. According to some embodiments, the low dropout regulator <b>662</b> is a low quiescent current device designed for power-sensitive applications such as the TLV70030 from Texas Instruments.</p>
<p id="p-0077" num="0076"><figref idref="DRAWINGS">FIG. 6C</figref> shows a battery charging circuit <b>675</b> and rechargeable battery, according to some embodiments. The charger <b>673</b> is used to charge the lithium-ion battery <b>650</b>. In general, li-ion battery capacity depends on what voltage the battery is charged to, and the cycle life depends on the charged voltage, how fast the battery is charged and the temperature during which the battery is charged. Ordinarily, Li-ion batteries are charged at about 4.2V. In some cases the charging voltage is even higher in an attempt to gain greater capacity, but at the expense of decreased cycle life. However, in the case of the rechargeable battery <b>650</b> for use with a wall-mounted thermostat, a greater cycle life may be preferred over capacity. High capacity is generally not needed since charging power is available via the power harvesting circuitry, and greater cycle life may be preferred since user replacement may be difficult or unavailable. Thus, according to some embodiments, a low charging speed, low final float voltage and reduced charging temperature range may be preferred. According to some embodiments, a final float voltage of between 3.9V and 4.1V is used. According to some embodiments a final float voltage of less than 4.0V is used, such as 3.95V. According to some embodiments, the ratio of charge current to total capacity &#x201c;C&#x201d; is also controlled, such as charging the battery to 0.2C (0.2 times the rated capacity) to provide better cycle life than a higher ratio. According to some embodiments, using a lower charging current aids in avoiding unintended tripping of the HVAC relay.</p>
<p id="p-0078" num="0077">Although the embodiment illustrated in <figref idref="DRAWINGS">FIG. 6C</figref> uses a lithium-ion battery <b>750</b> as a power supply, other embodiments are not so limited. Other embodiments may use various power-storage modules that may be configured to store energy and provide energy to the rest of the controller. As used herein, the terms &#x201c;power-storage module&#x201d; and &#x201c;power supply&#x201d; may include many different configurations for providing and storing energy. By way of example, a power-storage module or power supply may include lithium-ion batteries and other forms of primary and secondary cell batteries, inductors, capacitors, and other energy-storage circuit elements.</p>
<p id="p-0079" num="0078">Generally, the power supply or power-storage module may receive energy from another source and then store that energy for use by the controller. This process of providing energy to the power supply or power-storage module may be called &#x201c;charging&#x201d; or &#x201c;recharging;&#x201d; however, it may also include all forms of providing energy, such as providing charge to capacitors, charging a secondary cell battery, or providing current to an inductor. This energy may be stored in the form of a magnetic or electric field, and/or in a battery cell. The source of the energy provided to the power supply or power-storage module may be sourced from any external power supply. The embodiment in <figref idref="DRAWINGS">FIG. 6C</figref> illustrates harvesting electrical power from an HVAC system; however, it will be understood that any source of energy may be used by a power manager, whether internal or external.</p>
<p id="p-0080" num="0079">According to some embodiments, charger <b>673</b> is a USB power manager and li-ion battery charger such as the LTC4085-3 from Linear Technology. Backplate voltage <b>671</b> is input to charger <b>673</b>. The circuitry <b>672</b> is used to select the charging current. In particular the value of resistor 674 (24.9 k) in parallel with resistor 634 (16.9 k) in combination with the inputs Double Current <b>638</b> and High Power <b>628</b> are used to select the charging current. If High Power <b>628</b> and Double Current <b>638</b> are both set to 0, then the charging current is 8.0 mA; if the High Power <b>628</b> is set to 0 and Double Current <b>638</b> is set to 1, then the charging current is 19.9 mA; if the High Power <b>628</b> is set to 1 and Double Current <b>638</b> is set to 0, then the charging current is 40.1 mA; and if the High Power <b>628</b> and Double Current <b>638</b> are both set to 1, then the charging current is 99.3 mA. Resistor <b>636</b> is used to set the default charge current. In the case shown, a 220 k resistor set the default charge current to 227 mA. According to some embodiments, a charge temperature range of 0-44 degrees C. is set via the Thermistor Monitoring Circuits.</p>
<p id="p-0081" num="0080">According to some embodiments, the thermostat is capable of being powered by a USB power supply. This could be supplied by a user, for example, by attaching the thermostat via a USB cable to a computer or another USB power supply. In cases there a USB power supply is available, it is selected as the preferred power source for the thermostat and can be used to recharge the rechargeable battery. According to some embodiments, a charge current of about 227 mA is used when a USB supply source is available; a charge current of about 100 mA is used when an HVAC common wire is present; and a charge current of between about 20-40 mA is used when power is harvested from an HVAC heating and/or cooling circuit.</p>
<p id="p-0082" num="0081"><figref idref="DRAWINGS">FIG. 7</figref> illustrates thermostats and computers on a private network <b>702</b> connected to a cloud-based management server <b>716</b> designed in accordance with aspects of the present invention. In one embodiment, private network <b>702</b> is designed to provide network connectivity primarily within and near an enclosure, such as enclosure <b>100</b> in <figref idref="DRAWINGS">FIG. 1</figref>, connecting various devices together such a Smartphone <b>708</b>, tablet <b>710</b>, computer <b>712</b>, thermostat <b>110</b> and remote thermostat <b>112</b>. A router (not shown) in private network <b>702</b>, such as integrated router <b>122</b> in <figref idref="DRAWINGS">FIG. 1</figref>, provides wired and wireless connectivity between these devices using a network protocol such as TCP/IP. In one embodiment, thermostat <b>110</b> and remote thermostat <b>112</b> are connected wirelessly to private network <b>702</b> as a wired connection in the vicinity of the thermostats may not available and/or it is undesirable to include a wired connection socket on thermostat <b>110</b> or remote thermostat <b>112</b>.</p>
<p id="p-0083" num="0082">Thermostat access client <b>714</b> is a client application designed in accordance with aspects of the present invention to access a cloud-based management server <b>716</b> over public network <b>704</b>. The term &#x201c;thermostat management system&#x201d; can be interchangeably referenced as a &#x201c;cloud-based management server&#x201d; for the thermostats, or more simply &#x201c;cloud server&#x201d;, in various descriptions hereinabove and hereinbelow. Because thermostat access client <b>714</b> is designed to execute on different devices, multiple client applications may be developed using different technologies based on the requirements of the underlying device platform or operating system. For some embodiments, thermostat access client <b>714</b> is implemented such that end users operate their Internet-accessible devices (e.g., desktop computers, notebook computers, Internet-enabled mobile devices, cellphones having rendering engines, or the like) that are capable of accessing and interacting with the cloud-based management server <b>716</b>. The end user machine or device has a web browser (e.g., Internet Explorer, Firefox, Chrome, Safari) or other rendering engine that, typically, is compatible with AJAX technologies (e.g., XHTML, XML, CSS, DOM, JSON, and the like). AJAX technologies include XHTML (Extensible HTML) and CSS (Cascading Style Sheets) for marking up and styling information, the use of DOM (Document Object Model) accessed with client-side scripting languages, the use of an XMLHttpRequest object (an API used by a scripting language) to transfer XML and other text data asynchronously to and from a server using HTTP), and use of XML or JSON (Javascript Object Notation, a lightweight data interchange format) as a format to transfer data between the server and the client. In a web environment, an end user accesses the site in the usual manner, i.e., by opening the browser to a URL associated with a service provider domain. The user may authenticate to the site (or some portion thereof) by entry of a username and password. The connection between the end user entity machine and the system may be private (e.g., via SSL). The server side of the system may comprise conventional hosting components, such as IP switches, web servers, application servers, administration servers, databases, and the like. Where AJAX is used on the client side, client side code (an AJAX shim) executes natively in the end user's web browser or other rendering engine. Typically, this code is served to the client machine when the end user accesses the site, although in the alternative it may be resident on the client machine persistently. Finally, while a web-based application over Internet Protocol (IP) is described, this is not a limitation, as the techniques and exposed user interface technologies may be provided by a standalone application in any runtime application, whether fixed line or mobile. It is to be appreciated that although the TCP/IP protocol is set forth as the network protocol used for communications among the cloud-based management server <b>716</b>, the thermostat access client <b>714</b>, and other devices for some embodiments, it is set forth by way of example and not by way of limitation, with the use of any other suitable protocol, such as UDP over IP in particular, may be used without departing from the scope of the present teachings. In yet another embodiment, thermostat access client <b>714</b> may be a stand-alone application or &#x201c;app&#x201d; designed to be downloaded and run on a specific device such Smartphone <b>708</b> or table <b>710</b> device running the Apple iOS operating system, Google Android operating system or others.</p>
<p id="p-0084" num="0083">It is to be appreciated that the embodiments described herein, while advantageously providing battery-conscious methods for reliable communication of thermostatically related data between the thermostats <b>110</b>/<b>112</b> and the cloud-based management server <b>716</b>, are also advantageously configured to be compatible with a large variety of conventional integrated routers that service a large population of homes and businesses. Thus, by way of example only and not by way of limitation, the router (not shown) that services the private network <b>702</b> can be, for example, a D-Link DIR-655 Extreme N Wireless Router, a Netgear WNDR3700 RangeMax Dual Band Wireless USB Gigabit Router, a Buffalo Technology Nfiniti WZR-HP-G300NH Wireless-N Router, an Asus RT-N16 Wireless Router, Cisco Linksys E4200 Dual Band Wireless Router, or a Cisco Linksys E4200 Dual Band Wireless Router.</p>
<p id="p-0085" num="0084">In one embodiment, cloud-based management server <b>716</b> illustrated in <figref idref="DRAWINGS">FIG. 7</figref> may be accessed over public network <b>704</b> by computer devices on private network <b>702</b> running thermostat access client <b>714</b>. Thermostat access client <b>714</b> may also execute or run on a computer device such as tablet <b>706</b> directly connected to the public network <b>704</b>. In one embodiment, each thermostat access client <b>714</b> has access to a thermostat management account (not illustrated) on cloud-based management server <b>716</b> which allows thermostat access client <b>714</b> to interact with thermostat <b>110</b> or remote thermostat <b>112</b> in a variety of different ways. In some embodiments, thermostat access client <b>714</b> may be used to access sensor data previously collected from thermostat <b>110</b> and remote thermostat <b>112</b> then stored on cloud-based management server <b>716</b>. In other embodiments, for example, thermostat access client <b>714</b> may be used to either remotely control or remotely configure thermostat <b>110</b>. Thermostat access client <b>714</b> may also gather other information on thermostat <b>110</b> or remote thermostat <b>112</b> including a battery-level readings, firmware update levels, diagnostic data, or any other data exposed by the thermostats to thermostat access client <b>714</b>.</p>
<p id="p-0086" num="0085">Each of the thermostat <b>110</b> and remote thermostat <b>112</b> also communicate with cloud-based management server <b>716</b> through one or several communication channels established through public network <b>704</b>. Like other devices on the private network <b>702</b>, thermostat <b>110</b> and remote thermostat <b>112</b> do not have a public network address and therefore cannot communicate directly on the Internet or other public network without the assistance of the router and corresponding entries in NAT table <b>718</b>. In the example in <figref idref="DRAWINGS">FIG. 7</figref>, thermostat <b>110</b> has a private network address of 192.168.1.108 and a private port number of <b>60720</b> while remote thermostat <b>112</b> has been configured with a private network address of 192.168.1.110 and three different port numbers <b>60744</b>, <b>60743</b>, and <b>60722</b>. In this example, thermostat <b>110</b> initiates the establishment of a communication channel with cloud-based management server <b>716</b> having a public network address 107.20.224.12 and public port number <b>443</b>. Accordingly, the router (not shown) on private network <b>702</b> creates an entry in a NAT table <b>718</b> identified by NAT PORT <b>1022</b> for communications between SOURCE ADDRESS 192.168.1.108 and SOURCE PORT <b>60720</b> of thermostat <b>110</b> and DESTINATION ADDRESS 107.20.224.12 and DESTINATION PORT <b>443</b> of cloud-based management server <b>716</b>.</p>
<p id="p-0087" num="0086">As described above, one embodiment uses a router to connect the Public Network <b>704</b> to the Private Network <b>702</b>. However, other embodiments may use many other devices and methods for connecting two networks. As used herein, the term &#x201c;gateway&#x201d; may be interpreted to encompass any device implementing a method of connecting one network to another network. Many embodiments discussed herein use gateways that perform address translation between multiple networks, such as the NAT table examples discussed above. However, it should be understood that a gateway may use any method of translating addresses between multiple networks.</p>
<p id="p-0088" num="0087">In an alternative configuration, thermostats <b>110</b> and <b>112</b> may be configured with multiple communication channels to cloud-based management server <b>716</b> rather than a single connection as depicted with thermostat <b>110</b>. As an example, thermostat <b>112</b> initiates the establishment of communication channels over three ports <b>60744</b>, <b>60743</b>, and <b>60722</b>, causing the router to make three more entries in the NAT table <b>718</b> identified by NAT PORTs <b>1044</b>, <b>1921</b> and <b>1758</b>. The additional corresponding entries in NAT table <b>718</b> identified as NAT PORT <b>1044</b>, <b>1921</b>, and <b>1758</b> include SOURCE ADDRESS 192.168.1.110 and SOURCE PORTS <b>60744</b>, <b>60744</b>, <b>60722</b> each associated with DESTINATION ADDRESS 107.20.224.12 and DESTINATION PORT <b>443</b> of cloud-based management server <b>716</b>. In various embodiments of the present invention, communications between cloud-based management server <b>716</b> and other thermostats may take place over a single communication channel as configured on remote thermostat <b>110</b> while other embodiments may use multiple communications channels as provided with thermostat <b>112</b>.</p>
<p id="p-0089" num="0088">As data is transferred using a protocol such as TCP/IP, the router in private network <b>702</b> modifies the addresses in packets of data passing over the communication channels between the private network and a server or device on the public network such as cloud-based management server <b>716</b>. In one example, the router may receive a packet from remote thermostat <b>110</b> having a SOURCE ADDRESS field of 192.168.1.108 and a SOURCE PORT of <b>60720</b> combined with a DEST ADDRESS of 107.20.224.12 and DEST PORT <b>443</b> of cloud-based management server <b>716</b>. Before placing this packet on the Internet, the router references NAT table <b>718</b> and replaces the SOURCE ADDRESS field and SOURCE PORT field values with the public address 76.21.3.203 assigned to the router and the corresponding NAT port <b>1022</b> respectively. A resulting modified packet header <b>720</b> in <figref idref="DRAWINGS">FIG. 7</figref> sent over the public network has the original destination address and destination port but the source address and port are changed to the public address of the router and port number from NAT table <b>718</b>. As long as the entries in NAT table <b>718</b> are present, thermostats <b>110</b> and <b>112</b> may communicate over their respective communication channels on the public network <b>704</b> to cloud-based management server <b>716</b>.</p>
<p id="p-0090" num="0089">During these communications, embodiments of the present invention take into consideration battery-levels of the thermostats and the impact on the performance of the thermostat. If a battery-level on a thermostat is low, further communications with a thermostat may impact the ability of the thermostat to perform essential functions such as controlling the HVAC system or communicating over the network. As illustrated in FIG. <b>7</b>., an enlarged battery image <b>110</b>A next to thermostat <b>110</b> shows schematically a battery-level of the battery inside of thermostat <b>110</b>. The battery image <b>110</b>A, in this example, appears about 80% charged thus representing the battery-level inside thermostat <b>110</b> to be almost fully charged. In a similar manner, an enlarged battery image <b>112</b>A adjacent to remote thermostat <b>112</b> appears about 20% charged thus indicating that the battery inside of thermostat <b>112</b> has a low battery-level. To accommodate for these different and fluctuating battery-levels, embodiments of the present invention may incorporate one or multiple different strategies in communicating and operating a thermostat.</p>
<p id="p-0091" num="0090">The battery levels may be monitored by the thermostat <b>110</b> and/or by the cloud-based management server <b>716</b> in order to regulate the power used by any of the processing functions or processing circuits in the thermostat, such as head unit processor <b>314</b> and/or backplate processor <b>316</b>. Oftentimes, as discussed above, the energy harvested from the HVAC system may provide less energy than may be required when the processing functions are operating in various modes. Therefore, the sleep state, or low power state of the processing functions may be configured such that the energy used during the sleep state by the processing functions is less than what is harvested from the HVAC system. Generally, a first power may be provided by the power-storage module that is higher than a second power that may be harvested from the HVAC system. Because of this configuration, the processing function may operate in a first mode, i.e., a sleep mode, which uses less power than the second power harvested from the HVAC system. This may allow for the power harvested from the HVAC system to both provide power to the power-supply module and to the processing functions while the processing functions are operating in the sleep mode (first mode). This may also enable the processing functions to operate in a second mode, i.e., an operating mode, which may require more instantaneous power than the HVAC harvesting may provide. The second mode may use a fourth power that is less than the first power that may be provided by the power-supply module, but it may also be more than the second power harvested from the HVAC system.</p>
<p id="p-0092" num="0091">In one embodiment illustrated in <figref idref="DRAWINGS">FIG. 8A</figref>, cloud-based management server <b>716</b> monitors battery-levels on the thermostats and judiciously control the communications according to a priority assigned to the data. In some embodiments, cloud-based management server <b>716</b> implements aspects of the present invention however alternate embodiments may distribute functionality from cloud-based management server <b>716</b> to one or several servers within the system. In this example, thermostat <b>110</b> and thermostat <b>112</b> have initiated and established their respective communication channels with cloud-based management server <b>716</b> and the router on private network <b>702</b> has created NAT table <b>718</b> as previously illustrated in <figref idref="DRAWINGS">FIG. 7</figref>. To preserve battery-charge, the thermostats <b>110</b>/<b>112</b> may enter into a low power state while waiting for either (i) a local event that merits wake-up, such as a particular temperature threshold being detected by the temperature sensors, or a detected proximity of a user detected by the proximity sensors, or (ii) a next event or request from cloud-based management server <b>716</b> that merits wake-up.</p>
<p id="p-0093" num="0092">Prior to entering into a low power state, each thermostat <b>110</b>/<b>112</b> sends a connection-opening long-polling packet to the thermostat communication server <b>820</b>. When a response is not required for normal operational purposes (i.e., when the cloud-based management server <b>716</b> has no instructions or requests to render), cloud-based management server <b>716</b> maintains a long-polling communication with thermostats <b>110</b>/<b>112</b> allowing the communication channels to remain open even though the actual data exchanged may be infrequent or subject to long delays. This not only uses the battery-charge of the thermostats more efficiently but reduces the overhead and delay associated with reestablishing a communication channel for each data transmission. In one embodiment, cloud-based management server <b>716</b> maintains the long-polling communication in a manner that preserves the entry in NAT table <b>718</b> by sending a keep-alive priority packet at regular keep-alive intervals. In one embodiment, the keep-alive priority packet is consistent with a keep-alive facility built into a TCP/IP protocol stack. If no messages need to otherwise be sent to the thermostats <b>110</b>/<b>112</b> within the long-polling time interval, the protocol stack sends one or more &#x201c;keep-alive&#x201d; packets to the router on private network <b>702</b> at respective keep-alive intervals that are less than the long-polling time interval, thereby preserving the entry in NAT table <b>718</b>. In one embodiment, the keep-alive intervals are substantially less than the interval over which many common routers might otherwise flush their NAT table with respect to that particular connection.</p>
<p id="p-0094" num="0093">At a predetermined time interval or upon an event occurrence, thermostats <b>110</b> and <b>112</b> may wake from a low power state to check on their respective battery-levels and perform other administrative functions. In accordance with some embodiments, the battery-level is transmitted over a wireless connection from each thermostat <b>110</b> and <b>112</b> through an access point <b>806</b> on the private network and then stored for future reference by thermostat communication server <b>820</b>. For example, battery image <b>110</b>A appears about 80% charged representing the battery-level inside thermostat <b>110</b> to be almost fully charged while battery image <b>112</b>A appears about 20% charged thus indicating that the battery inside of thermostat <b>112</b> is at a low level. One embodiment of cloud-based management server <b>716</b> updates this data in a device-battery-charge table <b>816</b> that includes a device address, a battery-level, and a keep-alive interval used for the corresponding communication channel. For example, device-battery-charge table <b>816</b> provides that device address 76.21.3.203:1022 (corresponding to thermostat <b>110</b> by way of NAT table <b>718</b>) has a &#x201c;high&#x201d; battery-level and a keep-alive interval set to 5000 time units. In contrast, device addresses 76.21.3.203:1044, 76.21.3.203:1921, and 76.21.3.203:1758 (corresponding to thermostat <b>112</b> by way of NAT table <b>718</b>) in device-battery-charge table <b>816</b> all have a &#x201c;low&#x201d; battery-level and a longer keep-alive interval set to 10000. Some embodiments of cloud-based management server <b>716</b> may set the keep-alive interval shorter if the battery-level is high to reduce the chance that an entry in the NAT table <b>718</b> will be flushed by the router. If the battery-level is &#x201c;low&#x201d;, the keep-alive interval may be set to a maximum long-poll interval that represents a maximum time interval not likely to exceed a NAT time-out period of most router devices.</p>
<p id="p-0095" num="0094">Some embodiments of cloud-based management server <b>716</b> may further use device-battery-charge table <b>816</b> to help determine when data should be communicated from cloud-based management server <b>716</b> to one or more thermostats. To implement, one embodiment further creates a power-priority table <b>818</b> that associates low and high battery-levels reported from each thermostat with high thermostatic importance data or low thermostatic importance data. In these embodiments, power-priority table <b>818</b> establishes a trade-off between the importance assigned to data being communicated compared with the drain on the current battery charge associated with the thermostat. For example, data communications with data classified as high thermostatic importance data may be filtered and transmitted even when the battery is low since the data is considered of higher importance to the overall operation of cloud-based management server <b>716</b> and the thermostat. In one embodiment, a low battery-level may be between 0 and 39% of charge capacity.</p>
<p id="p-0096" num="0095">Data communications classified under a low thermostatic importance may not be transmitted when the battery level is low as indicated in power-priority table <b>818</b>. Since the battery is not fully charged, low thermostatic importance data may not be transmitted in accordance with power-priority table <b>818</b> to preserve energy on the battery of the thermostat. Accordingly, low and high thermostatic importance data types are transmitted in accordance with some embodiments when the battery-level is detected as high or in a range from 80% to 100% charged.</p>
<p id="p-0097" num="0096">In an alternate embodiment illustrated in <figref idref="DRAWINGS">FIG. 8B</figref>, power-priority table <b>818</b> three batter levels and three levels of thermostatic importance. In the case of a low battery level, data consider to be high thermostatic importance is transmitted while medium and low thermostatic importance data is not sent. When the battery level is at a medium level, data considered of both high and medium thermostatic importance is transmitted. If the battery level is at least at a high level then data considered to be of low, medium and high thermostatic importance is transmitted. Further additional embodiments may also use more than three battery-levels and three data priority level types for the data as well depending on the particular design and implementation requirements. In addition, the percentage charge for low, medium and high battery-levels may include different ranges of charge that do not necessarily include the aforementioned 0-39% charge for a low battery-level, 40% to 79% for a medium battery-level, and 80% to 100% for a high battery-level.</p>
<p id="p-0098" num="0097">In some embodiments, the data communications may be classified in a number of different ways and often will be determined based on the particular implementation requirements of the cloud-based management server <b>716</b> and performance requirements for the thermostats. In one implementation, a high-priority data type may include data communications actively requesting a thermostat perform some function. This may include a data communication from cloud-based management server <b>716</b> requesting thermostat <b>110</b> or <b>112</b> to change a temperature setpoint. Another high-priority data type may include a data communication requesting thermostat <b>110</b> or <b>112</b> to turn on or turn off a cooling function. In contrast, low-priority data types may include certain operations or functions deemed less critical for a thermostat to perform immediately. Downloading a software update from cloud-based management server <b>716</b> to a thermostat is one example of a low-priority communication as the software update is not required and likely does not affect the immediate operation of the thermostat. In addition, it may also be preferred to not download a software update when a thermostat has a low battery-level as a partially-completed update may render the thermostat inoperable.</p>
<p id="p-0099" num="0098"><figref idref="DRAWINGS">FIG. 9</figref> illustrates a cloud-based management server <b>716</b> that both conserves energy and promotes high-performance operation of thermostats designed in accordance with embodiments of the present invention. In this embodiment, cloud-based management server <b>716</b> includes a processor <b>904</b> configured to execute one or more instructions, a memory <b>902</b> holding instructions executable on the processor, a network interface controller <b>906</b> capable of communication over a network such as the Internet, a storage device <b>910</b>, a display adapter and monitor <b>912</b> to display information from the server on the monitor, and peripheral drivers &#x26; devices <b>914</b> that includes keyboards, mice and other interfaces for controlling the server. For example, a CD-ROM/DVD device <b>916</b> with media may be attached to peripheral drivers &#x26; devices <b>914</b> holding various embodiments of the present invention tangibly embodied in a computer program product.</p>
<p id="p-0100" num="0099">In one embodiment, processes in memory <b>902</b> may include a battery-level collection process <b>918</b> that stores a battery-level associated with the battery used to power a thermostat. As previously described, the battery-level in some embodiments is provided by the thermostat over a communication channel established over a network between the thermostat management system and the thermostat and provides an indication of remaining energy in the battery associated with the thermostat. The battery-level collection process is able to collect these battery-levels over a long period of time as a result of ongoing communications between the thermostat and the cloud-based management server <b>716</b>, which includes the long-polling process that keeps the communication channels open between the cloud-based management server <b>716</b> and thermostats. In some embodiments, the battery-level data is stored in a device-battery-charge table <b>816</b> as illustrated in <figref idref="DRAWINGS">FIG. 8</figref> and may be in a local storage area on cloud-based management server <b>716</b> or remotely accessed in a database or other remote storage area.</p>
<p id="p-0101" num="0100">Some embodiments may further include a data priority process <b>920</b> in memory <b>902</b> that classifies and prioritizes one or more types of data to be transmitted to the thermostat over a communication channel. Depending on the implementation, data priority process <b>920</b> classifies the data transmission according to a data priority ranging from a low thermostatic importance data type to a high thermostatic importance data type. In some implementations, the low thermostatic importance data is of lesser importance to the operation of the thermostat management system and the thermostat. For example, a low thermostatic importance data type may include a software update as the software update may not be required for the thermostat to operate. In comparison, high thermostatic importance data types may include data of higher importance to the operation of the thermostat management system such as a request to change a setpoint in a thermostat or turn-on heating or cooling in the HVAC system.</p>
<p id="p-0102" num="0101">Further embodiments may also include a power-classification transmission process <b>922</b> that transmits data to a thermostat depending on a classification of the data and the battery-level associated with the thermostat. As previously described, the data priority classification ranges from a low thermostatic importance data type to a high thermostatic importance data type depending on the importance of the data to the overall operation of cloud-based management server <b>716</b> and the thermostat. Consequently, low thermostatic importance data may not be transmitted when a battery-level is low in order to conserve the battery power remaining on the thermostat. However, the power-classification transmission process <b>922</b> may transmit all data classifications when the battery-level associated with a thermostat is fully-charged or &#x201c;high&#x201d;.</p>
<p id="p-0103" num="0102">Embodiments of the present invention may also include a long-polling process <b>924</b> in memory <b>902</b> to facilitate keeping the communication channel open with a thermostat. This long-polling process <b>924</b> initially receive receives a request over the network from a thermostat to establish the communication channel between the cloud-based management server <b>716</b> located on a public network and the thermostat located on a private network. In some embodiments, cloud-based management server <b>716</b> has a public network address registered on the Internet while the thermostat has a shared public network address provided through an entry in a NAT table from a router on a private network, such as NAT table <b>718</b> in <figref idref="DRAWINGS">FIG. 7</figref>. The long-polling process <b>924</b> further configures a network communication protocol, such as TCP/IP, to occasionally transmit a keep-alive packet from the thermostat management system back to the network-attached thermostat over the communication channel. In some implementations, the keep-alive packet sent to the thermostat acknowledges establishment of the communication channel but may not include a payload or data that needs processing. Long-polling process <b>924</b> may set the time interval for sending these keep-alive packets at maximum time interval not to exceed a NAT time-out period of a router device. The receipt of the keep-alive packet before the NAT time-out period keeps the entry in the NAT table current and the communication channel from being disconnected.</p>
<p id="p-0104" num="0103"><figref idref="DRAWINGS">FIG. 10A</figref> illustrates a flowchart diagram of the operations that a thermostat communication server uses to coordinate communications with a battery powered thermostat that both conserves the energy of the battery and promotes performance of the thermostat. The thermostat communication server, such as cloud-based management server <b>716</b> in <figref idref="DRAWINGS">FIG. 8</figref>, receives a request from a thermostat powered by a battery to establish a communication channel between the thermostat and the thermostat communication server over a network. (<b>1002</b>) When the thermostat initiates the communication channel, a router places an entry in a NAT table, such as NAT table <b>718</b> in <figref idref="DRAWINGS">FIG. 7</figref>, allowing the thermostat on a private network behind a router to then communicate with thermostat communication server on the Internet, a public network. The entry in the NAT table will not be removed and the communication channel will remain open as long as any gap in communication from the thermostat communication server and the thermostat does not exceed a NAT time-out value associated with router.</p>
<p id="p-0105" num="0104">Next, thermostat communication server classifies one or more types of data to be transmitted to the thermostat over the communication channel according to a thermostatic importance ranging from a low thermostatic importance to a high thermostatic importance classification. (<b>1004</b>) In one implementation, the low thermostatic importance data type includes data of lesser importance to the operation of the overall thermostat management system and thermostat. These may include optional functions to be performed on the thermostat such as software update or other maintenance. Conversely, the high thermostatic importance data type includes data of higher importance to the operation of the thermostat management system and the thermostat and generally includes requests to actively perform an action on the thermostat such as changing a setpoint, turning-on/off heating or cooling or checking ambient temperature in a residence or commercial location where the thermostat is located.</p>
<p id="p-0106" num="0105">Next, thermostat communication server stores a battery-level associated with a thermostat in a storage area accessible by the thermostat communication server. (<b>1006</b>) In some embodiments, each thermostat periodically checks its own battery and provides the battery-level to the thermostat communication server over a communication channel established over the network. Battery-level information for each thermostat may be stored in a device-battery-charge table, such as device-battery-charge table <b>816</b> as illustrated in <figref idref="DRAWINGS">FIG. 8</figref>.</p>
<p id="p-0107" num="0106">To keep the communication channel open, thermostat communication server may configure a long-poll interval for transmitting a keep-alive packet over the communication channel to the thermostat. (<b>1008</b>) In some embodiments, the thermostat communication server sets the long-poll interval to a maximum value not to exceed a NAT timeout period used by most routers, which is often approximately 100 minutes.</p>
<p id="p-0108" num="0107">If no data passes between thermostat communication server and the thermostat (<b>1010</b>&#x2014;No), a timer value, originally set to the long-poll interval, decreases over time within the communication protocol stack and the process continues. Eventually, if the long-poll interval runs out of time and the communication protocol stack on the thermostat communication server, such as TCP/IP, does not detect communication activity within the long-poll interval, the built-in keep-alive feature sends a packet to keep the NAT entry on the router and communication channel open. (<b>1012</b>) In some embodiments, the thermostat communication server may request to terminate the communication channel when the long-poll interval has elapsed and wait for new communication channel to be established by the thermostat.</p>
<p id="p-0109" num="0108">Alternatively if there is data to be sent, the thermostat communication server checks the most recent battery-level of the thermostat before sending. (<b>1010</b>&#x2014;Yes) One embodiment determines if there is a low battery-level associated with the thermostat (<b>1014</b>&#x2014;Yes) that only data classified as high thermostatic importance data should be transmitted. (<b>1016</b>) This preserves some of the battery charge in the thermostat by not sending low thermostatic importance data. In some embodiments, thermostat communication server have predetermined classifications setup in advance according to a particular configuration requirement. If the data is of higher importance to the operation of the thermostat management system then the data is classified as a high thermostatic importance data type and should be sent even when there is a low battery-level. For example, high thermostatic importance data may include instructions sent to a thermostat actively requesting the thermostat change a temperature setpoint or other setting.</p>
<p id="p-0110" num="0109">When the battery-level associated with the thermostat is not at a low level (<b>1014</b>&#x2014;No), all data classified as low to high thermostatic importance will be transmitted as the battery on the thermostat is considered fully charged. (<b>1018</b>)</p>
<p id="p-0111" num="0110">An example data flow chart in <figref idref="DRAWINGS">FIG. 10B</figref> illustrates the flow of data and events when thermostat communication server transmits data based on a battery-level of a thermostat and priority associated with the data. In this example, the thermostat initiates establishment of a communication channel with thermostat communication server causing a router to creates entry in the NAT table. (<b>1026</b>) To save energy, the thermostat enters a low power mode and waits for the next event. (<b>1028</b>). After a period of time, the management server sends a keep-alive packet before the NAT table entry is removed. (<b>1030</b>) In one embodiment, the thermostat wakes from the low power mode and sends a low battery-level to the thermostat communication server indicating the battery-level on the thermostat is nearly discharged (<b>1032</b>)&#x2014;the thermostat then returns to a low power mode to conserve the battery use. (<b>1034</b>) Thermostat communication server associates the low battery level with the thermostat and stores the results in a storage area. (<b>1036</b>) At this point, a client device, such as tablet <b>706</b> running thermostat access client <b>714</b> in <figref idref="DRAWINGS">FIG. 7</figref>, requests thermostat communication server to change a thermostat setting. (<b>1038</b>) Thermostat communication server classifies request as a high thermostatic importance data type to be transmitted even though the battery on the thermostat is at a low level. (<b>1040</b> and <b>1042</b>) As a result, the thermostat receives the data transmission and fulfills the request to change the thermostat setting. (<b>1044</b>) Alternate implementations may use more than two battery levels and more than two corresponding thermostatic importance classifications for data such as a three classification system with low, medium, and high thermostatic importance classification data types.</p>
<p id="p-0112" num="0111">In an alternate embodiment, a battery powered thermostat and system illustrated in <figref idref="DRAWINGS">FIG. 11A</figref> uses a plurality of communication channels to exchange data classified with different priority in accordance with embodiments of the present invention. Accordingly, in this embodiment the thermostat <b>112</b> receives data of different priority from cloud-based management server <b>716</b> over corresponding different communication channels and, depending on the battery-level, may either process or discard the data received. Advantageously, the processing associated with this embodiment is distributed partly on cloud-based management server <b>716</b> and partly on thermostat <b>112</b>. As one distinct advantage, thermostat <b>112</b> can determine the battery-level without polling or indirectly gathering data thus resulting in a more accurate processing of data packets received from thermostat communication server <b>820</b>.</p>
<p id="p-0113" num="0112">For example, thermostat <b>112</b> in <figref idref="DRAWINGS">FIG. 11A</figref> has established two wireless communication channels using private network address and port combinations 192.168.1.110:60744 and 192.168.1.110:60743. These private network addresses on thermostat <b>112</b> have corresponding entries in NAT table <b>718</b> in <figref idref="DRAWINGS">FIG. 7</figref> identified with NAT port entries <b>1044</b> and <b>1921</b>. Cloud-based management server <b>716</b> in <figref idref="DRAWINGS">FIG. 11A</figref> stores corresponding public addresses and port numbers 76.21.3.203:1044 and 76.21.3.203:1921 for thermostat <b>112</b> in a priority transmission table <b>102</b> and also associates a high and low-priority data type to each address as illustrated. In accordance with some embodiments, cloud-based management server <b>716</b> classifies data to be sent to the thermostat as being a low or high-priority data type and then sends over the appropriate communication channel or public address as indicated in priority transmission table <b>1102</b>. Data passes over public network <b>704</b>, private network <b>702</b>, and wirelessly from access point <b>806</b> illustrated in <figref idref="DRAWINGS">FIG. 11A</figref> onto thermostat <b>112</b>.</p>
<p id="p-0114" num="0113">Settings within the Wi-Fi module (not shown) of thermostat <b>112</b> determine whether to process or discard the data depending on which communication channel the data is received. As a reflection of settings in the Wi-Fi module, a power-priority table <b>1104</b> identifies that the recent battery-level of thermostat <b>112</b> is at a low level, as illustrated by battery image <b>112</b>A, and that ports <b>60744</b> and <b>60743</b> are used to process high and low data types respectively. Because the most recent battery-level was low, power-priority table <b>1104</b> also indicates in this example that the Wi-Fi module has been configured to ignore or discard low-priority data arriving on ports <b>60743</b> and process only high-priority data received over port <b>60744</b>. Over time, thermostat <b>112</b> may update the configuration of the Wi-Fi module to accept or discard packets depending on the battery-level the thermostat <b>112</b> detects. If thermostat <b>112</b> later determines the battery-level is high, thermostat <b>112</b> reconfigures Wi-Fi module to subsequently process both low and high-priority data packets arriving over both ports. In alternate embodiments, Wi-Fi module may also be configured to use greater or fewer ports and process either greater or fewer data priority types. For example, three communication channels may be used to process either high-priority, medium-priority or low-priority data types rather than just either high-priority or low-priority data types.</p>
<p id="p-0115" num="0114">Flowchart diagram in <figref idref="DRAWINGS">FIGS. 11B-11C</figref> concern the operations on cloud-based management server <b>716</b> and thermostat <b>112</b> in accordance with embodiments of the present invention as illustrated in <figref idref="DRAWINGS">FIG. 3A</figref> and <figref idref="DRAWINGS">FIG. 11A</figref>. In one embodiment, flowchart diagram in <figref idref="DRAWINGS">FIG. 11B</figref> provides the operations used by a thermostat communication server to communicate over a plurality of communication channels with a battery powered thermostat. In this embodiment, thermostat communication server, such as cloud-based management server <b>716</b> in <figref idref="DRAWINGS">FIG. 11A</figref>, receives a request from a thermostat powered by a battery to establish a plurality of communication channel between the thermostat and the thermostat communication server over a network. (<b>1128</b>) When the thermostat initiates the communication channel, a router places a plurality of entries in a NAT table, such as NAT table <b>718</b> in <figref idref="DRAWINGS">FIG. 7</figref>, providing multiple communication channels for the thermostat to communicate with the thermostat communication server on the Internet, a public network. As previously described, these entries in the NAT table will not be removed and the communication channel will remain open as long as any gap in communication from the thermostat communication server and the thermostat does not exceed a NAT time-out value associated with the router.</p>
<p id="p-0116" num="0115">Next, thermostat communication server classifies one or more types of data to be transmitted to the thermostat over the communication channel according to a data priority ranging from a low-priority data type to a high-priority data type. (<b>1130</b>) In one implementation, the low-priority data type includes data of lesser importance to the operation of the overall thermostat management system and thermostat. These may include optional functions to be performed on the thermostat such as software update or other maintenance. Conversely, the high-priority data type includes data of higher importance to the operation of the thermostat management system and the thermostat and generally includes requests to actively perform an action on the thermostat such as changing a setpoint, turning-on/off heating or cooling or checking ambient temperature in a residence or commercial location where the thermostat is located.</p>
<p id="p-0117" num="0116">To keep the communication channel open, thermostat communication server may configure a long-poll interval for transmitting keep-alive packets over the plurality of communication channels to the thermostat. (<b>1132</b>) In some embodiments, the thermostat communication server sets the long-poll interval to a maximum value not to exceed a NAT timeout period used by most routers, which is often approximately 100 minutes.</p>
<p id="p-0118" num="0117">If no data passes between thermostat communication server and the thermostat (<b>1134</b>&#x2014;No), a timer, initially set to the long-poll interval, decreases over time within the communication protocol stack and the process continues. Eventually, if the long-poll interval runs out of time and the communication protocol stack on the thermostat communication server, such as TCP/IP, did not detect communication activity, the built-in keep-alive feature sends packets to keep the NAT entries on the router and the communication channels open. (<b>1138</b>) In some embodiments, the thermostat communication server may request the thermostat to terminate and reestablish the communication channel when the timer associated with the long-poll interval expires to help make sure the communication channel is available and operating properly.</p>
<p id="p-0119" num="0118">Alternatively if there is data to be sent, the thermostat communication server checks the priority of the data and sends over the proper communication channel. Accordingly in one embodiment, if the data is classified as low-priority (<b>1140</b>&#x2014;Yes), thermostat communication server sends the data over a communication channel reserved for low-priority data transmissions. (<b>1142</b>) Alternatively, if the data is classified as high-priority and not low-priority (<b>1140</b>&#x2014;No), thermostat communication server sends the data over a communication channel reserved for high-priority data transmissions. (<b>1148</b>) In this embodiment, thermostat communication server segregates the data on different communication channels but allows the thermostat to determine whether to process or discard the data as it easy easier for the thermostat to obtain battery-level data and make a decisions. Generally, a determination may be made by the network-communication module (in this embodiment, the Wi-Fi module <b>312</b>) that the a transmission is classified as a low-priority transmission at least in part because an indication that the power level of the power supply was below a threshold power level was sent to the server. In response, the transmission may be processed by the network-communication module while the processing function, or circuit, remains in the low-power mode.</p>
<p id="p-0120" num="0119"><figref idref="DRAWINGS">FIG. 11C</figref> is a flowchart diagram of the complimentary operations performed on a thermostat to conserve battery energy yet process data at a high level of performance. In this embodiment, a thermostat, such as thermostat <b>112</b> in <figref idref="DRAWINGS">FIG. 11A</figref>, may wake from a low power state to check on battery-levels or possible data packets received over one or several communication channels. (<b>1150</b>) For example, a thermostat may wake from a low power state once every 100 ms to respond to a wireless strobe from an access point <b>324</b> and may also check on a battery-level. It is also possible that a wake-on-LAN event wakes the thermostat causing it to leave the low power state and process a data packet received over one or several communication channels reserved for different priority levels of data.</p>
<p id="p-0121" num="0120">In some embodiments, the thermostat may determine that the communication channels with thermostat communication server, such as with thermostat communication server <b>820</b>, have not been established. (<b>1152</b>&#x2014;No) Accordingly, one embodiment of the present invention may request and establish two communication channels between the thermostat communication server and the thermostat. (<b>1154</b>) In accordance with some embodiments, the thermostat reserves the first and second communication channels on the thermostat to receive data classified as low and high-priority data types. The thermostat initially configures its Wi-Fi module, such as Wi-Fi module <b>312</b> in <figref idref="DRAWINGS">FIG. 3A</figref>, to receive low and high-priority data packets from each of the several communication channels using a built-in wake-on-LAN feature. (<b>1156</b>) To reduce power consumption, the thermostat may then return to a low power state waiting for the next event or receipt of data. (<b>1158</b>)</p>
<p id="p-0122" num="0121">Alternatively, if the communication channels are established, (<b>1152</b>&#x2014;Yes), the thermostat determines if a data packet has been received and requires further processing. (<b>1160</b>) In some embodiments, the Wi-Fi module on the thermostat may inspect the data packet header or payload and determine that the data packet needs no further processing and can be discarded. (<b>1160</b>&#x2014;No) For example, the data packet may be discarded if it is a keep-alive packet meant to preserve the NAT table entries in the router or if the packet otherwise has no payload data associated with it. If the packet is discarded, the thermostat may conserve overall power consumed because other components in the thermostat, such as head unit processor <b>314</b> or backplate processor <b>316</b>, can remain in a low power state. (<b>1162</b>)</p>
<p id="p-0123" num="0122">If the packet does require further processing, (<b>1160</b>&#x2014;Yes) then the thermostat may activate or power-up other portions of the thermostat to service the data packet received. (<b>1164</b>) In some embodiments, thermostat may activate head unit processor <b>314</b> to perform a change of a setpoint or other feature on the thermostat or may activate back plate processor <b>316</b> to gather sensor information as requested from thermostat communication server <b>820</b>.</p>
<p id="p-0124" num="0123">Once a packet has been processed or discarded, embodiments of the present invention check the current battery-level of the thermostat and adjust the communication channels to either accept or discard subsequent data packets. If the thermostat determines the battery charge is at or below a low battery-level, (<b>1168</b>&#x2014;Yes) the Wi-Fi module is configured to discard subsequent data received over a first communication channel reserved to received low priority data. (<b>1172</b>) As previously described, some embodiments discard packets over a communication channel and port of the Wi-Fi module by turning off a wake-on-LAN feature for the channel. This causes subsequent low priority packets received on the channel to be ignored and discarded. In some implementations, the Wi-Fi module is configured to process packets on the second communication channel using a filter to locate the proper port number and enabling the wake-on-LAN feature for the selected filter. Lastly, if the battery charge is above the low battery-level (<b>1168</b>&#x2014;No) then embodiments of the present invention enable processing of subsequently received packets over the first and second communication channels. (<b>1178</b>) For example, if the battery-level charge is high then embodiments of the present invention are adjusted to process more data and further improve the thermostat's performance and ability to respond to instructions and requests. After checking the battery-level and adjusting the Wi-Fi module, the thermostat returns to a low power state to conserve energy consumption and await the next event and/or data to be processed. (<b>1158</b>)</p>
<p id="p-0125" num="0124">In another embodiment, a communication module, such as the Wi-Fi module, may be configured to establish one or more communication channels to a controller server through a gateway. The communication module may further be configured to utilize a communication protocol with the controller server, where the communication protocol includes a time interval that represents a time that the gateway is expected to maintain the one or more communication channels between transmissions. For example, this time may correspond to the time that a router is expected to maintain an address in an NAT table. After establishing the communication channels, the controller may receive a first transmission from the controller server through the communication channels while a processing function, such as the head unit processor <b>314</b> and/or the backplate processor <b>316</b>, operates in a first mode, or a sleep mode. The controller may then determine that the first transmission was sent from the controller server to maintain one of the communication channels, and/or that the first transmission does not require the processing function to operate in the second mode. For example, the first transmission may comprise a header portion of information without a payload that requires processing by the processing functions. In addition to receiving the first transmission, the controller may also receive a second transmission from the controller server through the communication channels, where the second transmission includes information for controlling a property function associated with the controller. In this case, the second transmission may require processing by the processing function, and the controller may cause the processing function to operate in a second mode, or operating mode, after receiving the second transmission in order to process the second transmission.</p>
<p id="p-0126" num="0125">An example data flow chart in <figref idref="DRAWINGS">FIG. 11D</figref> illustrates the flow of data and events using a plurality of communication channels to transmit different priority levels of data. In this example, the thermostat initiates establishment of a plurality of communication channels with thermostat communication server causing a router to creates corresponding entries in a NAT table. (<b>1160</b>) In some embodiments, a first communication channel is reserved for low-priority types of data and a second communication channel is reserved for high-priority types of data. To conserve energy, the thermostat enters a low power mode and waits for the next event. (<b>1164</b>). After a period of time, a long-poll interval expires causing the thermostat communications server to send a keep-alive packet before the NAT table entry is removed. (<b>1162</b>) In one embodiment, the thermostat wakes from the low power mode and sensing a low battery-level and making note of the local condition. In this embodiment, the thermostat does not forward to the thermostat communication server since it is up to the thermostat to determine whether to process the received data packets. Instead, thermostat turns off a wake-on-LAN (WOL) feature for all ports except the port receiving high-priority types of data. (<b>1170</b>) For example, subsequently received packets received on the first communication channel may be discarded since the low-priority data is reserved for the first communication channel. At some later point in time, a client device, such as tablet <b>706</b> running thermostat access client <b>714</b> in <figref idref="DRAWINGS">FIG. 7</figref>, requests that thermostat communication server downloads a software update to the thermostat. (<b>1172</b>) Thermostat communication server classifies request as a low-priority data type and transmits over the first communication channel regardless of the battery-level on the thermostat. (<b>1174</b>) In some embodiments, thermostat communication server segregates different priority data types on different communication channels and lets the thermostat decide whether to discard or process the packets received. Eventually, the thermostat receives the software update request but discards the packets as the battery-level is low and the first communication channel is configured to ignore the low-priority data packets that it may receive. (<b>1176</b>).</p>
<p id="p-0127" num="0126"><figref idref="DRAWINGS">FIGS. 12A-12B</figref> provide a schematic block diagram and flowchart for creating a thermostat reporting group with multiple thermostats and gathering reporting events in a common event log. In <figref idref="DRAWINGS">FIG. 12A</figref>, a thermostat reporting group <b>1202</b> is formed from several thermostats in a network including thermostat <b>1204</b>, thermostat <b>1206</b>, thermostat <b>1208</b> and thermostat <b>1210</b> whereupon each thermostat has a current battery-level as represented by battery images <b>1204</b>A, battery image <b>1206</b>A, battery image <b>1208</b>A and battery image <b>1210</b>A respectively. To conserve energy, a proxy reporting thermostat is selected from the thermostat reporting group to receive the event log information from other members of the group and then upload over a network to a central server. In this example, thermostat <b>1204</b> is selected as the proxy reporting thermostat since the corresponding battery-level indicated by battery image <b>1204</b>A is the highest within the thermostat reporting group.</p>
<p id="p-0128" num="0127">Once selected, thermostat <b>1204</b> gathers log data over the network from other thermostats <b>1206</b>, <b>1208</b> and <b>1210</b> through local transfers <b>1212</b>, <b>1214</b>, and <b>1216</b> respectively. These local transfers include the log data from each thermostat combined into a common log <b>1216</b> identifying a time stamp, event type, device ID and data content for each entry. After a period of time or when memory (not shown) in thermostat <b>1204</b> fills up, the common log <b>1216</b> is uploaded over a communication channel to a central server such as the cloud-based management server <b>716</b>. This approach allows event log information to be gathered using fewer uploads than would be required if each thermostat was required to upload individually. It also allows thermostats having a low battery-level to preserve their battery charge while still allowing such data to be collected and analyzed on a server such as cloud-based management server <b>716</b> in <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0129" num="0128"><figref idref="DRAWINGS">FIG. 12B</figref> is a flowchart diagram of the operations associated with gathering reporting events on a proxy reporting thermostat and common event log in accordance with embodiments of the present invention. In one embodiment, a thermostat reporting group is created from a plurality of battery powered thermostats on a network. (<b>1216</b>). Each battery powered thermostat individually records events in a respective event log corresponding to the one or more operations and events occurring on a thermostat. In some cases, the events may include sensor information provided from humidity sensors, temperature sensors, passive infra-red sensors, ambient light sensors, active proximity sensors or other sensors incorporated into each thermostat. Event logs may also include information describing current or changed settings on a thermostat and the time stamp associated with when these settings were changed.</p>
<p id="p-0130" num="0129">As previously described, embodiments of the present invention select a proxy reporting thermostat to represent the other thermostats. (<b>1218</b>). In some embodiments, the proxy reporting thermostat is selected based on having the highest battery-level compared with the other battery powered thermostats in the thermostat reporting group. For example, thermostat <b>1204</b> in <figref idref="DRAWINGS">FIG. 12A</figref> has the highest charged battery in the group and is thus selected as the proxy reporting thermostat.</p>
<p id="p-0131" num="0130">Over time, the proxy reporting thermostat gathers events recorded from each of the thermostats in the thermostat reporting group. (<b>1220</b>) Proxy reporting thermostat may collect these events from each thermostat in the thermostat reporting group using a wireless ad-hoc connection or a wireless connection made available through a network access point or router. The proxy reporting thermostat generally continues to collect the data from the other thermostats until storage on the proxy reporting thermostat is full or has reached a maximum allocation for such logs. (<b>1222</b>) For example, a thermostat may have allocated 500 megabytes for storing the log information from multiple thermostats before triggering the upload process.</p>
<p id="p-0132" num="0131">If the storage on the proxy reporting thermostat is full, one embodiment of the proxy reporting thermostat establishes a communication channel to a thermostat management system to store the thermostat events. (<b>1224</b>) For example, this may be connection over the Internet between the thermostat on a private network and the thermostat management system. Next, one embodiment uploads events gathered on the proxy reporting thermostat over the communication channel to the thermostat management system on behalf of the thermostats in the thermostat reporting group. (<b>1226</b>) Once the data in the common event log has been successfully uploaded, embodiments of the present invention clear the storage area on the proxy reporting thermostat of the events gathered from the thermostat reporting group. (<b>1228</b>). This makes way for storage of more events in the event log on the proxy reporting thermostat.</p>
<p id="p-0133" num="0132">In one embodiment, illustrated in <figref idref="DRAWINGS">FIG. 13</figref>, a network communication module may selectively filter messages sent from a server. In this embodiment, a cloud-based management server <b>716</b> may send messages through a public network <b>704</b>. The messages may then be sent from the public network <b>704</b> to a private network <b>702</b> that communicates with a property controller, such as a thermostat. In some embodiments, the property controller may communicate with the private network <b>702</b> via a wireless access device <b>1302</b>, such as a wireless router, an Internet hotspot, an ad hoc broadcast network, and/or the like.</p>
<p id="p-0134" num="0133">According to one embodiment, the wireless access device <b>1302</b> may comprise a router. Many routers used in residential locations include a NAT table that translates public network addresses into private network addresses as described previously herein. Recall that the NAT may be flushed periodically by the router after a specified period of nonuse. In one embodiment, keep alive messages may be sent from the cloud-based management server <b>716</b> to the property controller in order to keep an entry in the NAT operation that is associated with the property controller.</p>
<p id="p-0135" num="0134">According to one embodiment, the property controller may be a thermostat <b>1320</b>. The thermostat <b>1320</b> may include, among other things, a Wi-Fi chip <b>1304</b> and a thermostat processor <b>1316</b>. The thermostat processor <b>1316</b> may operate in at least two different modes. A first mode may be a low-power mode, or a sleep mode, where some of the functions of the thermostat processor <b>1316</b> are not fully operational in order to save power. A second mode may be a high-power mode, or operational mode, where some of the functions that were not fully operational in the low-power mode are operational to a greater extent. In one embodiment, a kernel <b>1312</b> (or other sub-components or sub-routines having equivalent background significance) may run while in the low-power mode, while an application <b>1314</b> may run while in the high-power mode. In one embodiment, when the thermostat processor <b>1316</b> is operating in the low-power mode, an interrupt <b>1322</b> may be received on a designated input of the thermostat processor <b>1316</b> to cause the thermostat processor <b>1316</b> to transition from the low-power mode to the high-power mode. In at least one embodiment, the thermostat processor <b>1316</b> may be implemented by the head unit processor <b>304</b> of <figref idref="DRAWINGS">FIG. 3A</figref>. In another embodiment, the thermostat processor <b>1316</b> may be implemented by the backplate processor <b>316</b> of <figref idref="DRAWINGS">FIG. 3A</figref>, or by a combination of the head unit processor <b>314</b> and the backplate processor <b>316</b>.</p>
<p id="p-0136" num="0135">In one embodiment, the Wi-Fi chip <b>1304</b> may include, among other things, a radio <b>1306</b>, a packet filtering function <b>1308</b>, and a processor <b>1310</b>. In one embodiment, the packet filtering function <b>1308</b> is operated on separate circuitry from the processor <b>1310</b>, while in another embodiment the packet filtering function <b>1308</b> is implemented using the processor <b>1310</b>. The processor <b>1310</b>, like the thermostat processor <b>1316</b>, may operate in at least a high-power mode and a low-power mode, possibly a sleep state and an operating state. In order to save power, the Wi-Fi chip <b>1304</b> may operate in a low-power state until messages are received from the wireless access device <b>1302</b>.</p>
<p id="p-0137" num="0136">In one embodiment, when the radio <b>1306</b> receives a message, it may pass the message to the packet filtering function <b>1308</b> prior to waking up the processor <b>1310</b>. The packet filtering function <b>1308</b> may examine one or more fields within the message to determine whether the processor <b>1310</b> should wake up. In some cases, the radio <b>1306</b> may receive any messages that are electronically receivable by an antenna <b>1330</b> communicatively coupled to the radio <b>1306</b>. The data filtering function <b>1308</b> may check the address of the messages to determine whether or not they are intended for the thermostat <b>1320</b>. Messages that are not for the thermostat <b>1320</b> may be discarded without waking the processor <b>1310</b>. Messages that are properly addressed to the thermostat <b>1320</b> may require further processing.</p>
<p id="p-0138" num="0137">In one embodiment, some of the messages properly addressed to the thermostat <b>1320</b> may also be discarded in a similar fashion to messages that were not properly addressed to the thermostat <b>1320</b>. For example, keep-alive messages sent from the cloud-based management server <b>716</b> that are merely intended to maintain an entry in the NAT of the wireless access device <b>1302</b> may be discarded without requiring additional processing. A keep-alive message will generally be addressed to the thermostat <b>1320</b>; however, the packet filtering function <b>1308</b> may examine additional fields in addition to the address fields of the message in order to determine whether the message is a keep-alive message. In one embodiment, a single bit may represent a flag signifying a keep-alive message. If the packet filtering function <b>1308</b> determines that a message is not a keep-alive message and is properly addressed, the packet filtering function <b>1308</b> may wake up the processor <b>1310</b> for further processing. In one embodiment, the packet filtering function <b>1308</b> may be implemented using a simple mask that is compared bit by bit to one or more fields in a received message.</p>
<p id="p-0139" num="0138">In one embodiment, the processor <b>1310</b> may examine one or more fields within the message to determine whether it should wake up the thermostat processor <b>1316</b>. In some cases, this may mean causing the thermostat processor to transition from the low-power state to the high-power state by sending an interrupt <b>1322</b>. The processor <b>1310</b> may also communicate with the thermostat processor <b>1316</b> via data communication lines <b>1324</b>. The data communication lines <b>1324</b> may be implemented using any data communication protocol, such as SDIO, USB, I<sup>2</sup>C, RS-232, and/or the like. In one embodiment, the processor <b>1310</b> may determine whether the message contains information of high thermostatic importance or information critical to the operation of the thermostat <b>1320</b>. Messages of high thermostatic importance may be passed to the thermostat processor <b>1320</b>, while messages of low thermostatic importance may be discarded and/or saved until the thermostat processor <b>1316</b> is awakened for other reasons.</p>
<p id="p-0140" num="0139">In addition to discarding keep-alive messages, the packet filtering function <b>1308</b> may additionally filter messages based on the port number. For example, a plurality of communication channel may be established, and the packet filtering function <b>1308</b> may discard messages based on the communication channel by which they were received. In another embodiment, the packet filtering function <b>1308</b> may pass these messages to the processor <b>1310</b>, which may then determine whether to discard the message based on the communication channel by which it was received. In light of this disclosure it will be understood that combinations of these methods for preserving power in the thermostat <b>1320</b> by selectively processing messages received from the wireless access device <b>1302</b> may be used depending on the particular application. For example, keep alive messages may be filtered, along with messages based on thermostatic importance and/or messages based on port number.</p>
<p id="p-0141" num="0140"><figref idref="DRAWINGS">FIG. 14</figref> illustrates a thermostat <b>1400</b> according to a preferred embodiment, the thermostat <b>1400</b> comprising selected feature combinations that have been found to be particularly advantageous for the facilitation of do-it-yourself thermostat installation, the accommodation of a variety of different practical installation scenarios (including scenarios where a &#x201c;C&#x201d; power wire is not available), the provisioning of relatively power-intensive advanced interfaces and functionalities (e.g., a large visually pleasing electronic display, a relatively powerful general purpose microprocessor, and a reliable Wi-Fi communications chip) even where a &#x201c;C&#x201d; power wire is not available, the facilitation of operational robustness and durability, compact device size, quietness of operation, and other advantageous characteristics described in the instant disclosure and/or the commonly assigned incorporated applications. In the discussion that follows, the following HVAC wiring shorthand notations are used: W (heat call relay wire); Y (cooling call relay wire); Rh (heat call relay power); Rc (cooling call relay power); G (fan call relay wire); O/B (heat pump call relay wire); AUX (auxiliary call relay wire); and C (common wire).</p>
<p id="p-0142" num="0141">The Rh wire, which leads to one side of the HVAC power transformer (or simply &#x201c;HVAC transformer&#x201d;) that is associated with a heating call relay, can go by different names in the art, which can include heating call switch power wire, heat call power return wire, heat return wire, return wire for heating, or return for heating. The Rc wire, which leads to one side of the HVAC transformer that is associated with a cooling call relay, can likewise go by different names including cooling call switch power wire, cooling call power return wire, cooling return wire, return wire for cooling, or return for cooling. In the case of single-HVAC-transformer systems having both heating and cooling functions, it is one and the same HVAC power transformer that is associated with both the heating call relay and cooling call relay, and in such cases there is just a single wire, usually labeled &#x201c;R&#x201d;, leading back to one side of that HVAC transformer, which likewise can go by different names in the art including call switch power wire, call relay power wire, call power return wire, power return wire, or simply return wire.</p>
<p id="p-0143" num="0142">As illustrated generally in <figref idref="DRAWINGS">FIG. 14</figref>, the thermostat <b>1400</b> comprises a head unit <b>1402</b> and a backplate <b>1404</b>. The backplate <b>1404</b> comprises a plurality of FET switches <b>1406</b> used for carrying out the essential thermostat operations of connecting or &#x201c;shorting&#x201d; one or more selected pairs of HVAC wires together according to the desired HVAC operation. The details of FET switches <b>1406</b>, each of which comprises a dual back-to-back FET configuration, can be found elsewhere in the instant disclosure and/or in the commonly assigned U.S. Ser. No. 13/034,674, supra. The operation of each of the FET switches <b>1406</b> is controlled by a backplate microcontroller <b>1408</b> which can comprise, for example, an MSP430 16-bit ultra-low power RISC mixed-signal microprocessor available from Texas Instruments.</p>
<p id="p-0144" num="0143">Thermostat <b>1400</b> further comprises powering circuitry <b>1410</b> that comprises components contained on both the backplate <b>1404</b> and head unit <b>1402</b>. Generally speaking, it is the purpose of powering circuitry <b>1410</b> to extract electrical operating power from the HVAC wires and convert that power into a usable form for the many electrically-driven components of the thermostat <b>1400</b>. Thermostat <b>1400</b> further comprises insertion sensing components <b>1412</b> configured to provide automated mechanical and electrical sensing regarding the HVAC wires that are inserted into the thermostat <b>1400</b>. Thermostat <b>1400</b> further comprises a relatively high-power head unit microprocessor <b>1432</b>, such as an AM3703 Sitara ARM microprocessor available from Texas Instruments, that provides the main general governance of the operation of the thermostat <b>1400</b>. Thermostat <b>1400</b> further comprises head unit/backplate environmental sensors <b>1434</b>/<b>1438</b> (e.g., temperature sensors, humidity sensors, active IR motion sensors, passive IR motion sensors, ambient visible light sensors, accelerometers, ambient sound sensors, ultrasonic/infrasonic sound sensors, etc.), as well as other components <b>1436</b> (e.g., electronic display devices and circuitry, user interface devices and circuitry, wired communications circuitry, wireless communications circuitry such as Wi-Fi and/or ZigBee chips) that are operatively coupled to the head unit microprocessor <b>1432</b> and/or backplate microprocessor <b>1408</b> and collectively configured to provide the functionalities described in the instant disclosure and/or the commonly assigned incorporated applications.</p>
<p id="p-0145" num="0144">The insertion sensing components <b>1412</b> include a plurality of HVAC wiring connectors <b>1414</b>, each containing an internal springable mechanical assembly that, responsive to the mechanical insertion of a physical wire thereinto, will mechanically cause an opening or closing of one or more dedicated electrical switches associated therewith. Exemplary configurations for each of the HVAC wiring connectors <b>1414</b> can be found in the commonly assigned U.S. 13/034,666, supra. With respect to the HVAC wiring connectors <b>1414</b> that are dedicated to the C, W, Y, Rc, and Rh terminals, those dedicated electrical switches are, in turn, networked together in a manner that yields the results that are illustrated in <figref idref="DRAWINGS">FIG. 14</figref> by the blocks <b>1416</b> and <b>1418</b>. For clarity of presentation in <figref idref="DRAWINGS">FIG. 14</figref>, the block <b>1416</b> is shown as being coupled to the internal sensing components <b>1412</b> by virtue of double lines termed &#x201c;mechanical causation,&#x201d; for the purpose of denoting that the output of block <b>1416</b> is dictated solely by virtue of the particular combination of HVAC wiring connectors <b>1414</b> into which wires have been mechanically inserted. More specifically, the output of block <b>1416</b>, which is provided at a node <b>1419</b>, is dictated solely by virtue of the particular combination of C, W, and Y connectors into which wires have been mechanically inserted. Still more specifically, the output of block <b>1416</b> at node <b>1419</b> is provided in accordance with the following rules: if a wire is inserted into the C connector, then the node <b>1419</b> becomes the C node regardless of whether there are any wires inserted into the Y or W connectors; if no wire is inserted into the C connector and a wire is inserted into the Y connector, then the node <b>1419</b> becomes the Y node regardless of whether there is a wire inserted into the W connector; and if no wire is inserted into either of the C or Y connectors, then the node <b>1419</b> becomes the W node. Exemplary configurations for achieving the functionality of block <b>1416</b> (as combined with components <b>1412</b> and wiring connectors <b>1414</b>) can be found elsewhere in the instant disclosure and/or in the commonly assigned U.S. Ser. No. 13/034,678, supra. It is to be appreciated that, although mechanical causation for achieving the functionality of block <b>1416</b> (as combined with components <b>1412</b> and wiring connectors <b>1414</b>) has been found to be particularly advantageous for simplicity and do-it-yourself (&#x201c;DIY&#x201d;) foolproofing, in other embodiments there can be similar functionalities carried out electrically, magnetically, optically, electro-optically, electro-mechanically, etc. without departing from the scope of the present teachings. Thus, for example, similar results could be obtained by using optically, electrically, and/or magnetically triggered wire insertion sensing components that are coupled to relays or electronic switches that carry out the functionality of block <b>1416</b> (as combined with components <b>1412</b> and wiring connectors <b>1414</b>) without departing from the scope of the present teachings.</p>
<p id="p-0146" num="0145">Likewise, for clarity of presentation in <figref idref="DRAWINGS">FIG. 14</figref>, the block <b>1418</b> is also shown as being coupled to the internal sensing components <b>1412</b> by virtue of double lines termed &#x201c;mechanical causation,&#x201d; for the purpose of denoting that its operation, which is either to short the Rc and Rh nodes together or not to short the Rc and Rh nodes together, is dictated solely by virtue of the particular combination of HVAC wiring connectors <b>1414</b> into which wires have been mechanically inserted. More specifically, whether the block <b>1418</b> will short, or not short, the Rc and Rh nodes together is dictated solely by virtue of the particular combination of Rc and Rh connectors into which wires have been mechanically inserted. Still more specifically, the block <b>1418</b> will keep the Rc and Rh nodes shorted together, unless wires have been inserted into both the Rc and Rh connectors, in which case the block <b>1418</b> will not short the Rc and Rh nodes together because a two-HVAC-transformer system is present. Exemplary configurations for achieving the functionality of block <b>1418</b> (as combined with components <b>1412</b> and wiring connectors <b>1414</b>) can be found elsewhere in the instant disclosure and/or in the commonly assigned U.S. Ser. No. 13/034,674, supra. It is to be appreciated that, although mechanical causation for achieving the functionality of block <b>1418</b> (as combined with components <b>1412</b> and wiring connectors <b>1414</b>) has been found to be particularly advantageous for simplicity and do-it-yourself (&#x201c;DIY&#x201d;) foolproofing, in other embodiments there can be similar functionalities carried out electrically, magnetically, optically, electro-optically, electro-mechanically, etc., in different combinations, without departing from the scope of the present teachings. Thus, for example, similar results could be obtained by using optically, electrically, and/or magnetically triggered wire insertion sensing components that are coupled to relays or electronic switches that carry out the functionality of block <b>1418</b> (as combined with components <b>1412</b> and wiring connectors <b>1414</b>) without departing from the scope of the present teachings.</p>
<p id="p-0147" num="0146">As illustrated in <figref idref="DRAWINGS">FIG. 14</figref>, the insertion sensing circuitry <b>1412</b> is also configured to provide electrical insertion sensing signals <b>1413</b> to other components of the thermostat <b>1400</b>, such as the backplate microcontroller <b>1408</b>. Preferably, for each of the respective HVAC wiring terminal <b>1414</b>, there is provided at least two signals in electrical form to the microcontroller <b>1408</b>, the first being a simple &#x201c;open&#x201d; or &#x201c;short&#x201d; signal that corresponds to the mechanical insertion of a wire, and the second being a voltage or other level signal (in analog form or, optionally, in digitized form) that represents a sensed electrical signal at that terminal (as measured, for example, between that terminal and an internal thermostat ground node). Exemplary configurations for providing the sensed voltage signal can be found elsewhere in the instant disclosure and/or in the commonly assigned U.S. Ser. No. 13/034,674, supra. The first and second electrical signals for each of the respective wiring terminals can advantageously be used as a basis for basic &#x201c;sanity checking&#x201d; to help detect and avoid erroneous wiring conditions. For example, if there has been a wire inserted into the &#x201c;C&#x201d; connector, then there should be a corresponding voltage level signal sensed at the &#x201c;C&#x201d; terminal, and if that corresponding voltage level signal is not present or is too low, then an error condition is indicated because there should always be a voltage coming from one side of the HVAC power transformer (assuming that HVAC system power is on, of course). As another example, if there has been a wire inserted into the &#x201c;O/B&#x201d; connector (heat pump call relay wire) but no wire has been inserted into the &#x201c;Y&#x201d; connector (cooling call relay wire), then an error condition is indicated because both of these wires are needed for proper heat pump control. Exemplary ways for conveying proper and/or improper wiring status information to the user can be found elsewhere in the instant disclosure and/or in the commonly assigned U.S. Ser. No. 13/269,501, supra.</p>
<p id="p-0148" num="0147">Basic operation of each of the FET switches <b>1406</b> is achieved by virtue of a respective control signal (OFF or ON) provided by the backplate microcontroller <b>1408</b> that causes the corresponding FET switch <b>1406</b> to &#x201c;connect&#x201d; or &#x201c;short&#x201d; its respective HVAC lead inputs for an ON control signal, and that causes the corresponding FET switch <b>1406</b> to &#x201c;disconnect&#x201d; or &#x201c;leave open&#x201d; or &#x201c;open up&#x201d; its respective HVAC lead inputs for an OFF control signal. For example, the W&#x2014;Rh FET switch keeps the W and Rh leads disconnected from each other unless there is an active heating call, in which case the W&#x2014;Rh FET switch shorts the W and Rh leads together. As a further example, the Y-Rc FET switch keeps the Y and Rc leads disconnected from each other unless there is an active cooling call, in which case the Y-Rc FET switch shorts the Y and Rc leads together. (There is one exception to this basic operation for the particular case of &#x201c;active power stealing&#x201d; that is discussed in more detail infra, in which case the FET switch corresponding to the HVAC lead from which power is being stolen is opened up for very brief intervals during an active call involving that lead. Thus, if power-stealing is being performed using the Y lead, then during an active cooling call the Y-Rc FET switch is opened up for very brief intervals from time to time, these brief intervals being short enough such that the Y HVAC relay does not un-trip.)</p>
<p id="p-0149" num="0148">Advantageously, by virtue of the above-described operation of block <b>1418</b>, it is automatically the case that for single-transformer systems having only an &#x201c;R&#x201d; wire (rather than separate Rc and Rh wires as would be present for two-transformer systems), that &#x201c;R&#x201d; wire can be inserted into either of the Rc or Rh terminals, and the Rh&#x2014;Rc nodes will be automatically shorted to form a single &#x201c;R&#x201d; node, as needed for proper operation. In contrast, for dual-transformer systems, the insertion of two separate wires into the respective Rc and Rh terminals will cause the Rh&#x2014;Rc nodes to remain disconnected to maintain two separate Rc and Rh nodes, as needed for proper operation. The G-Rc FET switch keeps the G and Rc leads disconnected from each other unless there is an active fan call, in which case the G-Rc FET switch shorts the G and Rc leads together (and, advantageously, the proper connection will be achieved regardless of whether the there is a single HVAC transformer or dual HVAC transformers because the Rc and Rh terminals will be automatically shorted or isolated accordingly). The AUX-Rh FET switch keeps the AUX and Rh leads disconnected from each other unless there is an active AUX call, in which case the AUX-Rh FET switch shorts the AUX and Rh leads together (and, advantageously, the proper connection will be achieved regardless of whether the there is a single HVAC transformer or dual HVAC transformers because the Rc and Rh terminals will be automatically shorted or isolated accordingly). For heat pump calls, the O/B-Rc FET switch and Y-Rc FET switch are jointly operated according to the required installation-dependent convention for forward or reverse operation (for cooling or heating, respectively), which convention can advantageously be determined automatically (or semi-automatically using feedback from the user) by the thermostat <b>1400</b> as described further in the commonly assigned PCT/US12/30084, supra.</p>
<p id="p-0150" num="0149">Referring now to the powering circuitry <b>1410</b> in <figref idref="DRAWINGS">FIG. 14</figref>, advantageously provided is a configuration that automatically adapts to the powering situation presented to the thermostat <b>1400</b> at the time of installation and thereafter in a manner that has been found to provide a good combination of robustness, adaptability, and foolproofness. The powering circuitry <b>1410</b> comprises a full-wave bridge rectifier <b>1420</b>, a storage and waveform-smoothing bridge output capacitor <b>1422</b> (which can be, for example, on the order of 30 microfarads), a buck regulator circuit <b>1424</b>, a power-and-battery (PAB) regulation circuit <b>1428</b>, and a rechargeable lithium-ion battery <b>1430</b>. In conjunction with other control circuitry including backplate power management circuitry <b>1427</b>, head unit power management circuitry <b>1429</b>, and the microcontroller <b>1408</b>, the powering circuitry <b>1410</b> is configured and adapted to have the characteristics and functionality described hereinbelow. Description of further details of the powering circuitry <b>1410</b> and associated components can be found elsewhere in the instant disclosure and/or in the commonly assigned U.S. Ser. No. 13/034,678, supra, and U.S. Ser. No. 13/267,871, supra.</p>
<p id="p-0151" num="0150">By virtue of the configuration illustrated in <figref idref="DRAWINGS">FIG. 14</figref>, when there is a &#x201c;C&#x201d; wire presented upon installation, the powering circuitry <b>1410</b> operates as a relatively high-powered, rechargeable-battery-assisted AC-to-DC converting power supply. When there is not a &#x201c;C&#x201d; wire presented, the powering circuitry <b>1410</b> operates as a power-stealing, rechargeable-battery-assisted AC-to-DC converting power supply. As illustrated in <figref idref="DRAWINGS">FIG. 14</figref>, the powering circuitry <b>1410</b> generally serves to provide the voltage Vcc MAIN that is used by the various electrical components of the thermostat <b>1400</b>, and that in one embodiment will usually be about 4.0 volts. As used herein, &#x201c;thermostat electrical power load&#x201d; refers to the power that is being consumed by the various electrical components of the thermostat <b>1400</b>. Thus, the general purpose of powering circuitry <b>1410</b> is to judiciously convert the 24 VAC presented between the input leads <b>1419</b> and <b>1417</b> to a steady 4.0 VDC output at the Vcc MAIN node to supply the thermostat electrical power load. Details relating to bootstrap circuitry (not shown), whose purpose is to provide a kind of cruder, less well-regulated, lower-level electrical power that assists in device start-up and that can act as a kind of short term safety net, are omitted from the present discussion for purposes of clarity of description, although further information on such circuitry can be found in U.S. U.S. Ser. No. 13/034,678, supra.</p>
<p id="p-0152" num="0151">Operation of the powering circuitry <b>1410</b> for the case in which the &#x201c;C&#x201d; wire is present is now described. Although the powering circuitry <b>1410</b> may be referenced as a &#x201c;power-stealing&#x201d; circuit in the general sense of the term, the mode of operation for the case in which the &#x201c;C&#x201d; wire is present does not constitute &#x201c;power stealing&#x201d; per se, because there is no power being &#x201c;stolen&#x201d; from a wire that leads to an HVAC call relay coil (or to the electronic equivalent of an HVAC call relay coil for some newer HVAC systems). For the case in which the &#x201c;C&#x201d; wire is present, there is no need to worry about accidentally tripping (for inactive power stealing) or untripping (for active power stealing) an HVAC call relay, and therefore relatively large amounts of power can be assumed to be available from the input at nodes <b>1419</b>/<b>1417</b>. When the 24 VAC input voltage between nodes <b>1419</b> and <b>1417</b> is rectified by the full-wave bridge rectifier <b>1420</b>, a DC voltage at node <b>1423</b> is present across the bridge output capacitor <b>1422</b>, and this DC voltage is converted by the buck regulator <b>1424</b> to a relatively steady voltage, such as 4.45 volts, at node <b>1425</b>, which provides an input current I<sub>BP </sub>to the power-and-battery (PAB) regulation circuit <b>1428</b>.</p>
<p id="p-0153" num="0152">The microcontroller <b>1408</b> controls the operation of the powering circuitry <b>1410</b> at least by virtue of control leads leading between the microcontroller <b>1408</b> and the PAB regulation circuit <b>1428</b>, which for one embodiment can include an LTC4085-3 chip available from Linear Technologies Corporation. The LTC4085-3 is a USB power manager and Li-Ion/Polymer battery charger originally designed for portable battery-powered applications. The PAB regulation circuit <b>1428</b> provides the ability for the microcontroller <b>1408</b> to specify a maximum value I<sub>BP</sub>(max) for the input current I<sub>BP</sub>. The PAB regulation circuit <b>1428</b> is configured to keep the input current at or below I<sub>BP</sub>(max), while also providing a steady output voltage Vcc, such as 4.0 volts, while also providing an output current Icc that is sufficient to satisfy the thermostat electrical power load, while also tending to the charging of the rechargeable battery <b>1430</b> as needed when excess power is available, and while also tending to the proper discharging of the rechargeable battery <b>1430</b> as needed when additional power (beyond what can be provided at the maximum input current I<sub>BP</sub>(max)) is needed to satisfy the thermostat electrical power load. If it is assumed for the sake of clarity of explanation that the voltages at the respective input, output, and battery nodes of the PAB regulation circuit <b>1428</b> are roughly equal, the functional operation of the PAB regulation circuit <b>1428</b> can be summarized by relationship I<sub>BP</sub>=Icc+I<sub>BAT</sub>, where it is the function of the PAB regulation circuit <b>1428</b> to ensure that I<sub>BP </sub>remains below I<sub>BP</sub>(max) at all times, while providing the necessary load current Icc at the required output voltage Vcc even for cases in which Icc is greater than I<sub>BP</sub>(max). The PAB regulation circuit <b>1428</b> is configured to achieve this goal by regulating the value of I<sub>BAT </sub>to charge the rechargeable battery <b>1430</b> (I<sub>BAT</sub>&#x3e;0) when such charge is needed and when Icc is less than I<sub>BP</sub>(max), and by regulating the value of I<sub>BAT </sub>to discharge the rechargeable battery <b>1430</b> (I<sub>BAT</sub>&#x3c;0) when Icc is greater than I<sub>BP</sub>(max).</p>
<p id="p-0154" num="0153">For one embodiment, for the case in which the &#x201c;C&#x201d; wire is present, the value of I<sub>BP</sub>(max) for the PAB regulation circuit <b>1428</b> is set to a relatively high current value, such as 100 mA, by the microcontroller <b>1408</b>. Assuming a voltage of about 4.45 volts at node <b>1425</b>, this corresponds to a maximum output power from the buck regulator <b>1424</b> of about 445 mW. Advantageously, by virtue of the rechargeable battery-assisted operation described above, the powering circuitry <b>1410</b> can provide instantaneous thermostat electrical power load levels higher than 445 mW on an as-needed basis by discharging the rechargeable battery, and then can recharge the rechargeable battery once the instantaneous thermostat electrical power load goes back down. Generally speaking, depending especially on the instantaneous power usage of the large visually pleasing electronic display (when activated by the user coming close or manipulating the user interface), the high-powered microprocessor <b>1432</b> (when not in sleep mode), and the Wi-Fi chip (when transmitting), the instantaneous thermostat electrical power load can indeed rise above 445 mW by up to several hundred additional milliwatts. For preferred embodiments in which the rechargeable battery <b>1430</b> has a capacity in the several hundreds of milliamp-hours (mAh) at or near the nominal Vcc voltage levels (e.g., 560 mAh at 3.7 volts), supplying this amount of power is generally not problematic, even for extended time periods (even perhaps up to an hour or more), provided only that there are sufficient periods of lower-power usage below 445 mW in which the rechargeable battery <b>1430</b> can be recharged. The thermostat <b>1400</b> is configured such that this is easily the case, and indeed is designed such that the average power consumption is below a much lower threshold power than this, as discussed further below in the context of &#x201c;active power stealing.&#x201d;</p>
<p id="p-0155" num="0154">Operation of the powering circuitry <b>1410</b> for the case in which the &#x201c;C&#x201d; wire is not present is now described. For such case, in accordance with the above-described operation of insertion sensing components/switches <b>1412</b>/<b>1416</b>, it will be the Y-lead that is connected to the node <b>1419</b> if a &#x201c;Y&#x201d; wire has been inserted, and it will otherwise be the W-lead that is connected to the node <b>1419</b> if no &#x201c;Y&#x201d; wire has been inserted. Stated differently, it will be the Y-lead from which &#x201c;power is stolen&#x201d; if a &#x201c;Y&#x201d; wire has been inserted, and it will otherwise be the W-lead from which &#x201c;power is stolen&#x201d; if no &#x201c;Y&#x201d; wire has been inserted. As used herein, &#x201c;inactive power stealing&#x201d; refers to the power stealing that is performed during periods in which there is no active call in place based on the lead from which power is being stolen. Thus, for cases where it is the &#x201c;Y&#x201d; lead from which power is stolen, &#x201c;inactive power stealing&#x201d; refers to the power stealing that is performed when there is no active cooling call in place. As used herein, &#x201c;active power stealing&#x201d; refers to the power stealing that is performed during periods in which there is an active call in place based on the lead from which power is being stolen. Thus, for cases where it is the &#x201c;Y&#x201d; lead from which power is stolen, &#x201c;active power stealing&#x201d; refers to the power stealing that is performed when there is an active cooling call in place.</p>
<p id="p-0156" num="0155">Operation of the powering circuitry <b>1410</b> for &#x201c;inactive power stealing&#x201d; is now described. In the description that follows it will be assumed that the &#x201c;Y&#x201d; wire has been inserted and therefore that power is to be stolen from the Y-lead, with it being understood that similar counterpart operation based on the &#x201c;W&#x201d; lead applies if no &#x201c;Y&#x201d; wire has been inserted and power is to be stolen from the W-lead. During inactive power stealing, power is stolen from between the &#x201c;Y&#x201d; wire that appears at node <b>1419</b> and the Rc lead that appears at node <b>1417</b>. As discussed previously, the Rc lead will be automatically shorted to the Rh lead (to form a single &#x201c;R&#x201d; lead) for a single-HVAC transformer system, while the Rc lead will be automatically segregated from the Rh lead for a dual-HVAC transformer system. In either case, there will be a 24 VAC HVAC transformer voltage present across nodes <b>1419</b>/<b>1417</b> when no cooling call is in place (i.e., when the Y-Rc FET switch is open). For one embodiment, the maximum current I<sub>BP</sub>(max) is set to a relatively modest value, such as 20 mA, for the case of inactive power stealing. Assuming a voltage of about 4.45 volts at node <b>1425</b>, this corresponds to a maximum output power from the buck regulator <b>1424</b> of about 90 mW. The power level of 90 mW has been found to be a generally &#x201c;safe&#x201d; power stealing level for inactive power stealing, where the term &#x201c;safe&#x201d; is used to indicate that, at such power level, all or virtually all HVAC cooling call relays that are installed in most residential and commercial HVAC systems will not accidentally trip into an &#x201c;on&#x201d; state due to the current following through the cooling call relay coil. During this time period, the PAB regulator <b>1428</b> operates to discharge the battery <b>1430</b> during any periods of operation in which the instantaneous thermostat electrical power load rises above 90 mW, and to recharge the battery (if needed) when the instantaneous thermostat electrical power load drops below 90 mW. Provided that the rechargeable battery <b>1430</b> is selected to have sufficient capacity (such as 560 mAh at 3.7 volts as discussed above), supplying power at above 90 mW (even several hundred milliwatts more) is generally not problematic even for extended time periods (even perhaps up to an hour or more), provided only that there are sufficient periods of lower-power usage below 90 mW in which the rechargeable battery <b>1430</b> can be recharged. The thermostat <b>1400</b> is configured such that the average power consumption is well below 90 mW, and indeed for some embodiments is even below 10 mW on a long term time average.</p>
<p id="p-0157" num="0156">According to one embodiment, the powering circuitry <b>1410</b> is further monitored and controlled during inactive power stealing by the microcontroller <b>1408</b> by virtue of monitoring the voltage V<sub>BR </sub>across the bridge output capacitor <b>1422</b> at node <b>1423</b> that leads into the buck regulator <b>1424</b>. For the embodiment of <figref idref="DRAWINGS">FIG. 14</figref>, the voltage VBR is monitored directly by virtue of an analog to digital converter (&#x201c;ADC&#x201d;) that is built into the microcontroller <b>1408</b>. According to an embodiment, the voltage V<sub>BR </sub>across the bridge output capacitor <b>1422</b> can be monitored, either on a one-time basis, a periodic basis, or a continuous basis to assess a general &#x201c;strength&#x201d; of the HVAC system with respect to the power that can be safely provided during inactive power stealing. This assessment can then be used to adjust a determination for the maximum &#x201c;safe&#x201d; amount of power that can be provided at the output of buck regulator <b>1424</b> during inactive power stealing, which can in turn be implemented by the microcontroller <b>1408</b> by setting the maximum input current I<sub>BP</sub>(max) of the PAB regulator <b>1428</b> for inactive power stealing. In one particularly advantageous embodiment, at the outset of an inactive power stealing period (either on a one-time basis after thermostat installation or on ongoing basis as desired), the microcontroller <b>1408</b> initially sets the maximum current I<sub>BP</sub>(max) to zero and measures the resultant voltage V<sub>BR</sub>. This &#x201c;open-circuit&#x201d; value of V<sub>BR </sub>will typically be, for example, somewhere around 30 volts. The microcontroller <b>1408</b> then sets the maximum current I<sub>BP</sub>(max) to 20 mA and measures the resultant voltage V<sub>BR</sub>. If the value of V<sub>BR </sub>when I<sub>BP</sub>(max)=20 mA remains roughly the same as its open-circuit value (less than a predetermined threshold difference, for example), then it is determined that the HVAC system is &#x201c;strong enough&#x201d; at the Y-lead to accommodate a higher value for the maximum current I<sub>BP</sub>(max), and the microcontroller <b>1408</b> increases the maximum current I<sub>BP</sub>(max) to 40 mA (corresponding to a maximum &#x201c;safe&#x201d; power stealing level of about 180 mW assuming 4.45 volts). On the other hand, if the value of V<sub>BR </sub>when I<sub>BP</sub>(max)=20 mA tends to sag relative to its open-circuit value (greater than the predetermined threshold difference, for example), then it is determined that the HVAC system is not &#x201c;strong enough&#x201d; at the Y-lead to accommodate an increased maximum current I<sub>BP</sub>(max), and its value will remain fixed at 20 mA. Optionally, this process can be repeated to further increase the maximum current I<sub>BP</sub>(max) to successively higher levels, although care should be taken to ensure by empirical testing with a target population of HVAC systems that the cooling call relay will not be tripped at such higher levels during inactive power stealing. For one embodiment, the process stops when I<sub>BP</sub>(max)=40 mA, to avoid accidental cooling call relay tripping across a very large population of HVAC systems.</p>
<p id="p-0158" num="0157">Operation of the powering circuitry <b>1410</b> for &#x201c;active power stealing&#x201d; is now described. In the description that follows it will be assumed that the &#x201c;Y&#x201d; wire has been inserted and therefore that power is to be stolen from the Y-lead, with it being understood that similar counterpart operation based on the &#x201c;W&#x201d; lead applies if no &#x201c;Y&#x201d; wire has been inserted. During an active cooling call, it is necessary for current to be flowing through the HVAC cooling call relay coil sufficient to maintain the HVAC cooling call relay in a &#x201c;tripped&#x201d; or ON state at all times during the active cooling call. In the absence of power stealing, this would of course be achieved by keeping the Y-Rc FET switch <b>1406</b> in ON state at all times to short the Y and Rc leads together. To achieve active power stealing, the microcontroller <b>1408</b> is configured by virtue of circuitry denoted &#x201c;PS MOD&#x201d; to turn the Y-Rc FET switch OFF for small periods of time during the active cooling call, wherein the periods of time are small enough such that the cooling call relay does not &#x201c;un-trip&#x201d; into an OFF state, but wherein the periods of time are long enough to allow inrush of current into the bridge rectifier <b>1420</b> to keep the bridge output capacitor <b>1422</b> to a reasonably acceptable operating level. For one embodiment, this is achieved in a closed-loop fashion in which the microcontroller <b>1408</b> monitors the voltage V<sub>BR </sub>at node <b>1423</b> and actuates the signal Y-CTL as necessary to keep the bridge output capacitor <b>1422</b> charged. By way of example, during active power stealing operation, the microcontroller <b>1408</b> will maintain the Y-Rc FET switch in an ON state while monitoring the voltage V<sub>BR </sub>until it drops below a certain lower threshold, such as 8 volts. At this point in time, the microcontroller <b>1408</b> will switch the Y-Rc FET switch into an OFF state and maintain that OFF state while monitoring the voltage V<sub>BR</sub>, which will rise as an inrush of rectified current charges the bridge capacitor <b>1422</b>. Then once the voltage V<sub>BR </sub>rises above a certain upper threshold, such as 10 volts, the microcontroller <b>1408</b> will turn the Y-Rc FET switch back into in an ON state, and the process continues throughout the active power stealing cycling. Although the scope of the present teachings is not so limited, the microcontroller <b>1408</b> is preferably programmed to keep the maximum current I<sub>BP</sub>(max) to a relatively modest level, such as 20 mA (corresponding to a maximum &#x201c;safe&#x201d; power stealing level of about 90 mW assuming 4.45 volts) throughout the active power stealing cycle. The circuit elements are designed and configured such that the ON-OFF cycling of the Y-Rc FET switch occurs at a rate that is much higher than 60 Hz and generally has no phase relationship with the HVAC power transformer, whereby the specter of problems that might otherwise occur due to zero crossings of the 24 VAC voltage signal are avoided. By way of example and not by way of limitation, for some embodiments the time interval required for charging the bridge output capacitor <b>1422</b> from the lower threshold of 8 volts to the upper threshold of 10 volts will be on the order 10 to 100 microseconds, while the time that it takes the bridge output capacitor <b>1422</b> to drain back down to the lower threshold of 8 volts will be on the order of 1 to 10 milliseconds. It has been found that, advantageously, at these kinds of rates and durations for the intermittent &#x201c;OFF&#x201d; state of the Y-Rc FET switch <b>1406</b>, there are very few issues brought about by accidental &#x201c;un-tripping&#x201d; of the HVAC cooling call relay during active power stealing across a wide population of residential and commercial HVAC installations.</p>
<p id="p-0159" num="0158">According to one embodiment, it has been found advantageous to introduce a delay period, such as 60-90 seconds, following the instantiation of an active cooling cycle before instantiating the active power stealing process. This delay period has been found useful in allowing many real-world HVAC systems to reach a kind of &#x201c;quiescent&#x201d; operating state in which they will be much less likely to accidentally un-trip away from the active cooling cycle due to active power stealing operation of the thermostat <b>1400</b>. According to another embodiment, it has been found further advantageous to introduce another delay period, such as 60-90 seconds, following the termination of an active cooling cycle before instantiating the inactive power stealing process. This delay period has likewise been found useful in allowing the various HVAC systems to reach a quiescent state in which accidental tripping back into an active cooling cycle is avoided. Preferably, the microcontroller <b>1408</b> implements the above-described instantiation delays for both active and inactive power stealing by setting the maximum current I<sub>BP</sub>(max) to zero for the required delay period. In some embodiments, the operation of the buck regulator circuit <b>1424</b> is also shut down for approximately the first 10 seconds of the delay period to help ensure that the amount of current being drawn by the powering circuitry <b>1410</b> is very small. Advantageously, the rechargeable-battery-assisted architecture of the powering circuitry <b>1410</b> readily accommodates the above-described instantiation delays in that all of the required thermostat electrical power load can be supplied by the rechargeable battery <b>1430</b> during each of the delay periods.</p>
<p id="p-0160" num="0159">While examples and embodiments have been described, they should not serve to limit any aspect of the present invention. Accordingly, various modifications may be made without departing from the spirit and scope of the invention. Indeed, various methods and system for communicating and operating thermostats, HVACSs and other devices have been provided yet the methods and systems are meant to be illustrative and not limiting as to the scope of the overall invention. It is to be appreciated that the term thermostat, as used hereinabove and hereinbelow, can include thermostats having direct control wires to an HVAC system, and can further include thermostats that do not connect directly with the HVAC system, but that sense an ambient temperature at one location in an enclosure and cooperatively communicate by wired or wireless data connections with a separate thermostat unit located elsewhere in the enclosure, wherein the separate thermostat unit does have direct control wires to the HVAC system. Accordingly, the invention is not limited to the above-described embodiments, but instead is defined by the appended claims in light of their full scope of equivalents.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A thermostat, comprising:
<claim-text>a plurality of heating, ventilation, and air conditioning (HVAC) connectors including a common wire connector and at least one call relay wire connector;</claim-text>
<claim-text>a rechargeable battery;</claim-text>
<claim-text>a power stealing circuit configured to provide electrical power for use by the thermostat and for charging the rechargeable battery at least in part by stealing power from at least one call relay wire coupled to said at least one call relay wire connector such that said electrical power can be provided and said rechargeable battery can be recharged without requiring a common wire to be coupled to said common wire connector;</claim-text>
<claim-text>a processor powered at least in part by the rechargeable battery, wherein:
<claim-text>the processor is configured to operate in a low-power state; and</claim-text>
<claim-text>the processor is configured to operate in a high-power state;</claim-text>
</claim-text>
<claim-text>a wireless communication module operatively coupled to the processor and configured to:
<claim-text>establish and maintain wireless communications with a router, including receiving transmissions from the router;</claim-text>
<claim-text>process the transmissions from the router by discriminating between a first type of transmission and a second type of transmission, wherein:
<claim-text>the first type of transmission comprises keep-alive messages associated with a communication channel between a remote thermostat-controller server and the thermostat, and</claim-text>
<claim-text>the second type of transmission comprises information associated with controlling the HVAC system;</claim-text>
</claim-text>
<claim-text>in response to identifying a transmission of the second type during a time period in which the processor is operating in the low-power state, causing the processor to transition from the low-power state to the high-power state;</claim-text>
</claim-text>
<claim-text>whereby the processor can operate in the low-power state for an extended period of time while a Natural Address Translation (NAT) table entry in the router that is associated with said communication channel between the processor and the remote thermostat-controller server remains maintained during said extended period of time.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The thermostat of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein causing the processor to transition from the low-power state to the high-power state comprises the wireless communication module sending an interrupt to the processor.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The thermostat of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein discriminating between the first type of transmission and the second type of transmission is based at least in part on one or more entries in a filter table of the wireless communication module, wherein the one or more entries are sent from the processor to the wireless communication module.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The thermostat of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the power stealing circuit comprises:
<claim-text>a power extraction circuit configured to extract electrical power from one or more of the plurality of HVAC connectors up to a first level of electrical power; and</claim-text>
<claim-text>a power control circuit coupled to the power extraction circuit, the rechargeable battery, and the processor, wherein the power control circuit is configured such that:
<claim-text>during a first time period in which an electrical load power required by the processor is less than said first level of electrical power, the power control circuit supplies the electrical load power required by the processor and charges the rechargeable battery, if needed, using power from the power extraction circuit; and</claim-text>
<claim-text>during a second time period in which the electrical load power required by the thermostat processing and control circuit is greater than said first level of electrical power, the power control circuit discharges the rechargeable battery and supplies the electrical load power required by the processor using both power from the power extraction circuit and power from the rechargeable battery.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The thermostat of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the wireless communication module is configured to receive the first type of transmission according to at least a first time interval, wherein the first time interval is less than a second time interval, and wherein the second time interval is determined by a maximum time that the router is expected to allow an idle communication channel to persist.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The thermostat of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the processor operating in the low-power state requires less than 100 mW, and wherein the processor operating in the high-power state requires more than 200 mW.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The thermostat of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the wireless communication module operatively is further configured to:
<claim-text>receive transmissions through a second communication channel;</claim-text>
<claim-text>receive an indication that an energy stored in the rechargeable battery is below a threshold;</claim-text>
<claim-text>receive third transmissions through the second communication channel; and</claim-text>
<claim-text>process the third transmissions while the processor is in the low-power state based on the indication that the energy stored in the rechargeable battery is below the threshold.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The thermostat of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein transmissions are classified according to a data priority ranging from a low-priority data type to a high-priority data type, wherein the low-priority data type includes data of lesser thermostatic importance, and wherein the high-priority data type includes data of higher thermostatic importance; and the wireless communication module is further configured to:
<claim-text>receive a third transmission from the remote thermostat-controller server, wherein the third transmission includes data for controlling the HVAC system; and</claim-text>
<claim-text>determine that the third transmission is classified as the low-priority data type, and that the third transmission should not require the processor to transition to the high-power state.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. A method of controlling a thermostat, the method comprising:
<claim-text>providing a plurality of heating, ventilation, and air conditioning (HVAC) connectors including a common wire connector and at least one call relay wire connector;</claim-text>
<claim-text>stealing power from at least one call relay wire coupled to said at least one call relay wire connector such that electrical power can be provided to the thermostat and a rechargeable battery can be recharged without requiring a common wire to be coupled to said common wire connector;</claim-text>
<claim-text>powering a processor at least in part with energy from the rechargeable battery, wherein:
<claim-text>the processor is configured to operate in a plurality of modes, and the plurality of modes is comprised of:
<claim-text>a low-power mode; and</claim-text>
<claim-text>a high-power mode;</claim-text>
</claim-text>
</claim-text>
<claim-text>establishing one or more communication channels with a remote thermostat-controller server through a router;</claim-text>
<claim-text>communicating with the remote thermostat-controller server using a protocol, wherein the protocol comprises:
<claim-text>a time interval that represents a time that the router is expected to maintain the one or more communication channels between transmissions;</claim-text>
<claim-text>a first type of transmission sent from the remote thermostat-controller server at least in part to maintain one of the one or more communication channels at the router, and</claim-text>
<claim-text>a second type of transmission comprising data for controlling an environmental condition;</claim-text>
</claim-text>
<claim-text>discriminating between transmissions of the first type and transmissions of the second type;</claim-text>
<claim-text>in response to identifying a transmission of the first type during a time period in which the processor is operating in the low-power mode; allowing the processor to continue operating in the low-power mode; and</claim-text>
<claim-text>in response to identifying a transmission of the second type during a time period in which the processor is operating in the low-power mode, causing the processor to transition from the low-power mode to the high-power mode, and initiating a change in the environmental condition according to the transmission of the second type.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The method of <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the one or more communication channels comprises a first channel and a second channel.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref>, further comprising:
<claim-text>receiving the transmission of the second type from the remote thermostat-controller server through the first channel;</claim-text>
<claim-text>determining that the transmission of the second type is classified as a high-priority transmission at least in part because it was received through the first channel.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The method of <claim-ref idref="CLM-00009">claim 9</claim-ref>, further comprising sending, to the server, an indication that a power level of the rechargeable battery is below a threshold power.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The method of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein a time interval between transmissions that are received to maintain one of the one or more communication channels is adjusted based on the power level of the rechargeable battery.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The method of <claim-ref idref="CLM-00012">claim 12</claim-ref>, further comprising:
<claim-text>receiving, from the remote thermostat-controller server, a second transmission of the second type through the one or more communication channels;</claim-text>
<claim-text>determining that the second transmission of the second type is classified as a high-priority transmission at least in part because the indication that the power level of the rechargeable battery was below the threshold power was sent to the remote thermostat-controller server; and</claim-text>
<claim-text>in response determining that the second transmission of the second type is classified as a high-priority transmission during a time period in which the processor is operating in the low-power mode, causing the processor to transition from the low-power mode to the high-power mode.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. A system for controlling one or more property functions, the system comprising:
<claim-text>a power manager configured to provide up to a first power for use by the system, comprising:
<claim-text>a power-storage module; and</claim-text>
<claim-text>a power input configured to harvest power from an external source and provide up to a second power, wherein the second power is less than the first power, wherein the power manager is capable of storing excess energy in said power-storage module during time intervals in which the system requires less than said second power, and wherein the power manager is capable of releasing stored power from the power storage module during times in which the system requires more than said second power;</claim-text>
</claim-text>
<claim-text>a processing function configured to:
<claim-text>control the one or more property functions; and</claim-text>
<claim-text>operate in a plurality of modes, wherein the plurality of modes is comprised of:
<claim-text>a first mode, wherein:
<claim-text>the processing function uses a third power; and</claim-text>
<claim-text>the third power is less than the second power; and</claim-text>
</claim-text>
<claim-text>a second mode, wherein:
<claim-text>the processing function uses a fourth power;</claim-text>
<claim-text>the fourth power is higher than the second power; and</claim-text>
<claim-text>the fourth power is not greater than the first power; and</claim-text>
</claim-text>
</claim-text>
</claim-text>
<claim-text>a network-communication module configured to:
<claim-text>establish one or more communication channels to a controller server through a gateway;</claim-text>
<claim-text>utilize a communication protocol with the controller server, wherein the communication protocol includes a time interval that represents a time that the gateway is expected to maintain the one or more communication channels between transmissions;</claim-text>
<claim-text>receive a first transmission from the controller server through the one or more communication channels while the processing function operates in the first mode;</claim-text>
<claim-text>determine that the first transmission was sent from the controller server to maintain one of the one or more communication channels, and that the first transmission does not require the processing function to operate in the second mode;</claim-text>
<claim-text>receive a second transmission from the controller server through the one or more communication channels, wherein the second transmission includes information for controlling the one or more property functions; and</claim-text>
<claim-text>cause the processing function to operate in the second mode after receiving the second transmission.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The system of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the processing function is further configured to process the second transmission, and then to return to operating in the first mode.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The system of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the network-communication module is further configured to:
<claim-text>receive an indication from the power manager of a stored energy level in the power-storage module;</claim-text>
<claim-text>receive a third transmission from the controller server through the one or more communication channels, wherein the third transmission includes data for controlling the one or more property functions; and</claim-text>
<claim-text>determine whether the third transmission should require the processing function to operate in the second mode based on the stored energy level in the power-storage module.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The system of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the second transmission is classified according to a data priority ranging from a low-priority data type to a high-priority data type, wherein the low-priority data type includes data of lesser importance to controlling the one or more property functions, and wherein the high-priority data type includes data of higher importance to controlling the one or more property functions.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The system of <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein the network-communication module is further configured to:
<claim-text>receive a third transmission from the controller server through the one or more communication channels, wherein the third transmission includes data for controlling the one or more property functions; and</claim-text>
<claim-text>determine, if the third transmission is classified as the low-priority data type, that the third transmission should not require the processing function to operate in the second mode.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The system of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the network-communication module is further configured to:
<claim-text>operate in a first network mode;</claim-text>
<claim-text>operate in a second network mode, wherein the network-communication module uses more power in the second network mode than in the first network mode; and</claim-text>
<claim-text>transition from the first network mode to the second network mode when a transmission is received.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
