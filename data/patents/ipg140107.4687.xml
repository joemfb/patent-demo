<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08625775-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08625775</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12852341</doc-number>
<date>20100806</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>729</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>M</subclass>
<main-group>9</main-group>
<subgroup>08</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>10</class>
<subclass>K</subclass>
<main-group>11</main-group>
<subgroup>16</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>A</section>
<class>61</class>
<subclass>F</subclass>
<main-group>11</main-group>
<subgroup>06</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>37940601</main-classification>
<further-classification>37940608</further-classification>
<further-classification>37940613</further-classification>
<further-classification>37940612</further-classification>
<further-classification>37940606</further-classification>
<further-classification>381 714</further-classification>
<further-classification>381 7111</further-classification>
<further-classification>381 7112</further-classification>
</classification-national>
<invention-title id="d2e53">Method and system for reducing echo and noise in a vehicle passenger compartment environment</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6798754</doc-number>
<kind>B1</kind>
<name>Farhang-Boroujeny</name>
<date>20040900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370286</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>7764783</doc-number>
<kind>B1</kind>
<name>Pai et al.</name>
<date>20100700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>37940608</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>2007/0121925</doc-number>
<kind>A1</kind>
<name>Cruz-Zeno et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>37940601</main-classification></classification-national>
</us-citation>
</us-references-cited>
<number-of-claims>9</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>37940601-40616</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>381 714</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>381 7111</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>381 7112</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>5</number-of-figures>
</figures>
<us-related-documents>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>61231834</doc-number>
<date>20090806</date>
</document-id>
</us-provisional-application>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20110033059</doc-number>
<kind>A1</kind>
<date>20110210</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Bhaskar</last-name>
<first-name>Udaya</first-name>
<address>
<city>Germantown</city>
<state>MD</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Lee</last-name>
<first-name>Peng</first-name>
<address>
<city>Rockville</city>
<state>MD</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Bhaskar</last-name>
<first-name>Udaya</first-name>
<address>
<city>Germantown</city>
<state>MD</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Lee</last-name>
<first-name>Peng</first-name>
<address>
<city>Rockville</city>
<state>MD</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<last-name>Doughty</last-name>
<first-name>John L.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>HTI IP, L.L.C.</orgname>
<role>02</role>
<address>
<city>Atlanta</city>
<state>GA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Nguyen</last-name>
<first-name>Duc</first-name>
<department>2651</department>
</primary-examiner>
<assistant-examiner>
<last-name>Gay</last-name>
<first-name>Sonia</first-name>
</assistant-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">An echo cancelling algorithm in a communication device initializes a step size value used in an adaptive echo filter based on a background noise signal power level relative to a power level of a received signal and a power level of an echo estimate relative to an output of an echo canceller. The algorithm then adjusts the step size value. One aspect adjusts the step size based on the detection of large fast fourier transform values at one, or more, disturbing-signal frequencies. Another aspect estimates residual echo energy to adjust an estimated echo energy, which then is used to set a double talk flag if a transmit signal has much more power than the estimated echo signal. Another aspect compares transmit signal power to a decimated version of the transmit signal power and sets the double talk flag if the former exceeds the latter by a predetermined amount.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="143.17mm" wi="247.82mm" file="US08625775-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="250.44mm" wi="160.19mm" orientation="landscape" file="US08625775-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="263.99mm" wi="195.41mm" orientation="landscape" file="US08625775-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="243.67mm" wi="179.07mm" orientation="landscape" file="US08625775-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="262.97mm" wi="197.36mm" file="US08625775-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="207.52mm" wi="184.32mm" file="US08625775-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS REFERENCE TO RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">This application claims priority under 35 USC sec. 119 to U.S. Provisional Patent Applications 61/231,834 having a filing dates of Aug. 6, 2009, which this application incorporates herein by reference in its entirety.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">FIELD</heading>
<p id="p-0003" num="0002">The invention relates to adaptive echo cancellation and noise reduction, and more particularly to a cancelling echo and reducing noise in a vehicle passenger cabin.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0004" num="0003"><figref idref="DRAWINGS">FIG. 1</figref> illustrates a block diagram of an adaptive echo cancellation and noise reducing audio processing system.</p>
<p id="p-0005" num="0004"><figref idref="DRAWINGS">FIG. 2</figref> Illustrates a block diagram of an adaptive echo cancellation system.</p>
<p id="p-0006" num="0005"><figref idref="DRAWINGS">FIG. 3</figref> illustrates a block diagram of a noise reducing system.</p>
<p id="p-0007" num="0006"><figref idref="DRAWINGS">FIG. 4</figref> illustrates a flow diagram of a method for maintaining convergence under double talk and background noise conditions.</p>
<p id="p-0008" num="0007"><figref idref="DRAWINGS">FIG. 5</figref> illustrates a flow diagram of a method for determining the presence of double talk.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0009" num="0008">As a preliminary matter, it will be readily understood by those persons skilled in the art that the present aspects are susceptible of broad utility and application. Many methods, embodiments, aspects, and adaptations other than those herein described, as well as many variations, modifications, and equivalent arrangements, will be apparent from or reasonably suggested without departing from the substance or scope described herein.</p>
<p id="p-0010" num="0009">Accordingly, while a detailed description in relation to preferred embodiments has been given, it is to be understood that this disclosure is only illustrative and exemplary and is made merely for the purposes of providing a full and enabling disclosure. The following disclosure is not intended nor is to be construed to limit or to exclude other embodiments, adaptations, variations, modifications and equivalent arrangements, the present invention being limited only by the claims appended hereto and the equivalents thereof.</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 1</figref> illustrates a high level block diagram of an adaptive echo cancellation (&#x201c;AEC&#x201d;) and noise reduction (&#x201c;NR&#x201d;) system <b>2</b> and the location of the NEC module <b>4</b> and NR module <b>6</b> in relation to a receive signal <b>8</b> and a conditioned transmit signal <b>10</b>. Conditioned transmit signal <b>10</b> is typically a combination of processed versions of the following signals: speech from a near end talker in the car, which is the desired signal; echo of the far end talker's signal acoustically coupled from a loudspeaker to the microphone via a direct path as well as reflections within the vehicle cabin, the echo being an undesired signal; and ambient background noise due to road noise, wind noise, engine noise, etc., which is also an undesired signal. At various stages of processing, microphone signals <b>12</b> may be processed into: a downconverted transmit signal <b>14</b> that includes the same signals converted from mechanical energy to electrical energy by a microphone, converted to a digital signal by an analog to digital convertor (&#x201c;A/D&#x201d;) <b>16</b> and then downconverted, typically by a 2&#xd7; decimator <b>18</b>. After processing by AEC <b>4</b>, the echo cancelled transmit signal <b>20</b> includes the desired near end speech, background noise, and residual echo signal energy, which ideally would be zero. After applying noise reduction by noise reduction module <b>6</b>, conditioned transmit signal <b>10</b> hopefully includes a strong near end speech signal, and relatively weak noise residue and echo residue signals.</p>
<p id="p-0012" num="0011">The AEC module <b>4</b> cancels undesirable echo that would otherwise be present in the transmit signal using the receive, signal <b>8</b> as a reference signal. The echo cancellation task becomes challenging when both near end and far end talkers are simultaneously active, which is a condition known as double talk&#x2014;the condition where only one talker is active at a time is referred to as single talk. Under double talk conditions, cancelling echo of the far end talker's voice without distorting the near end talker signal enhances full duplex conversation.</p>
<p id="p-0013" num="0012">The presence of high levels of background noise presents a challenging condition for AEC performance and double talk detection. The function of the NR module <b>6</b> is to reduce, or suppress, the level of the ambient background noise component in the transmit signal <b>10</b>, with minimal distortion to the near end user's voice signal being transmitted to the far end user. Further, any residual background noise should be mostly free of artifacts and should not subjectively annoy the far end user.</p>
<p id="p-0014" num="0013">Turning now to <figref idref="DRAWINGS">FIG. 2</figref>, the figure shows a high level block diagram of the AEC system <b>4</b>, including linear echo canceller <b>22</b> (linear echo model) and nonlinear echo suppressor (&#x201c;NLP&#x201d;) <b>24</b>. The AEC uses a frequency domain adaptive filtering (&#x201c;FDAF&#x201d;) algorithm <b>26</b> for adapting the linear echo canceller model <b>28</b> to represent the acoustic transfer function between the loudspeaker and the microphone. The echo cancelled signal <b>20</b> is sent to the noise reduction module <b>6</b>. The following description describes techniques for enhancing and improving features, functionality, and performance of an FDAF in the presence of high levels of background noise, double talk, and echo path variation, which are all typical of a vehicle passenger compartment environment.</p>
<p id="p-0015" num="0014">The AEC adaptation algorithm <b>4</b> continuously updates the parameters of an echo model <b>28</b> based on the receive signal <b>8</b> and the echo cancelled transmit signal <b>20</b>. The rate of adaptation is controlled by a scalar step size parameter controlled by adaption control module <b>32</b>. The step size has to be selected carefully to balance the conflicting requirements of convergence speed (to rapidly converge initially and in case of echo path variations) and the ability to track small fluctuations in the echo path after convergence. In addition, under double talk conditions, the step size is reduced or set to zero, effectively freezing the adaptation, to prevent the algorithm from diverging. Since the near end talker signal can act as a disturbance during double talk, freezing adaptation reduces the effects of occurrences that would otherwise mislead the adaptation process. Usually, a double talk detector (&#x201c;DTD&#x201d;) <b>34</b> detects the double talk condition and sends a DTD flag to adaptation control module <b>32</b> to freeze adaptation. However, practical DTD algorithms cannot detect double talk perfectly or instantaneously and some adaptation may occur under double talk conditions, deteriorating the performance of the AEC.</p>
<p id="p-0016" num="0015">Adaptation control is by (a) the product of the fast fourier transform (&#x201c;FFT&#x201d;) vectors of receive signal <b>8</b> and echo canceller output signal <b>36</b> and (b) fixed scalar step size parameter <b>38</b> from adaption control algorithm module <b>32</b>. Even if the FFT product is small for most frequencies (hence small when averaged across the vector), large perturbations to the echo model <b>28</b> can occur even if the FFT product vector has unusually large values at a few isolated frequencies. After echo canceller <b>22</b> has reached convergence, large perturbations are indicative of (a) double talk, (b) high noise levels, or (c) abrupt echo path change. Of these causes, abrupt echo path change is least likely to generate a large perturbation. Large perturbations at isolated frequencies are used by an adaptation control module to control the adaptation step size, so that convergence is better maintained in the presence of above disturbances.</p>
<p id="p-0017" num="0016">To determine an initial step size value sent from the adaption control module <b>32</b> via control path <b>38</b> to FDAF module <b>26</b>, the adaption control module may use values for relative power of receive signal <b>8</b>, transmit input signal (using full band power compute block <b>40</b> for signal <b>12</b> or half band power computer block for signal <b>14</b>), echo canceller output signal <b>36</b>, echo estimate signal <b>41</b>, and/or estimated background noise power level. In an aspect, the method for determining the initial step size value can be determined as summarized by the following step s that may be repeated for every short sample period, or frame, of N samples, where N is typically 128-512 samples/frame, after the initial convergence period, typically 2 seconds.</p>
<p id="p-0018" num="0017">If background noise power is significant compared to the receive signal power <b>8</b>, reducing the adaptation rate helps avoid divergence, since otherwise noise drives the adaptation. Reduction may be achieved according to the following condition statements: if receive signal power&#x3c;=3 dB+background noise power level, the step size is reduced by a factor of 0.01; if receive power&#x3e;10 dB+background noise power level, no reductions in step size; if receive power is between 3 and 10 dB, step size is linearly reduced.</p>
<p id="p-0019" num="0018">Another evaluation determines if power of the echo estimate is significant compared to output of the echo canceller, which could indicate that the echo canceller input contains signals other than echo. In this case, reducing the adaptation also rate helps avoid divergence that double talk or noise might otherwise cause. This is achieved by the following: if echo estimate power&#x3c;=echo canceller output power, step size is reduced by a factor of 0.01; if echo estimate power&#x3e;12 dB+echo canceller output power, no reductions in step size; if the echo estimate signal power falls between 0 and 12 dB, step size is linearly increased.</p>
<p id="p-0020" num="0019">In addition to using relative power levels to initialize the step size, frequency vectors can be used to refine the step size value based on the observation that a disturbing signal (double talk and/or noise) may cause large FFT values at some specific frequencies. This can cause the echo model to diverge at these frequencies. Step size control based on average powers, as described above, does not exploit this frequency specific information since it the averaging aspect of the power computations obscure the power contributions at different frequencies. Using the powers at different frequencies enhances the adjustment of the step size by detecting the occurrence of large values at different frequencies, as summarized here:
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0020">1. In each short term frame, compute the FFT product vector of receive and echo canceller output signals; compute the log-magnitude FFT vector.</li>
    <li id="ul0001-0002" num="0021">2. Use the above short term log-magnitude FFT vector to update a long term time averaged log-magnitude FFT product vector. The long term averaging period is typically 2 sec.</li>
    <li id="ul0001-0003" num="0022">3. Compute the deviation between short term and long term average magnitude FFT vectors. Limit the computation to frequencies in the telephony band, i.e., 200 Hz-3200 Hz.</li>
    <li id="ul0001-0004" num="0023">4. Average the deviations across all frequencies where the short term vector exceeds the long term vector.</li>
    <li id="ul0001-0005" num="0024">5. If the average deviation exceeds a predetermined threshold (3 dB typical), reduce the adaptation step-size. As deviation increases, step size decreases proportionately.</li>
    <li id="ul0001-0006" num="0025">6. Also compute the peak deviation across the telephony band</li>
    <li id="ul0001-0007" num="0026">7. If the peak deviation exceeds a threshold (6 dB typical) further reduce the step size in proportion to the peak deviation.</li>
</ul>
</p>
<p id="p-0021" num="0027">Turning now to <figref idref="DRAWINGS">FIG. 4</figref>, the figure illustrates a flow diagram of a method <b>400</b> for reducing echo and noise using an algorithm running on a communication device. Method <b>400</b> begins at step <b>405</b>, and at step <b>410</b>, the method determines an initial step size based on a background noise signal power level relative to a power level of a received signal <b>8</b> and a power level of an echo estimate <b>26</b> relative to an output of an echo canceller <b>4</b>. At step <b>415</b>, the algorithm determines a cross correlation vector between a receive signal <b>8</b> and transmit signal <b>12</b> (or <b>14</b>)&#x2014;the cross correlation result will have higher values where the transmit signal and the receive signal contain similar energy levels at given frequencies, such as far-end user voice signals and echo thereof. At step <b>420</b> the algorithm determines transmit signal energy and at <b>425</b> determines echo signal energy.</p>
<p id="p-0022" num="0028">The algorithm determines echo signal energy by calculating the inner product of the cross correlation vector from step <b>415</b> and a frequency response vector of the current echo signal. The value of the resultant will be higher the more the cross correlation vector and the frequency response of the echo signal have maximums at the same frequencies.</p>
<p id="p-0023" num="0029">At step <b>430</b>, the algorithm determines a level of double talk by calculating a ratio between the estimated echo energy from step <b>425</b> and the transmit signal <b>12</b> (or <b>14</b>) as shown in <figref idref="DRAWINGS">FIG. 2</figref>. At step <b>435</b>, the algorithm determines an adaptive threshold value from the ration from step <b>430</b>.</p>
<p id="p-0024" num="0030">At step <b>440</b>, the algorithm determines whether the double talk level ratio from step <b>430</b> exceeds the adaptive threshold. If yes, the algorithm sets a double talk detection flag at step <b>445</b> and ends at step <b>450</b>.</p>
<p id="p-0025" num="0031">If the determination at step <b>440</b> is no, the algorithm advances to step <b>455</b> where it determines whether transmit energy minus the energy of the echo of the far end user's signal coupled from a speaker to a microphone and noise from the near user's environment, such as, for example, the passenger compartment of an automobile, exceeds a threshold. In simplified terms, the transmit energy minus the echo energy and the far end user's signal (typically the receive signal) is the residual echo signal power&#x2014;a residual echo signal results when an adaptive echo model does not perfectly model the actual echo and thus does not completely cancel the echo in a given environment. The threshold used in step <b>455</b> is typically predetermined, and may be referred as a single-to-double-talk-state transition threshold that when the transmit energy minus the residual echo energy exceeds it, the algorithm sets the double talk flag at step <b>445</b> and then ends at step <b>450</b>. In an aspect, the single-to-double-talk-state transition threshold is a lower value than a double-to-single-talk-state transition threshold. This results in a hysteresis so that the algorithm doesn't continuously set and clear as it performs the steps of method <b>400</b>, and other related methods such as those described elsewhere herein. Such a condition of setting and clearing is sometimes referred to as &#x2018;thrash&#x2019; and is undesirable.</p>
<p id="p-0026" num="0032">Turning now to <figref idref="DRAWINGS">FIG. 5</figref>, the figure illustrates a flow diagram of a method <b>500</b> for detecting double talk and determining whether to set a double talk flag for use with an adaptive echo cancelling filter. Narrow band telephony voice signals typically occupy a bandwidth of 200 Hz-3200 Hz and are typically sampled at 8 kHz. However, in telematics systems that provide voice recognition functionality, sampling the microphone signal at a sampling rate of 16 kHz improves the accuracy of the recognition system. Since typically a single codec chip provides both analog-to-digital conversion (ADC) and digital-to-analog conversion (DAC), the far-end signal <b>8</b> is also sampled (upsampling may be used) at 16 kHz. This is depicted in the block diagram shown in <figref idref="DRAWINGS">FIG. 1</figref>, which shows 16 kHz DAC <b>44</b> and 16 kHz ADC <b>16</b>. The higher sampling rate inputs <b>14</b> to acoustic echo canceller <b>4</b> present two main disadvantages for the acoustic echo canceller:
<ul id="ul0002" list-style="none">
    <li id="ul0002-0001" num="0033">Increased processing complexity</li>
    <li id="ul0002-0002" num="0034">Reduced algorithm performance due to the higher spectral dynamic range</li>
</ul>
</p>
<p id="p-0027" num="0035">These problems can be overcome by including sample rate conversion at the input and output of the echo canceller and operating the echo canceller at 8 kHz sample rate. However, there is also a potential advantage that can be obtained due to the higher sample rate. Since in most cases receive signal from the narrowband cellular network is telephony bandlimited, the echo signal energy exists only below 4 kHz and is expected to be negligible energy in the 4 kHz-8 kHz band. In contrast, the near end speech signal in microphone signal <b>12</b> can have significant energy in the 4 kHz-8 kHz band for certain types of sounds (e.g., consonants). Further, vehicular noise tends to have a predominantly low pass spectrum and has negligible energy in the 4 kHz-8 kHz band.</p>
<p id="p-0028" num="0036">Exploiting these properties of near and far end signals aids and improves the accuracy of detection of double talk condition. Since the detection of double talk during low level near end signals such as consonants can be problematic, using signal information from microphone transmit signal <b>12</b> and decimated transmit signal <b>14</b> improves the performance of the AEC <b>4</b> by improving the accuracy of double talk detection during double talk conditions. The technique can be summarized by the following steps:
<ul id="ul0003" list-style="none">
    <li id="ul0003-0001" num="0037">1. Before the transmit signal <b>12</b> is decimated to a 8 kHz sample rate, compute power block <b>40</b> of the AEC algorithm <b>4</b> measures full band power of transmit signal <b>12</b> in the 0-8 kHz band.</li>
    <li id="ul0003-0002" num="0038">2. After the 2&#xd7; decimator <b>18</b> decimates, or downconverts or downsamples, transmit signal <b>12</b> to an 8 kHz sample rate, compute power block <b>42</b> measures the low band power of decimated transmit signal <b>14</b> in the 0-4 kHz band.</li>
    <li id="ul0003-0003" num="0039">3. Both power measurements are provided to double talk detector <b>34</b> as inputs. Double talk detector <b>34</b> evaluates the two power values and determines the difference between the full band and low band powers. DTD module <b>34</b> then compares the difference between the two powers to a predetermined threshold (1 dB typical). If the difference exceeds the threshold, this indicates that the near end talker is possibly active and the double talk flag is set to indicate a double talk condition. Otherwise, the state of the double talk flag is not modified&#x2014;if the flag is currently set it is not then cleared when the difference does not exceed the threshold because near end vowel sounds do not have significant energy in the 4 kHz-8 kHz band and thus double talk could be present even if the difference in full and low band power does not exceed the threshold.</li>
</ul>
</p>
<p id="p-0029" num="0040">Returning to the description of <figref idref="DRAWINGS">FIG. 5</figref>, which illustrates setting a double talk flag is the power difference exceeds the predetermined threshold. At step <b>510</b>, method <b>500</b> running in AEC <b>4</b> of <figref idref="DRAWINGS">FIGS. 1 and 2</figref> measures full band power at a first sample rate. Full band is the band over which the sample rate supports. If the sample rate is 16 kHz, as shown in <figref idref="DRAWINGS">FIG. 1</figref>, full band is half of the sample rate, or 8 kHz. At step <b>515</b>, the AEC algorithm converts the transmit signal into a downsampled, or decimated, transmit signal so that it has a second sampling rate and signal power over a second bandwidth. The second sampling rate and bandwidth are lower than the first sampling rate and bandwidth. For example, the 2&#xd7; decimator <b>18</b> shown in <figref idref="DRAWINGS">FIGS. 1 and 2</figref> would convert the transmit signal <b>12</b> from a digital signal having a first sampling rate of 16 kHz and a first bandwidth bandwidth of 0-8 kHz, to a decimated transmit signal having a second sampling rate of 8 kHz and a second bandwidth of 0-4 kHz.</p>
<p id="p-0030" num="0041">Method <b>500</b> measures the power of decimated transmit signal <b>14</b> at step <b>520</b>. Decimated transmit signal <b>14</b> has second sampling rate of 8 kHz and second bandwidth of 0-4 KHz.</p>
<p id="p-0031" num="0042">At step <b>525</b>, the algorithm compares the difference between the measured power level of the transmit signal P<sub>T </sub><b>12</b> and the power level of the decimated transmit signal <b>14</b> P<sub>DT </sub>to a predetermined threshold.</p>
<p id="p-0032" num="0043">If the difference exceeds the threshold as determined at step <b>525</b>, method <b>500</b> follows the &#x2018;Y&#x2019; path to step <b>530</b> and sets a double talk detection flag and then ends at step <b>535</b>. If, however, the difference does not exceed the threshold, the method follows the &#x2018;N&#x2019; path and ends at step <b>535</b>. Method <b>500</b> does not clear the double talk flag if it was already set because the difference in power levels P<sub>T</sub>-P<sub>DT </sub>may not exceed the threshold, even if double talk is present, such as when the near talker does not utter any consonants during a sampling period. In an aspect, the predetermine threshold is 1 dB.</p>
<p id="p-0033" num="0044">In another aspect, an echo path change detector (&#x201c;EPCD&#x201d;) detects sudden changes in echo path, due to, for example, significant movement of the driver or passengers, changes in seat positions etc. EPCD helps reduce the negative effects of these conditions, which reduce the cross correlation between receive and transmit signals (as computed by the DTD), and lead to erroneous DT detections. This in turn freezes the adaptation of echo model leading to poor AEC performance. The EPCD is based on the assumption that AEC will adapt well for slow and gradual echo path changes in echo path and only the abrupt and the drastic changes need to be detected and given special treatment.</p>
<p id="p-0034" num="0045">In an aspect, an EPCD computes the ratio between estimated residual echo energy and estimated echo energy obtained from the unbiased DTD block. While the echo path is changing the ratio calculated above rises suddenly due to the mismatch of the real echo path and estimated one. This ratio will be an indication of echo path change. The decision of echo path change is given by comparing the ratio to a fixed threshold.</p>
<p id="p-0035" num="0046">Once echo path change is detected the adaptive filter step size and product of the FFT vectors of the receive signal and the echo canceller output signal will be initialized. The EPCD will also allow a short period of time (&#x3c;1.5 sec.) without claiming DT. This will ensure the reconvergence of the adaptive filter. During that period of time the nonlinear processor (NLP block) will help the adaptive filter to suppress the residual echo. In simulation the EPCD can detect the abrupt echo path change very accurately and detection delay is very limited under noise interference.</p>
<p id="p-0036" num="0047">A noise reduction (&#x201c;NR&#x201d;) aspect is based on a spectral enhancement algorithm. This algorithm has been adapted for use in a vehicle environment to work with significantly higher noise levels often encountered in telematics applications. <figref idref="DRAWINGS">FIG. 3</figref> illustrates a block diagram of the noise reduction aspect.</p>
<p id="p-0037" num="0048">Instead of operating in the discrete Fourier transform (&#x201c;DFT&#x201d;), using discrete cosine transforms (&#x201c;DCT&#x201d;) provides a better transform for speech signals, since it more closely approximates the ideal Karhunen-Loeve transform. In particular, the noise and speech spectra can be better discriminated in the DCT domain, leading to better performance of the NR algorithm. However, conversion of NR algorithm from DFT to DCT domain processing is not straightforward. Since DFT is a complex valued transform, the DFT of the signal spectrum can be decomposed into magnitude and phase components. Typically, the DFT magnitude is modified by the spectral gain function and subsequently combined with the original phase and inverse DFT is used to recover the noise reduced signal. However, DCT is a real valued transform and provides no magnitude/phase decomposition. Modifications were developed to circumvent this problem as well as other issues that are specific to performing noise reduction in the DCT domain.</p>
<p id="p-0038" num="0049">In the DCT domain, the input signal is typically processed in blocks of 256 samples with a 50% (128 samples) overlap. Each block is bounded, or windowed, by an analysis window and transformed to DCT domain. The DCT vector is then subjected to a spectral scaling operation that scales each DCT coefficient with a scale factor (limited to range 0-1), directly proportional to the estimated SNR at the frequency of the DCT coefficient. This has the effect of attenuating spectral regions dominated noise and preserving DCT in spectral regions dominated by the desired speech signal. The resulting DCT vector is subjected to a noise flooring operation to prevent musical noise artifacts. It is then inverse transformed to time domain and processed through an overlap add synthesis process to produce noise reduced speech. The following summarizes the novel aspects that have been developed to perform noise reduction in the DCT domain.</p>
<p id="p-0039" num="0050">A traditional voice activity detection (&#x201c;VAD&#x201d;) based algorithm has a fixed time constant which can reduce a certain amount of stationary noise but lose the quick response to fast change in background noise spectrum. In an aspect, estimation of a background noise spectrum is based on a SNR dependent time recursive averaging algorithm. In a SNR dependent based background noise estimation algorithm each frequency bin has its corresponding time constants. The time constants are calculated based on the a posteriori SNR. This algorithm allows the further suppression of the background noise. It also performs well in nonstationary noise environment. To prevent the speech leakage (overestimation) a modification at detected harmonics is also performed. The algorithm can be described as following:
<ul id="ul0004" list-style="none">
    <li id="ul0004-0001" num="0051">1. The a posteriori SNR is computed based on the incoming transmit signal and previous estimated noise spectrum average by 10 frames in DCT domain. Each frequency bin has its corresponding SNR.</li>
    <li id="ul0004-0002" num="0052">2. A sigmoid function (between 0-1) is applied to the a posteriori. SNR at each frequency bin to generate the corresponding time constants.</li>
    <li id="ul0004-0003" num="0053">3. Update the estimation of background noise spectrum by the time constants calculated above.</li>
    <li id="ul0004-0004" num="0054">4. The SNR dependent noise spectrum estimation also exploits the pitch gain and estimated pitch calculated in the block of pitch analysis to modify the time constants at each harmonics to prevent speech leakage.</li>
</ul>
</p>
<p id="p-0040" num="0055">The SNR dependent background noise estimation can further suppress the background noise to a lower noise floor without musical noise and deterioration in intelligibility.</p>
<p id="p-0041" num="0056">The NR algorithm computes a spectral gain as a function of frequency to attenuate spectral regions of the noisy speech spectrum that are dominated by noise energy. To prevent audible artifacts, it is important that the spectral gain function evolve smoothly both as a function of time as well as frequency. In order to accomplish this, a spectral smoothing operation is applied as summarized by the following steps:
<ul id="ul0005" list-style="none">
    <li id="ul0005-0001" num="0057">1. The magnitude squared DCT (DCT power spectrum) of the noisy speech input is computed.</li>
    <li id="ul0005-0002" num="0058">2. A frequency domain window function is applied, centered at each frequency bin. The typical window is a rectangular window with a width in the range 3-9 points.</li>
    <li id="ul0005-0003" num="0059">3. The DCT power spectral coefficient in each frequency bin is replaced by the maximum value within the window, constructing a DCT power spectrum envelope, which is subsequently used in spectral gain computation.</li>
</ul>
</p>
<p id="p-0042" num="0060">In each frame, the DCT power spectrum of the noisy speech and the background noise spectral estimate are used to determine a frequency domain SNR function. A spectral gain function is computed by applying a non-linear function to the SNR function. The spectral gain function attenuates spectral component at each frequency in inverse proportion to the estimated SNR at that frequency. The steps are:
<ul id="ul0006" list-style="none">
    <li id="ul0006-0001" num="0061">1. The noise spectral estimate is subtracted from the smoothed DCT power spectrum and the result is averaged in the time domain to produce a slowly evolving noise reduced spectral estimate for speech. Typical time constant is 1.5 sec.</li>
    <li id="ul0006-0002" num="0062">2. A SNR estimate vector xi is computed that provides an estimate of the apriori SNR at each frequency of the DCT.</li>
    <li id="ul0006-0003" num="0063">3. Two frequency dependent gain vectors are computed (k is the DCT frequency index):
    <ul id="ul0007" list-style="none">
        <li id="ul0007-0001" num="0064">a. G1(k)=1&#x2212;1/(1+xi(k))</li>
        <li id="ul0007-0002" num="0065">b. G2(k)=1&#x2212;0.5*sqrt(NoiseSpectralEstimate(k)/DCT power Spectrum(k))</li>
        <li id="ul0007-0003" num="0066">Both these gains are forced to be non-negative.</li>
    </ul>
    </li>
    <li id="ul0006-0004" num="0067">4. The final spectral gain function is computed via
    <ul id="ul0008" list-style="none">
        <li id="ul0008-0001" num="0068">a. G(k)=sqrt(G1)*G2.</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0043" num="0069">One of the short comings of existing noise reduction techniques is that the as the degree of noise reduction increases, the speech distortion also increases, especially at low SNRs. This is primarily due to the excessive attenuation (i.e., low values of spectral gain function) of pitch harmonic components of speech during periodic segments. This operation is summarized by the following steps:
<ul id="ul0009" list-style="none">
    <li id="ul0009-0001" num="0070">1. A pitch estimation algorithm is used to estimate the fundamental pitch frequency and a degree of voicing (pitch gain).</li>
    <li id="ul0009-0002" num="0071">2. If the pitch gain is below a threshold (0.4 typical), indicating absence of significant harmonic structure, the spectral gain function is not modified.</li>
    <li id="ul0009-0003" num="0072">3. If the pitch gain exceeds the threshold, indicating significant harmonic structure, the spectral gain for the DCT coefficients in the vicinity of pitch harmonics is increased. Each harmonic is located on the DCT coefficient axis. The set of 3 DCT coefficients centered at each pitch harmonic are enhanced in amplitude by increasing the spectral gain for those coefficients. The degree of increase is proportional to the degree of voicing.</li>
</ul>
</p>
<p id="p-0044" num="0073">After spectral gain and harmonic enhancement, the input DCT vector is multiplied by the spectral gain function, resulting in noise reduction. Subsequently, DCT coefficients below a configurable &#x201c;noise floor&#x201d; are set to the level of the noise floor. The magnitude DCT spectrum of the noise reduced signal is combined with the sign of the DCT of the noisy signal to compute the time domain samples. The steps are:
<ul id="ul0010" list-style="none">
    <li id="ul0010-0001" num="0074">1. Multiply the input DCT with the spectral gain vector to produce noise reduced DCT.</li>
    <li id="ul0010-0002" num="0075">2. DCT coefficients with absolute values lower than a noise floor threshold are
    <ul id="ul0011" list-style="none">
        <li id="ul0011-0001" num="0076">a. Set to a magnitude equal to the noise floor threshold, and</li>
        <li id="ul0011-0002" num="0077">b. Set to a polarity (sign) equal to the polarity of the noise speech DCT at the same frequency</li>
    </ul>
    </li>
    <li id="ul0010-0003" num="0078">3. The resulting DCT is subjected to a spectral smoothing operation in the high frequency band (2000 Hz-4000 Hz). This smoothing is applied only for inactive frames (i.e., TX VAD indicates that no transmit voice signal is present) and for aperiodic frames, as indicated by a low pitch gain (&#x3c;0.35). The goal is to reduce spectral dynamics for background noise after noise suppression, to prevent audible artifacts.</li>
    <li id="ul0010-0004" num="0079">4. The resulting DCT is inverse transformed to time domain, windowed using a overlap&#x2014;add synthesis window and summed with the samples from the previous frame to produce a frame of noise reduced speech samples.</li>
</ul>
</p>
<p id="p-0045" num="0080">Acronyms:
<ul id="ul0012" list-style="none">
    <li id="ul0012-0001" num="0081">ECNR: Echo cancellation and Noise reduction</li>
    <li id="ul0012-0002" num="0082">AEC: Acoustic Echo Cancellation</li>
    <li id="ul0012-0003" num="0083">NR: Noise reduction</li>
    <li id="ul0012-0004" num="0084">VAD: Voice activity detector</li>
    <li id="ul0012-0005" num="0085">DTD: Double talk detector</li>
    <li id="ul0012-0006" num="0086">TX: Transmit</li>
    <li id="ul0012-0007" num="0087">RX: Receive</li>
    <li id="ul0012-0008" num="0088">DCT: Discrete cosine transform</li>
    <li id="ul0012-0009" num="0089">DFT: Discrete Fourier transform</li>
</ul>
</p>
<p id="p-0046" num="0090">These and many other objects and advantages will be readily apparent to one skilled in the art from the foregoing specification when read in conjunction with the appended drawings. It is to be understood that the embodiments herein illustrated are examples only, and that the scope of the invention is to be defined solely by the claims when accorded a full range of equivalents.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method for performing adaptive signal conditioning, comprising:
<claim-text>determining an initial value for a step size used in an adaptive filter algorithm based on:</claim-text>
<claim-text>a background noise signal power level relative to a power level of a received signal; and</claim-text>
<claim-text>a power level of an echo estimate relative to an output of an echo canceller; and</claim-text>
<claim-text>adjusting the step size value based on the detection of large fast fourier transform dues at one, or more, disturbing-signal frequencies:</claim-text>
<claim-text>wherein the method step of adjusting the step size value based on the detection of large fast courier transform values at one, or more, disturbing-signal frequencies includes:</claim-text>
<claim-text>processing a predetermined number of signal samples acquired during a short sampling period to compute a receive fast fowler transform vector;</claim-text>
<claim-text>processing the corresponding estimated echo samples to compute a reduced echo fast fourier transform vector;</claim-text>
<claim-text>computing the product of the receive fast fourier transform vector and the reduced fast fourier transform vector to obtain a fast fourier transform product vector;</claim-text>
<claim-text>averaging multiple fourier transform product vectors from corresponding multiple sampling periods over a long sampling period into a average fourier transform product vector;</claim-text>
<claim-text>updating the average fourier transform product vector with a fourier transform product vector processed during a current iteration of the short sampling period;</claim-text>
<claim-text>determining a plurality of deviations, each of the plurality of deviations determined between the fourier transform product vector determined during the most recent short sampling period and the most recently updated average fourier transform product vector for one of a predetermined frequencies;</claim-text>
<claim-text>determining an average of a plurality of the deviations for which the fourier transform product vector exceeds the most recently updated average fourier transform product vector; and</claim-text>
<claim-text>reducing the step-size if the average of the plurality of deviations exceeds a predetermined threshold.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>determining a peak deviation for the plurality of deviations; and</claim-text>
<claim-text>reducing the step size in proportion to the determined peak deviation if the peak deviation exceeds a predetermined threshold.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. A method for performing adaptive signal conditioning, comprising:
<claim-text>determining an initial value for a step size used in an adaptive filter algorithm based on:</claim-text>
<claim-text>a background noise signal power level relative to a power level of a received signal; and</claim-text>
<claim-text>a power level of an echo estimate relative to an output of an echo canceller; and</claim-text>
<claim-text>adjusting the step size value based on the detection of large fast fourier transform values at one or more, disturbing-signal frequencies:</claim-text>
<claim-text>determining a normalized cross correlation vector between a receive signal received from a communications network and a transmit signal composed of a near-end voice signal, a background noise signal, and an echo signal, which is a delayed version of the receive signal;</claim-text>
<claim-text>determining a transmit signal energy value corresponding to the energy contained in the transmit signal;</claim-text>
<claim-text>determining an estimated echo signal energy by calculating the inner product of the normalized cross correlation vector and a frequency response vector of the estimated echo path model;</claim-text>
<claim-text>determining a double talk presence indication value by calculating a ratio between the estimated echo energy and transmit signal energy;</claim-text>
<claim-text>determining an adaptive threshold using a ratio between the echo signal's energy and the energy in the background noise signal;</claim-text>
<claim-text>comparing the double talk presence indication value to the predetermined adaptive threshold;</claim-text>
<claim-text>setting a double talk flag if the double talk presence indication value exceeds the predetermined adaptive threshold;</claim-text>
<claim-text>comparing the difference between energy of the transmit signal and energy of a noise and echo composite signal; and</claim-text>
<claim-text>setting the double talk flag when the result of the comparison of the difference between energy of the transmit signal and energy of a noise and echo composite signal exceeds a predetermined level.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00003">claim 3</claim-ref> wherein the double talk flag is set if the difference between energy of the transmit signal and energy of a noise and echo composite signal exceeds 10 dB.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00003">claim 3</claim-ref> further comprising:
<claim-text>determining an estimated residual echo signal energy by calculating the energy of the difference between the transmit signal and the estimated echo signal when an energy level of the near-end voice signal is zero;</claim-text>
<claim-text>adjusting the estimated echo signal energy based on the estimated residual echo signal energy to result in an updated echo signal energy;</claim-text>
<claim-text>comparing the updated echo energy to background noise signal ratio to a single-to-double-talk-state transition threshold;</claim-text>
<claim-text>setting the double talk flag, if the updated echo energy to background noise signal ratio exceeds the single-to-double-talk-state transition threshold; and</claim-text>
<claim-text>wherein the single-to-double-talk-state transition threshold is a lower value than a double-to-single-talk-state transition threshold.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. A method for performing double talk detection of a transmit signal having a first sampling rate and a first bandwidth, comprising:
<claim-text>measuring power of the transmit signal over the first bandwidth at the first sampling rate;</claim-text>
<claim-text>converting the transmit signal into a downsampled transmit signal so that it has a second sampling rate lower than the first sampling rate and so that it has signal power over a second bandwidth that has a lower bandwidth than the first bandwidth;</claim-text>
<claim-text>measuring power of the downsampled transmit signal having the second sampling rate over the second bandwidth;</claim-text>
<claim-text>comparing the difference between the transmit signal and the downsampled transmit signal to a predetermined threshold; and</claim-text>
<claim-text>setting a double talk flag indicative of a double talk condition if the difference between the transmit signal and the downsampled transmit signal exceeds the predetermined threshold.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref> wherein the predetermined threshold is 1 dB.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref> wherein the first bandwidth is 0-8 kHz and the second bandwidth is 0-4 kHz, and wherein the first sample rate is 16 kHz and the second sample rate is 8 kHz.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref> wherein the method of converting the transmit signal into an downsampled signal is decimation. </claim-text>
</claim>
</claims>
</us-patent-grant>
