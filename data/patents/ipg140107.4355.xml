<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08625427-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08625427</doc-number>
<kind>B1</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12553689</doc-number>
<date>20090903</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>609</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>01</class>
<subclass>R</subclass>
<main-group>31</main-group>
<subgroup>08</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>11</main-group>
<subgroup>00</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>08</class>
<subclass>C</subclass>
<main-group>15</main-group>
<subgroup>00</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>J</subclass>
<main-group>1</main-group>
<subgroup>16</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>J</subclass>
<main-group>3</main-group>
<subgroup>14</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>1</main-group>
<subgroup>00</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>04</class>
<subclass>L</subclass>
<main-group>12</main-group>
<subgroup>26</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>370235</main-classification>
<further-classification>370236</further-classification>
<further-classification>370367</further-classification>
<further-classification>370370</further-classification>
<further-classification>370388</further-classification>
<further-classification>370412</further-classification>
<further-classification>370413</further-classification>
<further-classification>370414</further-classification>
<further-classification>370415</further-classification>
<further-classification>370416</further-classification>
<further-classification>370417</further-classification>
<further-classification>370418</further-classification>
</classification-national>
<invention-title id="d2e53">Multi-path switching with edge-to-edge flow control</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>4493021</doc-number>
<kind>A</kind>
<name>Agrawal</name>
<date>19850100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>4627052</doc-number>
<kind>A</kind>
<name>Hoare</name>
<date>19861200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>4677588</doc-number>
<kind>A</kind>
<name>Benjamin</name>
<date>19870600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>4688170</doc-number>
<kind>A</kind>
<name>Waite</name>
<date>19870800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>4706081</doc-number>
<kind>A</kind>
<name>Hart</name>
<date>19871100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>4720950</doc-number>
<kind>A</kind>
<name>Bayer</name>
<date>19880100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>4755986</doc-number>
<kind>A</kind>
<name>Hirata</name>
<date>19880700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>4755992</doc-number>
<kind>A</kind>
<name>Albal</name>
<date>19880700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>4757497</doc-number>
<kind>A</kind>
<name>Beierle</name>
<date>19880700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>4779092</doc-number>
<kind>A</kind>
<name>Takao</name>
<date>19881000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>4797881</doc-number>
<kind>A</kind>
<name>Ben-Artzi</name>
<date>19890100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>4813037</doc-number>
<kind>A</kind>
<name>Debuysscher</name>
<date>19890300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>4864559</doc-number>
<kind>A</kind>
<name>Perlman</name>
<date>19890900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>4890280</doc-number>
<kind>A</kind>
<name>Hirata</name>
<date>19891200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>4894822</doc-number>
<kind>A</kind>
<name>Buhrke</name>
<date>19900100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>4897841</doc-number>
<kind>A</kind>
<name>Gang, Jr.</name>
<date>19900100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>4920531</doc-number>
<kind>A</kind>
<name>Isono</name>
<date>19900400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>4933938</doc-number>
<kind>A</kind>
<name>Sheehy</name>
<date>19900600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>4935926</doc-number>
<kind>A</kind>
<name>Herman</name>
<date>19900600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00020">
<document-id>
<country>US</country>
<doc-number>4939724</doc-number>
<kind>A</kind>
<name>Ebersole</name>
<date>19900700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00021">
<document-id>
<country>US</country>
<doc-number>4947390</doc-number>
<kind>A</kind>
<name>Sheehy</name>
<date>19900800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00022">
<document-id>
<country>US</country>
<doc-number>5018137</doc-number>
<kind>A</kind>
<name>Backes</name>
<date>19910500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00023">
<document-id>
<country>US</country>
<doc-number>5079767</doc-number>
<kind>A</kind>
<name>Perlman</name>
<date>19920100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00024">
<document-id>
<country>US</country>
<doc-number>5081623</doc-number>
<kind>A</kind>
<name>Ainscow</name>
<date>19920100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00025">
<document-id>
<country>US</country>
<doc-number>5086426</doc-number>
<kind>A</kind>
<name>Tsukakoshi</name>
<date>19920200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00026">
<document-id>
<country>US</country>
<doc-number>5088090</doc-number>
<kind>A</kind>
<name>Yacoby</name>
<date>19920200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00027">
<document-id>
<country>US</country>
<doc-number>5105424</doc-number>
<kind>A</kind>
<name>Flaig</name>
<date>19920400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00028">
<document-id>
<country>US</country>
<doc-number>5109483</doc-number>
<kind>A</kind>
<name>Baratz</name>
<date>19920400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00029">
<document-id>
<country>US</country>
<doc-number>5136716</doc-number>
<kind>A</kind>
<name>Harvey</name>
<date>19920800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00030">
<document-id>
<country>US</country>
<doc-number>5142622</doc-number>
<kind>A</kind>
<name>Owens</name>
<date>19920800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00031">
<document-id>
<country>US</country>
<doc-number>5166926</doc-number>
<kind>A</kind>
<name>Cisneros</name>
<date>19921100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00032">
<document-id>
<country>US</country>
<doc-number>5226039</doc-number>
<kind>A</kind>
<name>Frank</name>
<date>19930700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00033">
<document-id>
<country>US</country>
<doc-number>5249292</doc-number>
<kind>A</kind>
<name>Chiappa</name>
<date>19930900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00034">
<document-id>
<country>US</country>
<doc-number>5274631</doc-number>
<kind>A</kind>
<name>Bhardwaj</name>
<date>19931200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00035">
<document-id>
<country>US</country>
<doc-number>5301303</doc-number>
<kind>A</kind>
<name>Abraham</name>
<date>19940400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00036">
<document-id>
<country>US</country>
<doc-number>5309437</doc-number>
<kind>A</kind>
<name>Perlman</name>
<date>19940500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00037">
<document-id>
<country>US</country>
<doc-number>5325358</doc-number>
<kind>A</kind>
<name>Goeldner</name>
<date>19940600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00038">
<document-id>
<country>US</country>
<doc-number>5349674</doc-number>
<kind>A</kind>
<name>Calvert</name>
<date>19940900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00039">
<document-id>
<country>US</country>
<doc-number>5390173</doc-number>
<kind>A</kind>
<name>Spinney</name>
<date>19950200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00040">
<document-id>
<country>US</country>
<doc-number>5442750</doc-number>
<kind>A</kind>
<name>Harriman, Jr.</name>
<date>19950800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00041">
<document-id>
<country>US</country>
<doc-number>5450439</doc-number>
<kind>A</kind>
<name>Kato</name>
<date>19950900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00042">
<document-id>
<country>US</country>
<doc-number>5530842</doc-number>
<kind>A</kind>
<name>Abraham</name>
<date>19960600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00043">
<document-id>
<country>US</country>
<doc-number>6486983</doc-number>
<kind>B1</kind>
<name>Beshai et al.</name>
<date>20021100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>398 54</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00044">
<document-id>
<country>US</country>
<doc-number>6826147</doc-number>
<kind>B1</kind>
<name>Nandy et al.</name>
<date>20041100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370229</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00045">
<document-id>
<country>US</country>
<doc-number>6992984</doc-number>
<kind>B1</kind>
<name>Gu</name>
<date>20060100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370235</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00046">
<document-id>
<country>US</country>
<doc-number>7027404</doc-number>
<kind>B2</kind>
<name>Sreejith et al.</name>
<date>20060400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370238</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00047">
<document-id>
<country>US</country>
<doc-number>7080168</doc-number>
<kind>B2</kind>
<name>Dasgupta et al.</name>
<date>20060700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 29</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00048">
<document-id>
<country>US</country>
<doc-number>7139240</doc-number>
<kind>B2</kind>
<name>Kreuzenstain</name>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00049">
<document-id>
<country>US</country>
<doc-number>7209445</doc-number>
<kind>B2</kind>
<name>Miller et al.</name>
<date>20070400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370235</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00050">
<document-id>
<country>US</country>
<doc-number>7313093</doc-number>
<kind>B1</kind>
<name>Eatherton et al.</name>
<date>20071200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370230</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00051">
<document-id>
<country>US</country>
<doc-number>7787480</doc-number>
<kind>B1</kind>
<name>Mehta et al.</name>
<date>20100800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370401</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00052">
<document-id>
<country>US</country>
<doc-number>7864757</doc-number>
<kind>B2</kind>
<name>Hall et al.</name>
<date>20110100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370388</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00053">
<document-id>
<country>US</country>
<doc-number>7898959</doc-number>
<kind>B1</kind>
<name>Arad</name>
<date>20110300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370235</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00054">
<document-id>
<country>US</country>
<doc-number>2002/0141427</doc-number>
<kind>A1</kind>
<name>McAlpine</name>
<date>20021000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370413</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00055">
<document-id>
<country>US</country>
<doc-number>2005/0002334</doc-number>
<kind>A1</kind>
<name>Chao et al.</name>
<date>20050100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370230</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00056">
<document-id>
<country>US</country>
<doc-number>2005/0201400</doc-number>
<kind>A1</kind>
<name>Park et al.</name>
<date>20050900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370412</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00057">
<document-id>
<country>US</country>
<doc-number>2009/0046719</doc-number>
<kind>A1</kind>
<name>Ashwood Smith</name>
<date>20090200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370392</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00058">
<document-id>
<country>US</country>
<doc-number>2009/0046731</doc-number>
<kind>A1</kind>
<name>George et al.</name>
<date>20090200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370404</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00059">
<document-id>
<country>US</country>
<doc-number>2010/0061238</doc-number>
<kind>A1</kind>
<name>Godbole et al.</name>
<date>20100300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370235</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00060">
<document-id>
<country>US</country>
<doc-number>2010/0061240</doc-number>
<kind>A1</kind>
<name>Sindhu et al.</name>
<date>20100300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370235</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00061">
<document-id>
<country>US</country>
<doc-number>2010/0246388</doc-number>
<kind>A1</kind>
<name>Gupta et al.</name>
<date>20100900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370225</main-classification></classification-national>
</us-citation>
<us-citation>
<nplcit num="00062">
<othercit>Varghese, George et al., &#x201c;Transparent Interconnection of Incompatible Local Area Networks Using Bridges&#x201d;, IEEE Journal on Selected Areas in Communications, vol. 8, No. 1, Jan. 1991, pp. 42-48.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00063">
<othercit>Perlman, Radia et al., &#x201c;Rbridges: Base Protocol Specification&#x201d;, TRILL Working Group, Jan. 7, 2009.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00064">
<othercit>Estrin, Deborah &#x201c;Interconnection Protocols for Interorganization Networks&#x201d; IEEE Journal on Selected Areas in Communications, vol. Sac-5, No. 9, Dec. 1987, pp. 1480-1491.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00065">
<othercit>Gerla, Mario et al., &#x201c;Congetion Control in Interconnected LANs&#x201d; Jan. 1988, vol. 2, No. 1, pp. 72-76.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00066">
<othercit>Giacopelli, James N. et al., &#x201c;Sunshine: A High-Performance Self-Routing Broadband Packet Switch Architecture&#x201d; IEEE Journal on Selected Areas in Communications, vol. 9, No. 8, Oct. 1991, pp. 1289-1298.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00067">
<othercit>Giessler, Alfred et al., &#x201c;Flow Control Based on Buffer Classes&#x201d; IEEE Transactions on Communications, vol. com-29, No. 4, Apr. 1981, pp. 436-443.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00068">
<othercit>Touch, J. et al., &#x201c;Transparent Interconnection of Lots of Links (TRILL): Problem and Applicability Statement&#x201d; Network Working Group, May 2009.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00069">
<othercit>Markowsky, George et al., &#x201c;An Evaluation of Local Path ID Swapping in Computer Networks&#x201d; IEEE Transactions on Communications vol. Com-29, No. 3, Mar. 1981, pp. 329-336.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00070">
<othercit>Perlman, Radia et al., &#x201c;Choosing the Appropriate ISO Layer for LAN Interconnection&#x201d; Jan. 1988, vol. 2, No. 1, pp. 81-86.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>21</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>370231</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370235</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370236</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370367</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370370</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370388</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370412-418</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709235</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>10</number-of-drawing-sheets>
<number-of-figures>10</number-of-figures>
</figures>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Terry</last-name>
<first-name>John M.</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Cheng</last-name>
<first-name>Joseph Juh-En</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Bialkowski</last-name>
<first-name>Jan</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Terry</last-name>
<first-name>John M.</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Cheng</last-name>
<first-name>Joseph Juh-En</first-name>
<address>
<city>Palo Alto</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Bialkowski</last-name>
<first-name>Jan</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<last-name>Yao</last-name>
<first-name>Shun</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
<agent sequence="02" rep-type="attorney">
<addressbook>
<orgname>Park, Vaughan, Fleming &#x26; Dowler LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Brocade Communications Systems, Inc.</orgname>
<role>02</role>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Elliott, IV</last-name>
<first-name>Benjamin H</first-name>
<department>2474</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">One embodiment of the present invention provides a system that facilitates flow control of multi-path-switched data frames. During operation the system transmits from an ingress edge device data frames destined to an egress edge device across different switched paths based on queue status of a core switching device and queue status of the egress edge device. The egress edge device is separate from the core switching device.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="175.01mm" wi="117.86mm" file="US08625427-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="245.45mm" wi="193.55mm" orientation="landscape" file="US08625427-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="201.93mm" wi="168.99mm" orientation="landscape" file="US08625427-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="218.52mm" wi="162.64mm" orientation="landscape" file="US08625427-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="222.50mm" wi="187.96mm" orientation="landscape" file="US08625427-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="227.50mm" wi="187.62mm" orientation="landscape" file="US08625427-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="265.09mm" wi="203.88mm" file="US08625427-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="214.21mm" wi="153.67mm" file="US08625427-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="253.15mm" wi="193.55mm" orientation="landscape" file="US08625427-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="253.15mm" wi="196.26mm" file="US08625427-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="239.52mm" wi="178.65mm" file="US08625427-20140107-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND</heading>
<p id="p-0002" num="0001">1. Field</p>
<p id="p-0003" num="0002">The present disclosure relates to communication networks. More specifically, the present disclosure relates to a method and system for facilitating multi-path switching with edge-to-edge flow control.</p>
<p id="p-0004" num="0003">2. Related Art</p>
<p id="p-0005" num="0004">The proliferation of the Internet and e-commerce continues to fuel evolutions in the telecom and network industries. Convergence in the underlying network architectures often takes place at a pace faster than the lifespan of most network equipment. For example, a large enterprise network today may contain Internet Protocol (IP) networks, storage area networks (SANs), Ethernet-based access networks, and leased lines and switches from telephone service providers. How to manage and fully utilize the equipment capacity in a heterogeneous environment remains an ongoing challenge.</p>
<p id="p-0006" num="0005">To maximize returns on capital expenditures, many network architects prefer re-using existing equipment to switch data packets of different formats and aggregating low-speed switch ports to provision high-speed logical links. Equipment vendors often provide the capability of mix-and-matching the latest equipment with existing equipment to boost switching capacity and accommodate different types of traffic.</p>
<p id="p-0007" num="0006">Although mixing different types of network equipment can save costs, it also presents inter-operability challenges. For example, when multiple devices are combined into a high-capacity switching system, the flow of packets within such a system can be difficult to control, and unregulated packet flows might prevent the system from reaching its full capacity.</p>
<heading id="h-0002" level="1">SUMMARY</heading>
<p id="p-0008" num="0007">In embodiments of the present invention, the problem of flow control in a multi-path switched network is solved by using an edge-to-edge credit mechanism and a link-level credit mechanism at an edge device.</p>
<p id="p-0009" num="0008">One embodiment of the present invention provides a system that facilitates flow control of multi-path-switched data frames. During operation, the system receives data frames from a source device at an ingress edge device. The system also maintains queue status for queues between the ingress edge device and at least one separate core switching device and for queues between the ingress edge device and a separate egress edge device which is the destination of the received data frames. The system further transmits the received data frames from the ingress edge device, the data frames destined to the egress edge device. In addition, the system transmits the data frames across different switched paths based on the queue status of at least one core switching device and the queue status of the egress edge device.</p>
<p id="p-0010" num="0009">In a variation on this embodiment, the system transmits the data frames via a plurality of output ports of the ingress edge device, each of which is coupled to a different core switching device and is part of a different switched path leading to the egress device.</p>
<p id="p-0011" num="0010">In a variation on this embodiment, the queue status of the egress edge device corresponds to a queue dedicated to an egress port on the egress edge device and the ingress edge device.</p>
<p id="p-0012" num="0011">In a variation on this embodiment, the system receives information indicative of the queue status of the egress edge device, wherein this information is attached to a data frame transmitted from the egress edge device to the ingress edge device.</p>
<p id="p-0013" num="0012">In a variation on this embodiment, the system receives information indicative of the queue status of the egress edge device, wherein this information is contained in a stand-alone frame that does not carry payload data.</p>
<p id="p-0014" num="0013">In a variation on this embodiment, the core switching device is a Fibre Channel (FC) switch. The system encapsulates a respective data frame based on an FC frame format prior to transmitting the data frame.</p>
<p id="p-0015" num="0014">In a further variation, the data frame is an Ethernet frame.</p>
<p id="p-0016" num="0015">In a further variation, the queue status of the core switching device is indicated by an FC credit count.</p>
<p id="p-0017" num="0016">One embodiment of the present invention provides an ingress edge device. The ingress edge device includes a source device port, a plurality of core device ports, queue status registers, a flow-control mechanism, and a transmission mechanism. The source device port couples to a data frame source device to receive data frames. The core device ports couples to at least one separate core switching device to provide data frames. The queue status registers store status of queues between the ingress edge device and said at least one core switching device and queues between the ingress edge device and a separate egress edge device which is the destination of the received data frames. The flow-control mechanism is coupled to the queue status registers and determines a queue status of a respective core switching device and a queue status of a respective egress edge device. The flow-control mechanism also provides values to the queue status registers. The transmission mechanism is coupled to the source device port, the core device ports, and the queue status registers, and transmits received data frames destined to the egress edge device across different switched paths using different core device ports. Furthermore, a respective core device port is selected based on the queue status of the at least one core switching device and the queue status of the egress edge device maintained in the queue status registers.</p>
<p id="p-0018" num="0017">One embodiment of the present invention provides a system for facilitating flow control of multi-path-switched data frames. This system includes an ingress edge device, at least one core switching device, and an egress edge device. The core switching device includes a plurality of ingress edge device ports for coupling to the ingress edge device via a plurality of core device ports on the ingress edge device, at least one egress edge device port, a switching element coupling the ingress device ports and the at least one egress edge device port, and a core queue-status providing mechanism for providing queue status information to the ingress edge device. The egress edge device includes at least one core device port, a destination device port for coupling to a data frame sink device, a switching element coupling the core device port and destination device port, and an edge queue-status providing mechanism for providing queue status information to said ingress edge device. The system further includes a plurality of links coupled to the core device ports on the egress edge device and the ingress edge device ports on the ingress edge device.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE FIGURES</heading>
<p id="p-0019" num="0018">This disclosure is illustrated by way of example and not by way of limitation in the accompanying drawings. Like reference numerals refer to similar elements.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 1</figref> illustrates an exemplary network that provides multi-path switching with edge-to-edge flow control, in accordance with an embodiment of the present invention.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 2A</figref> illustrates a logical block diagram of a switching system that facilitates multi-path switching with edge-to-edge flow control, in accordance with an embodiment of the present invention.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 2B</figref> illustrates an exemplary configuration of edge devices and a core switching device which facilitate multi-path switching with edge-to-edge flow control, in accordance with an embodiment of the present invention.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 2C</figref> illustrates an exemplary configuration of a multi-path switching system with edge-to-edge flow control disabled, in accordance with an embodiment of the present invention.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 2D</figref> illustrates an exemplary configuration of a multi-path switching system with edge-to-edge flow control enabled, in accordance with an embodiment of the present invention.</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 3</figref> presents a block diagram illustrating the credit-based mechanism which facilitates edge-to-edge flow control with multi-path switching, in accordance with an embodiment of the present invention.</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 4</figref> illustrates an exemplary frame format which includes shim headers to facilitate edge-to-edge flow control, in accordance with an embodiment of the present invention.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 5</figref> illustrates an exemplary architecture of an edge device which facilitates multi-path switching with edge-to-edge flow control, in accordance with an embodiment of the present invention.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 6</figref> presents a flowchart illustrating the process of forwarding a data frame while maintaining edge-to-edge flow control, in accordance with an embodiment of the present invention.</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 7</figref> presents a flowchart illustrating the process of forwarding a data frame from an edge device to a fabric based on a per-priority edge-to-edge credit pool and fabric-link credits, in accordance with an embodiment of the present invention.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0030" num="0029">The following description is presented to enable any person skilled in the art to make and use the invention, and is provided in the context of a particular application and its requirements. Various modifications to the disclosed embodiments will be readily apparent to those skilled in the art, and the general principles defined herein may be applied to other embodiments and applications without departing from the spirit and scope of the present invention. Thus, the present invention is not limited to the embodiments shown, but is to be accorded the widest scope consistent with the claims.</p>
<p id="h-0005" num="0000">Overview</p>
<p id="p-0031" num="0030">Embodiments of the present invention provide a new type of edge device that solves the flow-control problem in a multi-path switched network by using an edge-to-edge credit mechanism and a link-level credit mechanism at an edge device.</p>
<p id="p-0032" num="0031">This new edge device can interface with core switching devices and facilitate multi-path switching with both path-level and link-level flow control in a heterogeneous network environment. Such multi-path switching can effectively circumvent the bottleneck caused by a single switch's limited switching capacity. The edge device has a number of external-facing ports, which can couple to any network equipment, and a number of fabric ports which can couple to core switching devices or other edge devices. The edge device transmits frames destined to a common egress edge device across multiple links leading to different switching devices, thereby allowing the frames to be delivered over multiple switched paths. At the same time, the ingress edge device maintains both edge-to-edge flow control in conjunction with the egress edge device and link-level flow control with the core switching devices. Congestion can be avoided at both the egress edge devices and the core switching devices. Consequently, high network utilization can be achieved without overloading the network.</p>
<p id="p-0033" num="0032">In this disclosure, the term &#x201c;edge device&#x201d; is loosely defined and in general refers to a network device that is situated between an end-user device and a switch or traffic aggregation equipment situated closer to the core of the network. An edge device can provide switching functions. A &#x201c;core device&#x201d; can be a switch or other network equipment situated between two edge devices. An &#x201c;ingress edge device&#x201d; refers to an edge device that accepts traffic from end devices and forwards the traffic to a core device. An &#x201c;egress edge device&#x201d; refers to an edge device that accepts traffic from a core device and forwards the traffic to end devices. An &#x201c;ingress port&#x201d; on a device refers to an input port, and an &#x201c;egress port&#x201d; refers to an output port. An &#x201c;external port&#x201d; on an edge device refers to a port (ingress or egress) that couples to an end device. A &#x201c;fabric port&#x201d; on an edge device refers to a port (ingress or egress) that couples to a core device.</p>
<p id="p-0034" num="0033">&#x201c;Flow control&#x201d; refers to the mechanism or operations performed by one or more devices to throttle and amount of data passing through a link or switched path, often for the purposes of avoiding congestion. &#x201c;Congestion&#x201d; refers to the situation where data arrives faster than they can be processed which causes queue overflow within a network. Typically, congestion can occur when data arrives faster than a port can transmit them. Congestion can also occur when a processing unit (e.g., a lookup engine) cannot process incoming frames fast enough to keep up with the arriving data.</p>
<p id="h-0006" num="0000">Network Architecture</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 1</figref> illustrates an exemplary network that provides multi-path switching with edge-to-edge flow control, in accordance with an embodiment of the present invention. The architecture of this exemplary network is described first as follows. An edge device <b>102</b> is coupled to a core switch fabric <b>100</b> via a number of links <b>122</b>, and an edge device <b>104</b> is coupled to core switch fabric <b>100</b> via a number of links <b>124</b>. Core switch fabric <b>100</b> can operate on a frame format that is the same as or different from the frame format of the external ports of edge devices <b>102</b> and <b>104</b>. In one embodiment, core switch fabric <b>100</b> can operate on a Fibre Channel (FC) format, while edge devices <b>102</b> and <b>104</b> accept Ethernet frames from external devices. Furthermore, as illustrated in <figref idref="DRAWINGS">FIG. 2B</figref>, core switch fabric <b>100</b> can include a number of switching devices, and data frames may traverse different paths via different switching devices within switch fabric <b>100</b>.</p>
<p id="p-0036" num="0035">In this example, a number of network appliances operating on an FC frame format, such as back-up tape drives <b>116</b> and disk array <b>112</b>, can be coupled to core switch <b>100</b>. Core switch fabric <b>100</b> can switch traffic among these FC-based appliances. In addition, a number of Ethernet-based end devices, such as server farm <b>110</b>, disk array <b>114</b>, and server farm <b>118</b>, are coupled to edge devices <b>102</b> and <b>104</b>. The switching of traffic among these Ethernet-based devices is also performed by core switch fabric <b>100</b>, because edge devices <b>102</b> and <b>104</b> can encapsulate an Ethernet frame within an FC frame.</p>
<p id="p-0037" num="0036">As illustrated in <figref idref="DRAWINGS">FIG. 1</figref>, link group <b>122</b> includes multiple physical links (e.g., 4.25 Gbps or 8.5 Gbps FC links). Edge device <b>102</b> can use any physical link within link group <b>122</b> to transmit data frames which are to be switched by core switch fabric <b>100</b>. Data frames destined to the same destination (e.g., server farm <b>118</b>) can traverse different switched paths within core switch fabric <b>100</b> and be delivered at the destination. Similarly, edge device <b>104</b> can receive data frames from any physical link within link group <b>124</b> from core switch fabric <b>100</b>. Note that edge devices <b>102</b> and <b>104</b> can each attach a sequence number to an Ethernet frame and encapsulate the Ethernet frame and the sequence number in FC headers. This feature allows an ingress edge device to &#x201c;spray&#x201d; the encapsulated frames across the physical links leading to different switched paths while still maintaining the frame order at the egress edge device.</p>
<p id="p-0038" num="0037">In embodiments of the present invention, edge-to-edge flow control is achieved in the following manner. Egress edge device <b>104</b> typically maintains a separate edge-to-edge queue for a respective egress external port (such as the egress external port coupled to a server <b>119</b>) and a particular ingress edge device, i.e., a queue is dedicated to an (egress port, ingress edge device) pair. The state of this queue (e.g., the available space) indicates how much data edge device <b>104</b> can receive for transmission via the corresponding egress external port before congestion occurs at that egress external port. Note that congestion occurs at an egress port when data frames arrive faster than the egress external port can transmit them.</p>
<p id="p-0039" num="0038">During operation, edge device <b>104</b> communicates the state of this queue to the ingress edge device <b>102</b> via an edge-to-edge signaling path <b>128</b>. When transmitting frames destined for this particular egress port, ingress edge device <b>102</b> only allows a frame to enter the core switch when the corresponding queue at egress edge device <b>104</b> is not full. In this way, the system can prevent congestion at the egress external ports on the egress edge devices.</p>
<p id="p-0040" num="0039">In addition, ingress edge device <b>102</b> also maintains link-level flow control with the core switching devices. As mentioned above, core switch fabric <b>100</b> may contain a number of switching devices, and each core switching device provide a different switched path from a give ingress edge device to an egress edge device. Before transmitting a frame to core switch fabric <b>100</b>, edge device <b>102</b> identifies one or more core switching devices with available switching capacity within core switch fabric <b>100</b> (and the corresponding outgoing fabric links). Subsequently, ingress edge device <b>102</b> transmits frames destined for egress edge device <b>104</b> onto these different fabric links. This link-level flow control mechanism prevents congestion at core switch fabric <b>100</b>, while the edge-to-edge flow control mechanism prevents congestion at the egress edge device.</p>
<p id="p-0041" num="0040">The use of both edge-to-edge flow control and link-level flow control can effectively prevent congestions both at the egress edge and the core.</p>
<p id="p-0042" num="0041">In one embodiment, the edge-to-edge flow control information (from the egress edge device to the ingress edge device) is piggy-backed onto a data frame traveling from the egress edge device to the ingress edge device, in which case the &#x201c;egress&#x201d; edge device is actually the ingress, and the &#x201c;ingress&#x201d; edge device is actually the egress, since an edge device can function as both ingress and egress. The edge-to-edge flow control information can also be carried in a stand-alone frame which does not carry payload data traveling from the egress edge device to the ingress edge device. The link-level flow control between the core switch fabric and an ingress edge device can use the existing FC transmission credit system. In one embodiment, a physical link may contain multiple FC virtual channels, and the link-level credits are counted on a per-virtual-channel basis. Other signaling format and protocols can also be used.</p>
<p id="p-0043" num="0042">In the example in <figref idref="DRAWINGS">FIG. 1</figref>, assume that a server <b>111</b> in server farm <b>110</b> transmits a stream of Ethernet frames <b>130</b> which are destined for a server <b>119</b> in server farm <b>118</b>. Edge device <b>102</b> receives and attaches sequence numbers to Ethernet frames <b>130</b>, and encapsulates them with FC headers (and optionally with additional header information). Edge device <b>102</b> then determines whether a per-priority edge-to-edge credit pool corresponding to the egress port on edge device <b>104</b> coupling to server <b>119</b> has sufficient credit for transmitting the next Ethernet frame. When there is sufficient edge-to-edge credit, edge device <b>102</b> then determines which link among link group <b>122</b> has sufficient credit from core switch fabric <b>100</b>. Edge device <b>102</b> then forwards FC encapsulated frames <b>132</b> to core switch fabric <b>100</b> via the available links within link group <b>122</b>.</p>
<p id="p-0044" num="0043">Subsequently, core switch fabric <b>100</b> receives FC encapsulated frames <b>132</b> and allows each frame to be switched by a different switching device within switching fabric <b>100</b> (individual switching devices are shown in <figref idref="DRAWINGS">FIG. 2B</figref>). Consequently, FC encapsulated frames <b>132</b> are transmitted onto link group <b>124</b>, each frame traversing a different switched path within switch fabric <b>100</b> and traveling on a different physical link in link group <b>124</b>. Note that due to the different switched path within switch fabric <b>100</b>, the order of FC encapsulated frames <b>132</b> can be altered. Edge device <b>104</b> then re-orders frames <b>132</b> based on their sequence numbers. Edge device <b>104</b> also removes the encapsulation information (FC headers, sequence numbers, etc.) from frames <b>132</b> before forwarding the corresponding Ethernet frame <b>130</b> to server <b>119</b>.</p>
<p id="p-0045" num="0044">The aforementioned multi-path-switching feature is different from the existing hash-based Ethernet trunking methods. First, Ethernet trunking is used to aggregate physical links coupling two devices. That is, the starting points of all the trunked links are at the same transmitting device, and the ending points of all the trunked links are at the same receiving device. In embodiments of the present invention, the ending points of the grouped links (for example, link group <b>122</b> in <figref idref="DRAWINGS">FIG. 1</figref>), can be different switching devices (see more detailed description in conjunction with <figref idref="DRAWINGS">FIG. 2B</figref>).</p>
<p id="p-0046" num="0045">Second, in the existing Ethernet-trunking methods, to achieve in-order frame delivery, Ethernet frames with the same layer-2 or layer-3 addresses or layer-4 port numbers are always sent to the same physical link, because the link selection is based on a hash value of such addresses or port numbers. The resulting load distribution across the physical links in a trunk is determined by the load in different layer-2 or layer-3 source-destination pairs or layer-4 sessions. Hence, it is difficult for the edge device to attain a desired load distribution (e.g., an even load distribution across all the trunked links).</p>
<p id="p-0047" num="0046">In contrast, in embodiments of the present invention, an edge device can forward Ethernet frames in an arbitrary distribution pattern among the physical links leading to different switching devices. For example, in a link group containing four physical links, the edge device can forward Ethernet frames carrying data for the same TCP session or the same IP source-destination pair across all four physical links to achieve an even load distribution among different switching devices. This type of arbitrary load distribution among different switched paths is not possible in hash-based trunking schemes.</p>
<p id="p-0048" num="0047">The multi-path-switching technique disclosed herein is also distinct from conventional FC trunking. First, as explained above, the present multi-path-switching techniques involves transmitting frames on different physical links coupled to different switching devices, whereas FC trunking is limited to aggregating physical links coupled to the same switching device on the receiving end. Second, FC trunking relies on the measured latency on each trunked link to ensure in-order delivery. This approach would not work with multi-path switching, because the latency incurred in each switching device on a respective path (e.g., input queuing delay, processing delay, and output queuing delay) is not fixed and typically depends on the load on the switching device.</p>
<p id="p-0049" num="0048">The edge-to-edge flow control in the present multi-path-switching technique is distinct from layer-4 flow control, such as TCP flow control. A TCP communication session uses a sliding window mechanism to control the end-to-end packet flow. A TCP session is based on a connection-oriented model, is specific to a source/destination port pair, and has no control of how the data packets are routed or switched on lower layers. In other words, the TCP flow control is only designed to avoid congestion at the end host, but does not prevent lower-layer link congestion. Furthermore, a TCP session assumes a single &#x201c;pipe,&#x201d; i.e., a single path, between two end points, and has no control over how the packets are switched from the source to destination, whereas embodiments of the present invention facilitates multi-path switching between an ingress edge device and an egress edge device. In contrast, embodiments of the present invention facilitate multi-path switching with both edge-to-edge flow control and link-level flow control over multiple switched paths. This innovative flow-control mechanism not only prevents congestion at the egress edge device, but also prevents congestion at core switching devices along different switched paths from the ingress to the egress.</p>
<p id="p-0050" num="0049"><figref idref="DRAWINGS">FIG. 2A</figref> illustrates a logical block diagram of a switching system that facilitates multi-path switching with edge-to-edge flow control, in accordance with an embodiment of the present invention. In this example, two edge devices <b>220</b> and <b>2271</b> are coupled to core switch fabric <b>100</b> via multiple physical links. Each physical link couples to a separate core switching device within core switch fabric <b>100</b> (see <figref idref="DRAWINGS">FIG. 2B</figref> for details). Assume traffic flows from edge device <b>2200</b> to edge device <b>2271</b>. Edge device <b>2200</b> has a number of external-facing ingress Ethernet ports, and edge device <b>2271</b> has a number of external-facing egress Ethernet ports. The physical links coupling edge device <b>2200</b> and core switch fabric <b>100</b> are referred to as &#x201c;fabric ingress&#x201d; links. Similarly, physical links coupling core switch fabric <b>100</b> and edge device <b>2271</b> are referred to as &#x201c;fabric egress&#x201d; links.</p>
<p id="p-0051" num="0050">During operation, edge device <b>2271</b> communicates from time to time edge-to-edge flow control information with respect to a given egress port back to edge device <b>2200</b>. In addition, core switch fabric <b>100</b> also communicates link-level flow control information to edge device <b>2200</b>, using an FC-like credit mechanism. This way, by throttling its frame transmission based on both edge-to-edge and link-level flow control, edge device <b>2200</b> can effectively avoid overloading the fabric ingress links as well as the egress port on edge device <b>2271</b>.</p>
<p id="p-0052" num="0051"><figref idref="DRAWINGS">FIG. 2B</figref> illustrates an exemplary configuration of edge devices and a core switching device which facilitate multi-path switching with edge-to-edge flow control, in accordance with an embodiment of the present invention. In this example, 73 edge devices <b>2200</b>-<b>2272</b> and 16 core switches <b>2100</b>-<b>2115</b> from a high-capacity switching system. Core switches <b>2100</b>-<b>2115</b> form an exemplary embodiment of core switch fabric <b>100</b> as illustrated in <figref idref="DRAWINGS">FIG. 1</figref>. Core switch fabric <b>100</b> may include additional switching devices, and some of the ports on these switching devices may be coupled to end devices, such as disk array <b>112</b> in the example illustrated in <figref idref="DRAWINGS">FIG. 1</figref>. In one embodiment, core switches <b>2100</b>-<b>2115</b> are FC switches. These core switches can also be based on other standard or proprietary frame format. Furthermore, each edge device has 12 external ports, which operate on the Ethernet frame format. In total, there are 876 external Ethernet ports, labeled as ports <b>0</b>, <b>1</b>, <b>2</b>, . . . , <b>875</b>, respectively. A respective edge device also has 16 fabric ports, each of which couples to a different core switch. Correspondingly, a respective core switch has 73 ports, each coupling to a different edge device.</p>
<p id="p-0053" num="0052">The links between the core switches and edge devices can be considered as &#x201c;internal&#x201d; links with respect to core switch fabric <b>100</b>. In other words, the entire system, which includes core switch fabric <b>100</b> and edge devices <b>2200</b>-<b>2272</b>, can appear to be one piece of network equipment (for example, placed in a single rack) to the outside world. The core switches serve as the back-end switch fabrics for forwarding traffic from an ingress external port to an egress external port. A data frame traveling from an ingress external port to an egress external port can take one of the 16 switched paths, each of which traverses one of the 16 core switches <b>2100</b>-<b>2115</b>. Note that the terms &#x201c;ingress&#x201d; and &#x201c;egress&#x201d; are used here to indicate the direction of traffic flow. In reality, an external port can be bi-directional (for example, a Gigabit Ethernet (GbE) port or a 10G Ethernet port).</p>
<p id="p-0054" num="0053">In one embodiment, a respective edge device can use all 16 fabric links (and correspondingly all 16 switched paths) for forwarding data frames to the same egress external port, independent of the frames' layer-2 or layer 3 addresses or layer-4 identifiers.</p>
<p id="p-0055" num="0054"><figref idref="DRAWINGS">FIG. 2C</figref> illustrates an exemplary configuration of a multi-path switching system with edge-to-edge flow control disabled, in accordance with an embodiment of the present invention. In this example, assume that only link-level flow control is available between egress edge device <b>2271</b> and core switch fabric <b>100</b>. In addition, a host <b>2301</b> is coupled to ingress edge device <b>2200</b> via external port <b>0</b>, a host <b>2302</b> is coupled to ingress edge device <b>2201</b> via external port <b>12</b>, and a host <b>2303</b> is coupled to egress edge device <b>2271</b> via external port <b>852</b>. Both hosts <b>2301</b> and <b>2302</b> are sending frames to host <b>2303</b> via the same virtual channel, forming frame streams traveling on links <b>2401</b> and <b>2402</b>, respectively. Frame streams on links <b>2401</b> and <b>2402</b> are indicated by different fill patterns in <figref idref="DRAWINGS">FIG. 2C</figref>. Assume further that (1) the hosts can transmit frames as fast as core switch fabric allow, (2) edge-to-edge flow control is optionally disabled, and (3) only link-level flow control (such as an FC-like credit mechanism) is available. In other words, egress edge device <b>2271</b> only maintains one output queue for its egress port <b>852</b> and does not distinguish the source (i.e., the ingress edge device) of the frames stored in this queue.</p>
<p id="p-0056" num="0055">When a frame within the stream on link <b>2401</b> is lost, the output queue for egress port <b>852</b> can quickly fill up with frames from host <b>2301</b>. As a result, the buffer in core switching device <b>2100</b> corresponding to streams <b>2401</b> and <b>2402</b> can fill up and reduce the otherwise usable switching capacity. Meanwhile, before the back pressure can be propagated back to ingress edge devices <b>2200</b> and <b>2201</b>, they will continue to transmit frames to core switching device <b>2100</b> and cause congestion at the core. This type of congestion caused by head-of-queue blocking can be effectively prevented using the edge-to-edge flow control.</p>
<p id="p-0057" num="0056"><figref idref="DRAWINGS">FIG. 2D</figref> illustrates an exemplary configuration of a multi-path switching system with edge-to-edge flow control enabled, in accordance with an embodiment of the present invention. In this example, the frames from host <b>2301</b> to host <b>2303</b> are sprayed across two core switching devices <b>2100</b> and <b>2101</b>, over links <b>2401</b> and <b>2404</b>, respectively. Similarly, the frames from host <b>2302</b> to host <b>2303</b> are sprayed across core switching devices <b>2100</b> and <b>2101</b> over links <b>2402</b> and <b>2405</b>, respectively. The frames from host <b>2301</b> are marked with a different fill pattern from the frames from host <b>2302</b>.</p>
<p id="p-0058" num="0057">With respect to egress port <b>852</b> which couples to host <b>2303</b>, egress edge device <b>2271</b> provides separate queues for hosts <b>2301</b> and <b>2302</b>. In addition, egress edge device <b>2271</b> regularly communicates the state of these queues to their respective ingress edge device. For example, if a frame from host <b>2301</b> is lost and the corresponding egress queue is backed up, host <b>2301</b> can be timely notified by egress edge device <b>2271</b> and stop sending frames to core switching devices <b>2100</b> and <b>2101</b>, thus avoiding congestion in the core. Meanwhile, because there are separate egress queues for hosts <b>2301</b> and <b>2302</b>, the egress queue for host <b>2302</b> is not affected by the status of the queue for host <b>2301</b>. As a result, frames from host <b>2303</b> can continue to be delivered to host <b>2303</b> without any head-of-queue blocking problems.</p>
<p id="h-0007" num="0000">Queue Management</p>
<p id="p-0059" num="0058">As mentioned above, an egress edge device maintains a separate queue for every (egress port, ingress edge device) pair. This queue configuration allows edge-to-edge flow control between an egress port and each ingress edge device.</p>
<p id="p-0060" num="0059"><figref idref="DRAWINGS">FIG. 3</figref> presents a block diagram illustrating the credit-based mechanism which facilitates edge-to-edge flow control with multi-path switching, in accordance with an embodiment of the present invention. This example corresponds to the configuration in <figref idref="DRAWINGS">FIG. 2B</figref> and illustrates the queue management within an ingress edge device <b>2200</b> and an egress edge device <b>2272</b> as illustrated in <figref idref="DRAWINGS">FIG. 2B</figref>. The outgoing frames from edge device <b>2200</b> are switched by one or more core FC switches <b>330</b> and arrive at the egress edge devices, such as edge device <b>2272</b>.</p>
<p id="p-0061" num="0060">In general, within an ingress edge device, the sequence number generators aggregate the traffic of the same priority from the 12 ingress external ports that is destined to an egress external port into a single flow. As frames are dequeued from this flow, they are tagged with the sequence number that is uniquely identifiable based on the ingress edge device, frame priority, and egress external port. Then, the frames of eight levels of priorities destined to a single egress external port use the credits in eight different per-priority edge-to-edge credit pools to traverse the core switch fabric. Upon arrival at the egress edge device, the frames enter respective resequencers where they are queued as needed to re-order the flow before being passed to the egress external port's output queues.</p>
<p id="p-0062" num="0061">For example, ingress edge device <b>2200</b> has 12 ingress external ports, labeled as <b>0</b>, <b>1</b>, <b>2</b>, . . . , <b>11</b>, respectively. In one embodiment, these ingress external ports are Ethernet ports. Within edge device <b>2200</b>, incoming Ethernet frames with the same priority and destined to the same egress external port (on an egress edge device) are served with the same sequence number generator. In this example, there are eight levels of priorities, labeled as level 0, 1, . . . , 7, respectively. For instance, sequence number generator <b>302</b> serves all the incoming frames which have priority 0 and are destined for egress external port <b>0</b>. Sequence number generator <b>304</b> serves all the incoming frames which have priority 7 and are destined to egress external port <b>864</b>. In addition, for the frames destined to a given egress external port, there are a number of edge-to-edge credit pools, each of which serves a different priority. These credit pools provide the credit-based edge-to-edge flow control in conjunction with the FC core switches for different traffic priorities. For example, edge-to-edge credit pools <b>306</b> (which contains eight separate per-priority credit pools) serves the frames of the eight priorities destined to egress external port <b>0</b>.</p>
<p id="p-0063" num="0062">On the egress side, for example at egress edge device <b>2272</b>, there is one resequencer for each combination of ingress edge device, external egress port, and priority. For example, resequencer <b>312</b> re-orders all the priority-0 frames from ingress edge device <b>2200</b> and destined to egress external port <b>864</b>. Each resequencer is associated with a queue, and all the resequencer queues corresponding to a (egress port, ingress edge device pair) form the total edge-to-edge queue.</p>
<p id="p-0064" num="0063">In one embodiment, a resequencer includes a time-out mechanism that allows subsequent frames with higher sequence numbers to advance when a frame is missing for a time-out period. After the frames destined to a given egress external port are re-ordered, they are forwarded to respective output queues based on their priorities. For example, output queue <b>313</b> stores outgoing frames of priority 0 for egress external port <b>864</b>. Subsequently, the transmitter dequeues the frames from each output queue based on their respective priorities.</p>
<p id="p-0065" num="0064">In general, an ingress edge device maintains a counter for each egress port to indicate the available edge-to-edge credit for transmitting frames into the core switch fabric. An ingress edge device can also keep track of the total edge-to-edge credit available to all the egress external ports at an egress edge device, because the ingress edge device receives queue status for every (egress port, ingress edge device) pair from a respective egress device (see description in conjunction with <figref idref="DRAWINGS">FIG. 1</figref>).</p>
<p id="p-0066" num="0065">In one embodiment, an ingress edge device can allow oversubscription in the egress edge device. When oversubscription is permitted, a frame is allowed to be transmitted from the ingress edge device when the destination egress edge device's total credit (sum of the egress edge device's credit over its 12 egress external ports with respect to the ingress edge device, in terms of bytes or bits) is greater than or equal to the maximum frame size, and when the destination egress port's credit (with respect to the ingress edge device) is greater than one buffer unit. Upon transmission of the frame, the destination egress port's edge-to-edge credit is decremented by the maximum frame size (thus reducing the destination egress edge device's total available credit as well). When the frame is successfully transmitted from the egress port on the egress edge device, the pessimism in the frame's assumed size (i.e., the assumption that the frame has the maximum size) is compensated for by granting the difference between the maximum frame size and the actual frame size back to the egress port's edge-to-edge credit pool.</p>
<p id="p-0067" num="0066">The scheme described above allows an egress port to use more than its allowed credit by up to one maximum-sized frame. However, the total oversubscription does not exceed what is granted across all 12 egress ports on the egress edge device.</p>
<p id="p-0068" num="0067">At the destination egress edge device, when a frame is transmitted, the edge-to-edge credit is accounted on a per-priority and per-egress-port basis. Each time a frame travels in the reverse direction (relative to the unidirectional flow model), the accumulated &#x201c;released credit counter&#x201d; value is piggybacked on these frames sent to the ingress edge device, and the &#x201c;released credit counter&#x201d; is decremented. Correspondingly, the ingress edge device extracts the credit release information and increments its edge-to-edge credit pool for a given priority.</p>
<p id="p-0069" num="0068">In order to return edge-to-edge credit to a source edge device, the credit-return mechanism ideally needs some amount of traffic in the reverse direction to piggyback the credit information. In the absence of such traffic, an egress edge device can create an empty frame to achieve this purpose. For example, when the egress edge device detects that the edge-to-edge credit for a particular ingress edge device has accumulated for too long without being returned to the ingress edge device, it can send an empty frame to the ingress edge device so that these accumulated credits can be used.</p>
<p id="p-0070" num="0069">It is possible that the edge-to-edge credit can be lost when a frame is lost while traversing the core switching fabric or otherwise corrupted such that it does not reach an edge device. Consequently, an ingress edge device could have insufficient credit to transmit frames.</p>
<p id="p-0071" num="0070">In one embodiment, an edge device includes a &#x201c;no-credit&#x201d; timer mechanism to detect when a transmission queue fails to receive sufficient credit to transmit a maximum-sized frame. Ideally, the duration of this timer is sufficiently long to flush all frames out of the core switching fabric. Upon expiration of this timer, an interrupt is triggered, and the transmission queues whose edge-to-edge credit pools are depleted are disabled. The edge device then adjusts a respective edge-to-edge credit pool to account for the lost credit. In one embodiment, the edge device offsets a &#x201c;consumed credit register&#x201d; from the current &#x201c;returned credit counter&#x201d; by the amount of desired credit to be available. Ideally, at the egress edge device, the &#x201c;released credit counter&#x201d; is equal to the &#x201c;returned credit counter.&#x201d; If they are not, the &#x201c;released credit counter&#x201d; is set to the value of the &#x201c;returned credit counter.&#x201d; Subsequently, the transmission queues at the ingress edge device are re-activated.</p>
<p id="p-0072" num="0071">In addition to the mechanism to compensate for lost credits, an edge device can also include mechanisms to detect too much credit and credit leakage. For example, an edge device can limit the difference between the &#x201c;returned credit&#x201d; value and &#x201c;returned credit&#x201d; value to a pre-programmed value. The edge device can also initiate a timer when the available credit falls below a programmable threshold to prevent the credit from being below the threshold for too long.</p>
<p id="h-0008" num="0000">Frame Format</p>
<p id="p-0073" num="0072"><figref idref="DRAWINGS">FIG. 4</figref> illustrates an exemplary frame format which includes shim headers, in accordance with an embodiment of the present invention. In this example, an FC-encapsulated frame <b>400</b> includes the FC headers, a number of inserted headers <b>401</b>, and an Ethernet frame <b>417</b>. The FC headers include an FC start-of-frame field <b>402</b>, an FC checksum (cyclic-redundancy-check, or &#x201c;CRC&#x201d;) field <b>428</b>, and an FC end-of-frame field <b>430</b>. Ethernet frame <b>417</b> can include a destination Medium Access Control (MAC) address <b>418</b>, a source MAC address <b>420</b>, an Ethertype field <b>422</b>, Ethernet data <b>424</b>, and a padding field <b>426</b>.</p>
<p id="p-0074" num="0073">Inserted headers <b>401</b> include a shim header <b>404</b> and, optionally, a TRILL (Transparent Interconnection of Lots of Links) header <b>412</b> and an inner virtual LAN (VLAN) word <b>416</b>. Shim header <b>404</b> can include the edge-to-edge credit information and a sequence number which is used by the edge devices to re-order received frames. Shim header <b>404</b> can include additional information to facilitate the routing and forwarding operations at the core FC switch. In one embodiment, shim header <b>404</b> includes FC address information. Note that the core switching devices can be based on other formats than FC. Correspondingly, shim header <b>404</b> can include routing information associated with different formats.</p>
<p id="p-0075" num="0074">TRILL header <b>412</b> can facilitate link-state routing with Ethernet frames. More details of the TRILL protocol can be found at http://www.ietf.org/html.charters/trill-charter.html. VLAN word <b>416</b> allows various end devices to form a virtual LAN. Note that both TRILL header <b>412</b> and VLAN word <b>416</b> are optional.</p>
<p id="p-0076" num="0075">In some embodiments, data portion <b>424</b> of Ethernet frame <b>417</b> can encapsulate Fibre Channel over Ethernet (FCoE) content. In this case, Ethertype field <b>422</b> carries a special value that indicates that the content in data field <b>424</b> carries an encapsulated FC frame. Note that the FCoE in data field <b>424</b> is separate from FC encapsulation <b>400</b>.</p>
<p id="h-0009" num="0000">Operation of Edge Device</p>
<p id="p-0077" num="0076"><figref idref="DRAWINGS">FIG. 5</figref> illustrates an exemplary architecture of an edge device which facilitates multi-path switching with edge-to-edge flow control, in accordance with an embodiment of the present invention. In this example, an edge device <b>500</b> includes a set of Ethernet-based external ports <b>506</b> and a set of FC-based fabric ports <b>508</b>. Note that fabric ports <b>508</b> can also be based on other frame formats. Also included in edge device <b>500</b> is a main switch memory <b>502</b>, a routing engine <b>510</b>, a receiver first-in-first-out (FIFO) queue <b>512</b>, a core fabric manager (CFM) <b>514</b>, a buffer allocator <b>516</b>, a congestion controller <b>526</b>, a queue manager <b>518</b>, a transmit scheduler <b>520</b>, a transmit FIFO queue <b>522</b>, and a frame editor <b>524</b>.</p>
<p id="p-0078" num="0077">When a frame arrives either from an external port or a fabric port, the header information is extracted from the frame and fed into a routing engine <b>510</b>, which determines how to forward the frame. The received frame is then temporarily staged in receiver FIFO queue <b>512</b>. Meanwhile, congestion controller <b>526</b> manages link level credits and monitors the usage of receiver FIFO queue. Congestion controller <b>526</b> can maintain the buffer status in one or more registers. Congestion controller <b>526</b> also reports the buffer status to buffer allocator <b>516</b>. Buffer allocator <b>516</b> is responsible for maintaining a pool of free buffer identifiers and servicing buffer-allocation and de-allocation requests from main switch memory <b>502</b> and queue manager <b>518</b>. Buffer allocator <b>516</b> also manages the queuing and de-queuing in receiver FIFO queue <b>512</b> and transmit FIFO queue <b>522</b>.</p>
<p id="p-0079" num="0078">After the frame received from a fabric port enters receiver FIFO queue <b>512</b>, CFM <b>514</b> re-orders the frames based on their respective sequence number, ingress edge device, priority, and external egress port. CFM <b>514</b> is also responsible for managing the end-to-end credit passed from the egress edge device. In one embodiment, CFM <b>514</b> maintains a counter for each egress external port on the egress devices to indicate the available end-to-end credit for transmission into the fabric. In addition, it also keeps track of the total end-to-end credit available to all the egress external ports on each egress edge device.</p>
<p id="p-0080" num="0079">In one embodiment, to improve network utilization, a frame is allowed to be dequeued anytime the egress edge device's total credits for the corresponding ingress edge device (sum of credits for all the egress external ports on the egress edge device with respect to the ingress edge device) is greater than or equal to a maximum-sized frame (e.g., in terms of number of bits) and when the destination egress external port's available credit is greater than one buffer unit (e.g., 1 bit). Upon dequeue, the destination egress external port's credit is decremented by the maximum frame size (thus reducing the destination egress edge device's total available credit for the corresponding ingress edge device). When the frame transmission is completed, the pessimism in the frame's assumed size is removed and the difference between the maximum size and the actual frame size is granted back to that destination port's edge-to-edge credit pool.</p>
<p id="p-0081" num="0080">This scheme allows an egress external port to use more than it's allowed credit (by up to one maximum sized frame). Nevertheless, the total amount of over-subscription does not exceed what is granted across all egress external ports on the destination egress edge device.</p>
<p id="p-0082" num="0081">At the destination egress edge device, when the frame is transmitted via an egress external port, the corresponding edge-to-edge credit is accounted for on a per-ingress-edge-device basis for later return. Each time a frame travels in the reverse direction, the accumulated &#x201c;released credit&#x201d; value is piggybacked on those frames sent to the ingress edge device. Subsequently, the ingress edge device extracts the credit release information and increments its per-priority transmission edge-to-edge credit pool.</p>
<p id="p-0083" num="0082">With reference to <figref idref="DRAWINGS">FIG. 5</figref>, after a received frame is de-queued from receiver FIFO queue <b>512</b>, the frame is sent to main switch memory <b>502</b>. Switch memory <b>502</b> provides the cross-bar interconnect and facilitates low-latency switching between the 28 ports (12 external ports and 16 fabric ports). In one embodiment, switch memory <b>502</b> can provide temporary storage for frames while routing engine <b>510</b> decides the destination of the frame and while queue manager <b>518</b> and transmit scheduler <b>520</b> prepare to transmit the frame on the egress port. After the frame is processed by switch memory <b>502</b>, it enters the transmit FIFO queue <b>522</b>. Subsequently, the frame is de-queued from transmit FIFO queue <b>522</b>, based on the per-priority edge-to-edge credit pool and optionally link-level credits (for frames traveling to the core fabric), and is edited by frame editor <b>524</b>. Frame editor <b>524</b> is responsible for adding additional header information to a frame when the frame is to be FC-encapsulated, or removing the header information from a frame when the frame is to be de-capsulated.</p>
<p id="p-0084" num="0083"><figref idref="DRAWINGS">FIG. 6</figref> presents a flowchart illustrating the process of forwarding a data frame while maintaining edge-to-edge flow control, in accordance with an embodiment of the present invention. During operation, an ingress edge device initializes a per-priority edge-to-edge credit pool for a respective egress external port on an egress edge device (operation <b>602</b>). The ingress edge device then receives a frame destined for that egress external port (operation <b>604</b>). The ingress edge device then determines whether there is sufficient edge-to-edge credit (operation <b>606</b>). If so, the ingress edge device transmits the frame on a virtual channel with available link credit (operation <b>608</b>), and decrements the corresponding link-level and edge-to-edge credits (operation <b>610</b>). (The management of link-level credits is described in more detail in conjunction with <figref idref="DRAWINGS">FIG. 7</figref>) If there is insufficient edge-to-edge credit, the ingress edge device determines whether it has received released credits from the egress edge device before a predetermined time-out period (operation <b>612</b>).</p>
<p id="p-0085" num="0084">If no released credit is received before time-out, the ingress edge device may infer that there is a failure has occurred on the path between the egress edge device and the ingress edge device. Correspondingly, the ingress edge device can issue an alert (operation <b>613</b>) and initialize the per-priority edge-to-edge credit pool again (operation <b>602</b>).</p>
<p id="p-0086" num="0085">If released edge-to-edge credits are received before time-out, the ingress edge device can increase the edge-to-edge credit count (operation <b>614</b>). Subsequently, the ingress edge device determines whether there is a frame to transmit (operation <b>616</b>). If there is at least one frame to transmit, the ingress edge device proceeds to transmit the frame on an available virtual channel to the switch fabric, which is described in more detail in conjunction with <figref idref="DRAWINGS">FIG. 7</figref> (operation <b>608</b>). Otherwise, the ingress edge device waits for the next frame to arrive (operation <b>604</b>).</p>
<p id="p-0087" num="0086"><figref idref="DRAWINGS">FIG. 7</figref> presents a flowchart illustrating the process of forwarding a data frame from an edge device to a fabric based on a per-priority edge-to-edge credit pool and fabric-link credits, in accordance with an embodiment of the present invention. During operation, in ingress edge device enqueues a frame at a transmission queue corresponding to a per-priority edge-to-edge credit pool (operation <b>702</b>). The ingress edge device then determines whether there is a fabric link with available link-level credit (operation <b>704</b>). If there is no available fabric link, the ingress edge device waits for the link credits from the switch fabric (operation <b>705</b>). If there is available link credit, the ingress edge device assigns a virtual channel with available link credit to the frame (operation <b>708</b>).</p>
<p id="p-0088" num="0087">Subsequently, the ingress edge device transmits the frame onto the available virtual channel (operation <b>710</b>). The ingress edge device then decrements the corresponding link credit (operation <b>712</b>).</p>
<p id="p-0089" num="0088">The examples presented herein are for illustration purposes only and should not limit the scope of this disclosure. In general, embodiments of the present invention provide a new type of switching systems which facilitate multi-path switching with both edge-to-edge and link-level flow control. Such a novel switching system can provide more efficient utilization of the switching capacity within a network with significantly reduced network congestion.</p>
<p id="p-0090" num="0089">This new switching system is different from conventional flow control mechanisms (such as TCP flow control), because it allows a switch to transmit frames from the same stream or flow onto different paths, wherein each path may couple to a different switch and traverse multiple links. Furthermore, this switching system facilitates congestion avoidance on both path level and link level.</p>
<p id="p-0091" num="0090">The methods and processes described herein can be included in hardware modules or apparatus. These modules or apparatus may include, but are not limited to, an application-specific integrated circuit (ASIC) chip, a field-programmable gate array (FPGA), a dedicated or shared processor that executes a particular software module or a piece of code at a particular time, and/or other programmable-logic devices now known or later developed. When the hardware modules or apparatus are activated, they perform the methods and processes included within them. The foregoing descriptions of embodiments of the present invention have been presented only for purposes of illustration and description. They are not intended to be exhaustive or to limit this disclosure. Accordingly, many modifications and variations will be apparent to practitioners skilled in the art. The scope of the present invention is defined by the appended claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method comprising:
<claim-text>maintaining at a switch a queue which stores a packet, wherein the packet includes a Transparent Interconnect of Lots of Links (TRILL) header;</claim-text>
<claim-text>adding a shim header to the packet, wherein the shim header includes information indicating local congestion; and</claim-text>
<claim-text>wherein the shim header is placed between the TRILL header and a start of frame field in the packet.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising transmitting packets from the queue across different switched paths via a plurality of output ports of the switch, each of which is coupled to a different core switch and is part of a different switched path leading to an egress edge switch.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising maintaining status of a queue at an egress edge switch.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising receiving information from a received packet's shim header indicative of status of a queue at an egress edge switch, wherein the received packet is encapsulated by a TRILL header and transmitted from the egress edge switch.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising receiving information indicative of status of a queue at an egress edge switch, wherein this information is contained in a stand-alone packet encapsulated by a TRILL header without payload data.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein the packet is an Ethernet frame encapsulated by the TRILL header.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein the queue status of the core switch is indicated by a Fibre Channel credit count.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising transmitting the packet based on status of a queue at a core switch and status of a queue at an egress edge switch.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. A switch, comprising:
<claim-text>a queue configured to store a packet, wherein the packet includes a TRILL header;</claim-text>
<claim-text>a header notification mechanism coupled to the queue and configured to add a shim header to the packet outside the TRILL header, wherein the shim header includes information indicating local congestion; and</claim-text>
<claim-text>wherein the shim header is placed between the TRILL header and a start of frame field in the packet.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The switch of <claim-ref idref="CLM-00009">claim 9</claim-ref>, further comprising a queue status maintaining mechanism configured to maintain status of a queue at an egress edge switch, the queue corresponding to a destination device port on the egress edge switch and the ingress edge switch.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The switch of <claim-ref idref="CLM-00009">claim 9</claim-ref>, further comprising a the flow-control mechanism configured to receive information from a received packet's shim header indicative of status of a queue at an egress edge switch, wherein the received packet is encapsulated by a TRILL header and transmitted from the egress edge switch.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The switch of <claim-ref idref="CLM-00009">claim 9</claim-ref>, further comprising a flow-control mechanism configured to receive information indicative of status of a queue at an the egress edge switch, wherein this information is contained in a stand-alone packet encapsulated by a TRILL header without payload data.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The switch of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the packet is an Ethernet frame encapsulated by the TRILL header.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The switch of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the queue status of the core switch is indicated by an FC credit count.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The switch of <claim-ref idref="CLM-00009">claim 9</claim-ref>, further comprising a transmission mechanism configured to transmit the packet based on status of a queue at a core switch and status of a queue at an egress edge switch.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. A system for facilitating flow control of multi-path-switched packets encapsulated by a TRILL header, the system comprising:
<claim-text>an ingress edge switch, said ingress edge switch comprising:
<claim-text>a source device port for coupling to a packet source device to receive packets encapsulated by a TRILL header;</claim-text>
<claim-text>a plurality of core device ports for coupling to at least one separate core switch to provide packets encapsulated by a TRILL header;</claim-text>
<claim-text>queue status registers for storing status of queues between the ingress edge switch and said at least one core switch and queues between the ingress edge switch and a separate egress edge switch which is the destination of the received packets;</claim-text>
<claim-text>a flow-control mechanism coupled to the queue status registers and configured to determine a queue status of a respective core switch and status of a queue of a respective egress edge switch and provide values to the queue status registers;</claim-text>
<claim-text>a transmission mechanism coupled to the source device port, the core device ports, and the queue status registers and configured to transmit received packets encapsulated by a shim header added outside the TRILL header across different switched paths using different core device ports, wherein the shim header includes information indicating local congestion; and</claim-text>
<claim-text>wherein the shim header is placed between the TRILL header and a start of frame field in the packet;</claim-text>
</claim-text>
<claim-text>at least one core switch; and
<claim-text>at least one egress edge switch.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The system of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the egress edge switch comprises a queue that stores packets encapsulated by a TRILL header, the queuing dedicated to a destination device port on the egress edge switch and the ingress edge switch.</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The system of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the ingress edge switch is configured to receive information from a received packet's shim header indicative of the status of a queue in the egress edge switch; and
<claim-text>wherein the received packet is encapsulated by a TRILL header and transmitted from the egress edge switch.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The system of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the ingress edge switch is configured to receive information indicative of status of a queue at an egress edge switch; and
<claim-text>wherein this information is contained in a stand-alone packet encapsulated by a TRILL header without payload data.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The system of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the packet is an Ethernet frame encapsulated by the TRILL header.</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. The system of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein status of a queue in the core switch is indicated by an FC credit count. </claim-text>
</claim>
</claims>
</us-patent-grant>
