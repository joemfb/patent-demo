<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08626869-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08626869</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12990732</doc-number>
<date>20090710</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2008-180684</doc-number>
<date>20080710</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>244</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>15</main-group>
<subgroup>16</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>709217</main-classification>
<further-classification>709248</further-classification>
<further-classification>709249</further-classification>
<further-classification>709207</further-classification>
<further-classification>370503</further-classification>
<further-classification>370509</further-classification>
<further-classification>370501</further-classification>
<further-classification>370492</further-classification>
</classification-national>
<invention-title id="d2e71">Communication apparatus, communication system, and communication method</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>7046638</doc-number>
<kind>B1</kind>
<name>Klausner et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370313</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>2007/0121661</doc-number>
<kind>A1</kind>
<name>Ohta et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370412</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>2008/0309460</doc-number>
<kind>A1</kind>
<name>Jefferson et al.</name>
<date>20081200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>340 101</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>2009/0077264</doc-number>
<kind>A1</kind>
<name>Machida</name>
<date>20090300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709248</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2009/0109797</doc-number>
<kind>A1</kind>
<name>Eidson</name>
<date>20090400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>368 10</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>JP</country>
<doc-number>A-11-261611</doc-number>
<date>19990900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>JP</country>
<doc-number>A-2003-179584</doc-number>
<date>20030600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>JP</country>
<doc-number>A-2005-199954</doc-number>
<date>20050700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>JP</country>
<doc-number>A-2007-101457</doc-number>
<date>20070400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>JP</country>
<doc-number>A-2007-295081</doc-number>
<date>20071100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>WO</country>
<doc-number>WO 2007/105471</doc-number>
<kind>A1</kind>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00012">
<othercit>M. Tanaka et al., &#x201c;High-Reliability Physical Layer for In-Vehicle High-Speed Local Area Network,&#x201d; <i>Fukuoka Electric Review</i>, Jun. 28, 1991, No. 88, pp. 43-50 (with translation).</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00013">
<othercit>H. Aota et al., &#x201c;CAN&#x2014;Controller Area NetWork&#x2014;,&#x201d; <i>Journal of Robotics Society of Japan</i>, Sep. 15, 2003, vol. 21, No. 6, pp. 52-56 (with Abstract).</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00014">
<othercit>International Search Report issued in Application No. PCT/JP/2009/003253; dated Oct. 27, 2009 (with translation).</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>7</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>370313</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370467</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370536</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370533</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370532</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370512</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370492</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370505</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370504</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370501</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370503</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370509</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709217</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709207</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709 29</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709 32</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709 33</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455432</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>455345</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>7</number-of-drawing-sheets>
<number-of-figures>7</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20110047244</doc-number>
<kind>A1</kind>
<date>20110224</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Takada</last-name>
<first-name>Hiroaki</first-name>
<address>
<city>Nagoya</city>
<country>JP</country>
</address>
</addressbook>
<residence>
<country>JP</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Kurachi</last-name>
<first-name>Ryo</first-name>
<address>
<city>Nagoya</city>
<country>JP</country>
</address>
</addressbook>
<residence>
<country>JP</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Miyashita</last-name>
<first-name>Yukihiro</first-name>
<address>
<city>Yokkaichi</city>
<country>JP</country>
</address>
</addressbook>
<residence>
<country>JP</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Takada</last-name>
<first-name>Hiroaki</first-name>
<address>
<city>Nagoya</city>
<country>JP</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Kurachi</last-name>
<first-name>Ryo</first-name>
<address>
<city>Nagoya</city>
<country>JP</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Miyashita</last-name>
<first-name>Yukihiro</first-name>
<address>
<city>Yokkaichi</city>
<country>JP</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Oliff &#x26; Berridge, PLC</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>National University Corporation Nagoya University</orgname>
<role>03</role>
<address>
<city>Nagoya</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
<assignee>
<addressbook>
<orgname>Autonetworks Technologies, Ltd.</orgname>
<role>03</role>
<address>
<city>Mie</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
<assignee>
<addressbook>
<orgname>Sumitomo Wiring Systems, Ltd.</orgname>
<role>03</role>
<address>
<city>Mie</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
<assignee>
<addressbook>
<orgname>Sumitomo Electric Industries, Ltd.</orgname>
<role>03</role>
<address>
<city>Osaka</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Moore</last-name>
<first-name>Ian N</first-name>
<department>2469</department>
</primary-examiner>
<assistant-examiner>
<last-name>La</last-name>
<first-name>Phong</first-name>
</assistant-examiner>
</examiners>
<pct-or-regional-filing-data>
<document-id>
<country>WO</country>
<doc-number>PCT/JP2009/003253</doc-number>
<kind>00</kind>
<date>20090710</date>
</document-id>
<us-371c124-date>
<date>20101102</date>
</us-371c124-date>
</pct-or-regional-filing-data>
<pct-or-regional-publishing-data>
<document-id>
<country>WO</country>
<doc-number>WO2010/004768</doc-number>
<kind>A </kind>
<date>20100114</date>
</document-id>
</pct-or-regional-publishing-data>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">When sending data, an ECU sends time lag information indicating a time lag that is a difference between time of generating time point at which the data is generated and time of sending start time point at which the ECU actually starts sending the data. When transferring the data, a relay apparatus adds time lag information indicating a time lag that is a difference between time of receiving start time point at which the relay apparatus starts receiving the data and time of transferring start time point at which the relay apparatus starts transferring the data, onto the time lag added on the received data. When receiving the data, an ECU determines for the received data the time of the generating time point that is earlier the time lag indicated by the time lag information of the received data than the time at which the ECU starts receiving the data.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="131.23mm" wi="188.30mm" file="US08626869-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="225.13mm" wi="134.70mm" orientation="landscape" file="US08626869-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="185.34mm" wi="125.98mm" file="US08626869-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="135.72mm" wi="123.36mm" file="US08626869-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="250.87mm" wi="129.29mm" file="US08626869-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="197.87mm" wi="140.72mm" orientation="landscape" file="US08626869-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="223.27mm" wi="141.65mm" file="US08626869-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="252.81mm" wi="133.18mm" file="US08626869-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0002" num="0001">This application is the national phase under 35 U.S.C. &#xa7;371 of PCT International Application Ser. No, PCT/W2009/003253 which has an International filing date of Jul. 10, 2009 and designated the United States of America.</p>
<p id="p-0003" num="0002">1. Field of the Invention</p>
<p id="p-0004" num="0003">The present invention relates to a communication system for sending and receiving data among a plurality of communication apparatuses. Furthermore, the present invention relates to a communication apparatus that can utilize simple configurations to determine a generating time point of received data, a communication system including the communication apparatus, and a communication method.</p>
<p id="p-0005" num="0004">2. Description of Related Art</p>
<p id="p-0006" num="0005">It is recently known in several fields to utilize a system having many communication apparatuses, in which each communication apparatus is provided with a certain function and connected with other communication apparatuses in order to perform many operations through the data exchange between many communication apparatuses. For example, it is known in a field of local area network (LAN) mounted on a motor vehicle to utilize electronic control units (ECUs) as the communication apparatuses, to make each ECU perform a certain operation and to exchange data between the ECUs, in order to provide many functions to be implemented by a system.</p>
<p id="p-0007" num="0006">Generally, available period is applied to each data in the case of performing a process for exchanging data whose contents have to be changed momentarily among a plurality of communication apparatuses. It may cause a problem if an extremely old data is utilized, for example, by an ECU of an on-vehicle LAN field which controls safety functions.</p>
<p id="p-0008" num="0007">A patent document 1 shows that each ECU controls to send and receive data in accordance with a priority order based on arrival expiry time for minimizing a number of data which arrive after the arrival expiry time. In the patent document 1, absolute time is utilized for obtaining the arrival expiry time and each ECU includes time clock means for clocking time based on reference time which is synchronized among ECUs in order to send preferentially the data whose arrival expiry time comes earlier among data to be sent.</p>
<p id="p-0009" num="0008">[Patent document 1] Japanese Patent Application Laid-Open No. 2007-295081</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0010" num="0009">In the case of clocking time based on reference time which is synchronized among ECUs as shown by the patent document 1, it may be possible to accurately recognize a generating time point at which data is generated by another communication apparatus, such as another ECU, through receiving time information of the generating time point clocked by said another communication apparatus.</p>
<p id="p-0011" num="0010">Communication apparatuses may be connected to each other, and may respectively comprise clock means for clocking time such as a timer. Furthermore, there may be several methods to synchronize time to be clocked among the communication apparatuses. However, in order to do such synchronization, each communication apparatus has to perform a process to make the time clocked by own clock means correspond with a reference time sent from another communication apparatus or has to include a function of Global Positioning System (GPS) receiver.</p>
<p id="p-0012" num="0011">The present invention was made in view of such circumstances, and has a primary object to provide a communication apparatus that can accurately determine time at the generating time point of data received from another communication apparatus with simple configurations without synchronizing time clocked by provided clock means, a communication system comprising the communication apparatus, and a communication method.</p>
<p id="p-0013" num="0012">An apparatus of a first aspect according to the present invention is a communication apparatus having a clock means, a communication means for sending and receiving data, and a possibility decision means for deciding whether it is possible or not to send data by the communication means, comprising: a means for obtaining a time lag between time at a generating time point that data is generated and time at a sending start time point that it is started to send the data whose sending is decided to be possible by the possibility decision means; a means for adding time lag information indicating the obtained time lag onto the data; a means for determining a receiving start time point based on time of the clock means; and a determination means for determining a generating time point of data based on the time lag information and the receiving start time point.</p>
<p id="p-0014" num="0013">An apparatus of a second aspect according to the present invention is a communication apparatus further comprising: a means for acquiring a sending start time point of data by the clock means, when it is decided by the possibility decision means that it is possible to send data by the communication means; and a means for obtaining a time lag between time at the acquired sending start time point and time at the generating time point of the data, wherein time lag information indicating the obtained time lag is added on the data that is already started to be sent.</p>
<p id="p-0015" num="0014">An apparatus of a third aspect according to the present invention is a communication apparatus further comprising: a determination means for determining a sending start time point of sending data; an obtaining means for obtaining a time lag between the determined sending start time point and the generating time point; a means for adding time lag information indicating the obtained time lag onto the data; a means for deciding on the basis of time of the clock means whether the sending stat time point determined by the determination means has come or not; and a means for trying to send, by the communication means, the data and the time lag information added on the data, when it is determined that the sending stat time point has come, wherein, when it is decided to be not-possible by the possibility decision means, a new sending start time point for starting to send secondarily is re-determined, the time lag is re-obtained, and data sending is re-tried.</p>
<p id="p-0016" num="0015">An apparatus of a fourth aspect according to the present invention is a communication apparatus further comprising: a means for further transferring, when data with the added time lag information is received by the communication means, the data to another communication apparatus by the communication means; an obtaining means for obtaining a time lag between time at the generating time point of data determined by the determination means and time at a transferring start time point of data; and a means for utilizing the time lag information indicated by the obtained time lag as the time lag information added on the transferred data.</p>
<p id="p-0017" num="0016">A system of a fifth aspect according to the present invention is a communication system comprising a plurality of communication apparatuses, each of which has a clock means, a communication means for sending and receiving data, and a possibility decision means for deciding whether it is possible or not to send data by the communication means, wherein each communication apparatus comprises: a means for obtaining a time lag between time at a generating time point that data is generated and time at a sending start time point that it is started to send the data whose sending is decided to be possible by the possibility decision means; a means for adding time lag information indicating the obtained time lag onto the data; a means for determining a receiving start time point based on time of the clock means; and a determination means for determining a generating time point of data based on the time lag information and the receiving start time point.</p>
<p id="p-0018" num="0017">A method of a sixth aspect according to the present invention is a communication method in which a communication apparatus having a clock means and a communication means for sending and receiving data decides whether it is possible or not to send data by the communication means and send the data in the case of deciding that it is possible to send the data by the communication means, wherein the communication apparatus: starts sending the data in response to deciding that it is possible to send the data by the communication means; obtains a sending start time point of the data by the clock means; calculates a time lag between time of the obtained sending start time point and time of a generating time point at which the data is generated; and adds time lag information indicating the calculated time lag onto the data having started to be sent, and then sends the data.</p>
<p id="p-0019" num="0018">A method of a seventh aspect according to the present invention is a communication method in which a communication apparatus having a clock means and a communication means for sending and receiving data decides whether it is possible or not to send data by the communication means and send the data in the case of deciding that it is possible to send the data by the communication means, wherein the communication apparatus: determines a sending start time point to send data; calculates a time lag between time of the determined sending start time point and time of a generating time point at which the data is generated; adds time lag information indicating the calculated time lag onto the data; decides whether it reaches to the sending start time point or not; tries to send the data and the time lag information added on the data by the communication means, when deciding it reaches to the sending start time point; re-determines a new sending start time point for re-sending the data; re-calculates the time lag; and re-tries to send the data.</p>
<p id="p-0020" num="0019">In the first aspect and the fifth aspect according to the present invention, the time lag information is added onto data which indicates a time lag between time at a generating time point that data is generated and time at a sending start time point that sending of the data has actually become possible and has been started. When there is a negligible time lag between the time of sending start time point and the time of the receiving start time point, the time of the generating time point of data is earlier the time indicated by the time lag information than the time of the receiving start time point.</p>
<p id="p-0021" num="0020">In the second aspect and the sixth aspect according to the present invention, time is obtained at the sending start time point when data sending has been started for the data whose transmission is decided to be possible. Thus, it is possible to obtain a time lag based on the information accurately indicating the sending start time point at which the data transmission has been actually started, and then such the accurate information is added onto the data to be sent.</p>
<p id="p-0022" num="0021">In the third aspect and the seventh aspect according to the present invention, the sending start time point of data is previously determined, a time lag is calculated between the time at the determined sending start time point and the time at the generating time point of the data, and time lag information based on the calculated time lag is added onto the data. When the data is tried to be sent at the sending start time point and sending of the data is actually started in response to the decision indicating that it is possible to send the data, the time lag information indicating the accurate time lag is added onto the data during the sending process. When the sending of the data is not started in response to the decision indicating that it is not possible to send the data, time of the sending start time point is re-determined in accordance with the following chance of sending the data, the time lag information is re-obtained and the transmission of the data is re-tried on the basis of the re-obtained time lag information. Therefore, it is possible to add time lag information that can lead the accurate determination of the generating time point with simple configurations, even in the case that it is difficult to add the time lag information to the data during data sending process.</p>
<p id="p-0023" num="0022">In the fourth aspect according to the present invention, the communication apparatus receives data from another communication apparatus, and transfers the received data. For transferring, the communication apparatus calculates a time lag based on own clock means between time of the generating time point of the received data and time of transferring time point for transferring the received data, and adds information of the calculated time lag onto the data to be transferred. Therefore, it is possible to make the communication apparatus accurately determine the generating time point of the received data on the basis of the time clocked by own clock means and of the time lag information received together with the data, even in the configurations that the data is transferred through a plurality of communication apparatus.</p>
<p id="p-0024" num="0023">According to the present invention, it is possible to accurately determine the generating time point with simple configurations for sending and receiving data, but without synchronization processes of time clocked by clock means of each communication apparatus.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0025" num="0024">The above and further objects and features of the invention will more fully be apparent from the following detailed description with accompanying drawings.</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram showing components of a communication system mounted on a motor vehicle according to an embodiment 1.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 2</figref> is a flowchart showing an example of a communication procedure that a control unit of an ECU generates data and sends the data together with time lag information in the embodiment 1.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 3</figref> is a flowchart showing an example of a procedure that the control unit of the ECU or a control unit of a relay apparatus receives data and determines a generating time point of the received data in the embodiment 1.</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 4</figref> is a flowchart showing an example of a communication procedure that the control unit of the relay apparatus transfers data in the embodiment 1.</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 5</figref> is an explanation view showing processes for making any of ECUs or relay apparatus accurately determine the generating time point of the data transmitted by the ECU and the relay apparatus in the embodiment 1.</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 6</figref> is a flowchart showing an example of communication procedure that a control unit of an ECU generates data and sends the data together with time lag information in an embodiment 2.</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 7</figref> is a flowchart showing an example of communication procedure that a control unit of a relay apparatus transfers data in the embodiment 2.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DESCRIPTION OF THE PREFERRED EMBODIMENTS</heading>
<p id="p-0033" num="0032">Hereinafter, an embodiment of the present invention is described in detail with reference to drawings. In embodiments 1 and 2 described below, a communication system according to the present invention is described in the context of a communication system mounted on a motor vehicle such as a car which includes a plurality of ECUs mounted on the motor vehicle for transmitting data with each other.</p>
<p id="p-0034" num="0033">(Embodiment 1)</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram showing components of the communication system mounted on the motor vehicle according to an embodiment 1. The Communication System Mounted on the motor vehicle includes: ECUs <b>1</b>, <b>1</b>, . . . that are communication apparatuses sending and receiving data; relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . that relay data transmitted among the ECUs <b>1</b>, <b>1</b>, . . . ; and communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>, . . . that connect the ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . .</p>
<p id="p-0036" num="0035">The ECUs <b>1</b>, <b>1</b>, . . . are respectively connected to the different communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>, . . . . The relay apparatus <b>2</b><i>a </i>is connected both to the communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>, and is configured to relay data transmitted among the ECUs <b>1</b>, <b>1</b>, . . . respectively connected to the communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>. Similarly, the relay apparatus <b>2</b><i>b </i>is connected both to the communication lines <b>3</b><i>b</i>, <b>3</b><i>c</i>, and is configured to relay data transmitted among the ECUs <b>1</b>, <b>1</b>, . . . that are respectively connected to the communication lines <b>3</b><i>b</i>, <b>3</b><i>c. </i></p>
<p id="p-0037" num="0036">Each of the ECUs <b>1</b>, <b>1</b>, . . . includes: a control unit <b>10</b> that controls operations of each component; a storage unit <b>11</b> that stores data required for controlling the operations; a clock unit <b>12</b>; and a communication unit <b>13</b> that controls communication via the communication lines <b>3</b><i>a</i>, <b>3</b><i>b, . . . . </i></p>
<p id="p-0038" num="0037">The control unit <b>10</b> of the ECU <b>1</b> is supplied with electric power from an electric power supply (not shown), such as a battery or alternator mounted on the motor vehicle, to control the each component.</p>
<p id="p-0039" num="0038">The storage unit <b>11</b> is configured with a volatile memory and is configured to temporarily store the various data generated during processes performed by the control unit <b>10</b>, the measured values indicated by signals being input from sensors described later or the data relayed by the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b, . . . . </i></p>
<p id="p-0040" num="0039">The clock unit <b>12</b> clocks course of time through counting with a predetermined frequency. For example, the clock unit <b>12</b> clocks course of time from a predetermined reference time point. The reference time point may be a time point at which an electric power is supplied or may be a predetermined time of day (for example, Universal Time Coordinated; UTC). The control unit <b>10</b> obtains time information from the clock unit <b>12</b> at any given timing. Although the control unit <b>10</b> in each of the ECUs <b>1</b>, <b>1</b>, . . . obtains the time information from the clock unit <b>12</b> and the obtained time information indicates time, the indicated time is based on local time in each ECU <b>1</b> and the local time is not required to be synchronized among the ECUs <b>1</b>, <b>1</b>, . . . .</p>
<p id="p-0041" num="0040">The communication control unit <b>13</b> includes a function as a network controller and implements communication via any of communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>, . . . . In this embodiment, it is configured to send and receive data between the ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . , on the basis of a Controller Area Network (CAN) protocol. Thus, the communication control unit <b>13</b> sends and receives data via the communication lines <b>3</b><i>a</i>, <b>3</b><i>b </i>on the basis of the CAN protocol. For example, as being connected to the communication line <b>3</b><i>a</i>, the control unit <b>10</b> of the ECU <b>1</b> monitors communication status of the communication line <b>3</b><i>a </i>with using the communication control unit <b>13</b>, decides whether the control unit <b>10</b> can send data or not, and sends the data in the case of determining that the control unit can send the data. Particularly, as being connected to the communication line <b>3</b><i>a</i>, the control unit <b>10</b> of one ECU <b>1</b> can make the communication control unit <b>13</b> send the data, in the case that data is not sent by another ECUs <b>1</b>, <b>1</b>, . . . and relay apparatus <b>2</b><i>a </i>that are, as well as said one ECU <b>1</b>, connected to the communication line <b>3</b><i>a</i>. When data sending processes are tried to be started at the same time by a plurality of apparatuses between the ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatus <b>2</b><i>a </i>that are connected to the communication line <b>3</b><i>a</i>, an arbitration process is performed to make any one of apparatus preferentially start the data sending process in order to send the data. Particularly, it is configured to apply an arbitration field for performing the arbitration process into a header added onto the beginning of the data that is transmitted on the basis of the CAN protocol, the arbitration process is performed for the communication line <b>3</b><i>a </i>on the basis of a bit string in the arbitration field, and the tried sending process is continued by only one apparatus, an ECU <b>1</b> or relay apparatus <b>2</b><i>a</i>, which is selected through the arbitration process. When data is sent by any one of apparatuses between the ECUs <b>1</b>, <b>1</b>, . . . and a relay apparatus <b>2</b><i>a </i>that are connected to the communication line <b>3</b><i>a</i>, the data is simultaneously received by apparatuses, the ECUs <b>1</b>, <b>1</b>, . . . and a relay apparatus <b>2</b><i>a </i>that are connected to the communication line <b>3</b><i>a. </i></p>
<p id="p-0042" num="0041">The ECUs <b>1</b>, <b>1</b>, . . . can send data including numerical information of several physical quantities, such as measured values, computed values and control values. Furthermore, the ECUs <b>1</b>, <b>1</b>, . . . can control an engine, brake or the like, with utilizing a microcomputer. For example, an ECU <b>1</b> is connected with a sensor (not shown) for detecting rotation speeds of wheels (wheel speed), and works as an antilock brake system (ABS). The ECU <b>1</b> controls the brake in accordance with the wheel speed detected through the sensor during braking time of the motor vehicle, and sends data including measured values of the wheel speed toward another ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatus <b>2</b><i>a</i>, through the communication line <b>3</b><i>a. </i></p>
<p id="p-0043" num="0042">When each of the ECUs <b>1</b>, <b>1</b>, . . . sends such data including numerical information of several physical quantities, such as measured values, computed values and control values, information is added onto the ending of the data to be sent. The information indicates a generating time point, for example, the time point at which a sensor detects measured values of the wheel speed. Particularly, the each control unit <b>10</b> of ECUs <b>1</b>, <b>1</b>, . . . adds time lag information that indicates a time lag between the time of the generating time point and the time of the sending start time point at which the control units starts sending the data. When one of the ECUs <b>1</b>, <b>1</b>, . . . receives data and requires referring the generating time point of the received data, said one of the ECUs <b>1</b>, <b>1</b>, . . . utilizes the time lag information added on the received data, and determines the time of the generating time point that is earlier the lagged time indicated by the time lag information than the time of the receiving start time point at which said one of the ECUs <b>1</b>, <b>1</b>, . . . starts receiving the data.</p>
<p id="p-0044" num="0043">The relay apparatus <b>2</b><i>a </i>includes: a control unit <b>20</b> that controls operations of each component; a storage unit <b>21</b> that stores various information; a clock unit <b>22</b>; and a communication unit <b>23</b> that is connected to the communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>. Inner components of the relay apparatuses <b>2</b><i>b</i>, <b>2</b><i>c </i>are similar to those of the relay apparatus <b>2</b><i>a</i>, and thus are not described in detail.</p>
<p id="p-0045" num="0044">The control unit <b>20</b> is configured with a Micro Processing Unit (MPU). In addition, the control unit <b>20</b> is supplied with electric power from an electric power supply (not shown), such as a battery or alternator mounted on the motor vehicle, to control the each component.</p>
<p id="p-0046" num="0045">The storage unit <b>21</b> is configured with a volatile memory and is configured to temporarily store the data received from the ECUs <b>1</b>, <b>1</b>, . . . . In addition, the storage unit <b>21</b> is configured to store the various data generated during processes performed by the control unit <b>20</b>.</p>
<p id="p-0047" num="0046">The clock unit <b>22</b> performs counting with a predetermined frequency and clocks course of time. For example, the clock unit <b>22</b> clocks course of time from a predetermined reference time point. The reference time point may be a time point at which an electric power supply is started or may be a predetermined time of day (for example, UTC), similar to the reference time point of the each clock unit <b>12</b> of the ECUs <b>1</b>, <b>1</b>, . . . . The control unit <b>20</b> obtains time information from the clock unit <b>22</b> at any given timing. As the control unit <b>20</b> in each of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . obtains the time information from the clock unit <b>22</b> and the obtained time information indicates time, the indicated time is based on the local time in each relay apparatus and the local time is not required to be synchronized among the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b, . . . . </i></p>
<p id="p-0048" num="0047">The communication unit <b>23</b> implements data transmission with the ECUs <b>1</b>, <b>1</b>, . . . connected to the communication unit <b>23</b> via the communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>. Thus, the communication unit <b>23</b> sends and receives data on the basis of the CAN protocol. In addition, the communication unit <b>23</b> has a plurality of ports that can connect respectively to different communication lines <b>3</b><i>a</i>, <b>3</b><i>b </i>to send and receive data. As being connected to communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>, the control unit <b>20</b> of the relay apparatus <b>2</b><i>a </i>monitors communication status of the communication line <b>3</b><i>a </i>with using the communication unit <b>23</b>, decides whether the control unit <b>20</b> can send data or not, and sends the data via the communication line <b>3</b><i>a </i>in the case of determining that the control unit <b>20</b> can send the data. Similarly, the relay apparatus <b>2</b><i>a </i>monitors communication status of the communication line <b>3</b><i>b</i>, decides whether the control unit <b>20</b> can send data or not, and sends the data via the communication line <b>3</b><i>b </i>in the case of determining that the control unit can send the data. In addition, the communication unit <b>23</b> can perform data transmissions through the different communication ports at the same time.</p>
<p id="p-0049" num="0048">Each control unit <b>20</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . , as described above, can receive data from the ECUs <b>1</b>, <b>1</b>, . . . through the communication unit <b>23</b> and can transfer the received data to another ECUs <b>1</b>, <b>1</b>, . . . through another port different from the port through which the data is received. At that time, the control unit <b>20</b> further can transfer the time lag information for determining the generating time point of the data to be transferred, although the time lag information is transmitted together with the received data. It should be noted that the control unit <b>20</b> modifies and then transfers the time lag information. Particularly, the control unit <b>20</b> adds a time lag between the time of the receiving start time point at which the control unit <b>20</b> starts receiving the data and the time of the transferring start time point at which the control unit <b>20</b> starts transferring the received data, onto the time lag indicated by the time lag information that is added on the received data, in order to obtain a new time lag between the time of the generating time point at which the received data has been generated and the time of the transferring start time for the received data. In addition, the control unit <b>20</b> exchanges the time lag information having added onto the data to be transferred with new time lag information indicating the obtained new time lag, and then transfers the new time lag information.</p>
<p id="p-0050" num="0049"><figref idref="DRAWINGS">FIG. 2</figref> is a flowchart showing an example of a communication procedure that each control unit <b>10</b> of ECUs <b>1</b>, <b>1</b>, . . . generates data and sends the generated data together with the time lag information in the embodiment 1. The following flowchart represents processes performed by the control unit <b>10</b> of an ECU <b>1</b> that is connected to the communication line <b>3</b><i>a</i>. Each control unit <b>10</b> of another ECUs <b>1</b>, <b>1</b>, . . . also performs similar processes.</p>
<p id="p-0051" num="0050">The control unit <b>10</b> generates data including numerical information of several physical quantities (step S<b>11</b>), in the case of having detected the measured values through a sensor, having obtained the computed values that are computed in response to receiving another data, or having obtained the control values for controlling an object. At that time, the control unit <b>10</b> obtains information of the time of the generating time point at which the control unit <b>10</b> has generated the data, i.e., the time (Tc<sup>(0)</sup>) of the generating time point clocked by the clock unit <b>12</b> (step S<b>12</b>).</p>
<p id="p-0052" num="0051">In the following description, time information at each time point is represented by substitute letters with a superscript number, as the information of the time of the generating time point is represented by the &#x201c;Tc<sup>(0)</sup>&#x201d; in the step S<b>12</b>. The superscript number is an arbitrary natural number (k) to identify an apparatus whose local time is utilized for the time information. Furthermore, the superscript number corresponds to a number of relayed times of the data. For example, the time of the generating time point in the step S<b>12</b> is represented by the Tc<sup>(0)</sup>, and the &#x201c;0 (zero)&#x201d; shows that the &#x201c;Tc<sup>(0)</sup>&#x201d; is the time information based on the local time of the apparatus which has generated the data (data origin apparatus) with the &#x201c;0 (zero)&#x201d; number of relayed times. The superscript number may not be included in the transmitted time lag information.</p>
<p id="p-0053" num="0052">The control unit <b>10</b> allows the communication control unit <b>13</b> to try sending the data that has been generated at the step S<b>11</b>, and decides whether the communication control unit <b>13</b> succeeds or fails to start sending the data (step S<b>13</b>). When having determined that the communication control unit <b>13</b> fails to start sending the data because another of the ECUs <b>1</b>, <b>1</b>, . . . or the relay apparatus <b>2</b><i>a </i>connected to the communication line <b>3</b><i>a </i>is in communication or the control unit <b>10</b> is not selected by the arbitration (S <b>13</b>: NO), the control unit <b>10</b> returns the procedure to the step S<b>13</b> and waits until the communication control unit <b>13</b> becomes to be able to start sending the data. In the case of having determined that the communication control unit <b>13</b> fails to start sending the data, the control unit <b>10</b> receives another data sent from said another of the ECUs <b>1</b>, <b>1</b>, . . . or the relay apparatus <b>2</b> through the communication control unit <b>13</b>.</p>
<p id="p-0054" num="0053">When having decided that the communication control unit <b>13</b> succeeds to start sending the data because the ECUs <b>1</b>, <b>1</b>, and the relay apparatus <b>2</b><i>a </i>connected to the communication line <b>3</b><i>a </i>are not in communication or the control unit <b>10</b> is selected by the arbitration (S <b>13</b>: YES), the control unit <b>10</b> obtains information of the time of the sending start time point (Ts<sup>(0)</sup>) clocked by the clock unit <b>12</b> (step S<b>14</b>). Strictly speaking, the time of the sending start time point (Ts<sup>(0)</sup>) is the time when the ending of the arbitration field in the sent data is transmitted.</p>
<p id="p-0055" num="0054">The control unit <b>10</b> calculates a time lag (Td<sup>(0)</sup>=Ts<sup>(0)</sup>&#x2212;Tc<sup>(0)</sup>) that is a difference for the sent data between the time of the sending start time point (Ts<sup>(0)</sup>) and the time of the generating time point (Tc<sup>(0) </sup>(step S<b>15</b>), makes the communication control unit <b>13</b> add the time lag information indicating the calculated time lag (Td<sup>(0)</sup>) onto the sent data that is in the sending process (step S<b>16</b>), and terminates the procedure after completing the sending process.</p>
<p id="p-0056" num="0055">Therefore, the control unit <b>10</b> can calculate the time lag based on the accurate time information of the sending start time point at which the data has actually been sent (Ts<sup>(0)</sup>), and the information of the calculated time lag is added into the sent data that is in the sending process, and is transmitted together with the sent data.</p>
<p id="p-0057" num="0056">In the case that the communication control unit <b>13</b> performs communication processes based on the CAN protocol, the processes described below can implement the step S<b>16</b> that adds the time lag information. For sending the data, the communication control unit <b>13</b> adds the header information including the arbitration field onto the beginning of the sent data, and adds the trailer information showing completion of sending data onto the ending of the sent data. Then, the sent data is transmitted by the communication control unit <b>13</b>. The header information includes information about the length from the beginning of the header information to the ending of the trailer information. Thus, the time lag information is configured with particular numerical information and with a field having a predetermined length followed by the particular numerical information. Arbitrary numerical information is applied into the field indicating the time lag information, in advance. In addition, the field indicating the time lag information is configured to be re-writable by the communication control unit <b>13</b> even after the communication control unit <b>13</b> starts sending the data. The control unit <b>10</b> obtains the time of the sending start time point (Ts<sup>(0)</sup>) when the communication control unit <b>13</b> succeeds to start sending the data. Further, the control unit <b>10</b> calculates the time lag (Td<sup>(0)</sup>) and then instructs the communication control unit <b>13</b> to re-write the time lag information. Therefore, it is possible to add the time lag information onto the sent data that is in the sending process.</p>
<p id="p-0058" num="0057"><figref idref="DRAWINGS">FIG. 3</figref> is a flowchart showing an example of a procedure that each control unit <b>10</b> of the ECUs <b>1</b>, <b>1</b>, . . . or each control unit <b>20</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . receives data and determines a generating time point of the received data in the embodiment 1. The following flowchart represents processes performed by an ECU <b>1</b> connected to the communication line <b>3</b><i>b</i>. Another ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . also perform similar processes.</p>
<p id="p-0059" num="0058">The control unit <b>10</b> determines whether the communication control unit <b>13</b> (the communication unit <b>23</b>, in the case of the processes performed by each control unit <b>20</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>) has started receiving data or not (step S<b>21</b>). When having determined that the communication control unit <b>13</b> has not started receiving data yet (S<b>21</b>: NO), the control unit <b>10</b> returns the procedure to the step S<b>21</b>.</p>
<p id="p-0060" num="0059">When having determined that the communication control unit <b>13</b> has already started receiving data (S<b>21</b>: YES), the control unit <b>10</b> obtains the time of the receiving start time point (Tm<sup>(k)</sup>) clocked by the clock unit <b>12</b> (step S<b>22</b>). The control unit <b>10</b> further extracts the time lag information that indicates the time lag (Td<sup>(k&#x2212;1)</sup>) and is added on the received data of which the communication control unit <b>13</b> has started the receiving process at the step S<b>21</b> (step S<b>23</b>). The control unit <b>10</b> furthermore calculates the time of the generating time point according to the received data based on the own local time (Tc<sup>(k)</sup>=Tm<sup>(k)</sup>&#x2212;Td<sup>(k&#x2212;1)</sup>), with utilizing the time lag (Td<sup>(k&#x2212;1)</sup>) shown by the extracted time lag information and the time information of the receiving start time point (Tm<sup>(k)</sup>) obtained at the step S<b>22</b> (step S<b>24</b>). Then, the control unit <b>10</b> terminates the procedure for determining the time of the generating time point according to the received data.</p>
<p id="p-0061" num="0060">Therefore, the control unit <b>10</b> of the ECU <b>1</b> connected to the communication line <b>3</b><i>b </i>can determine the time of the generating time point according to the data generated and sent by the ECU <b>1</b> connected to, for example, the communication line <b>3</b><i>a</i>. The time lag information shows a time lag from the time point that the data is actually generated till the time point that the data is actually sent. Thus, the data is accurately generated at the time point earlier the time lag shown by the time lag information than at the receiving start time point. The number information &#x201c;k&#x201d; in the flowchart of <figref idref="DRAWINGS">FIG. 3</figref> corresponds to a number of relayed times of the data after the data is generated by an apparatus.</p>
<p id="p-0062" num="0061"><figref idref="DRAWINGS">FIG. 4</figref> is a flowchart showing an example of a communication procedure that each control unit <b>20</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . transfers data in the embodiment 1. The following flowchart represents processes that the control unit <b>20</b> of the relay apparatus <b>2</b><i>a </i>connected to the communication lines <b>3</b><i>a</i>, <b>3</b><i>b </i>receives data from the ECU <b>1</b> connected to the communication line <b>3</b><i>a </i>and transfers the received data to each apparatus connected to the communication line <b>3</b><i>b</i>. The control unit <b>20</b> performs similar processes for receiving data from any apparatus connected to the communication line <b>3</b><i>b </i>and transferring the received data to the ECUs <b>1</b>, <b>1</b>, . . . connected to the communication line <b>3</b><i>a</i>, too. Each control unit <b>20</b> of another relay apparatuses <b>2</b><i>b</i>, <b>2</b><i>c</i>, . . . also performs similar processes.</p>
<p id="p-0063" num="0062">The control unit <b>20</b> decides whether the communication unit <b>23</b> has started receiving data through the port of the communication unit <b>23</b> connected to the communication line <b>3</b><i>a </i>or not (step S<b>31</b>). When having decided that the communication unit <b>23</b> has not started receiving data yet (S<b>31</b>: NO), the control unit <b>20</b> returns the procedure to the step S<b>31</b>, monitors the communication line <b>3</b><i>a </i>connected to the communication unit <b>23</b> and waits until the communication unit <b>23</b> starts receiving data.</p>
<p id="p-0064" num="0063">When having decided that the communication unit <b>23</b> has already started receiving data (S<b>31</b>: YES), the control unit <b>20</b> obtains information of the time of the receiving start time point (Tm<sup>(k)</sup>) clocked by the clock unit <b>22</b> (step S<b>32</b>). Then, the control unit <b>20</b> decides whether the communication unit <b>23</b> has completed receiving the data or not (step S<b>33</b>). When having determined that the communication unit <b>23</b> has not completed receiving the data yet (S<b>33</b>: NO), the control unit <b>20</b> returns the procedure to the step S<b>33</b>.</p>
<p id="p-0065" num="0064">When having decided through the detection of the trailer information that the communication unit <b>23</b> has already completed receiving the data (S<b>33</b>: YES), the control unit <b>20</b> extracts the time lag information that is added on the received data and shows the time lag (Td<sup>(k&#x2212;1)</sup>) (step S<b>34</b>).</p>
<p id="p-0066" num="0065">In the case that the received data should be transferred to ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatus <b>3</b><i>b </i>which are connected to the communication line <b>3</b><i>b </i>through a port different from the port through which the transferred data has been received, the control unit <b>20</b> allows the communication unit <b>23</b> to try transferring the received data and decides whether the communication unit <b>23</b> succeeds or fails to start transferring the data (step S<b>35</b>). When having decided that the communication unit <b>23</b> fails to start transferring the received data because another of the ECUs <b>1</b>, <b>1</b>, . . . or the relay apparatus <b>2</b><i>b </i>connected to the communication line <b>3</b><i>b </i>is in communication or the control unit <b>20</b> is not selected by the arbitration (S <b>35</b>: NO), the control unit <b>20</b> returns the procedure to the step S<b>35</b> and waits until the communication unit <b>23</b> becomes to be able to start transferring the received data.</p>
<p id="p-0067" num="0066">When having decided that the communication unit <b>23</b> succeeds to start transferring the received data because the ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatus <b>2</b><i>b </i>connected to the communication line <b>3</b><i>b </i>are not in communication or the control unit <b>20</b> is selected by the arbitration (S <b>35</b>: YES), the control unit <b>20</b> obtains the time information of the transferring start time point (Ts<sup>(k)</sup>) clocked by the clock unit <b>22</b> (step S<b>36</b>).</p>
<p id="p-0068" num="0067">The control unit <b>20</b> calculates a time lag (Td<sup>(k)</sup>=Td<sup>(k&#x2212;1)</sup>+[Ts<sup>(k)</sup>&#x2212;Tm<sup>(k)</sup>]) that is a difference between the time of the transferring start time point according to the received data (Ts<sup>(k)</sup>) and the time of the receiving start time point of the received data (Tm<sup>(k)</sup>) plus the time lag indicated by the received (i.e., extracted) time lag information (Td<sup>(k&#x2212;1)</sup>) (step S<b>37</b>). Then, the control unit <b>20</b> makes the communication unit <b>23</b> add the calculated time lag information indicating the time lag (Td<sup>(k)</sup>) onto the transferred data that is in the transferring process (step S<b>38</b>), and terminates the procedure after completing the transferring process.</p>
<p id="p-0069" num="0068">In the case that the communication unit <b>23</b> performs communication processes based on the CAN protocol, the processes described below leads to add the calculated time lag information at the step S<b>38</b>, similarly in the case of the communication control unit <b>13</b>. The time lag information is configured with particular numerical information and with a field having a predetermined length followed by the particular numerical information. The control unit <b>20</b> applies arbitrary numerical information into the field indicating the time lag information, in advance. The communication unit <b>23</b> is configured to be able to re-write the field for indicating time lag information after the transferring process of the received data is started. The control unit <b>20</b> obtains the time information of the transferring start time point (Ts<sup>(k)</sup>) when the communication unit <b>23</b> succeeds to start transferring the received data. Further, the control unit <b>20</b> calculates the time lag (Td<sup>(k)</sup>) and then instructs the communication unit <b>23</b> to re-write the time lag information of the field.</p>
<p id="p-0070" num="0069"><figref idref="DRAWINGS">FIG. 5</figref> is an explanation view showing processes for making any of ECUs <b>1</b>, <b>1</b>, . . . or relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b </i>accurately determine the generating time point of the data transmitted by the ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . in the embodiment 1. In <figref idref="DRAWINGS">FIG. 5</figref>, time is illustrated to elapse downward. The explanation view of <figref idref="DRAWINGS">FIG. 5</figref> illustrates the case that data is generated by an ECU <b>1</b> connected to the communication line <b>3</b><i>a </i>and the relay apparatuses <b>2</b><i>a </i>transfer the generated data.</p>
<p id="p-0071" num="0070">When the ECU <b>1</b> connected to the communication line <b>3</b><i>a </i>generates the data, the time information of the generating time point &#x201c;Tc<sup>(0)</sup>&#x201d; is obtained. When the local time of the ECU <b>1</b> comes to the Ts<sup>(0)</sup>, the ECU <b>1</b> starts sending the generated data. At that time, the ECU <b>1</b> adds the time lag information to the data to be sent, while the time lag information indicates the time lag Td<sup>(0)</sup>=Ts<sup>(0)</sup>&#x2212;Tc<sup>(0)</sup>.</p>
<p id="p-0072" num="0071">As being connected to the communication line <b>3</b><i>a</i>, the ECU <b>1</b> and the relay apparatus <b>2</b><i>a </i>can send and receive data on the basis of the CAN protocol. In the case that the ECU <b>1</b> succeeds to start sending the generated data when the local time of the ECU <b>1</b> comes to the Ts<sup>(0)</sup>, the relay apparatus <b>2</b><i>a </i>simultaneously starts receiving the sent data when the local time of the relay apparatus <b>2</b><i>a </i>comes to Tm<sup>(1)</sup>. As referring the time lag Td<sup>(0) </sup>indicated by the time lag information that is added on the data sent by the ECU <b>1</b> (i.e., the received data by the control unit <b>20</b>), the control unit <b>20</b> of the relay apparatus <b>2</b><i>a </i>can determine that the time of the generating time point according to the received data is Tc<sup>(1)</sup>=Tm<sup>(1)</sup>&#x2212;Td<sup>(0) </sup>in the local time of the relay apparatus <b>2</b><i>a. </i></p>
<p id="p-0073" num="0072">The relay apparatus <b>2</b><i>a </i>receives the generated data from the ECU <b>1</b>, and then transfers the received data to the ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatus <b>2</b><i>b </i>connected to the communication line <b>3</b><i>b</i>. At that time, the control unit <b>20</b> of the relay apparatus <b>2</b><i>a </i>obtains the Ts<sup>(1) </sup>of the transferring start time point at which the communication unit <b>23</b> has succeeded to start transferring the received data, as shown by the flowchart of <figref idref="DRAWINGS">FIG. 4</figref> described above. Further, the control unit <b>20</b> calculates the time lag between the Ts<sup>(1) </sup>of the transferring start time point and the Tc<sup>(1) </sup>of the generating time point, i.e., the time lag Td<sup>(1) </sup>that is a difference between the Tm<sup>(1) </sup>of the receiving time point according to the relay apparatus <b>2</b><i>a </i>and the Ts<sup>(1) </sup>of the transferring time point plus the time lag Td<sup>(0) </sup>indicated by the time lag information received together with the sent data. Further, the control unit <b>20</b> adds information of the calculated time lag Td<sup>(1) </sup>onto the data to be transferred, and sends the information of the calculated time lag Td<sup>(1)</sup>, too.</p>
<p id="p-0074" num="0073">When having received data transferred by the relay apparatus <b>2</b><i>a</i>, the ECUs <b>1</b>, <b>1</b>, . . . connected to the communication line <b>3</b><i>b </i>can determine Tc<sup>(2) </sup>of the generating time point based on the own local time, in accordance with the time lag Td<sup>(1) </sup>indicated by the time lag information that is added on the received data (i.e., the transferred data by the repay apparatus <b>2</b><i>a</i>) and with the Tm<sup>(2) </sup>of the own receiving start time point.</p>
<p id="p-0075" num="0074">When having received data that are relayed (transferred) &#x201c;k&#x201d; times, the ECU <b>1</b> can similarly determine the time Tc<sup>(k) </sup>of the generating time point according to the received data (i.e., the relayed/transferred data) based on own local time, in accordance with the time lag Td<sup>(k&#x2212;1) </sup>indicated by the time lag information that is added on the received data (i.e., the relayed/transferred data) and with the time Tm<sup>(k) </sup>of the receiving start time point of the relayed/transferred data in this ECU <b>1</b>. The time lag information added on the received data indicates the time lag between the time of the generating time point and the time of the sending (receiving) start time point clocked with a predetermined frequency, even in the case that the received data has been relayed many times. Therefore, the time of the generating time point according to the received data is Tc<sup>(k) </sup>is earlier the time lag Td<sup>(k&#x2212;1) </sup>than the time Tm<sup>(k) </sup>of the receiving start time point, even in the case that the received data has been relayed many times.</p>
<p id="p-0076" num="0075">As described above, the ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . can determine the time of the generating time point based on own local time, even in the case that the time of the clock unit <b>12</b> and clock unit <b>22</b> are not synchronized with each other on the basis of a predetermined absolute time. Thus, the generating time points of the Tc<sup>(0)</sup>, the Tc<sup>(1) </sup>and the Tc<sup>(k) </sup>are identical to each other as shown in <figref idref="DRAWINGS">FIG. 5</figref>, although the Tc<sup>(0)</sup>, the Tc<sup>(1) </sup>and the Tc<sup>(k) </sup>are represented with different superscript numbers as shown in <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0077" num="0076">(Embodiment 2)</p>
<p id="p-0078" num="0077">In the embodiment 1, each control unit <b>10</b> of the ECUs <b>1</b>, <b>1</b>, . . . and each control unit <b>20</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . are configured to obtain the time information of the transmitting (i.e., sending, and transferring) start time point in response to succeeding to start sending data, and configured to add the obtained time information onto the data during the transmitting process. On the other hand, an embodiment 2 is configured to set the transmitting (i.e., sending, and transferring) start time point in advance, and try to transmit data after obtaining the time lag information to be added onto the data to be transmitted.</p>
<p id="p-0079" num="0078">A communication system in the embodiment 2 has configurations similar to those of the communication system in the embodiment 1, except for detailed processes performed by each control unit <b>10</b> of the ECUs <b>1</b>, <b>1</b>, . . . and detailed processes performed by each control unit <b>20</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . . In the following descriptions, the same numerals are applied to the configurations common in the embodiments 1 and 2, and those common configurations are not described in detail, but different configurations in the embodiments 1 and 2 are described in detail, i.e., about the processes performed by each control unit <b>10</b> of the ECUs <b>1</b>, <b>1</b>, . . . and the processes performed by each control unit <b>20</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . , in reference to the flowcharts.</p>
<p id="p-0080" num="0079"><figref idref="DRAWINGS">FIG. 6</figref> is a flowchart showing an example of communication procedure that each control unit <b>10</b> of the ECUs <b>1</b>, <b>1</b>, . . . generates data and sends the data together with the time lag information in the embodiment 2. The following flowchart represents processes performed by the control unit <b>10</b> of an ECU <b>1</b> connected to the communication line <b>3</b><i>a</i>. Each control unit <b>10</b> of another ECUs <b>1</b>, <b>1</b>, . . . also performs similar processes. In the flowchart described below, the same step numbers are applied to the processes common with those in the flowchart of <figref idref="DRAWINGS">FIG. 2</figref>, and the common processes are not described in detail.</p>
<p id="p-0081" num="0080">After obtaining information of the time Tc<sup>(0) </sup>of the generating time point clocked by the clock unit <b>12</b> (S<b>12</b>), the control unit <b>10</b> sets estimated time for starting to send the generated data, i.e., the time Ts<sup>(0) </sup>of the sending start time point (step S<b>41</b>). Then, the control unit <b>10</b> calculates a time lag (Td<sup>(0)</sup>=Ts<sup>(0)</sup>&#x2212;Tc<sup>(0)</sup>) that is a difference between the time Ts<sup>(0) </sup>of the sending start time point and the time Tc<sup>(0) </sup>of the generating time point (step S<b>42</b>).</p>
<p id="p-0082" num="0081">The control unit <b>10</b> adds the time lag information indicating the calculated time lag (Td<sup>(0) </sup>onto the generated data (i.e., the data to be sent) (step S<b>43</b>), and decides whether the time clocked by the clock unit <b>12</b> comes to the set time (Ts<sup>(0) </sup>of the sending start time point or not (step S<b>44</b>). When having decided that the time does not come to the set time (Ts<sup>(0)</sup>) of the sending start time point (S<b>44</b>: NO), the control unit <b>10</b> returns the procedure to the step S<b>44</b>.</p>
<p id="p-0083" num="0082">When having decided that the time comes to the set time (Ts<sup>(0)</sup>) of the sending start time point (S<b>44</b>: YES), the control unit <b>10</b> allows the communication control unit <b>13</b> to try sending the data generated at the step S<b>11</b> and decides whether the communication control unit succeeds or fails to start sending the generated data (step S<b>45</b>). When having determined that the communication control unit fails to start sending the generated data because another of the ECUs <b>1</b>, <b>1</b>, . . . or the relay apparatus <b>2</b><i>a </i>connected to the communication line <b>3</b><i>a </i>is in communication or the control unit <b>10</b> is not selected by the arbitration (S<b>45</b>: NO), the control unit <b>10</b> returns the procedure to the step S<b>41</b> and sets new time Ts<sup>(0) </sup>of the sending start time point for trying to send the generated data again.</p>
<p id="p-0084" num="0083">When having decided that the communication control unit succeeds to start sending the generated data because the ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatus <b>2</b><i>a </i>connected to the communication line <b>3</b><i>a </i>are not in communication or the control unit <b>10</b> is selected by the arbitration (<b>545</b>: YES), the control unit <b>10</b> continues the sending process of the data, and terminates the procedure after completing the sending process.</p>
<p id="p-0085" num="0084">Although information of the previously-set time is added on the generated data (i.e., the data to be sent) as information of the time of the sending start time point, the previously-set time becomes just the time that the sending process of the generated data has been actually started, in the case that the communication control unit has succeeded to start sending the generated data. The embodiment 2 also utilizes the procedure shown by the flowchart in FIG. <b>3</b> of the embodiment 1, for making each control unit <b>10</b> of the ECUs <b>1</b>, <b>1</b>, . . . having received the generated data (i.e., the sent data by the ECU <b>1</b>) or each control unit <b>20</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . having received the generated data (i.e., the sent data by the ECU <b>1</b>) determine the time of the generating time point. Thus, it is possible to correctly determine the time of the generating time point, even on the basis of the time lag information that indicates the time lag (Td<sup>(0)</sup>)and is obtained through the procedure shown by the flowchart of <figref idref="DRAWINGS">FIG. 6</figref>.</p>
<p id="p-0086" num="0085"><figref idref="DRAWINGS">FIG. 7</figref> is a flowchart showing an example of communication procedure that each control unit <b>20</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . transfers data in the embodiment 2. The following flowchart represents processes that the control unit <b>20</b> of the relay apparatus <b>2</b><i>a </i>connected to the communication lines <b>3</b><i>a</i>, <b>3</b><i>b </i>receives data from an ECU <b>1</b> connected to the communication line <b>3</b><i>a </i>and transfers the received data to apparatuses connected to the communication line <b>3</b><i>b</i>. The control unit <b>20</b> of the relay apparatus <b>2</b><i>a </i>performs similar processes for receiving data from an apparatus connected to the communication line <b>3</b><i>b </i>and transferring the received data to the ECUs <b>1</b>, <b>1</b>, . . . connected to the communication line <b>3</b><i>a</i>, too. Furthermore, each control unit <b>20</b> of another relay apparatuses <b>2</b><i>b</i>, <b>2</b><i>c</i>, . . . also performs similar processes.</p>
<p id="p-0087" num="0086">In the flowchart described below, the same step numbers are applied to the processes common with those shown by the flowchart of <figref idref="DRAWINGS">FIG. 4</figref> in the embodiment 1, and the common processes are not described in detail.</p>
<p id="p-0088" num="0087">The control unit <b>20</b> extracts the time lag information indicating the time lag (Td<sup>(k&#x2212;1)</sup>) from the received data (S<b>34</b>). In the case that the received data should be transferred to the ECUs <b>1</b>, <b>1</b>, . . . and the replay apparatus <b>3</b><i>b </i>connected to a port different from the port through which the data is received, the control unit <b>20</b> performs the following processes after extracting the time lag information.</p>
<p id="p-0089" num="0088">The control unit <b>20</b> sets the estimated time for starting to send (i.e., transfer) the data, i.e., the time (Ts<sup>(k)</sup>) of the sending start time point (step S<b>51</b>). Then, the control unit <b>20</b> calculates the time lag (Td<sup>(k)</sup>=Td<sup>(k&#x2212;1)</sup>+(Ts<sup>(k)</sup>&#x2212;Tm<sup>(k)</sup>) that is the difference between the set estimated time (Ts<sup>(k)</sup>) of the sending start time point and the time (Tm<sup>(k)</sup>) of the receiving start time point plus the time lag (Td<sup>(k&#x2212;1)</sup>) indicated by the received (i.e., extracted) time lag information (step S<b>52</b>).</p>
<p id="p-0090" num="0089">The control unit <b>20</b> adds the time lag information indicating the calculated time lag (Td<sup>(k)</sup>) onto the generated data (step S<b>53</b>), and decides whether the time clocked by the clock unit <b>22</b> comes to the estimated time (Ts<sup>(k)</sup>) of the sending start time point having been set at the step S<b>51</b> or not (step S<b>54</b>). When having decided that the time does not come to the set estimated time (Ts<sup>(k)</sup>) of the sending start time point (S<b>54</b>: NO), the control unit <b>20</b> returns the procedure to the step S<b>54</b>.</p>
<p id="p-0091" num="0090">When having decided that the time comes to the set estimated time (Ts<sup>(k)</sup>) of the sending start time point (<b>554</b>: YES), the control unit <b>20</b> allows the communication unit <b>23</b> to try transferring (i.e., sending) the data and decides whether the communication unit succeeds or fails to start transferring the data (step S<b>55</b>). When having determined that the communication unit fails to start transferring the data because another of the ECUs <b>1</b>, <b>1</b>, . . . or the relay apparatus <b>2</b><i>b </i>connected to the communication line <b>3</b><i>b </i>is in communication or the control unit <b>20</b> is not selected by the arbitration (S <b>55</b>: NO), the control unit <b>20</b> returns the procedure to the step S<b>51</b> and sets new estimated time Ts<sup>(k) </sup>of the transferring start time point for trying to transfer the received data again.</p>
<p id="p-0092" num="0091">When having decided that the communication unit succeeds to start transferring the received data because the ECUs <b>1</b>, <b>1</b>, . . . , and the relay apparatus <b>2</b><i>b </i>connected to the communication line <b>3</b><i>b </i>are not in communication or the control unit <b>20</b> is selected by the arbitration (S<b>55</b>: YES), the control unit <b>20</b> continues the transferring process of the received data, and terminates the procedure after completing the transferring process.</p>
<p id="p-0093" num="0092">Although the set estimated time is added on the data as the time of the transferring start time point, the set estimated time becomes just the time that the transferring process of the received data has been actually started, in the case that the communication unit has succeeded to start transferring (i.e., sending) the data. Therefore, it is possible to correctly determine the time of the generating time point of the received data, even on the basis of the time lag information indicating the time lag (Td<sup>(k)</sup>) that is calculated through the procedure shown by the flowchart of <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0094" num="0093">The embodiment 2 is configured to try sending and transferring data after obtaining information including the time lag information. Therefore, the communication control unit <b>13</b> and the communication unit <b>23</b> do not require performing the re-writing process of the field indicating time lag information within the data that is in the sending process or the transferring process.</p>
<p id="p-0095" num="0094">The embodiments 1 and 2 are illustrated to transmit the time lag information indicating the time lag that is calculated on the basis of the time information clocked by each clock unit <b>12</b> of the ECUs <b>1</b>, <b>1</b>, . . . and each clock unit <b>22</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . and the time lag information is illustrated to be transmitted together with the transmitted data. However, such the time lag information may be configured to indicate a time lag expressed, for example, in nanoseconds. In that configuration, each clock unit <b>12</b> of the ECUs <b>1</b>, <b>1</b>, . . . may clock with a predetermined frequency different from the frequency with which each clock unit <b>22</b> of the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, clocks. Thus, even in the case that the clock unit <b>12</b> of the ECU <b>1</b> connected to the communication line <b>3</b><i>a </i>is configured to clock with 600 MHz and the clock unit <b>22</b> of the relay apparatus <b>2</b><i>a </i>is configured to clock with 3 GHz, the time lag information can be transmitted after the expression of the transmitted time lag information is modified with nanoseconds, and the control unit <b>10</b> and the control unit <b>20</b> can respectively match the unit of the transmitted time lag information with the unit of the time information obtained by the clocking of the clock unit <b>12</b> and the clock unit <b>22</b>.</p>
<p id="p-0096" num="0095">The embodiments 1 and 2 are illustrated that the communication lines <b>3</b><i>a</i>, <b>3</b><i>b </i>are based on the CAN protocol. However, the present invention is not limited to utilize such the data communication based on the CAN protocol through the communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>. It is possible to utilize the data communication based on another protocol, such as the Local Interconnect Network (LIN), and the Flex Ray (registered trade mark), for example, with applying such the protocol to the communication apparatus included in the communication system mounted on a motor vehicle.</p>
<p id="p-0097" num="0096">The embodiments 1 and 2 are illustrated that the ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . are respectively connected to the communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>, . . . with a bus topology. Thus, it is possible to abandon sending data from a plurality of apparatuses simultaneously, to make another apparatuses simultaneously receive the data sent by one apparatus through monitoring the communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>, . . . , and to neglect a time lag between the time of the sending start time point and the time of the receiving start time point, in the data communication through the communication lines <b>3</b><i>a</i>, <b>3</b><i>b</i>, . . . . However, the present invention is not limited to this illustration. The ECUs <b>1</b>, <b>1</b>, . . . and the relay apparatuses <b>2</b><i>a</i>, <b>2</b><i>b</i>, . . . may be connected with another connection topology that causes no-zero time lag between the time of the sending start time point and the time of the receiving start time point. Although the caused no-zero time lag may have an effect on determining the time of the generating time point, such topology does not cause a problem in the case that the caused no-zero time lag have little effect on the accuracy required for the time of the generating time point to be determined.</p>
<p id="p-0098" num="0097">As this invention may be embodied in several forms without departing from the spirit of essential characteristics thereof, the present embodiment is therefore illustrative and not restrictive, since the scope of the invention is defined by the appended claims rather than by the description preceding them, and all changes that fall within metes and bounds of the claims, or equivalence of such metes and bounds thereof are therefore intended to be embraced by the claims.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>The invention claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A communication apparatus having a clock unit, and a communication unit for sending and receiving data, comprising:
<claim-text>a data generating unit that generates a first data;</claim-text>
<claim-text>a generation obtaining unit that obtains a generating time point based on the clock unit and corresponding to the time that the first data is generated;</claim-text>
<claim-text>a sending obtaining unit that obtains a sending start time point based on the clock unit and corresponding to the time that the communication unit starts to externally send the first data;</claim-text>
<claim-text>a calculation unit that calculates a time lag between the generating time point and the sending start time point;</claim-text>
<claim-text>an addition unit that adds time lag information onto the first data, the time lag information indicating the time lag calculated by the calculation unit;</claim-text>
<claim-text>a reception determination unit that determines a receiving start time point based on the clock unit and corresponding to the time that the communication unit externally receives a second data;</claim-text>
<claim-text>an extraction unit that extracts added time lag information from the second data; and</claim-text>
<claim-text>a generation determination unit that determines a data generating time point of the second data based on the added time lag information and the receiving start time point, wherein</claim-text>
<claim-text>the communication unit externally sends the first data onto which the time lag information has been added by the addition unit.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The communication apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>a send time determination unit that determines, based on the clock unit, whether the sending start time point has elapsed, wherein</claim-text>
<claim-text>when the send time determination unit determines that the sending start time point has elapsed,</claim-text>
<claim-text>the sending obtaining unit obtains a new sending start time point,</claim-text>
<claim-text>the calculation unit recalculates the time lag,</claim-text>
<claim-text>the addition unit updates the time lag information added onto the first data, and</claim-text>
<claim-text>the communication unit resends the first data onto which the time lag information has been added by the addition unit.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The communication apparatus according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, further comprising:
<claim-text>a transfer obtaining unit that obtains a transferring start time point based on the clock unit and corresponding to the time that the communication unit starts to externally send the second data; and</claim-text>
<claim-text>a second calculation unit calculates a second time lag between the generating time point of the second data and the transferring start time point, wherein</claim-text>
<claim-text>the addition unit adds second time lag information onto to the second data, the second time lag information indicating the second time lag calculated by the second calculation unit, and</claim-text>
<claim-text>the communication unit sends the second data onto which the second time lag information has been added by the addition unit to another communication apparatus.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The communication apparatus according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>a transfer obtaining unit that obtains a transferring start time point based on the clock unit and corresponding to the time that the communication unit starts to externally send the second data; and</claim-text>
<claim-text>a second calculation unit calculates a second time lag between the generating time point of the second data and the transferring start time point, wherein</claim-text>
<claim-text>the addition unit adds second time lag information onto to the second data, the second time lag information indicating the second time lag calculated by the second calculation unit, and</claim-text>
<claim-text>the communication unit sends the second data onto which the second time lag information has been added by the addition unit to another communication apparatus.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. A communication system comprising a plurality of communication apparatuses, each communication apparatus having a clock unit, and a communication unit for sending and receiving data, wherein each communication apparatus comprises:
<claim-text>a data generating unit that generates a first data;</claim-text>
<claim-text>a generation obtaining unit that obtains a generating time point based on the clock unit and corresponding to the time that the first data is generated;</claim-text>
<claim-text>a sending obtaining unit that obtains a sending start time point based on the clock unit and corresponding to the time that the communication unit starts to externally send data;</claim-text>
<claim-text>a calculation unit that calculates a time lag between the generating time point and the sending start time point;</claim-text>
<claim-text>an addition unit that adds time lag information onto the first data, the time lag information indicating the time lag calculated by the calculation unit;</claim-text>
<claim-text>a reception determination unit that determines a receiving start time point based on the clock unit and corresponding to the time that the communication unit externally receives a second data;</claim-text>
<claim-text>an extraction unit that extracts added time lag information from the second data; and</claim-text>
<claim-text>a generation determination unit that determines a data generating time point of the second data based on the added time lag information and the receiving start time point, wherein</claim-text>
<claim-text>the communication unit externally sends the first data onto which the time lag information has been added by the addition unit.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. A method performed by a communication apparatus having a clock unit, and a communication unit for sending and receiving data, the method comprising:
<claim-text>generating a first data;</claim-text>
<claim-text>obtaining a generating time point based on the clock unit and corresponding to the time that the first data is generated;</claim-text>
<claim-text>obtaining a sending start time point based on the clock unit and corresponding to the time that data is sent;</claim-text>
<claim-text>calculating a time lag between the generating time point and the sending start time point;</claim-text>
<claim-text>adding time lag information onto the first data, the time lag information indicting the time lag;</claim-text>
<claim-text>determining a receiving start time point based on the clock unit and corresponding to the time that a second data is received;</claim-text>
<claim-text>extracting added time lag information from the second data;</claim-text>
<claim-text>determining a data generating time point of the second data based on the added time lag information and the receiving start time point; and</claim-text>
<claim-text>sending the first data onto which the time lag information has been added.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. A method performed by a communication apparatus having a clock unit, and a communication unit for sending and receiving data, the method comprising:
<claim-text>determining a sending start time point to send a data;</claim-text>
<claim-text>calculating a time lag between time of the sending start time point and a generating time point at which the data is generated;</claim-text>
<claim-text>adding time lag information onto the data, the time lag information indicating the time lag;</claim-text>
<claim-text>deciding whether the sending start time point has elapsed;</claim-text>
<claim-text>sending the data onto which the time lag information has been added when it is decided that the sending start time point has elapsed; and</claim-text>
<claim-text>when it determined that the sending start time point has elapsed:</claim-text>
<claim-text>obtaining a new sending start time point;</claim-text>
<claim-text>recalculating the time lag based on the new sending start time point and the generating time point at which the data is generated;</claim-text>
<claim-text>updating the time lag information added onto the data, and</claim-text>
<claim-text>resending the data onto which the time lag information has been added. </claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
