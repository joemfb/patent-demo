<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08624669-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08624669</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>13327009</doc-number>
<date>20111215</date>
</document-id>
</application-reference>
<us-application-series-code>13</us-application-series-code>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>GB</country>
<doc-number>1021393.2</doc-number>
<date>20101216</date>
</priority-claim>
</priority-claims>
<us-term-of-grant>
<us-term-extension>90</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>H</section>
<class>03</class>
<subclass>F</subclass>
<main-group>1</main-group>
<subgroup>02</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>330  9</main-classification>
<further-classification>330137</further-classification>
</classification-national>
<invention-title id="d2e71">DC offset compensation</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>4356450</doc-number>
<kind>A</kind>
<name>Masuda</name>
<date>19821000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>4807146</doc-number>
<kind>A</kind>
<name>Goodrich et al.</name>
<date>19890200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>5397944</doc-number>
<kind>A</kind>
<name>DuPuis</name>
<date>19950300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>5789974</doc-number>
<kind>A</kind>
<name>Ferguson, Jr. et al.</name>
<date>19980800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6029497</doc-number>
<kind>A</kind>
<name>Brinks et al.</name>
<date>20000200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6756924</doc-number>
<kind>B2</kind>
<name>Lee et al.</name>
<date>20040600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>341120</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>7042252</doc-number>
<kind>B2</kind>
<name>Galloway et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>327 16</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>8416019</doc-number>
<kind>B2</kind>
<name>Moses et al.</name>
<date>20130400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>330137 X</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2008/0068058</doc-number>
<kind>A1</kind>
<name>Kim et al.</name>
<date>20080300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>GB</country>
<doc-number>2 196 495</doc-number>
<kind>A</kind>
<date>19880400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>GB</country>
<doc-number>2459865</doc-number>
<kind>A</kind>
<date>20091100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>WO</country>
<doc-number>WO 2007/080528</doc-number>
<kind>A1</kind>
<date>20070700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00013">
<othercit>K.P.S.Rafeeque et al., &#x201c;A Built-in-Self-Test Scheme for Digital to Analog Converters,&#x201d; VLSI Design, 2004, Proceedings, 17th International Conference in Mumbai, India, Jan. 5, 2004, pp. 1027-1032.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>25</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>330  9</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>330 11</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>330137</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>327124</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>327307</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>9</number-of-drawing-sheets>
<number-of-figures>10</number-of-figures>
</figures>
<us-related-documents>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>61423835</doc-number>
<date>20101216</date>
</document-id>
</us-provisional-application>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20120154032</doc-number>
<kind>A1</kind>
<date>20120621</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Lesso</last-name>
<first-name>John Paul</first-name>
<address>
<city>Edinburgh</city>
<country>GB</country>
</address>
</addressbook>
<residence>
<country>GB</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Lesso</last-name>
<first-name>John Paul</first-name>
<address>
<city>Edinburgh</city>
<country>GB</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Dickstein Shapiro LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Wolfson Microelectronics plc</orgname>
<role>03</role>
<address>
<city>Edinburgh</city>
<country>GB</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Mottola</last-name>
<first-name>Steven J</first-name>
<department>2817</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">An apparatus and method for DC offset compensation. An amplifier receives an input signal (A<sub>IN</sub>) and provides an amplified output signal (S<sub>OUT</sub>) and a feedback path provides DC offset compensation. The feedback path comprises at least one voltage controlled oscillator (VCO) and a counter. The VCO provides, over time, a first VCO output signal based on said amplified output signal and a second VCO output signal based on a reference signal (V<sub>REF</sub>). The counter generates first pulse counts based upon the first VCO output signal and second pulse counts based upon the second VCO output signal and provides a compensation signal based on a comparison of the first and second pulse counts. One voltage controlled oscillator may sequentially receive a signal based on said amplifier output signal and the reference signal from a multiplexer so as to sequentially produce the first and second VCO output signals.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="64.69mm" wi="119.89mm" file="US08624669-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="71.80mm" wi="119.38mm" file="US08624669-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="150.88mm" wi="150.96mm" file="US08624669-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="163.83mm" wi="145.37mm" file="US08624669-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="151.13mm" wi="153.08mm" orientation="landscape" file="US08624669-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="127.17mm" wi="145.54mm" file="US08624669-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="112.52mm" wi="151.89mm" file="US08624669-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="205.23mm" wi="118.11mm" orientation="landscape" file="US08624669-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="225.21mm" wi="95.25mm" orientation="landscape" file="US08624669-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="80.35mm" wi="143.34mm" file="US08624669-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<p id="p-0002" num="0001">This application claims the benefit of U.S. Provisional Application No. 61/423,835, filed on Dec. 16, 2010.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0003" num="0002">1. Field of the Invention</p>
<p id="p-0004" num="0003">The present invention relates to apparatus and methods for DC offset compensation especially in audio circuitry such as audio amplifier circuitry.</p>
<p id="p-0005" num="0004">2. Description of the Related Art</p>
<p id="p-0006" num="0005">It is known that the presence of a DC offset voltage can cause problems in audio amplifier circuitry. In many applications an audio amplifier is driven with balanced positive and negative voltage supplies (e.g. +VDD and &#x2212;VDD) so that the quiescent output voltage can be ground so that no AC coupling/DC blocking capacitor is required for the output signal when driving a grounded load. The presence of a DC offset voltage at the output of the audio amplifier can then lead to an offset voltage being suddenly imposed on the speaker load at power-up, or conversely suddenly removed at power-down, which may lead to an audio artefact such as an audible &#x2018;pop&#x2019;. Such an audio artefact is undesirable and should be reduced, or preferably avoided, if possible. Further the presence of a DC offset voltage can lead to power wastage due to the resultant quiescent load current having to be sourced from a supply by the driver amplifier. Such wastage is an issue for battery powered devices where unnecessary power consumption reduces battery life.</p>
<p id="p-0007" num="0006">A DC offset may arise in an audio amplifier circuit in a number of ways. The driver amplifier may have a random input offset voltage. In many typical audio devices the audio signal to be amplified is received in digital form and is converted to an analogue signal by an audio digital-to-analogue convertor (DAC) for subsequent amplification. This audio DAC may also suffer from random DC offsets. Charge injection effects, for example in a switched-capacitor DAC, or mismatch between sink and source currents in a current-steering DAC may be sources of DC offset. Further, the DAC may be driven between a single voltage supply (e.g. +AVDD) and ground, and thus the analogue output signal from the DAC may require level shifting from say AVDD/2 before being input to the amplifier. Errors in the level shifting may also introduce DC offset. Whilst efforts are made to minimise DC offset it is difficult to completely eliminate DC offset in practical circuits.</p>
<p id="p-0008" num="0007">It is therefore known to provide extra circuitry to eliminate, or reduce, DC offsets, i.e. to provide DC offset compensation circuitry, in integrated circuits for audio amplifiers. One known DC offset compensation system has a feedback path which comprises an analogue-to-digital convertor (ADC) and a digital integrator or low pass filter. The analogue output signal from the amplifier is compared to a reference signal which corresponds to the desired quiescent DC output voltage, say ground, and the resulting output error signal is converted to a digital signal by the ADC and then digitally filtered or integrated to give high gain at DC but attenuate audio-band components in the resultant digital correction signal output from the filter. The correction, or compensation, signal may be combined with the input digital audio signal prior to the audio DAC or alternatively converted into an analogue signal by a separate DAC and combined with the analogue input signal for the amplifier. In either case any DC offset present at the amplifier output is cancelled by the high DC gain negative feedback.</p>
<p id="p-0009" num="0008">Such an offset compensation circuit provides an accurate and useful method of compensating for a DC offset. However the ADC is a relatively large component. In integrated circuits larger circuit area leads to higher cost. Further in some applications there may a limit on the size of chip, for example in chip scale packaging it may be wished to limit the size of chip to match that of a standard ball array to avoid any strain mismatch effects or reliability issues arising from overhang of the silicon die over the ball array. Thus in some applications the use of relatively large circuit components is undesirable. This may be exacerbated by the need to provide respective DC offset compensation for a plurality of audio outputs. Many typical devices, such as a portable audio device, may have audio signal outputs for headphones, an audio line out for driving speakers, for example via a docking station, an audio signal line to internal speakers and, in some cases, audio outputs for noise cancellation speakers. Some or all of these outputs may comprise a stereo pair of outputs. Thus a single chip, i.e. a single integrated circuit, may comprise a plurality of audio signal outputs each with its own associated amplifier circuitry and each having its own associated DC offset which requires compensation. Providing a separate DC offset compensation circuit as described for each audio signal line would involve a relatively significant amount of chip real estate.</p>
<p id="p-0010" num="0009">The known DC offset compensation circuitry described above can advantageously be multiplexed between several different audio signal lines to compensate for the DC offset for each signal line in turn. Once a stable DC offset correction has been achieved for a signal line, the value of the correction signal can be latched for that signal line and the compensation circuitry used to compensate for the DC offset on another signal line. However, clearly this does mean that settling time for reaching steady state compensation for the chip as a whole is equal to the sum of the individual settling times for each of the audio signal outputs. In some applications a relatively fast settling time may be required and multiplexing the offset compensation circuit between multiple outputs may thus not be possible.</p>
<heading id="h-0002" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0011" num="0010">Thus according to the present invention there is provided audio amplification circuitry comprising: an amplifier configured to receive an input signal and provide an amplified output signal; and a feedback path wherein said feedback path comprises compensation circuitry for outputting a compensation signal, wherein the compensation circuitry comprises: at least one voltage controlled oscillator (VCO) configured to provide, over time, a first VCO output signal based on said amplified output signal and a second VCO output signal based on a reference signal, and a counter configured to generate first pulse counts based upon the first VCO output signal and second pulse counts based upon the second VCO output signal and to provide the compensation signal based on a comparison of the first and second pulse counts.</p>
<p id="p-0012" num="0011">According to a further aspect of the present invention there is provided a method of compensating for DC offset in an audio amplifier output signal, the method comprising the steps of:</p>
<p id="h-0003" num="0000">receiving a signal based on the amplifier output signal;</p>
<p id="h-0004" num="0000">receiving a reference signal based on a target DC offset;</p>
<p id="h-0005" num="0000">driving a voltage controlled oscillator (VCO) with the signal based on the amplifier output signal to provide a first VCO output signal;</p>
<p id="h-0006" num="0000">driving a voltage controlled oscillator (VCO) with the reference signal to provide a second VCO output signal;</p>
<p id="h-0007" num="0000">generating first pulse counts based upon the first VCO output signal and second pulse counts based upon the second VCO output signal;</p>
<p id="h-0008" num="0000">comparing said first and second pulse counts; and</p>
<p id="h-0009" num="0000">deriving a DC offset compensation signal from said comparison of pulse count.</p>
<p id="p-0013" num="0012">In a further aspect of the present invention there is provided a DC offset compensation circuitry for compensating for DC offset in a first signal comprising: a voltage controlled oscillator configured to provide a first output signal based on said first signal and a second output signal based on a reference signal; and a counter configured to count the pulses of the first output signal and the second output signal and compare said pulse counts.</p>
<p id="p-0014" num="0013">In a yet further aspect there is provided compensation circuitry for compensating for DC offset in a first signal comprising a voltage controlled oscillator and a counter.</p>
<p id="p-0015" num="0014">Another aspect of the invention provides DC offset compensation circuitry for compensating for DC offset in a signal path wherein said compensation circuitry is multiplexed between a first feedback loop for compensating for offset in a first part of the signal path and a second feedback loop for compensating for offset in a second part of the signal path.</p>
<p id="p-0016" num="0015">A yet further aspect of the invention provides an audio signal amplification circuit having an output, said circuit comprising a feedback path which comprises a voltage controlled oscillator and a counter, wherein the voltage controlled oscillator is responsive to the signal at said output.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0010" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0017" num="0016">The invention will now be described by way of example only with reference to the following drawings, of which:</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 1</figref> illustrates an embodiment of an amplification circuit having DC offset compensation according to the present invention;</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIGS. 2</figref><i>a </i>and <b>2</b><i>b </i>shows two embodiments of the DC offset compensation circuitry comprising an integrating counter;</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 3</figref> illustrates the operation of the DC offset compensation circuitry comprising an integrating counter as shown in <figref idref="DRAWINGS">FIG. 2</figref><i>a; </i></p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 4</figref> illustrates the operation of the DC offset compensation circuitry comprising an up/down counter as shown in <figref idref="DRAWINGS">FIG. 2</figref><i>b; </i></p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 5</figref> shows one embodiment of a suitable VCO;</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 6</figref> shows an embodiment of an audio circuit of a device having a plurality of audio outputs and a plurality of offset compensation circuits;</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 7</figref> shows an embodiment of the offset compensation circuitry with a variable gain;</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 8</figref> shows another embodiment of the offset compensation circuitry with a variable gain; and</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 9</figref> shows an embodiment of the offset compensation circuitry having inner and outer feedback loops.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0011" level="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS</heading>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 1</figref> illustrates an audio amplification circuit having DC offset compensation circuitry according to an embodiment of the present invention.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 1</figref> shows an audio amplifier circuit that receives a digital input signal D<sub>IN </sub>at digital-to-analogue converter (DAC) <b>101</b>. The DAC <b>101</b> converts the input signal to an analogue signal. An amplifier <b>102</b> receives and amplifies the analogue signal, A<sub>IN</sub>. The amplified output signal S<sub>OUT </sub>is then supplied to a load <b>103</b>, such as a loudspeaker. The load <b>103</b> may be internal to a host device, such as an internal speaker of the host device or may be external, such as a headphone speaker connected via an appropriate connection <b>104</b> such as a stereo jack plug.</p>
<p id="p-0029" num="0028">The amplifier <b>102</b> may typically be supplied by bipolar voltage supplies, such as +VDD and &#x2212;VDD whereas the DAC <b>101</b> may typically be supplied by a unipolar voltage supply, e.g. connected between single positive supply +AVDD (which may or may not be equal to +VDD) and ground. The quiescent DAC output voltage may thus be set to be about +AVDD/2. Thus there may be a need for level shifting circuitry <b>105</b> to shift the analogue output from the DAC <b>101</b> A&#x2032;<sub>IN </sub>such that the level shifted analogue signal A<sub>IN </sub>input to the amplifier is notionally centred on ground. It will of course be appreciated that whilst <figref idref="DRAWINGS">FIG. 1</figref> shows an embodiment receiving a digital input signal in some embodiments an analogue signal may be received instead and in some embodiments either an analogue or a digital signal may be received. In such embodiments DAC <b>101</b> will not be required, or may only be used when required, and, depending on the nature of input analogue signal, level shifting circuitry <b>105</b> may also not be required.</p>
<p id="p-0030" num="0029">The amplifier circuit may also comprise one or more pre-amplifiers <b>106</b> in the audio signal path for pre-amplifying the analogue signal.</p>
<p id="p-0031" num="0030">The amplifier <b>102</b>, and any pre-amplifiers <b>106</b>, may have a random, or systematic but maybe unpredictable, DC offset. Likewise the DAC <b>101</b> may have a random, or systematic but maybe unpredictable, DC offset. Errors in the level shifting may also introduce a random, or systematic but maybe unpredictable, DC offset.</p>
<p id="p-0032" num="0031">On initial power-up of such a circuit, which usually occurs before any audio signal is received, any DC offsets inherent in the circuit will lead to a DC voltage in the output signal S<sub>OUT</sub>. During at least the initial stages of power-up the output of the amplifier circuit may be isolated from the connection to the load. In a very simple scheme this isolation could be achieved by a series switch but the skilled person would be aware of other more sophisticated methods for isolating the amplifier from the load which avoid the need for switches in the signal path. In any event when the load is eventually connected this DC voltage will be imposed rapidly on the speaker <b>103</b>, which can cause a noticeable audible artefact such as an audible &#x2018;pop&#x2019; which is undesirable. A similar effect may occur if the circuit has been in an inactive low power mode, with the amplifier disabled to save power, and then is subsequently powered-up for use. Similarly on power-off the rapid drop in voltage may also cause a &#x2018;pop&#x2019;. Also in normal operating conditions the presence of a DC offset in the output signal consumes power due to the resultant quiescent load current having to be sourced from a supply by the driver amplifier and results in unnecessary power wastage, which is a particular issue for battery powered devices.</p>
<p id="p-0033" num="0032">The audio amplifier therefore comprises compensation circuitry <b>107</b> in the feedback path for compensating for DC offset voltage in the output signal S<sub>OUT</sub>. The feedback circuitry <b>107</b> comprises a voltage controlled oscillator <b>108</b> and a counter <b>109</b>.</p>
<p id="p-0034" num="0033">A voltage controlled oscillator (VCO) produces an output (in effect a pulse train) with a frequency that depends on its input voltage. Changing the input voltage results in a change of frequency of the output pulse train. The VCO is configured, over time, to produce a first VCO output signal based on the amplified output signal S<sub>OUT </sub>and also a second VCO output signal based on a reference signal, V<sub>REF</sub>. The reference signal, V<sub>REF</sub>, is a voltage signal indicative of the target quiescent DC voltage. When the desired quiescent DC output voltage is equal to ground the reference signal may therefore comprise ground. However in other embodiments a particular DC level for a zero amplitude AC signal may be required and the reference signal V<sub>REF </sub>will correspond to such a target DC level. In the embodiment shown in <figref idref="DRAWINGS">FIG. 1</figref> the first and second VCO output signals are generated at different times and the relevant input to the VCO <b>108</b> is selected by multiplexer <b>110</b>: it will be understood by those skilled in the art that a multiplexer, and indeed a demultiplexer, are effectively controlled switches.</p>
<p id="p-0035" num="0034">The counter <b>109</b> is arranged to generate pulse counts for the first and second VCO output signals, i.e. to generate first and second pulse counts respectively, and to compare the pulse counts so as to determine any difference in frequency of the first and second VCO outputs. The pulse count in a set period of time is a measure of the frequency of the VCO output, which depends on the input voltage of the VCO and hence a comparison of the pulse counts can be used as an indication of differences in the respective input voltages.</p>
<p id="p-0036" num="0035">The polarity or sign, i.e. positive or negative, of a difference in pulse counts between the first and second VCO output signals, i.e. whether there are more or less pulses in the first VCO output signal than in an equal period of the second VCO output signal, may be used to determine whether the output signal voltage level is higher or lower than the reference signal. Further the difference in pulse counts gives an indication of the difference in voltage level between the two signals (the greater the difference in pulse count the greater the difference between the voltage levels of the output signal and the reference signal). This difference in pulse counts can therefore be used as the basis of the generation of a compensation signal as will be described in more detail below.</p>
<p id="p-0037" num="0036">The use of a VCO <b>108</b> and counter <b>109</b> can therefore provide an accurate DC offset compensation circuit <b>107</b> that avoids the need for a conventional ADC in the feedback path. This reduces a possible source of offset error associated with the ADC of the feedback path which is advantageous. Further the VCO is significantly smaller than the ADC, as will be described below, allowing significant savings in area of silicon consumed by the circuit. In contrast to standard ADCs, the VCO/counter combination as used here requires no matched active or passive components, and little analogue circuitry, rendering it increasingly advantageous as silicon manufacturing technology migrates to smaller geometry nodes.</p>
<p id="p-0038" num="0037">The VCO <b>108</b> and counter <b>109</b> are arranged to provide a desired level of accuracy of compensation. For example the DC offset may be cancelled to an accuracy of 100 &#x3bc;V or so.</p>
<p id="p-0039" num="0038">In many applications the DC offset to be cancelled may be relatively small, say &#xb1;10 mV or so. Also in many applications the upstream signal may be muted during initialisation. There may be some thermal noise or quantisation noise (e.g. from a delta-sigma type of audio DAC <b>101</b>) present but this will usually be filtered in the audio signal path so will be of the order of millivolts. Thus the linearity and range requirements of the VCO <b>108</b> may be relatively modest.</p>
<p id="p-0040" num="0039">It will of course be appreciated that the VCO transfer function, i.e. the relationship between input voltage and output frequency, may vary over time, for example with temperature drifts or the like. Thus the exact relationship between input voltage and frequency may not be known at any given time. However, this is not a problem as, in the embodiment described above, the compensation circuitry provides a relative measure. Any difference in voltage between the DC offset in the output signal S<sub>OUT </sub>and the reference signal V<sub>REF </sub>will lead to a frequency difference in the first and second VCO output signals which will, in turn, result in a difference in pulse counts. In operation the compensation signal developed by the compensation circuitry <b>107</b> will bring the DC offset signal closer to the reference signal until, when they are equal, the same frequency will be produced in the first and second VCO output signals and there will be no difference in pulse counts. Thus any change in VCO transfer function, such as due to temperature changes or the like, does not affect operation of the correction circuitry <b>107</b>.</p>
<p id="p-0041" num="0040">The embodiment shown in <figref idref="DRAWINGS">FIG. 1</figref> uses a single VCO <b>108</b> to generate both the first and second VCO output signals, however it will be noted that if two accurately matched, or accurately calibrated, VCOs were to be provided, i.e. two VCOs which, for a given set of operating conditions, have the same transfer function, the first VCO output signal could be generated solely by one VCO receiving a signal based on the output signal S<sub>OUT </sub>and the second VCO output signal could be generated solely by a second independent VCO receiving the reference signal. Thus the first and second VCO output signals could be generated simultaneously. The fact that the VCOs are relatively small means that they may be located close together in an integrated circuit. This means that two independent VCOs may thus experience the same general environmental conditions. However any differences in the VCO transfer function (or changes therein) of the two VCOs may lead to errors in the compensation circuitry. Even a small difference in the transfer function could lead to a significant error and thus the embodiment shown in <figref idref="DRAWINGS">FIG. 1</figref> uses a single VCO <b>108</b> to generate both the first and second VCO output signals to avoid this possible source of error. In this way it doesn't matter exactly what the transfer function is or whether it changes slightly over time as both outputs are produced using the same VCO <b>108</b>.</p>
<p id="p-0042" num="0041">To provide the first VCO output signal based on the output signal S<sub>OUT </sub>and the second VCO output signal based on the reference signal the input of the VCO <b>108</b> is therefore multiplexed between the output signal S<sub>OUT </sub>and the reference signal V<sub>REF </sub>by multiplexer <b>110</b>. The multiplexer <b>110</b>, which may be any type of suitable controlled switching element, may be controlled by a clock control signal CLK to provide sequential periods during which the output audio signal S<sub>OUT </sub>or the reference signal V<sub>REF </sub>are input to the VCO <b>108</b>. The clock control signal CLK may also be supplied to the counter <b>109</b> so that it can determine the relevant periods for the pulse counts. For ease these periods are arranged to be of equal duration so that the counter is inherently counting for equal periods of the first and second VCO outputs but other arrangements are possible. For example, the reference voltage V<sub>REF </sub>will typically be a clean, stable voltage signal whereas the output signal S<sub>OUT </sub>may have some noise component. As will be described later the outputs from the VCO may be effectively averaged over several cycles to improve accuracy. Providing a longer count period to generate first pulse counts for the first VCO output signal than for generating second pulse counts for the second VCO output signal may therefore help improve accuracy. If the count periods are unequal a scaling factor may be applied to either or both pulse counts as required.</p>
<p id="p-0043" num="0042">It should be noted that although <figref idref="DRAWINGS">FIG. 1</figref> shows that a signal input to the multiplexer <b>110</b> is coupled to the amplified output signal S<sub>OUT</sub>, it will be appreciated that this signal S<sub>OUT </sub>may be level shifted or scaled appropriately before being input to the VCO <b>108</b>. Provided that the signal input to the VCO <b>108</b> is representative of the DC offset of the output signal S<sub>OUT</sub>, then the compensation circuitry <b>107</b> will correct for the offset in the output signal. Of course it will also be appreciated that any DC offset generated in the compensation circuitry <b>107</b> itself may lead to errors in the compensation and thus potential sources of DC offset in the compensation circuitry <b>107</b> should be eliminated wherever possible. If there is any level shifting or scaling circuitry the reference signal may likewise be scaled and/or level shifted, either by the same circuitry in a multiplexed fashion or by matched, or calibrated, level shifting circuitry.</p>
<p id="p-0044" num="0043">The output of the counter may be used as the basis for the compensation signal. The counter may provide an output, representing the difference in pulse counts, which is positive or negative, indicating whether the current output signal is above or below the target DC level and also the relative difference between the DC levels. The output of the counter could be used each cycle, i.e. period of CLK, to provide an adjustment to a compensation signal. The value of this count signal may be added or subtracted to a digital compensation signal value and/or used to adjust an analogue voltage level.</p>
<p id="p-0045" num="0044">It will be appreciated that, depending on the quiescent frequency of the VCO <b>108</b>, and the frequency of the clock control signal CLK, there may be significant quantisation errors in a single cycle. However by making an adjustment each cycle over a series of successive cycles the quantisation errors can, in effect, be averaged out.</p>
<p id="p-0046" num="0045">For example consider that the VCO <b>108</b> runs at a quiescent frequency of 200 MHz (i.e. the oscillation frequency with the VCO input at the reference level V<sub>REF</sub>, say ground). Consider also that the clock speed of the CLK signal is 1.5 MHz. Each of the first and second pulse counts is based on half a clock cycle (as the VCO has the reference signal V<sub>REF </sub>as input for half the clock cycle and the output signal S<sub>OUT </sub>as input for the other half of the clock cycle). Thus in one half cycle of the control signal CLK the number of pulses is equal to (200 MHz/1.5 MHz)&#xd7;0.5 which equates to 66.66 recurring. However the counter can only count a finite number of pulses and so the pulse count would either be 66 or 67 depending on where the relevant pulse edges fall within the counting window. This is a reasonably significant error over a single cycle.</p>
<p id="p-0047" num="0046">Clearly the minimum detectable difference in pulse count in a single cycle is one pulse. Consider that the VCO has a voltage-frequency gain factor of 1 GHz/1V (which corresponds to 1 MHz/1 mV). A difference in pulse count of 1 therefore corresponds to a difference in frequency of (1&#xd7;1.5 MHz)/0.5=3 MHz which in turn corresponds to an offset voltage level of 3 mV. Therefore, within any one cycle a difference in offset of up to 3 mV may not lead to a detectable pulse count difference. However by taking the counts from a succession of different cycles, and effectively averaging them the resolution of the compensation circuitry can be improved.</p>
<p id="p-0048" num="0047">For example, consider the effect of combining the pulse counts (or pulse count difference) over 20 cycles. Simplistically the minimum count difference is a single pulse but a difference in a count of 1 pulse over said 20 cycles corresponds, in the example above, to a change in frequency of approximately 0.15 MHz which, at 1 GHz/1V, corresponds to a difference of 0.15 mV.</p>
<p id="p-0049" num="0048">In one embodiment the counter <b>109</b> comprises an integrating counter which integrates the difference in pulse counts from a succession of cycles (either by integrating the difference determined each cycle or alternatively by integrating the pulses counts for each cycle and then determining the difference between the integrated pulse counts).</p>
<p id="p-0050" num="0049"><figref idref="DRAWINGS">FIG. 2</figref><i>a </i>shows an embodiment of the compensation circuitry <b>107</b>, within the feedback path, comprising an integrating counter <b>109</b>. <figref idref="DRAWINGS">FIG. 2</figref><i>a </i>shows an analogue multiplexer <b>110</b> that receives the output signal S<sub>OUT </sub>and the reference signal V<sub>REF </sub>and that is capable of passing each input separately to VCO <b>108</b>. In the embodiment shown in <figref idref="DRAWINGS">FIG. 2</figref> the multiplexer <b>110</b> is controlled based on a control signal CLK as described previously and so provides alternating equal periods of each input but other arrangements are possible. The pulse train output from the VCO <b>108</b> is input to a counter <b>201</b>, the output of which is passed via demultiplexer <b>202</b> to summation block <b>203</b>. The summation block is arranged to receive the separate counts during the alternate phases and, at the end of every cycle of the control signal CLK, to subtract the two counts to provide a count difference. This count difference, a digital number, is integrated in a first-order feedback loop <b>204</b> to average out the finite count error. The first-order feedback loop <b>204</b> is arranged with a delay (typically one cycle) before each output is added back into the signal in order to perform the integration. The delay may be implicit in the operation of summation block <b>203</b> but in some embodiments a delay element <b>205</b> may be included for providing this delay. The resultant integrated count value C<sub>OUT </sub>may be used as a digital compensation signal. In this implementation the counter will reset each half cycle in order to provide separate counts for the two VCO outputs.</p>
<p id="p-0051" num="0050">In embodiments where the counter is arranged to count for equal periods of each VCO output the duty cycle of the clock supplied to the counter should preferably be 50:50. When the circuitry includes an audio DAC a high quality clock signal for clocking the DAC will usually be present (typically at 3 MHz). This audio DAC clock signal may be used to generate the clock signal CLK used by the counter and may be divided inside or very close to the counter to avoid introducing any mismatch between the edges due, for example, to possible mismatched transmission delays across an integrated circuit.</p>
<p id="p-0052" num="0051"><figref idref="DRAWINGS">FIG. 3</figref> illustrates the signals at various parts of the compensation circuitry shown in <figref idref="DRAWINGS">FIG. 2</figref><i>a</i>. The control signal CLK is a two phase clock signal and controls the timing of the compensation circuitry <b>107</b>, in particular the operation of multiplexer <b>110</b>, resetting and sampling the counter, and the addition and delay elements. In the first phase <b>301</b> the output signal S<sub>OUT </sub>is provided to the VCO which results in a first VCO output signal <b>303</b> at a first frequency. In the second phase <b>302</b> the reference signal V<sub>REF </sub>is input to the VCO resulting in a second VCO output signal <b>304</b> at a different frequency. During each phase the counter is counting the number of pulses, i.e. generating first pulse counts based on the first VCO output signal and second pulse counts based on the second VCO output signal. At the end of each phase the total count is stored by the summation block and the counter reset. At the end of the cycle, i.e. the end of the two phases, the count during the second phase is subtracted from the count during the first phase (or vice versa). This value <b>305</b> represents the difference in count for the previous cycle but, as mentioned above suffers from finite count errors. Thus the difference in count is integrated over successive cycles to provide an integrated count value <b>306</b> which can be used as the compensation signal.</p>
<p id="p-0053" num="0052">In an alternative embodiment the function of the integrating counter is provided by an up/down counter. Referring to <figref idref="DRAWINGS">FIG. 2</figref><i>b </i>counter <b>109</b> may therefore comprise an up/down counter <b>206</b>. The up/down counter <b>206</b> receives the control signal CLK and thus counts up (generates first pulse counts) during the period of the first VCO output signal (due to the output signal S<sub>OUT </sub>and counts down (generates second pulse counts) during the period of the second VCO output signal (due to the reference signal V<sub>REF</sub>). At the end of a cycle of the control signal the resultant count value will therefore have increased or decreased by an amount equal to the difference in the first and second pulse counts. Further, if the up/down counter is not reset at the end of each cycle the counter will provide inherent integration. The value of the count from the up/down counter <b>206</b> may therefore be sampled, for instance by a latch <b>207</b>, at the end of each cycle.</p>
<p id="p-0054" num="0053"><figref idref="DRAWINGS">FIG. 4</figref> illustrates operation of such an up/down counter. The control signal alternates in phases <b>401</b> and <b>402</b> leading to first and second VCO output signals of different frequency <b>403</b>, <b>404</b> as described previously. In this arrangement however the up/down counter counts up in the first phase <b>401</b> and counts down in the second phase. Thus over the course of a cycle the overall count will change by an amount equal to number of pulses in the first phase minus the number of pulses in the second phase. At the end of the second phase the up/down counter starts counting up again but the previous count value is not reset. The current count value <b>405</b> is sampled at the end of each cycle to provide the integrated value <b>406</b>.</p>
<p id="p-0055" num="0054">The integrated count value, however produced, thus may form the basis of the compensation signal. The integrated count value is a digital number which may be used to correct the input signal in a number of ways. Referring back to <figref idref="DRAWINGS">FIG. 1</figref> the integrated count value output from counter <b>109</b> may be converted to an analogue signal by a compensation signal DAC <b>112</b> and combined with the analogue input signal, A<sub>IN</sub>, at an analogue summing node <b>113</b> prior to the amplifier <b>102</b>. The compensation signal DAC <b>112</b> may be a sigma-delta type DAC to reduce the number of bits required for the DAC and so make it simpler and smaller.</p>
<p id="p-0056" num="0055">Rather than the compensation signal being injected directly into the signal path, the compensation signal may, via a path <b>114</b>, be applied to an offset input of the amplifier <b>102</b> so as to modulate the input offset voltage of the amplifier <b>102</b> (and/or any other amplifier in the signal path). The compensation signal may be used to trim any mismatch directly at the input stage of the amplifier <b>102</b> by a variety of ways that are well known in the art. An advantage of directly adjusting the input stage of the amplifier <b>102</b> is that any offset can be cancelled, or at the very least minimised, independently of any gain setting that may exist around the amplifier <b>102</b>.</p>
<p id="p-0057" num="0056">Alternatively, where a digital input signal is received the digital compensation signal may be combined digitally with the digital input signal, D<sub>IN</sub>, for example at node <b>115</b> prior to the DAC <b>101</b> of the audio path.</p>
<p id="p-0058" num="0057">At this point it is noted that the terms signal path, feedback loop, feedback path and feedforward (or forward) path are used in this description. The paths or loops referred to be these terms will be explained with reference to <figref idref="DRAWINGS">FIG. 1</figref>. The signal path is the path taken by the audio signal from input to output. Thus as shown in <figref idref="DRAWINGS">FIG. 1</figref> the signal path runs from left to right from D<sub>IN </sub>to output connector <b>104</b> (and ultimately to load <b>103</b> when connected). The feedback path comprises the path from tap node <b>116</b> in the signal path back to the summing node <b>113</b> via the compensation circuitry <b>107</b>. The forward path or feedforward path corresponds to the part of the signal path between the summing node <b>113</b> and the tap node <b>116</b>. Together the feedback path and the feedforward path comprise the feedback loop.</p>
<p id="p-0059" num="0058">It will of course be appreciated that <figref idref="DRAWINGS">FIG. 1</figref> shows various alternatives, if instead the compensation signal is fed back to summing node <b>115</b> then this node represents the end of the feedback path and the start of the feedforward path. If the compensation signal is supplied directly to modulate the amplifier, then path <b>114</b> may comprise part of the feedback path and the forward path starts at the amplifier.</p>
<p id="p-0060" num="0059">As mentioned above the use of a VCO <b>108</b> and counter <b>109</b> provides an accurate offset correction circuit that is relatively small in area. The VCO <b>108</b> itself can be relatively very small. The skilled person will be well aware of suitable VCOs that could be used. For example the VCO could comprise a chain of N small inverters <b>501</b><i>a</i>-<i>c </i>such as illustrated in <figref idref="DRAWINGS">FIG. 5</figref>. In some embodiments the VCO may also include a decoupling capacitor <b>502</b> for power supply ripple rejection (PSRR). A further variation is to use the output of each stage, and clock subsequent circuitry when an edge appears on any one stage, to increase the effective frequency and hence resolution of the VCO.</p>
<p id="p-0061" num="0060">Thus the offset compensation circuitry of this embodiment of the present invention can be significantly smaller than offset compensation circuitry of the prior art which requires large area ADCs. For example, in one silicon process geometry, one ADC used in conventional offset compensation for audio amplifiers comprises a silicon area that is over seven times that required for the VCO and counter according to an embodiment of the present invention. This reduction in silicon area required provides a significant saving in cost.</p>
<p id="p-0062" num="0061">The relatively low area consumed by the compensation feedback circuitry means that the need to multiplex the offset compensation circuitry between a large number of different audio signal paths is reduced. Thus, for circuits having a plurality of different audio outputs, more than one DC offset compensation circuit may be provided to reduce or eliminate the need for multiplexing, without unduly increasing the chip area required. For example each individual audio signal output line could be provided with its own dedicated offset calibration circuit and/or a small number of audio signal lines may share a DC offset compensation circuit, which may also avoid the need for long interconnections for connecting to a shared compensation circuit and thus reduce signal pick-up problems.</p>
<p id="p-0063" num="0062"><figref idref="DRAWINGS">FIG. 6</figref> shows an example of a circuit <b>620</b> having four audio signal paths <b>600</b><i>a</i>-<i>d</i>, each having a DAC <b>601</b><i>a</i>-<i>d</i>, an amplifier <b>606</b><i>a</i>-<i>d </i>and an output terminal <b>604</b><i>a</i>-<i>d</i>. Signal paths <b>600</b><i>a </i>and <b>600</b><i>b </i>may, for example form a stereo pair for a headphone output <b>630</b> and signal paths <b>600</b><i>c </i>and <b>600</b><i>d </i>may, for example, comprise a stereo pair for internal loudspeakers <b>640</b> of a host device <b>650</b>. The signal paths may be provided by audio processing circuitry <b>625</b> which may be part of the same integrated circuit <b>620</b> as the signal paths or may comprise a separate circuit.</p>
<p id="p-0064" num="0063">Each stereo pair of signal paths, i.e. <b>600</b><i>a </i>and <b>600</b><i>b </i>or <b>600</b><i>c </i>and <b>600</b><i>d </i>is provided with an offset compensation circuit <b>607</b>-<b>1</b>, <b>607</b>-<b>2</b> which is multiplexed, i.e. switched, between the relevant two signal paths by multiplexers <b>620</b>-<b>1</b>, <b>620</b>-<b>2</b> and demultiplexers <b>621</b>-<b>1</b>, <b>621</b>-<b>2</b>: it will be understood by those skilled in the art that the multiplexers and demultiplexers are examples of switches.</p>
<p id="p-0065" num="0064">In operation, for example on power-up, multiplexer <b>620</b>-<b>1</b> supplies the output from one of the signal paths, e.g. <b>600</b><i>a</i>, to the compensation circuit <b>607</b>-<b>1</b>. The resulting compensation signal is passed by demultiplexer <b>621</b>-<b>1</b> back to the relevant signal path, <b>660</b><i>a</i>. The feedback loop operates until a stable compensation signal is developed which compensates for the DC offset in the output of the relevant signal. Acquiring a stable compensation signal may be taken to have occurred after a certain set period of time or alternatively may be determined by monitoring whether the compensation signal is no longer changing or only changing by less than a threshold amount. This stable value of compensation signal is then latched in the appropriate latch, e.g. <b>622</b><i>a</i>. In the embodiment shown in <figref idref="DRAWINGS">FIG. 6</figref> the compensation signal is latched in a digital latch which feeds into the digital input of the relevant signal path but alternatively an analogue signal value could be latched and fed into to analogue signal path or indeed could be applied to an offset input of the amplifier <b>606</b><i>a </i>so as to modulate the input offset voltage of the amplifier <b>606</b><i>a </i>(and/or any other amplifier in the signal path). Once the correction for the first signal path, e.g. <b>600</b><i>a</i>, is latched the process will repeat for the other signal path, i.e. <b>600</b><i>b</i>, and multiplexers <b>620</b>-<b>1</b> and demultiplexer <b>621</b>-<b>1</b> will provide a path to signal path <b>600</b><i>b</i>. The compensation process will then be performed for signal path <b>600</b><i>b </i>and the stable compensation signal value latched in latch <b>622</b><i>b</i>. In parallel with the compensation for signal paths <b>600</b><i>a </i>and <b>600</b><i>b </i>the compensation circuitry <b>607</b>-<b>2</b> will be performing similar DC offset compensation for one and then the other of signal paths <b>600</b><i>c </i>and <b>600</b><i>d. </i></p>
<p id="p-0066" num="0065">As the compensation for DC offset for signal paths <b>600</b><i>a </i>and <b>600</b><i>b </i>occurs in parallel with the compensation for signal paths <b>600</b><i>c </i>and <b>600</b><i>d </i>it will be clear that the overall time to achieve compensation is reduced as compared to using a single compensation circuit and compensating for each signal path in turn.</p>
<p id="p-0067" num="0066">Although only four signal paths are shown in <figref idref="DRAWINGS">FIG. 6</figref> some audio circuits may comprise more signal paths. For example there may additionally be a stereo pair of outputs for a line-out signal and also a stereo pair of outputs for noise cancellation speakers. Were an audio circuit with four pairs of stereo outputs produced, then using the known offset compensation circuit having an ADC it may be necessary to multiplex the compensation circuitry between all eight outputs for reasons of chip space. This would still result in an ADC consuming a large amount of silicon area. However if an offset compensation circuit as described above were associated with each stereo pair the chip area consumed by the VCOs and counters of the offset compensation circuitry would still be smaller than the area consumed by the single conventional ADC (by a factor of about 1.8 in one particular geometry) but would allow compensation for all eight outputs to be achieved approximately four times faster.</p>
<p id="p-0068" num="0067">In some applications there may be a relatively short period available for DC offset compensation of multiple audio signal paths. For example a short time may be allowed after power-on before all audio signal paths should be operational or where the audio amplifier chain is powered down in periods of no audio input to save power. This may therefore require the overall time to compensate for the DC offset for each signal path to be short. Being able to provide offset compensation circuitry for each signal path, or each pair of signal paths, without a large increase in chip area is an advantage of embodiments of the present invention.</p>
<p id="p-0069" num="0068">Even with a single signal path however it may be advantageous to be able to guarantee accurate compensation within a short period.</p>
<p id="p-0070" num="0069">The time taken to reach an accurate compensation signal clearly depends on the level of starting DC offset and the accuracy required. It also depends on the closed loop bandwidth of the feedback loop. This bandwidth is equal to the unity gain bandwidth of the open loop, which is defined by the transfer functions of the various elements cascaded in the feedback loop. These include:</p>
<p id="h-0012" num="0000">i) the conversion gain of the VCO, i.e. the difference in pulse count (e.g. expressed as the number of bits) per cycle for a given change in the VCO input (in the example described above the VCO has a conversion gain of 1 bit/3 mV);</p>
<p id="h-0013" num="0000">ii) the transfer function of the counter: for signals of low frequency compared to the sampling period T (T=1/(1.5 MHz) in the example), may be approximated as an ideal integration 1/sT where s is the Laplace variable;</p>
<p id="h-0014" num="0000">iii) the conversion gain of the DAC <b>101</b> or <b>112</b> in terms of voltage out per least significant bit (LSB);</p>
<p id="h-0015" num="0000">iv) the gain of the elements (DAC, amplifier) in the feedforward path; and</p>
<p id="h-0016" num="0000">v) any gains or losses associated with the multiplexer, any level shifting, or any other elements in the feedback path (for simplicity these will be ignored in the discussion below).</p>
<p id="p-0071" num="0070">To consider the effect of the feedback loop bandwidth on the time taken to reach a accurate compensation signal (the settling time) assume that the gain of the elements in the feedforward path is unity, and the conversion gains of the VCO and DAC cancel (i.e. the voltage to produce a single bit difference in the pulse count of the VCO output is the same as the voltage per LSB of the DAC). In this case the open-loop loop transfer function is reduced to a simple integration, with frequency magnitude response 1/(2&#xb7;&#x3c0;&#xb7;f&#xb7;T), where f is the signal frequency. This transfer function has a unity gain bandwidth of 1/(2&#xb7;&#x3c0;&#xb7;T), which is thus also the &#x2212;3 dB bandwidth of the closed loop. In other words, the closed-loop response will be first order with a time constant equal to T. In the example with a sampling period T=1/1.5 MHz=0.66 &#x3bc;s, the bandwidth would thus be 1.5 MHz/(2&#xb7;&#x3c0;)=250 kHz and the closed loop settling time constant 0.66 &#x3bc;s To settle linearly from an initial DC offset 10 mV to a corrected DC offset of 100 uV or so would require In(100)=4.6 time constants, or about 3 &#x3bc;s. In practice the dynamics of settling would be degraded by non-linearities due to the finite resolution, but settling to 100 uV would be expected to be still rapid, less than say 20 us.</p>
<p id="p-0072" num="0071">During calibration, the effect of a coarse resolution of the DAC might be mitigated somewhat by the finite bandwidth of the forward path smoothing out the amount of DAC quantisation noise appearing at the output S<sub>OUT</sub>. However, after completion of calibration, a fixed digital code would be input into the DAC. If its resolution was only 3 mV per LSB, the d.c. voltage output from the circuit would usually be a lot larger than 100 &#x3bc;V. In practice, a DAC resolution of under 100 uV would be necessary, say in the range 10 uV to 50 uV to allow for a few LSB of error at the instant where the feedback loop is disabled and the correction code stored.</p>
<p id="p-0073" num="0072">If the DAC resolution were reduced to say 30 uV from 3 mV, then the gain, and hence the unity gain bandwidth of the integrating feedback loop would also be reduced by a factor 100, e.g. to 2.5 kHz in the example above. This might allow ideal linear settling from a 10 mV initial error to a 100 uV final error in nominally about 4.6/(2&#xb7;&#x3c0;&#xb7;2.5 kHz)=300 us, but in practice the non-linearities in the settling, other sources of error, and the manufacturing and process tolerances of the gain of a simple VCO (maybe &#x2212;50%, +100%), would make it hard to guarantee even a 1 ms settling to a measured 100 &#x3bc;V accuracy. A 1 ms settling time may be too long for some applications.</p>
<p id="p-0074" num="0073">In one embodiment therefore the feedback loop has a variable gain so that the voltage resolution of the feedback loop can be varied. During the initial stages of offset compensation the voltage resolution of the feedback loop may be relatively coarse but the bandwidth relatively large so that relatively large adjustments are made quickly. During a later stage the resolution of the feedback loop may be increased so that finer adjustments are made and the loop compensates to a better accuracy albeit with a longer time constant. In some embodiments the gain of the feedback loop may be successively increased in a number of stages. In this way the bandwidth of the compensation circuitry may be varied. It will be understood that as used herein the term bandwidth used in reference to the feedback, i.e. compensation, circuitry refers to the unity gain bandwidth of the feedback loop.</p>
<p id="p-0075" num="0074">The feedback loop voltage resolution could be altered by altering the gain of DAC, say by altering a reference voltage, or current, supplied to the elements of the DAC, for example by programming a resistor string or other simple known ADC. However, particularly in the case where the compensation signal is applied to the signal path. i.e. the feedforward path, via audio DAC <b>101</b>, which may be a delta-sigma DAC of say 20-bit or 24-bit resolution, it is preferable to adjust the gain of the feedback loop by a digital gain element which may, for instance, be a multiplier. The multiplier may, for instance, be a simple bit shifter to give gain in powers of 2. The gain element may initially be set to provide a high multiplier value and to reduce the multiplier value during the compensation process.</p>
<p id="p-0076" num="0075">The gain element could be provided to act on the output of the integrating counter, with the output of the gain element being used as the compensation signal, but in this case a change in the multiplier value may result in a significant step change in the value of the compensation signal. This may introduce further delays into the settling time.</p>
<p id="p-0077" num="0076">The gain element may therefore be implemented such that the present value of the compensation signal (at the time of any change in gain) is maintained but the minimum change to the compensation signal is reduced. This can be achieved by applying a gain factor to the value of the per cycle count difference before integration.</p>
<p id="p-0078" num="0077"><figref idref="DRAWINGS">FIG. 7</figref> therefore shows an embodiment of the feedback path similar to that shown in <figref idref="DRAWINGS">FIG. 2</figref> wherein similar components have similar numerals. In this embodiment however a gain element <b>701</b>, which is a multiplier, is provided at the output of the counter <b>201</b>. Gain element <b>701</b> is controlled by a bit weight control signal <b>702</b> so as to apply a desired bit weighting.</p>
<p id="p-0079" num="0078">For example if a bit weighting factor of 1 provides the base feedback resolution of the loop, each LSB may represent say 30 uV out of the DAC: An initial weighting factor of 10 may be applied so that the minimum adjustment is equal to 300 uv. This would result in some relatively large adjustments being made relatively quickly. After a relatively short time, when the DC offset will have been corrected to within say 1 mV the bit weighting may be changed to a factor of 1 say to provide a minimum step of 30 &#x3bc;V.</p>
<p id="p-0080" num="0079">Applying the bit weighting to the output of the counter <b>201</b> thus only changes the amount of adjustment made to the integrated compensation signal C<sub>OUT </sub>in each cycle and does not result in a step change of the integrated compensation signal itself.</p>
<p id="p-0081" num="0080">In some embodiments however the counter <b>201</b> may be replaced by an integrating counter such as an up-down counter <b>206</b> as discussed above which is not reset each cycle. In this case the output from the counter may inherently comprise an integrated count value. A bit weighting may still be applied by differentiating the output of the counter, applying bit weighting via a gain element, and reintegrating the output from the gain element.</p>
<p id="p-0082" num="0081"><figref idref="DRAWINGS">FIG. 8</figref> shows another feedback path according to this embodiment of the invention. Multiplexer <b>110</b> and VCO <b>108</b> operate as described previously and up/down counter <b>206</b> counts up in one phase and down in the other phase of the clock signal CLK to provide an integrated difference count as described previously. Differentiator <b>801</b> differentiates the output to determine the per cycle change and the output of the differentiator is multiplied by gain element <b>802</b> in response to bit weight signal <b>803</b> in the same manner as described in relation to <figref idref="DRAWINGS">FIG. 7</figref>. The multiplied bit weight signal is then reintegrated by an integrating loop <b>203</b> such as shown in <figref idref="DRAWINGS">FIG. 2</figref><i>a. </i></p>
<p id="p-0083" num="0082">Other arrangements for applying a variable gain exist and could be used in other embodiments, for example the output from the integrating up/down counter could be divided into two paths, one path differentiated to provide the per cycle difference which could then be multiplied by a gain factor and added to the other path.</p>
<p id="p-0084" num="0083">The embodiments of the compensation circuitry described above can be used in the presence or absence of an audio signal. In many applications however DC offset calibration may only be required in situations when an audio signal is not present.</p>
<p id="p-0085" num="0084">For example, at power-on of an audio device the compensation will need to run to compensate for any inherent DC offset. Such compensation typically occurs before an audio signal is supplied to the amplifier circuit. Thus the output signal S<sub>OUT </sub>will basically correspond entirely to DC offset. Once the DC compensation has stabilised the value of the correction, i.e. compensation, signal is latched and further compensation is not required. There may be small drifts in the level of DC offset during operation, which may lead to slightly increased power consumption, but such small drifts are not generally significant and don't give rise to any audible effects.</p>
<p id="p-0086" num="0085">At power-off (or power down to a low power mode) the audio input may be muted, sometimes gradually, before disconnecting the amplifier from the load. At this point the sudden removal of any DC offset developed during operation would result in an audible artefact. Thus DC compensation may be applied, but with a reasonably long time constant, for example by setting a low value for the gain of gain element <b>701</b>, so as to reduce the DC offset in a gradual fashion before disconnecting the load from the amplifier.</p>
<p id="p-0087" num="0086">In some embodiments therefore the offset compensation circuitry may be designed to operate only in the absence of an audio signal. In such case calibration is still possible while the amplifier circuitry remains powered but should preferably be conducted at periods of no input audio signal. The absence of an input audio signal may be detected in a number of ways.</p>
<p id="p-0088" num="0087">Designing offset compensation circuitry that operates only in the absence of an audio signal reduces the range and linearity requirements for the VCO and hence eases circuit design and potentially reduces cost.</p>
<p id="p-0089" num="0088">However the embodiments of the offset compensation circuitry described above can function correctly even in the presence of an input audio signal, provided that the VCO has the required linearity over the range of input voltages expected in the presence of a signal.</p>
<p id="p-0090" num="0089">The presence of an audio signal will mean that the instantaneous voltage value of the output signal S<sub>OUT </sub>at any time may not accurately reflect the DC offset level. However over the course of the settling process the audio dependent variations will average out and, as the offset compensation circuitry integrates over a relatively large number of cycles the resulting difference in pulse count due to the output signal S<sub>OUT </sub>and the reference signal V<sub>REF </sub>will be due to any difference in DC offset. Thus no explicit filtering is required, although in some embodiments the output signal may be filtered to provide stronger attenuation in the audio band, either before the analogue input to the multiplexer or digitally after the counter</p>
<p id="p-0091" num="0090">Thus the compensation circuitry may operate in the presence of an audio signal to provide continual or periodic correction for DC offset.</p>
<p id="p-0092" num="0091">The embodiments of the present invention may be able to compensate for all sources of offset in the audio signal path. The accuracy is limited only by the voltage resolution of the compensation signal applied via the DAC (including any scaling factor(s), whether of the DAC or otherwise) and any DC offset in the feedback path itself.</p>
<p id="p-0093" num="0092">However the VCO introduces very little offset and the elimination of the need for a conventional ADC results in a feedback loop with very little error which is advantageous. Sources of error in the feedback path principally include: a. any offset induced by the multiplexer, for example due to charge injection mismatch between CMOS transmission gates; and b. consistent error in the duty cycle of the counter. As mentioned previously any error in duty cycle of the counter can be minimised by generating a matched divide-by-two clock signal physically close to the counter logic. Thus embodiments of the invention may include a clock divider for dividing a master clock signal in two to provide a signal for clocking the counter wherein the clock divider is configured to be physically adjacent the counter logic, i.e. a short distance away from the counter, such as less than 100 &#x3bc;m or so and possibly within 10-20 &#x3bc;m.</p>
<p id="p-0094" num="0093">As mentioned the compensation signal may be supplied before an audio DAC <b>101</b> (if present) or combined with the analogue input signal to compensate for the whole offset in the audio signal path. In some embodiments however, variation of a variable gain in the audio signal path, for example a volume signal, may result in a step change in the DC offset.</p>
<p id="p-0095" num="0094">For example consider an audio signal path consisting of an audio DAC, a variable gain element and an amplifier. If, for a first gain setting of the variable gain element, the DAC has a certain DC offset that, in the absence of any correction, equates to an effective offset of +2 mV and the amplifier has an effective DC offset of +3 mV then the total offset that would appear at the amplifier output would be +5 mV (ignoring any offset from the variable gain element itself for simplicity). If the gain of the variable gain element is changed, to a second gain setting, this will clearly have an effect on the DC offset contribution from the DAC but it may have no effect on the DC offset contribution from the amplifier. Thus, for example, if the second gain setting represents an increase in gain of a factor of 1.5 over the first gain setting, the notional DC offset contribution from the DAC will increase to +3 mV. Thus in the absence of any correction a change from the first to the second gain setting would result in a jump in DC offset from 5 mv to 6 mV.</p>
<p id="p-0096" num="0095">If a compensation, i.e. correction, signal is applied to the signal path then, whilst the gain of the variable gain element is at the first gain setting, the compensation signal will, over time, settle to steady state value that results in a compensation of &#x2212;5 mV so that the resulting output from the amplifier, in the absence of any signal, is 0V. If this compensation signal is applied to the signal path after the variable gain element then a sudden change of the gain of the variable gain element to the second gain setting will not vary the value of the compensation signal received at the amplifier. Thus, immediately following the change in gain setting, the compensation signal will continue to compensate for a 5 mV offset whereas the notional compensation level required is for 6 mV. Thus the output signal will jump from a 0V corrected level to having an actual offset of +1 mV.</p>
<p id="p-0097" num="0096">If the compensation signal were instead applied to the signal path before the variable gain element then the sudden change in gain would also result in a sudden change in the value of the compensation signal at the amplifier. In this simplistic example the value of the compensation signal would effectively change to a notional correction of 7.5 mV. This is actually greater than required and thus would lead to a jump in amplifier output by &#x2212;1.5 mV.</p>
<p id="p-0098" num="0097">In this simple example therefore even where any DC offset has been completely corrected for at one gain setting a change in gain setting, for example due to a change in a volume setting, may result in a sudden change in the voltage level of the output signal. Of course the compensation circuitry may then start to adjust to the new settings and act reduce the resulting offset but the sudden jump on change of gain setting may result in an audible artefact such as a pop.</p>
<p id="p-0099" num="0098">It will also be appreciated that the example above discussed a separate variable gain element between the DAC and amplifier. Similar considerations however apply wherein the gain of the amplifier itself is variable, for example via a variable resistor feedback.</p>
<p id="p-0100" num="0099"><figref idref="DRAWINGS">FIG. 9</figref> illustrates an embodiment of the invention which has two feedback paths (forming two feedback loops) for compensating for DC offset of different parts of the audio signal path separately. The signal path comprises a digital input D<sub>IN</sub>, a DAC <b>101</b> as described previously and a variable gain amplifier <b>901</b>. The signal path includes a connector such as a socket if in use is connected to a connector such as a jack and to a load <b>908</b>. The circuit has offset compensation circuitry <b>107</b> arranged with a switch, or multiplexer, arrangement <b>902</b> to provide two alternative feedback paths, an inner feedback path <b>903</b> and an outer feedback path <b>904</b>. The inner path <b>903</b> comprises a further DAC <b>905</b> and a latch <b>906</b> and feeds back an analogue compensation signal to the variable gain amplifier <b>901</b>. The outer path <b>904</b> feeds back a digital compensation signal upstream of DAC <b>101</b>.</p>
<p id="p-0101" num="0100">In operation the inner loop, defined by inner path <b>903</b>, operates first to compensate for offset arising in the variable gain amplifier <b>901</b>. The DAC <b>101</b> would be isolated from the input to the amplifier <b>901</b> and the amplifier (typically the input resistor rather than the op amp terminal) shorted to ground. The DAC <b>101</b> could be isolated by a series switch <b>907</b> but in some embodiments the DAC could be disabled by asserting a disable signal. In the disabled state the output of the DAC <b>101</b> would be high impedance. This may avoid the need for switches in audio signal path. With the DAC <b>101</b> disconnected or disabled, the operation of this inner loop <b>903</b> is to compensate for any offset arising in the amplifier <b>901</b>. Once a stable offset value has been reached this value is stored in latch <b>906</b>, the compensation circuitry <b>107</b> may be reset and the switch <b>902</b> switches the output of the compensation circuit to the outer loop <b>904</b>.</p>
<p id="p-0102" num="0101">As any offset due to the amplifier is corrected by the value latched in latch <b>906</b> the offset in the signal line due to the DAC will then be compensated for. The result is that, using the figures described above the inner loop, defined by path <b>903</b>, will develop a compensation value of 3 mV for the amplifier. Subsequent operation of the outer loop, defined by path <b>904</b>, will then develop a compensation signal for the DAC that ensures that the output of the DAC has zero, or a very small offset. Thus even is the gain of amplifier <b>901</b> is adjusted the offset contribution from the DAC will be small. The result is that there will be no significant jumps in DC offset on changes in the value of gain applied. Thus this embodiment having a plurality of feedback paths defining different feedback loops separately adjusts for the offset introduced upstream of a variable gain and the offset introduced downstream of the variable gain so that any changes in gain do not result in a sudden mismatch between the level of DC offset and the level of the compensation signal. Two feedback loops are illustrated in <figref idref="DRAWINGS">FIG. 9</figref> but more feedback loops may be used in other applications if required. It will also be appreciated that in some embodiments a separate variable gain element such as a pre-amplifier could be included in the audio signal path. The inner and outer feedback loops could be arranged to separately adjusted for any offset upstream or downstream of the variable gain.</p>
<p id="p-0103" num="0102">Note that the concept of having a plurality of feedback loops for compensating separately for the offset upstream and downstream of a variable gain element represents another aspect of the present invention and, whilst advantageously may implemented by the novel DC offset compensation circuitry described herein it may also be implemented by other types of DC offset compensation circuitry such as the known ADC based offset compensation circuitry.</p>
<p id="p-0104" num="0103">In general the embodiments of the present invention therefore allow fast and accurate compensation for DC offset in signal lines using relatively small and inexpensive offset compensation circuitry. The offset compensation circuitry may have a variable gain to allow fast compensation to a relatively coarse accuracy initial followed by a more accurate compensation in order maximise settling time.</p>
<p id="p-0105" num="0104">The offset compensation circuitry may be arranged as part of an audio amplifier and/or signal processing circuit, for instance an audio circuit which may be provided in a host device to act as hub for dealing with the various audio signals generated or received by the device. A dedicated offset compensation circuit may be provided for each audio signal output or multiplexed between a small number of outputs. An audio circuit comprising an embodiment of the offset compensation circuitry may be implemented in a host device, especially a portable and/or battery powered host device such as a mobile telephone, an audio player, a video player, a PDA, a mobile computing platform and/or a games device for example. In such applications the small size of the circuitry may be important and the increased efficiency from reducing DC offset power wastage may give system-level benefits such as increased operating time before battery re-charge is needed.</p>
<p id="p-0106" num="0105">Embodiments of the invention have been described in terms of audio circuitry. In general however aspects of the present invention relate to the compensation for unwanted DC offset in any signal line and various sensors or other signal lines, such a video signal lines for example may have unwanted DC offset that could benefit from DC offset correction as described herein.</p>
<p id="p-0107" num="0106">It should be noted that the above-mentioned embodiments illustrate rather than limit the invention, and that those skilled in the art will be able to design many alternative embodiments without departing from the scope of the appended claims. The word &#x201c;comprising&#x201d; does not exclude the presence of elements or steps other than those listed in a claim, &#x201c;a&#x201d; or &#x201c;an&#x201d; does not exclude a plurality, and a single feature or other unit may fulfil the functions of several units recited in the claims. The word &#x201c;amplify&#x201d; can also mean &#x201c;attenuate&#x201d;, i.e. decrease, as well as increase, i.e. amplify. Any reference numerals or labels in the claims shall not be construed so as to limit their scope.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. Audio amplification circuitry comprising:
<claim-text>an amplifier configured to receive an input signal and provide an amplified output signal; and</claim-text>
<claim-text>a feedback path, wherein said feedback path comprises compensation circuitry for outputting a compensation signal, wherein the compensation circuitry comprises:
<claim-text>a voltage controlled oscillator (VCO) configured to sequentially receive a signal based on said amplified output signal and a reference signal so as to sequentially provide a first VCO output signal based on said amplified output signal and a second VCO output signal based on said reference signal, and</claim-text>
<claim-text>a counter configured to generate first pulse counts based upon the first VCO output signal and second pulse counts based upon the second VCO output signal and to provide the compensation signal based on a comparison of the first and second pulse counts.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising a multiplexer configured to receive a signal based on the amplified output signal and the reference signal as inputs and to sequentially provide one of said signals at said inputs to the voltage controlled oscillator.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the counter comprises an integrating counter configured to integrate a difference between said first and second pulse counts over a plurality of periods of the first VCO output signal and second VCO output signal.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00003">claim 3</claim-ref> wherein the integrating counter comprises a pulse counter and an integrator acting on the output of the pulse counter.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00003">claim 3</claim-ref> wherein the integrating counter comprises an up/down counter.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the compensation circuitry is configured to have a controllably variable bandwidth.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00006">claim 6</claim-ref> wherein the compensation circuitry comprises a variable gain element for varying the bandwidth.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00007">claim 7</claim-ref> wherein the variable gain element comprises a multiplier configured to receive a difference between said first and second pulse counts from the counter for each period of first VCO output signal and second VCO output signal and to multiply said difference by a gain factor.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00008">claim 8</claim-ref> wherein the counter is an integrating counter and wherein the output from the integrating counter is differentiated in a differentiator to provide said difference between said first and second pulse counts for each period of first VCO output signal and second VCO output signal which is input to the variable gain element.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00008">claim 8</claim-ref> wherein the output from the variable gain element is input to an integrator.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00006">claim 6</claim-ref> wherein the compensation circuitry is configured to, in use, have a first bandwidth during an initial period and then have a second, lower, bandwidth during a later period.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the compensation signal is applied to said amplifier.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. Audio amplification signal as claimed in <claim-ref idref="CLM-00012">claim 12</claim-ref> wherein the compensation signal directly modulates the input offset voltage of the amplifier.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the feedback path comprises an inner feedback path configured to compensate for offset in a first part of the audio signal path and an outer feedback path configured to compensate for offset in a second part of the audio signal path.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00014">claim 14</claim-ref> wherein the compensation signal is switchable between the inner and the outer feedback loops.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref> comprising at least one pair of audio signal paths, each signal path comprising an amplifier configured to receive an input signal and provide an amplified output signal, wherein each pair of signal paths comprises compensation circuitry that is switchable between said pair of signal paths.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. Audio amplification circuitry as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising a clock divider for dividing a master clock signal in two to provide a counter clock signal for clocking the counter wherein the clock divider is configured to be physically adjacent the counter.</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. An audio processing circuit comprising audio amplification circuitry as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref>.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. An audio device comprising audio amplification circuitry as claimed in <claim-ref idref="CLM-00001">claim 1</claim-ref>.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. A device as claimed in <claim-ref idref="CLM-00019">claim 19</claim-ref> wherein said device is at least one of: a battery powered device, a portable device, a personal audio device, a personal video device; a mobile telephone, a personal data assistant, a gaming device, a portable computing device, a laptop and a satellite navigation system.</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. A method of compensating for DC offset in an audio amplifier output signal, the method comprising the steps of:
<claim-text>receiving a signal based on the amplifier output signal;</claim-text>
<claim-text>receiving a reference signal based on a target DC offset;</claim-text>
<claim-text>sequentially driving a voltage controlled oscillator (VCO) with the signal based on the amplifier output signal to provide a first VCO output signal; and</claim-text>
<claim-text>driving the same voltage controlled oscillator (VCO) with the reference signal to provide a second VCO output signal;</claim-text>
<claim-text>generating first pulse counts based upon the first VCO output signal and second pulse counts based upon the second VCO output signal;</claim-text>
<claim-text>comparing said first and second pulse counts; and</claim-text>
<claim-text>deriving a DC offset compensation signal from said comparison of pulse count.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00022" num="00022">
<claim-text>22. A method as claimed in <claim-ref idref="CLM-00021">claim 21</claim-ref> further comprising integrating a difference between said first and second pulse counts to derive said DC offset compensation signal.</claim-text>
</claim>
<claim id="CLM-00023" num="00023">
<claim-text>23. A method as claimed in <claim-ref idref="CLM-00021">claim 21</claim-ref> further comprising the step of applying a variable gain factor to a difference between said first and second pulse counts.</claim-text>
</claim>
<claim id="CLM-00024" num="00024">
<claim-text>24. A method as claimed in <claim-ref idref="CLM-00023">claim 23</claim-ref> comprising applying a first gain factor for an initial period to provide a coarse compensation and subsequently applying a second gain factor in a subsequent period to provide a more accurate compensation.</claim-text>
</claim>
<claim id="CLM-00025" num="00025">
<claim-text>25. A method as claimed in <claim-ref idref="CLM-00021">claim 21</claim-ref> comprising performing the method only in the absence of an audio signal to be amplified. </claim-text>
</claim>
</claims>
</us-patent-grant>
