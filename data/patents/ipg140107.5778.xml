<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08626883-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08626883</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12800101</doc-number>
<date>20100506</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>271</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>15</main-group>
<subgroup>177</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>15</main-group>
<subgroup>173</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>709222</main-classification>
<further-classification>709223</further-classification>
</classification-national>
<invention-title id="d2e53">Injecting addresses to enable OAM functions</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6343330</doc-number>
<kind>B1</kind>
<name>Khanna et al.</name>
<date>20020100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709249</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6360271</doc-number>
<kind>B1</kind>
<name>Schuster et al.</name>
<date>20020300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709231</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6363053</doc-number>
<kind>B1</kind>
<name>Schuster et al.</name>
<date>20020300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370230</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6711137</doc-number>
<kind>B1</kind>
<name>Klassen et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370252</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7142512</doc-number>
<kind>B1</kind>
<name>Kobayashi et al.</name>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370232</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>7164665</doc-number>
<kind>B2</kind>
<name>Tourunen</name>
<date>20070100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370329</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>7418492</doc-number>
<kind>B1</kind>
<name>Cohen et al.</name>
<date>20080800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709224</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2003/0204619</doc-number>
<kind>A1</kind>
<name>Bays</name>
<date>20031000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709238</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2003/0208616</doc-number>
<kind>A1</kind>
<name>Laing et al.</name>
<date>20031100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709236</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2006/0250967</doc-number>
<kind>A1</kind>
<name>Miller et al.</name>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370241</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>JP</country>
<doc-number>09102782</doc-number>
<date>19970400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>44</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>709220-229</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709238-242</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370241-254</main-classification>
<additional-info>unstructured</additional-info>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>5</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>10742239</doc-number>
<date>20031218</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>7747716</doc-number>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>12800101</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>60466322</doc-number>
<date>20030428</date>
</document-id>
</us-provisional-application>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20100228842</doc-number>
<kind>A1</kind>
<date>20100909</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Kompella</last-name>
<first-name>Vach</first-name>
<address>
<city>Cupertino</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Regan</last-name>
<first-name>Joe</first-name>
<address>
<city>Pleasanton</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Hu</last-name>
<first-name>Wenao</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Kompella</last-name>
<first-name>Vach</first-name>
<address>
<city>Cupertino</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Regan</last-name>
<first-name>Joe</first-name>
<address>
<city>Pleasanton</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Hu</last-name>
<first-name>Wenao</first-name>
<address>
<city>San Jose</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Van Pelt, Yi &#x26; James, LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Alcatel Lucent</orgname>
<role>03</role>
<address>
<city>Paris</city>
<country>FR</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Joo</last-name>
<first-name>Joshua</first-name>
<department>2445</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">Inserting an address used for performing such OAM functions in an efficient way that is transparent to a customer or service using the network path is disclosed. An indication is received that a source address reserved for OAM use should be inserted into a forwarding database associated with a provider network node, such as a provider edge device, that receives the indication. The address is inserted into a forwarding database as an address that is owned by the provider network node and reserved for OAM use. One or more other nodes associated with a service with which the OAM address is associated may be notified that the OAM address is associated with the provider network node that owns the OAM address.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="171.03mm" wi="82.13mm" file="US08626883-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="233.60mm" wi="198.37mm" file="US08626883-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="162.98mm" wi="145.71mm" file="US08626883-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="199.39mm" wi="89.41mm" file="US08626883-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="204.13mm" wi="93.13mm" file="US08626883-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="217.34mm" wi="77.47mm" file="US08626883-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS REFERENCE TO OTHER APPLICATIONS</heading>
<p id="p-0002" num="0001">This application is a continuation of U.S. patent application Ser. No. 10/742,239, entitled INJECTING ADDRESSES TO ENABLE OAM FUNCTIONS filed Dec. 18, 2003 now U.S. Pat. No. 7,747,716 which is incorporated herein by reference for all purposes, which claims priority to U.S. Provisional Application No. 60/466,322, entitled INJECTING ADDRESSES INTO A VIRTUAL PRIVATE NETWORK FORWARDING DATABASE TO ENABLE OPERATIONAL, ADMINISTRATIVE, AND MANAGEMENT FUNCTIONS filed Apr. 28, 2003 which is incorporated herein by reference for all purposes.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">FIELD OF THE INVENTION</heading>
<p id="p-0003" num="0002">The present invention relates generally to computer networks. More specifically, injecting addresses to enable operational, administrative, and management functions is disclosed.</p>
<heading id="h-0003" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0004" num="0003">In data communications, diagnosing a network service associated with a specific customer is useful in ensuring that desired quality of service (QoS), continuity, and connectivity, among other factors are maintained. The customer's network or set of networks may be connected over a network topology that includes one or more service provider or backbone networks. Network topologies for implementing these services may include virtual private networks (VPNs), virtual private LAN services (VPLS), transparent LAN services (TLS), hierarchical virtual private LAN services (HVPLS), virtual private routing networks (VPRN), or other bridged or routed services. Continuity is defined as the continuous ability to send packets correctly through a service. Connectivity is defined as the actual parameters, control plane information, and forwarding plane information used to implement a service. Testing a network service may comprise performing operational, administrative, and management (OAM) functions, such as ensuring that a VPN, VPLS, TLS, VPRN or other bridged or routed service provides quality service to a customer.</p>
<p id="p-0005" num="0004">OAM functionality depends on the installation of customer addresses in the forwarding plane of a network topology (e.g., mesh, TLS, VPLS, etc.). However, the installation of customer addresses using conventional techniques may be inefficient and time consuming. In addition, installation of customer addresses for OAM purposes using conventional techniques may not be transparent to the customer whose service is being tested and could affect the service provided adversely.</p>
<p id="p-0006" num="0005">Thus, what is required is a solution for diagnosing a network service or topology for various OAM extended functions without adversely impacting the service itself.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0007" num="0006">Various embodiments of the invention are disclosed in the following detailed description and the accompanying drawings.</p>
<p id="p-0008" num="0007"><figref idref="DRAWINGS">FIG. 1</figref> illustrates a network service with respect to which OAM functions may be required to be performed;</p>
<p id="p-0009" num="0008"><figref idref="DRAWINGS">FIG. 2A</figref> illustrates a packet format used in some embodiments to insert an address reserved for OAM use into a forwarding database;</p>
<p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. 2B</figref> illustrates a process for inserting an address reserved for OAM use into a forwarding database;</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 2C</figref> illustrates a process used in one embodiment by nodes in a provider network to learn an OAM address owned by another node; and</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 3</figref> illustrates a process for diagnosing a network service using an address inserted into a forwarding database for OAM use.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0013" num="0012">The invention can be implemented in numerous ways, including as a process; an apparatus; a system; a composition of matter; a computer program product embodied on a computer readable storage medium; and/or a processor, such as a processor configured to execute instructions stored on and/or provided by a memory coupled to the processor. In this specification, these implementations, or any other form that the invention may take, may be referred to as techniques. In general, the order of the steps of disclosed processes may be altered within the scope of the invention. Unless stated otherwise, a component such as a processor or a memory described as being configured to perform a task may be implemented as a general component that is temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task. As used herein, the term &#x2018;processor&#x2019; refers to one or more devices, circuits, and/or processing cores configured to process data, such as computer program instructions.</p>
<p id="p-0014" num="0013">A detailed description of one or more embodiments of the invention is provided below along with accompanying figures that illustrate the principles of the invention. The invention is described in connection with such embodiments, but the invention is not limited to any embodiment. The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives, modifications and equivalents. Numerous specific details are set forth in the following description in order to provide a thorough understanding of the invention. These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details. For the purpose of clarity, technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured.</p>
<p id="p-0015" num="0014">Using OAM functions, the continuity and connectivity over a network path may be tested. Inserting an address used for performing such OAM functions in an efficient way that is transparent to a customer or service using the network path is disclosed.</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 1</figref> illustrates a network service with respect to which OAM functions may be required to be performed. In this embodiment, system <b>100</b> includes a service provider network <b>101</b> having provider edge (PE) routers <b>102</b>, <b>104</b>, and <b>106</b>. In other embodiments additional or fewer PEs may be included. Here, PEs <b>102</b>-<b>106</b> provide edge routing for packets over service provider network <b>101</b>. PEs <b>102</b>-<b>106</b> also route packets over service provider network <b>101</b> to destinations/nodes associated with customer edge (CE) routers CE<b>1</b>-<b>5</b> within customer <b>1</b> and <b>2</b> networks <b>118</b>-<b>126</b> that are in data communication with the edge routers. In this embodiment, customer <b>1</b> has three disparate networks A, B and C (<b>118</b>, <b>120</b>, and <b>122</b>, respectively) that are connected over a network topology (e.g., VPN mesh of tunnels, VPLS, etc.) and customer <b>2</b> has two disparate networks D and E (<b>124</b> and <b>126</b>, respectively) connected across service provider network <b>101</b>. Various network topologies may be used and the techniques disclosed herein are not limited to a specific topology. In the example shown in <figref idref="DRAWINGS">FIG. 1</figref>, a full mesh of label switched path (LSP) tunnels has been established to enable PE<b>1</b>, PE<b>2</b>, and PE<b>3</b> to transport traffic through service provider network <b>101</b>, such as may be used to provide a VPLS or similar service. In other embodiments, other protocols and transport technologies may be used.</p>
<p id="p-0017" num="0016">Customer edge (CE) routers CE<b>1</b>-<b>3</b> <b>108</b>-<b>112</b> route packets between customer <b>1</b> networks <b>118</b>-<b>122</b> via PEs <b>102</b>-<b>106</b>, respectively, which serve as ingress and egress points to the service provider network <b>101</b> for customer <b>1</b>'s data traffic. Likewise, CEs <b>114</b>-<b>116</b> route data traffic between customer <b>2</b> networks <b>124</b> and <b>126</b> via PEs <b>102</b> and <b>104</b>, respectively. In an embodiment, service provider network <b>101</b> may be a backbone network used to route data between customer networks that may be Ethernet based LANs connected in a distributed manner. In other embodiments, service provider network <b>101</b> may have fewer or more provider and customer edge routers than those shown in <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0018" num="0017">As noted above, to perform OAM functions test packets may be created, injected, and routed over service provider network <b>101</b> to determine continuity, connectivity, and other characteristics of services for customer <b>1</b> and customer <b>2</b>. In order to enable such OAM functions to be performed in an efficient way that is transparent to the customer, addresses reserved for OAM use are injected into the forwarding database of one or more of the nodes on the provider network associated with a particular customer or service, e.g., PEs <b>102</b>-<b>106</b> in the case of Customer <b>1</b> or PEs <b>102</b> and <b>104</b> in the case of Customer <b>2</b> in the example shown in <figref idref="DRAWINGS">FIG. 1</figref>.</p>
<p id="p-0019" num="0018">For example, in a VPLS embodiment an Ethernet frame in customer <b>1</b> network <b>118</b> may be encapsulated for forwarding to customer <b>1</b> network <b>120</b> over a VPLS on service provider network <b>101</b>. The encapsulated data is not modified or altered while transiting the VPLS between the customer <b>1</b> networks <b>118</b> and <b>120</b>. In the case of such normal customer frames, tunnel and virtual circuit labels in an encapsulation header tell routers within service provider network <b>101</b> how to forward the packet. The customer packet includes a customer packet header comprising source and destination addresses associated with the packet such as the MAC address of the customer equipment that originated the packet. Source MAC addresses are learned by PEs <b>102</b>-<b>106</b>, thus identifying return paths or tunnels for sending response packets. At a PE receiving a customer packet, the source MAC address is learned by storing in a forwarding database information associating the source MAC address with the ingress PE that sent the packet to the receiving PE. The PE that sent the packet (the ingress PE) also must learn an association between the source MAC address and the port and/or service with which it is associated, so that the ingress PE will know how to route packets sent to it for delivery to that address. In the case of both destination (egress) and ingress PEs, the learned address is associated as well with the service identified by one or more labels included in the encapsulation header used to transport the packet over the provider network. The techniques described herein enable an address reserved for OAM use, such as a MAC address, to be inserted into a PE forwarding database, i.e., to cause it to be learned by the ingress PE that &#x201c;owns&#x201d; it and the other PEs participating in the service to be tested, without requiring that the customer actually send a packet using that address.</p>
<p id="p-0020" num="0019">In one approach, an address reserved for OAM use may be inserted into a forwarding database by sending to the provider network node (e.g., PE) with which the address is to be associated an OAM or other test message comprising data indicating to the node that the address should be inserted into its forwarding database. For example, one or more type-length-value (TLV) units may be added to a message sent, e.g., under an OAM or other testing protocol associated with the protocol being used to provide the service to be tested to cause an address reserved for OAM use to be added to a forwarding database. For example, Internet Engineering Task Force (IETF) Draft Proposal draft-stokes-vkompella-ppvpn-oam-2.txt and subsequent versions thereof (hereinafter the &#x201c;stokes-vkompella draft&#x201d;) propose standards for performing OAM functions with respect to a virtual private network service such as VPLS. The stokes-vkompella draft prescribes an extensible format for test messages that allows service providers to define and include additional TLVs in OAM messages. Other protocols may similarly provide ways to include provider-specific information in test messages. Such additional TLVs (or other header or data fields) may be used, as described more fully below, to cause an address reserved for OAM use to be inserted into a forwarding database. Use of such an extension to an existing OAM protocol can provide an efficient way to insert an address reserved for OAM use into a forwarding database, as messages sent under such protocols include data identifying the service with which the address is associated, which data can be used by the receiving node, e.g., to inform all other nodes participating in the service of the newly inserted address, its nature (e.g., reserved for OAM use), and its association with the node and/or a path back to the node that &#x201c;owns&#x201d; it. The use of existing ways of communicating information among nodes participating in a service makes it possible to populate the forwarding databases of the nodes participating in a service with an address reserved for OAM use without requiring that an operator or OAM system determine which nodes are participating in a service and then send a separate indication to each regarding the address.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 2A</figref> illustrates a packet format used in some embodiments to insert an address reserved for OAM use into a forwarding database. In some embodiments, the test packet may include additional or fewer fields than the number shown in <figref idref="DRAWINGS">FIG. 2A</figref>. The test packet format shown in <figref idref="DRAWINGS">FIG. 2A</figref> may be used to encapsulate a data packet that is being communicated between destinations connected over a network or service (e.g., VPN, VPLS, TLS, etc.). Mandatory fields <b>202</b> represents a portion of the test packet (which may also be known as a request) used to contain data prescribed by or otherwise appropriate to a particulate protocol or set of protocols associated with the service being testing. The mandatory fields <b>202</b> may comprise data such as, in the case of a packet sent via the forwarding plane, tunnel encapsulation data, one or more virtual circuit labels, such as a label associated with the service to be tested and/or a label identifying the packet as an OAM packet, customer frame encapsulation data, an IP header, a UDP source and destination port, a common message header, and/or one or more mandatory TLVs, for example, depending on the protocol(s) used and whether the test packet is sent via the forwarding (data) plane or the control plane. In some embodiments, data comprising the mandatory fields <b>202</b> may be used to associate an address reserved for OAM use into a forwarding database with a particular service, for example, using the same (or similar) techniques and processing as occurs for MAC learning with respect to non-test (i.e., actual customer) packets transported via the service.</p>
<p id="p-0022" num="0021">In the example shown in <figref idref="DRAWINGS">FIG. 2A</figref>, an &#x201c;Address Add&#x201d; TLV <b>203</b> has been added to the mandatory fields <b>202</b>. Type field <b>204</b> indicates the type or purpose of the test packet. Type field <b>204</b>, combined with length field <b>206</b> and value fields <b>208</b>, <b>210</b>, and <b>212</b> comprise a TLV that can be used to specify a particular function to be performed with respect to the test packet and/or data comprising the TLV. This will be described in greater detail below. In this example, the TLV <b>203</b> is used to insert an address reserved for OAM use into a forwarding database. Other TLVs may be defined and used for various purposes such as identifying the forwarding equivalence class (FEC) being tested, the service being tested (e.g., VPN, VPLS, VPRN, etc.), or vendor-specific OAM functions. These functions and others are described below. Length field <b>206</b> indicates the overall bit length of the TLV (described below) value (i.e., the combined length of fields <b>208</b>, <b>210</b>, and <b>212</b> in this example). Address field <b>208</b> provides an address value to be inserted in a forwarding database for OAM purposes. In some embodiments, a management application running on a PE that receives the packet shown in <figref idref="DRAWINGS">FIG. 2A</figref> is configured to respond to the Add Address TLV, which it recognizes by the type data included in field <b>204</b>, by receiving the address included in field <b>208</b> and adding that address to its forwarding database. In some embodiments, the receiving PE associates the address with a service associated with one or more labels included in the mandatory fields <b>202</b>. In some embodiments, if the receiving PE is the ingress PE that is to &#x201c;own&#x201d; the address, the PE associates the address with the port on which the test data packet of <figref idref="DRAWINGS">FIG. 2A</figref> was received. In some embodiments, if the receiving PE is a destination PE that received the test packet of <figref idref="DRAWINGS">FIG. 2A</figref> from an ingress PE associated with (i.e., the one that &#x201c;owns&#x201d;) the address, the receiving PE associates the address with the ingress PE that owns it. Aging field <b>210</b> indicates how long the inserted address will remain in the forwarding database prior to expiration. In some embodiments, aging field <b>210</b> can be indicated as a time-to-live (TTL) value, as shown in <figref idref="DRAWINGS">FIG. 2A</figref>. In other embodiments, a different type of aging may be provided. Finally, flag field <b>212</b> is provided to indicate that the address is intended for test and diagnostic purposes only. Flag field <b>212</b> distinguishes the address reserved for OAM use from addresses being used by a customer, for example, so as to not interrupt customer service, QoS, data communication, normal data packet routing, etc. In another embodiment, different flags may be used to indicate other OAM functions. In still another embodiment, multiple flags may be used or stacked to direct the performance of multiple OAM functions. Such additional flags and/or other additional fields may be used to force an existing address to be relearned as an address reserved for OAM use, using the forwarding path of the packet comprising the Address Add TLV; to allow the address to be relearned with customer packets (e.g., if the customer were to start using an address originally inserted as an OAM address); and to allow customer packets to be forwarded even if they use an OAM-installed address.</p>
<p id="p-0023" num="0022">Upon receipt at an egress router (e.g., egress PE from service provider network <b>101</b>) of a packet sent to an address injected into the forwarding database of the egress PE as one owned by that the PE, the PE may be configured to respond in any number of potentially useful ways. For example, a management application on the PE may be configured to recognize the address as one reserved for OAM use and on that basis intercept the packet (rather than actually forwarding it, for example, to a customer network associated with the service being tested). In some embodiments, the management application may be configured to capture data about how the packet would have been handled had it been forwarded, e.g., by recording and/or reporting the port on which it would have been sent, and/or by identifying a service distribution path and/or service access point (e.g., a physical and/or logical port) with which the egress PE had associated the address. Test packets can be assessed for a variety of reasons, depending upon the TLVs included in the test packet.</p>
<p id="p-0024" num="0023">The test packet of <figref idref="DRAWINGS">FIG. 2A</figref> provides a basic format for test packet headers for various OAM functions, directed by different types of TLVs. One type of TLV is the Target FEC Stack TLV. The Target FEC Stack TLV is used to identify a particular FEC being tested. A VPN TLV may be used to identify the service (e.g., VPN) being tested. Vendor TLVs may be used to encapsulate vendor-specific TLVs, which may be identified based on particular implementations for testing or OAM functions. The vendor implementations may be hardware, software, or a combination of both. Validation TLVs may contain a checksum or other error-checking/authentication data field to ensure the validity of a test request and response. If a validation TLV is sent in a request and handled by the responding PE, then a validation TLV should also be included in the response packet sent back to the originating PE. Checksum formats may be used to check the version, checksum type, or other error-checking function. A reply tunnel TLV may be used to specify the reply tunnel to be used. As unidirectional tunnels are established for sending traffic between two endpoints (e.g., PEs <b>102</b>-<b>106</b>), a pair of opposing unidirectional tunnels provide full duplex data communication. The reply tunnel TLV describes the return tunnel specification. A QoS TLV may be used in a test packet/request to indicate the forwarding class that the test packet/request used for forwarding to the egress PE. The QoS TLV also indicates the forwarding class that the responder should attempt to use for sending a response. Several other TLVs may be used and are described in U.S. Provisional Patent Application No. 60/466,322 entitled &#x201c;Injecting Addresses into a Virtual Private Network Forwarding Database to Enable Operational, Administrative, and Management Functions&#x201d; filed Apr. 28, 2003 which is incorporated herein by reference for all purposes.</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 2B</figref> illustrates a process for inserting an address reserved for OAM use into a forwarding database. In step <b>220</b>, an indication is received that a source address reserved for OAM use should be inserted into a forwarding database as a source address associated with the node receiving the indication. In one embodiment, the indication is an Add Address TLV such as described above included in an OAM packet sent to the PE that is to own the OAM address. The PE may associate the OAM address with a service as indicated by data included in the OAM packet. In step <b>222</b>, the PE that received the indication in step <b>220</b> inserts the OAM address into its forwarding database as one &#x201c;owned&#x201d; by that node (i.e., it is an address either local to or serviced by that node, e.g., one bound to a service access point at that node). In step <b>224</b>, the node that received the indication in step <b>220</b> notifies one or more other nodes associated with a service with which the OAM address has been associated that the OAM address is owned by the node. In some embodiments, step <b>224</b> is performed only if the indication received in step <b>220</b> comprises a further indication that the other nodes should be notified. In some embodiments, such notification may be accomplished via either the control plane or the data plane, depending on the availability of either path and/or data included in the indication received in step <b>220</b>.</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 2C</figref> illustrates a process used in one embodiment by nodes in a provider network to learn an OAM address owned by another node. In step <b>240</b>, an indication is received that a source address should be inserted into a local forwarding database at the receiving node as an address reserved for OAM use that is owned by the node that originated the indication. The notification received in step <b>240</b> may be the one sent in step <b>224</b> of the process shown in <figref idref="DRAWINGS">FIG. 2B</figref>, for example. In step <b>242</b>, the OAM address is added to a local forwarding database in such a way that it is associated with the node that originated the notification received in step <b>240</b>. The OAM address may also be associated with a particular service to which the address pertains, such as by storing it in a forwarding database associated with that service.</p>
<p id="p-0027" num="0026">Other OAM packets may be sent to perform other OAM functions with respect to an address inserted for OAM use. For example, OAM packets may be sent to instruct one or more nodes, e.g., all nodes associated with a particular service, to purge an OAM address from their forwarding databases.</p>
<p id="p-0028" num="0027">Once inserted, addresses reserved for OAM use may be used to perform OAM functions, such as testing the continuity and/or connectivity of the VPLS or similar service, without interfering with customer operations.</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 3</figref> illustrates a process for diagnosing a network service using an address inserted into a forwarding database for OAM use. A test packet is created, using header, label, and other descriptive information as required and/or appropriate under the communication protocols used to provide the service to be tested (<b>302</b>). The test packet, when created, may include information such as one or more TLVs for a particular OAM function such as a test or diagnostic purpose. Once created, the test packet is sent to the previously-inserted source address as though it were a customer packet received from a customer CE, and is then forwarded along a path according to the particular service being tested (<b>304</b>). The service (as indicated by a label associated with the packet, e.g.) may specify a particular QoS or path that a particular customer's traffic is intended to take. The test packet is forwarded along the service, mimicking characteristics of normal data traffic for the purposes of determining service characteristics such as continuity and connectivity. The test packet forwards along a path within service provider network <b>101</b>, forwarded between core routers and switches until it reaches an egress PE associated with the previously-inserted OAM address.</p>
<p id="p-0030" num="0029">In step <b>306</b>, the test packet is received and processed by the egress PE associated with the previously-inserted OAM address. The egress PE may be configured to intercept messages sent to an OAM address and send them to a management application or utility for further processing, e.g., instead of attempting to deliver the message via an interface at the egress PE. Alternatively, the interface itself may be configured to recognize that a destination address is a previously-learned OAM address. The interface may be further configured to report to a management application or utility, e.g., how the packet would have been processed (e.g., the service with which it would have been associated and the port through which it would have been sent) had it been a customer packet. In step <b>308</b>, the information generated by sending the test packet is assessed to determine the results of the test. The results may be varied and may include a number of objectives, such as determining data communication continuity, connectivity, bandwidth, or other characteristics of the particular test customer service.</p>
<p id="p-0031" num="0030">In some situations, data can be sent in two different planes, a forwarding plane and a control plane. The control plane may be used to send information, generally according to the IP protocol, for establishing and/or performing OAM functions. The data plane is the forwarding path used to send customer packets associated with the service. In some embodiments, test packets can be sent in either the forwarding plane or the control plane, depending upon such factors as the nature of the test (e.g., the type of test TLV placed in the test packet) and whether the data plane is available to forward the packet.</p>
<p id="p-0032" num="0031">While in certain of the embodiments described in detail above the address being inserted for OAM use is described as being a MAC address, other types of address information may be inserted into a forwarding database using the techniques disclosed herein. For example, in the case of a VPRN service, such as a VPRN as described in RFC 2547, which is a virtual private network service for transporting IP traffic, the inserted OAM address may comprise an IP address that falls within a range of internal IP address space addresses associated with a particular VPRN service. Other types of addresses similarly may be inserted to facilitate testing of other types of VPN service. Also, while in certain of the embodiments described in detail above by way of example the service with respect to which the OAM function is to be performed is a VPLS, the techniques described herein may be used in connection with any suitable network service.</p>
<p id="p-0033" num="0032">Although the foregoing embodiments have been described in some detail for purposes of clarity of understanding, the invention is not limited to the details provided. There are many alternative ways of implementing the invention. The disclosed embodiments are illustrative and not restrictive.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method for inserting into a forwarding database associated with a network service of a network an address reserved for testing use comprising:
<claim-text>receiving a packet forming a part of a testing message, the packet comprising the address reserved for testing use and an indication that the address is to be inserted into the forwarding database associated with the network service, wherein the packet is received at a first node and the address reserved for testing use was not used as an address to route the packet to the first node;</claim-text>
<claim-text>adding the address reserved for testing use to the forwarding database associated with the network service; and</claim-text>
<claim-text>using a communication interface to notify a second node associated with the network service that the address is associated with the first node, wherein the first node notifies the second node and the second node stores in a second node forwarding table an association between the address reserved for testing use and a path to the first node.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising marking the address as reserved for testing use.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the packet is received at the first node, the method further comprising receiving an indication that the address is to be associated with the first node.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the packet is received at the first node, the method further comprising receiving an indication at the first node that one or more other nodes associated with the network service should be sent information concerning the address.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the packet is received at the first node, the method further comprising notifying one or more other nodes associated with the network service that the address is associated with the first node.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the packet is received at the first node, the method, further comprising notifying one or more other nodes associated with the network service that the address is associated with a forwarding path associated with the first node.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising receiving an indication that the address should be purged from the forwarding database.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising receiving an indication that the address may only be purged by a sender of the packet.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the packet is received according to a protocol and the method further comprising receiving an indication that a customer packet that uses the address should be processed normally according to the protocol.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising receiving an indication that the address should be added to the forwarding database as an address reserved for testing use even if the address was previously added to the forwarding database as an address available for customer use.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the packet is received according to a protocol and the method further comprising receiving according to the protocol a second packet addressed to the address reserved for testing purpose.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The method as recited in <claim-ref idref="CLM-00011">claim 11</claim-ref> further comprising associating the second packet with the address.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The method as recited in <claim-ref idref="CLM-00011">claim 11</claim-ref> further comprising providing an indication regarding a processing of the second packet.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The method as recited in <claim-ref idref="CLM-00011">claim 11</claim-ref> further comprising providing an indication of an external interface with which the second packet is associated based on the address reserved for testing use.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The method as recited in <claim-ref idref="CLM-00011">claim 11</claim-ref> further comprising sending the second packet to an interface for processing.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The method as recited in <claim-ref idref="CLM-00011">claim 11</claim-ref> further comprising determining the second packet is configured to diagnose an aspect of the network by reading a flag in the second packet.</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The method as recited in <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein the second packet is received according to a protocol and the flag is interpreted using the protocol.</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The method as recited in <claim-ref idref="CLM-00011">claim 11</claim-ref> further comprising monitoring the second packet while a customer network and a provider network are active.</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The method as recited in <claim-ref idref="CLM-00011">claim 11</claim-ref> wherein the second packet is received pursuant to a test of the continuity of at least a portion of the network service.</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The method as recited in <claim-ref idref="CLM-00011">claim 11</claim-ref> wherein the second packet is received pursuant to a test of the connectivity of at least a portion of the network service.</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the packet is received according to a protocol and the packet mimics a normal packet.</claim-text>
</claim>
<claim id="CLM-00022" num="00022">
<claim-text>22. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the packet includes a flag indicating removal of an address.</claim-text>
</claim>
<claim id="CLM-00023" num="00023">
<claim-text>23. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the packet includes a flag indicating adding an address.</claim-text>
</claim>
<claim id="CLM-00024" num="00024">
<claim-text>24. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising receiving a query regarding the address reserved for testing use.</claim-text>
</claim>
<claim id="CLM-00025" num="00025">
<claim-text>25. The method as recited in <claim-ref idref="CLM-00024">claim 24</claim-ref> further comprising providing in response to the query information associated with the address reserved for testing use.</claim-text>
</claim>
<claim id="CLM-00026" num="00026">
<claim-text>26. The method as recited in <claim-ref idref="CLM-00024">claim 24</claim-ref> further comprising providing in response to the query an indication of a network node with which the address is associated.</claim-text>
</claim>
<claim id="CLM-00027" num="00027">
<claim-text>27. The method as recited in <claim-ref idref="CLM-00024">claim 24</claim-ref> further comprising providing in response to the query an indication of a network path with which the address is associated.</claim-text>
</claim>
<claim id="CLM-00028" num="00028">
<claim-text>28. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the address reserved for testing use is a physical address.</claim-text>
</claim>
<claim id="CLM-00029" num="00029">
<claim-text>29. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the address reserved for testing use is a MAC address.</claim-text>
</claim>
<claim id="CLM-00030" num="00030">
<claim-text>30. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the packet is received according to a protocol and wherein the indication that the address is to be inserted into the forwarding database for testing use comprises data included in a field added to the packet according to the protocol.</claim-text>
</claim>
<claim id="CLM-00031" num="00031">
<claim-text>31. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the packet is received according to a protocol and wherein the indication that the address is to be inserted into the forwarding database for testing use comprises data included in a field of the packet that has been modified according to the protocol.</claim-text>
</claim>
<claim id="CLM-00032" num="00032">
<claim-text>32. The method as recited in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the packet is received according to a protocol and wherein the indication that the address is to be inserted into the forwarding database for testing use comprises determining that a data field normally included in a packet sent according to the protocol has been removed.</claim-text>
</claim>
<claim id="CLM-00033" num="00033">
<claim-text>33. A system inserting into a forwarding database associated with a network service an address reserved for testing use comprising:
<claim-text>a processor configured to:
<claim-text>receive a packet forming a part of a testing message, the packet comprising the address reserved for testing use and an indication that the address is to be inserted into the forwarding database associated with the network service, wherein the packet is received at a first node and the address reserved for testing use was not used as an address to route the packet to the first node;</claim-text>
<claim-text>add the address reserved for testing use to the forwarding database associated with the network service; and</claim-text>
<claim-text>notify a second node associated with the network service that the address is associated with the first node, wherein the first node notifies the second node and the second node stores in a second node forwarding table an association between the address reserved for testing use and a path to the first node.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00034" num="00034">
<claim-text>34. The system as recited in <claim-ref idref="CLM-00033">claim 33</claim-ref>, wherein the packet is received at the first node, and an indication is received at the first node that one or more other nodes associated with the network service should be sent information concerning the address.</claim-text>
</claim>
<claim id="CLM-00035" num="00035">
<claim-text>35. The system as recited in <claim-ref idref="CLM-00033">claim 33</claim-ref>, wherein the packet is received at the first node, and the processor is further configured to notify one or more other nodes associated with the network service that the address is associated with the first node.</claim-text>
</claim>
<claim id="CLM-00036" num="00036">
<claim-text>36. The system as recited in <claim-ref idref="CLM-00033">claim 33</claim-ref>, wherein the processor is further configured to receive an indication that the address should be purged from the forwarding database.</claim-text>
</claim>
<claim id="CLM-00037" num="00037">
<claim-text>37. The system as recited in <claim-ref idref="CLM-00033">claim 33</claim-ref>, wherein the packet is received according to a protocol and the processor is further configured to receive an indication that a customer packet that uses the address should be processed normally according to the protocol.</claim-text>
</claim>
<claim id="CLM-00038" num="00038">
<claim-text>38. The system as recited in <claim-ref idref="CLM-00033">claim 33</claim-ref>, wherein the packet is received according to a protocol and the processor is further configured to receive according to the protocol a second packet addressed to the address reserved for testing purpose.</claim-text>
</claim>
<claim id="CLM-00039" num="00039">
<claim-text>39. The system as recited in <claim-ref idref="CLM-00033">claim 33</claim-ref>, wherein the processor is further configured to receive a query regarding the address reserved for testing use.</claim-text>
</claim>
<claim id="CLM-00040" num="00040">
<claim-text>40. The system as recited in <claim-ref idref="CLM-00033">claim 33</claim-ref>, wherein the address reserved for testing use is a MAC address.</claim-text>
</claim>
<claim id="CLM-00041" num="00041">
<claim-text>41. A computer program product for inserting into a forwarding database associated with a network service an address reserved for testing use, the computer program product comprising a non-transitory computer readable storage medium on which are encoded computer instructions which when executed by a computer cause the computer to perform a method comprising:
<claim-text>receiving a packet forming a part of a testing message, the packet comprising the address reserved for testing use and an indication that the address is to be inserted into the forwarding database associated with the network service, wherein the packet is received at a first node and the address reserved for testing use was not used as an address to route the packet to the first node;</claim-text>
<claim-text>adding the address reserved for testing use to the forwarding database associated with the network service; and</claim-text>
<claim-text>notifying a second node associated with the network service that the address is associated with the first node, wherein the first node notifies the second node and the second node stores in a second node forwarding table an association between the address reserved for testing use and a path to the first node.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00042" num="00042">
<claim-text>42. The computer program product as recited in <claim-ref idref="CLM-00041">claim 41</claim-ref>, wherein the packet is received according to a protocol and the method further comprising receiving according to the protocol a second packet addressed to the address reserved for testing purpose.</claim-text>
</claim>
<claim id="CLM-00043" num="00043">
<claim-text>43. The computer program product as recited in <claim-ref idref="CLM-00041">claim 41</claim-ref>, further comprising receiving a query regarding the address reserved for testing use.</claim-text>
</claim>
<claim id="CLM-00044" num="00044">
<claim-text>44. The computer program product as recited in <claim-ref idref="CLM-00041">claim 41</claim-ref>, wherein the address reserved for testing use is a MAC address. </claim-text>
</claim>
</claims>
</us-patent-grant>
