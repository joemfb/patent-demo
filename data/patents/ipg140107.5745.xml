<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08626849-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08626849</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12844172</doc-number>
<date>20100727</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<us-term-of-grant>
<us-term-extension>556</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>15</main-group>
<subgroup>16</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>709206</main-classification>
<further-classification>709204</further-classification>
<further-classification>709207</further-classification>
</classification-national>
<invention-title id="d2e53">Apparatus and method for resolving a race condition between two session initiation protocol (SIP) end points</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>7509425</doc-number>
<kind>B1</kind>
<name>Rosenberg</name>
<date>20090300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709227</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>2003/0005280</doc-number>
<kind>A1</kind>
<name>Bobde et al.</name>
<date>20030100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713150</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>2005/0182995</doc-number>
<kind>A1</kind>
<name>Curcio et al.</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>714748</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>2006/0142010</doc-number>
<kind>A1</kind>
<name>Tom et al.</name>
<date>20060600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>455445</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2008/0022383</doc-number>
<kind>A1</kind>
<name>Bobde et al.</name>
<date>20080100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 10</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2008/0270618</doc-number>
<kind>A1</kind>
<name>Rosenberg</name>
<date>20081000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709228</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2009/0168985</doc-number>
<kind>A1</kind>
<name>Yu et al.</name>
<date>20090700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>37920201</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2009/0285204</doc-number>
<kind>A1</kind>
<name>Gallant et al.</name>
<date>20091100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370352</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2009/0327300</doc-number>
<kind>A1</kind>
<name>Khare et al.</name>
<date>20091200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>707 10</main-classification></classification-national>
</us-citation>
<us-citation>
<nplcit num="00010">
<othercit>SIP: Session Initiation Protocol J. Rosenberg AT&#x26;T, Jun. 2002.</othercit>
</nplcit>
<category>cited by examiner</category>
</us-citation>
<us-citation>
<nplcit num="00011">
<othercit>Generalized Third-party Call Control in SIP Netwrok Eric Cheung and Pamela Zave AT&#x26;T Labroratories&#x2014;Research Florham park, NJ 2008.</othercit>
</nplcit>
<category>cited by examiner</category>
</us-citation>
<us-citation>
<nplcit num="00012">
<othercit>European search report&#x2014;Oct. 4, 2010 from corresponding EP application.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00013">
<othercit>Johnathan Rosenberg&#x2014;&#x201c;SIP session initiation protocol . . . &#x201d; Jan. 28, 2002&#x2014;p. 77-p. 80.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00014">
<othercit>Generalized Third-Party Call Control in SIP Networks&#x2014;Eric Cheung and Pamela Zave A T &#x26; T Laborataries&#x2014;Research, white paper.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00015">
<othercit>A T &#x26; T Generalized Third-Party Call Control in SIP Networks&#x2014;Eric Cheung and Pamela Zave A T &#x26; T Laborataries&#x2014;2008.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>25</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>709206</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>5</number-of-drawing-sheets>
<number-of-figures>6</number-of-figures>
</figures>
<us-related-documents>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>61328400</doc-number>
<date>20100427</date>
</document-id>
</us-provisional-application>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20110264746</doc-number>
<kind>A1</kind>
<date>20111027</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Yin</last-name>
<first-name>Haiyang</first-name>
<address>
<city>Kitchner</city>
<country>CA</country>
</address>
</addressbook>
<residence>
<country>CA</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Luu</last-name>
<first-name>Lap</first-name>
<address>
<city>Markham</city>
<country>CA</country>
</address>
</addressbook>
<residence>
<country>CA</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Yin</last-name>
<first-name>Haiyang</first-name>
<address>
<city>Kitchner</city>
<country>CA</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Luu</last-name>
<first-name>Lap</first-name>
<address>
<city>Markham</city>
<country>CA</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Gowling Lafleur Henderson LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>BlackBerry Limited</orgname>
<role>03</role>
<address>
<city>Waterloo, Ontario</city>
<country>CA</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Hussain</last-name>
<first-name>Tauqir</first-name>
<department>2452</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">An apparatus and method are described for resolving a glare condition between two SIP endpoints. The method allows a third party call control controller to resolve the glare condition when the ownership status of each dialog is the same, by initiating a back-off period of time at the apparatus based on the ownership status of the SIP dialog and re-sending a re-INVITE message to the end point after expiry of the back-off period of time.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="210.48mm" wi="188.81mm" file="US08626849-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="232.58mm" wi="182.03mm" file="US08626849-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="222.33mm" wi="187.79mm" file="US08626849-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="185.84mm" wi="91.61mm" file="US08626849-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="223.01mm" wi="185.17mm" file="US08626849-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="216.58mm" wi="176.87mm" orientation="landscape" file="US08626849-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATIONS</heading>
<p id="p-0002" num="0001">This application claims the benefit of U.S. Provisional Application No. 61/328,400 filed Apr. 27, 2010, the entirety of which is hereby incorporated by reference.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">TECHNICAL FIELD</heading>
<p id="p-0003" num="0002">The disclosure relates to Session Initiation Protocol (SIP) sessions, and in particular to resolving race conditions in SIP sessions established through an intermediary.</p>
<heading id="h-0003" level="1">BACKGROUND</heading>
<p id="p-0004" num="0003">With the growth of the networks and the Internet, Internet Protocol (IP) telephony is becoming increasingly popular. Often referred to as Voice over IP (VoIP), it can be used to establish communication between two end points.</p>
<p id="p-0005" num="0004">In order to establish the communication, the two endpoints exchange messages in order to establish a dialog that describes the characteristics of the communication. The dialog may establish the type of media to be exchanged, for example video and/or audio as well as the protocol used to transfer the communication.</p>
<p id="p-0006" num="0005">When two endpoints attempt to modify an existing dialog at approximately the same time, a race condition exists. The condition is often referred to as a glare condition, and can be resolved using a back-off time when the two endpoints establish the call between each other directly.</p>
<p id="p-0007" num="0006">When an intermediary is used to establish the call between two endpoints, it may be difficult to resolve the glare condition. Various attempts of addressing this glare condition have been considered; however these have included modifying the Session Initiation Protocol (SIP) used to control VoIP calls. Therefore there is a need for an improved method and apparatus for addressing glare conditions in SIP.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0008" num="0007">Reference will now be made, by way of example, to the accompanying drawings which show example embodiments of the present application, and in which:</p>
<p id="p-0009" num="0008"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of a system for establishing a call between two endpoints;</p>
<p id="p-0010" num="0009"><figref idref="DRAWINGS">FIG. 2</figref> depicts a flow of SIP messages between two endpoints and a 3PCC controller for establishing dialogs with each endpoint;</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 3</figref> depicts in a message flow diagram, a message flow in which a glare condition is not successfully resolved;</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 4</figref> depicts in a flow diagram a method of resolving a race condition such as a glare condition at 3PCC controller;</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 5</figref> depicts in a message flow, the messages between two SIP endpoints and a 3PCC controller for resolving a glare condition; and</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 6</figref> shows, in block diagram form, an example system for managing enterprise-related mobile calls, including an enterprise communications platform.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DESCRIPTION</heading>
<p id="p-0015" num="0014">Embodiments are described below, by way of example only, with reference to <figref idref="DRAWINGS">FIGS. 1-6</figref>.</p>
<p id="p-0016" num="0015">In one aspect, the present disclosure provides a method of resolving, at an intermediary server, a glare condition between two end points exchanging media, each endpoint having a session initiation protocol (SIP) dialog with the intermediary server, the intermediary server having the same ownership status of each SIP dialog. The method comprises receiving a first re-INVITE message from a first end point of the two end points; receiving a second re-INVITE message from a second end point of the two end points; sending a first 491 Request Pending message to the second endpoint in response to the received second re-INVITE message; receiving a second 491 Request Pending from the second endpoint; initiating a back-off period of time based on the ownership status of the second SIP dialog; and re-sending the first re-INVITE message to the second end point after expiry of the back-off period of time.</p>
<p id="p-0017" num="0016">In another aspect, the present disclosure provides an apparatus for resolving a glare condition between two end points exchanging media, each endpoint having a session initiation protocol (SIP) dialog with the apparatus, the apparatus having the same ownership status of each SIP dialog. The apparatus comprises a memory for storing instructions; and a processor coupled to the memory for executing the instructions stored in the memory. The instructions configure the apparatus to receive a first re-INVITE message from a first end point of the two end points; receive a second re-INVITE message from a second end point of the two end points; send a first 491 Request Pending message to the second endpoint in response to the received second re-INVITE message; receive a second 491 Request Pending from the second endpoint; initiate a back-off period of time based on the ownership status of the second SIP dialog; and re-send the first re-INVITE message to the second end point after expiry of the back-off period of time.</p>
<p id="p-0018" num="0017">In yet another aspect, the present disclosure provides a computer readable media storing instructions for execution by a processor, the instructions for implementing a method of resolving, at an intermediary server, a glare condition between two end points exchanging media, each endpoint having a session initiation protocol (SIP) dialog with the intermediary server, the intermediary server having the same ownership status of each SIP dialog. The method comprises receiving a first re-INVITE message from a first end point of the two end points; receiving a second re-INVITE message from a second end point of the two end points; sending a first 491 Request Pending message to the second endpoint in response to the received second re-INVITE message; receiving a second 491 Request Pending from the second endpoint; initiating a back-off period of time based on the ownership status of the second SIP dialog; and re-sending the first re-INVITE message to the second end point after expiry of the back-off period of time.</p>
<p id="p-0019" num="0018">Other aspects of the present disclosure will be apparent to those of ordinary skill in the art from a review of the following detailed description in conjunction with the drawings. Embodiments of the present disclosure are not limited to any particular operating system, mobile device architecture, server architecture, or computer programming language.</p>
<p id="p-0020" num="0019">The present disclosure relates to the control and management of communications. Although reference may be made to &#x201c;calls&#x201d; in the description of example embodiments below, it will be appreciated that the described systems and methods are applicable to session-based communications in general and not limited to voice calls.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of a system <b>100</b> for establishing a call between two endpoints. The term &#x2018;call&#x2019; in this disclosure is broadly considered to include session based communication between two endpoints. As depicted in <figref idref="DRAWINGS">FIG. 1</figref>, a Third Party Call Control (3PCC) controller <b>102</b> comprises a central processing unit (CPU) <b>120</b> for executing instructions that are stored in the memory <b>122</b>. The instructions configure the 3PCC controller <b>102</b> in order to provide the functionality described further herein, represented schematically as SIP instructions <b>124</b>. The 3PCC controller <b>102</b> is coupled to a network <b>104</b>. As will be understood, the network <b>104</b> may comprise a plurality of interconnected networks, such as local area networks (LANs). Also connected to the network <b>104</b> are two SIP end points, <b>106</b>, <b>108</b>. Each SIP endpoint <b>106</b>, <b>108</b> may be, for example an IP phone or softphone provided on a computer. Additionally, or alternatively, the SIP endpoints may be a controller that provides some bridging functionality for bridging a SIP call with a non-IP phone. For example, a SIP endpoint may be provided by an IP-PBX that can connects to the PTSN.</p>
<p id="p-0022" num="0021">A call can be established between two SIP end points through a third party. This is referred to as 3PCC. In 3PCC, the 3PCC controller <b>104</b> establishes respective SIP dialogs with each SIP end point by exchanging control messages <b>116</b> with the end points <b>106</b>, <b>108</b>. Each SIP dialog describes the characteristics of the call, and may be described in accordance with Session Description Protocol (SDP). SDP may be used to describe the media <b>114</b>, for example audio and/or video streams, to exchange between the two end points. Once the dialogs have been established between the end points <b>106</b>, <b>108</b> and the 3PCC controller <b>102</b>, media <b>114</b> can be exchanged directly between the SIP end points <b>106</b>, <b>108</b>. Although the media <b>114</b> is described as being exchanged directly between the SIP endpoints, it will be appreciated that this is with regards to the 3PCC controller <b>102</b>. That is the media <b>114</b> exchanged between the SIP endpoints <b>106</b>, <b>108</b> may pass between various servers, routers, switches etc, however it does not need to pass through the 3 PCC controller <b>102</b>.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 2</figref> depicts a flow of SIP messages between two endpoints <b>106</b>, <b>108</b> and the 3PCC controller <b>102</b> for establishing dialogs with each endpoint, and causing media to be exchanged directly between the two endpoints. <figref idref="DRAWINGS">FIG. 2</figref> depicts a 3PCC controller initiated call, in which the 3PCC controller initiates the dialog with each endpoint. As such the 3PCC controller <b>102</b> acts as the user agent client (UAC) for each dialog, and each endpoint <b>106</b>, <b>108</b> acts as the user agent server (UAS). In this situation, the 3PCC controller <b>102</b> may be considered the owner of each dialog, since it initiated the dialogs. The 3PCC controller initiated calls may be used, for example, to provide click-to-dial functionality. Click-to-dial allows a user to click a phone number on a web page and have the web server (which would include a 3PCC controller) establish the call.</p>
<p id="p-0024" num="0023">As depicted in <figref idref="DRAWINGS">FIG. 2</figref>, the 3PCC controller sends an INVITE message to the first SIP endpoint (<b>201</b>). The INVITE does not contain an SDP. The first SIP endpoint responds with a 200 OK message (<b>202</b>), assuming the party wishes to establish the call. The 200 OK message includes an offer from the SIP endpoint. The offer specifies the characteristics of the call the endpoint wishes to establish. The offer may be described using Session Description Protocol (SDP) and may include information about different content streams such as the type of media, codecs used, locations and ports of the stream, etc. The particular offer is depicted as &#x2018;SDP<b>1</b>&#x2019; in <figref idref="DRAWINGS">FIG. 2</figref>. The requirements of defining an offer using SDP are described in RFC 2327, which is hereby incorporated by reference in its entirety. The 3PCC controller receives the offer from the first SIP endpoint and sends an INVITE message to the second SIP endpoint (<b>203</b>). The second INVITE includes the offer sent from the first SIP endpoint, &#x2018;SDP<b>1</b>&#x2019;. The second SIP endpoint receives the INVITE and, assuming the party wishes to establish the call, responds with a 200 OK message (<b>204</b>). The 200 OK message includes an answer to the offer received in the INVITE. The answer, similar to an offer, specifies the characteristics of the call the endpoint is willing and/or able to establish. The answer may be described in accordance with SDP, and is depicted as &#x2018;SDP<b>2</b>&#x2019; in <figref idref="DRAWINGS">FIG. 2</figref>. The 3PCC controller sends an ACK message back to the second SIP endpoint (<b>205</b>). After receiving the answer, &#x2018;SDP<b>2</b>&#x2019;, from the second SIP endpoint, the 3PCC controller responds to the first 200 OK message initially sent from the first endpoint with an ACK message (<b>206</b>). The ACK message includes the answer, &#x2018;SDP<b>2</b>&#x2019;, from the second SIP endpoint. Each endpoint now has the call characteristics the other endpoint can establish, such as the location of a media stream, and so an exchange of media between the two endpoints can be established. The media may be exchanged using real-time transport protocol (RTP) messages (<b>207</b>) as depicted. However, other types of messages can be exchanged if described in the respective SDPs sent by the endpoints.</p>
<p id="p-0025" num="0024">The message flow of <figref idref="DRAWINGS">FIG. 2</figref> depicts one possible way of establishing a call between two SIP endpoints through a 3PCC controller. It will be appreciated that other message flows are possible. Furthermore, the call does not need to be initiated by the 3PCC controller and may be initiated by one, or both, of the endpoints initiating a dialog with the 3PCC controller.</p>
<p id="p-0026" num="0025">Once a SIP call has been established between two endpoints, either endpoint may attempt to modify the characteristics by sending a re-INVITE message that includes a new SDP description. The other endpoint may accept the modification by sending a 200 OK message that includes its SDP. This may be used, for example, to provide music-on-hold functionality.</p>
<p id="p-0027" num="0026">A problem may arise when both endpoints attempt to modify the characteristics at the same time, for example both endpoints send re-INVITE messages at the same time, or before receiving the re-INVITE from the other endpoint. This is referred to as a glare condition, and can be addressed using a 491 Request Pending message. Upon receiving a 491 Request Pending message, a SIP end point will wait a period of time, referred to as the back-off time period, before retrying the re-INVITE. In order to ensure that the two SIP endpoints do not retry the re-INVITE at the same time, the back-off time period used by each endpoint is determined based on ownership status of the SIP dialog. That is, if the SIP end point owns, or initiated, the dialog. If the SIP endpoint did not initiate the call, the back-off time is selected between 0 and 2 seconds. If the SIP endpoint initiated the call the back-off time is selected between 2.1 and 4 seconds. This works well as long as the ownership of the dialogs is different for each endpoint. However, in 3PCC, the ownership of each dialog may be the same at each endpoint.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 3</figref> depicts in a message flow diagram, a message flow in which the glare condition is not successfully resolved. In this example, it is assumed that the 3PCC controller has initiated the call with the two endpoints, and as such the endpoints have the same ownership status. It will be appreciated that the same situation applies if both endpoints had initiated the call and so both owned their respective SIP dialogs.</p>
<p id="p-0029" num="0028">As seen in <figref idref="DRAWINGS">FIG. 3</figref>, after the two SIP dialogs have been established, both endpoints attempt to modify the characteristics by sending a re-INVITE message to the 3PCC controller. The first SIP endpoint sends a re-INVITE message (<b>301</b>) with a new offer specifying the new characteristics (&#x2018;SDP<b>3</b>&#x2019;). The 3PCC controller forwards the re-INVITE request with SDP<b>3</b> onto the second end point (<b>302</b>). However, before the re-INVITE (SDP<b>3</b>) arrives at the second endpoint, the second endpoint also sends a re-INVITE message (<b>303</b>). The re-INVITE message sent from the second endpoint includes a new offer specifying the new characteristics (&#x2018;SDP<b>4</b>&#x2019;). The 3PCC controller receives the re-INVITE (SDP<b>4</b>) message from the second SIP endpoint before receiving the expected 200 OK message. As such, the 3PCC controller sends a 491 Request Pending message (<b>304</b>) to the second SIP endpoint, which the second SIP endpoint responds to with an ACK (<b>306</b>). Similarly, the second SIP endpoint receives the re-INVITE (SDP<b>3</b>) prior to receiving the expected 200 OK message, and so sends a 491 Request Pending message (<b>305</b>) to the 3PCC controller. The 3PCC controller sends an ACK (<b>307</b>) back to the second SIP endpoint and forwards the 491 Request Pending message (<b>308</b>) onto the first SIP endpoint. The first SIP endpoint sends an ACK message (<b>309</b>) back to the 3PCC controller.</p>
<p id="p-0030" num="0029">Upon receiving the 491 Request Pending messages both the SIP end points initiate a back-off time (<b>310</b>), (<b>311</b>). However since both dialogs between the endpoints and the 3PCC controller are owned by the 3PCC controller, the back-off time is selected from within the same interval. As such, the back-off time selected by each end-point may be the same, either because, the SIP endpoint does not select a random back-off time, or because the randomly selected back-off time selected by each endpoint happens to be the same. After the back-off time has expired, each endpoint retries the respective re-INVITE message (<b>312</b>), (<b>313</b>). This results in the same glare condition existing.</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 4</figref> depicts in a flow diagram an illustrative method of resolving a race condition such as a glare condition at 3PCC controller. The 3PCC controller <b>102</b> receives a first re-INVITE message from a first end point <b>104</b> (<b>402</b>) and then receives a second re-INVITE message from a second endpoint <b>106</b> (<b>404</b>) prior to receiving a 200 OK message from the second end point in response to the first re-INVITE message. A first 491 Request Pending message is sent (<b>406</b>) to the second endpoint <b>106</b> in response to receiving the second re-INVITE message prior to the expected 200 OK message. A second 491 Request Pending message is received (<b>408</b>) at the 3PCC controller <b>102</b> from the second endpoint <b>106</b>. Instead of forwarding the 491 Request Pending message onto the first SIP endpoint <b>104</b>, the 3PCC controller <b>102</b> initiates a back-off time period (<b>410</b>) according to the ownership status of the dialog between the 3PCC controller <b>102</b> and the second SIP endpoint <b>104</b>. After the back-off time has expired, the 3PCC controller <b>102</b> retries sending the first re-INVITE to the second SIP endpoint <b>106</b>.</p>
<p id="p-0032" num="0031">The method as described above resolves the glare condition at a 3PCC controller. Since the 3PCC controller <b>102</b> and the second endpoint <b>106</b> will not have the same ownership state of the dialog, as it is not possible for both the second endpoint and the 3PCC controller to have initiated the dialog, each will select a back-off time from a different time window as required by SIP.</p>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 5</figref> depicts in a message flow, the messages between two SIP endpoints and a 3PCC controller for resolving a re-INVITE glare condition. The beginning of the message flow depicted in <figref idref="DRAWINGS">FIG. 5</figref> is similar to that described above with reference to <figref idref="DRAWINGS">FIG. 3</figref>. After the two SIP dialogs have been established, both endpoints attempt to modify the characteristics by sending a re-INVITE message to the 3PCC controller. The first SIP endpoint sends a re-INVITE message (<b>501</b>) with a new offer specifying the new characteristics (&#x2018;SDP<b>3</b>&#x2019;). The 3PCC controller forwards the re-INVITE request with SDP<b>3</b> onto the second end point (<b>502</b>). However, before the re-INVITE (SDP<b>3</b>) arrives at the second endpoint, the second endpoint also sends a re-INVITE message (<b>503</b>). The re-INVITE message sent from the second SIP endpoint includes a new offer specifying the new characteristics (&#x2018;SDP<b>4</b>&#x2019;). The 3PCC controller receives the re-INVITE (SDP<b>4</b>) message from the second SIP endpoint before receiving the expected 200 OK message. As such, the 3PCC controller sends a 491 Request Pending message (<b>504</b>) to the second SIP endpoint, which the second SIP endpoint responds to with an ACK (<b>506</b>). Similarly, the second SIP endpoint receives the re-INVITE (SDP<b>3</b>) prior to receiving the expected 200 OK message, and so sends a 491 Request Pending message (<b>505</b>) to the 3PCC controller. The 3PCC controller sends an ACK (<b>507</b>) back to the second SIP endpoint. However, unlike the message flow of <figref idref="DRAWINGS">FIG. 3</figref>, the 3PCC controller does not forward the 491 Request Pending message on to the first SIP end point. Instead, as described above with reference to <figref idref="DRAWINGS">FIG. 4</figref>, the 3PCC controller initiates a back-off time period (<b>508</b>) upon sending the ACK message to the received 491 Request Pending message. Similarly, upon sending the ACK message to the 3PCC controller, the second endpoint initiates a back-off time period (<b>509</b>). Upon expiry of the back-off time, the re-INVITE will be sent. In the example of <figref idref="DRAWINGS">FIG. 5</figref>, it is assumed that the 3PCC controller initiated the dialog with the second SIP endpoint, and so should re-try the re-INVITE after between 2.1 and 4 seconds in units of 10 ms. Since the second endpoint did not initiate the dialog with the 3PCC controller, it will wait for between 0 and 2 seconds in units of 10 ms before retrying the re-INVITE. As such, the 3PCC controller will resend the re-INVITE (SDP<b>3</b>) to the second SIP endpoint (<b>510</b>). This re-INVITE (SDP<b>3</b>) will be received at the second endpoint before it attempts to resend its re-INVITE (SDP<b>4</b>). As such the glare condition is resolved. The second SIP endpoint responds to the re-INVITE (SDP<b>3</b>) with a 200 OK message that includes SDP<b>4</b> (<b>511</b>), which is received at the 3PCC controller. The 3PCC controller sends an ACK message (<b>512</b>) to the second endpoint and sends the 200 OK message with SDP<b>4</b> to the first endpoint (<b>513</b>). The first endpoint responds to the 200 OK message with an ACK message (<b>514</b>).</p>
<p id="p-0034" num="0033">The system and methods described above can advantageously provide shorter audio recovery times when resolving glare conditions at a 3PCC controller. Furthermore, the method does not require modification to SIP endpoints, and as such, as long as the SIP endpoints correctly implement the SIP protocol, the glare conditions can be resolved.</p>
<p id="p-0035" num="0034">As will be appreciated, the 3PCC controller apparatus and method described above may be implemented in various environments. For example, a web server that provides click-to-dial functionality may include the 3PCC controller functionality described herein. Additionally, or alternatively, the 3PCC controller functionality may be included in an enterprise network that provides for the control and management of communications.</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 6</figref> shows, in block diagram form, an example system, generally designated <b>10</b>, for the control and management of communications. The system <b>10</b> includes an enterprise or business system <b>20</b>, which in many embodiments includes a local area network (LAN). In the description below, the enterprise or business system <b>20</b> may be referred to as an enterprise network <b>20</b>. It will be appreciated that the enterprise network <b>20</b> may include more than one network and may be located in multiple geographic areas in some embodiments.</p>
<p id="p-0037" num="0036">The enterprise network <b>20</b> may be connected, often through a firewall <b>22</b>, to a wide area network (WAN) <b>30</b>, such as the Internet. The enterprise network <b>20</b> may also be connected to a public switched telephone network (PSTN) <b>40</b> via direct inward dialing (DID) trunks or primary rate interface (PRI) trunks.</p>
<p id="p-0038" num="0037">The enterprise network <b>20</b> may also communicate with a public land mobile network (PLMN) <b>50</b>, which may also be referred to as a wireless wide area network (WWAN) or, in some cases, a cellular network. The connection with the PLMN <b>50</b> may be made via a relay <b>26</b>, as known in the art.</p>
<p id="p-0039" num="0038">The enterprise network <b>20</b> may also provide a wireless local area network (WLAN) <b>32</b><i>a </i>featuring wireless access points. Other WLANs <b>32</b> may exist outside the enterprise network <b>20</b>. For example, WLAN <b>32</b><i>b </i>may be connected to WAN <b>30</b>.</p>
<p id="p-0040" num="0039">The system <b>10</b> may include a number of enterprise-associated mobile devices <b>11</b> (only one shown). The mobile devices <b>11</b> may include devices equipped for cellular communication through the PLMN <b>50</b>, mobile devices equipped for Wi-Fi communications over one of the WLANs <b>32</b>, or dual-mode devices capable of both cellular and WLAN communications. WLANs <b>32</b> may be configured in accordance with one of the IEEE 802.11 specifications.</p>
<p id="p-0041" num="0040">It will be understood that the mobile devices <b>11</b> include one or more radio transceivers and associated processing hardware and software to enable wireless communications with the PLMN <b>50</b> and/or one of the WLANs <b>32</b>. In various embodiments, the PLMN <b>50</b> and mobile devices <b>11</b> may be configured to operate in compliance with any one or more of a number of wireless protocols, including GSM, GPRS, CDMA, EDGE, UMTS, EVDO, HSPA, 3GPP, LTE or a variety of others. It will be appreciated that the mobile device <b>11</b> may roam within the PLMN <b>50</b> and across PLMNs, in known manner, as the user moves. In some instances, the dual-mode mobile devices <b>11</b> and/or the enterprise network <b>20</b> are configured to facilitate roaming between the PLMN <b>50</b> and a WLAN <b>32</b>, and are thus capable of seamlessly transferring sessions (such as voice calls) from a connection with the cellular interface of the dual-mode device <b>11</b> to the WLAN <b>32</b> interface of the dual-mode device <b>11</b>, and vice versa.</p>
<p id="p-0042" num="0041">The enterprise network <b>20</b> typically includes a number of networked servers, computers, and other devices. For example, the enterprise network <b>20</b> may connect one or more desktop or laptop computers <b>15</b> (one shown). The connection may be wired or wireless in some embodiments. The enterprise network <b>20</b> may also connect to one or more digital telephone sets <b>17</b> (one shown).</p>
<p id="p-0043" num="0042">The enterprise network <b>20</b> may include one or more mail servers, such as mail server <b>24</b>, for coordinating the transmission, storage, and receipt of electronic messages for client devices operating within the enterprise network <b>20</b>. Typical mail servers include the Microsoft Exchange Server&#x2122; and the IBM Lotus Domino&#x2122; server. Each user within the enterprise typically has at least one user account within the enterprise network <b>20</b>. Associated with each user account is message address information, such as an e-mail address. Messages addressed to a user message address are stored on the enterprise network <b>20</b> in the mail server <b>24</b>. The messages may be retrieved by the user using a messaging application, such as an e-mail client application. The messaging application may be operating on a user's computer <b>15</b> connected to the enterprise network <b>20</b> within the enterprise. In some embodiments, the user may be permitted to access stored messages using a remote computer, for example at another location via the WAN <b>30</b> using a VPN connection. Using the messaging application, the user may also compose and send messages addressed to others, within or outside the enterprise network <b>20</b>. The messaging application causes the mail server <b>24</b> to send a composed message to the addressee, often via the WAN <b>30</b>.</p>
<p id="p-0044" num="0043">The relay <b>26</b> serves to route messages received over the PLMN <b>50</b> from the mobile device <b>11</b> to the corresponding enterprise network <b>20</b>. The relay <b>26</b> also pushes messages from the enterprise network <b>20</b> to the mobile device <b>11</b> via the PLMN <b>50</b>.</p>
<p id="p-0045" num="0044">The enterprise network <b>20</b> also includes an enterprise server <b>12</b>. Together with the relay <b>26</b>, the enterprise server <b>12</b> functions to redirect or relay incoming e-mail messages addressed to a user's e-mail address within the enterprise network <b>20</b> to the user's mobile device <b>11</b> and to relay incoming e-mail messages composed and sent via the mobile device <b>11</b> out to the intended recipients within the WAN <b>30</b> or elsewhere. The enterprise server <b>12</b> and relay <b>26</b> together facilitate &#x201c;push&#x201d; e-mail service for the mobile device <b>11</b> enabling the user to send and receive e-mail messages using the mobile device <b>11</b> as though the user were connected to an e-mail client within the enterprise network <b>20</b> using the user's enterprise-related e-mail address, for example on computer <b>15</b>.</p>
<p id="p-0046" num="0045">As is typical in many enterprises, the enterprise network <b>20</b> includes a Private Branch eXchange (although in various embodiments the PBX may be a standard PBX or an IP-PBX, for simplicity the description below uses the term PBX to refer to both) <b>16</b> having a connection with the PSTN <b>40</b> for routing incoming and outgoing voice calls for the enterprise. The PBX <b>16</b> is connected to the PSTN <b>40</b> via DID trunks or PRI trunks, for example. The PBX <b>16</b> may use ISDN signalling protocols for setting up and tearing down circuit-switched connections through the PSTN <b>40</b> and related signalling and communications. In some embodiments, the PBX <b>16</b> may be connected to one or more conventional analog telephones <b>19</b>. The PBX <b>16</b> is also connected to the enterprise network <b>20</b> and, through it, to telephone terminal devices, such as digital telephone sets <b>17</b>, softphones operating on computers <b>15</b>, etc. Within the enterprise, each individual may have an associated extension number, sometimes referred to as a PNP (private numbering plan), or direct dial phone number. Calls outgoing from the PBX <b>16</b> to the PSTN <b>40</b> or incoming from the PSTN <b>40</b> to the PBX <b>16</b> are typically circuit-switched calls. Within the enterprise, e.g. between the PBX <b>16</b> and terminal devices, voice calls are often packet-switched calls, for example Voice-over-IP (VoIP) calls. The PBX <b>16</b> may provide the SIP endpoints described above and bridge them with external, or internal communication devices such as phones connected to PSTN <b>40</b>.</p>
<p id="p-0047" num="0046">The enterprise network <b>20</b> may further include a Service Management Platform (SMP) <b>18</b> for performing some aspects of messaging or session control, like call control and advanced call processing features. The SMP <b>18</b> may implement the 3PCC controller functionality described above <b>19</b>. The SMP <b>18</b> may, in some cases, also perform some media handling. Collectively the SMP <b>18</b> and PBX <b>16</b> may be referred to as the enterprise communications platform, generally designated <b>14</b>. It will be appreciated that the enterprise communications platform <b>14</b> and, in particular, the SMP <b>18</b>, is implemented on one or more servers having suitable communications interfaces for connecting to and communicating with the PBX <b>16</b> and/or DID/PRI trunks. Although the SMP <b>18</b> may be implemented on a stand-alone server, it will be appreciated that it may be implemented into an existing control agent/server as a logical software component.</p>
<p id="p-0048" num="0047">The enterprise communications platform <b>14</b> implements the switching to connect session legs and may provide the conversion between, for example, a circuit-switched call and a VoIP call, or to connect legs of other media sessions. In some embodiments, in the context of voice calls the enterprise communications platform <b>14</b> provides a number of additional functions including automated attendant, interactive voice response, call forwarding, voice mail, etc. It may also implement certain usage restrictions on enterprise users, such as blocking international calls or 1-900 calls. In many embodiments, Session Initiation Protocol (SIP) may be used to set-up, manage, and terminate media sessions for voice calls. Other protocols may also be employed by the enterprise communications platform <b>14</b>, for example, Web Services, Computer Telephony Integration (CTI) protocol, Session Initiation Protocol for Instant Messaging and Presence Leveraging Extensions (SIMPLE), and various custom Application Programming Interfaces (APIs), as will be described in greater detail below.</p>
<p id="p-0049" num="0048">One of the functions of the enterprise communications platform <b>14</b> is to extend the features of enterprise telephony to the mobile devices <b>11</b>. For example, the enterprise communications platform <b>14</b> may allow the mobile device <b>11</b> to perform functions akin to those normally available on a standard office telephone, such as the digital telephone set <b>17</b> or analog telephone set <b>15</b>. Example features may include direct extension dialing, enterprise voice mail, conferencing, call transfer, call park, etc.</p>
<p id="p-0050" num="0049">Certain adaptations and modifications of the described embodiments can be made. Therefore, the above discussed embodiments are considered to be illustrative and not restrictive.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>The invention claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method at an intermediary server, between two end points exchanging media, the method comprising:
<claim-text>receiving, at the intermediary server, a first re-INVITE message from a first end point of the two end points, wherein the first end point has a first session initiation protocol (SIP) dialog with the intermediary server having an associated ownership status, the first SIP dialog established using first session description protocol characteristics (SPD<b>1</b>);</claim-text>
<claim-text>receiving, at the intermediary server, a second re-INVITE message from a second end point of the two end points causing a glare condition between the two end points, wherein the second end point has a second SIP dialog with the intermediary server having the same associated ownership status as the first SIP dialog, the second SIP dialog established using second session description protocol characteristics (SPD<b>2</b>);</claim-text>
<claim-text>sending, from the intermediary server, a first 491 Request Pending message to the second endpoint in response to the received second re-INVITE message;</claim-text>
<claim-text>receiving, at the intermediary server, a second 491 Request Pending from the second endpoint;</claim-text>
<claim-text>initiating, at the intermediary server, a back-off period of time based on the ownership status of the second SIP dialog; and</claim-text>
<claim-text>re-sending, from the intermediary server, the first re-INVITE message to the second end point after expiry of the back-off period of time.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the second re-INVITE message is received prior to receiving a 200 OK message from the second end point in response to the first re-INVITE message.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising sending the first re-INVITE message received from the first endpoint to the second endpoint.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00003">claim 3</claim-ref>, further comprising:
<claim-text>receiving the first re-INVITE message at the second endpoint prior to receiving a 200 OK message in response to the second re-INVITE message; and</claim-text>
<claim-text>sending the second 491 Request Pending message in response to the received first re-INVITE message.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising
<claim-text>sending an ACK message to the second endpoint in response to the second 491 Request Pending message.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising:
<claim-text>receiving a 200 OK message from the second endpoint; and</claim-text>
<claim-text>sending the 200 OK message to the first endpoint.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, further comprising:
<claim-text>sending an ACK message to the second endpoint in response to the 200 OK message; and</claim-text>
<claim-text>receiving an ACK message from the first endpoint in response to the 200 OK message.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the intermediary server is the owner of both SIP dialogs between the first endpoint and the second endpoint.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the intermediary server selects a back off time value randomly between 2.1 and 4 second in units of 10 ms.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the intermediary server is not the owner of either of the SIP dialogs between the first endpoint and the second endpoint.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The method of <claim-ref idref="CLM-00010">claim 10</claim-ref> wherein the intermediary server selects a back off time value randomly between 0 and 2 second in units of 10 ms.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the first re-INVITE message defines new SDP characteristics (SDP<b>3</b>) for the first SIP dialog, the second re-INVITE message defines new SDP characteristics (SDP<b>4</b>) for the second SIP dialog and the 200 OK message includes SDP<b>4</b>.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. An apparatus between two end points exchanging media, the apparatus comprising:
<claim-text>a memory for storing instructions; and</claim-text>
<claim-text>a processor coupled to the memory for executing the instructions stored in the memory, the instructions configuring the apparatus to:
<claim-text>receive a first re-INVITE message from a first end point of the two end points, wherein the first end point has a first session initiation protocol (SIP) dialog with the intermediary server having an associated ownership status, the first SIP dialog established using first session protocol characteristics (SPD<b>1</b>);</claim-text>
<claim-text>receive a second re-INVITE message from a second end point of the two end points causing a glare condition between the two end points, wherein the second end point has a second SIP dialog with the intermediary server having the same associated ownership status as the first SIP dialog, the second SIP dialog established using second session protocol characteristics (SPD<b>2</b>);</claim-text>
<claim-text>send a first 491 Request Pending message to the second endpoint in response to the received second re-INVITE message;</claim-text>
<claim-text>receive a second 491 Request Pending from the second endpoint;</claim-text>
<claim-text>initiate a back-off period of time based on the ownership status of the second SIP dialog; and</claim-text>
<claim-text>re-send the first re-INVITE message to the second end point after expiry of the back-off period of time.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The apparatus of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the second re-INVITE message is received prior to receiving a 200 OK message from the second end point in response to the first re-INVITE message.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The apparatus of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the instructions further configure the apparatus to send the first re-INVITE message received from the first endpoint to the second endpoint.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The apparatus of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the instructions further configure the apparatus to:
<claim-text>receive the first re-INVITE message at the second endpoint prior to receiving a 200 OK message in response to the second re-INVITE message; and</claim-text>
<claim-text>send the second 491 Request Pending message in response to the received first re-INVITE message.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The apparatus of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the instructions further configure the apparatus to:
<claim-text>send an ACK message to the second endpoint in response to the second 491 Request Pending message.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The apparatus of <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein the instructions further configure the apparatus to:
<claim-text>receive a 200 OK message from the second endpoint; and</claim-text>
<claim-text>send the 200 OK message to the first endpoint.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. The apparatus of <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein the instructions further configure the apparatus to:
<claim-text>send an ACK message to the second endpoint in response to the 200 OK message; and</claim-text>
<claim-text>receive an ACK message from the first endpoint in response to the 200 OK message.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. The apparatus of <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein the first re-INVITE message defines new SDP characteristics (SDP<b>3</b>) for the first SIP dialog, the second re-INVITE message defines new SDP characteristics (SPD<b>4</b>) for the second SIP dialog (SDP<b>2</b>) and the 200 OK message includes SDP<b>4</b>.</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. The apparatus of <claim-ref idref="CLM-00013">claim 13</claim-ref> wherein the intermediary server is the owner of both SIP dialogs between the first endpoint and the second endpoint.</claim-text>
</claim>
<claim id="CLM-00022" num="00022">
<claim-text>22. The apparatus of <claim-ref idref="CLM-00021">claim 21</claim-ref>, wherein the intermediary server selects a back off time value randomly between 2.1 and 4 second in units of 10 ms.</claim-text>
</claim>
<claim id="CLM-00023" num="00023">
<claim-text>23. The apparatus of <claim-ref idref="CLM-00013">claim 13</claim-ref> wherein the intermediary server is not the owner of either of the SIP dialogs between the first endpoint and the second endpoint.</claim-text>
</claim>
<claim id="CLM-00024" num="00024">
<claim-text>24. The apparatus of <claim-ref idref="CLM-00023">claim 23</claim-ref> wherein the intermediary server selects a back off time value randomly between 0 and 2 second in units of 10 ms.</claim-text>
</claim>
<claim id="CLM-00025" num="00025">
<claim-text>25. A non-transitory computer readable memory storing instructions for execution by a processor, the instructions for implementing a method at an intermediary server the method comprising:
<claim-text>receiving, at the intermediary server, a first re-INVITE message from a first end point of the two end points, wherein the first end point has a first session initiation protocol (SIP) dialog with the intermediary server having an associated ownership status, the first SIP dialog established using first session description protocol characteristics (SPD<b>1</b>);</claim-text>
<claim-text>receiving, at the intermediary server, a second re-INVITE message from a second end point of the two end points causing a glare condition between the two end points, wherein the second end point has a second SIP dialog with the intermediary server having the same associated ownership status as the first SIP dialog, the second SIP dialog established using second session description protocol characteristics (SPD<b>2</b>);</claim-text>
<claim-text>sending, from the intermediary server, a first 491 Request Pending message to the second endpoint in response to the received second re-INVITE message;</claim-text>
<claim-text>receiving, at the intermediary server, a second 491 Request Pending from the second endpoint;</claim-text>
<claim-text>initiating, at the intermediary server, a back-off period of time based on the ownership status of the second SIP dialog; and</claim-text>
<claim-text>re-sending, from the intermediary server, the first re-INVITE message to the second end point after expiry of the back-off period of time,</claim-text>
<claim-text>thereby resolving a glare condition between the two end points. </claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
