<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08627479-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08627479</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>13038280</doc-number>
<date>20110301</date>
</document-id>
</application-reference>
<us-application-series-code>13</us-application-series-code>
<us-term-of-grant>
<us-term-extension>156</us-term-extension>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20130101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>21</main-group>
<subgroup>00</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>726 25</main-classification>
<further-classification>713164</further-classification>
<further-classification>713168</further-classification>
<further-classification>709206</further-classification>
<further-classification>709221</further-classification>
<further-classification>709228</further-classification>
<further-classification>380255</further-classification>
<further-classification>726 12</further-classification>
</classification-national>
<invention-title id="d2e53">System and method for network security including detection of attacks through partner websites</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>5475819</doc-number>
<kind>A</kind>
<name>Miller et al.</name>
<date>19951200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709203</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5928333</doc-number>
<kind>A</kind>
<name>Landfield et al.</name>
<date>19990700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709245</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>6061798</doc-number>
<kind>A</kind>
<name>Coley et al.</name>
<date>20000500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 12</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>7308709</doc-number>
<kind>B1</kind>
<name>Brezak, Jr.</name>
<date>20071200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>7895648</doc-number>
<kind>B1</kind>
<name>Nandy et al.</name>
<date>20110200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 14</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>7975056</doc-number>
<kind>B2</kind>
<name>Gmuender et al.</name>
<date>20110700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709228</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>8275863</doc-number>
<kind>B2</kind>
<name>Selgas et al.</name>
<date>20120900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709221</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>8281129</doc-number>
<kind>B1</kind>
<name>Asghari-Kamrani et al.</name>
<date>20121000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>713168</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>8464334</doc-number>
<kind>B1</kind>
<name>Singhal</name>
<date>20130600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>726 13</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2001/0051981</doc-number>
<kind>A1</kind>
<name>Davison et al.</name>
<date>20011200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709203</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2002/0010855</doc-number>
<kind>A1</kind>
<name>Reshef et al.</name>
<date>20020100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2002/0112036</doc-number>
<kind>A1</kind>
<name>Bohannon et al.</name>
<date>20020800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709220</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>2003/0026230</doc-number>
<kind>A1</kind>
<name>Ibanez et al.</name>
<date>20030200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370338</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>2003/0159063</doc-number>
<kind>A1</kind>
<name>Apfelbaum et al.</name>
<date>20030800</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>2004/0030752</doc-number>
<kind>A1</kind>
<name>Selgas et al.</name>
<date>20040200</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>2007/0005716</doc-number>
<kind>A1</kind>
<name>LeVasseur et al.</name>
<date>20070100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709206</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>2010/0094910</doc-number>
<kind>A1</kind>
<name>Bayliss</name>
<date>20100400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>707800</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>2010/0094978</doc-number>
<kind>A1</kind>
<name>Runeson et al.</name>
<date>20100400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709221</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>2011/0185016</doc-number>
<kind>A1</kind>
<name>Kandasamy et al.</name>
<date>20110700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709203</main-classification></classification-national>
</us-citation>
<us-citation>
<nplcit num="00020">
<othercit>The utility business model and the future of computing services|http://zaphod.mindlab.umd.edu/docSeminar/pdfs/Rappa<sub>&#x2014;</sub>2004.pdf|M.A. Rappa|2004|pp. 32-42.</othercit>
</nplcit>
<category>cited by examiner</category>
</us-citation>
<us-citation>
<nplcit num="00021">
<othercit>International Search Report/Written Opinion mailed Apr. 20, 2011. Silver Tail Systems, PCT Appln. U52011/026720 filed Mar. 1, 2011.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>21</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>726 25</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>30</number-of-drawing-sheets>
<number-of-figures>30</number-of-figures>
</figures>
<us-related-documents>
<us-provisional-application>
<document-id>
<country>US</country>
<doc-number>61339248</doc-number>
<date>20100301</date>
</document-id>
</us-provisional-application>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20110214187</doc-number>
<kind>A1</kind>
<date>20110901</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Wittenstein</last-name>
<first-name>Andreas</first-name>
<address>
<city>Woodacre</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="002" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Eynon</last-name>
<first-name>Mike</first-name>
<address>
<city>Mountain View</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="003" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Mather</last-name>
<first-name>Laura</first-name>
<address>
<city>Mountain View</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="004" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Lloyd</last-name>
<first-name>Jim</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
<us-applicant sequence="005" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Frantz</last-name>
<first-name>Matt</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
<residence>
<country>US</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Wittenstein</last-name>
<first-name>Andreas</first-name>
<address>
<city>Woodacre</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="002" designation="us-only">
<addressbook>
<last-name>Eynon</last-name>
<first-name>Mike</first-name>
<address>
<city>Mountain View</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="003" designation="us-only">
<addressbook>
<last-name>Mather</last-name>
<first-name>Laura</first-name>
<address>
<city>Mountain View</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="004" designation="us-only">
<addressbook>
<last-name>Lloyd</last-name>
<first-name>Jim</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
<inventor sequence="005" designation="us-only">
<addressbook>
<last-name>Frantz</last-name>
<first-name>Matt</first-name>
<address>
<city>San Francisco</city>
<state>CA</state>
<country>US</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>BainwoodHuang</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>EMC Corporation</orgname>
<role>02</role>
<address>
<city>Hopkinton</city>
<state>MA</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Rahman</last-name>
<first-name>Mahfuzur</first-name>
<department>2438</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A computer readable storage medium with instructions executable on a host computer. The instructions record a relationship between a partner site and the host computer, substitute a reference to the partner site with a partner site alias referencing the host computer, deliver the partner site alias to a client, replace the partner site alias for the reference to the partner site in response to receiving the partner site alias from the client and augment the address of the client with an address alias. The address alias is sent to the partner site. A partner action and the address alias are received from the partner site. The address is exchanged for the address alias. The partner action is delivered to the client utilizing the address. These operations are monitored to identify client activity that constitutes a security threat at the host computer or the partner site.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="223.94mm" wi="177.29mm" file="US08627479-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="223.69mm" wi="176.19mm" file="US08627479-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="224.96mm" wi="184.57mm" file="US08627479-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="224.28mm" wi="121.16mm" file="US08627479-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="198.04mm" wi="159.60mm" file="US08627479-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="224.28mm" wi="158.24mm" file="US08627479-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="211.50mm" wi="185.17mm" file="US08627479-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="196.09mm" wi="173.65mm" file="US08627479-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="208.87mm" wi="174.33mm" file="US08627479-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="179.41mm" wi="101.85mm" file="US08627479-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="215.98mm" wi="181.36mm" file="US08627479-20140107-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="231.31mm" wi="175.60mm" file="US08627479-20140107-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="212.09mm" wi="149.35mm" file="US08627479-20140107-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="187.79mm" wi="142.24mm" file="US08627479-20140107-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="226.48mm" wi="180.17mm" file="US08627479-20140107-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="233.93mm" wi="183.90mm" file="US08627479-20140107-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="229.45mm" wi="179.41mm" file="US08627479-20140107-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00017" num="00017">
<img id="EMI-D00017" he="240.96mm" wi="192.87mm" file="US08627479-20140107-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00018" num="00018">
<img id="EMI-D00018" he="228.09mm" wi="142.92mm" file="US08627479-20140107-D00018.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00019" num="00019">
<img id="EMI-D00019" he="228.09mm" wi="159.60mm" file="US08627479-20140107-D00019.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00020" num="00020">
<img id="EMI-D00020" he="227.50mm" wi="173.06mm" file="US08627479-20140107-D00020.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00021" num="00021">
<img id="EMI-D00021" he="202.52mm" wi="165.95mm" file="US08627479-20140107-D00021.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00022" num="00022">
<img id="EMI-D00022" he="195.41mm" wi="142.24mm" file="US08627479-20140107-D00022.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00023" num="00023">
<img id="EMI-D00023" he="191.69mm" wi="149.01mm" file="US08627479-20140107-D00023.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00024" num="00024">
<img id="EMI-D00024" he="193.21mm" wi="149.44mm" file="US08627479-20140107-D00024.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00025" num="00025">
<img id="EMI-D00025" he="237.74mm" wi="176.19mm" file="US08627479-20140107-D00025.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00026" num="00026">
<img id="EMI-D00026" he="92.88mm" wi="97.37mm" file="US08627479-20140107-D00026.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00027" num="00027">
<img id="EMI-D00027" he="215.31mm" wi="123.70mm" file="US08627479-20140107-D00027.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00028" num="00028">
<img id="EMI-D00028" he="181.36mm" wi="117.94mm" file="US08627479-20140107-D00028.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00029" num="00029">
<img id="EMI-D00029" he="229.45mm" wi="167.22mm" file="US08627479-20140107-D00029.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00030" num="00030">
<img id="EMI-D00030" he="237.74mm" wi="179.41mm" file="US08627479-20140107-D00030.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATION</heading>
<p id="p-0002" num="0001">This application claims priority to U.S. Provisional Patent Application 61/339,248, filed Mar. 1, 2010, the contents of which are incorporated herein by reference.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">FIELD OF THE INVENTION</heading>
<p id="p-0003" num="0002">The present invention relates to computer network systems and methods for detecting and defending against attacks on websites, including attacks through third-party websites.</p>
<heading id="h-0003" level="1">BACKGROUND OF THE INVENTION</heading>
<p id="p-0004" num="0003">There are many different entities&#x2014;financial, business, government, charity, educational, individual, etc.&#x2014;that may choose to have online presences implemented by computer systems coupled to a network or computer program code running on systems of other entities that are connected to the network. Since these online systems can be used to provide information, accept and forward information, facilitate transactions, and/or allow access to online resources, those entities have an interest in securing those systems so that authorized activities are allowed while unauthorized activities are prevented. Internet and other online facilities are commonly used for financial, business, private and other transactions preferably kept secure.</p>
<p id="p-0005" num="0004">In a simple example, a bank may choose to provide its customers with online access to banking details and a facility to initiate transactions, such as funds transfers. Some illegitimate actions that unauthorized individuals or computer systems may wish to perform might be expected, such as improperly accessing the banking details, initiating unauthorized transactions, or modifying online resources for their own goals rather than those of the operator of the resources, such as defacing an online presence; stealing money, goods or information; sabotage; or performing other illegitimate actions. Other illegitimate actions might be unexpected.</p>
<p id="p-0006" num="0005">As explained herein, a common approach to providing this online presence is via a &#x201c;website&#x201d;. While users may consider a website a &#x201c;place&#x201d;, it is often a logical place only, in that it is referenced by a URI, while its actual physical location is not important and may indeed be distributed over multiple data centers or even virtual data centers in computing clouds. More precisely, a website is typically the user interface aspects of an entity's network presence.</p>
<p id="p-0007" num="0006">For example, a retailer might set up a server that has thereon software that can receive requests from a network and respond to those requests by returning content, accepting inputs and/or performing some actions in response to requests. Some of that content returned can be in the form of web pages viewable by client devices in response to requests for those web pages from those client devices. Client devices might include computers, telephones, smart handheld devices, other computing devices, etc. These client devices might be used by the retailer's customers, potential customers, visitors, suppliers, or partners.</p>
<p id="p-0008" num="0007">Some web pages are static and pre-generated in advance of a request, such as a page explaining a company's history, while others are dynamic and generated on the fly, such as a web page showing a user's current shopping cart contents or a page generated for a product that a user just requested. Thus, the server might have access to data systems usable for generating web pages and other content (video, music, etc.). The server might comprise multiple machines at different locations on the network, perhaps serving different sets of pages or not. Thus, the term &#x201c;website&#x201d; can refer to the client-side view of a collection of servers, content, operations and the like, while end users might view a website as a collection of pages operated by an entity with a consistent approach that can be viewed in various aspects. As used herein, &#x201c;website&#x201d; might refer to the content, the servers, the operators of the servers, and/or the interaction with client devices, etc., depending on context.</p>
<p id="p-0009" num="0008">As website developers have devised defensive methods to detect and thwart attacks, the attackers have in turn devised ways around those defenses, in a co-evolving cycle of increasing sophistication.</p>
<p id="p-0010" num="0009">Many methods have been devised to steal legitimate users' identities for website abuses. A common method is called &#x201c;phishing&#x201d;, wherein an email sent under the guise of a trustworthy entity elicits personal information from unwitting recipients, typically by luring potential victims to a fraudulent website that requests identifying personal information such as usernames, passwords, account numbers, ATM PINs, etc. This stolen information is then used by impostors, either manually or robotically, to log in to the victims' accounts on the genuine websites in order to steal money, send forged emails, or perpetrate other illicit activity.</p>
<p id="p-0011" num="0010">To combat such impostors, many website operators have developed more-sophisticated access-control methods that require secondary authentication information that simple phishing schemes cannot easily obtain. For example, when a website suspects that an account is being used by a third party, the website may verify that the user is indeed the owner of the account by demanding randomly chosen additional access credentials such as place of birth, mother's maiden name, or the answer to one of a set of questions preselected by the legitimate account-owner.</p>
<p id="p-0012" num="0011">In response to the deployment of secondary authentication techniques, fraudsters have developed what is called a &#x201c;man-in-the-middle attack&#x201d;, in which a phisher lures a victim to a counterfeit website mimicking the appearance and behavior of the target site, on the one hand intercepting the victim's input and relaying it to the real website, while on the other hand intercepting the real website's output and relaying it back to the user through the bogus site. Thus, man-in-the-middle attacks permit fraudsters to gain entry into privileged sites by duping authorized users of the site into responding to all authorization challenges posed by the privileged sites, thus evading all direct authorization protocols. Despite the name &#x201c;man in the middle&#x201d;, the entire process, including any illicit activity perpetrated from within the burgled account, may be performed fully automatically, without the need for human intervention.</p>
<p id="p-0013" num="0012">To combat man-in-the-middle attacks, many websites are programmed to look at structural identifying information, such as the users' Internet Protocol addresses and inferred geographic locations, &#x201c;cookies&#x201d; (site-generated tokens passed back and forth between site and client), user-agent identifiers, and request timestamps&#x2014;information over which the fraudster ordinarily has no direct control. This ancillary information allows a website to detect suspicious users who, despite meeting all explicit authorization challenges, are evidently not using the same browsers on the same computers in the same locations as they usually do, indicating that they may be victims of man-in-the-middle attacks.</p>
<p id="p-0014" num="0013">Now that websites are examining structural session information to distinguish impostors from legitimate users, fraudsters have developed an even more sophisticated method of assault, called a &#x201c;man-in-the-browser attack&#x201d;, using malicious software surreptitiously installed on potential victims' own computers. Many mechanisms have been devised for getting the malware installed, including attachments to phishing emails, downloads from phishing sites, and self-propagating viruses and worms; any of which may be disguised within Trojan horses that apparently or actually perform desirable functions, or may be downloaded afterwards through a back door via a bootstrapping mechanism.</p>
<p id="p-0015" num="0014">This malware, typically in the form of a browser plug-in (hence the name), lurks in the background until it recognizes that the potential victim has successfully signed in to a targeted website, thus eluding all direct authorization protocols. It then uses the victim's own browser on the victim's own computer in accordance with the user's own schedule to perpetrate fraud while the victim is also interacting with the website, thereby also eluding all structural authentication clues. Again, although some implementations provide for real-time human intervention, nevertheless the entire process, including any illicit activity perpetrated from within the hijacked account, may be performed fully automatically, despite the name &#x201c;man&#x201d; in the browser. The malware can elude detection by the user by performing its transactions invisibly, for example in an offscreen window, or, as in a man-in-the-middle attack, by intercepting the communications between the real user and the website, and spoofing the view presented to the user.</p>
<p id="p-0016" num="0015">Since man-in-the-browser attacks, like man-in-the-middle attacks and other phishing attacks, cause substantial harm to websites and to the websites' legitimate users through direct financial and material theft as well as through sabotage, defamation, and other forms of damage, it is crucial for websites to have an effective means for detecting such attacks in order to take remedial actions against them.</p>
<p id="p-0017" num="0016">At present, however, no methods exist for websites to detect man-in-the-browser attacks.</p>
<p id="p-0018" num="0017">Many websites outsource some of their services to third-party websites specializing in those services, such as advertising, news, mapping, searching, indexing, categorization, tagging, ratings, reviews, email, chat, social networking, forums, social games, collaborative editing, questionnaires, polls, media hosting, special deals and promotions, purchasing, bill-paying, banking, wire transfers, and identity verification. Although these third-party services may be tailored, customized, and integrated so as to appear to be offered directly by the primary website, clients using these services are actually diverted to the corresponding partner websites, bypassing the web servers of the primary website. As a result, the host website loses all track of clients while they are dealing with the third parties, leaving it susceptible to attack through a partner website or a combination of partner sites and the host site. The primary website thus has to depend on its partner websites to monitor its clients in its stead. However, the monitoring information provided by third-party services, typically in the form of daily, weekly, or monthly logs or digests, is generally inadequate and untimely. Online criminals have been quick to take advantage of this weakness, so that many websites now incur their greatest losses indirectly, through third-party services, and urgently need an effective means for tracking users across third-party websites in addition to on their own websites.</p>
<heading id="h-0004" level="1">SUMMARY OF THE INVENTION</heading>
<p id="p-0019" num="0018">A computer readable storage medium with instructions executable on a host computer. The instructions record a relationship between a partner site and the host computer, substitute a reference to the partner site with a partner site alias referencing the host computer, deliver the partner site alias to a client, replace the partner site alias for the reference to the partner site in response to receiving the partner site alias from the client and augment the address of the client with an address alias. The address alias is sent to the partner site. A partner action and the address alias are received from the partner site. The address is exchanged for the address alias. The partner action is delivered to the client utilizing the address. These operations are monitored to identify client activity that constitutes a security threat at the host computer or the partner site.</p>
<p id="p-0020" num="0019">The following detailed description together with the accompanying drawings will provide a better understanding of the nature and advantages of the present invention.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0005" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 1</figref> is a top-level information-flow diagram of a rearguard network-service threat detection system according to aspects of the present invention.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 2</figref> is a top-level information-flow diagram of a vanguard network-service threat detection system according to aspects of the present invention.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 3</figref> is a high-level information-flow diagram of the network-service threat detector in <figref idref="DRAWINGS">FIG. 1</figref> or <figref idref="DRAWINGS">FIG. 2</figref>.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 4</figref> is an information-flow diagram of the website analyzer in <figref idref="DRAWINGS">FIG. 3</figref>.</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 5</figref> is an information-flow diagram of the session reconstructor in <figref idref="DRAWINGS">FIG. 3</figref>.</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 6</figref> is an information-flow diagram of the service &#x26; server timing modeler in <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 7</figref> is an information-flow diagram of the service-date comparator in <figref idref="DRAWINGS">FIG. 6</figref>.</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIG. 8</figref> is an information-flow diagram of the server synchronizer in <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 9</figref> is an information-flow diagram of the session segregator in <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 10</figref> is an information-flow diagram of the agent modeler in <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 11</figref> is an information-flow diagram of the client timing modeler for <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIG. 12</figref> is an information-flow diagram of the service-date comparator for <figref idref="DRAWINGS">FIG. 11</figref>.</p>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 13</figref> is an information-flow diagram of the client synchronizer in <figref idref="DRAWINGS">FIG. 5</figref>.</p>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIG. 14</figref> is an information-flow diagram of the click-date estimator in <figref idref="DRAWINGS">FIG. 13</figref>.</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 15</figref> is an information-flow diagram of the load-date estimator in <figref idref="DRAWINGS">FIG. 13</figref>.</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 16</figref> is an information-flow diagram of the session analyzer in <figref idref="DRAWINGS">FIG. 3</figref>.</p>
<p id="p-0037" num="0036"><figref idref="DRAWINGS">FIG. 17</figref> is an information-flow diagram of an event modeler for <figref idref="DRAWINGS">FIG. 3</figref>.</p>
<p id="p-0038" num="0037"><figref idref="DRAWINGS">FIG. 18</figref> is an information-flow diagram of an independent-event session comparator for <figref idref="DRAWINGS">FIG. 3</figref>.</p>
<p id="p-0039" num="0038"><figref idref="DRAWINGS">FIG. 19</figref> is an information-flow diagram of the privilege threat analyzer in <figref idref="DRAWINGS">FIG. 18</figref>.</p>
<p id="p-0040" num="0039"><figref idref="DRAWINGS">FIG. 20</figref> is an information-flow diagram of the event comparator in <figref idref="DRAWINGS">FIG. 18</figref>.</p>
<p id="p-0041" num="0040"><figref idref="DRAWINGS">FIG. 21</figref> is an information-flow diagram of an atomic event frequency predictor for <figref idref="DRAWINGS">FIG. 20</figref>.</p>
<p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. 22</figref> is an information-flow diagram of a biased event frequency predictor TxAB for <figref idref="DRAWINGS">FIG. 20</figref>.</p>
<p id="p-0043" num="0042"><figref idref="DRAWINGS">FIG. 23</figref> is an information-flow diagram of a biased event frequency predictor BxTA for <figref idref="DRAWINGS">FIG. 20</figref>.</p>
<p id="p-0044" num="0043"><figref idref="DRAWINGS">FIG. 24</figref> is an information-flow diagram of a biased event frequency predictor AxTB for <figref idref="DRAWINGS">FIG. 20</figref>.</p>
<p id="p-0045" num="0044"><figref idref="DRAWINGS">FIG. 25</figref> is an information-flow diagram of a combined event frequency predictor for <figref idref="DRAWINGS">FIG. 20</figref>.</p>
<p id="p-0046" num="0045"><figref idref="DRAWINGS">FIG. 26</figref> is an information-flow diagram of the prediction combiner in <figref idref="DRAWINGS">FIG. 20</figref>.</p>
<p id="p-0047" num="0046"><figref idref="DRAWINGS">FIG. 27</figref> is an information-flow diagram of the event frequency scorer in <figref idref="DRAWINGS">FIG. 20</figref>.</p>
<p id="p-0048" num="0047"><figref idref="DRAWINGS">FIG. 28</figref> is an information-flow diagram of the event duration scorer in <figref idref="DRAWINGS">FIG. 20</figref>.</p>
<p id="p-0049" num="0048"><figref idref="DRAWINGS">FIG. 29</figref> is a block diagram of the server traffic processor in <figref idref="DRAWINGS">FIG. 2</figref>.</p>
<p id="p-0050" num="0049"><figref idref="DRAWINGS">FIG. 30</figref> is an information-flow diagram of the partner channeler in <figref idref="DRAWINGS">FIG. 29</figref>.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<p id="p-0051" num="0050">Individual elements of the embodiments are numbered consistently across these figures.</p>
<heading id="h-0006" level="1">DETAILED DESCRIPTION OF THE INVENTION</heading>
<p id="p-0052" num="0051">This description presents a system and method for determining when there is a man-in-the-browser attack on a website among other things. In an exemplary embodiment of the invention, man-in-the-browser attacks on a website are detected by comparing the current user's session with the average user session.</p>
<p id="p-0053" num="0052">The inventive system operates upon an incoming stream of input data generated by actions on a website. Example actions on a website typically correspond to hyperlink clicks by the user of the website. These clicks can be performed by a human or by an automated computer program. Automated computer programs can work by simulating website clicks or by working through the application programming interface of the website.</p>
<p id="p-0054" num="0053">Examples of actions taken on a website include entering data into forms on the website, and clicks to go to other pages of the website. Examples of entering data into forms on a website include entering a user name and password on a website to sign in to the website; filling out an email form to send email to another user of the website; and entering personal information to register for an account on the website.</p>
<p id="p-0055" num="0054">As described in further detail below, each website action can comprise multiple parameters as defined by information corresponding to the action on the website that can be seen by the processors and computers related to a webserver, a firewall, or other device that processes website traffic and additional information provided by the website or third parties. Examples of parameters associated with website actions include IP addresses, including those of proxies used in the process of sending traffic to the website, browser header information, operating system information, information about other programs installed on the user's machine, information about the clock and other settings on the user's machine, cookies, referring URLs, usernames, parameters associated with a post to the website, and other information associated with the user's action on the website.</p>
<p id="p-0056" num="0055">Several aspects of the current user session are compared with the average user session to detect man-in-the-browser attacks using a prestored data set representing the average parameter values across all user sessions during the data-collection period. This is compared to the average time between clicks for an average session. Next, the order in which website pages are viewed in the current session is compared with the order in which website pages are viewed in an average session for each page that is accessed. Finally, the time between clicks for each individual page in the user's session is compared to the average time between clicks for the average user session for that page. Additional tests might be used instead of, or as well as, those cited above.</p>
<p id="p-0057" num="0056">The above comparisons are combined to generate a score that indicates the likelihood that the current session is a man-in-the-browser attack. The score is used to determine whether or not an alert should be generated to notify the appropriate parties, including the website administrator, the website alert processing system, and other associated website parties.</p>
<p id="p-0058" num="0057">Top-level information-flow diagram <figref idref="DRAWINGS">FIG. 1</figref> illustrates one way that the invention disclosed herein may be integrated with the data center or data centers <b>1030</b> employed by a network service <b>1015</b>: as a rearguard threat detection system <b>1000</b>.</p>
<p id="p-0059" num="0058">A service data center <b>1030</b>, the system which operates a website or other network service, may be configured in a number of different ways, depending largely on the size of the business: for example as a single virtual server shared with other services, a dedicated physical server, all or part of a server farm, or a virtual server farm in a computing cloud. A service data center receives client actions <b>1020</b> from clients <b>1010</b> of the service, who in turn receive service actions <b>1040</b> such as webpages, webpage updates, email messages, text messages, telephone calls, or other information back from the service data centers. Typical client actions <b>1020</b> correspond to hyperlink clicks or other interactions with a website such as entering form data or uploading images or other resources by clients <b>1010</b> of the website, who can be human or computer automata. Automated computer programs can work by simulating website clicks, by using the service's application programming interface, if any, or by using some other protocol.</p>
<p id="p-0060" num="0059">For each client action and service action, the responding service data center <b>1030</b> relays a raw transaction record <b>1050</b> to threat detector <b>1060</b>. A transaction record describes the parameters of the transaction between the client and the server, containing parameters of corresponding client action <b>1020</b> and server response <b>1040</b> needed for threat detection. In their rawest form, these transaction records can be simply copies of the low-level packets or datagrams for all network traffic between the exposed data centers and the website's clients, which the network service threat detector independently reassembles into complete transaction records.</p>
<p id="p-0061" num="0060">The network-service threat detector <b>1060</b> and other components may likewise be located onsite, offsite, or in a cloud computing center. In the preferred embodiment, the entire network-service threat detection system <b>1000</b> is collocated with service data center <b>1030</b> to facilitate security and real-time response. Very large Internet businesses employ multiple geographically dispersed data centers <b>1030</b>, in which case a single threat detection system <b>1000</b> may serve one or multiple data centers.</p>
<p id="p-0062" num="0061">Network-service threat detector <b>1060</b> analyzes logged transactions <b>1050</b> for suspicious behavior characteristic of man-in-the-browser (&#x201c;MiB&#x201d;) attacks and other types of attacks, and issues threat notifications <b>1070</b> accordingly to service threat processors <b>1080</b>, including the service administrator, the service's alert processing system, and other associated service parties, as appropriate. If the service is not configured to provide all the transaction information needed by the detector in the stream of raw transaction records <b>1050</b> pushed to the detector, then the detector may issue requests <b>1100</b> to pull additional information <b>1120</b> as needed from the client-facing data centers <b>1030</b> or from internal service data centers <b>1110</b>, which are installed at some services where they are shielded from the Internet for reasons of security or efficiency. Additionally, for services that can make other use of information produced by the detector, the detector may send information <b>1140</b> to the service data centers <b>1030</b> or <b>1110</b>, either unsolicited or in response to requests <b>1130</b> from the detector <b>1060</b>. Network-service threat detector <b>1060</b> is described in more detail under <figref idref="DRAWINGS">FIG. 3</figref>.</p>
<p id="p-0063" num="0062">Threat processors <b>1080</b> review threat notifications <b>1070</b>, possibly in conjunction with additional information provided by other tools (not shown), and issue corresponding remedial actions <b>1090</b> to client-facing data centers <b>1030</b>.</p>
<p id="p-0064" num="0063">Remedial actions <b>1090</b> may also be fed back to the threat detector <b>1060</b>, permitting the detector to respond on its own to subsequent matching threats, without incurring the delay entailed by encumbering the threat processors. Threat remediations <b>1090</b> include immediately thwarting hijacked clients from accessing the service as a whole or sensitive portions thereof, by blocking them, delaying them, diverting them to harmless webpages, or spoofing sensitive information; warning the victims that their systems have been infected, either through independent channels such as telephone or paper mail, or through changes to account information that would go unrecognized by the hijackers but compel the victims to contact the business through other channels such as by telephone; reversing or blocking the fraudulent transactions; monitoring and tracking the compromised accounts; and forwarding incriminating evidence to the appropriate authorities for further investigation and prosecution, or other actions.</p>
<p id="p-0065" num="0064">If a website incorporates services of third-party websites into its own services, then some of its service actions <b>1040</b> contain referrals to the partner websites <b>1150</b>. When a client acts on a referral, such as by clicking on a hyperlink in an iframe sourced from a partner website, then the client's action <b>1160</b> is ordinarily diverted (dashed arrow) directly to the partner website, and the partner website's response <b>1170</b> is sent directly back to the client (dashed arrow), bypassing the primary website. The host website is thus unable to monitor the transactions between the client and the partner sites, and is thus unable to detect fraud or other illicit activity perpetrated through the partner websites.</p>
<p id="p-0066" num="0065">The present invention enables the primary website to monitor client-partner traffic by including a novel partner channeler which intercepts the traffic between the primary website and its clients, and edits the outgoing service actions <b>1040</b> to entrain the client-partner traffic through the partner channeler by replacing partner referrals with partner aliases referring back to the host website. When a client acts on an edited referral, the corresponding client action <b>1020</b>, instead of being diverted to the partner, comes back to the primary website, where the partner channeler intercepts it, replaces the client address with an alias at the host website to entrain the partner-client traffic back to the channeler, replaces the partner alias with the original partner referral, and passes the entrained client action <b>1180</b> on to the partner website <b>1150</b>. When the partner website responds to the entrained client action, the corresponding entrained partner action <b>1190</b> likewise comes back to the primary website, where the channeler intercepts it, replaces the client alias with the original client address, and again replaces partner referrals with partner aliases referring back to the host website, finally sending the entrained partner action on to the client under the guise of an ordinary service action <b>1040</b>.</p>
<p id="p-0067" num="0066">In a rearguard threat-detector deployment, the channeler is installed in the host website's data center(s). In the preferred embodiment, the channeler is installed in the exposed data center(s) <b>1030</b> where it can intercept all traffic between host, partners, and clients, with minimal disruption of the existing website architecture, and without burdening the interior data centers <b>1110</b> with partner traffic. The partner channeler is discussed further under <figref idref="DRAWINGS">FIG. 29</figref> and <figref idref="DRAWINGS">FIG. 30</figref>.</p>
<p id="p-0068" num="0067">In the preferred embodiment, rearguard network-service threat detection system <b>1000</b> is capable of detecting and remedying attacks on a service in substantially real time.</p>
<p id="p-0069" num="0068">Top-level information-flow diagram <figref idref="DRAWINGS">FIG. 2</figref> illustrates an alternate way to integrate with a service's data center(s): as a vanguard network-service threat detection system <b>2000</b>.</p>
<p id="p-0070" num="0069">In this configuration, service traffic processor <b>2010</b> is introduced as a proxy to intercept client actions <b>1020</b> in order to output transaction records <b>1050</b> to threat detector <b>1060</b>; and to intercept normal website actions <b>2030</b> output by website data centers <b>1030</b> in order to substitute remedial actions <b>1090</b> provided by the threat detector <b>1060</b> or website threat processors <b>1080</b>, as appropriate. As with the other components, website traffic processor may be onsite, offsite, or in a cloud computing center. For generating transaction records, website traffic processor <b>2010</b> has direct access to all the information in the HTTP request headers from client actions <b>1020</b> and in the HTTP response headers from the website actions <b>2030</b> or <b>1090</b>. It also has access, through its own clock, to the exact times that the client actions were received and the website actions <b>1040</b> were transmitted, which it inserts in the transaction records, thus obviating the need for server synchronization during session reconstruction (See <figref idref="DRAWINGS">FIG. 5</figref>) other than for conciliation with information exchanged internally with website data centers <b>1030</b> and <b>1110</b> through service responses <b>1120</b> to detector requests <b>1100</b> and detector responses <b>1140</b> to service requests <b>1130</b>.</p>
<p id="p-0071" num="0070">In the preferred embodiment of the vanguard threat detection system, to avoid superfluous generation of normal website actions <b>2030</b> replaced by remedial actions <b>1090</b>, exposed data centers <b>1030</b> receive client actions <b>1020</b> only as filtered client actions <b>2020</b> from website traffic processor <b>2010</b>, which either withholds remediated client actions from the website data centers, or flags them as remediated before passing them on to the data centers to log without responding.</p>
<p id="p-0072" num="0071">In an alternative embodiment, for example if the website needs to log all client actions accurately but is not set up to refrain from responding to remediated client actions, client actions <b>1020</b> are either passed through website traffic processor <b>2010</b> unfiltered, or copied directly (dashed arrow) to the website data centers, to be filtered by the website traffic processor only on output <b>2030</b>.</p>
<p id="p-0073" num="0072">In another alternative embodiment, if it is more convenient for certain actions or other information to be communicated internally, particularly if the vanguard threat detector is collocated with the data centers, threat detector <b>1060</b> may request <b>1100</b> information <b>1120</b> directly from isolated <b>1110</b> or exposed <b>1030</b> website data centers, or provide <b>1130</b> information directly to the data centers.</p>
<p id="p-0074" num="0073">In a vanguard deployment, in the preferred embodiment, the partner channeler is incorporated into server traffic processor <b>2010</b> where it can intercept all traffic between host, clients, and partners, without burdening the host data centers with partner traffic.</p>
<p id="p-0075" num="0074">A vanguard threat detection configuration <b>2000</b> is preferable for websites that are not designed to produce the real-time transaction parameter records <b>1050</b> needed by the threat detector; that are not designed to implement the remedial actions <b>1090</b> desired to deal with threats in real time; or that prefer to have the threat detection and remediation handled offsite before offensive client actions have a chance to reach the website. Vanguard threat detection also offers the advantages of more-accurate and more-precise timestamps and tighter bounds on client response time estimates, as explained under <figref idref="DRAWINGS">FIG. 6</figref>.</p>
<p id="p-0076" num="0075">In the preferred embodiment, threat detection system <b>2000</b> is capable of detecting and remedying attacks on a website in substantially real time.</p>
<p id="p-0077" num="0076">As depicted in high-level information-flow diagram <figref idref="DRAWINGS">FIG. 3</figref>, network-service threat detector <b>1060</b> inputs raw transaction parameter records <b>1050</b> streaming in from the website data center(s), applies a number of processing steps, and outputs threat notification alerts <b>1070</b> to website threat processors.</p>
<p id="p-0078" num="0077">In the first detection step, if the input transaction records <b>1050</b> do not contain all the transaction information needed by the threat detector, as is often the case for rearguard detection systems <b>1000</b> (See <figref idref="DRAWINGS">FIG. 1</figref>), then record augmenter <b>3010</b> obtains as much of the missing information as possible <b>1120</b> by querying <b>1100</b> the data center(s), outputting augmented transaction records <b>3020</b>.</p>
<p id="p-0079" num="0078">Next, the augmented transaction records <b>3020</b> are analyzed by session reconstructor <b>3030</b> to separate them into individual client sessions <b>3040</b>, as further described under <figref idref="DRAWINGS">FIG. 5</figref>. The session reconstructor may be assisted in its analysis by use of a website map <b>3110</b> generated and maintained by website analyzer <b>3100</b>, as further described under <figref idref="DRAWINGS">FIG. 4</figref>.</p>
<p id="p-0080" num="0079">Session analyzer <b>3050</b> then analyzes the client sessions for features characteristic of MiB attacks or similar website attacks, and for each input session can output a record of session threat parameters <b>3060</b>, as further described under <figref idref="DRAWINGS">FIG. 11</figref>. The session analyzer may also make use of information from the website map.</p>
<p id="p-0081" num="0080">Next, session comparator <b>3070</b> compares each current session-parameters record <b>3060</b> against a set of session models <b>3130</b> derived by session modeler <b>3120</b> from aggregate current and prior session-parameters records, and for each current client session outputs a threat-score record <b>3080</b>. The session modeler may use the website map in its analysis. The session comparator is described further in connection with <figref idref="DRAWINGS">FIG. 18</figref>, and the session modeler in connection with <figref idref="DRAWINGS">FIG. 17</figref>.</p>
<p id="p-0082" num="0081">Finally, for each client session, threat remediator <b>3090</b> analyzes the threat score record <b>3080</b> and, as warranted, outputs threat notification <b>1070</b> for further analysis and remediation by website threat processors <b>1080</b> (See <figref idref="DRAWINGS">FIG. 1</figref>). If directed to do so, the threat remediator may also output remedial action <b>1090</b> to client-facing website data center <b>1030</b> (See <figref idref="DRAWINGS">FIG. 1</figref>) or to website traffic processor <b>2010</b> (See <figref idref="DRAWINGS">FIG. 2</figref>).</p>
<p id="p-0083" num="0082">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 4</figref>, website analyzer <b>3100</b> for use in network-service threat detector <b>1060</b> (See <figref idref="DRAWINGS">FIG. 3</figref>) analyzes the logical structure of the website and outputs website map <b>3110</b> detailing the intrinsic linkages <b>4100</b> among the webpages, as well as the intrinsic access level <b>4140</b>, intrinsic privilege level <b>4120</b>, and intrinsic security level <b>4080</b> of each region of the website. Website spider <b>4010</b> assembles a complete list of all pages and other services <b>4030</b> provided by the website and of all internal hyperlinks <b>4040</b> among the pages and other media of the website, by examining intrinsic hyperlinks on various pages, and following each link that leads to a new target, thus building up the lists of services and links as it goes.</p>
<p id="p-0084" num="0083">Like ordinary website spiders of prior art, website spider <b>4010</b> is launched at the website root and traverses the website by issuing client actions <b>4020</b>&#x2014;via simulated website clicks or, if available, the website's application programming interface&#x2014;to the client-facing website <b>1030</b>, and analyzing website action responses <b>1040</b> for all traceable links. In case the website contains disjoint regions or regions not directly reachable by external spidering, the spider is also launched at unlisted services appearing in the Request URLs and Referrer URLs in client sessions <b>3040</b>. In addition, links untraceable by external spidering, such as deliberately disguised CGI POST methods, website spider <b>4010</b> traces in parallel internally via transaction records <b>1050</b>. Where possible, website spider <b>4010</b> also traverses the website by accessing the services and links directly through database queries <b>1100</b> to website data center <b>1110</b> or <b>1030</b>.</p>
<p id="p-0085" num="0084">To distinguish the uniform resource locators (URLs) of genuinely new services from merely synonymous URLs of known services, the URL resolver (not shown) employed by website spider <b>4010</b> and change detector <b>4050</b> is augmented to resolve not only the URLs supplied and received by external spidering from client actions <b>4020</b> and website actions <b>1040</b>, respectively, but also the URLs and equivalent identifiers provided by the website data centers in the responses <b>1120</b> to database queries <b>1100</b> and in the transaction records <b>1050</b> in the client session records <b>3040</b>. To resolve URL aliases, spider <b>4010</b> not only compares service contents as in prior-art spiders, but first correlates URLs presented externally in website actions <b>1040</b> with internal URIs given in transaction records <b>1060</b>, synchronizing the two by, for example, including a sequence number in the User-Agent field of its requests.</p>
<p id="p-0086" num="0085">Change detector <b>4050</b> monitors client sessions <b>3040</b> for the appearance of new services not in the list of website services <b>4030</b>, as well as periodically checking for changes to already listed services, and issues update orders <b>4060</b> to the website spider accordingly.</p>
<p id="p-0087" num="0086">Security classifier <b>4070</b> examines each web service <b>4030</b>, and outputs security level <b>4080</b> classifying the service according to whether its contents are ever transmitted as plaintext, or always transmitted in encrypted form via a secure protocol such as TLS or SSL, as recognizable by the &#x201c;https://&#x201d; secure protocol name in the services' URLs, as opposed to &#x201c;http://&#x201d;, or by the HTTP Upgrade header.</p>
<p id="p-0088" num="0087">Linkage mapper <b>4090</b> compiles the lists of services <b>4030</b> and links <b>4040</b> into a coherent map <b>4100</b> of the website's intrinsic linkage structure.</p>
<p id="p-0089" num="0088">Privilege classifier <b>4110</b> examines website links <b>4040</b> for checkpoints requiring passwords or higher levels of authentication, and uses this information to partition linkage map <b>4100</b> into regions according to the echelon of privilege <b>4120</b> required to access the services <b>4030</b> within each region.</p>
<p id="p-0090" num="0089">Access classifier <b>4130</b> examines each web service and assigns it an access level <b>4140</b>, ranging from an innocuous static &#x201c;wall&#x201d; providing no access to personal or proprietary information; through an unsafe &#x201c;window&#x201d; permitting inherently risky transactions that a malicious agent could exploit to indirectly damage the interests of the client or the site's owner, such as viewing personal or proprietary information and using it else when or elsewhere; to a dangerous &#x201c;door&#x201d; permitting inherently dangerous transactions that a malicious agent could exploit to directly damage the interests of the client or the site's owner, such as removing or transferring goods or money; creating, deleting, or changing information such as account ownership or shipping addresses; and in general effecting changes on the webserver or elsewhere outside the client's browser. Windows are typically indicated by HTTP GET and HEAD methods, while doors are typically indicated by HTTP POST, PUT, and DELETE methods.</p>
<p id="p-0091" num="0090">Website mapper <b>4150</b> compiles website linkage map <b>4100</b>, access level data <b>4140</b>, privilege level data <b>4120</b>, and security level data <b>4080</b> into a single integrated website directed-graph map <b>3110</b> for use by session reconstructor <b>3030</b> and session modeler <b>3120</b> (See <figref idref="DRAWINGS">FIG. 3</figref>) to determine whether an observed transition coincides with an intrinsic website link; by session comparator <b>3070</b> (<figref idref="DRAWINGS">FIG. 3</figref>) to weight session threat scores according to intrinsic threat values of the services and transitions involved; and by website threat processors <b>1080</b> and other website personnel to visualize and explore the threat terrain of their website; and by the website developers to improve the intrinsic security of their website.</p>
<p id="p-0092" num="0091">The website map includes a service index and a link index for quick random access by service and link.</p>
<p id="p-0093" num="0092">Website map <b>3110</b> is also intended for use by other operations personnel, for example to determine whether all current regions of the website are properly connected, and whether abandoned or experimental regions are properly disconnected; for development research, for example to determine whether certain common pathways should be replaced with more-efficient ones, and whether certain uncommon ones should be removed; and for marketing research, for example to explore how various services can be accessed or promoted.</p>
<p id="p-0094" num="0093">Conflict analyzer <b>4160</b> uses website map <b>3110</b> to analyze the structural integrity of the website, and outputs conflict warnings <b>4170</b> for any structural security flaws in the website, ranked by priority, in order to thwart certain types of threats of which the website security personnel are presumably not yet aware and which fraudsters may already be exploiting. In particular, private information should never be sent in the clear, and risky actions should never be accessible to clients without the requisite clearance, so services containing windows and especially doors should be both privileged and secure. The conflict analyzer can also issue warnings <b>4170</b> for broken links, as well as for orphaned regions of the website, whose unmaintained status may pose security risks.</p>
<p id="p-0095" num="0094">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 5</figref>, session reconstructor <b>3030</b>, for use in network-service threat detector <b>1060</b> (See <figref idref="DRAWINGS">FIG. 3</figref>), compiles the augmented transaction records <b>3020</b> from the website data center(s) into synchronized individual client sessions <b>3040</b> by synchronizing and sorting the records and segregating them into sessions.</p>
<p id="p-0096" num="0095">The transaction synchronization phases, comprising service timing and server timing modeling <b>5010</b>, server synchronization <b>5040</b>, agent timing modeling <b>5110</b>, client timing modeling <b>5130</b>, and client synchronization <b>5150</b>, serve to bound as accurately and tightly as possibly the client response delay: the interval from the instant the client received and was able to respond to website action <b>1040</b> (See <figref idref="DRAWINGS">FIG. 1</figref>), to the instant the client responded by issuing client action <b>1020</b>. Only by knowing the precise client response delay can anomalous client response delays be accurately detected.</p>
<p id="p-0097" num="0096">Transaction records typically provide two sets of timestamps: server timestamps and client timestamps, which for HTTP services are respectively supplied in the HTTP Response Date headers of the website actions <b>1040</b> and in the HTTP Request Date headers of the client actions <b>1020</b>. These timestamps by themselves, even if both the request timestamps and the response timestamps were reliably present and accurate, are fundamentally inadequate for fixing the client response interval, because neither the response nor the request is instantaneous in its production, transmission, reception, and interpretation. Although websites concerned about security can be presumed to provide some sort of response timestamps, the client request timestamps are only optionally present. Moreover, many websites do not properly synchronize the clocks among their servers; the phase of the response marked by the server's response timestamp is undefined; and some provide a timestamp indicating when the transaction was logged in place of the server response time.</p>
<p id="p-0098" num="0097">Clients' clocks are likewise often inaccurate, and are in fact intentionally misadjusted by users to help disguise their locations, including by some benign users for privacy; and request timestamps, when present, may be deliberately forged by MiB malware and other attackers to help evade detection. Thus, it is useful to have an accurate estimation of the client response interval from statistical information and models about the timing characteristics of the servers, services, clients, and agents.</p>
<p id="p-0099" num="0098">In a vanguard deployment, the service traffic processor <b>2010</b> (See <figref idref="DRAWINGS">FIG. 2</figref>) records the times when it begins and finishes relaying each service request from each client to the website servers and the times when it begins and finishes relaying each corresponding response from the server back to the client, and can thus accurately estimate the client response interval for each transaction from transaction-specific timing information. In a rearguard deployment, however, the session reconstructor estimates the client response interval from more general statistics.</p>
<p id="p-0100" num="0099">For website operators willing to modify their websites or have their websites modified, a client-side timing mechanism can be embedded in the website's services, which explicitly measures the time interval between service receipt and user response, and reports that time interval back directly to the website. For HTML pages, for example, the timer can be implemented as a Javascript Date( ) object created on load and set to the load date, and then, when a hyperlink on the page is clicked, either the load time or the elapsed time since loading is appended to the target URL or to the payload of the HTTP request.</p>
<p id="p-0101" num="0100">In a vanguard deployment, with permission, the service traffic processor embeds this mechanism in the website services on the fly. Otherwise, having the website developers add this mechanism in a normal development cycle may take many months. In any case, since client-side timing information can be spoofed by an MiB attacker and other attackers, the session reconstructor still should corroborate it with independently derived server-side information.</p>
<p id="p-0102" num="0101">In the first session-reconstruction step, server synchronizer <b>5040</b> corrects for discrepant clock settings among active servers at the website during the data-collection period and compensates for the indeterminacy of the phase of service represented by the servers' date timestamps recorded in input transaction records <b>3020</b>, in order to accurately estimate the server's receive date, send date, and sent date for each input transaction record, augmenting the transaction record with these dates to output corresponding server-synchronized output transaction record <b>5050</b>. The server synchronizer bases the server clock correction and phase compensation on service-specific timing models <b>5020</b> and server-specific service timing models <b>5030</b> generated and maintained by service-timing and server-timing modeler <b>5010</b> for each service and each server, respectively, appearing in the input transaction records. The server modeler is described in greater detail under <figref idref="DRAWINGS">FIG. 6</figref>, and the server synchronizer under <figref idref="DRAWINGS">FIG. 8</figref>.</p>
<p id="p-0103" num="0102">Next, transaction sorter <b>5060</b> sorts all the synchronized transaction records <b>5050</b> from the data-collection period in chronological order, either by synchronized receive date, send date, or sent date, outputting sorted transaction records <b>5070</b>. In the preferred embodiment, the transaction records are sorted by the synchronized receive date, which tends to have the least variance of these three date estimates.</p>
<p id="p-0104" num="0103">Session segregator <b>5080</b> teases apart the sorted transaction records <b>5070</b> into records belonging to individual clients, on the basis of such identifying characteristics as the account number, cookie, authentication, URL session ID, email address, and IP address, outputting each individual client's set of sorted transaction records as an individual client session <b>5100</b>. The session segregator is discussed at length under <figref idref="DRAWINGS">FIG. 9</figref>.</p>
<p id="p-0105" num="0104">Finally, client synchronizer <b>5150</b> corrects for errant clock settings among all active clients using the website during the data-collection period, compensates for the indeterminacy of the phase of request represented by the user agents' date timestamps recorded in the input transaction records, adjusts for transmission time between each client and server in each direction, and adjusts for the user-agents' service load time, in order to accurately estimate the client's load date and click date, augmenting the transaction records in client sessions <b>5100</b> with these dates to output corresponding client-synchronized output transaction records in synchronized client sessions <b>3040</b>. The client synchronizer bases the client clock correction, phase compensation, transmission delays, and load time on client-specific client-timing models <b>5140</b> generated and maintained by client timing modeler <b>5130</b>, by agent-specific agent-timing models generated and maintained by agent timing modeler <b>5110</b>, as well as on server models <b>5030</b> and service models <b>5020</b>. The agent modeler is described further under <figref idref="DRAWINGS">FIG. 10</figref>. The client modeler is detailed under <figref idref="DRAWINGS">FIG. 11</figref>.</p>
<p id="p-0106" num="0105">At many websites, the accuracy of the timestamps is untrustworthy because each transaction may be received and transmitted by a different server, and the servers may not be properly synchronized, so that their clocks and hence their timestamps disagree significantly and gradually drift apart. This problem may be especially pronounced when different transactions within the same client session may even be served by data centers geographically distant from one another.</p>
<p id="p-0107" num="0106">A further error, typically constant across all servers particular to a website, is due to the indeterminacy of the server phase denoted by a server timestamp: Many web services take a substantial interval of time to assemble and transmit, and the timestamp could refer to any instant during that interval. In fact, the precise meaning of the Date header in the server response is even officially undefined&#x2014;although the HTTP specification recommends that the date represent the moment just before the entity is generated, it allows for the date to be generated at any time during the message origination.</p>
<p id="p-0108" num="0107">Therefore, depending on the website, the timestamp may denote when the server received and enqueued the HTTP request, when it dequeued the request and began serving the service, when it finished serving the service, when it recorded the received or fulfilled request in a database, or anything in between.</p>
<p id="p-0109" num="0108">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 6</figref>, service-timing and server-timing modeler <b>5010</b>, for use in session reconstructor <b>3030</b> (See <figref idref="DRAWINGS">FIG. 5</figref>), estimates and tracks the service timing characteristics <b>5020</b> for each service <b>6020</b> provided by the website during the data-collection period, and the server timing characteristics <b>5030</b> for each client-facing server <b>6140</b> in use at the website during the data-collection period, by using service- and server-delay modeler <b>6030</b> to measure and model the server's service delay statistics <b>6040</b> and server delay statistics <b>6050</b> for each service provided by that server during the data-collection period; using echo modeler <b>6060</b> to measure and model the server's echo delay statics <b>6070</b>; using service-delay comparator <b>6080</b> to compare the service-delay and echo-delay models; and using the server-delay comparator <b>6090</b> to compare the server-delay and echo-delay models.</p>
<p id="p-0110" num="0109">Service-and-server modeler <b>5010</b> inputs transaction records <b>3020</b> during the data-collection period and extracts the server identifier <b>6010</b> to obtain a list of all exposed servers active during the data-collection period, which it provides to service- and server-modeler <b>6030</b> and echo modeler <b>6060</b>; and extracts the service identifier <b>6020</b> to obtain a list of all services provided by each server during the data-collection period, which it provides to the service- and server-modeler. For the current Internet addressing schemes, the server identifier consists of the server's IPv6 or IPv4 address and port number in the TCP or UDP packet-header, the port number being necessary for website servers in a private network behind a proxy; and the service identifier consists of the service's URL.</p>
<p id="p-0111" num="0110">During the data-collection period, service- and server-timing modeler <b>6030</b> uses service- and server-timer <b>6120</b> to measure the timing characteristics of each active server <b>6140</b> identified by server identifier <b>6010</b> for each of that server's active services <b>6020</b>, and uses service- and server-date comparator <b>6200</b> to model the statistical distribution of the server's service timing characteristics.</p>
<p id="p-0112" num="0111">Specifically, in a rearguard deployment, for each active server and each of that server's active services, the service- and server-timer sends a statistically significant number of requests <b>6130</b> for that service to that server, and outputs the date timestamp <b>6160</b> specified by the server in the service response <b>6150</b>&#x2014;in the server's Response Date header in the case of HTTP transactions. The moment the service timer sends a service request, it outputs service-request send date timestamp <b>6170</b>; the moment it begins to receive corresponding service response <b>6150</b>, it outputs service-response receive date timestamp <b>6180</b>; and the moment it has finished receiving the service response, it outputs service-response date timestamp <b>6190</b>; each of these times being given by master clock <b>6100</b> as respective current time <b>6110</b>. In a vanguard deployment, instead of issuing a statistically significant number of instances of each service request, the server timer can simply pass the filtered client actions <b>2020</b> to the servers, and receive the corresponding normal service actions <b>2030</b>, thus providing an accurate fix for each actual client transaction without the need for additional samples.</p>
<p id="p-0113" num="0112">Service- and server-date comparator <b>6200</b> models the distribution of the difference between service-receipt date <b>6190</b> and service-send date <b>6170</b> for each service <b>6020</b>, outputting the models as service delay models <b>6040</b>. The service-date comparator also models the distribution of the difference between nominal response date <b>6160</b> and each of service-send date <b>6170</b>, service-receive date <b>6180</b>, and service-receipt date <b>6190</b> for each server <b>6010</b> as a function of the service <b>6020</b>, outputting the models as server delay models <b>6050</b>. The service-date comparator is detailed under <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0114" num="0113">Also during the data-collection period, echo-timing modeler <b>6060</b> uses echo timer <b>6210</b> to measure the null-service timing characteristics of each active server <b>6140</b>, and uses echo date comparator <b>6260</b> to model the statistical distribution of the null-service timing characteristics. Specifically, echo timer <b>6210</b> issues a statistically significant number of echo requests <b>6220</b>, also known as ping requests, to each active website server <b>6140</b>, outputting echo send date timestamp <b>6240</b> the moment it sends the echo request, and outputting echo receipt date timestamp <b>6250</b> the moment it has received the echo response <b>6230</b> back from the server, each timestamp being given by the respective current time <b>6110</b> as specified by master clock <b>6100</b>.</p>
<p id="p-0115" num="0114">For each timed echo, echo date comparator <b>6260</b> calculates the difference between echo receipt time <b>6250</b> and corresponding echo send time <b>6240</b>, and outputs a model of the distribution of the result as echo delay model <b>6070</b>. In the simplest embodiment, the server-specific echo delay model for each direction comprises half the mean roundtrip echo time. The preferred embodiment also takes into account any known speed and bandwidth asymmetries in the transmission rate of the Internet connection on either end, by partitioning the roundtrip echo time into two portions inversely proportional to the throughput in that direction.</p>
<p id="p-0116" num="0115">Finally, for each active service <b>6020</b>, delay comparator <b>6080</b> compares the service roundtrip delay <b>6040</b> with the echo roundtrip delay <b>6070</b>, outputting the difference between the models as intrinsic service duration in service model <b>5020</b>.</p>
<p id="p-0117" num="0116">In an alternative embodiment, the server timing is modeled in terms of service length in bytes, rather than in terms of intrinsic service duration.</p>
<p id="p-0118" num="0117">For each active exposed website server <b>6140</b>, server delay comparator <b>6080</b> also compares the server's service delay distribution <b>6050</b> with the server's echo delay distribution <b>6070</b>, outputting the difference between the models as server timing model <b>5030</b>. In the simplest embodiment, the server timing model comprises three affine functions of the intrinsic service duration, each with an additive bias parameter and a multiplicative rate parameter. Specifically, the server receive function, used by server synchronizer <b>5040</b> to estimate when the server received a service request, is calculated as the difference between the service request delay function and the echo request delay function; the server send function, used to estimate when the server started to send a response, is calculated as the difference between the service send function and the echo send function; and the server sent function, used to estimate when the server finished sending a response, is calculated as the difference between the service sent function and the echo send function.</p>
<p id="p-0119" num="0118">In an alternative embodiment, instead of creating server-independent service-delay models <b>6040</b> separate from server-delay models <b>6050</b>, server service-date comparator <b>6200</b> generates a separate server-delay model for each active service for each active server providing that service. The simplest combined service-and-server-delay model then gives the service-request, service-respond, and service-response delays as constant functions specific to both the service and the server, computed as the observed mean of each respective difference. In this case, service-delay comparator <b>6080</b> and server-delay comparator <b>6090</b> are likewise combined into a single service-and-server-delay comparator that correspondingly outputs a separate timing model for each active service for each active server providing that service.</p>
<p id="p-0120" num="0119">If either the service timer <b>6120</b> or the echo timer <b>6210</b> finds that a server fails to respond or finish responding to a request within a reasonable amount of time, typically within a few seconds or a small multiple of the average response time for that server or that service request, then it excludes that measurement from the statistics and issues a warning <b>6310</b> to website administrators that the server is not responding as quickly as expected.</p>
<p id="p-0121" num="0120">Service timing models <b>5020</b> and server timing models <b>5030</b> are updated by service-delay comparator <b>6080</b> and server-delay comparator <b>6090</b> periodically, frequently enough to track the drift among server clocks, as well as after power outages, daylight-savings-time clock shifts, and other exceptional events that might affect the server clock settings or alter the proxy's port numbers for individual servers. In the preferred embodiment, the server timer updates the server timing models frequently enough to accurately track server congestion. In an alternative embodiment, the service delay models <b>6050</b> and the echo delay models <b>6070</b>, and thereby the server models <b>5030</b>, explicitly take website congestion into account, as thresholded affine functions of the server load.</p>
<p id="p-0122" num="0121">In one embodiment, the service models <b>5020</b> and server models <b>5030</b> and the underlying service delay models <b>6040</b>, server delay models <b>6050</b>, and echo delay models <b>6070</b> are computed in independent batches, for example for successive data-collection intervals such as once per hour for the preceding hour. In the preferred embodiment, these models are continually updated with a sliding window in shorter overlapping increments, even, in the limit, as each new transaction record is collected and as each old transaction ages beyond the time window.</p>
<p id="p-0123" num="0122">In addition to their use for website threat detection, the service timing models <b>5020</b> can be analyzed by service analyzer <b>6270</b> and presented as service summaries <b>6280</b> for operations research, for example to determine whether the resources devoted to particular services or types of services should be adjusted; for development research, for example to determine whether certain services should be replaced with more efficient ones; and for marketing research, for example to determine how various services are being used.</p>
<p id="p-0124" num="0123">Similarly, in addition to their use for website threat detection, the server timing models <b>5030</b> are analyzed by server analyzer <b>6290</b> and presented as server summaries <b>6300</b> for operations research, for example for load-balancing or to determine whether certain servers or types of servers are performing up to expectations.</p>
<p id="p-0125" num="0124">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 7</figref>, the server service-date comparator <b>6200</b>, used by service-and-server modeler <b>5010</b> (See <figref idref="DRAWINGS">FIG. 6</figref>) models the service delay <b>6040</b> using service-delay modeler <b>7010</b>, and models the server delay <b>6050</b> using server-delay modeler <b>7020</b>.</p>
<p id="p-0126" num="0125">For each timed service transaction, the server service-delay modeler calculates the difference <b>7030</b> between the service-receipt date <b>6010</b> and the corresponding service-send date <b>6170</b>, outputting the result as service round-trip delay <b>7040</b>. Roundtrip-delay modeler <b>7050</b> computes a server-independent model of the distribution of this difference for each service <b>6020</b>, outputting the result as service-delay model <b>6040</b>. In the simplest embodiment, the service-delay model comprises a service-specific constant function, computed as the mean round-trip time across all active servers, which is the least-squares best fit value. In the preferred embodiment, the model for each service takes caching into account by decomposing the round-trip data into cached versus uncached distributions, where caching is determined by rerequesting the same service from the same server in quick succession.</p>
<p id="p-0127" num="0126">Similarly, for each timed service transaction, the server-delay modeler <b>7020</b> uses differencer <b>7060</b> to calculate the service-request delay <b>7070</b> as the difference between nominal response date <b>6160</b> and corresponding service-request send date <b>6170</b>; uses differencer <b>7080</b> to calculate the service-respond delay <b>7090</b> as the difference between each service-receive date <b>6190</b> and the corresponding nominal response date; and uses differencer <b>7100</b> to calculate the service-response delay <b>7110</b> as the difference between each service-receipt date <b>6190</b> and the corresponding nominal response date. Service-model fetcher <b>7120</b> then fetches service-duration parameters <b>7130</b> for the service identified by service identifier <b>6020</b> from service models <b>5020</b>.</p>
<p id="p-0128" num="0127">In the simplest embodiment, the service-duration parameters used by the server-delay modeler comprise the mean duration of the service. Finally, request-delay modeler <b>7140</b> models the request delay for each server <b>6010</b> as a function of the service duration, which it outputs as request-delay model <b>7150</b>; respond-delay modeler <b>7160</b> likewise models the respond delay for each server as a function of the service duration, which it outputs as respond-delay model <b>7170</b>; and response-delay modeler <b>7180</b> likewise models the response delay for each server as a function of the service duration, which it outputs as response-delay model <b>7190</b>; these three models comprising the server-delay model <b>6050</b>. In the simplest embodiment, the server-delay modeler models the service-request, service-respond, and service-response delays as server-specific affine functions of the intrinsic service duration, computed by the least-squares best fit, each function specified by an additive bias parameter and a multiplicative rate parameter. In the preferred embodiment, the model for each of the three service-delay components also takes caching into account, by decomposing the observed data for each into two separate affine functions, one for when the service is cached, the other for when it is uncached.</p>
<p id="p-0129" num="0128">In the preferred embodiment, the server-delay modeler and service-delay modeler account for the effect of encryption&#x2014;such as TLS or SSL&#x2014;on service timing implicitly, by considering the encrypted versus encrypted versions as distinct services modeled separately. Ordinarily, this happens automatically as a result of the convention of giving securely encrypted services distinct URLs, such as &#x201c;https: . . . &#x201d; versus &#x201c;http: . . . &#x201d;.</p>
<p id="p-0130" num="0129">Note that, since the bandwidth of the connection between the server timing modeler and the servers for a website is typically at least as great as that of any client, its effect on the serving duration is relatively insignificant.</p>
<p id="p-0131" num="0130">As depicted in <figref idref="DRAWINGS">FIG. 8</figref>, server synchronizer <b>5040</b>, for use in session reconstructor <b>3030</b> (See <figref idref="DRAWINGS">FIG. 5</figref>), adjusts the response date timestamp <b>6160</b> in each input website transaction record <b>3020</b> for inaccuracies in the clock settings of the server <b>6010</b> and for the indeterminacy of the phase of service, using receive-date estimator <b>8050</b>, send-date estimator <b>8080</b>, and sent-date estimator <b>8110</b> to accurately estimate the server's receive date <b>8060</b>, send date <b>8090</b>, and sent date <b>8120</b>, respectively, for that transaction, and outputting those estimates in corresponding augmented server-synchronized output transaction record <b>5050</b>. The server synchronizer bases these adjustments on the timing model <b>5020</b> for the service and the server timing model <b>5030</b> for the server.</p>
<p id="p-0132" num="0131">For detecting man-in-the-browser attacks, man-in-the-middle attacks, repetitive robotic attacks, and similar types of website attacks, which are characterized by anomalously ordered transactions and anomalously quick transactions, accurate server timestamps are critical. By giving transaction sorter <b>5050</b> (See <figref idref="DRAWINGS">FIG. 5</figref>) accurate and precise dates by which to sort the transaction records, it can be determined whether the order of transactions in a session appear anomalous. By giving event comparator <b>18020</b> (See <figref idref="DRAWINGS">FIG. 18</figref>) accurate and precise event-duration estimates, it can be determined whether an event is anomalously quick.</p>
<p id="p-0133" num="0132">Although for non-streaming data, websites usually communicate with clients via TCP/IP, which guarantees packet order, nevertheless a separate TCP socket session is created for each webpage, so if a client opens a plurality of pages concurrently, those requests may travel along different routes and be received by the website out of order, and they may be processed by servers of differing speeds and responded to out of order, and the responses may likewise travel along different paths and reach the client out of order. Note, however, that within a single processing thread, for example within a single browser window or tab, the client actions and website actions are necessarily strictly ordered, in the sense that the client has to receive each website action before being able to respond to it, while the website likewise has to receive each client action before being able to respond to it.</p>
<p id="p-0134" num="0133">For each input transaction record <b>3020</b>, service- and server-modeler <b>5010</b> extracts the service identifier <b>6020</b> and passes it to service model fetcher <b>8030</b>, extracts server identifier <b>6010</b> and passes it to server model fetcher <b>8030</b>, and extracts server response date timestamp <b>6160</b>, which it passes directly to each of the server date estimators: receive-date estimator <b>8050</b>, send-date estimator <b>8080</b>, and sent-date estimator <b>8110</b>.</p>
<p id="p-0135" num="0134">Service-model fetcher <b>8010</b> uses service identifier <b>6020</b> to look up the appropriate service timing model <b>5020</b>, which it outputs to receive-date estimator <b>8050</b>, send-date estimator <b>8080</b>, and sent-date estimator <b>8110</b>. In the simplest embodiment, shown here, the service timing model comprises a mean service duration <b>8020</b>.</p>
<p id="p-0136" num="0135">Server-model fetcher <b>8030</b> uses server identifier <b>6010</b> to fetch the appropriate server timing model <b>5030</b>, which it likewise outputs to the server date estimators. In the simplest embodiment, shown here, for each of the three server date estimators, receive-date estimator <b>8050</b>, send-date estimator <b>8080</b>, and sent-date estimator <b>8110</b>, the server timing model comprises an affine function of the service duration, each affine function being specified by a multiplicative rate parameter (receive rate <b>8040</b>, send rate <b>8070</b>, and sent rate <b>8100</b>) and an additive bias parameter (receive bias <b>8160</b>, send bias <b>8220</b>, and sent bias <b>8280</b>), respectively.</p>
<p id="p-0137" num="0136">Receive-date estimator <b>8050</b> estimates the server receive date <b>8060</b>&#x2014;the instant when the server received the service request&#x2014;by adjusting the server's response date timestamp <b>6160</b> by the server receive bias <b>8160</b> and the product of the server receive rate <b>8040</b> and the service duration <b>8020</b>.</p>
<p id="p-0138" num="0137">In detail, multiplier <b>8140</b> multiplies the service duration estimate by the server receive rate estimate, outputting the result as receive duration estimate <b>8150</b>. Adder <b>8170</b> then adds the receive duration estimate to the receive bias estimate, outputting the sum as total receive delay estimate <b>8180</b>. Finally, subtractor <b>8190</b> subtracts the receive delay estimate from the recorded response date, outputting the difference as adjusted receive-date estimate <b>8060</b>.</p>
<p id="p-0139" num="0138">Similarly, send-date estimator <b>8080</b> estimates the server send date <b>8090</b>&#x2014;the instant when the server began sending the service response&#x2014;by adjusting the server's response date timestamp <b>6160</b> by the server send bias <b>8190</b> and the product of the server send rate <b>8070</b> and the service duration <b>8020</b>. In detail, multiplier <b>8200</b> multiplies the service duration estimate by the server send rate estimate, outputting the result as send duration estimate <b>8210</b>. Adder <b>8230</b> then adds the send lag estimate to the send bias estimate, outputting the sum as total send delay estimate <b>8240</b>. Finally, subtractor <b>8250</b> subtracts the recorded response date from the receive delay estimate, outputting the difference as adjusted send-date estimate <b>8090</b>.</p>
<p id="p-0140" num="0139">Similarly, sent-date estimator <b>8110</b> estimates the server sent date <b>8120</b>&#x2014;the instant when the server finished sending the service response&#x2014;by adjusting the server's response date timestamp <b>6160</b> by the server sent bias <b>8280</b> and the product of the server sent rate <b>8100</b> and the service duration <b>8020</b>. In detail, multiplier <b>8260</b> multiplies the service duration estimate by the server sent rate estimate, outputting the result as sent duration estimate <b>8270</b>. Adder <b>8290</b> then adds the sent duration estimate to the sent bias estimate, outputting the sum as total sent delay estimate <b>8300</b>. Finally, subtractor <b>8310</b> subtracts the recorded response date from the receive delay estimate, outputting the difference as adjusted sent-date estimate <b>8120</b>.</p>
<p id="p-0141" num="0140">Finally, transaction-record editor <b>8130</b> augments the input transaction record <b>3020</b> to include server receive-date estimate <b>8060</b>, server send-date estimate <b>8090</b>, and server sent-date estimate <b>8130</b>, outputting the augmented transaction record as synchronized transaction record <b>5050</b>.</p>
<p id="p-0142" num="0141">Often the response to a service request is assembled from a number of service components that may differ in service timing characteristics, provided by a number of servers that may differ in server timing characteristics. For example, a web page may include static text, dynamic client-specific text, images, and other materials, and may even include other web services, for example in separate HTML frames. In these cases, in the preferred embodiment, the receive-date estimator <b>8050</b>, send-date estimator <b>8080</b>, and sent-date estimator <b>8110</b> accumulate the receive delays <b>8180</b>, send delays <b>8240</b>, and sent delay <b>8300</b>, respectively, before subtracting the response date, outputting a single receive-date estimate <b>8060</b>, single send-date estimate <b>8090</b>, and single sent-date estimate <b>8120</b>, respectively, for the entire transaction.</p>
<p id="p-0143" num="0142">It should be noted that relative (and possibly absolute) timing of events can be done as described herein or using conventional methods, if available.</p>
<p id="p-0144" num="0143"><figref idref="DRAWINGS">FIG. 9</figref> depicts session segregator <b>5080</b>, for use in session reconstructor <b>3030</b> (See <figref idref="DRAWINGS">FIG. 5</figref>). To aggregate individual transactions into individual client sessions and segregate them from other client sessions, session segregator <b>5080</b> identifies clients chiefly on the basis of five specific types of information provided in sorted transaction records <b>5070</b> from HTTP header and IP header information: the client and proxy IP addresses; the authorization login ID; the client's email address; the session cookie; the session query ID; and the current and referring URLs. Unfortunately, all five of these sources of information are unreliable, ambiguous, degenerate, or untrustworthy. In fact, except for the IP addresses, which are reliable, and the cookies, which are unambiguous in legitimate sessions, all of these sources of identifying information suffer from all four of these deficiencies. At some websites, particularly for rearguard deployments, an internal account ID may also be available, which, though related to these other types of information, may be distinct from them.</p>
<p id="p-0145" num="0144">The source IP address and destination IP address are required in all HTTP requests and responses as part of the IP packet header, making the IP address, alone among the five specific types of identifying information, reliably present in all transaction records. Nevertheless, the value of the IP address is an inadequate discriminant of client sessions, because in legitimate use the relation between IP addresses and clients is both ambiguous (one-to-many) and degenerate (many-to-one). On one hand, a single IP address is commonly shared by multiple clients, for example when clients share a router in a local area network, or when they share a proxy or a firewall. Although in such cases the clients are distinguished by the port number in the extended IP address, the mapping between client and port is ephemeral. In such cases the clients may also be distinguished by HTTP Forwarded-for field in the request header, but that field is optional. On the other hand, a single client may use multiple IP addresses within a single session, for example when a mobile client is automatically switched between cell towers while travelling, when a client is automatically switched or intentionally switched between wireless routers due to interference in a congested wireless environment, or when using a multihoming system with multiple public IP addresses. Furthermore, the IP address and Forwarded-for field in a client's request header are untrustworthy in that they may be spoofed by an attacker, for example in order to camouflage the client's response times and order of transactions.</p>
<p id="p-0146" num="0145">In order to receive the website's responses, an attacker must of course have control of the bogus IP addresses, for example through legitimate ownership, hijacking the IP address through malware installed on the client's system at that IP address, or stealing the IP address by poisoning the network address translator in any router along the route to redirect traffic to the attacker's system, or poisoning the address resolution caches within a local area network to direct traffic to the attacker's system. For certain types of attacks, however, such as denial-of-service attacks on websites by flooding the websites with requests, denial-of-service attacks on clients by flooding the clients with responses, or attacks defaming or blacklisting clients by attributing unsavory or hostile actions to them, the attackers have no need to receive the website's responses. In man-in-the-browser attacks, the attacker automatically shares the client's the IP address.</p>
<p id="p-0147" num="0146">The login ID specified in the HTTP Authorization request-header field, unlike the IP address, is unreliably present, because many websites make no use of it, instead communicating authorization information in the Cookie field or in a query string in the URL and because most websites permit clients to visit certain areas and perform certain types of actions without logging in. Many visitors to a website do not even have an account at the website to sign in to, and those clients with valid accounts at a website often avoid signing in, due to laziness or privacy concerns. Nevertheless, for websites that use HTTP Authorization to restrict access to privileged regions, the login ID is, when properly implemented by the website, reliably present in HTTP requests for services within those regions. Like IP addresses, login IDs are legitimately both ambiguous and degenerate client identifiers. On one hand, multiple clients commonly share the same login ID, for example in situations where one or more users are helping others with their accounts, one or more users are supervising others, or when multiple people in a firm or a family use the same login ID. On the other hand, a single client may use multiple login IDs, for example when a client has multiple independent accounts, or is serving a number of customers with independent accounts at the website. Login IDs are also untrustworthy, since they are often spoofed by attackers, for example in brute-force password-guessing attacks, in man-in-the-middle attacks, and for stolen accounts. In man-in-the-browser attacks, the attacker automatically shares the login ID.</p>
<p id="p-0148" num="0147">The email address specified in the HTTP From request-header field is highly unreliable because, to protect users' privacy and to avoid spam, it is not implemented by most modern browsers, and is typically only supplied by scrupulous spiders and robots. The From email address is also legitimately both ambiguous and degenerate, since on the one hand, multiple users often share an email account, for example in a family or small business where one person is Internet-savvy or imperious; while on the other hand, a single user may often have multiple email accounts, for example for home and office. If the email address were available, it would be roughly as untrustworthy as the IP address, in that it is easily spoofed, but in order to receive any responses sent to that email address, an attacker would need to have access to the email account.</p>
<p id="p-0149" num="0148">The cookie specified in the HTTP Cookie request-header field is unreliably present, because clients can refuse to accept cookies from the website and thus not return the cookies to the website, and modern browsers make it easy for users to refuse cookies. On the other hand, websites can refuse to serve users who refuse cookies, and many security-conscious websites do so. Moreover, when present and properly implemented by the website to include a unique session ID, a cookie is the most specific client identifier that HTTP provides for, because the relation between clients and session cookies may be one to many, but not legitimately many-to-one: A single client may have multiple concurrent cookie sessions with a website by using multiple applications to access the website, for example, when using more than one browser to connect to the website because of website-browser incompatibilities, or when using automating applications to perform routine functions on the website. In contrast, a cookie can only be shared if it is deliberately stolen, for example by copying the cookie using malware installed on the intended recipient's system, by intercepting it through a counterfeit website, by side-jacking the cookie with a packet sniffer, or by forwarding the cookie by cross-site scripting; or if the cookie is deliberately planted or &#x201c;fixed&#x201d;, for example by getting the victim's browser to store the cookie via cross-site cooking or cross-subdomain scripting.</p>
<p id="p-0150" num="0149">On some websites, a query string specifying the session ID is appended to the current URL.</p>
<p id="p-0151" num="0150">Query-string session IDs are susceptible to harvesting in a referred website from the URL query string in the HTTP Referrer field, and to session fixation by emailing the victim a hyperlink specifying a session ID in a URL query string, where the session ID may be generated by the attacker or by the target website.</p>
<p id="p-0152" num="0151">Referring URLs, specified in the HTTP Referrer field, are unreliably present, because, to help protect users' privacy, some services, browsers, and browser extensions permit referrers to be disabled.</p>
<p id="p-0153" num="0152">The timestamps, in addition to being used to sort the transactions in chronological order, are also used to help segregate sessions on the basis of overlapping transactions. Note, however, that a single client may legitimately have overlapping transactions, for example by concurrently opening or operating multiple browser windows opened to the same website.</p>
<p id="p-0154" num="0153">Besides timestamps and these five specific types of information, the session segregator can also use generic types of information specified in HTTP Request headers, including Accept (acceptable content types), Accept-Charset (acceptable character sets), Accept-Encoding (acceptable encodings), Accept-Language (acceptable languages), Accept-Ranges (acceptable size ranges), User-Agent (name and details of web application), and Via (proxies through which the request was sent). All of these HTTP Request headers are optional and therefore unreliable. Moreover, they are all untrustworthy, being easily spoofed. Some browsers and freeware browser-plug-ins even exist to let ordinary users conveniently alter some of these headers during a session. However, spoofing such non-specific information during a session does not affect any of the specific session identifiers. Changes in any of these generic information types during a session can be flagged as potentially indicating that the session has been hijacked.</p>
<p id="p-0155" num="0154">The session segregator thus segregates <b>9010</b> the sorted transaction records <b>5070</b> according to cookie ID, if available, as the primary key, into primary strands <b>9020</b>; and segregates <b>9030</b> the primary strands according to account ID, login ID, query session ID, or email address, as available, as secondary keys, into secondary strands <b>9040</b>; and segregates <b>9050</b> the secondary strands by IP address as the tertiary key into client sessions <b>5100</b>.</p>
<p id="p-0156" num="0155">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 10</figref>, agent modeler <b>5110</b>, for use in session reconstructor <b>3030</b> (See <figref idref="DRAWINGS">FIG. 5</figref>), analyzes the timing characteristics of individual user agents by using agent request-timing modeler <b>10020</b> and load modeler <b>10030</b>, and outputs agent timing models <b>5120</b>. Agent modeling is done off-line in a laboratory testing environment, by running precisely timed scripts on the combinations of hardware, operating system, and application employed by clients to use the website's services, as recorded, in the case of HTML webpages, by the user-agent field <b>10010</b> in the HTTP request headers of the transaction records <b>3020</b> received by the website. Assume the bandwidth from the website data center <b>1030</b> to the agent test systems <b>10060</b> is arranged to be at least as great as that from the website data center to any actual client.</p>
<p id="p-0157" num="0156">Agent modeler <b>5110</b> inputs transaction records <b>3020</b> and extracts the agent identifier <b>10010</b> to obtain a list of user agents used to visit the website; and extracts the service identifier <b>6020</b> to obtain a list of services provided by the website; and provides both these identifiers to agent request-timing modeler <b>10020</b>.</p>
<p id="p-0158" num="0157">For each available active user agent <b>10010</b>, agent modeler uses agent request-timing modeler <b>10020</b> to model the agent request delay <b>10130</b>, and uses agent load modeler <b>10030</b> to model the agent load delay <b>10190</b>.</p>
<p id="p-0159" num="0158">Agent request-timing modeler <b>10020</b> uses request timer <b>10040</b> to measure the timing characteristics of each available agent <b>10060</b> identified by agent identifier <b>10010</b>, for each service used by that agent, as identified by service identifier <b>6020</b>, or for a statistically significant number and variety of those services, and uses agent request-date comparator <b>10110</b> to model the statistical distribution of the agent's request timing characteristics.</p>
<p id="p-0160" num="0159">Specifically, for each available active user agent and each service requested by that agent and to be tested with that agent, the agent request timer runs a script <b>10050</b> on that agent <b>10060</b> to issue a statistically significant number of requests <b>6130</b> for that service from the website <b>1030</b>. The script reports back to the request timer the time at the instant it simulated a click on a hyperlink requesting the service through the agent or otherwise naturalistically caused the agent to issue a request for the service, which date the request timer records as click date <b>10070</b>. The script then monitors the agent's system and reports back to the request timer the time at the instant the agent began to transmit the request, which the request timer records as request send date <b>10080</b>; and the time at the instant the agent finished transmitting the request, which the timer records as request sent date <b>10090</b>. The request timer also records the request size <b>10120</b>. The click date, request send date, and request sent date are each given by the current time <b>6110</b> according to master clock <b>6100</b>, to which all agents being timed are synchronized. The script also reports back the nominal request date recorded in the service request by the agent&#x2014;in the Date field of the HTTP request header, in the case of HTML pages&#x2014;which the agent request timer records as service-request date <b>10100</b>.</p>
<p id="p-0161" num="0160">The service-request date is not always available for service requests; for HTTP requests, for example, the Date field in the HTTP Request header is optional, and some browsers and other web applications provide a user-interface control for blocking output of the request date.</p>
<p id="p-0162" num="0161">For clients supplying a service-request date <b>10100</b> through their agent, agent request-date comparator <b>10110</b> models the distribution of the difference between the click date <b>10070</b> and the nominal request date, between the request-send date <b>10080</b> and the nominal request date, and between the request-sent date <b>10090</b> and the nominal request date. For clients blocking the service-request date, the request-date comparator also models the distribution of the difference between the request send date and the click date, and between the request sent date and the click date. The agent request-date comparator models each of these five models as a function of the request, and outputs the functions as request-delay model <b>10130</b>, as part of agent-timing model <b>5120</b> for the agent identified by agent identifier <b>10010</b>. In the simplest embodiment, the agent request-date-comparator models each of these delays as an agent-specific affine function of the request size <b>10120</b>, computed by the least-squares best fit, each function specified by an additive bias parameter and a multiplicative rate parameter.</p>
<p id="p-0163" num="0162">Agent-request timing modeler <b>10030</b> uses agent load timer <b>10140</b> to measure the timing characteristics of each available agent <b>10060</b> identified by agent identifier <b>10010</b>, for each service tested by agent request-timing modeler <b>10020</b>, and uses load-date comparator <b>10180</b> to model the statistical distribution of the agent's load timing characteristics.</p>
<p id="p-0164" num="0163">Specifically, for each service request issued by agent request-timing modeler <b>10020</b>, agent-timing script <b>10050</b> monitors the agent's system and reports back to agent load timer <b>10140</b> the time at the instant the agent's system begins to receive the service, which the load timer records as response receipt date <b>10150</b>; and reports back to the load timer the instant the agent has finished loading the service&#x2014;or, more precisely, the instant the client can respond to the service, for example by clicking on hyperlinks, in the case of an HTML webpage&#x2014;which the load timer records as service loaded date <b>10160</b>. The load timer also records the size of the service <b>10170</b>.</p>
<p id="p-0165" num="0164">In the preferred embodiment, if a single service request <b>6130</b> receives multiple service responses <b>6150</b>, the load script and load timer track each such service separately for greater accuracy. The response receive dates and service loaded dates are given by the respective current times <b>6110</b> specified by master clock <b>6100</b>.</p>
<p id="p-0166" num="0165">Load-date comparator <b>10180</b> models the distribution of the difference between service-loaded date <b>10160</b> and response-receive date <b>10150</b> as a function of the service, and outputs the function as load-delay model <b>10190</b>, as part of agent model <b>5120</b>.</p>
<p id="p-0167" num="0166">In the simplest embodiment, the load-date comparator models the distribution as an agent-specific affine function of the size of the service <b>10170</b>, computed by the least-squares best fit, specified by an additive bias parameter and a multiplicative rate parameter. In the preferred embodiment, the load-delay model specifies separate affine parameters for plaintext versus unencrypted services, and for service elements of differing load speeds, such as HTML, images using different compression formats, and timed messages that the client must attend before proceeding. In the preferred embodiment, the load-delay model also involves separate load-delay models for cached versus uncached services.</p>
<p id="p-0168" num="0167">If either the request timer or load timer fails to receive a response from the script within a reasonable amount of time&#x2014;typically a few seconds&#x2014;then it outputs a notification <b>10220</b> to the test administrators warning that the agent is taking longer than expected, and specifying the agent and the service that elicited the problem.</p>
<p id="p-0169" num="0168">In addition to outputting agent-timing models <b>5120</b> for use by client modeler <b>5130</b> and client synchronizer <b>5150</b> (See <figref idref="DRAWINGS">FIG. 5</figref>), agent modeler <b>5110</b> also uses agent analyzer <b>10200</b> to output agent summary <b>10210</b> summarizing the agents <b>10010</b> used to visit the website, along with their frequency of use. For those agents available for testing, the agent summary also summarizes their load times for different types of services; while those unavailable are marked for possible requisition for future testing. The agent summary is also useful for website-development research, for example to determine which agents the website should optimize for because of their popularity, or to determine whether alternate forms of certain services should be provided for agents that take too long; and for marketing research, for example to determine customer preferences.</p>
<p id="p-0170" num="0169">For efficiency, agent-timing modeling may be integrated with normal quality-control testing of the website.</p>
<p id="p-0171" num="0170">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 11</figref>, client-timing modeler <b>5130</b>, for use in session reconstructor <b>3030</b> (See <figref idref="DRAWINGS">FIG. 5</figref>), estimates and tracks the timing characteristics <b>5140</b> (See <figref idref="DRAWINGS">FIG. 5</figref>) for each website client accessing the website during the data-collection period, by using client service-delay modeler <b>11030</b> to measure and model the client's service delay statistics <b>11090</b>, using echo-timing modeler <b>11040</b> to measure and model the client's echo delay statistics <b>11180</b>, or, if the echo fails, using trace-timing modeler <b>11050</b> to measure and model the client's trace-delay statistics <b>11260</b>, or, if the trace also fails, applying the echo-delay modeler or trace-delay modeler to the closest responding proxy to the client located by close-proxy finder <b>11020</b>; and comparing the service delay estimate with the null-service echo delay or trace delay.</p>
<p id="p-0172" num="0171">Many Internet service providers block ping and traceroute requests to prevent their network from being mapped out by malicious clients, and some individual clients also block ping requests to reduce the visibility of their systems and thus reduce the number of network attacks on their systems.</p>
<p id="p-0173" num="0172">Client-timing modeler <b>5130</b> inputs client transaction records <b>5090</b> and extracts the client identifier <b>11010</b> to obtain a list of all clients active during the data-collection period, which it provides to client service-timing modeler <b>11030</b>, client echo-timing modeler <b>11040</b>, client trace-timing modeler <b>11060</b>, and close-proxy finder <b>11020</b>. For each client transaction, the client-timing modeler uses the service-timing modeler to estimate the service delay based on service-request date <b>10100</b> (if available), user-agent identifier <b>10010</b>, request size <b>10120</b>, and service identifier <b>6020</b>, which are obtained from the transaction record. The client identifier consists of the IPv6 or IPv4 address and port number in the TCP or UDP packet-header, the port number being necessary for clients in a private network behind a router, firewall, or other proxy. In the case of HTML webpages, the service-request date is originally from the Date field in the HTTP Request header, and the user-agent is from the User-Agent field. The request size is obtained either from the sum of the HTTP header lengths and the value of the Content-Length field, or from the TCP or UDP length fields.</p>
<p id="p-0174" num="0173">During the data-collection period, client service-timing modeler <b>11030</b> uses client service timer <b>11060</b> to measure the timing characteristics of each active client identified by client identifier <b>11010</b>, and uses client service date comparator <b>11080</b> to model the statistical distribution of the client's service delay characteristics <b>11090</b>. Specifically, at the moment each client action <b>1020</b> (See <figref idref="DRAWINGS">FIG. 1</figref>) is received by website traffic processor <b>2010</b> (See <figref idref="DRAWINGS">FIG. 2</figref>), client service timer <b>11060</b> outputs service receipt date timestamp <b>11070</b> from the current time <b>6110</b> given by master clock <b>6100</b>.</p>
<p id="p-0175" num="0174">For each service transaction, client service-date comparator <b>11080</b> calculates the client's service-request delay from the service-request date timestamp <b>10100</b> (if available), the user-agent identifier <b>10010</b>, the request size <b>10120</b>, the server traffic processor's service receipt date timestamp <b>11070</b>, and the user-agent model <b>5120</b> identified by the client identifier, and outputs a model of the distribution as client service-delay model <b>11090</b>. The client service-date comparator is detailed under <figref idref="DRAWINGS">FIG. 12</figref>.</p>
<p id="p-0176" num="0175">During the same measurement period, client echo-timing modeler uses echo timer <b>11100</b> to measure the null-agent timing characteristics of each active client <b>11010</b>, and uses echo date comparator <b>11170</b> to model the statistical distribution of the null-agent timing characteristics. Specifically, for an active client, the echo timer issues a statistically significant number of echo requests <b>11110</b> of various sizes to the client or a close proxy <b>11120</b>, outputting echo send date timestamp <b>11140</b> the moment it sends the echo request, and outputting echo-receipt date timestamp <b>11150</b> the moment it has received the echo response <b>11130</b> back from the client, each timestamp being given by the respective current time <b>6110</b> given by master clock <b>6100</b>. The echo timer also records the echo request size <b>11160</b>.</p>
<p id="p-0177" num="0176">When echo response <b>11130</b> is delayed by more than a reasonable threshold&#x2014;typically no more than a few seconds, dependent on the distance to the client and on current network conditions&#x2014;then echo-timing modeler <b>11040</b> aborts the ping attempt, under the assumption that the client is blocking ping requests, and the client-timing modeler <b>5130</b> attempts trace timing instead.</p>
<p id="p-0178" num="0177">For each active client, echo-date comparator <b>11170</b> calculates the difference between each echo receipt time <b>11150</b> and corresponding echo send time <b>11140</b> for a statistically significant sample of echo requests of various sizes <b>11160</b>, and outputs a model of the distribution of the result as echo delay <b>11180</b>.</p>
<p id="p-0179" num="0178">In the simplest embodiment, the client-specific echo-delay model comprises half the mean echo time for each direction and half the echo time variance for each direction, each as an affine function of the size of the echo request, computed by the least-squares best fit, where the function is specified by an additive bias parameter and a multiplicative rate parameter.</p>
<p id="p-0180" num="0179">The preferred embodiment also takes into account any known speed and bandwidth asymmetries in the transmission rate of the Internet connection on either end, as determined for some clients from the client's IP address <b>11010</b>, by partitioning the roundtrip echo time into two portions inversely proportional to the throughput in that direction, and likewise proportionately scaling the variance for each direction.</p>
<p id="p-0181" num="0180">Trace-timing modeler <b>11050</b> has traceroute timer <b>11190</b> issue traceroute requests <b>11200</b> to the same client <b>11010</b> or close proxy, with stepwise increasing time-to-live values until either the target node is reached or traceroute response <b>11210</b> is delayed by more than a reasonable threshold&#x2014;again, typically no more than a few seconds, dependent on the distance to the client and on current network conditions. If the last response occurs within a plausible delay considering the distance and network conditions, then the trace timer outputs echo-send date timestamp <b>11220</b> corresponding to the moment it sent the last successful traceroute request, and outputs trace-receipt date timestamp <b>11230</b> corresponding to the moment it received the last successful traceroute response back from the client, each timestamp being given by the respective current time <b>6110</b> according to master clock <b>6100</b>. The trace timer also records the trace request size <b>11240</b>.</p>
<p id="p-0182" num="0181">Analogously to echo-date comparator, trace-date comparator <b>11250</b> calculates the difference between each final trace-receipt time <b>11230</b> and corresponding trace-send time <b>11220</b> for a statistically significant sample of trace requests of various sizes <b>11240</b>, and outputs a model of the distribution of the result as trace delay <b>11260</b>.</p>
<p id="p-0183" num="0182">In the simplest embodiment, the client-specific trace-delay model comprises half the mean trace time for each direction and half the trace-time variance for each direction, each as an affine function of the size of the trace request, computed by the least-squares best fit, where the function is specified by an additive bias parameter and a multiplicative rate parameter. Again, the preferred embodiment also takes into account any known speed and bandwidth asymmetries in the transmission rate of the Internet connection on either end, as determined for some clients from the client's IP address <b>11010</b>.</p>
<p id="p-0184" num="0183">If neither the echo-timing modeler <b>11040</b> nor the trace-timing modeler <b>11060</b> succeeds in fixing the roundtrip delay to the actual client <b>11010</b>, then the client-timing modeler uses close-proxy finder <b>11020</b> to find the IP address <b>11310</b> of a nearby ping proxy. The close proxy finder first uses address locator <b>11280</b> to look up the node location <b>11290</b> of the actual client from the client's IP address <b>11010</b>. Then proxy finder <b>11300</b> finds the ping proxy closest to that node location, outputting its IP address as target address <b>11310</b>. The client-timing modeler <b>5130</b> then substitutes the ping proxy's IP address for use by echo-timing modeler <b>11040</b> and trace-timing modeler <b>11060</b>. In case the selected ping proxy also fails, the client-timing modeler uses the close-proxy finder iteratively to find another ping proxy until one succeeds.</p>
<p id="p-0185" num="0184">Finally, for each active client (or at least some clients), client delay comparator <b>11270</b> compares the distribution of the client's service-request delay <b>11090</b> with the distribution of the client's echo delay <b>11180</b> or traceroute delay <b>11260</b>, outputting a model of the distribution of the result as client timing model <b>5140</b>. In the simplest embodiment, the client timing model comprises the echo-request delay or trace-request delay, as a pair of affine functions of request size <b>10120</b>, one for the transmit direction and one for the receive direction, each function specifying the mean behavior with an additive bias parameter and a multiplicative rate parameter, as well as the variance in the transmit direction; and, if the request dates are supplied by the client, the difference between the client's service-request delay and the echo-request delay or trace-request delay, giving the mean client clock bias and its variance. For websites with more than one data center, the client timer generates a separate model for each geographically separate data center.</p>
<p id="p-0186" num="0185">In addition to outputting client-timing models <b>5140</b> for use by client synchronizer <b>5150</b> (See <figref idref="DRAWINGS">FIG. 5</figref>), client-timing modeler <b>5130</b> also uses client analyzer <b>11280</b> to output client summary <b>11290</b> summarizing the clients <b>11010</b> visiting the website, along with their IP addresses, geographic locations, and timing characteristics, including whether they supply request dates and respond to ping requests. The client summary is also useful for website-development research, for example to determine whether to provide more-lavish services for clients with large connection bandwidths and short connection lags, or more-meager services for clients with small connection bandwidths and long connection lags; and for marketing research, to determine where customers are located and what kind of connections they have.</p>
<p id="p-0187" num="0186">Information-flow diagram <figref idref="DRAWINGS">FIG. 12</figref> depicts client service-date comparator <b>11080</b> (See <figref idref="DRAWINGS">FIG. 11</figref>), which uses agent-delay estimator <b>12030</b> to estimate the agent delay <b>12100</b>; differencer <b>12010</b> to measure the raw service delay; differencer <b>12110</b> to compare these two estimates, and service-delay modeler <b>12130</b> to model the service delay <b>11090</b>.</p>
<p id="p-0188" num="0187">For each service transaction, agent-delay estimator <b>12030</b> uses agent-model fetcher <b>12040</b> to fetch the agent model identified by agent identifier <b>10010</b> from agent models <b>5120</b>. If the transaction record does not specify the agent, the agent delay estimator uses the default agent model, whose parameters are set to the modal values of the known agents active during the data-collection period.</p>
<p id="p-0189" num="0188">In the simplest embodiment, shown here, the agent request-timing model comprises agent-specific request-bias parameter <b>12050</b> and agent-specific request-rate parameter <b>12060</b>. Multiplier <b>12070</b> then multiplies the agent request rate by the request size <b>10120</b>, outputting the product as agent request lag <b>12080</b>. Adder <b>12090</b> then adds the agent request bias to the agent request lag, outputting the sum as total agent delay <b>12100</b>.</p>
<p id="p-0190" num="0189">Likewise, for each service transaction, differencer <b>12010</b> calculates the difference between service-receipt date timestamp <b>11070</b> and service-request date timestamp <b>10100</b>, outputting the difference as raw service delay <b>12020</b>. Differencer <b>12110</b> then computes the difference between the raw service delay and the agent delay <b>12100</b> output by agent-delay estimator <b>12030</b> for the same request, outputting the difference as service delay model <b>12120</b>.</p>
<p id="p-0191" num="0190">Finally, for each client, as identified by client-identifier <b>11010</b>, service-delay modeler <b>12130</b> models the distribution of the service, and outputs a model of the distribution of this difference as service-delay model <b>11090</b>. In the simplest embodiment, the service-delay model gives the service-request delay as the mean service delay for that client, which is the least-squares best-fit model.</p>
<p id="p-0192" num="0191">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 13</figref>, client synchronizer <b>5090</b>, for use in session reconstructor <b>3030</b> (See <figref idref="DRAWINGS">FIG. 5</figref>), inputs one client transaction record <b>5090</b> at a time, and uses variance comparator <b>13080</b>, click-date estimator <b>13010</b> and load-date estimator <b>13030</b>, and transaction-record editor <b>13050</b> to synchronize the transaction with load-date and click-date estimates, outputting corresponding synchronized client transaction record <b>5160</b>.</p>
<p id="p-0193" num="0192">Click-date estimator <b>13010</b>, using information from the input client transaction record <b>5090</b>, the client model <b>5140</b> identified by the client identifier in the input transaction record, and the agent model <b>5120</b> identified by the agent identifier in the input transaction record, outputs click-date estimate, accurately estimating the instant that the client requested the target service from the website, such as by clicking on a hyperlink in the source service, according to the network-service threat detector's master clock. The click-date estimator is detailed under <figref idref="DRAWINGS">FIG. 14</figref>.</p>
<p id="p-0194" num="0193">Similarly, load-date estimator <b>13030</b>, using information from the client model <b>5140</b>, the server model <b>5030</b>, the service model <b>5020</b>, and the agent model <b>5120</b>, as identified by the client identifier, the server identifier, the service identifier, and the agent identifier, respectively, in the input transaction record, in addition to the click date <b>13020</b> output by click-date estimator <b>13010</b> for the same transaction record, outputs load-date estimate <b>13040</b>, accurately estimating the instant at which the client's agent finished loading the source service to the point when the client was able to act upon it, for example by clicking on a hyperlink, according to the network-service threat detector's master clock. The load-date estimator is detailed under <figref idref="DRAWINGS">FIG. 15</figref>.</p>
<p id="p-0195" num="0194">The click-date estimator <b>13010</b> can estimate the click date based either on the request-date timestamp recorded by the client, when available, or on the server's request-receive date recorded by the server synchronizer. The client-based click-time estimate is ordinarily more accurate because it depends only on the ordinarily constant client clock bias and brief agent click delay, whereas the server-based estimate depends on highly variable transmission time from the client and server, which cannot be estimated as accurately. Similarly, the load-date estimator <b>13030</b> can estimate the load date based either on the load-date timestamp recorded by the client using an embedded load timer, when available, or on the server's service send date timestamp recorded by the server synchronizer. Again, the client-based load-time estimate is ordinarily much more accurate because it depends only on the ordinarily constant client clock and brief agent click delay, whereas the server-based estimate depends on highly variable transmission time from the server to the client, and on highly variable load time by the client, neither of which can be estimated as accurately. On the other hand, the date timestamps issued by the client are both unreliably present, being optional, for example, in the HTTP Request header specification; and untrustworthy, in that fraudsters can tamper with them directly.</p>
<p id="p-0196" num="0195">Variance comparator <b>13080</b> first checks whether the client request date <b>10100</b> and the client load date are available in input client transaction record <b>5090</b>. If either one is available, the variance comparator compares the variance in the client's transmission bias <b>13090</b> to the variance in the client's clock bias <b>13100</b>, as determined by the client model <b>5140</b> identified by the client identifier in the input transaction record. If the difference between the clock-bias variance and the transmission-bias variance is greater than variance threshold <b>13110</b>, then the client's clock is deemed untrustworthy, otherwise it is deemed trustworthy, where the variance threshold is typically set to a value between zero and a few centiseconds.</p>
<p id="p-0197" num="0196">If the client request date is available and the client's clock is deemed trustworthy, then the variance comparator sets click-date estimator switch <b>13060</b> to use the request-based click-date estimator; else it sets it to use the receive-based click-date estimator. Similarly, if the client load date and the client request date are available and the client's clock is deemed trustworthy, then the variance estimator sets load-date estimator switch <b>13070</b> to use the request-based load-date estimator; else it sets it to use the send-based load-date estimator.</p>
<p id="p-0198" num="0197">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 14</figref>, for each input client transaction record, click-date estimator <b>13010</b>, for use in client synchronizer <b>5090</b> (See <figref idref="DRAWINGS">FIG. 13</figref>), either uses receive-based click-date estimator <b>14010</b> to output receive-based click-date estimate <b>14020</b>, or uses request-based click-date estimator <b>14030</b> to output request-based click-date estimate <b>14040</b>, depending on the value of click-date-estimator switch <b>13060</b>.</p>
<p id="p-0199" num="0198">For receive-based click-date estimator <b>14010</b>, agent-model fetcher <b>12040</b> looks up the agent model <b>5110</b> identified by agent identifier <b>10010</b> in transaction record <b>5090</b>, outputting agent request rate <b>12060</b> and agent request bias <b>12050</b>, modeling the delay between the instant the client requests a service, for example by clicking on a hyperlink in the source service, and the instant the client begins transmitting the request. Likewise, client-model fetcher <b>14070</b> looks up the client model <b>5130</b> identified by client identifier <b>11010</b> in the transaction record, outputting client-transmission rate <b>14080</b> and client transmission bias <b>14090</b>, modeling the delay between the instant the client begins transmitting a request and the instant the server receives it.</p>
<p id="p-0200" num="0199">Multiplier <b>14050</b> multiplies agent request rate <b>12060</b> by the size of the request <b>10120</b>, obtained from transaction record <b>5090</b>, outputting the product as request-duration estimate <b>14060</b>. Multiplier <b>14100</b> multiplies the client transmit rate by request size <b>10120</b>, outputting the product as transmit-duration estimate <b>14110</b>. Maximum operator <b>14120</b> then computes the maximum of these two values, outputting the result as total request-duration estimate <b>14130</b>. Adder <b>14140</b> adds agent request bias <b>12050</b> and client transmission bias <b>14090</b>, outputting the sum as total request-bias estimate <b>14150</b>. Adder <b>14160</b> then adds the request duration to the request bias, outputting the sum as request-delay estimate <b>14170</b>. Finally, subtractor <b>14180</b> subtracts the request delay from the server request-receive date <b>8060</b> obtained from the client transaction record, outputting the difference as receive-based click-date estimate <b>14020</b>.</p>
<p id="p-0201" num="0200">For request-based click-date estimator <b>14030</b>, agent-model fetcher <b>12040</b> looks up the agent model <b>5110</b> identified by agent identifier <b>10010</b> in transaction record <b>5090</b>, outputting agent click rate <b>14190</b> and agent click bias <b>14200</b>, modeling the delay between the instant the client requests a service, for example by clicking on a hyperlink in the source service, and the request date <b>10100</b> recorded by the agent in the client transaction record with a synchronized clock. Client-model fetcher <b>14070</b> looks up the client model <b>5130</b> identified by client identifier <b>11010</b> in the transaction record, outputting client clock bias <b>14250</b>, modeling the difference between the client's clock setting and the network-service threat detector's master clock.</p>
<p id="p-0202" num="0201">Multiplier <b>14210</b> multiplies agent click rate <b>14190</b> by request size <b>10120</b>, outputting the product as agent click-duration estimate <b>14220</b>. Adder <b>14230</b> then adds the click duration to agent click bias <b>14200</b>, outputting the sum as agent click-delay estimate <b>14240</b>. Adder <b>12460</b> then adds the agent click delay to client clock bias <b>14250</b>, outputting the sum as total click-delay estimate <b>14270</b>. Finally, adder <b>14280</b> adds the click delay to request date <b>10100</b>, outputting the result as request-based click-date estimate <b>14040</b>.</p>
<p id="p-0203" num="0202">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 15</figref>, for each input client transaction record, load-date estimator <b>13030</b>, for use in client synchronizer <b>5090</b> (See <figref idref="DRAWINGS">FIG. 13</figref>), either uses load-duration estimator <b>15010</b> and load-bias estimator <b>15020</b> to output send-based load-date estimate <b>15030</b>, or outputs request-based load-date estimate <b>15040</b>, depending on the value of load-date estimator switch <b>13070</b>.</p>
<p id="p-0204" num="0203">Service-model fetcher <b>7020</b> looks up the service model <b>5030</b> identified by service identifier <b>6020</b> in client transaction record <b>5090</b>, outputting service duration <b>7030</b> to the server sent-duration estimator, multiplier <b>15090</b>; and outputting service size <b>10170</b> to the client receive-duration estimator, multiplier <b>15100</b> and agent load-duration estimator, multiplier <b>15120</b>.</p>
<p id="p-0205" num="0204">Server-model fetcher <b>7040</b> looks up the server model <b>5020</b> identified by server identifier <b>6010</b> in client transaction record <b>5090</b>, outputting server service-sent rate <b>7110</b> and server service-sent bias <b>7290</b>, modeling the delay between the instant the server begins sending a service to the instant it finishes sending it. Likewise, client model fetcher <b>14070</b> looks up the client model <b>5130</b> identified by client identifier <b>11010</b> in the transaction record, outputting client service-receive rate <b>15050</b> and client service-receive bias <b>15060</b>, modeling the transmission delay between the instant the server begins sending a service and the instant the client finishes receiving it. Likewise, agent-model fetcher <b>12040</b> looks up the agent model <b>5110</b> identified by agent identifier <b>10010</b> in the transaction record, outputting agent service-load rate <b>15070</b> and agent service-load bias <b>15080</b>, modeling the delay between the instant the agent begins receiving the service and the instant the agent finishes loading the service to the extent that the client can act on it.</p>
<p id="p-0206" num="0205">Load-duration estimator <b>15010</b> uses multiplier <b>15090</b> to multiply server sent rate <b>7110</b> by service duration <b>7030</b>, outputting the product as sent duration estimate <b>7280</b>; uses multiplier <b>15100</b> to multiply client receive rate <b>15050</b> by service size <b>10170</b>, outputting the product as receive duration estimate <b>15110</b>; and uses multiplier <b>15120</b> to multiply agent load rate <b>15070</b> by service size <b>10170</b>, outputting the product as load duration <b>15130</b>. The load-duration estimator then uses maximum operator <b>15140</b> to compute the maximum value among the sent duration, receive duration, and load duration, outputting the maximum as load duration estimate <b>15150</b>.</p>
<p id="p-0207" num="0206">Load-bias estimator <b>15020</b> uses adder <b>15160</b> to add server sent bias <b>7290</b>, client receive bias <b>15060</b>, and agent load bias <b>15080</b>, outputting the result as total load bias <b>15170</b>.</p>
<p id="p-0208" num="0207">Load-date estimator <b>13030</b> then adds load duration <b>15150</b> to load bias <b>15170</b>, outputting the sum as total load-delay estimate <b>15190</b>. Finally, adder <b>15200</b> adds the load delay to server send date <b>7100</b> in client transaction record <b>5090</b>, outputting the result as send-based load-date estimate <b>15030</b>.</p>
<p id="p-0209" num="0208">Differencer <b>15210</b> subtracts request date <b>10100</b> specified in client transaction record <b>5090</b> from click date <b>13020</b> output by request-based click-date estimator <b>14030</b> (See <figref idref="DRAWINGS">FIG. 14</figref>), outputting the difference as click delay <b>14270</b>. Alternatively, the click-date estimator could pass the click delay directly to the load-date estimator. Adder <b>15230</b> then adds the click delay to the load date <b>15220</b> obtained from the client transaction record, outputting the sum as request-based load-date estimate <b>15040</b>.</p>
<p id="p-0210" num="0209">Information-flow diagram <figref idref="DRAWINGS">FIG. 16</figref> depicts timed-transition event analyzer <b>16000</b>, a particularly simple exemplary type of session analyzer <b>3050</b> for use in network-service threat detector <b>1060</b> (See <figref idref="DRAWINGS">FIG. 3</figref>) which analyzes client transaction sessions <b>3040</b> into atomic session events or elemental session events, comprising timed transitions, and repackages them as client event sessions <b>16240</b> for efficient processing by session modeler <b>3120</b> and session comparator <b>3070</b> of <figref idref="DRAWINGS">FIG. 3</figref>. In a more-complex embodiment, the session analyzer analyzes client sessions into overlapping trigrams or larger chunks when there are sufficient statistics, and includes other client-distinguishing information.</p>
<p id="p-0211" num="0210">The source names <b>16080</b> and target names <b>16030</b> may be either URLs from HTTP transaction records, or internal service names provided by the website in a rearguard deployment. In the embodiment shown, service names are tokenized for efficiency in session analyzer <b>16000</b>. In an alternative embodiment, they are tokenized earlier, in session reconstructor <b>3030</b> or even in both website analyzer <b>3100</b> and record augmenter <b>3010</b> (See <figref idref="DRAWINGS">FIG. 3</figref>).</p>
<p id="p-0212" num="0211">Source encoder <b>16010</b> tokenizes source name <b>16080</b> to output source identifier <b>16020</b>, where the source name is the service name <b>6020</b> held over <b>16070</b> from the previous session transaction record. Similarly, target encoder <b>16030</b> tokenizes target name <b>6020</b> to output target identifier <b>16040</b>. The source encoder and target encoder encode a service name by looking up the name in a dictionary and returning the corresponding token, typically a hash of the name, inserting the name in the dictionary and thereby generating a token for it if the service name was not already entered in the dictionary. The token has the precision of a standard binary word in the machines embodying the threat detector, for efficient lookup, comparison, and other manipulation.</p>
<p id="p-0213" num="0212">Duration encoder <b>16050</b> encodes transition duration <b>16120</b> to output transition time interval identifier <b>16060</b>, where the transition duration is computed as the difference <b>16110</b> between the click date <b>13020</b> (the estimated instant when the client requested the target service) and the source load date <b>16100</b>, the load date <b>12020</b> held over <b>16090</b> from the previous session transaction record (the estimated instant when the client was first able to request the service). In one embodiment, the duration encoder simply outputs the quantitative transition time to the precision of a standard binary word. In an alternative embodiment, the duration encoder coarsely quantizes the transition time on an exponential scale, and tokenizes the quantized intervals for efficient access in a sparse array. A sample exponential scale is [0 . . . 1/16), [ 1/16 . . . &#x215b;), [&#x215b; . . . &#xbc;), [&#xbc; . . . &#xbd;), [&#xbd; . . . 1), [1 . . . 2), [2 . . . 4), [4 . . . 8), [8 . . . &#x221e;) seconds. A quantitative representation is preferable for atomic session analysis, where each individual event in each session is considered separately for accuracy. A tokenized representation is preferable for elemental session analysis, where all events of a type within a session are lumped together and treated as a group.</p>
<p id="p-0214" num="0213">Transition encoder <b>16150</b> encodes the ordered pair comprising source identifier <b>16020</b> and target identifier <b>16040</b> (as shown), or, equivalently, comprising source name <b>11040</b> and target name <b>11060</b>, to output a single transition identifier <b>16160</b> identifying the transition from the source to the target.</p>
<p id="p-0215" num="0214">Timed-source encoder <b>16170</b> encodes the combination of source identifier <b>16020</b> and time-interval identifier <b>16060</b> (as shown), or, equivalently, the combination of source name <b>16080</b> and transition time <b>16020</b>, to output timed-source identifier <b>16180</b>. Similarly, timed-target encoder <b>16130</b> encodes the combination of target identifier <b>16040</b> and time-interval identifier <b>16060</b> (as shown), or, equivalently, the combination of target name <b>6020</b> and transition time <b>16020</b>, to output timed-target identifier <b>16180</b>.</p>
<p id="p-0216" num="0215">Optional linkage encoder <b>16190</b> looks up source identifier <b>16020</b> and target identifier <b>16040</b> (as shown), or, equivalently, source name <b>16080</b> and target name <b>6020</b>, in website map <b>3110</b> to determine the linkage type, and encodes the linkage type as linkage identifier <b>16200</b>.</p>
<p id="p-0217" num="0216">Extrinsic transitions within a session may indicate a hijacking attack. However, certain extrinsic links are provided by web browsers and similar applications, typically accessed by buttons or menu items in the application user interface, including a &#x201c;back&#x201d; feature to return to the previous service in the session, a history function to return to other services recently visited by the client, and a bookmarks function to return to services previously marked by the client. In the simplest embodiment, the linkage encoder classifies links into one of three categories: intrinsic, back-step, and extrinsic. In a more complex embodiment, the linkage encoder also recognizes back-skips to previous services within the current session as a fourth category. Extrinsic links can also be provided by external sources such as websites and email messages, and the linkage encoder recognizes such inbound links by the referrer <b>16250</b>, when present in the client action record, and classifies them as yet another linkage type.</p>
<p id="p-0218" num="0217">For elemental session analysis, session analyzer <b>16000</b> uses event-type counter <b>16210</b> to first check whether an existing session event <b>16240</b> has matching identifiers&#x2014;in this case matching source identifier <b>16020</b>, matching target identifier <b>16040</b>, and matching duration identifier <b>16060</b> and, if available, matching linkage identifier <b>16200</b>&#x2014;and, if so, merely increments the event-type count <b>16220</b> for that event type, rather than encoding the derivative identifiers and packing a separate session event.</p>
<p id="p-0219" num="0218">Session-event-record packer <b>16230</b> assembles source identifier <b>16020</b>, target identifier <b>16040</b>, transition-duration identifier <b>16060</b>, timed-source identifier <b>16180</b>, transition identifier <b>16160</b>, and timed-target identifier <b>16140</b>, into session event record <b>16240</b>. If available, the session-event packer also records linkage-type identifier <b>16200</b> in the session event record. For elemental session events, the session-event packer also stores the event-type instance count <b>16220</b> in the session event record.</p>
<p id="p-0220" num="0219">Output client event session <b>16240</b> may be either an atomic-event session, listing each individual event as a separate record, or an elemental-event session digest, grouping equivalent events into a single record. For atomic session analysis, session event packer <b>16230</b> simply appends each session event record <b>16240</b> to the current atomic client event session on the fly. For elemental session analysis, the event-type counter <b>16210</b> merges equivalent event records within a session, maintaining an instance count in the event record for each event type.</p>
<p id="p-0221" num="0220">In the exemplary embodiment shown, the compound attributes service transition <b>16160</b>, timed-source <b>16180</b>, and timed-target <b>16140</b> are encoded in session analyzer <b>16000</b>, saving time later in session modeler <b>3120</b> and session comparator <b>3070</b>, but at the expense of the space required to store the additional identifiers in the session event records. In an alternative embodiment, compound attributes are encoded on the fly whenever needed, saving space at the expense of time.</p>
<p id="p-0222" num="0221">Information-flow diagram <figref idref="DRAWINGS">FIG. 17</figref> depicts timed-transition event modeler <b>17000</b>, a particularly simple type of session modeler <b>3120</b> for use in network-service threat detector <b>1060</b> (See <figref idref="DRAWINGS">FIG. 3</figref>) whose session models <b>3130</b> comprise event models <b>17010</b> modeling not entire sessions, but only the atomic or elemental transition events of which sessions are composed, and modeling only the global statistics of the most rudimentary characteristics of those events: the identities of the constituent services of a transition and the duration of the transition&#x2014;along with joint combinations of those characteristics.</p>
<p id="p-0223" num="0222">In particular, event modeler <b>17000</b> models the global statistics during the data-collection period of a transition's source, transition duration, and target, as well as of joint source and target pairs, joint transition-duration and target pairs, and joint source and transition-duration pairs. When linkage information from a website map is available, the event modeler also models the global statistics of linkage types during the data-collection period. In detail, for each event session-event record or session-type record <b>16240</b>, source-model updater <b>17020</b> updates the source frequency <b>17030</b> corresponding to the source identifier <b>16020</b>, transition-duration-model updater <b>17040</b> updates the transition-duration frequency <b>17050</b> corresponding to transition-duration identifier <b>16060</b>, target-model updater <b>17060</b> updates the target frequency <b>17070</b> corresponding to target identifier <b>16040</b>, timed-target-model updater <b>17080</b> updates the timed-target frequency corresponding to timed-target identifier <b>16140</b>, transition-model updater <b>17100</b> updates the transition frequency <b>17110</b> corresponding to service-transition identifier <b>16160</b>, timed-source-model updater <b>17120</b> updates the timed-source frequency <b>17130</b>, and linkage-model updater <b>17140</b> optionally updates linkage-type frequency <b>17150</b> corresponding to linkage-type identifier <b>16200</b>, where the source identifier, duration identifier, target identifier, timed-target identifier, transition identifier, timed-source identifier, and linkage-type identifier are obtained from the session-event record <b>16240</b>, and the corresponding models are updated in event models database <b>17010</b>. In addition, event-frequency updater <b>17160</b> updates event frequency <b>17170</b> in the event models database.</p>
<p id="p-0224" num="0223">Source frequencies <b>17030</b> are modeled separately from target frequencies <b>17070</b> because the distribution of source frequencies is not in general identical to the distribution of target probabilities, because, for example, a login page is relatively unlikely to be a target, and a logout page is unlikely to be a source, since client sessions often begin with a login page and end with a logout page.</p>
<p id="p-0225" num="0224">Event modeler <b>17000</b> is designed to operate on either atomic session-event records, or on elemental session-event-type records, where each event-type record contains an instance count <b>16220</b> in addition to the identifiers. When operating on atomic session-event records, the event modeler updates source frequency <b>17030</b>, duration frequency <b>17050</b>, target frequency <b>17070</b>, timed-target frequency <b>17090</b>, transition frequency <b>17110</b>, timed-source frequency <b>17130</b>, linkage frequency <b>17150</b>, and event frequency <b>17170</b> by simply incrementing each frequency by one, the default value of increment <b>17200</b>. When operating on elemental session-event records, the event modeler updates these frequencies by incrementing each one by the session count <b>16220</b>, input as increment <b>17200</b>.</p>
<p id="p-0226" num="0225">Moreover, the event modeler is designed to operate either in batch mode, for example for processing from scratch the entire set of website transactions during a data-collection period such as one hour; or in continual mode, for incrementally updating the models on the fly with a sliding window, for example by adding each transaction or each minute's worth of transactions as it occurs, and removing each transaction or increment of transactions as it ages beyond the data-collection period of, say, one hour. When operating in continual mode, switch <b>17190</b> changes the increment to negative one to remove an atomic event record, and changes the increment to the negative of the instance count <b>16220</b> to remove an event-type record from the running frequencies, as specified by remove flag <b>17180</b>.</p>
<p id="p-0227" num="0226">In an alternative embodiment, the joint keys&#x2014;transition identifier <b>16160</b>, timed-source identifier <b>16180</b>, and timed-target identifier <b>16140</b>&#x2014;are not directly stored in session event <b>16240</b>, but are constructed from the elemental keys&#x2014;source identifier <b>16020</b>, duration <b>16060</b>, and target identifier <b>16040</b>, as appropriate&#x2014;on the fly by transition-model updater <b>22010</b>, timed-source-model updater <b>23010</b>, and timed-target-model updater <b>24010</b>, respectively. This alternative is preferable when the storage space available to store keys in session event records is more critical than the time required to generate the joint keys.</p>
<p id="p-0228" num="0227">Information-flow diagram <figref idref="DRAWINGS">FIG. 18</figref> depicts an independent-event session comparator <b>18000</b>, a particularly simple type of session comparator <b>3070</b> for use in network-service threat detector <b>1060</b> (See <figref idref="DRAWINGS">FIG. 3</figref>), which scores each event in a client event session <b>16240</b> independently, using session-event stepper <b>18010</b> and event comparator <b>18020</b>, and uses session scorer <b>18030</b> to combine the event scores into session threat score <b>3080</b>. The session comparator also optionally uses privilege-threat analyzer <b>18040</b> to weight each event score according to the client's privilege level for the event; and also optionally uses intrinsic-threat analyzer <b>18050</b> to weight each event score according to the intrinsic threat level of the event.</p>
<p id="p-0229" num="0228">Session event stepper <b>18010</b> steps through the elemental event-type records or chronologically sorted atomic event records in client session <b>16240</b>, outputting them one at a time as session events <b>16240</b> to event comparator <b>18020</b>.</p>
<p id="p-0230" num="0229">Event comparator <b>18020</b> compares each event or event type to the model <b>17010</b> for that event type, outputting event anomaly score <b>18060</b> for that event. For elemental events, the event comparator also outputs the number of instances <b>16220</b> of that event type from the event-type record. The event comparator is discussed further under <figref idref="DRAWINGS">FIG. 20</figref>.</p>
<p id="p-0231" num="0230">For atomic events, session scorer <b>18030</b> uses score accumulator <b>18070</b> to accumulate the individual event anomaly scores <b>18060</b>, outputting threat score <b>3080</b> for the session as a whole. In the preferred embodiment, the event anomaly scores are additive, rather than multiplicative (See <figref idref="DRAWINGS">FIG. 27</figref>), to facilitate accumulating the scores for the many events in a long session without overflow. In the simplest embodiment, the session scorer simply adds all the event anomaly scores to produce the session threat score. For elemental events, the session scorer uses multiplier <b>18080</b> to multiply the anomaly score for each event type by the number of instances <b>16220</b> of that event type, outputting the result as event score <b>18090</b>, in which case score accumulator <b>18070</b> sums the events scores instead of the event anomaly scores to compute the session threat score.</p>
<p id="p-0232" num="0231">In the preferred embodiment, for evaluating session-hijacking threats such as man-in-the-browser threats and man-in-the-middle threats, where&#x2014;to avoid detection, to complete their fraudulent privileged transactions before the client closes the session, and to maximize the number of sessions hijacked under human supervision&#x2014;attackers are motivated to hijack a session as quickly and soon as possible after the client has successfully gained privileged access to a website, session comparator <b>18000</b> uses privilege threat analyzer <b>18040</b> to compute a time-damped weight <b>18100</b> according to how soon after login the corresponding anomalous event has occurred, based on the session-event records <b>16240</b>, and, in some embodiments, event index <b>18110</b> output by session-event stepper <b>18010</b>, and, for elemental events, event-instance count <b>16220</b>. For websites offering multiple echelons of privilege, the privilege-threat analyzer also weights the event score according to the privilege level. Privilege threat analyzer <b>18040</b> is discussed further under <figref idref="DRAWINGS">FIG. 19</figref>.</p>
<p id="p-0233" num="0232">When using privilege-threat analyzer <b>18040</b>, session scorer <b>18030</b> uses multiplier <b>18170</b> to multiply the score <b>18090</b> for each event or event type by corresponding privilege weight <b>18100</b>, outputting the result as weighted event score <b>18180</b>, in which case the session scorer sums the weighted event scores, rather than unweighted event scores <b>18090</b>, to produce session threat score <b>3080</b>.</p>
<p id="p-0234" num="0233">If website map <b>3110</b> containing information concerning intrinsic threat levels is available (See <figref idref="DRAWINGS">FIG. 4</figref>), then the session comparator also takes intrinsic threat levels into account, using intrinsic threat analyzer <b>18050</b> to determine the intrinsic threat weight <b>18120</b> for each event or event-type, in order to weight different intrinsic threat levels according to the preferences of the website security personnel.</p>
<p id="p-0235" num="0234">In detail, intrinsic threat analyzer <b>18050</b> uses intrinsic threat fetcher <b>18130</b> to look up the intrinsic threat level associated with session event <b>16240</b> in website map <b>3110</b>, outputting the result as intrinsic threat level <b>18140</b>. Intrinsic threat scorer <b>18150</b> then looks up the intrinsic threat score corresponding to the intrinsic threat level in table of intrinsic threat scores <b>18160</b>, outputting the result as intrinsic weight <b>18120</b>.</p>
<p id="p-0236" num="0235">When using intrinsic threat analyzer <b>18050</b>, session scorer <b>18030</b> uses multiplier <b>18170</b> to multiply the score <b>18090</b> for each event or event type by corresponding intrinsic threat weight <b>18100</b>, outputting the result as weighted event score <b>18180</b>. When using both the intrinsic threat analyzer and privilege-threat analyzer <b>18040</b>, the session scorer first uses multiplier <b>18190</b> to multiply the intrinsic threat weight by the privilege weight <b>18100</b>, outputting the result as event weight <b>18200</b>. It then multiplies the event weight by the event score to yield the weighted event score. In either case, the session scorer then sums the weighted event scores, rather than the unweighted event scores, to produce session threat score <b>3080</b>.</p>
<p id="p-0237" num="0236">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 19</figref>, privilege-threat analyzer <b>18040</b> analyzes the privilege-related threat of each input session event or session-event type <b>16240</b>, using privilege analyzer <b>19010</b>, privilege ager <b>19020</b>, aged-privilege rescaler <b>19030</b>, and privilege scorer <b>19040</b>, and outputting privilege weight <b>18100</b>.</p>
<p id="p-0238" num="0237">Specifically, for atomic session events <b>16240</b>, privilege-threat analyzer uses privilege analyzer <b>19010</b> to monitor the chronologically sorted input events for privilege-altering events such as login and logout events, secondary authentication events, and HTTP Upgrade events, outputting the current privilege level <b>19050</b> at the time of each event and the privilege duration <b>19060</b>&#x2014;the duration since the client last acquired that privilege level within the session.</p>
<p id="p-0239" num="0238">In the preferred embodiment, the privilege duration for a particular privilege level is the total client response delay, computed by summing the transition durations <b>16060</b> in each session event since the acquisition of that level of privilege, thereby discounting the phases when the client would ordinarily be waiting, rather than acting, including the transmission time, the serve time, and the load time. In an alternative embodiment, the privilege duration is the elapsed time since the instant of acquisition of that level of privilege, calculated as the difference between the time of the current event and the time of the privilege-acquisition event. In another alternative embodiment, the privilege duration is the number of client transactions since acquiring that privilege level, calculated as the difference in event index <b>18110</b> output by session event stepper <b>18010</b> (See <figref idref="DRAWINGS">FIG. 18</figref>) since the privilege was acquired.</p>
<p id="p-0240" num="0239">Privilege ager <b>19020</b> converts the privilege duration <b>19060</b> to a time-damped weight, outputting it as aged privilege <b>19070</b>, where the damping is governed by weight decay <b>19080</b>. Specifically, when the privilege duration is measured as elapsed time, the privilege ager uses multiplier <b>19090</b> to multiply the privilege duration by the weight decay, outputting the product as weighted age <b>19100</b>; and then uses exponentiator <b>19110</b> to take the exponential value of the weighted age, outputting the result as aged privilege <b>19070</b>, where for time measured in seconds, the weight decay is typically around the natural logarithm of two, so that the weight drops from 1 at the instant of privilege acquisition to &#xbd; a second later, to &#xbc; at the end of 2 seconds. When the privilege duration is measured in terms of the number of transition events, the aged privilege may alternatively be calculated recursively, by initializing it to 1 at the privilege-acquisition event, and multiplying the result by the weight decay at each subsequent event.</p>
<p id="p-0241" num="0240">For elemental session events, although neither the date nor the chronological event index is known for individual events, nevertheless if session analyzer <b>16000</b> (See <figref idref="DRAWINGS">FIG. 16</figref>) includes the privilege level in its event classification, then event types repeated within a session can be effectively aged by the minimal duration implied by the number of instances <b>16220</b> of that event type in the session. Thus for elemental session events, privilege pseudo-ager <b>19025</b> effectively ages each repeated event type by the number of instances that must have preceded it, in the simplest embodiment by multiplying the weight decay <b>19080</b> by itself as often as the event instance count, and summing the partial products, outputting the sum as pseudo-aged privilege <b>19070</b>. The preferred embodiment implements the closed-form formula for the geometric series, (d<sup>n+1</sup>&#x2212;d)/(d&#x2212;1), by using incrementer <b>19120</b> to add <b>1</b> to the event instance count n <b>16220</b> <b>13220</b>, outputting the result as exponent p=n+1 <b>19130</b>; using power operator <b>19140</b> to raise the weight decay <b>19080</b> to that exponent, outputting the result as power <b>19150</b>; using subtractor <b>19160</b> to subtract the weight decay from the power, outputting the result as numerator <b>19170</b>; and using divider <b>19200</b> to divide the numerator by divisor <b>19190</b>; where the divisor is computed by using decrementer <b>19180</b> to subtract one from the weight decay; the final result being output as pseudo-aged privilege <b>19070</b>.</p>
<p id="p-0242" num="0241">Rescaler <b>19030</b> rescales the damped series of aged-privilege weights to a minimum specified by weight floor <b>19210</b>, by using complementer <b>19220</b> to subtract the weight floor from 1, outputting the difference as floor complement <b>19230</b>; using multiplier <b>19240</b> to multiply the floor complement by aged privilege <b>19070</b>, outputting the result as scaled privilege <b>19250</b>; and using adder <b>19260</b> to add the scaled privilege to the weight floor, outputting the result as decayed weight <b>19270</b>. A positive weight floor ensures that hijackers will continue be detected even if they change their behavior to postpone their fraudulent transactions later in a session.</p>
<p id="p-0243" num="0242">Privilege scorer <b>19040</b> looks up privilege score <b>19280</b> corresponding to privilege level <b>19050</b> in table of privilege scores <b>19290</b> to weight different privilege levels according to the preferences of the website security personnel. Typical privilege score values for a website using logins with both password and secondary authorization are 0.1 for unlogged-in, 0.9 for logged-in with a password, and 1.0 for secondarily authorized, but other score values could be used.</p>
<p id="p-0244" num="0243">Finally, multiplier <b>19300</b> multiplies the privilege score <b>19280</b> by the decayed weight <b>19270</b>, outputting the result as privilege weight <b>18100</b>.</p>
<p id="p-0245" num="0244">In an alternative embodiment, privilege level <b>19050</b> is determined beforehand by session analyzer <b>16000</b> and stored in session event records <b>16240</b> (See <figref idref="DRAWINGS">FIG. 16</figref>).</p>
<p id="p-0246" num="0245">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 20</figref>, event comparator <b>18020</b> compares a session event <b>16240</b>, which is either an atomic session event or an elemental session-event type, to the event models <b>17010</b> for that type of event, and outputs corresponding event anomaly score <b>18060</b>. In MiB, MiM, and similar types of hijacking attacks, a fraudster uses a website account concurrently with a legitimate client of the account. The hijacker's website actions are thus interspersed with the legitimate client's actions.</p>
<p id="p-0247" num="0246">In order to maximize the chance of completing the fraudulent transactions and minimize the chance of being discovered, the fraudster's actions need to be executed quickly and early in the login session. Therefore, the hijacker does not have the leisure to insert actions at appropriate junctures in the legitimate client's flow. As a result, the combined flow of the client's and fraudster's actions shortly after login is likely to exhibit transitions which are anomalous, often not intrinsic to the website, and anomalously quick for normal sessions in general and especially for normal sessions of the victim. Moreover, the flow of the fraudster's actions alone is likely to exhibit transitions which are anomalous, non-intrinsic, and anomalously quick for normal sessions in general and especially for normal sessions of the victim, because the hijacker is likely to use a streamlined flow skipping normal but strictly unnecessary intermediate steps, and is likely to automate that flow.</p>
<p id="p-0248" num="0247">Thus, event comparator <b>18020</b> examines both the relative frequency and the relative duration of the event, comparing the observed frequency <b>20020</b> of the event type with the predicted frequency <b>20130</b> of the event type, as well as comparing the observed duration <b>20040</b> of the event or event type with the predicted duration <b>20140</b> of the event type.</p>
<p id="p-0249" num="0248">In detail, event frequency estimator <b>20010</b> estimates the relative frequency of session event type <b>16240</b> from event models <b>17010</b>, outputting observed event frequency <b>20020</b>.</p>
<p id="p-0250" num="0249">Event duration estimator <b>20030</b> estimates the duration of the event, outputting observed event duration <b>20040</b>. When session event <b>16240</b> is provided by atomic session stepper <b>8200</b> (See <figref idref="DRAWINGS">FIG. 18</figref>), duration estimator <b>20030</b> merely extracts the event duration, as adjusted by transaction synchronizer <b>5140</b> (See <figref idref="DRAWINGS">FIG. 6</figref>), from the session event record. When, on the other hand, the session event is provided by session event-type stepper <b>24010</b> (See <figref idref="DRAWINGS">FIG. 16</figref>) and the duration of individual events in the session is not known but the event type <b>24010</b> is specific to a coarsely quantized time interval, then the event duration estimator estimates the event duration as the mean duration of the event type, or, if that information is unavailable, the event duration is estimated as the mean duration of the quantized time interval, either of which is retrieved from event models <b>17010</b>.</p>
<p id="p-0251" num="0250">The event comparator uses one or more event frequency predictors <b>20050</b> to predict the event frequency from marginal event frequencies retrieved from event models <b>17010</b>, each event frequency predictor outputting a corresponding event frequency prediction <b>20060</b>. Exemplary individual event frequency predictors are described under <figref idref="DRAWINGS">FIG. 21</figref> through <figref idref="DRAWINGS">FIG. 24</figref>, and a combined event frequency predictor factoring out common operations among these four exemplary individual predictors is described under <figref idref="DRAWINGS">FIG. 25</figref>.</p>
<p id="p-0252" num="0251">Corresponding to each event frequency predictor <b>20050</b> is an event duration predictor <b>20070</b> which predicts the duration of the event or event type <b>16240</b> from event models <b>17010</b> corresponding to those used in the event frequency predictors, each event duration predictor outputting a corresponding event duration prediction <b>20080</b>.</p>
<p id="p-0253" num="0252">Optional anomalous event duration detector <b>20090</b> compares each individual event duration prediction <b>20080</b> with observed event duration <b>20040</b>, outputting predictor switch signal <b>20100</b> to turn individual event frequency predictors <b>20050</b> off for computational efficiency when the observed event duration is determined not to be anomalously brief by a particular event duration prediction.</p>
<p id="p-0254" num="0253">The anomalous event duration detector determines an event to be anomalously brief if the observed duration is less than the predicted duration minus a duration threshold <b>20110</b> or by another test. In the preferred embodiment, the duration threshold is zero, in order to postpone threat decisions until the anomaly of the entire session can be compared to the anomaly of all other sessions. Alternatively, if the number of detected attacks is expected to be substantially greater than threat processors <b>1080</b> (See <figref idref="DRAWINGS">FIG. 1</figref>) can handle, then the duration threshold can be adjusted upwards to throttle the least threatening events. The anomalous event duration detector is used as an efficiency optimization in embodiments where it reduces the computation time or other resource demands.</p>
<p id="p-0255" num="0254">Prediction combiner <b>20120</b> combines the individual event frequency predictions <b>20060</b> and corresponding event duration predictions <b>20080</b> into a single predicted event frequency <b>20130</b> and a single corresponding predicted event duration <b>20140</b>. The prediction combiner is detailed under <figref idref="DRAWINGS">FIG. 26</figref>.</p>
<p id="p-0256" num="0255">Event frequency scorer <b>20150</b> compares predicted event frequency <b>20130</b> with observed event frequency <b>20020</b>, taking frequency threshold <b>20170</b> into account, and outputs frequency anomaly score <b>20160</b>. In one embodiment, the event frequency scorer is switched off if duration anomaly score <b>20190</b> is below duration threshold <b>20110</b>, for computational efficiency. The event frequency scorer is discussed in greater detail under <figref idref="DRAWINGS">FIG. 27</figref>.</p>
<p id="p-0257" num="0256">Event duration scorer <b>20180</b> compares predicted event duration <b>20140</b> with observed event duration <b>20040</b>, taking duration threshold <b>20110</b> into account, and outputs duration anomaly score <b>20190</b>. In one embodiment, the event duration scorer is switched off if the frequency anomaly score is below frequency threshold <b>20170</b>, for computational efficiency. The event duration scorer is discussed in greater detail under <figref idref="DRAWINGS">FIG. 28</figref>.</p>
<p id="p-0258" num="0257">Event anomaly scorer <b>20200</b> inputs frequency anomaly score <b>20160</b> and duration anomaly score <b>20190</b>, and outputs event anomaly score <b>18060</b>. If either the frequency anomaly score or the duration anomaly score is nonpositive, the event anomaly scorer outputs an event anomaly score of zero. In the preferred embodiment, the event anomaly scorer combines the frequency anomaly score and duration anomaly score by multiplying them together, where the resulting product can be interpreted as the point-wise mutual information between the terms of the event, weighted by the anomalousness briefness of the event.</p>
<p id="p-0259" num="0258"><figref idref="DRAWINGS">FIG. 21</figref> through <figref idref="DRAWINGS">FIG. 25</figref> depict exemplary event frequency predictors for a simple timed-transition event&#x2014;that is, an event comprising three variables: a first source web service viewed by a client, a second target next viewed by the client, and the transition time between the services, where the transition time is ideally measured as the interval between the client's receipt of the source and the client's requesting the target. The frequency and duration of a timed transition can be predicted from the independent marginal frequencies of the source, transition time, and target, as in atomic predictor <b>21000</b> in <figref idref="DRAWINGS">FIG. 21</figref>; or from a biased predictor in which any dependence between two of the three variables is taken into account: from the submarginal joint frequency of the source-to-target transition and the marginal frequency of the transition, as in biased frequency predictor TxAB <b>22000</b> in <figref idref="DRAWINGS">FIG. 22</figref>; from the submarginal joint frequency of the timed source and the marginal frequency of the target, as in timed source predictor <b>23000</b> in <figref idref="DRAWINGS">FIG. 23</figref>; or from the marginal frequency of the source and the submarginal joint frequency of the timed target, as in timed target predictor <b>24000</b> in <figref idref="DRAWINGS">FIG. 24</figref>. For those predictors which do not refer to the frequency of the specific transition&#x2014;the AxTxB, BxTA, and AxTB predictors&#x2014;the prediction can optionally be refined by the frequency of the linkage type, if that information is available. <figref idref="DRAWINGS">FIG. 25</figref> combines all four of these predictors for computational efficiency when all four predictors are executed by the same processor. It should be noted that some embodiments include less than all four predictors.</p>
<p id="p-0260" num="0259">As depicted in <figref idref="DRAWINGS">FIG. 21</figref>, atomic timed-transition predictor <b>21000</b> uses source-model fetcher <b>21010</b> to look up source frequency <b>17030</b> corresponding to source identifier <b>16020</b>, transition-duration-model fetcher <b>21020</b> to look up transition-duration frequency <b>17050</b> corresponding to transition-duration identifier <b>16060</b>, target-model fetcher <b>21030</b> to look up target frequency <b>17070</b> corresponding to target identifier <b>16040</b>, optional linkage-model fetcher <b>21040</b> to look up linkage-type frequency <b>17150</b> corresponding to linkage identifier <b>16200</b>, and frequency-norm fetcher <b>21070</b> to look up event-frequency norm <b>17170</b>, where the source identifier, duration identifier, target identifier, and linkage-type identifier are input from session event <b>16240</b>, and the corresponding models and the frequency norm are retrieved from event models <b>17010</b>. Multiplier <b>21050</b> then multiplies together the source frequency, the duration frequency, the target frequency, and optionally the linkage frequency <b>17150</b>, outputting the product as absolute AxTxB frequency <b>21060</b>. Power operator <b>21080</b> multiplies the frequency norm to the fourth power, outputting the result as quadruple norm <b>21090</b>. Finally, normalizer <b>21100</b> divides the absolute AxTxB frequency by the quadruple norm, outputting the relative frequency as independent frequency prediction AxTxB <b>21110</b>. If the linkage frequency is not included in the combined frequency computation, then the power operator only raises the norm to the third power.</p>
<p id="p-0261" num="0260">In atomic timed-transition predictor <b>21000</b>, duration model fetcher <b>21020</b> also looks up duration <b>21120</b> corresponding to duration identifier <b>16060</b> in session event record <b>16240</b>, which it outputs as duration <b>21120</b>. Multiplier <b>21130</b> multiplies the duration by the duration frequency <b>17050</b>, outputting the product as total duration <b>21140</b>. Divider <b>21150</b> then divides the total duration by the absolute atomic frequency <b>21060</b>, outputting the quotient as independent duration prediction <b>21160</b>.</p>
<p id="p-0262" num="0261">As depicted in <figref idref="DRAWINGS">FIG. 22</figref>, biased frequency predictor TxAB <b>22000</b> uses transition-duration-model fetcher <b>21020</b> to look up transition-duration frequency <b>17050</b> corresponding to transition-duration identifier <b>16060</b>, transition-model fetcher <b>22010</b> to look up transition frequency <b>17110</b> corresponding to transition identifier <b>16160</b>, and frequency-norm fetcher <b>21070</b> to look up event-frequency norm <b>17170</b>, where the duration identifier and transition identifier are input from session event <b>16240</b>, and the corresponding models and the frequency norm are retrieved from event models <b>17010</b>. Multiplier <b>22020</b> then multiplies together the duration frequency and the transition frequency, outputting the product as absolute TxAB frequency <b>22030</b>. Power operator <b>22040</b> squares the frequency norm, outputting the result as double norm <b>22050</b>. Finally, normalizer <b>22060</b> divides the absolute TxAB frequency by the double norm, outputting the relative frequency as biased frequency prediction TxAB <b>22070</b>.</p>
<p id="p-0263" num="0262">In biased predictor TxAB <b>22000</b>, duration-model fetcher <b>21020</b> also looks up duration <b>21120</b> corresponding to duration identifier <b>16060</b> in session event record <b>16240</b>, which it outputs as duration <b>21120</b>. Multiplier <b>21130</b> multiplies the duration by the duration frequency <b>17050</b>, outputting the product as total duration <b>21140</b>. Divider <b>21150</b> then divides the total duration by the absolute TxAB frequency <b>22030</b>, outputting the quotient as biased duration prediction TxAB <b>22080</b>.</p>
<p id="p-0264" num="0263">As depicted in <figref idref="DRAWINGS">FIG. 23</figref>, biased frequency predictor BxTA <b>23000</b> uses target-model fetcher <b>21030</b> to look up target frequency <b>17070</b> corresponding to target identifier <b>16040</b>, timed-source-model fetcher <b>23010</b> to look up timed-source frequency <b>17130</b> corresponding to timed-source identifier <b>16180</b>, optional linkage-model fetcher <b>21040</b> to look up linkage-type frequency <b>17150</b> corresponding to linkage identifier <b>16200</b>, and frequency-norm fetcher <b>21070</b> to look up event-frequency norm <b>17170</b>, where the target identifier, timed-source identifier, and linkage-type identifier are input from session event <b>16240</b>, and the corresponding models and the frequency norm are retrieved from event models <b>17010</b>. Multiplier <b>23020</b> then multiplies together the target frequency, the timed-source frequency, and optionally the linkage frequency <b>17150</b>, outputting the product as absolute BxTA frequency <b>23030</b>. Power operator <b>23040</b> multiplies the frequency norm to the third power, outputting the result as triple norm <b>23050</b>. Finally, normalizer <b>23060</b> divides the absolute BxTA frequency by the triple norm, outputting the relative frequency as biased frequency prediction BxTA <b>23070</b>. If the linkage frequency is not included in the combined frequency computation, then the power operator only raises the norm to the second power.</p>
<p id="p-0265" num="0264">In biased predictor BxTA <b>23000</b>, timed-source-model fetcher <b>23010</b> also looks up duration <b>21120</b> corresponding to timed-source identifier <b>16180</b> in session event record <b>16240</b>, which it outputs as duration <b>21120</b>. Multiplier <b>21130</b> multiplies the duration by the timed-source frequency <b>17130</b>, outputting the product as total duration <b>21140</b>. Divider <b>21150</b> then divides the total duration by the absolute BxTA frequency <b>23030</b>, outputting the quotient as biased duration prediction BxTA <b>23080</b>.</p>
<p id="p-0266" num="0265">Similarly, as depicted in <figref idref="DRAWINGS">FIG. 24</figref>, biased frequency predictor AxTB <b>24000</b> uses source-model fetcher <b>21010</b> to look up source frequency <b>17030</b> corresponding to source identifier <b>16020</b>, timed-target-model fetcher <b>24010</b> to look up timed-target frequency <b>17090</b> corresponding to timed-target identifier <b>16140</b>, optional linkage-model fetcher <b>21040</b> to look up linkage-type frequency <b>17150</b> corresponding to linkage identifier <b>16200</b>, and frequency-norm fetcher <b>21070</b> to look up event-frequency norm <b>17170</b>, where the source identifier, timed-target identifier, and linkage-type identifier are input from session event <b>16240</b>, and the corresponding models and the frequency norm are retrieved from event models <b>17010</b>. Multiplier <b>23020</b> then multiplies together the source frequency, the timed-target frequency, and optionally the linkage frequency <b>17150</b>, outputting the product as absolute AxTB frequency <b>24020</b>. As in AxTB frequency predictor <b>23000</b> (See <figref idref="DRAWINGS">FIG. 23</figref>), power operator <b>23040</b> multiplies the frequency norm to the third power, outputting the result as triple norm <b>23040</b>. Finally, normalizer <b>23060</b> divides the absolute AxTB frequency by the triple norm, outputting the relative frequency as biased frequency prediction AxTB <b>24030</b>. If the linkage frequency is not included in the combined frequency computation, then the power operator only raises the norm to the second power.</p>
<p id="p-0267" num="0266">In biased predictor AxTB <b>24000</b>, timed-target-model fetcher <b>24010</b> also looks up duration <b>21120</b> corresponding to timed-target identifier <b>16140</b> in session event record <b>16240</b>, which it outputs as duration <b>21120</b>. Multiplier <b>21130</b> multiplies the duration by the timed-target frequency <b>17090</b>, outputting the product as total duration <b>21140</b>. Divider <b>21150</b> then divides the total duration by the absolute AxTB frequency <b>24020</b>, outputting the quotient as biased duration prediction AxTB <b>24040</b>.</p>
<p id="p-0268" num="0267">As depicted in <figref idref="DRAWINGS">FIG. 25</figref>, combined timed-transition predictor <b>25000</b> uses source-model fetcher <b>21010</b> to look up source frequency <b>17030</b> corresponding to source identifier <b>16020</b>, transition-duration-model fetcher <b>21020</b> to look up transition-duration frequency <b>17050</b> corresponding to transition-duration identifier <b>16060</b>, target-model fetcher <b>21030</b> to look up target frequency <b>17070</b> corresponding to target identifier <b>16040</b>, timed-target-model fetcher <b>24010</b> to look up timed-target frequency corresponding to timed-target identifier <b>16140</b>, transition-model fetcher <b>22010</b> to look up transition frequency <b>17110</b> corresponding to transition identifier <b>16160</b>, timed-source-model fetcher <b>23010</b> to look up timed-source frequency <b>17130</b> corresponding to timed-source identifier <b>16180</b>, optional linkage-model fetcher <b>21040</b> to look up linkage-type frequency <b>17150</b> corresponding to linkage identifier <b>16200</b>, and frequency-norm fetcher <b>21070</b> to look up event-frequency norm <b>17170</b>, where the source identifier, transition-duration identifier, target identifier, timed-target identifier, transition identifier, timed-source identifier, and linkage-type identifier are input from session event <b>16240</b>, and the corresponding models and the frequency norm are retrieved from event models <b>17010</b>.</p>
<p id="p-0269" num="0268">Multiplier <b>25050</b> squares the frequency norm <b>17170</b>, outputting the result as double norm <b>20050</b>; multiplier <b>25060</b> multiplies the double norm again by the norm, outputting the result as triple norm <b>23050</b>; and multiplier <b>25070</b> multiplies the triple norm yet again by the norm, outputting the result as quadruple norm <b>21090</b>.</p>
<p id="p-0270" num="0269">As in independent frequency predictor AxTxB <b>21000</b>, atomic frequency predictor AxTxB <b>25010</b> multiplies together the source frequency <b>17030</b>, the duration frequency <b>17050</b>, the target frequency <b>17070</b>, and optionally the linkage frequency <b>17150</b>, dividing the resulting absolute AxTxB frequency <b>21060</b> by quadruple norm <b>21090</b> and outputting the resulting relative frequency as independent frequency prediction AxTxB <b>21110</b>. As in biased frequency predictor AxTB <b>24000</b>, biased frequency predictor AxTB <b>25020</b> multiplies together the source frequency, the timed-target frequency, and optionally the linkage frequency, dividing the resulting absolute AxTB frequency by triple norm <b>23050</b>, and outputting the resulting relative frequency as biased frequency prediction AxTB <b>24030</b>. As in biased frequency predictor TxAB <b>22000</b>, biased frequency predictor TxAB <b>25030</b> multiplies together the duration frequency and the transition frequency, dividing the resulting absolute TxAB frequency by double norm <b>20050</b>, and outputting the resulting relative frequency as biased frequency prediction TxAB <b>22070</b>. And as in biased frequency predictor BxTA <b>23000</b>, biased frequency predictor BxTA <b>25040</b> multiplies together the target frequency, the timed-source frequency, and optionally the linkage frequency, dividing the resulting absolute BxTA frequency by triple norm <b>23050</b>, and outputting the resulting relative frequency as biased frequency prediction BxTA <b>23070</b>. If the linkage frequency is not included in the combined frequency computations, then the AxTxB predictor <b>25010</b> uses the triple norm instead of the quadruple norm, and the AxTB predictor <b>25020</b> and BxTA predictor <b>25040</b> use the double norm instead of the triple norm.</p>
<p id="p-0271" num="0270">Combined predictor <b>25000</b> also outputs the respective duration predictions as in <figref idref="DRAWINGS">FIG. 21</figref> though <figref idref="DRAWINGS">FIG. 24</figref>.</p>
<p id="p-0272" num="0271">In an alternative embodiment, the joint keys&#x2014;transition identifier <b>16160</b>, timed-source identifier <b>16180</b>, and timed-target identifier <b>16140</b>&#x2014;are not directly stored in session event <b>16240</b>, but are constructed from the elemental keys&#x2014;source identifier <b>16020</b>, transition duration <b>16060</b>, and target identifier <b>16040</b>, as appropriate&#x2014;on the fly by transition-model fetcher <b>22010</b>, timed-source-model fetcher <b>23010</b>, and timed-target-model fetcher <b>24010</b>, respectively. This alternative is preferable when the storage space available to store keys in session event records is more critical than the time required to regenerate the joint keys.</p>
<p id="p-0273" num="0272">In an alternative embodiment, double frequency norm <b>20050</b>, triple frequency norm <b>23050</b>, and quadruple frequency norm <b>21090</b> are precomputed and stored in event models <b>17010</b>, rather than being computed in the event predictor. This alternative is preferable when memory access is quicker than multiplication.</p>
<p id="p-0274" num="0273">In an alternative embodiment, the marginal frequencies (source frequency <b>17030</b>, duration frequency <b>17050</b>, and target frequency <b>17070</b>) and submarginal frequencies (transition frequency <b>17110</b>, timed-source frequency <b>17130</b>, and timed-target frequency <b>17090</b>) are not precomputed and stored in event models database <b>17010</b>, but are instead computed on the fly from atomic events or from elemental frequencies by the marginal frequency fetchers (source-frequency fetcher <b>21010</b>, duration-frequency fetcher <b>21020</b>, and target-frequency fetcher <b>21030</b>) and intermediate frequency fetchers (transition-frequency fetcher <b>22010</b>, timed-source-frequency fetcher <b>23010</b>, and timed-target-frequency fetcher <b>24010</b>), respectively. This alternative embodiment is preferable when the storage space available for event models is more critical than the time available to compute the marginal and submarginal frequencies on the fly.</p>
<p id="p-0275" num="0274">The marginal frequencies (source frequency <b>17030</b>, duration frequency <b>17050</b>, and target frequency <b>17070</b>) and submarginal frequencies (transition frequency <b>17110</b>, timed-source frequency <b>17130</b>, and timed-target frequency <b>17090</b>) as stored in event models database <b>17010</b> and output by the respective frequency fetchers may be either absolute, in which case they can be represented exactly as integers; or relative, in which case they must be represented as approximate fractions or as space-inefficient rational numbers.</p>
<p id="p-0276" num="0275">However, whereas atomic prediction <b>21110</b> is a product of three marginal frequencies, the submarginal predictions (transition prediction <b>22070</b>, timed-source prediction <b>23070</b>, and timed-target prediction <b>24030</b>), are products of only two frequencies, so if these products are computed from absolute frequencies, then to make the atomic frequency commensurate with the submarginal frequencies, either the submarginal frequencies must be multiplied by the norm, permitting the products to continue to be represented exactly as integers; or the atomic prediction must be divided by the norm, in which case the product must be approximated as a fraction or maintained as a rational number. This commensuration may be implemented at any stage between the end of event frequency predictors <b>20050</b> and the beginning of prediction combiner <b>20120</b>. Note that, at least for straightforward relative frequency estimation, all the atomic, marginal, and submarginal frequencies have the same norm, which is the total timed-transition frequency, obtained from the event models database.</p>
<p id="p-0277" num="0276">In some embodiments, the event models <b>17010</b> are stored in a sparse array such as a heap, rather than as a complete array or complete tree, in order to conserve memory. For a large website, the number of observed transition types would otherwise require an impractically large complete array.</p>
<p id="p-0278" num="0277">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 26</figref>, prediction combiner <b>15130</b> inputs the individual event frequency predictions <b>20060</b> and the individual event duration predictions <b>20080</b>, combining them to output predicted event frequency <b>20130</b> and predicted event duration <b>20140</b>, respectively.</p>
<p id="p-0279" num="0278">In a preferred embodiment, the prediction combiner uses maximum selector <b>26010</b> to select the maximum event frequency prediction for output as the predicted event frequency, and, via prediction switch <b>26020</b>, uses selector <b>26030</b> to select the corresponding event duration prediction for output as the predicted event duration. The use of the maximum here implies that that an event is not to be considered unusual if any of a set of equally credible predictors shows that it is not unusual. In an alternative embodiment (not shown), a prediction combiner computes the Bayesian mean of the input frequency predictions and duration predictions, and outputs the means as the predicted event frequency and predicted event duration, respectively.</p>
<p id="p-0280" num="0279">As depicted in <figref idref="DRAWINGS">FIG. 27</figref>, event frequency scorer <b>20150</b> inputs observed event frequency <b>20020</b> and predicted event frequency <b>20130</b>, compares them using event frequency comparator <b>27010</b>, normalizes the result, and outputs frequency anomaly score <b>20160</b>.</p>
<p id="p-0281" num="0280">Event frequency comparator <b>27010</b> uses differencer <b>27020</b> to compare observed event frequency <b>20020</b> to predicted event frequency <b>20130</b>, outputting the difference as frequency excess <b>27030</b>. Next, adder <b>27040</b> adds frequency threshold <b>20170</b> to the frequency excess, outputting adjusted frequency excess <b>27050</b>. Frequency thresher <b>27060</b> then tests whether the adjusted frequency excess is greater than zero, indicating that the event is not anomalous, in which case it outputs a zero <b>27070</b> as the frequency-anomaly score <b>20160</b>. For computational efficiency, the thresher may also optionally input duration anomaly score <b>20190</b>. If the duration anomaly score is below duration threshold <b>20110</b>, then the event is likewise determined not to be anomalous, and the thresher likewise outputs a frequency anomaly score of zero.</p>
<p id="p-0282" num="0281">In a preferred embodiment, the frequency threshold is omitted or set to zero, in order to postpone threat decisions until the anomaly of the entire session can be compared to the anomaly of all other sessions. Alternatively, if the number of detected attacks is expected to be substantially greater than threat processors <b>1080</b> (See <figref idref="DRAWINGS">FIG. 1</figref>) can handle, then the frequency threshold can be adjusted upwards to throttle the least threatening events.</p>
<p id="p-0283" num="0282">If, on the other hand, frequency thresher <b>27060</b> determines the event to be anomalous, then it passes the observed event frequency <b>20020</b> through as threshed event frequency <b>27080</b>.</p>
<p id="p-0284" num="0283">Event frequency normalizer then divides <b>27090</b> the threshed event frequency by predicted event frequency <b>20130</b>, outputting the result as frequency ratio <b>27100</b>. Outputting the frequency ratio rather than the absolute observed frequency ensures that the observed frequency of each event is evaluated only with respected to the predicted frequency of that event, and independently of the absolute frequencies of unrelated events.</p>
<p id="p-0285" num="0284">Since the observed event frequency <b>20020</b> is a simple frequency, whereas the predicted event frequency <b>20130</b> is a frequency product, if the frequencies are represented as absolute frequencies, then in order to make the observed event frequency commensurate with the predicted frequency, either the observed event frequency is multiplied by the norm, or the predicted event frequency is divided by the norm. This commensuration may be implemented at any stage between the end of event frequency estimator <b>20010</b> or event frequency predictor <b>20050</b> and prior to comparison in the event frequency comparator or normalization in event frequency normalizer <b>27090</b>. Postponing this commensuration until the end of prediction combiner <b>20120</b> can reduce the amount of computation.</p>
<p id="p-0286" num="0285">Finally, log <b>27110</b> calculates the logarithm of frequency ratio <b>27100</b>, outputting the result as frequency anomaly score <b>20160</b>. Using the logarithm rather than the ratio itself as the event score permits session comparator <b>3070</b> (See <figref idref="DRAWINGS">FIG. 3</figref>) to sum the event anomalies rather than multiplying them, thus avoiding overflow.</p>
<p id="p-0287" num="0286">As logarithms of the ratio of the relative joint frequency to the product of the relative marginal frequencies, frequency anomaly scores <b>20160</b> can be interpreted as measuring the point-wise mutual information between the marginal dimensions. In the preferred embodiment, <b>27110</b> calculates the base-2 logarithm, so that the score is measured in bits. In particular, in the case of timed transitions, independent frequency predictor AxTxB <b>21000</b> measures the point-wise mutual information between the source, transition time, and target; biased frequency predictor TxAB <b>21050</b> measure the point-wise mutual information between the transition time and the service transition; biased frequency predictor BxTA <b>23000</b> measures the point-wise mutual information between the target and the timed source; and biased frequency predictor <b>24000</b> measures the point-wise mutual information between the source and the timed target. Although point-wise mutual information can be nonpositive, event anomaly scorer <b>20200</b> ensures that only positive scores are output; That is, the session anomaly is determined only by anomalous events, so that no number of normal events can compensate for anomalous ones. This is in accordance with the fact that man-in-the-browser, man-in-the-middle, and similar attacks characteristically comprise a few brief events, typically near the beginning of a session, irrespective of how long the session lasts.</p>
<p id="p-0288" num="0287">As depicted in <figref idref="DRAWINGS">FIG. 28</figref>, event duration scorer <b>20180</b> inputs predicted event duration <b>20140</b> and observed event duration <b>20040</b>, compares them using event duration comparator <b>28010</b>, normalizes the result, and outputs duration anomaly score <b>20190</b>.</p>
<p id="p-0289" num="0288">Event duration comparator <b>28010</b> uses differencer <b>28020</b> to compare observed event duration <b>20040</b> to predicted event duration <b>20140</b>, outputting the difference as duration shortfall <b>28030</b>. Next, adder <b>28040</b> adds duration threshold <b>20110</b> to the duration shortfall, outputting adjusted duration shortfall <b>28050</b>. Duration thresher <b>28060</b> then tests whether the adjusted duration shortfall is greater than zero, indicating that the event is not anomalous, in which case it outputs a zero <b>28070</b> as the duration-anomaly score <b>20190</b>. For computational efficiency, the thresher may also optionally input frequency-anomaly score <b>20160</b>; if the frequency-anomaly score is less than frequency threshold <b>20170</b>, then the event is likewise determined not to be anomalous, and the thresher likewise outputs a duration-anomaly score of zero. In the preferred embodiment, the duration threshold is omitted or set to zero, in order to postpone threat decisions until the anomaly of the entire session can be compared to the anomaly of all other sessions. Alternatively, if the number of detected attacks is expected to be substantially greater than threat processors <b>1080</b> (See <figref idref="DRAWINGS">FIG. 1</figref>) can handle, then the duration threshold can be adjusted upwards to throttle the least threatening events. If, on the other hand, the event duration comparator determines that the event is anomalous, then it passes the adjusted duration shortfall through as threshed duration shortfall <b>28080</b>.</p>
<p id="p-0290" num="0289">Event duration normalizer <b>28090</b> then divides the threshed duration shortfall <b>28080</b> by the predicted event duration <b>20140</b> to yield duration anomaly score <b>20190</b>, ranging from zero if the event duration is not anomalous at all, to one if the event duration is as anomalously brief as possible.</p>
<p id="p-0291" num="0290">As has now been explained, a network security system can include detection of man-in-the-browser attacks and other attacks using a variety of tools and approaches. Further embodiments can be envisioned to one of ordinary skill in the art after reading this disclosure. In other embodiments, combinations or sub-combinations of the above disclosed invention can be advantageously made. The example arrangements of components are shown for purposes of illustration and it should be understood that combinations, additions, re-arrangements, and the like are contemplated in alternative embodiments of the present invention. Thus, while the invention has been described with respect to exemplary embodiments, one skilled in the art will recognize that numerous modifications are possible.</p>
<p id="p-0292" num="0291">For example, the processes described herein may be implemented using hardware components, software components, and/or any combination thereof. The specification and drawings are, accordingly, to be regarded in an illustrative rather than a restrictive sense. It will, however, be evident that various modifications and changes may be made thereunto without departing from the broader spirit and scope of the invention as set forth in the claims and that the invention is intended to cover all modifications and equivalents within the scope of the following claims.</p>
<p id="p-0293" num="0292">As depicted in block diagram <figref idref="DRAWINGS">FIG. 29</figref>, exemplary server traffic processor <b>2010</b> (See <figref idref="DRAWINGS">FIG. 2</figref>) uses channeler <b>29050</b> to entrain host-instigated traffic between clients <b>1010</b> and third-party partner services <b>1150</b>, so that it can be logged, along with traffic between the clients and primary network service <b>1015</b>, by logger <b>29150</b> for analysis by threat detector <b>1060</b>, reviewed by threat processors <b>1080</b>, and, when necessary, remediated by remediator <b>29160</b>. The figure gives an example of one way in which the channeler may be integrated with other processes commonly found in a network service traffic processor, such as firewalls <b>29010</b> and <b>29090</b>, authenticators <b>29020</b>, encrypters <b>29120</b> and decrypters <b>29030</b>, compressors <b>29110</b> and decompressors <b>29040</b>, link translators <b>29080</b>, reformatters <b>29100</b>, and load balancers <b>29105</b>.</p>
<p id="p-0294" num="0293">Traffic from clients <b>1010</b> and destined for host <b>1015</b>, entrained traffic from clients and destined for partners <b>1150</b>, and entrained traffic from partners destined for clients all enters service traffic processor <b>2010</b> through front firewall <b>29010</b>, which protects the host site from the external network by using low-level security features such as IP+port blocking and plaintext packet filtering. Traffic from the host destined for clients, entrained traffic from clients destined for partners, and entrained traffic from partners destined for clients likewise all exits the service traffic processor through the front firewall.</p>
<p id="p-0295" num="0294">Authenticator <b>29020</b> is responsible for negotiation of encryption protocols such as SSL and TSL with clients <b>1010</b> and partners <b>1150</b>, and for low-level verification of the identity of the clients and partners and confirmation of the identity of the host as its proxy, for example via SSL certificates.</p>
<p id="p-0296" num="0295">Decrypter <b>29030</b> converts securely encrypted incoming actions from clients <b>1010</b> and partners <b>1150</b> containing personal or proprietary information into plaintext so that it can be examined by channeler <b>29050</b> and rear firewall <b>29090</b>, and acted upon by host <b>1015</b>. Encrypter <b>29120</b> encrypts plaintext outgoing actions from the host and reencrypts outgoing actions relayed between clients and partners to shield sensitive information en route across the network to the clients and partners.</p>
<p id="p-0297" num="0296">Similarly, decompressor <b>29040</b> decompresses incoming actions from clients <b>1010</b> and partners <b>1150</b> into plaintext so that it can be examined by channeler <b>29050</b> and rear firewall <b>29090</b>, and acted upon by host <b>1015</b>. Compressor <b>29110</b> compresses outgoing actions such as HTML content from the host and recompresses actions relayed between clients and partners for faster transmission across the network.</p>
<p id="p-0298" num="0297">Channeler <b>29050</b> uses channeler router <b>29060</b> to separate inbound traffic from clients <b>1010</b> destined for host <b>1015</b>, which it routes through host channeler <b>29070</b>, from bidirectional entrained traffic between clients and partners <b>1150</b>, which it routes through partner channelers <b>29140</b>, short-circuiting it from the host. Host channeler <b>29070</b> edits outgoing host traffic to entrain client responses back through the partner channelers. Likewise, partner channelers <b>29140</b> edit outgoing partner-client traffic to entrain client responses back through the partner channelers. The channeler is discussed in greater detail under <figref idref="DRAWINGS">FIG. 30</figref>.</p>
<p id="p-0299" num="0298">Link translator <b>29080</b> remaps externally visible URL aliases in client requests back to the corresponding actual internal URLs, permitting the public structure of the host site to appear simple, constant, and user-friendly, while shielding the actual site structure from potential malefactors.</p>
<p id="p-0300" num="0299">Rear firewall <b>29090</b> remediates threats in inbound decrypted decompressed client actions, using higher-level features such as application-attack detection and malware detection. The rear firewall also remediates threats in outbound host actions, such as sensitive information disclosure and policy violations.</p>
<p id="p-0301" num="0300">Load balancer <b>29100</b> distributes client actions among the host website servers or data centers in network service <b>1015</b>, and routes back the corresponding host actions. A larger installation will often have load balancers at many junctures in the service traffic processor, each feeding multiple instances of its downstream components, in order to efficiently handle higher network traffic. For example, authentication <b>29020</b>, decryption <b>29030</b>, encryption <b>29120</b>, decompression <b>29040</b>, compression <b>29110</b>, channeling <b>29050</b>, and reformatting <b>29105</b> are all compute-intensive processes, so a busy site may have one or more load balancers between the front firewall and multiple authenticators and decrypters, a load balancer between the rear firewall and multiple reformatters, and so on.</p>
<p id="p-0302" num="0301">Reformatter <b>29105</b> reformats outgoing host actions for specific client devices, such as mobile phones, that have different constraints such as bandwidth, processing power, spatial and temporal display resolution, and interactivity.</p>
<p id="p-0303" num="0302">Throttler <b>29130</b> buffers host actions and outgoing partner actions as necessary and feeds them out at a controlled rate to match the transmission bandwidth to the client and other rate constraints.</p>
<p id="p-0304" num="0303">Logger <b>29150</b> records each transaction, possibly from each layer in service traffic processor <b>2010</b>, including not just all client-host and host-client actions as at an ordinary site, but also all host-related client-partner-client transactions, for analysis by network-service threat detector <b>1060</b>, using a single master clock for accurate timing. In the preferred embodiment, the transaction times are recorded as close to the client as possible&#x2014;ideally at the front firewall in the configuration shown&#x2014;in order to bound the clients' action delay as tightly as possible, for accurate threat analysis. The logger may also obtain additional transaction information from the host site <b>1015</b>, as available and useful. Conversely, the network service may also augment its own logs with information from logger <b>29150</b>, or may even supplant its own logs with those from the service traffic processor's logger.</p>
<p id="p-0305" num="0304">As explained in the bulk of this disclosure, threat detector <b>1060</b> analyzes the transaction records output by logger <b>29150</b> and network service <b>1015</b> for different types of network service threats, outputting alerts and reports to threat processors <b>1080</b>.</p>
<p id="p-0306" num="0305">Threat processors <b>1080</b>, in turn, output remedial-action rules to remediator <b>29160</b>, which implements the remedial actions through the appropriate components in service traffic processor <b>2010</b> via enforcer <b>29170</b>.</p>
<p id="p-0307" num="0306">In the preferred embodiment, each stage of service traffic processor <b>2010</b> requiring significant processing power, including reformatters <b>29105</b>, link translators <b>29080</b>, host channelers <b>29070</b>, partner channelers <b>29140</b>, decompressors <b>29040</b> and compressors <b>291110</b>, and decrypters <b>29030</b> and encrypters <b>29120</b>, utilizes a cache for efficient service, outputting a cached copy of a processed resource if the unprocessed resource matches.</p>
<p id="p-0308" num="0307">The deployment of channeler <b>29050</b> to service traffic processor <b>2010</b> may introduce new software bugs and incompatibilities, new risks of incorrect link mapping, new resource strains, and new opportunities for attack. Accordingly, the preferred embodiment also includes monitors <b>29190</b>, showing real-time diagnostic information such as current and comparative rates of host-channeler traffic and partner-channeler traffic for each partner, as well as related errors and remediation actions, for monitoring by threat processors <b>1080</b>&#x2014;either the same threat processors as for threat detector <b>1060</b> or independent threat processors.</p>
<p id="p-0309" num="0308">The addition of client-server and server-client traffic may substantially increase the load on an established service traffic processor. In such cases, in the preferred embodiment, router <b>29060</b> is situated in front to offload partner channeler <b>29140</b> onto a separate service traffic processor from host channeler <b>29070</b>, with its own front-end components, such as front firewall <b>29010</b>, authenticator <b>29020</b>, decrypter <b>29030</b> and encrypter <b>29120</b>, decompressor <b>29040</b> and compressor <b>29110</b>, throttler <b>29110</b>, and cache <b>29180</b>. In an alternative embodiment, this separate service traffic processor is located elsewhere on the exterior network, perhaps along with threat detector <b>1060</b>, threat processors <b>1080</b>, and remediator <b>29160</b>, with the host-channeler logs relayed to the partner-channeler site over a dedicated line or encrypted network traffic, and the host-channeler logger synchronized to the partner-channeler logger for accuracy.</p>
<p id="p-0310" num="0309">Depending on network service traffic characteristics, cost, existing infrastructure, availability, expertise, and other considerations, the various components of service traffic processor <b>2010</b> may be embodied as software modules in one or more physical or virtual servers, hardware components, a network of servers, a cloud computing center, or any combination of these and other possibilities.</p>
<p id="p-0311" num="0310">Those skilled in the art will recognize that these and other front-end components could be employed in many alternative configurations, including employing multiple instances of various components, employing them in a different order, or omitting some of the components or adding others.</p>
<p id="p-0312" num="0311">As depicted in information-flow diagram <figref idref="DRAWINGS">FIG. 30</figref>, channeler <b>29050</b> (See <figref idref="DRAWINGS">FIG. 29</figref>) entrains host-related traffic between clients <b>1010</b> and third-party partner services <b>1150</b> through partner channelers <b>29140</b>, where the traffic&#x2014;which would otherwise pass invisibly and inaccessibly between the clients and the partner services&#x2014;is logged by logger <b>29150</b> to be monitored by monitors <b>29190</b> (See <figref idref="DRAWINGS">FIG. 29</figref>), analyzed by threat detector <b>1060</b>, remediated by remediator <b>29160</b>, and optionally accessed by host website <b>1015</b>. The channeler entrains host-introduced client-partner traffic by interposing host channeler <b>29070</b> as reverse host*proxy <b>30010</b> to the clients and as forward client*proxy <b>30030</b> to the host servers, where partner paraproxy <b>30020</b> processes the contents of host-client actions <b>1040</b>, finds all references to targeted partner services therein, and replaces them with reversibly mapped aliases referring to the partner channeler.</p>
<p id="p-0313" num="0312">Similarly, a partner channeler <b>29140</b>, which acts as mediate partner*proxy <b>30040</b> to the clients, entrains responsive partner-client traffic by acting as mediate client*proxy <b>30060</b> to partners <b>1150</b>, and entrains subsequent partner-conducted client-partner traffic by using partner paraproxy <b>30050</b> to find all targeted partner references in the contents of partner-client actions <b>1190</b> and reversibly alias them to the partner channeler.</p>
<p id="p-0314" num="0313">In detail, the network is configured so that client requests <b>1020</b> destined for the primary network service <b>1015</b> are intercepted by reverse host*proxy <b>30010</b> in host channeler <b>29070</b>. The host*proxy uses client mapper <b>30070</b> to reversibly replace the client return addresses in the incoming client-host*proxy actions with client*aliases local to the host channeler, outputting the modified requests as client*proxy-host*proxy actions <b>30080</b>, so that the host responses <b>30110</b> will be routed back to the host channeler instead of going directly back to the client. The client mapper may optionally also append the client's public address <b>11010</b> to the edited action, in case it is required by partner paraproxy <b>30020</b> or by the primary network service.</p>
<p id="p-0315" num="0314">Forward client*proxy <b>30030</b> in host channeler <b>29070</b> then uses host*remapper <b>30090</b> to replace the host*aliases in the client*proxy-host*proxy actions <b>30080</b> with the actual host addresses, outputting the modified requests as client*proxy-host actions <b>30100</b>. Note that client translation for host transactions may not be needed if the host channeler communicates with a single-server host via a dedicated connection or as a coresident module rather than through a network.</p>
<p id="p-0316" num="0315">On intercepting host-client*proxy responses <b>30110</b>, forward client*proxy <b>30030</b> in host channeler <b>29070</b> uses host mapper <b>30120</b> to reversibly replace the host return addresses in the host actions with their host-channeler aliases, outputting the modified responses as host*proxy-client*proxy actions <b>30130</b>.</p>
<p id="p-0317" num="0316">Host service actions <b>30110</b> often contain references to other services available at the primary website, and may also contain references to third-party services <b>1150</b> on partner websites. Partner paraproxy <b>30020</b> in host channeler <b>29070</b> uses partner entrainer <b>30140</b> to find partner referrals in the outgoing host service actions matching the targets in partner-reference translation rule-base <b>30150</b>, and replaces them with aliases local to the specified partner channeler <b>29140</b>, outputting the entraining results as host*proxy-client*proxy action*proxies <b>30160</b>, so that any client actions on those referrals will be routed through the specified partner channeler instead of going directly to the partner sites <b>1150</b>.</p>
<p id="p-0318" num="0317">In an HTML webpage, host and partner references are specified as URI hyperlinks embedded in the HTML page description, corresponding to user-clickable controls in the graphical representation of the webpage. In the simplest embodiment, partner entrainer <b>30140</b> uses a general-purpose character-string substituter to replace all occurrences of targeted URI patterns according to partner translation rule base <b>30150</b>. In a more sophisticated embodiment, the partner entrainer parses the HTML description, determines the appropriate character encoding, and searches for appropriate target strings, for example only in the &#x2018;href&#x2019; fields of anchor (&#x2018;a&#x2019;) tags. More generally, the partner address translator is applied not just to HTML services, but, using analogous techniques obvious to those skilled in the art, to services of other MIME types listed in the partner-translation rule-base.</p>
<p id="p-0319" num="0318">A URI may be specified in many different ways. For example, the following are all equivalent:</p>
<p id="p-0320" num="0319">
<tables id="TABLE-US-00001" num="00001">
<table frame="none" colsep="0" rowsep="0" pgwide="1">
<tgroup align="left" colsep="0" rowsep="0" cols="1">
<colspec colname="1" colwidth="266pt" align="left"/>
<thead>
<row>
<entry namest="1" nameend="1" align="center" rowsep="1"/>
</row>
</thead>
<tbody valign="top">
<row>
<entry>&#x2003;&#x2003;&#x2002;http://www.google.com/</entry>
</row>
<row>
<entry>&#x2003;&#x2003;&#x2002;http://google.com/&#x2003;&#x2002;(omitting the optional &#x201c;www&#x201d; subdomain)</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="2">
<colspec colname="1" colwidth="105pt" align="left"/>
<colspec colname="2" colwidth="161pt" align="left"/>
<tbody valign="top">
<row>
<entry>&#x2003;&#x2003;&#x2002;http://www.google.com</entry>
<entry>(omitting the optional &#x201c;/&#x201d; directory indicator)</entry>
</row>
<row>
<entry>&#x2003;&#x2003;&#x2002;http://www.google.com//</entry>
<entry>(adding a superfluous &#x201c;/&#x201d; directory indicator)</entry>
</row>
<row>
<entry>&#x2003;&#x2003;&#x2002;http://www.google.com/#</entry>
<entry>(adding an empty &#x201c;#&#x201d; anchor indicator)</entry>
</row>
<row>
<entry>&#x2003;&#x2003;&#x2002;http://www.google.com/?</entry>
<entry>(adding an empty &#x201c;?&#x201d; query indicator)</entry>
</row>
<row>
<entry>&#x2003;&#x2003;&#x2002;http://www.google.com/..</entry>
<entry>(adding a vacuous &#x201c;..&#x201d; parent-directory indicator)</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="2">
<colspec colname="1" colwidth="126pt" align="left"/>
<colspec colname="2" colwidth="140pt" align="left"/>
<tbody valign="top">
<row>
<entry>&#x2003;&#x2003;&#x2002;http://www.google.com/index.html</entry>
<entry>(adding the optional &#x201c;index.html&#x201d; default page</entry>
</row>
<row>
<entry>name)</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="2">
<colspec colname="1" colwidth="105pt" align="left"/>
<colspec colname="2" colwidth="161pt" align="left"/>
<tbody valign="top">
<row>
<entry>&#x2003;&#x2003;&#x2002;http://www.google.com:80/</entry>
<entry>(adding the optional &#x201c;:80&#x201d; World Wide Web HTTP</entry>
</row>
<row>
<entry>port)</entry>
</row>
<row>
<entry>&#x2003;&#x2003;&#x2002;HTTP://wWw.Google.cOm/</entry>
<entry>(optionally capitalizing letters)</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="2">
<colspec colname="1" colwidth="126pt" align="left"/>
<colspec colname="2" colwidth="140pt" align="left"/>
<tbody valign="top">
<row>
<entry>&#x2003;&#x2003;&#x2002;http://w%77w.%67oogle.c%6fm/</entry>
<entry>(optionally percent-encoding characters)</entry>
</row>
<row>
<entry>&#x2003;&#x2003;&#x2002;http://garbage@www.google.com/</entry>
<entry>(adding an ignored authorization code)</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="1">
<colspec colname="1" colwidth="266pt" align="left"/>
<tbody valign="top">
<row>
<entry>&#x2003;&#x2003;&#x2002;http://74.125.19.106/&#x2002;&#x2009;(using the decimal 4-octet IP address)</entry>
</row>
<row>
<entry>&#x2003;&#x2003;&#x2002;http://1249710954/&#x2003;&#x2002;(using the decimal IP address)</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="2">
<colspec colname="1" colwidth="105pt" align="left"/>
<colspec colname="2" colwidth="161pt" align="left"/>
<tbody valign="top">
<row>
<entry>&#x2003;&#x2003;&#x2002;http://0112.0175.0023.0152/</entry>
<entry>(using the octal 4-octet IP address)</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="2">
<colspec colname="1" colwidth="126pt" align="left"/>
<colspec colname="2" colwidth="140pt" align="left"/>
<tbody valign="top">
<row>
<entry>&#x2003;&#x2003;&#x2002;http://0112.0175.0023.0000152/</entry>
<entry>(adding superfluous leading zeroes)</entry>
</row>
</tbody>
</tgroup>
<tgroup align="left" colsep="0" rowsep="0" cols="2">
<colspec colname="1" colwidth="105pt" align="left"/>
<colspec colname="2" colwidth="161pt" align="left"/>
<tbody valign="top">
<row>
<entry>&#x2003;&#x2003;&#x2002;http://0x4a.0x7d.0x13.0x6a/</entry>
<entry>(using the hexadecimal 4-octet IP address)</entry>
</row>
<row>
<entry namest="1" nameend="2" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0321" num="0320">In addition to the variants exemplified here, a URI may be specified relative to that of the page or iframe in which it occurs, or it may be a URN (uniform resource name), a PURL (persistent uniform resource locator), or even some other type of variant not yet defined. In the preferred embodiment, to facilitate detecting fraudsters through the use of nonstandard URIs, to reduce the size of the rule base, and to facilitate the caching of host actions, partner-paraproxy rule-base <b>30150</b> includes rules for first resolving each URI to a canonical form, using well-known algorithms and services, before comparing the canonical URI to the targets in the partner translation table.</p>
<p id="p-0322" num="0321">Some websites have additional synonymy conventions, such as optionally naming a service through a query string instead of a directory path; arranging subdirectories in a matrix instead of a tree; accepting optional abbreviations or misspellings of domain names, directory names, or service names; or assigning synonymous serial numbers to services. In the preferred embodiment, again to facilitate detecting fraudsters who use nonstandard URIs, to simplify the rule base, and to facilitate caching, partner-translation rule-base <b>30150</b> is augmentable with custom algorithms and rules for reducing such site-specific synonyms to canonical form, before comparing the canonical URI to the targets in the partner translation table.</p>
<p id="p-0323" num="0322">In many cases, all URIs within a partner's domain, a subdomain thereof, or a path thereunder, are to be entrained. In the preferred embodiment, partner entrainer <b>30140</b> permits target URIs and their aliases to be specified with generic patterns in rule-base <b>30150</b>, for example using standard regular-expression syntax for string pattern matching and substitution, or using variable names for different components of a URI.</p>
<p id="p-0324" num="0323">For standard URIs, the entraining partner*aliases can take several different forms. For example, the partner URL</p>
<p id="p-0325" num="0324">https://www.partner.com/path/page.html#anchor?query</p>
<p id="h-0007" num="0000">can be mapped straightforwardly to either a query parameter, a dynamically assigned port, a directory, a subdomain local to the host, or a different domain:</p>
<p id="p-0326" num="0325">
<tables id="TABLE-US-00002" num="00002">
<table frame="none" colsep="0" rowsep="0">
<tgroup align="left" colsep="0" rowsep="0" cols="2">
<colspec colname="offset" colwidth="21pt" align="left"/>
<colspec colname="1" colwidth="196pt" align="left"/>
<thead>
<row>
<entry/>
<entry namest="offset" nameend="1" align="center" rowsep="1"/>
</row>
</thead>
<tbody valign="top">
<row>
<entry/>
<entry>htps://www.host.com/?service=</entry>
</row>
<row>
<entry/>
<entry>partner%2fpath%2fpage.html%23anchor%3fquery</entry>
</row>
<row>
<entry/>
<entry>https://www.host.com:12345/path/page.html#anchor?query</entry>
</row>
<row>
<entry/>
<entry>https://www.host.com/partner/path/page.html#anchor?query</entry>
</row>
<row>
<entry/>
<entry>https://partner.host.com/path/page.html#anchor?query</entry>
</row>
<row>
<entry/>
<entry>https://www.hostpartner.com/path/page.html#anchor?query</entry>
</row>
<row>
<entry/>
<entry namest="offset" nameend="1" align="center" rowsep="1"/>
</row>
</tbody>
</tgroup>
</table>
</tables>
</p>
<p id="p-0327" num="0326">In the preferred embodiment, the partner entrainer <b>30140</b> supports all such methods in rule-base <b>30150</b>, permitting the host website to choose the most appropriate one. In the preferred embodiment, the URLs are mapped algorithmically, as in these examples, so that no detailed address translation table is required. In the preferred embodiment, the URLs are mapped straightforwardly to preserve their human readability, as in the examples, rather than, say, being replaced with serial numbers or hashed.</p>
<p id="p-0328" num="0327">Reverse host*proxy <b>30010</b> in host channeler <b>29070</b> then uses client*remapper <b>30170</b> to replace the client*aliases in the entraining host*proxy-client*proxy action*proxies <b>30160</b> with the actual client addresses, outputting the modified responses as host*proxy-client action*proxies <b>1040</b>, and routes them on toward the respective clients <b>1010</b>.</p>
<p id="p-0329" num="0328">When a client <b>1010</b> acts on a partner*alias in an entraining host*proxy-client action*proxy <b>1040</b> (or in an entraining partner*proxy-client action*proxy <b>30280</b>), instead of being diverted directly to the partner's website, the referred client-partner*proxy action <b>30180</b> is channeled through a partner channeler <b>29140</b>, which may be located at the primary website <b>1015</b>, a logging site, a monitoring site, a threat-detection site, in a computing cloud, or elsewhere. Analogously to client mapper <b>30070</b> in reverse host*proxy <b>30010</b>, mediate partner*proxy <b>30040</b> uses client mapper <b>30190</b> to reversibly replace the client return addresses in the incoming client-partner*proxy actions with client*aliases local to the partner channeler, outputting the modified requests as client*proxy-partner*proxy actions <b>30200</b>, so that the partner responses <b>1190</b> will be routed back to the partner channeler instead of going directly back to the client. The client mapper may optionally also append the client's public address <b>11010</b> to the edited action, in case it is required by partner paraproxy <b>30050</b> or the partner service <b>1150</b>.</p>
<p id="p-0330" num="0329">The partner channeler then uses partner*remapper <b>30210</b> in mediate client*proxy <b>30060</b> to remap the local partner aliases to the partner service's actual addresses, and sends the client*proxy-partner actions <b>1180</b> on toward the specified partner websites <b>1150</b>.</p>
<p id="p-0331" num="0330">When a partner service <b>1150</b> responds to an entrained referred client action <b>1180</b>, its entrained response <b>1190</b>, instead of going directly back to the client, is channeled back through the partner channeler <b>29140</b>. There, mediate client*proxy <b>30060</b> uses partner mapper <b>30220</b> to reversibly replace the partner return addresses in the partner actions with their partner-channeler aliases, outputting the modified responses as partner*proxy-client*proxy actions <b>30230</b>. Note that client address translation may be unnecessary for referred partner transactions if the partner channeler has a dedicated connection to the partner sites in question.</p>
<p id="p-0332" num="0331">Analogously to partner paraproxy <b>30020</b> in host channeler <b>29070</b>, partner paraproxy <b>30050</b> in partner channeler <b>29140</b> uses partner entrainer <b>30240</b> to find partner referrals in the outgoing partner service actions matching the targets in partner-reference translation rule-base <b>30250</b>, and replaces them with aliases local to the specified partner channeler, outputting the entraining results as partner*proxy-client*proxy action*proxies <b>30260</b>, so that any client actions on those referrals will be routed through the desired partner channeler instead of going directly to the respective partner sites <b>1150</b>.</p>
<p id="p-0333" num="0332">Finally, mediate partner*proxy <b>30040</b> in host channeler <b>29140</b> then uses client*remapper <b>30270</b> to replace the client*aliases in the entraining partner*proxy-client*proxy action*proxies <b>30260</b> with the actual client addresses, outputting the modified responses as partner*proxy-client action*proxies <b>30280</b>, and routes them on toward the respective clients <b>1010</b>.</p>
<p id="p-0334" num="0333">In the preferred embodiment, partner paraproxies <b>30020</b> and <b>30050</b> are accelerated with caches <b>30310</b> and <b>30320</b>, respectively. For static resources containing partner references requiring mapping, the caches store a copy of the resource with the references already mapped, along with information to determine whether the source has changed, such as a date and checksum of the unmapped resource. For static resources not requiring remapping, the caches stores only the change-determinant, the absence of content indicating that the source can be passed through unchanged. Each cache, or relevant items therein, is also cleared when respective partner translation rule-base <b>30150</b> or <b>30250</b> changes.</p>
<p id="p-0335" num="0334">Partner address-translation rule-bases <b>30150</b> and <b>30250</b> are maintained by remediator <b>29160</b> (See <figref idref="DRAWINGS">FIG. 29</figref>) through remedial actions <b>1090</b>. In principle, the two rule bases can differ: The host service <b>1015</b> and partner services <b>1150</b> output different sets of responses <b>30110</b> and <b>1190</b> with different contents generally containing different sets of references to partner sites; It may be useful to route traffic differently even for the same partner references, in case an attack is directed directly at a partner site rather than to the host site. However, if the rule bases differ, or if host channeler <b>29070</b> and partner channeler <b>29140</b> are not coresident, it is important to keep the rule bases synchronized, both to avoid inadvertent collisions where different partner services are undesiredly mapped to the same address, and to avoid referring an action to a channeler unequipped to remap its destination.</p>
<p id="p-0336" num="0335">In the preferred embodiment, substitutions in partner address-translation rule-bases <b>30150</b> and <b>30250</b> can be conditioned by the client, so that clients suspected of abuse through partner services <b>1150</b> can be blocked from visiting those partners or diverted to other services on those sites, on the host site, on the threat-detection site, or elsewhere for monitoring or other remediation, either by changing the partner service addresses in the partner*proxy-client*proxy actions <b>30230</b> after visiting a partner site, changing the partner addresses in the client*proxy-partner*proxy actions <b>30200</b> before visiting a partner site, or by changing the partner addresses in the host*proxy-client*proxy actions <b>30130</b> before the client can even try to visit a partner site. Client-conditional partner-address translation is also useful for testing the entrainment of a partner service or a remediation by limiting a substitution to the IP addresses of testing staff, and for phasing it in by limiting it to a trial group of clients.</p>
<p id="p-0337" num="0336">By adding host-address substitutions, optionally client-specific, to the rule bases <b>30150</b> and <b>30250</b>, the partner translator can also be used to change the host service addresses in incoming client actions or embedded in outgoing service actions, in order to remediate abuse involving a combination of partner and host services, or host services alone, whether in general or by specific clients.</p>
<p id="p-0338" num="0337">More generally, since any partner service may itself refer to other partner services not referred to by the host or an earlier partner, rule base <b>30250</b> in partner channeler <b>29140</b> may target additional services not targetted in rule base <b>30150</b> in host channeler <b>29070</b>. Thus the channeler may be used to entrain communication not just with primary partners, but with partners of partners, and beyond.</p>
<p id="p-0339" num="0338">Host channeler <b>29070</b> and partner channeler <b>29140</b> output records of their actions to logger <b>29150</b> (See <figref idref="DRAWINGS">FIG. 29</figref>) as host-channeler record <b>30290</b> and partner-channeler record <b>30300</b>, respectively, using the current time <b>6110</b> given by master clock <b>6100</b> (See <figref idref="DRAWINGS">FIG. 6</figref>), to enable the threat detector <b>1060</b> to detect threats involving partner sites, and so that security personnel can directly monitor the operation of channeler <b>29050</b> for suspicious events and trends using monitor <b>2900</b><i>v</i><b>0</b> (See <figref idref="DRAWINGS">FIG. 29</figref>). The partner channeler logs also help the threat detector improve the timing statistics for client-host transactions, by taking excursions to partner sites into account.</p>
<p id="p-0340" num="0339">An embodiment of the present invention relates to a computer storage product with a computer readable storage medium having computer code thereon for performing various computer-implemented operations. The media and computer code may be those specially designed and constructed for the purposes of the present invention, or they may be of the kind well known and available to those having skill in the computer software arts. Examples of computer-readable media include, but are not limited to: magnetic media such as hard disks, floppy disks, and magnetic tape; optical media such as CD-ROMs, DVDs and holographic devices; magneto-optical media; and hardware devices that are specially configured to store and execute program code, such as application-specific integrated circuits (&#x201c;ASICs&#x201d;), programmable logic devices (&#x201c;PLDs&#x201d;) and ROM and RAM devices. Examples of computer code include machine code, such as produced by a compiler, and files containing higher-level code that are executed by a computer using an interpreter. For example, an embodiment of the invention may be implemented using JAVA&#xae;, C++, or other object-oriented programming language and development tools. Another embodiment of the invention may be implemented in hardwired circuitry in place of, or in combination with, machine-executable software instructions.</p>
<p id="p-0341" num="0340">The foregoing description, for purposes of explanation, used specific nomenclature to provide a thorough understanding of the invention. However, it will be apparent to one skilled in the art that specific details are not required in order to practice the invention. Thus, the foregoing descriptions of specific embodiments of the invention are presented for purposes of illustration and description. They are not intended to be exhaustive or to limit the invention to the precise forms disclosed; obviously, many modifications and variations are possible in view of the above teachings. The embodiments were chosen and described in order to best explain the principles of the invention and its practical applications, they thereby enable others skilled in the art to best utilize the invention and various embodiments with various modifications as are suited to the particular use contemplated. It is intended that the following claims and their equivalents define the scope of the invention.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A non-transitory computer readable storage medium with instructions for execution on a host computer, comprising instructions to:
<claim-text>(i) record a relationship between a partner site and the host computer;</claim-text>
<claim-text>(ii) substitute a reference to the partner site with a partner site alias referencing the host computer;</claim-text>
<claim-text>(iii) deliver the partner site alias to a client;</claim-text>
<claim-text>(iv) replace the partner site alias for the reference to the partner site in response to receiving the partner site alias from the client;</claim-text>
<claim-text>(v) augment an address of the client with an address alias;</claim-text>
<claim-text>(vi) send the address alias to the partner site;</claim-text>
<claim-text>(vii) receive from the partner site a partner action and the address alias;</claim-text>
<claim-text>(viii) exchange the address for the address alias;</claim-text>
<claim-text>(ix) deliver the partner action to the client utilizing the address;</claim-text>
<claim-text>(x) monitor (ii) through (ix) to identify client activity that constitutes a security threat at the host computer or the partner site; and</claim-text>
<claim-text>(xi) implement a remedial action in response to the security threat, wherein the remedial action is selected from blocking the client, delaying the client, diverting the client to a harmless webpage and supplying the client with spoofed information.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The computer readable storage medium of <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising executable instructions to analyze a logical structure of the partner site.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The computer readable storage medium of <claim-ref idref="CLM-00002">claim 2</claim-ref> further comprising executable instructions to analyze intercepted communications between the client and the partner site to evaluate the logical structure of the partner site.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The computer readable storage medium of <claim-ref idref="CLM-00002">claim 2</claim-ref> further comprising executable instructions to prepare a partner web site map detailing intrinsic linkages among web pages, intrinsic access levels, intrinsic privilege levels and intrinsic security levels.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The computer readable storage medium of <claim-ref idref="CLM-00002">claim 2</claim-ref> wherein the executable instructions to monitor include executable instructions to evaluate security flaws in the logical structure of the partner site.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The computer readable storage medium of <claim-ref idref="CLM-00002">claim 2</claim-ref> wherein the executable instructions to monitor include executable instructions to determine whether an observed transition is consistent with the logical structure of the partner site.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The computer readable storage medium of <claim-ref idref="CLM-00002">claim 2</claim-ref> wherein the executable instructions to monitor include executable instructions to produce a session threat score based upon the monitoring and the logical structure of the partner site.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The computer readable storage medium of <claim-ref idref="CLM-00002">claim 2</claim-ref> further comprising executable instructions to issue a warning to the partner site in response to an identification of a structural security flaw in the logical structure of the partner site.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The computer readable storage medium of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the instructions to monitor include executable instructions to detect appearance of a new service that is inconsistent with a pre-existing list of partner site services.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The computer readable storage medium of <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising executable instructions to reconstruct a plurality of partner site sessions to identify the security threat.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The computer readable storage medium of <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising executable instructions to encrypt communications between the host computer and the client.</claim-text>
</claim>
<claim id="CLM-00012" num="00012">
<claim-text>12. The computer readable storage medium of <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising executable instructions to encrypt communications between the host computer and the partner site.</claim-text>
</claim>
<claim id="CLM-00013" num="00013">
<claim-text>13. The computer readable storage medium of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the host computer is configured as a dedicated physical server, a virtual server shared with other services, a portion of a sever farm or a virtual server farm in a computing cloud.</claim-text>
</claim>
<claim id="CLM-00014" num="00014">
<claim-text>14. The computer readable storage medium of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the instructions to monitor include executable instructions to access security information from client-facing data centers or internal service data centers.</claim-text>
</claim>
<claim id="CLM-00015" num="00015">
<claim-text>15. The computer readable storage medium of <claim-ref idref="CLM-00001">claim 1</claim-ref> further comprising executable instructions to warn a victim of the security threat utilizing an independent communication channel.</claim-text>
</claim>
<claim id="CLM-00016" num="00016">
<claim-text>16. The computer readable storage medium of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein the host computer is controlled by a first party; and wherein the instructions to substitute the reference to the partner site with the partner site alias include instructions to:
<claim-text>receive, from a third-party controlling the partner site, web content including (i) third-party material for presentation to a user of the client and (ii) a third-party hyperlink which identifies the partner site, the third-party being different than the first party controlling the host computer,</claim-text>
<claim-text>generate, by the host computer, a webpage having modified web content, the modified web content including (i) the third-party material for presentation to the user of the client and (ii) a host computer hyperlink in place of the third-party hyperlink, the host computer hyperlink identifying the host computer, and</claim-text>
<claim-text>provide the webpage having the modified web content to the client.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00017" num="00017">
<claim-text>17. The computer readable storage medium of <claim-ref idref="CLM-00016">claim 16</claim-ref>, further comprising instructions to:
<claim-text>perform network address translation to enable the client and the partner site to exchange information across different networks.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00018" num="00018">
<claim-text>18. The computer readable storage medium of <claim-ref idref="CLM-00016">claim 16</claim-ref> wherein each of the client, the host computer and the partner site resides on a public network; and wherein the instructions to provide the webpage having the modified web content to the client include instructions to:
<claim-text>sending, from the host computer, a webpage which includes the host computer hyperlink identifying the host computer, a host computer IP address to identify a network source of the webpage, and a client IP address to identify a network destination of the webpage.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00019" num="00019">
<claim-text>19. In a host computer controlled by a first party, a method of providing security, comprising:
<claim-text>receiving, from a third-party controlling a partner site, web content including (i) third-party material for presentation to a user of a client device and (ii) a third-party hyperlink which identifies the partner site, the third-party being different than the first party controlling the host computer;</claim-text>
<claim-text>generating, by the host computer, a webpage having modified web content, the modified web content including (i) the third-party material for presentation to the user of the client device and (ii) a host computer hyperlink in place of the third-party hyperlink, the host computer hyperlink identifying the host computer;</claim-text>
<claim-text>providing the webpage having the modified web content to the client device;</claim-text>
<claim-text>receiving a client message from the client device, the client message including (i) a request to access a resource of the partner site and (ii) a client address identifying the client device;</claim-text>
<claim-text>generating a proxy message based on the client message, the proxy message including (i) the request to access a resource of the partner site and (ii) a proxy address identifying the host computer;</claim-text>
<claim-text>providing the proxy message to the partner site;</claim-text>
<claim-text>receiving a partner action message from the partner site in response to the proxy message, the partner action message including (i) a partner action response and (ii) a partner site address identifying the partner site;</claim-text>
<claim-text>generating a proxy action message based on the partner action message, the proxy action message, the partner action message including (i) the partner action response and (ii) a proxy address identifying the host computer;</claim-text>
<claim-text>providing the proxy action message to the client device;</claim-text>
<claim-text>monitoring communications between the client device and the partner site through the host computer to identify security threats resulting from the communications; and</claim-text>
<claim-text>implementing a remedial action in response to an identified security threat, the remedial action being selected from blocking the client device, delaying the client device, diverting the client device to a harmless webpage and supplying the client device with spoofed information.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00020" num="00020">
<claim-text>20. A network security apparatus, comprising:
<claim-text>a communications interface;</claim-text>
<claim-text>memory; and</claim-text>
<claim-text>processing circuitry coupled to the communications interface and the memory, the memory storing instructions which, when carried out by the processing circuitry, cause the processing circuitry to:
<claim-text>receive, from a third-party controlling a partner site, web content including (i) third-party material for presentation to a user of a client device and (ii) a third-party hyperlink which identifies the partner site, the third-party being different than the first party controlling the host computer,</claim-text>
<claim-text>generate, by the host computer, a webpage having modified web content, the modified web content including (i) the third-party material for presentation to the user of the client device and (ii) a host computer hyperlink in place of the third-party hyperlink, the host computer hyperlink identifying the host computer,</claim-text>
<claim-text>provide the webpage having the modified web content to the client device,</claim-text>
<claim-text>receive a client message from the client device, the client message including (i) a request to access a resource of the partner site and (ii) a client address identifying the client device,</claim-text>
<claim-text>generate a proxy message based on the client message, the proxy message including (i) the request to access a resource of the partner site and (ii) a proxy address identifying the host computer;</claim-text>
<claim-text>provide the proxy message to the partner site,</claim-text>
<claim-text>receive a partner action message from the partner site in response to the proxy message, the partner action message including (i) a partner action response and (ii) a partner site address identifying the partner site,</claim-text>
<claim-text>generate a proxy action message based on the partner action message, the proxy action message, the partner action message including (i) the partner action response and (ii) a proxy address identifying the host computer,</claim-text>
<claim-text>provide the proxy action message to the client device,</claim-text>
<claim-text>monitor communications between the client device and the partner site through the host computer to identify security threats resulting from the communications;</claim-text>
<claim-text>implement a remedial action in response to an identified security threat, the remedial action being selected from blocking the client device, delaying the client device, diverting the client device to a harmless webpage and supplying the client device with spoofed information.</claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00021" num="00021">
<claim-text>21. A computer program product having a non-transitory computer readable medium which stores a set of instructions to provide security, the set of instructions, when carried out by a host computer controlled by a first party, causing the host computer to perform a method of:
<claim-text>receiving, from a third-party controlling a partner site, web content including (i) third-party material for presentation to a user of a client device and (ii) a third-party hyperlink which identifies the partner site, the third-party being different from the first party controlling the host computer;</claim-text>
<claim-text>generating, by the host computer, a webpage having modified web content, the modified web content including (i) the third-party material for presentation to the user of the client device and (ii) a host computer hyperlink in place of the third-party hyperlink, the host computer hyperlink identifying the host computer;</claim-text>
<claim-text>providing the webpage having the modified web content to the client device;</claim-text>
<claim-text>receiving a client message from the client device, the client message including (i) a request to access a resource of the partner site and (ii) a client address identifying the client device;</claim-text>
<claim-text>generating a proxy message based on the client message, the proxy message including (i) the request to access a resource of the partner site and (ii) a proxy address identifying the host computer;</claim-text>
<claim-text>providing the proxy message to the partner site;</claim-text>
<claim-text>receiving a partner action message from the partner site in response to the proxy message, the partner action message including (i) a partner action response and (ii) a partner site address identifying the partner site;</claim-text>
<claim-text>generating a proxy action message based on the partner action message, the proxy action message, the partner action message including (i) the partner action response and (ii) a proxy address identifying the host computer;</claim-text>
<claim-text>providing the proxy action message to the client device;</claim-text>
<claim-text>monitoring communications between the client device and the partner site through the host computer to identify security threats resulting from the communications; and</claim-text>
<claim-text>implementing a remedial action in response to an identified security threat, the remedial action being selected from blocking the client device, delaying the client device, diverting the client device to a harmless webpage and supplying the client device with spoofed information.</claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
