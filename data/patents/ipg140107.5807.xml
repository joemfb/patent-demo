<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v44-2013-05-16.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.4 2013-05-16" file="US08626915-20140107.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20131224" date-publ="20140107">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>08626915</doc-number>
<kind>B2</kind>
<date>20140107</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12766017</doc-number>
<date>20100423</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>G</section>
<class>06</class>
<subclass>F</subclass>
<main-group>15</main-group>
<subgroup>173</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20140107</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>709225</main-classification>
<further-classification>709224</further-classification>
</classification-national>
<invention-title id="d2e43">Routing method</invention-title>
<us-references-cited>
<us-citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>6535227</doc-number>
<kind>B1</kind>
<name>Fox et al.</name>
<date>20030300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709224</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>6742040</doc-number>
<kind>B1</kind>
<name>Toga</name>
<date>20040500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709229</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>7143096</doc-number>
<kind>B2</kind>
<name>Gemba et al.</name>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709216</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>8010627</doc-number>
<kind>B1</kind>
<name>Schneebeli et al.</name>
<date>20110800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709229</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>2002/0107961</doc-number>
<kind>A1</kind>
<name>Kinoshita</name>
<date>20020800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>709225</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>2004/0022242</doc-number>
<kind>A1</kind>
<name>Bhogal et al.</name>
<date>20040200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>370389</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>2004/0111603</doc-number>
<kind>A1</kind>
<name>Iwamura</name>
<date>20040600</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>2005/0108257</doc-number>
<kind>A1</kind>
<name>Ishii et al.</name>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>707100</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>2005/0229245</doc-number>
<kind>A1</kind>
<name>Nakano et al.</name>
<date>20051000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>2006/0059279</doc-number>
<kind>A1</kind>
<name>Kakizaki</name>
<date>20060300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 33</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>2007/0162749</doc-number>
<kind>A1</kind>
<name>Lim</name>
<date>20070700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>2007/0174501</doc-number>
<kind>A1</kind>
<name>Lin et al.</name>
<date>20070700</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>710 15</main-classification></classification-national>
</us-citation>
<us-citation>
<patcit num="00013">
<document-id>
<country>CN</country>
<doc-number>1698320</doc-number>
<kind>A</kind>
<date>20051100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00014">
<document-id>
<country>EP</country>
<doc-number>1724701</doc-number>
<kind>A2</kind>
<date>20061100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00015">
<document-id>
<country>JP</country>
<doc-number>2002-312316</doc-number>
<date>20021000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00016">
<document-id>
<country>JP</country>
<doc-number>2003-122615</doc-number>
<date>20030400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00017">
<document-id>
<country>JP</country>
<doc-number>2004-185312</doc-number>
<date>20040700</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00018">
<document-id>
<country>JP</country>
<doc-number>2005-130214</doc-number>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00019">
<document-id>
<country>JP</country>
<doc-number>2006-085401</doc-number>
<date>20060300</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00020">
<document-id>
<country>JP</country>
<doc-number>3994126</doc-number>
<date>20071000</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00021">
<document-id>
<country>WO</country>
<doc-number>99/46882</doc-number>
<date>19990900</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00022">
<document-id>
<country>WO</country>
<doc-number>00/22796</doc-number>
<date>20000400</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<patcit num="00023">
<document-id>
<country>WO</country>
<doc-number>2004/100456</doc-number>
<kind>A1</kind>
<date>20041100</date>
</document-id>
</patcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00024">
<othercit>International Search Report for PCT/JP2007/070796, mailed on Mar. 18, 2008.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00025">
<othercit>Chinese Office Action issued Aug. 24, 2012 in corresponding Chinese Patent Application No. 200780101273.3.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00026">
<othercit>Chinese Office Action mailed Mar. 7, 2013 for corresponding Chinese Application No. 200780101273.3.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00027">
<othercit>Extended European Search Report dated Feb. 17, 2012 issued in corresponding European Patent Application No. 07830530.7.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
<us-citation>
<nplcit num="00028">
<othercit>Chinese Office Action issued May 15, 2012 issued in corresponding Chinese Patent Application No. 200780101273.3.</othercit>
</nplcit>
<category>cited by applicant</category>
</us-citation>
</us-references-cited>
<number-of-claims>7</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>709216</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709224</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709225</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>709229</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>370389</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>707100</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>710 15</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>15</number-of-drawing-sheets>
<number-of-figures>15</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>PCT/JP2007/070796</doc-number>
<date>20071025</date>
</document-id>
<parent-status>PENDING</parent-status>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>12766017</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20100205300</doc-number>
<kind>A1</kind>
<date>20100812</date>
</document-id>
</related-publication>
</us-related-documents>
<us-parties>
<us-applicants>
<us-applicant sequence="001" app-type="applicant" designation="us-only">
<addressbook>
<last-name>Uchida</last-name>
<first-name>Yoshiaki</first-name>
<address>
<city>Kawasaki</city>
<country>JP</country>
</address>
</addressbook>
<residence>
<country>JP</country>
</residence>
</us-applicant>
</us-applicants>
<inventors>
<inventor sequence="001" designation="us-only">
<addressbook>
<last-name>Uchida</last-name>
<first-name>Yoshiaki</first-name>
<address>
<city>Kawasaki</city>
<country>JP</country>
</address>
</addressbook>
</inventor>
</inventors>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<orgname>Staas &#x26; Halsey LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</us-parties>
<assignees>
<assignee>
<addressbook>
<orgname>Fujitsu Limited</orgname>
<role>03</role>
<address>
<city>Kawasaki</city>
<country>JP</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Nguyen</last-name>
<first-name>Quang N</first-name>
<department>2441</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A method executed by a router that establishes a connection between a network and an another network that includes an information processing device and an information storage device, the method includes: detecting an access status of the information processing device to the information storage device; and prohibiting transfer of the information from the information processing device to the another network depending on the access status managed in the detecting.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="139.45mm" wi="175.09mm" file="US08626915-20140107-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="176.87mm" wi="149.35mm" orientation="landscape" file="US08626915-20140107-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="165.02mm" wi="134.20mm" orientation="landscape" file="US08626915-20140107-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="183.98mm" wi="126.49mm" orientation="landscape" file="US08626915-20140107-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="176.87mm" wi="146.64mm" orientation="landscape" file="US08626915-20140107-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="175.09mm" wi="151.13mm" orientation="landscape" file="US08626915-20140107-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="192.02mm" wi="148.42mm" orientation="landscape" file="US08626915-20140107-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="189.06mm" wi="141.31mm" orientation="landscape" file="US08626915-20140107-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="189.65mm" wi="144.61mm" orientation="landscape" file="US08626915-20140107-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="181.95mm" wi="143.09mm" orientation="landscape" file="US08626915-20140107-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="169.16mm" wi="133.35mm" orientation="landscape" file="US08626915-20140107-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="185.17mm" wi="146.64mm" orientation="landscape" file="US08626915-20140107-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="197.95mm" wi="149.35mm" orientation="landscape" file="US08626915-20140107-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="175.09mm" wi="147.24mm" orientation="landscape" file="US08626915-20140107-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="177.80mm" wi="146.39mm" orientation="landscape" file="US08626915-20140107-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="177.21mm" wi="146.98mm" orientation="landscape" file="US08626915-20140107-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS-REFERENCE TO RELATED APPLICATION</heading>
<p id="p-0002" num="0001">This is a continuation of Application PCT/JP2007/070796, filed on Oct. 25, 2007, the entire contents of which are incorporated herein by reference.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">FIELD</heading>
<p id="p-0003" num="0002">A certain aspect of the embodiments discussed herein relates to technique of a network storage, such as an NAS (network attached storage).</p>
<heading id="h-0003" level="1">BACKGROUND</heading>
<p id="p-0004" num="0003">A network storage, such as an NAS, has been increasingly used. Constant connection to the Internet in a computer has become common. Therefore, even when users access files in an NAS in a situation that most computers are placed in a closed area, such as a LAN, the computers are connected to the Internet.</p>
<p id="p-0005" num="0004">This causes a problem that malicious software (hereinafter, referred to as malware) opens data, stored in the NAS, to the public on the Internet in a form that is not intended by a user.</p>
<p id="p-0006" num="0005">In addition, there may also be a problem due to a careless, inappropriate operation, such as a case where a user misidentifies an actually public area on the Internet as a private work area and then places important private data therein or a case where a user establishes connection to a network while a folder that originally should not be open to the public remains open to the public.</p>
<p id="p-0007" num="0006">There is a simple solution for the above problems, that is, to &#x201c;directly unplug a LAN cable&#x201d;; however, this requires unplugging a LAN cable of a router, or the like, so it is burdensome.</p>
<p id="p-0008" num="0007">There is the following Patent Document related to a technique for preventing information leakage in a computer.</p>
<p id="p-0009" num="0008">[Patent Document 1] Japanese Laid-open Patent Publication No. 2003-122615</p>
<heading id="h-0004" level="1">SUMMARY</heading>
<p id="p-0010" num="0009">According to an aspect of an embodiment, a method executed by a router that establishes a connection between a network and an another network that includes an information processing device and an information storage device, the method includes: detecting an access status of the information processing device to the information storage device; and prohibiting transfer of the information from the information processing device to the another network depending on the access status managed in the detecting.</p>
<p id="p-0011" num="0010">The object and advantages of the invention will be realized and attained by means of the elements and combinations particularly pointed out in the claims.</p>
<p id="p-0012" num="0011">It is to be understood that both the foregoing general description and the following detailed description are exemplary and explanatory and are not restrictive of the invention, as claimed.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0005" level="1">BRIEF DESCRIPTION OF DRAWINGS</heading>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 1</figref> is a configuration diagram of a network storage system <b>100</b> according to the embodiment.</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 2</figref> is a schematic view of a router <b>103</b> and NAS <b>104</b> according to the embodiment.</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 3</figref> is a Bad PC List <b>203</b> according to the embodiment.</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 4</figref> is a configuration diagram of a network storage system <b>400</b> according to the embodiment.</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 5</figref> is a configuration diagram of a network storage system <b>500</b> according to the embodiment.</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIG. 6</figref> is a configuration diagram of a network storage system <b>600</b> according to the embodiment.</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIG. 7</figref> is a configuration diagram of a network storage system <b>700</b> according to the embodiment.</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 8</figref> is a configuration diagram of a network storage system <b>800</b> according to the embodiment.</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIG. 9</figref> is a flowchart related to open operation of the NAS according to the embodiment.</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 10</figref> is a flowchart related to close operation of the NAS <b>104</b> according to the embodiment.</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 11</figref> is a flowchart of counting operation executed by the router <b>103</b> according to the embodiment.</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 12</figref> is a flowchart of packet transfer operation executed by the router <b>103</b> according to the embodiment.</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 13</figref> is a hardware block diagram of the NAS <b>104</b> according to the embodiment.</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 14</figref> is a configuration diagram of the network storage system <b>100</b> according to the embodiment.</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIG. 15</figref> is a configuration diagram of the network storage system <b>100</b> according to the embodiment.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0006" level="1">DESCRIPTION OF EMBODIMENTS</heading>
<p id="p-0028" num="0027">A network storage system according to an embodiment is a system in which a plurality of personal computers and an NAS are connected by a LAN (Local Area Network) and then a network outside the LAN and the personal computers are connected via a router. Then, the personal computers access files via the LAN or access the Internet via the router. The NAS according to the present embodiment executes control so that data stored in the NAS do not leak onto the Internet against user's intention.</p>
<p id="p-0029" num="0028">A particularly problematic case where data stored in the NAS leak onto the Internet is caused by malware.</p>
<p id="p-0030" num="0029">A route through which data on the Internet leak owing to malware against user's intention is conceivably the following cases. &#x2014;Malware sets a secret folder to a public folder of a file sharing folder. &#x2014;Malware copies a secret file into a public folder. &#x2014;Malware transfers a secret file by mail at user's unintended timing.</p>
<p id="p-0031" num="0030">Existing measures for these problems are as follows. &#x2014;A personal computer detects &#x201c;malware&#x201d; by antivirus software. &#x2014;A personal computer shuts off an external network connection to the personal computer by a software firewall. &#x2014;A personal computer monitors leakage of important data by a physical firewall.</p>
<p id="p-0032" num="0031">However, according to the measures of the above described <b>1</b>, an action against a new type of virus delays. The above measures are ineffective for a personal computer that is initially or early infected with &#x201c;malicious software&#x201d;.</p>
<p id="p-0033" num="0032">According to the measures of the above described <b>2</b>, it is difficult to detect a case where &#x201c;malicious software&#x201d; that once starts to run accesses the outside from the inside.</p>
<p id="p-0034" num="0033">The measures of the above described <b>3</b> include a technique that is used to take measures for a SPAM mail or to monitor an Web access conducted by an employee. This technique is such that, for example, when data coming from an external network or exchanged with an external network include a word or an expression that is unlikely to be related to a job or when a source or a relay point is considered to be a suspicious individual, the coming or exchanged data are regarded as unauthorized data. It is presumably possible to use the above technique when important data that should be prevented from leakage are fixed and have a specific pattern. That is, according to the above technique, if a word or an expression that is considered to be important on a job can be selected as a fixed pattern, transmission of data, including the fixed pattern, is prohibited when the data are about to be transferred to the outside.</p>
<p id="p-0035" num="0034">However, as it is difficult for a firewall to mechanically distinguish abnormal data from normal data throughout only by a word or an expression that is unlikely to be related to a job, it is also difficult to detect data transmission using a word or an expression that is a key to prohibit the data transmission. Therefore, the user just needs to take measures at a later date using the log data of the firewall.</p>
<p id="p-0036" num="0035">The NAS according to the present embodiment is connected to a personal computer via a network. The NAS is formed of a file access detecting unit and a system control unit. The file access detecting unit detects a file access from the personal computer to the network storage. The system control unit controls interruption of a connection between the personal computer and an external network on the basis of the detected file access. By so doing, while an information processing device is accessing to the NAS, a connection between the information processing device and an external network is interrupted to thereby make it possible to prevent leakage of data, stored in the NAS, to the external network.</p>
<p id="h-0007" num="0000">[Network Storage System <b>100</b>]</p>
<p id="p-0037" num="0036">Hereinafter, a network storage system <b>100</b> according to the present embodiment will be described with reference to <figref idref="DRAWINGS">FIG. 1</figref>. <figref idref="DRAWINGS">FIG. 1</figref> is a configuration diagram of the network storage system <b>100</b> according to the present embodiment.</p>
<p id="p-0038" num="0037">The network storage system <b>100</b> is formed of personal computers <b>101</b> and <b>102</b>, a router <b>103</b> and a network storage (hereinafter, referred to as NAS) <b>104</b>. The network storage system <b>100</b> is connected to an external network <b>105</b> via the router <b>103</b>. In addition, the NAS <b>104</b> is formed of a file access monitoring unit <b>106</b>, a system control unit <b>107</b> and a file access control unit <b>110</b>. The file access monitoring unit <b>106</b>, system control unit <b>107</b> and file access control unit <b>110</b> that are implemented in the NAS <b>104</b> are new functions and are characteristics of the NAS <b>104</b> according to the present embodiment. In addition, the router <b>103</b> has an external access control unit <b>108</b> and an external access monitoring unit <b>109</b>. The external access control unit <b>108</b> and the external access monitoring unit <b>109</b> function in cooperation with the file access monitoring unit <b>106</b>, the system control unit <b>107</b> and the file access control unit <b>110</b>, and are characteristics of the router <b>103</b> according to the present embodiment. Note that the file access monitoring unit <b>106</b>, the system control unit <b>107</b> and the file access control unit <b>110</b> may be provided outside the NAS <b>104</b>.</p>
<p id="p-0039" num="0038">Then, in the present embodiment, the personal computer <b>101</b> accesses a file in the NAS <b>104</b>. When malware opens data (file, folder, or the like) in the NAS <b>104</b> to the public on the Internet, the malware leaks the data to the external network <b>105</b> via the personal computer <b>101</b> that accesses a file in the NAS <b>104</b>.</p>
<p id="p-0040" num="0039">When there is a file access to a specified folder, the NAS <b>104</b> controls the external access control unit <b>108</b> of the router <b>103</b>. The specified folder is a folder that the user specifies as a secret folder. Folders stored in the NAS <b>104</b> each have a flag that indicates whether the folder is a secret target.</p>
<p id="p-0041" num="0040">In the network storage system <b>100</b> according to the present embodiment, while the personal computer <b>101</b> is editing a secret file, the NAS <b>104</b> prohibits the personal computer <b>101</b> from accessing the external network <b>105</b>. By so doing, the network storage system <b>100</b> is able to prevent leakage of a secret file stored in the NAS <b>104</b> due to malware.</p>
<p id="p-0042" num="0041">Note that the other personal computer <b>102</b> is allowed to refer to the Internet, and data may be referred to within the LAN between the personal computer <b>101</b> and the personal computer <b>102</b>. Note that control for a connection between the external network <b>105</b> and the personal computer <b>101</b> or <b>102</b> is not limited to control implemented by the router <b>103</b>.</p>
<p id="h-0008" num="0000">[NAS <b>104</b>]</p>
<p id="p-0043" num="0042">The NAS <b>104</b> according to the present embodiment not only has a file server function but also has a function of controlling the router <b>103</b>. Then, the router <b>103</b> uses the external access control unit <b>108</b> to control communication from the personal computer <b>101</b> to the external network <b>105</b>.</p>
<p id="p-0044" num="0043">The NAS <b>104</b> has folders and files. The files may be contained in the folders or may be placed in the same hierarchy as those of the folders. The file access monitoring unit <b>106</b> detects a file access of each of the personal computers <b>101</b> and <b>102</b>. In the present embodiment, the file access monitoring unit <b>106</b> detects an api (Application Program Interface) related to the file access of the personal computer <b>101</b> or <b>102</b> to thereby detect the file access of the personal computer <b>101</b> or <b>102</b>. The api is a set of protocols that define the procedure of software for programming.</p>
<p id="p-0045" num="0044">When the file access monitoring unit <b>106</b> detects an access from the personal computer <b>101</b> or <b>102</b> to a file, the file access monitoring unit <b>106</b> notifies the system control unit <b>107</b> of the MAC address or IP address of the access request source (personal computer <b>101</b> or <b>102</b>).</p>
<p id="p-0046" num="0045">The system control unit <b>107</b> controls the external access control unit <b>108</b> of the router <b>103</b> on the basis of information (MAC address, IP address) received from the file access monitoring unit <b>106</b>.</p>
<p id="p-0047" num="0046">The external access control unit <b>108</b> interrupts an access of the personal computer <b>101</b> or <b>102</b> to the external network <b>105</b> on the basis of an instruction from the system control unit <b>107</b>. In addition, the external access control unit <b>108</b> may be configured to delay an access of the personal computer <b>101</b> or <b>102</b> to the external network <b>105</b>.</p>
<p id="p-0048" num="0047">For example, it is assumed that malware tries to transmit a secret file (file for which a secret flag is on) that should be originally kept secret to the external network <b>105</b> by mail protocol, or the like. At the time when malware reads a secret file, the NAS <b>104</b> according to the present embodiment prohibits an access between the external network <b>105</b> and the personal computer (personal computer in which malware is present) that has read the secret file. By so doing, data transmission of a secret file by the personal computer ends in failure, and it is possible to prevent information leakage.</p>
<p id="p-0049" num="0048">In addition, the access control unit <b>105</b> prohibits the personal computer from accessing the external network <b>105</b>. Thus, the access control unit <b>105</b> also uniformly prohibits communication with the external network <b>105</b>, which is a normal job executed by the personal computer. A user of the personal computer identifies that the operation of the system is unstable and then carries out investigation. This gives an opportunity that the user recognizes the presence of malware. With the network storage system <b>100</b> according to the present embodiment, the user is able to early find inclusion of malware, so it is possible to prevent secondary damage and expansion of damage.</p>
<p id="p-0050" num="0049">Therefore, the personal computer is controlled so that a file access to the external network is interrupted while the personal computer is accessing the network storage. By so doing, it is possible to prevent information leakage due to malware.</p>
<p id="h-0009" num="0000">[Cooperation Function between Router <b>103</b> and NAS <b>104</b>]</p>
<p id="p-0051" num="0050"><figref idref="DRAWINGS">FIG. 2</figref> is a schematic view of the router <b>103</b> and NAS <b>104</b> according to the present embodiment.</p>
<p id="p-0052" num="0051">Cooperation between the router <b>103</b> and the NAS <b>104</b> according to the present embodiment will be described in detail. <figref idref="DRAWINGS">FIG. 2</figref> illustrates the router <b>103</b> and the NAS <b>104</b> that are equivalent to those shown in <figref idref="DRAWINGS">FIG. 1</figref>. Note that the file access control unit <b>106</b> and the system control unit <b>107</b> that are implemented in the NAS <b>104</b> are not shown in <figref idref="DRAWINGS">FIG. 2</figref>; however, the NAS <b>104</b> shown in <figref idref="DRAWINGS">FIG. 2</figref> also has those functions.</p>
<p id="p-0053" num="0052">The router <b>103</b> has a Bad PC List <b>203</b> in addition to the external access control unit <b>108</b>. <figref idref="DRAWINGS">FIG. 3</figref> is a specific example of the Bad PC List <b>203</b>.</p>
<p id="p-0054" num="0053">The router <b>103</b> implements the following functions by software. One of the functions of the router <b>103</b> is a function of managing the Bad PC List <b>203</b> and then determining whether the respective personal computers <b>101</b> and <b>102</b> are allowed or rejected to communicate with the external network <b>105</b>. In addition, one of the functions of the router <b>103</b> is a function of updating the Bad PC List <b>203</b>. Furthermore, one of the functions of the router <b>103</b> is a control logic function of discarding an IP packet when the source IP address or MAC address of the IP packet is present in the Bad PC List <b>203</b>, it is determined to reject communication of the source (personal computer) of the IP packet with the external network <b>105</b> and it is determined that the destination of the IP packet is that of the external network <b>105</b>. Note that the router <b>103</b> has a function of determining whether the source and destination of a packet are present in the internal LAN or the external network <b>105</b> on the basis of the IP address or MAC address of the packet.</p>
<p id="h-0010" num="0000">[Bad PC List <b>203</b>]</p>
<p id="p-0055" num="0054"><figref idref="DRAWINGS">FIG. 3</figref> is the Bad PC List <b>203</b> according to the present embodiment.</p>
<p id="p-0056" num="0055">The Bad PC List <b>203</b> is formed of an IP address <b>301</b>, MAC address <b>302</b>, in_use <b>303</b>, BTL <b>304</b>, protect flag <b>305</b> and OCN <b>306</b> of each of the personal computers <b>101</b> and <b>102</b> present in the LAN.</p>
<p id="p-0057" num="0056">The in_use <b>303</b> is a counter that indicates the number of factors by which an access is rejected.</p>
<p id="p-0058" num="0057">The BTL <b>304</b> is a down counter that indicates a period of time that elapses until the personal computer <b>101</b> or <b>102</b> become allowed to access the external network <b>105</b>.</p>
<p id="p-0059" num="0058">The protect flag <b>305</b> holds an access rejection status to the external net in correspondence with each of the personal computers <b>101</b> and <b>102</b> that require connection to the external network <b>105</b>.</p>
<p id="p-0060" num="0059">The OCN <b>306</b> is a down counter that indicates a period of time that elapses until the personal computer <b>101</b> or <b>102</b> become allowed to access the NAS <b>104</b>. The OCN <b>306</b> is a counter that sets a predetermined value (for example, 20) each time communication between the personal computer <b>101</b> or <b>102</b> and the external network <b>105</b> occurs.</p>
<p id="p-0061" num="0060">The router <b>103</b> counts up the in_use <b>303</b> when a factor for rejecting the personal computer <b>101</b> or <b>102</b> from accessing the external network <b>105</b> occurs. Specifically, the factor for rejecting the personal computer <b>101</b> or <b>102</b> from accessing the external network <b>105</b> is that the personal computer <b>101</b> or <b>102</b> has accessed a specified folder in the NAS <b>104</b>.</p>
<p id="p-0062" num="0061">When the router <b>103</b> determines that the factor for rejecting the personal computer <b>101</b> or <b>102</b> from accessing the external network <b>105</b> is eliminated, the router <b>103</b> counts down the in_use <b>303</b>. Note that the initial value of the in_use <b>303</b> is 0.</p>
<p id="p-0063" num="0062">The fact that the value of the in_use <b>303</b> is not &#x201c;0&#x201d; indicates that there is a factor for rejecting the personal computer <b>101</b> or <b>102</b> from accessing the external network <b>105</b>, so the router <b>103</b> sets the protect flag <b>305</b> to &#x201c;protect=true&#x201d;. Then, the router <b>103</b> sets the value of the BTL <b>304</b> to a prescribed value (for example, 32).</p>
<p id="p-0064" num="0063">When the router <b>103</b> sets the in_use <b>303</b> at &#x201c;0&#x201d; (that is, the factor for rejecting the personal computer <b>101</b> or <b>102</b> from accessing the external network <b>105</b> is eliminated), the router <b>103</b> counts down the value of the BTL <b>304</b> at a constant time interval (for example, one second). When the router <b>103</b> counts down the BTL <b>304</b> and then sets the value of the BTL <b>304</b> at &#x201c;0&#x201d;, the router <b>103</b> stops counting down the BTL <b>304</b>, and changes the protect flag <b>305</b> from &#x201c;true&#x201d; to &#x201c;false&#x201d;. By so doing, the personal computer corresponding to &#x201c;protect=false&#x201d; is allowed to communicate with the external network <b>105</b>.</p>
<p id="p-0065" num="0064">In addition, in the present embodiment, the router <b>103</b> counts down the OCN <b>306</b> at the same time interval (for example, one second) as that of the BTL <b>304</b>, and then sets the OCN <b>306</b> at &#x201c;0&#x201d; to stop counting down the OCN <b>306</b>. Of course, the time interval at which the OCN <b>306</b> is counted down is not necessarily the same as the time interval at which the BTL <b>304</b> is counted down.</p>
<p id="p-0066" num="0065">A value at which the router <b>103</b> sets the OCN <b>306</b> may be configured to be varied in accordance with a communication protocol (port number) between the personal computer <b>101</b> or <b>102</b> and the external network <b>105</b>. In this case, the router <b>103</b> executes control so that a value smaller than a value held by the OCN <b>306</b> is not written into the OCN <b>306</b>.</p>
<p id="p-0067" num="0066">In addition, in the present embodiment, the Bad PC List <b>203</b> is a table managed by software installed in the router <b>103</b>; however, the Bad PC List <b>203</b> is not limited to this configuration. The router <b>103</b> may implement the Bad PC List <b>203</b> by hardware, such as a gate array.</p>
<p id="p-0068" num="0067">Note that, from the above, the Bad PC List <b>203</b> indicates the following facts of current status. The personal computer <b>101</b> at the IP address of &#x201c;192.168.3.32&#x201d; is allowed to access the external net (protect=false) but the personal computer <b>101</b> is carrying out communication only within the LAN (OCN=0). On the other hand, the personal computer <b>102</b> at &#x201c;192.168.3.33&#x201d; is prohibited to communicate with the external network <b>105</b> owing to two factors. Furthermore, the Bad PC List <b>203</b> indicates, by the OCN value, that the personal computer at &#x201c;192.168.3.34&#x201d; communicated with the external network <b>105</b> (20-15=) 5 seconds ago.</p>
<p id="h-0011" num="0000">[Functions of NAS <b>104</b>]</p>
<p id="p-0069" num="0068">Next, the functions of the NAS <b>104</b> according to the present embodiment will be described in detail.</p>
<p id="p-0070" num="0069">The NAS <b>104</b> has a Hide flag and an Open flag for each folder that is open to the personal computers <b>101</b> and <b>102</b> in the LAN.</p>
<p id="p-0071" num="0070">More specifically, the NAS <b>104</b> according to the present embodiment has folders <b>201</b> and <b>202</b>. Then, each of the folders <b>201</b> and <b>202</b> has a Hide flag and an Open flag. The Hide flag of the folder <b>201</b> is &#x201c;true&#x201d;, and the Open flag is &#x201c;false&#x201d;. The Hide flag of the folder <b>202</b> is &#x201c;false&#x201d;, and the Open flag is &#x201c;true&#x201d;.</p>
<p id="p-0072" num="0071">The &#x201c;true&#x201d; of the Hide flag indicates that files in the folder <b>201</b> are secret to the external network <b>105</b>. The &#x201c;false&#x201d; of the Hide flag indicates that files in the folder <b>202</b> may be open to the external network <b>105</b>. That is, the Hide flag is information that indicates whether files in a folder having the Hide flag are secret files. Then, the NAS <b>104</b> refers to the Hide flag of the folder <b>201</b> or <b>202</b> to determine whether files in the folder <b>201</b> or <b>202</b> are secret files.</p>
<p id="p-0073" num="0072">The &#x201c;true&#x201d; of the Open flag indicates that any of the files in the folder <b>202</b> is being read (read and written). The &#x201c;false&#x201d; of the Open flag indicates that none of the files in the folder <b>201</b> are being read (read or written). Each of the folders <b>201</b> and <b>202</b> has the Open flag in correspondence with each access source personal computer (not shown, but only the Open flag corresponding to the personal computer <b>101</b> is typically shown).</p>
<p id="p-0074" num="0073">Flags that are originally held by the file system may be used as the Hide flag and/or the Open flag. For example, there are methods, such as &#x201c;it is construed as Hide=true when an Other user is not allowed to read&#x201d; in the case of a Unix-based file system and &#x201c;it is construed as Hide=true when there is a Hidden attribute&#x201d; in the case of a FAT file system. In addition, most file systems have a counter that indicates the number of processes that currently open and a flag that indicates that it is mounted, so the Open flag may be managed by access source personal computers by combining this mechanism with the following b<b>2</b> mechanism.</p>
<p id="p-0075" num="0074">In addition, the NAS <b>104</b> has a function of identifying a personal computer that has accessed the NAS <b>104</b> on the basis of the IP address or the MAC address.</p>
<p id="p-0076" num="0075">As an example of a way of implementing the above, because a request to the NAS <b>104</b> comes via a network, the request source IP address or MAC address may be extracted from the request packet. It is only necessary that this is directly added to a request block intended for the file system as additional information. Note that, when the processing result in the file system is transmitted to the request source personal computer, the source IP address/MAC address (IP address/MAC address of the access request source personal computer) may be extracted.</p>
<p id="p-0077" num="0076">When the NAS <b>104</b> detects that the folder of the Open flag has been changed from &#x201c;false&#x201d; to &#x201c;true&#x201d; in the folder <b>201</b> with the Hide flag of &#x201c;true&#x201d;, the NAS <b>104</b> counts up the in_use of the access source personal computer <b>101</b>, that is, the Bad PC List <b>203</b> corresponding to the extracted IP address/MAC address.</p>
<p id="p-0078" num="0077">The NAS <b>104</b> sets the value of the protect flag <b>305</b> to &#x201c;true&#x201d; and sets the value of the BTL <b>304</b> to a prescribed value (for example, 32). When the NAS <b>104</b> changes the Open flag from &#x201c;true&#x201d; to &#x201c;false&#x201d;, the NAS <b>104</b> counts down the corresponding in_use.</p>
<p id="p-0079" num="0078">As described above, the router <b>103</b> prohibits data communication between the access source personal computer <b>101</b> and the external network <b>105</b> while the personal computer <b>101</b> is accessing a secret folder and for a constant period of time (32 seconds) after the access has been completed.</p>
<p id="p-0080" num="0079">The access prohibiting period (BTL <b>304</b>, OCN <b>306</b>) does not interfere with a user's normal job. For example, during the access prohibiting period, the user can read and write data of the secret folder while reading and writing a mail. In the meantime, a network access of software, such as malware, is prohibited to make it possible to prevent damage of information leakage. Furthermore, a log or an error message that indicates that communication is blocked is an alarm that malware is running. Therefore, the user can early find malware.</p>
<p id="p-0081" num="0080">Note that the router <b>103</b> does not need to have an NAT function or a DHCP function. Therefore, the router <b>103</b> may be implemented by detecting and switching IP/MAC addresses of the destination and source of a packet. Thus, the router <b>103</b> is almost equivalent to a switching HUB and is easily formed of hardware.</p>
<p id="h-0012" num="0000">[External Access Monitoring Unit <b>109</b>]</p>
<p id="p-0082" num="0081">Next, the external access monitoring unit <b>109</b>, which is a new function implemented in the router <b>103</b>, will be described.</p>
<p id="p-0083" num="0082">The external access monitoring unit <b>109</b> is a function of detecting the status of a connection between each of the personal computers <b>101</b> and <b>102</b> and the external network <b>105</b>.</p>
<p id="p-0084" num="0083">When the personal computer <b>101</b> or <b>102</b> accesses the external network <b>105</b>, the NAS <b>104</b> prohibits a file access of the personal computer <b>101</b> or <b>102</b> that accesses the external network <b>105</b>. In other words, when the router <b>103</b> accepts a request for an access from the personal computer <b>101</b> or <b>102</b> in the LAN to the external network <b>105</b>, the NAS <b>104</b> sets the reading of a folder in the NAS <b>104</b> by the personal computer <b>101</b> or <b>102</b> that has issued the request for an access to the external network <b>105</b> as an error for a constant period of time thereafter.</p>
<p id="p-0085" num="0084">By so doing, when the personal computer <b>101</b> or <b>102</b> tries to establish connection to the external network <b>105</b> because of running of malware, the NAS <b>104</b> prohibits the personal computer <b>101</b> or <b>102</b> from accessing a secret file (secret file stored in the NAS <b>104</b>) to thereby prevent data leakage.</p>
<p id="p-0086" num="0085">Specifically, when the external access monitoring unit <b>109</b> detects that the personal computer <b>101</b> or <b>102</b> has accessed the external network <b>105</b>, the external access monitoring unit <b>109</b> sets the value of the OCN <b>306</b> in the Bad PC List <b>203</b>.</p>
<p id="p-0087" num="0086">The external access monitoring unit <b>109</b> sets the value of the OCN <b>306</b> in consideration of a network protocol, or the like, used in exchanges between the personal computer <b>101</b> or <b>102</b> and the external network <b>105</b>. For example, when the personal computer <b>101</b> or <b>102</b> uses an SMTP (Simple Mail Transfer Protocol) to carry out exchanges with the external network <b>105</b>, the external access monitoring unit <b>109</b> sets the value of the OCN <b>306</b> at &#x201c;30&#x201d;. When the personal computer <b>101</b> or <b>102</b> uses an HTTP (Hypertext Transfer Protocol) to carry out exchanges with the external network <b>105</b>, the external access monitoring unit <b>109</b> sets the value of the OCN <b>306</b> at &#x201c;10&#x201d;. In addition, the personal computer <b>101</b> or <b>102</b> uses an FTP (File Transfer Protocol) to carry out exchanges with the external network <b>105</b>, the external access monitoring unit <b>109</b> sets the value of the OCN <b>306</b> at &#x201c;40&#x201d;. That is, when the personal computer <b>101</b> or <b>102</b> sends a mail or transfers a file, the access prohibiting period to the NAS <b>104</b> is elongated as compared with when the personal computer <b>101</b> or <b>102</b> carries out Web access. This is to prohibit an access to the external network <b>105</b>, which is highly likely to cause leakage of a secret file due to malware, for the access prohibiting period.</p>
<p id="p-0088" num="0087">Note that the external access monitoring unit <b>109</b> may be implemented by monitoring communication between the personal computer <b>101</b> or <b>102</b> and the external network <b>105</b> in such a manner that the router <b>103</b> cooperates with a firewall.</p>
<p id="h-0013" num="0000">[File Access Control Unit <b>110</b>]</p>
<p id="p-0089" num="0088">In addition, the NAS <b>104</b> has the file access control unit <b>110</b>. The file access control unit <b>110</b> is a function of prohibiting the personal computer <b>101</b> or <b>102</b> in the LAN from accessing a folder that may be open to the public or delaying the access for a constant period of time.</p>
<p id="p-0090" num="0089">The file access control unit <b>110</b> operates on the basis of information from the external access monitoring unit <b>109</b> of the router <b>103</b>. More specifically, the system control unit <b>107</b> acquires access detection in the external access monitoring unit <b>109</b> of the router <b>103</b>. Then, the system control unit <b>107</b> gives an operation instruction to the file access control unit <b>110</b> on the basis of access information acquired from the external access monitoring unit <b>109</b>. The file access control unit <b>110</b> controls an access of the personal computer <b>101</b> or <b>102</b> to the NAS <b>104</b> on the basis of the instruction from the system control unit <b>107</b>.</p>
<p id="p-0091" num="0090">In addition, as described above, the external access monitoring unit <b>109</b> sets the value of the OCN <b>306</b>. The system control unit <b>107</b> gives an operation instruction to the file access control unit <b>110</b> in accordance with the value of the OCN <b>306</b>. The file access control unit <b>110</b> allows a personal computer, of which the value of the OCN <b>306</b> is &#x201c;0&#x201d;, to access the NAS <b>104</b>. In addition, the file access control unit <b>110</b> prohibits a personal computer, of which the value of the OCN <b>306</b> is not &#x201c;0&#x201d;, from accessing the NAS <b>104</b>.</p>
<p id="p-0092" num="0091">The system control unit <b>107</b> discriminates a folder of which the Hide flag is &#x201c;true&#x201d;. The file access monitoring unit <b>104</b> monitors the Open flag. When the file access monitoring unit <b>104</b> detects that the Open flag has changed from &#x201c;false&#x201d; to &#x201c;true&#x201d;, the system control unit <b>107</b> acquires the OCN <b>306</b> of the personal computer corresponding to the changed Open flag. Then, when the system control unit <b>107</b> determines that the Hide flag of the acquired OCN <b>306</b> is &#x201c;true&#x201d;, the system control unit <b>107</b> notifies the file access control unit <b>110</b> of the OCN <b>306</b>.</p>
<p id="p-0093" num="0092">When the file access control unit <b>110</b> determines that the value of the OCN <b>306</b> is not &#x201c;0&#x201d;, the file access control unit <b>100</b> returns an error to a file access request. That is, the file access control unit <b>110</b> prohibits a file access of a personal computer of which the value of the OCN <b>306</b> is &#x201c;0&#x201d;.</p>
<p id="h-0014" num="0000">[Network Storage System <b>400</b>]</p>
<p id="p-0094" num="0093"><figref idref="DRAWINGS">FIG. 4</figref> is a configuration diagram of a network storage system <b>400</b> according to the present embodiment.</p>
<p id="p-0095" num="0094">The network storage system <b>400</b> is formed of personal computers <b>401</b> and <b>402</b>, a firewall <b>403</b> and an NAS <b>404</b>. The network storage system <b>400</b> is connected to the external network <b>105</b> via the firewall <b>403</b>. The firewall <b>403</b> has a packet monitoring unit <b>406</b> and a characteristic pattern dictionary <b>409</b>. In addition, the NAS <b>404</b> has a characteristic pattern generating unit <b>407</b> and a catalog function <b>408</b>.</p>
<p id="p-0096" num="0095">The NAS <b>404</b> is able to manage whether it is a secret file file by file. The characteristic pattern generating unit <b>407</b> generates a characteristic pattern for each secret file. Then, the catalog function <b>408</b> enters the characteristic pattern, generated by the characteristic pattern generating unit <b>407</b>, into the characteristic pattern dictionary <b>409</b>. The characteristic pattern indicates whether a file is a secret file. The characteristic pattern generating unit <b>407</b>, for example, generates a characteristic pattern on the basis of the file name and file content of a secret file.</p>
<p id="p-0097" num="0096">The packet monitoring unit <b>406</b> monitors transfer packets from the personal computers <b>401</b> and <b>402</b> in the LAN to the external network <b>405</b> to determine whether there is a characteristic pattern in the transfer packets. When the firewall <b>403</b> has received a transfer packet, the packet monitoring unit <b>406</b> refers to the characteristic pattern dictionary <b>409</b>. When the packet monitoring unit <b>406</b> determines that a transfer packet contains a characteristic pattern entered in the characteristic pattern dictionary <b>409</b>, the external access control unit <b>410</b> prohibits transmission of the transfer packet to the external network <b>105</b>.</p>
<p id="p-0098" num="0097">By so doing, the network storage system <b>400</b> according to the present embodiment uses the characteristic pattern to make it possible to specify a secret file for the firewall <b>403</b> and to prevent leakage of a secret file to the external network <b>405</b>. In addition, the network storage system <b>400</b> according to the present embodiment is able to prevent the leakage even when malware has copied a secret file into a public folder.</p>
<p id="p-0099" num="0098">In addition, a trigger that causes the characteristic pattern generating unit <b>407</b> to operate is, for example, any one or combination of the following a, b and c.</p>
<p id="p-0100" num="0099">a. A user of the NAS <b>404</b> issues a start-up instruction to the characteristic pattern generating unit <b>407</b>.</p>
<p id="p-0101" num="0100">b. The characteristic pattern generating unit <b>407</b> is periodically started up at a prespecified period of time.</p>
<p id="p-0102" num="0101">c. The pattern generating unit <b>407</b> is started up with a trigger of writing to or updating a file.</p>
<p id="p-0103" num="0102">In addition, the characteristic pattern generating unit <b>407</b> calculates a characteristic pattern present in the changed file in the NAS <b>404</b>. Therefore, the firewall <b>403</b> is able to monitor the presence or absence of a characteristic pattern in a transfer packet in real time.</p>
<p id="p-0104" num="0103">Note that a trigger for starting up the characteristic pattern generating unit <b>407</b> may be implemented by using a function of notifying file update and creation of a file system or an operation system implemented in the NAS <b>404</b>.</p>
<p id="p-0105" num="0104">In this way, the network storage <b>400</b> according to the present embodiment is able to prevent leakage of a file in a specified folder (protect flag is &#x201c;true&#x201d;) of the NAS <b>404</b> and a file altered from the above file or data to the external network <b>405</b>. The protect flag will be additionally described.</p>
<p id="p-0106" num="0105">The network storage system <b>400</b> according to the present embodiment prohibits transmission of a transfer packet having a characteristic pattern to the external network <b>105</b>. Therefore, the network storage system <b>400</b> according to the present embodiment is able to prevent leakage of a secret file to the external network <b>405</b> even when the secret file is present in an unprotected folder.</p>
<p id="h-0015" num="0000">[Network Storage System <b>500</b>]</p>
<p id="p-0107" num="0106"><figref idref="DRAWINGS">FIG. 5</figref> is a configuration diagram of a network storage system <b>500</b> according to the present embodiment.</p>
<p id="p-0108" num="0107">The network storage system <b>500</b> is formed of personal computers <b>501</b> and <b>502</b>, a router <b>503</b> and an NAS <b>504</b>. The network storage system <b>500</b> is connected to an external network <b>505</b> via the router <b>503</b>. In addition, the router <b>503</b> has an external access control unit <b>503</b>. The NAS <b>504</b> has a file access monitoring unit <b>507</b>, a system control unit <b>508</b>, a characteristic pattern generating unit <b>509</b>, a characteristic pattern dictionary <b>510</b> and a file search unit <b>511</b>.</p>
<p id="p-0109" num="0108">The network storage system <b>500</b> according to the present embodiment is a system that, where necessary, detects a characteristic pattern in a secret file and, where necessary, updates the presence or absence of an access to the secret file. Then, the network storage system <b>500</b> according to the present embodiment prohibits a personal computer that has accessed the secret file from accessing the external access network <b>505</b>. By so doing, the network storage system <b>500</b> is also able to prevent leakage of a secret file due to malware.</p>
<p id="p-0110" num="0109">Hereinafter, the operation of the network storage system <b>500</b> will be described.</p>
<p id="p-0111" num="0110">The personal computer <b>501</b> or <b>502</b> accesses a file in the NAS <b>504</b>. When the personal computer <b>501</b> or <b>502</b> updates a secret file, the characteristic pattern generating unit <b>509</b> starts up. The characteristic pattern generating unit <b>509</b> generates a characteristic pattern of the updated secret file. The characteristic pattern generating unit <b>407</b> generates a characteristic pattern on the basis of the file name and the file content. Then, the characteristic pattern generating unit <b>509</b> enters the generated characteristic pattern into the characteristic pattern dictionary <b>510</b>, and notifies the file search unit <b>511</b> of the generated characteristic pattern. The file search unit <b>511</b> determines whether the notified characteristic pattern is present in any of the folders in the NAS <b>504</b>. When the file search unit <b>511</b> has detected a folder or a file that contains the generated characteristic pattern, an adding function <b>512</b> adds the detected file as a new monitoring target of the file access monitoring unit <b>507</b>. The file access monitoring unit <b>507</b> monitors file accesses from the personal computers <b>501</b> and <b>502</b> for not only the folder and file that have newly become monitoring targets but also the folder and file that have been already monitoring targets.</p>
<p id="p-0112" num="0111">The network storage system <b>500</b> according to the present embodiment searches a folder other than the specified folder (protect flag is &#x201c;true&#x201d;) in the NAS <b>504</b> or a public folder in the personal computer <b>501</b> or <b>502</b> or the NAS <b>504</b> for the characteristic pattern.</p>
<p id="p-0113" num="0112">Alternatively, it is also applicable that the NAS <b>504</b> has a function of searching all the folders on a personal computer for the characteristic pattern in cooperation with software on the personal computer and the NAS <b>504</b> executes any one or both of the following operations a and b.</p>
<p id="p-0114" num="0113">a. Transmission of a file or a folder, from which the characteristic pattern has been found, to the external network <b>505</b> is prohibited.</p>
<p id="p-0115" num="0114">b. Personal computers are notified of a file or a folder from which a characteristic pattern has been newly detected.</p>
<p id="p-0116" num="0115">By so doing, the network storage system <b>500</b> according to the present embodiment is able to prevent leakage of a secret file to the external network <b>505</b> even when the secret file is copied into a folder of which a secret file is not protected.</p>
<p id="p-0117" num="0116">In addition, the network storage system <b>500</b> according to the present embodiment adds a secret file when the secret file is copied into an unprotected folder. Therefore, it is possible to reduce leakage of a secret file to the external network <b>505</b> due to user's careless operation.</p>
<p id="p-0118" num="0117">In addition, in the network storage system <b>500</b> according to the present embodiment, when a user specifies a protected folder, a duplication of a file present in that folder may also be set as a protection target. Thus, the network storage system <b>500</b> is able to prevent an omission of file protection of the NAS <b>504</b> due to user's oversight.</p>
<p id="h-0016" num="0000">[Network Storage System <b>600</b>]</p>
<p id="p-0119" num="0118"><figref idref="DRAWINGS">FIG. 6</figref> is a configuration diagram of a network storage system <b>600</b> according to the present embodiment.</p>
<p id="p-0120" num="0119">Next, the network storage system <b>600</b> according to the present embodiment will be described.</p>
<p id="p-0121" num="0120">The network storage system <b>600</b> is formed of a personal computer <b>601</b> and an external network <b>602</b>. The personal computer <b>601</b> is formed of a LAN port <b>603</b>, a net access control unit <b>604</b>, a system control unit <b>605</b>, a file access monitoring unit <b>606</b> and a built-in disk <b>607</b>. The personal computer <b>601</b> has firewall software that runs on the personal computer <b>601</b>.</p>
<p id="p-0122" num="0121">The built-in disk <b>607</b> stores a secret folder and a secret file. The file access monitoring unit <b>606</b> detects a file access to a secret folder or a secret file stored in the built-in disk <b>607</b>. When the file access monitoring unit <b>606</b> has detected a file access to a secret folder or a secret file, the file access monitoring unit <b>606</b> notifies the system control unit <b>605</b> that the file access has been detected.</p>
<p id="p-0123" num="0122">When the system control unit <b>605</b> receives the notification that the file access has been detected, the system control unit <b>605</b> instructs the net access control unit <b>604</b> to interrupt connection to the external network <b>602</b> on the basis of the notification that the file access has been detected from the file access monitoring unit <b>606</b>.</p>
<p id="p-0124" num="0123">The net access control unit <b>604</b> interrupts the access of the personal computer <b>601</b> to the external network <b>602</b> on the basis of the instruction from the system control unit <b>605</b>.</p>
<p id="h-0017" num="0000">[Network Storage System <b>700</b>]</p>
<p id="p-0125" num="0124"><figref idref="DRAWINGS">FIG. 7</figref> is a configuration diagram of a network storage system <b>700</b> according to the present embodiment.</p>
<p id="p-0126" num="0125">The network storage system <b>700</b> according to the present embodiment will be described.</p>
<p id="p-0127" num="0126">The network storage system <b>700</b> is formed of a personal computer <b>701</b>, an external network <b>702</b> and an external disk <b>703</b>. Here, the external disk is an MO disk, a USB memory, or the like. The personal computer <b>701</b> is connected to the external disk <b>703</b> via a USB interface, a SCSI interface, or the like.</p>
<p id="p-0128" num="0127">The personal computer <b>701</b> is formed of a LAN port <b>704</b>, a net access control unit <b>705</b>, a system control unit <b>706</b>, a protection target detecting unit <b>707</b>, a file access monitoring unit <b>708</b> and a built-in disk <b>709</b>.</p>
<p id="p-0129" num="0128">When the personal computer <b>702</b> accesses a folder or a file stored in the external disk <b>703</b>, the protection target detecting unit <b>707</b> determines that the accessed folder or file is a secret folder or a secret file on the basis of the volume label of the external disk <b>703</b>, a folder name, or the like. Specifically, a processing logic executed by the protection target detecting unit <b>707</b>, for example, determines that a folder or a file of which the volume label is &#x201c;HIDDENxxx&#x201d; is a protection target. In other words, the protection target detecting unit <b>707</b> determines a folder or a file having a predetermined specific volume label as a protection target. Alternatively, the protection target detecting unit <b>707</b> determines a folder or a file present in a specific root folder as a protection target.</p>
<p id="p-0130" num="0129">When the protection target detecting unit <b>707</b> determines that a folder or a file stored in the external disk <b>703</b> is a protection target, the protection target detecting unit <b>707</b> notifies the system control unit <b>706</b> that an access between the external network <b>702</b> and the personal computer <b>701</b> is prohibited.</p>
<p id="p-0131" num="0130">When the system control unit <b>706</b> receives an access prohibiting notification from the protection target detecting unit <b>707</b>, the system control unit <b>706</b> instructs the net access control unit <b>705</b> to interrupt connection to the external network <b>702</b> on the basis of the notification from the protection target detecting unit <b>707</b>.</p>
<p id="p-0132" num="0131">The net access control unit <b>705</b> interrupts an access of the personal computer <b>701</b> to the external network <b>702</b> on the basis of the instruction from the system control unit <b>706</b>.</p>
<p id="p-0133" num="0132">In addition, the network storage system <b>700</b> uses the file access monitoring unit <b>708</b> to detect a file access to a secret folder or a secret file stored in the built-in disk <b>709</b>. When the file access monitoring unit <b>708</b> determines that there is a file access to a secret folder or a secret file stored in the built-in disk <b>709</b>, the file access monitoring unit <b>708</b> notifies the system control unit <b>706</b> that the file access has been detected.</p>
<p id="p-0134" num="0133">When the system control unit <b>706</b> receives the file access detection notification from the file access monitoring unit <b>708</b>, the system control unit <b>706</b> instructs the net access control unit <b>705</b> to interrupt connection to the external network <b>702</b> on the basis of the file access detection notification from the file access monitoring unit <b>708</b>.</p>
<p id="p-0135" num="0134">The net access control unit <b>705</b> interrupts an access of the personal computer <b>701</b> to the external network <b>702</b> on the basis of the instruction from the system control unit <b>706</b>.</p>
<p id="p-0136" num="0135">The network storage system <b>700</b> according to the present embodiment is a system that prohibits an access between the personal computer <b>701</b> and the external network <b>702</b> when a secret folder or a secret file in the external disk <b>703</b> has been accessed.</p>
<p id="p-0137" num="0136">By so doing, the network storage system <b>700</b> according to the present embodiment is able to prevent leakage of secret data, stored in the external disk <b>703</b>, to the external network <b>702</b>.</p>
<p id="p-0138" num="0137">When a secret folder or a secret file stored in the external disk <b>703</b> is updated and managed within the external disk <b>703</b>, the personal computer <b>701</b> is able to prevent leakage of the secret folder or the secret file to the external network <b>702</b> due to malware.</p>
<p id="h-0018" num="0000">[Network Storage System <b>800</b>]</p>
<p id="p-0139" num="0138">A network storage system <b>800</b> according to the present embodiment will be described.</p>
<p id="p-0140" num="0139"><figref idref="DRAWINGS">FIG. 8</figref> is a configuration diagram of the network storage system <b>800</b> according to the present embodiment.</p>
<p id="p-0141" num="0140">The network storage system <b>800</b> is formed of a personal computer <b>801</b>, an external network <b>802</b> and an external disk <b>803</b>.</p>
<p id="p-0142" num="0141">The personal computer <b>801</b> is formed of a LAN port <b>804</b>, a net access control unit <b>805</b>, a system control unit <b>806</b>, an access control unit <b>807</b>, a file access monitoring unit <b>808</b> and a built-in disk <b>809</b>.</p>
<p id="p-0143" num="0142">In the network storage system <b>800</b> as well, the file access monitoring unit <b>808</b> detects a file access from the personal computer <b>801</b> to a secret folder or a secret file stored in the built-in disk <b>809</b>.</p>
<p id="p-0144" num="0143">Then, when the file access monitoring unit <b>808</b> determines that there is a file access to a secret folder or a secret file stored in the built-in disk <b>809</b>, the file access monitoring unit <b>808</b> notifies the system control unit <b>806</b> that the file access has been detected.</p>
<p id="p-0145" num="0144">When the system control unit <b>806</b> receives the notification that the file access has been detected from the file access monitoring unit <b>808</b>, the system control unit <b>806</b> instructs the net access control unit <b>805</b> to interrupt connection to the external network <b>802</b> on the basis of the notification that the file access has been detected from the file access monitoring unit <b>808</b>.</p>
<p id="p-0146" num="0145">The net access control unit <b>805</b> interrupts an access of the personal computer <b>801</b> to the external network <b>802</b> on the basis of the instruction from the system control unit <b>806</b>.</p>
<p id="p-0147" num="0146">Then, data stored in the external disk <b>803</b> are encrypted. The external disk <b>803</b> is a portable recording medium. By encrypting data in the external disk <b>803</b>, it is configured to be able to prevent leakage of data even when a user loses the external disk <b>803</b> by carelessness.</p>
<p id="p-0148" num="0147">The personal computer <b>801</b> has the access control unit <b>807</b>. The access control unit <b>807</b> decodes encrypted data stored in the external disk <b>803</b>. Specifically, the access control unit <b>807</b> carries out password authentication, fingerprint authentication, or the like. By so doing, the access control unit <b>807</b> decodes encrypted data stored in the external disk <b>803</b>. When the access control unit <b>807</b> determines that reading from and writing to the external disk <b>803</b> are allowed, the access control unit <b>807</b> notifies the system control unit <b>806</b> that an access between the external network <b>802</b> and the personal computer <b>801</b> is prohibited.</p>
<p id="p-0149" num="0148">When the system control unit <b>806</b> receives the notification that the access is prohibited from the access control unit <b>807</b>, the system control unit <b>806</b> instructs the net access control unit <b>805</b> to interrupt connection to the external network <b>802</b> on the basis of the notification from the access control unit <b>807</b>.</p>
<p id="p-0150" num="0149">The net access control unit <b>805</b> interrupts an access of the personal computer <b>801</b> to the external network <b>802</b> on the basis of the instruction from the system control unit <b>806</b>.</p>
<p id="p-0151" num="0150">In addition, the net access control unit <b>805</b> may be configured to allow network access that is not likely to leak secret data (secret folder, secret file) to the external network <b>802</b>, such as an NTP (Network Time Protocol) and a ping response.</p>
<p id="h-0019" num="0000">[Flowchart of Open Operation]</p>
<p id="p-0152" num="0151"><figref idref="DRAWINGS">FIG. 9</figref> is a flowchart related to operation (open operation) of accessing a file or a folder stored in the NAS <b>104</b> according to the present embodiment.</p>
<p id="p-0153" num="0152">When the personal computer <b>101</b> or <b>102</b> accesses the NAS <b>104</b>, the personal computer <b>101</b> or <b>102</b> transmits a request packet to the NAS <b>104</b>.</p>
<p id="p-0154" num="0153">The file access monitoring unit <b>106</b> implemented in the NAS <b>104</b> extracts the IP address/MAC address of the request source that has accessed a file in the NAS <b>104</b> from the request packet (step S<b>901</b>).</p>
<p id="p-0155" num="0154">The file access monitoring unit <b>106</b> refers to the Bad PC List <b>203</b> and then determines whether the value of the OCN <b>306</b> corresponding to the access request source is larger than 0 (step S<b>902</b>). When the file access monitoring unit <b>106</b> determines that the value of the OCN <b>306</b> corresponding to the access request source is larger than &#x201c;0&#x201d; (YES in step S<b>902</b>), the file access monitoring unit <b>106</b> prohibits a file access of the request source (step S<b>905</b>) and then ends the access operation (step S<b>906</b>).</p>
<p id="p-0156" num="0155">In addition, the file access monitoring unit <b>106</b> determines that the value of the OCN <b>306</b> corresponding to the access request source is not larger than 0 (specifically, the value of the OCN <b>306</b> is 0) (NO in step S<b>902</b>), the system control unit <b>107</b> allows the file access to execute open operation (step S<b>903</b>). The open operation is an operation in which the system control unit <b>107</b> opens a file for which an access request is issued.</p>
<p id="p-0157" num="0156">Then, the system control unit <b>107</b> determines whether the open operation has failed (step S<b>904</b>). When the system control unit <b>107</b> determines that the open operation has failed (YES in step S<b>904</b>), the file access monitoring unit <b>106</b> prohibits a file access of the request source (step S<b>905</b>) and then ends the access operation (step S<b>906</b>). When the system control unit <b>107</b> determines that the open operation is successful (NO in step S<b>904</b>), the system control unit <b>107</b> determines whether a file subjected to open operation is a protection target file (step S<b>907</b>).</p>
<p id="p-0158" num="0157">When the system control unit <b>107</b> determines that the file subjected to open operation is a protection target (YES in step S<b>908</b>), the system control unit <b>107</b> counts up the in_use <b>303</b> corresponding to the access request source by one, sets the protect flag <b>305</b> to &#x201c;true&#x201d; and then sets the BTL at &#x201c;32&#x201d; (step S<b>908</b>). When the system control unit <b>107</b> determines that the file subjected to open operation is a protection target (step S<b>909</b>), the system control unit <b>107</b> ends open operation (step S<b>909</b>).</p>
<p id="h-0020" num="0000">[Flowchart of Close Operation]</p>
<p id="p-0159" num="0158"><figref idref="DRAWINGS">FIG. 10</figref> is a flowchart related to operation (close operation) of accessing a file or a folder stored in the NAS <b>104</b> according to the present embodiment.</p>
<p id="p-0160" num="0159">When the personal computer <b>101</b> or <b>102</b> accesses the NAS <b>104</b>, the personal computer <b>101</b> or <b>102</b> transmits a request packet to the NAS <b>104</b>.</p>
<p id="p-0161" num="0160">The file access monitoring unit <b>106</b> implemented in the NAS <b>104</b> extracts the IP address/MAC address of the request source that has accessed a file in the NAS <b>104</b> from the request packet (step S<b>1001</b>).</p>
<p id="p-0162" num="0161">The file access monitoring unit <b>106</b> notifies the system control unit <b>107</b> of the IP address/MAC address of the request source, and the system control unit <b>107</b> executes close operation (step S<b>1002</b>).</p>
<p id="p-0163" num="0162">Then, the system control unit <b>107</b> determines whether a file subjected to close operation is a protection target file (step S<b>1003</b>). When the system control unit <b>107</b> determines that the file subjected to close operation is not a protection target (NO in step S<b>1003</b>), the system control unit <b>107</b> ends close operation (step S<b>1006</b>). When the system control unit <b>107</b> determines that the file subjected to close operation is a protection target (YES in step S<b>1003</b>), the system control unit <b>107</b> determines whether all the files in a folder to which the protection target file belongs are close (step S<b>1004</b>).</p>
<p id="p-0164" num="0163">When the system control unit <b>107</b> determines that all the files in the folder are close (YES in step S<b>1004</b>), the system control unit <b>107</b> counts down the in_use <b>303</b> corresponding to the access request source by one (step S<b>1005</b>) and then ends close operation (step S<b>1006</b>). In addition, when the system control unit <b>107</b> determines that not all the files in the folder are close (NO in step S<b>1004</b>), the control unit <b>07</b> ends close operation (step S<b>1006</b>).</p>
<p id="h-0021" num="0000">[Flowchart of Counting Operation]</p>
<p id="p-0165" num="0164"><figref idref="DRAWINGS">FIG. 11</figref> is a flowchart of counting operation executed by the router <b>103</b> according to the present embodiment. The function of the router <b>103</b> that executes the flowchart shown in <figref idref="DRAWINGS">FIG. 11</figref> is a function of managing the above described Bad PC List <b>203</b> and then determining whether the respective personal computers <b>101</b> and <b>102</b> are allowed or rejected to communicate with the external network <b>105</b>. Note that the counting operation is an operation of counting a period of time during which connection between personal computer <b>101</b> or <b>102</b> and the external network <b>105</b> is interrupted.</p>
<p id="p-0166" num="0165">The router <b>103</b> has an internal timer (not shown). The router <b>103</b> starts up the monitoring process every one second by the internal timer. The router <b>103</b> refers to the Bad PC List <b>203</b> (step S<b>1101</b>). The router <b>103</b> determines whether the BTLs <b>304</b> corresponding to all the personal computers (personal computers <b>101</b> and <b>102</b>) entered in the Bad PC List <b>203</b> are larger than &#x201c;0&#x201d; (step S<b>1102</b>). When the router <b>103</b> determines that the BTL <b>304</b> is larger than &#x201c;0&#x201d; (YES in step S<b>1103</b>), the router <b>103</b> counts down the value of that BTL <b>304</b>, for which it is determined that the value of the BTL <b>304</b> is larger than &#x201c;0&#x201d;, by one (step S<b>1103</b>).</p>
<p id="p-0167" num="0166">Then, the router <b>103</b> determines whether the BTL <b>304</b> has become &#x201c;0&#x201d; as a result of counting down by one (step S<b>1104</b>). When the router <b>103</b> determines that the BTL <b>304</b> has become &#x201c;0&#x201d; (YES in step S<b>1104</b>), the router <b>103</b> changes the protect flag <b>305</b>, for which it is determined that the BTL <b>304</b> has become &#x201c;0&#x201d;, from &#x201c;true&#x201d; to &#x201c;false&#x201d; (step <b>51105</b>). When the router <b>103</b> determines that the BTL <b>304</b> is not &#x201c;0&#x201d; (NO in step S<b>1104</b>), the router <b>103</b> determines whether the OCNs <b>306</b> corresponding to all the personal computers (personal computers <b>101</b> and <b>102</b>) are larger than &#x201c;0&#x201d; (step S<b>1106</b>). In addition, in step S<b>1102</b>, when it is determined that the BTLs <b>304</b> corresponding to all the personal computers (personal computers <b>101</b> and <b>102</b>) entered in the Bad PC List <b>203</b> are not larger than &#x201c;0&#x201d; (NO in step S<b>1102</b>), the router <b>103</b> determines whether the OCNs <b>306</b> corresponding to all the personal computers (personal computers <b>101</b> and <b>102</b>) are not larger than &#x201c;0&#x201d; (step S<b>1106</b>).</p>
<p id="p-0168" num="0167">When the router <b>103</b> determines that the OCN <b>306</b> is larger than &#x201c;0&#x201d; (YES in step S<b>1106</b>), the router <b>103</b> counts down the value of that OCN <b>306</b> by one (step S<b>1107</b>). When the router determines that the OCNs <b>306</b> corresponding to all the personal computers (personal computers <b>101</b> and <b>102</b>) are not larger than &#x201c;0&#x201d; (NO in step S<b>1106</b>), the router <b>103</b> determines whether counting operation has been executed on the BTLs <b>304</b> and OCNs <b>306</b> of all the entries entered in the Bad PC List <b>203</b> (step S<b>1108</b>).</p>
<p id="p-0169" num="0168">When the router <b>103</b> determines that counting operation has been executed on the BTLs <b>304</b> and OCNs <b>306</b> of all the entries entered in the Bad PC List <b>203</b> (YES in step S<b>1108</b>), the router <b>103</b> ends the operation (step S<b>1109</b>). In addition, when the router <b>103</b> determines that counting operation has not executed on the BTLs <b>304</b> and OCNs <b>306</b> of all the entries entered in the Bad PC List <b>203</b> (NO in step S<b>1108</b>), the router <b>103</b> determines whether the values of the BTLs <b>304</b> are larger than &#x201c;0&#x201d; again (step S<b>1102</b>).</p>
<p id="h-0022" num="0000">[Flowchart of Packet Transfer Operation]</p>
<p id="p-0170" num="0169"><figref idref="DRAWINGS">FIG. 12</figref> is a flowchart of packet transfer operation executed by the router <b>103</b> according to the present embodiment.</p>
<p id="p-0171" num="0170">When the router <b>103</b> receives a packet from the personal computer <b>101</b> or <b>102</b>, the router <b>103</b> starts packet transfer operation (step S<b>1201</b>).</p>
<p id="p-0172" num="0171">The router <b>103</b> determines whether the destination of the received packet is the external network <b>105</b> and the source of the received packet is the personal computer <b>101</b> or <b>102</b> within the LAN (step S<b>1202</b>) When the router <b>103</b> determines that the destination of the packet is not the external network <b>105</b> or the source of the received packet is not the personal computer <b>101</b> or <b>102</b> in the LAN (in other words, when at least the destination of the packet is not the external network <b>105</b> and the source of the packet is not the personal computer <b>101</b> or <b>102</b>) (NO in step S<b>1202</b>), the router <b>103</b> transfers the received packet to a predetermined destination (step S<b>1203</b>), and then ends packet transfer operation (step S<b>1204</b>).</p>
<p id="p-0173" num="0172">When the router <b>103</b> determines that the destination of the packet is the external network <b>105</b> and the source of the received packet is the personal computer <b>101</b> or <b>102</b> in the LAN (YES in step S<b>1202</b>), the router <b>103</b> determines whether the protect flag <b>305</b> corresponding to the personal computer of the packet source is &#x201c;true&#x201d; (step S<b>1205</b>).</p>
<p id="p-0174" num="0173">When the router <b>103</b> determines that the protect flag <b>305</b> corresponding to the personal computer of the packet source is not &#x201c;true&#x201d; (protect flag <b>305</b> is &#x201c;false&#x201d;) (NO in step S<b>1205</b>), the router <b>103</b> determines a delay value (X) in accordance with a protocol used for communication (step S<b>1208</b>).</p>
<p id="p-0175" num="0174">Then, the router <b>103</b> determines whether the value of the OCN <b>306</b> is smaller than the delay value (X) (step S<b>1209</b>). When the router <b>103</b> determines that the value of the OCN <b>306</b> is smaller than the delay value (X) (YES in step S<b>1209</b>), the router <b>103</b> sets the value of the OCN to the delay value (X) (step S<b>1210</b>).</p>
<p id="p-0176" num="0175">Then, when the router <b>103</b> determines that the value of the OCN <b>306</b> is not smaller than the delay value (X) (NO in step S<b>1209</b>), the router <b>103</b> executes packet transfer operation (step S<b>1211</b>) and then ends packet transfer operation (step S<b>1212</b>).</p>
<p id="p-0177" num="0176"><figref idref="DRAWINGS">FIG. 13</figref> is a hardware block diagram of the NAS <b>104</b> according to the present embodiment.</p>
<p id="p-0178" num="0177">The hardware configuration of the NAS <b>104</b> will be described. The NAS <b>104</b> is formed of a CPU (Central Processing Unit) <b>1301</b>, a storage unit <b>1302</b>, a memory <b>1303</b> and LAN ports <b>1304</b> and <b>1305</b>.</p>
<p id="p-0179" num="0178">The NAS <b>104</b> is connected to the personal computers <b>101</b> and <b>102</b> via the LAN port <b>1304</b>. In addition, the NAS <b>104</b> is connected to the router <b>103</b> via the LAN port <b>1305</b>.</p>
<p id="p-0180" num="0179">The file access monitoring unit <b>106</b>, system control unit <b>107</b> and file access control unit <b>110</b> of the NAS <b>104</b> are functions that are executed by the CPU <b>1301</b> as software. Therefore, the file access monitoring unit <b>106</b>, the system control unit <b>107</b> and the file access control unit <b>110</b> are stored in the storage unit <b>1302</b> as software. Then, when the CPU <b>1301</b> executes the file access monitoring unit <b>106</b>, the system control unit <b>107</b> or the file access control unit <b>110</b>, the CPU <b>1301</b> expands the file access monitoring unit <b>106</b>, the system control unit <b>107</b> or the file access control unit <b>110</b> in the memory <b>1303</b> and then executes it.</p>
<p id="p-0181" num="0180">In addition, <figref idref="DRAWINGS">FIG. 14</figref> is a configuration diagram of the network storage system <b>100</b>, describing the functions of the NAS <b>104</b> according to the present embodiment. The NAS <b>104</b> has the functions of the file access monitoring unit <b>106</b>, system control unit <b>107</b> and file access control unit <b>110</b>. The file access monitoring unit <b>106</b>, the system control unit <b>107</b> and the file access control unit <b>110</b> are functions that control the network storage system <b>100</b>. Even when a personal computer infected with malware accesses a file in the NAS <b>104</b>, the NAS <b>104</b> is able to prevent leakage of a file or a folder, stored in the NAS <b>104</b>, to the external network <b>105</b>.</p>
<p id="p-0182" num="0181">In addition, <figref idref="DRAWINGS">FIG. 15</figref> is a configuration diagram of the network storage system <b>100</b>, describing the functions of the router <b>103</b> according to the present embodiment. The router <b>103</b> has the functions of the external access control unit <b>108</b> and external access monitoring unit <b>109</b>. The external access control unit <b>108</b> and the external access monitoring unit <b>109</b> are functions of controlling the network storage system <b>100</b>. The external access control unit <b>108</b> is a function of controlling whether to transfer a packet, received from the personal computer <b>101</b> or <b>102</b>, to the external network <b>105</b>. In addition, the external access monitoring unit <b>109</b> is a function of monitoring the status of connection between the external network <b>105</b> and each of the personal computers <b>101</b> and <b>102</b>. The router <b>103</b> executes the external access control unit <b>108</b> and the external access monitoring unit <b>109</b> for control as software. Thus, the router <b>103</b> also has a CPU, a storage unit, a memory or hardware equivalent to these in order to execute the external access control unit <b>108</b> and the external access monitoring unit <b>109</b>. The external access control unit <b>108</b> and the external access monitoring unit <b>109</b> may be the ones that are physically present in hardware configuration.</p>
<p id="p-0183" num="0182">Even when a personal computer infected with malware accesses a file in the NAS <b>104</b>, the external access control unit <b>108</b> and the external access monitoring unit <b>109</b> are able to prevent leakage of a file or a folder, stored in the NAS <b>104</b>, to the external network <b>105</b>.</p>
<p id="h-0023" num="0000">Industrial Applicability</p>
<p id="p-0184" num="0183">The network storage system according to the present embodiment relates to data protection in a storage connected via a network.</p>
<p id="p-0185" num="0184">With the network storage system according to the present embodiment, it is possible to effectively prevent leakage of data to an external network due to malware or a careless, inappropriate net access.</p>
<p id="p-0186" num="0185">All examples and conditional language recited herein are intended for pedagogical purposes to aid the reader in understanding the invention and the concepts contributed by the inventor to furthering the art, and are to be construed as being without limitation to such specifically recited examples and condition, nor does the organization of such examples in the specification relate to a showing of superiority and inferiority of the invention. Although the embodiment of the present inventions have been described in detail, it should be understood that the various changes, substitutions, and alternations could be made hereto without departing from the spirit and scope of the invention.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-claim-statement>What is claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method executed by a router that establishes a connection between a first network and a second network different from the first network, the first network including an information processing device and an information storage device, the method comprising:
<claim-text>detecting an access status of the information processing device to the information storage device; and</claim-text>
<claim-text>prohibiting transfer of the information from the information processing device to the second network for a period including a first period of time for which the information processing device accesses a specified folder in the information storage device, on a basis of the access status.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein
<claim-text>the detecting includes acquiring the access status from the information storage device.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method according to <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein
<claim-text>the detecting includes managing a period of time during which transfer of the information from the information processing device to the second network is prohibited in the prohibiting.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method according to <claim-ref idref="CLM-00003">claim 3</claim-ref>, further comprising:
<claim-text>detecting a connection between the information processing device and the second network.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method according to <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein
<claim-text>the detecting includes managing a connection status between the information processing device and the second network.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The method according to <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein
<claim-text>the detecting includes managing a period of time, during which an access from the information processing device to the information storage device is prohibited, depending on a connection status between the information processing device and the second network.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein
<claim-text>the period includes a second period of time before or after the first period of time. </claim-text>
</claim-text>
</claim>
</claims>
</us-patent-grant>
